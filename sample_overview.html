<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>chromoMap</title>
<script src="data:application/x-javascript;base64,KGZ1bmN0aW9uKCkgewogIC8vIElmIHdpbmRvdy5IVE1MV2lkZ2V0cyBpcyBhbHJlYWR5IGRlZmluZWQsIHRoZW4gdXNlIGl0OyBvdGhlcndpc2UgY3JlYXRlIGEKICAvLyBuZXcgb2JqZWN0LiBUaGlzIGFsbG93cyBwcmVjZWRpbmcgY29kZSB0byBzZXQgb3B0aW9ucyB0aGF0IGFmZmVjdCB0aGUKICAvLyBpbml0aWFsaXphdGlvbiBwcm9jZXNzICh0aG91Z2ggbm9uZSBjdXJyZW50bHkgZXhpc3QpLgogIHdpbmRvdy5IVE1MV2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cyB8fCB7fTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gYSB2aWV3ZXIgcGFuZS4gSWYgbm90LCB3ZSdyZSBpbiBhIHdlYiBicm93c2VyLgogIHZhciB2aWV3ZXJNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnZpZXdlck1vZGUgPQogICAgICAvXGJ2aWV3ZXJfcGFuZT0xXGIvLnRlc3Qod2luZG93LmxvY2F0aW9uKTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gU2hpbnkgbW9kZS4gSWYgbm90LCBpdCdzIGEgc3RhdGljIGRvY3VtZW50LgogIC8vIE5vdGUgdGhhdCBzdGF0aWMgd2lkZ2V0cyBjYW4gYXBwZWFyIGluIGJvdGggU2hpbnkgYW5kIHN0YXRpYyBtb2RlcywgYnV0CiAgLy8gb2J2aW91c2x5LCBTaGlueSB3aWRnZXRzIGNhbiBvbmx5IGFwcGVhciBpbiBTaGlueSBhcHBzL2RvY3VtZW50cy4KICB2YXIgc2hpbnlNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnNoaW55TW9kZSA9CiAgICAgIHR5cGVvZih3aW5kb3cuU2hpbnkpICE9PSAidW5kZWZpbmVkIiAmJiAhIXdpbmRvdy5TaGlueS5vdXRwdXRCaW5kaW5nczsKCiAgLy8gV2UgY2FuJ3QgY291bnQgb24galF1ZXJ5IGJlaW5nIGF2YWlsYWJsZSwgc28gd2UgaW1wbGVtZW50IG91ciBvd24KICAvLyB2ZXJzaW9uIGlmIG5lY2Vzc2FyeS4KICBmdW5jdGlvbiBxdWVyeVNlbGVjdG9yQWxsKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKHR5cGVvZihqUXVlcnkpICE9PSAidW5kZWZpbmVkIiAmJiBzY29wZSBpbnN0YW5jZW9mIGpRdWVyeSkgewogICAgICByZXR1cm4gc2NvcGUuZmluZChzZWxlY3Rvcik7CiAgICB9CiAgICBpZiAoc2NvcGUucXVlcnlTZWxlY3RvckFsbCkgewogICAgICByZXR1cm4gc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhc0FycmF5KHZhbHVlKSB7CiAgICBpZiAodmFsdWUgPT09IG51bGwpCiAgICAgIHJldHVybiBbXTsKICAgIGlmICgkLmlzQXJyYXkodmFsdWUpKQogICAgICByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gW3ZhbHVlXTsKICB9CgogIC8vIEltcGxlbWVudCBqUXVlcnkncyBleHRlbmQKICBmdW5jdGlvbiBleHRlbmQodGFyZ2V0IC8qLCAuLi4gKi8pIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CiAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKHNvdXJjZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgdGFyZ2V0W3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9CgogIC8vIElFOCBkb2Vzbid0IHN1cHBvcnQgQXJyYXkuZm9yRWFjaC4KICBmdW5jdGlvbiBmb3JFYWNoKHZhbHVlcywgY2FsbGJhY2ssIHRoaXNBcmcpIHsKICAgIGlmICh2YWx1ZXMuZm9yRWFjaCkgewogICAgICB2YWx1ZXMuZm9yRWFjaChjYWxsYmFjaywgdGhpc0FyZyk7CiAgICB9IGVsc2UgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNhbGxiYWNrLmNhbGwodGhpc0FyZywgdmFsdWVzW2ldLCBpLCB2YWx1ZXMpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZXBsYWNlcyB0aGUgc3BlY2lmaWVkIG1ldGhvZCB3aXRoIHRoZSByZXR1cm4gdmFsdWUgb2YgZnVuY1NvdXJjZS4KICAvLwogIC8vIE5vdGUgdGhhdCBmdW5jU291cmNlIHNob3VsZCBub3QgQkUgdGhlIG5ldyBtZXRob2QsIGl0IHNob3VsZCBiZSBhIGZ1bmN0aW9uCiAgLy8gdGhhdCBSRVRVUk5TIHRoZSBuZXcgbWV0aG9kLiBmdW5jU291cmNlIHJlY2VpdmVzIGEgc2luZ2xlIGFyZ3VtZW50IHRoYXQgaXMKICAvLyB0aGUgb3ZlcnJpZGRlbiBtZXRob2QsIGl0IGNhbiBiZSBjYWxsZWQgZnJvbSB0aGUgbmV3IG1ldGhvZC4gVGhlIG92ZXJyaWRkZW4KICAvLyBtZXRob2QgY2FuIGJlIGNhbGxlZCBsaWtlIGEgcmVndWxhciBmdW5jdGlvbiwgaXQgaGFzIHRoZSB0YXJnZXQgcGVybWFuZW50bHkKICAvLyBib3VuZCB0byBpdCBzbyAidGhpcyIgd2lsbCB3b3JrIGNvcnJlY3RseS4KICBmdW5jdGlvbiBvdmVycmlkZU1ldGhvZCh0YXJnZXQsIG1ldGhvZE5hbWUsIGZ1bmNTb3VyY2UpIHsKICAgIHZhciBzdXBlckZ1bmMgPSB0YXJnZXRbbWV0aG9kTmFtZV0gfHwgZnVuY3Rpb24oKSB7fTsKICAgIHZhciBzdXBlckZ1bmNCb3VuZCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc3VwZXJGdW5jLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTsKICAgIH07CiAgICB0YXJnZXRbbWV0aG9kTmFtZV0gPSBmdW5jU291cmNlKHN1cGVyRnVuY0JvdW5kKTsKICB9CgogIC8vIEFkZCBhIG1ldGhvZCB0byBkZWxlZ2F0b3IgdGhhdCwgd2hlbiBpbnZva2VkLCBjYWxscwogIC8vIGRlbGVnYXRlZS5tZXRob2ROYW1lLiBJZiB0aGVyZSBpcyBubyBzdWNoIG1ldGhvZCBvbgogIC8vIHRoZSBkZWxlZ2F0ZWUsIGJ1dCB0aGVyZSB3YXMgb25lIG9uIGRlbGVnYXRvciBiZWZvcmUKICAvLyBkZWxlZ2F0ZU1ldGhvZCB3YXMgY2FsbGVkLCB0aGVuIHRoZSBvcmlnaW5hbCB2ZXJzaW9uCiAgLy8gaXMgaW52b2tlZCBpbnN0ZWFkLgogIC8vIEZvciBleGFtcGxlOgogIC8vCiAgLy8gdmFyIGEgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2ExJyk7IH0KICAvLyAgIG1ldGhvZDI6IGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZygnYTInKTsgfQogIC8vIH07CiAgLy8gdmFyIGIgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2IxJyk7IH0KICAvLyB9OwogIC8vIGRlbGVnYXRlTWV0aG9kKGEsIGIsICJtZXRob2QxIik7CiAgLy8gZGVsZWdhdGVNZXRob2QoYSwgYiwgIm1ldGhvZDIiKTsKICAvLyBhLm1ldGhvZDEoKTsKICAvLyBhLm1ldGhvZDIoKTsKICAvLwogIC8vIFRoZSBvdXRwdXQgd291bGQgYmUgImIxIiwgImEyIi4KICBmdW5jdGlvbiBkZWxlZ2F0ZU1ldGhvZChkZWxlZ2F0b3IsIGRlbGVnYXRlZSwgbWV0aG9kTmFtZSkgewogICAgdmFyIGluaGVyaXRlZCA9IGRlbGVnYXRvclttZXRob2ROYW1lXTsKICAgIGRlbGVnYXRvclttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdGFyZ2V0ID0gZGVsZWdhdGVlOwogICAgICB2YXIgbWV0aG9kID0gZGVsZWdhdGVlW21ldGhvZE5hbWVdOwoKICAgICAgLy8gVGhlIG1ldGhvZCBkb2Vzbid0IGV4aXN0IG9uIHRoZSBkZWxlZ2F0ZWUuIEluc3RlYWQsCiAgICAgIC8vIGNhbGwgdGhlIG1ldGhvZCBvbiB0aGUgZGVsZWdhdG9yLCBpZiBpdCBleGlzdHMuCiAgICAgIGlmICghbWV0aG9kKSB7CiAgICAgICAgdGFyZ2V0ID0gZGVsZWdhdG9yOwogICAgICAgIG1ldGhvZCA9IGluaGVyaXRlZDsKICAgICAgfQoKICAgICAgaWYgKG1ldGhvZCkgewogICAgICAgIHJldHVybiBtZXRob2QuYXBwbHkodGFyZ2V0LCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9OwogIH0KCiAgLy8gSW1wbGVtZW50IGEgdmFndWUgZmFjc2ltaWxpZSBvZiBqUXVlcnkncyBkYXRhIG1ldGhvZAogIGZ1bmN0aW9uIGVsZW1lbnREYXRhKGVsLCBuYW1lLCB2YWx1ZSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikgewogICAgICByZXR1cm4gZWxbImh0bWx3aWRnZXRfZGF0YV8iICsgbmFtZV07CiAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMykgewogICAgICBlbFsiaHRtbHdpZGdldF9kYXRhXyIgKyBuYW1lXSA9IHZhbHVlOwogICAgICByZXR1cm4gZWw7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldyb25nIG51bWJlciBvZiBhcmd1bWVudHMgZm9yIGVsZW1lbnREYXRhOiAiICsKICAgICAgICBhcmd1bWVudHMubGVuZ3RoKTsKICAgIH0KICB9CgogIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzQ0NjE3MC9lc2NhcGUtc3RyaW5nLWZvci11c2UtaW4tamF2YXNjcmlwdC1yZWdleAogIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1wtXFtcXVwvXHtcfVwoXClcKlwrXD9cLlxcXF5cJFx8XS9nLCAiXFwkJiIpOwogIH0KCiAgZnVuY3Rpb24gaGFzQ2xhc3MoZWwsIGNsYXNzTmFtZSkgewogICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgiXFxiIiArIGVzY2FwZVJlZ0V4cChjbGFzc05hbWUpICsgIlxcYiIpOwogICAgcmV0dXJuIHJlLnRlc3QoZWwuY2xhc3NOYW1lKTsKICB9CgogIC8vIGVsZW1lbnRzIC0gYXJyYXkgKG9yIGFycmF5LWxpa2Ugb2JqZWN0KSBvZiBIVE1MIGVsZW1lbnRzCiAgLy8gY2xhc3NOYW1lIC0gY2xhc3MgbmFtZSB0byB0ZXN0IGZvcgogIC8vIGluY2x1ZGUgLSBpZiB0cnVlLCBvbmx5IHJldHVybiBlbGVtZW50cyB3aXRoIGdpdmVuIGNsYXNzTmFtZTsKICAvLyAgIGlmIGZhbHNlLCBvbmx5IHJldHVybiBlbGVtZW50cyAqd2l0aG91dCogZ2l2ZW4gY2xhc3NOYW1lCiAgZnVuY3Rpb24gZmlsdGVyQnlDbGFzcyhlbGVtZW50cywgY2xhc3NOYW1lLCBpbmNsdWRlKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoaGFzQ2xhc3MoZWxlbWVudHNbaV0sIGNsYXNzTmFtZSkgPT0gaW5jbHVkZSkKICAgICAgICByZXN1bHRzLnB1c2goZWxlbWVudHNbaV0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICBmdW5jdGlvbiBvbihvYmosIGV2ZW50TmFtZSwgZnVuYykgewogICAgaWYgKG9iai5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgIG9iai5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuYywgZmFsc2UpOwogICAgfSBlbHNlIGlmIChvYmouYXR0YWNoRXZlbnQpIHsKICAgICAgb2JqLmF0dGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBvZmYob2JqLCBldmVudE5hbWUsIGZ1bmMpIHsKICAgIGlmIChvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcikKICAgICAgb2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jLCBmYWxzZSk7CiAgICBlbHNlIGlmIChvYmouZGV0YWNoRXZlbnQpIHsKICAgICAgb2JqLmRldGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICAvLyBUcmFuc2xhdGUgYXJyYXkgb2YgdmFsdWVzIHRvIHRvcC9yaWdodC9ib3R0b20vbGVmdCwgYXMgdXN1YWwgd2l0aAogIC8vIHRoZSAicGFkZGluZyIgQ1NTIHByb3BlcnR5CiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL3BhZGRpbmcKICBmdW5jdGlvbiB1bnBhY2tQYWRkaW5nKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mKHZhbHVlKSA9PT0gIm51bWJlciIpCiAgICAgIHZhbHVlID0gW3ZhbHVlXTsKICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDEpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMF0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzBdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDIpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDMpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDQpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzNdfTsKICAgIH0KICB9CgogIC8vIENvbnZlcnQgYW4gdW5wYWNrZWQgcGFkZGluZyBvYmplY3QgdG8gYSBDU1MgdmFsdWUKICBmdW5jdGlvbiBwYWRkaW5nVG9Dc3MocGFkZGluZ09iaikgewogICAgcmV0dXJuIHBhZGRpbmdPYmoudG9wICsgInB4ICIgKyBwYWRkaW5nT2JqLnJpZ2h0ICsgInB4ICIgKyBwYWRkaW5nT2JqLmJvdHRvbSArICJweCAiICsgcGFkZGluZ09iai5sZWZ0ICsgInB4IjsKICB9CgogIC8vIE1ha2VzIGEgbnVtYmVyIHN1aXRhYmxlIGZvciBDU1MKICBmdW5jdGlvbiBweCh4KSB7CiAgICBpZiAodHlwZW9mKHgpID09PSAibnVtYmVyIikKICAgICAgcmV0dXJuIHggKyAicHgiOwogICAgZWxzZQogICAgICByZXR1cm4geDsKICB9CgogIC8vIFJldHJpZXZlcyBydW50aW1lIHdpZGdldCBzaXppbmcgaW5mb3JtYXRpb24gZm9yIGFuIGVsZW1lbnQuCiAgLy8gVGhlIHJldHVybiB2YWx1ZSBpcyBlaXRoZXIgbnVsbCwgb3IgYW4gb2JqZWN0IHdpdGggZmlsbCwgcGFkZGluZywKICAvLyBkZWZhdWx0V2lkdGgsIGRlZmF1bHRIZWlnaHQgZmllbGRzLgogIGZ1bmN0aW9uIHNpemluZ1BvbGljeShlbCkgewogICAgdmFyIHNpemluZ0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W2RhdGEtZm9yPSciICsgZWwuaWQgKyAiJ11bdHlwZT0nYXBwbGljYXRpb24vaHRtbHdpZGdldC1zaXppbmcnXSIpOwogICAgaWYgKCFzaXppbmdFbCkKICAgICAgcmV0dXJuIG51bGw7CiAgICB2YXIgc3AgPSBKU09OLnBhcnNlKHNpemluZ0VsLnRleHRDb250ZW50IHx8IHNpemluZ0VsLnRleHQgfHwgInt9Iik7CiAgICBpZiAodmlld2VyTW9kZSkgewogICAgICByZXR1cm4gc3Audmlld2VyOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHNwLmJyb3dzZXI7CiAgICB9CiAgfQoKICAvLyBAcGFyYW0gdGFza3MgQXJyYXkgb2Ygc3RyaW5ncyAob3IgZmFsc3kgdmFsdWUsIGluIHdoaWNoIGNhc2Ugbm8tb3ApLgogIC8vICAgRWFjaCBlbGVtZW50IG11c3QgYmUgYSB2YWxpZCBKYXZhU2NyaXB0IGV4cHJlc3Npb24gdGhhdCB5aWVsZHMgYQogIC8vICAgZnVuY3Rpb24uIE9yLCBjYW4gYmUgYW4gYXJyYXkgb2Ygb2JqZWN0cyB3aXRoICJjb2RlIiBhbmQgImRhdGEiCiAgLy8gICBwcm9wZXJ0aWVzOyBpbiB0aGlzIGNhc2UsIHRoZSAiY29kZSIgcHJvcGVydHkgc2hvdWxkIGJlIGEgc3RyaW5nCiAgLy8gICBvZiBKUyB0aGF0J3MgYW4gZXhwciB0aGF0IHlpZWxkcyBhIGZ1bmN0aW9uLCBhbmQgImRhdGEiIHNob3VsZCBiZQogIC8vICAgYW4gb2JqZWN0IHRoYXQgd2lsbCBiZSBhZGRlZCBhcyBhbiBhZGRpdGlvbmFsIGFyZ3VtZW50IHdoZW4gdGhhdAogIC8vICAgZnVuY3Rpb24gaXMgY2FsbGVkLgogIC8vIEBwYXJhbSB0YXJnZXQgVGhlIG9iamVjdCB0aGF0IHdpbGwgYmUgInRoaXMiIGZvciBlYWNoIGZ1bmN0aW9uCiAgLy8gICBleGVjdXRpb24uCiAgLy8gQHBhcmFtIGFyZ3MgQXJyYXkgb2YgYXJndW1lbnRzIHRvIGJlIHBhc3NlZCB0byB0aGUgZnVuY3Rpb25zLiAoVGhlCiAgLy8gICBzYW1lIGFyZ3VtZW50cyB3aWxsIGJlIHBhc3NlZCB0byBhbGwgZnVuY3Rpb25zLikKICBmdW5jdGlvbiBldmFsQW5kUnVuKHRhc2tzLCB0YXJnZXQsIGFyZ3MpIHsKICAgIGlmICh0YXNrcykgewogICAgICBmb3JFYWNoKHRhc2tzLCBmdW5jdGlvbih0YXNrKSB7CiAgICAgICAgdmFyIHRoZXNlQXJncyA9IGFyZ3M7CiAgICAgICAgaWYgKHR5cGVvZih0YXNrKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgIHRoZXNlQXJncyA9IHRoZXNlQXJncy5jb25jYXQoW3Rhc2suZGF0YV0pOwogICAgICAgICAgdGFzayA9IHRhc2suY29kZTsKICAgICAgICB9CiAgICAgICAgdmFyIHRhc2tGdW5jID0gdHJ5RXZhbCh0YXNrKTsKICAgICAgICBpZiAodHlwZW9mKHRhc2tGdW5jKSAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUYXNrIG11c3QgYmUgYSBmdW5jdGlvbiEgU291cmNlOlxuIiArIHRhc2spOwogICAgICAgIH0KICAgICAgICB0YXNrRnVuYy5hcHBseSh0YXJnZXQsIHRoZXNlQXJncyk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgLy8gQXR0ZW1wdCBldmFsKCkgYm90aCB3aXRoIGFuZCB3aXRob3V0IGVuY2xvc2luZyBpbiBwYXJlbnRoZXNlcy4KICAvLyBOb3RlIHRoYXQgZW5jbG9zaW5nIGNvZXJjZXMgYSBmdW5jdGlvbiBkZWNsYXJhdGlvbiBpbnRvCiAgLy8gYW4gZXhwcmVzc2lvbiB0aGF0IGV2YWwoKSBjYW4gcGFyc2UKICAvLyAob3RoZXJ3aXNlLCBhIFN5bnRheEVycm9yIGlzIHRocm93bikKICBmdW5jdGlvbiB0cnlFdmFsKGNvZGUpIHsKICAgIHZhciByZXN1bHQgPSBudWxsOwogICAgdHJ5IHsKICAgICAgcmVzdWx0ID0gZXZhbChjb2RlKTsKICAgIH0gY2F0Y2goZXJyb3IpIHsKICAgICAgaWYgKCFlcnJvciBpbnN0YW5jZW9mIFN5bnRheEVycm9yKSB7CiAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgIH0KICAgICAgdHJ5IHsKICAgICAgICByZXN1bHQgPSBldmFsKCIoIiArIGNvZGUgKyAiKSIpOwogICAgICB9IGNhdGNoKGUpIHsKICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFN5bnRheEVycm9yKSB7CiAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICBmdW5jdGlvbiBpbml0U2l6aW5nKGVsKSB7CiAgICB2YXIgc2l6aW5nID0gc2l6aW5nUG9saWN5KGVsKTsKICAgIGlmICghc2l6aW5nKQogICAgICByZXR1cm47CgogICAgdmFyIGNlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJodG1sd2lkZ2V0X2NvbnRhaW5lciIpOwogICAgaWYgKCFjZWwpCiAgICAgIHJldHVybjsKCiAgICBpZiAodHlwZW9mKHNpemluZy5wYWRkaW5nKSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5tYXJnaW4gPSAiMCI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUucGFkZGluZyA9IHBhZGRpbmdUb0Nzcyh1bnBhY2tQYWRkaW5nKHNpemluZy5wYWRkaW5nKSk7CiAgICB9CgogICAgaWYgKHNpemluZy5maWxsKSB7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAiaGlkZGVuIjsKICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS53aWR0aCA9ICIxMDAlIjsKICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS53aWR0aCA9ICIxMDAlIjsKICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLmhlaWdodCA9ICIxMDAlIjsKICAgICAgaWYgKGNlbCkgewogICAgICAgIGNlbC5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CiAgICAgICAgdmFyIHBhZCA9IHVucGFja1BhZGRpbmcoc2l6aW5nLnBhZGRpbmcpOwogICAgICAgIGNlbC5zdHlsZS50b3AgPSBwYWQudG9wICsgInB4IjsKICAgICAgICBjZWwuc3R5bGUucmlnaHQgPSBwYWQucmlnaHQgKyAicHgiOwogICAgICAgIGNlbC5zdHlsZS5ib3R0b20gPSBwYWQuYm90dG9tICsgInB4IjsKICAgICAgICBjZWwuc3R5bGUubGVmdCA9IHBhZC5sZWZ0ICsgInB4IjsKICAgICAgICBlbC5zdHlsZS53aWR0aCA9ICIxMDAlIjsKICAgICAgICBlbC5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgZ2V0V2lkdGg6IGZ1bmN0aW9uKCkgeyByZXR1cm4gY2VsLm9mZnNldFdpZHRoOyB9LAogICAgICAgIGdldEhlaWdodDogZnVuY3Rpb24oKSB7IHJldHVybiBjZWwub2Zmc2V0SGVpZ2h0OyB9CiAgICAgIH07CgogICAgfSBlbHNlIHsKICAgICAgZWwuc3R5bGUud2lkdGggPSBweChzaXppbmcud2lkdGgpOwogICAgICBlbC5zdHlsZS5oZWlnaHQgPSBweChzaXppbmcuaGVpZ2h0KTsKCiAgICAgIHJldHVybiB7CiAgICAgICAgZ2V0V2lkdGg6IGZ1bmN0aW9uKCkgeyByZXR1cm4gZWwub2Zmc2V0V2lkdGg7IH0sCiAgICAgICAgZ2V0SGVpZ2h0OiBmdW5jdGlvbigpIHsgcmV0dXJuIGVsLm9mZnNldEhlaWdodDsgfQogICAgICB9OwogICAgfQogIH0KCiAgLy8gRGVmYXVsdCBpbXBsZW1lbnRhdGlvbnMgZm9yIG1ldGhvZHMKICB2YXIgZGVmYXVsdHMgPSB7CiAgICBmaW5kOiBmdW5jdGlvbihzY29wZSkgewogICAgICByZXR1cm4gcXVlcnlTZWxlY3RvckFsbChzY29wZSwgIi4iICsgdGhpcy5uYW1lKTsKICAgIH0sCiAgICByZW5kZXJFcnJvcjogZnVuY3Rpb24oZWwsIGVycikgewogICAgICB2YXIgJGVsID0gJChlbCk7CgogICAgICB0aGlzLmNsZWFyRXJyb3IoZWwpOwoKICAgICAgLy8gQWRkIGFsbCB0aGVzZSBlcnJvciBjbGFzc2VzLCBhcyBTaGlueSBkb2VzCiAgICAgIHZhciBlcnJDbGFzcyA9ICJzaGlueS1vdXRwdXQtZXJyb3IiOwogICAgICBpZiAoZXJyLnR5cGUgIT09IG51bGwpIHsKICAgICAgICAvLyB1c2UgdGhlIGNsYXNzZXMgb2YgdGhlIGVycm9yIGNvbmRpdGlvbiBhcyBDU1MgY2xhc3MgbmFtZXMKICAgICAgICBlcnJDbGFzcyA9IGVyckNsYXNzICsgIiAiICsgJC5tYXAoYXNBcnJheShlcnIudHlwZSksIGZ1bmN0aW9uKHR5cGUpIHsKICAgICAgICAgIHJldHVybiBlcnJDbGFzcyArICItIiArIHR5cGU7CiAgICAgICAgfSkuam9pbigiICIpOwogICAgICB9CiAgICAgIGVyckNsYXNzID0gZXJyQ2xhc3MgKyAiIGh0bWx3aWRnZXRzLWVycm9yIjsKCiAgICAgIC8vIElzIGVsIGlubGluZSBvciBibG9jaz8gSWYgaW5saW5lIG9yIGlubGluZS1ibG9jaywganVzdCBkaXNwbGF5Om5vbmUgaXQKICAgICAgLy8gYW5kIGFkZCBhbiBpbmxpbmUgZXJyb3IuCiAgICAgIHZhciBkaXNwbGF5ID0gJGVsLmNzcygiZGlzcGxheSIpOwogICAgICAkZWwuZGF0YSgicmVzdG9yZS1kaXNwbGF5LW1vZGUiLCBkaXNwbGF5KTsKCiAgICAgIGlmIChkaXNwbGF5ID09PSAiaW5saW5lIiB8fCBkaXNwbGF5ID09PSAiaW5saW5lLWJsb2NrIikgewogICAgICAgICRlbC5oaWRlKCk7CiAgICAgICAgaWYgKGVyci5tZXNzYWdlICE9PSAiIikgewogICAgICAgICAgdmFyIGVycm9yU3BhbiA9ICQoIjxzcGFuPiIpLmFkZENsYXNzKGVyckNsYXNzKTsKICAgICAgICAgIGVycm9yU3Bhbi50ZXh0KGVyci5tZXNzYWdlKTsKICAgICAgICAgICRlbC5hZnRlcihlcnJvclNwYW4pOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChkaXNwbGF5ID09PSAiYmxvY2siKSB7CiAgICAgICAgLy8gSWYgYmxvY2ssIGFkZCBhbiBlcnJvciBqdXN0IGFmdGVyIHRoZSBlbCwgc2V0IHZpc2liaWxpdHk6bm9uZSBvbiB0aGUKICAgICAgICAvLyBlbCwgYW5kIHBvc2l0aW9uIHRoZSBlcnJvciB0byBiZSBvbiB0b3Agb2YgdGhlIGVsLgogICAgICAgIC8vIE1hcmsgaXQgd2l0aCBhIHVuaXF1ZSBJRCBhbmQgQ1NTIGNsYXNzIHNvIHdlIGNhbiByZW1vdmUgaXQgbGF0ZXIuCiAgICAgICAgJGVsLmNzcygidmlzaWJpbGl0eSIsICJoaWRkZW4iKTsKICAgICAgICBpZiAoZXJyLm1lc3NhZ2UgIT09ICIiKSB7CiAgICAgICAgICB2YXIgZXJyb3JEaXYgPSAkKCI8ZGl2PiIpLmFkZENsYXNzKGVyckNsYXNzKS5jc3MoInBvc2l0aW9uIiwgImFic29sdXRlIikKICAgICAgICAgICAgLmNzcygidG9wIiwgZWwub2Zmc2V0VG9wKQogICAgICAgICAgICAuY3NzKCJsZWZ0IiwgZWwub2Zmc2V0TGVmdCkKICAgICAgICAgICAgLy8gc2V0dGluZyB3aWR0aCBjYW4gcHVzaCBvdXQgdGhlIHBhZ2Ugc2l6ZSwgZm9yY2luZyBvdGhlcndpc2UKICAgICAgICAgICAgLy8gdW5uZWNlc3Nhcnkgc2Nyb2xsYmFycyB0byBhcHBlYXIgYW5kIG1ha2luZyBpdCBpbXBvc3NpYmxlIGZvcgogICAgICAgICAgICAvLyB0aGUgZWxlbWVudCB0byBzaHJpbms7IHNvIHVzZSBtYXgtd2lkdGggaW5zdGVhZAogICAgICAgICAgICAuY3NzKCJtYXhXaWR0aCIsIGVsLm9mZnNldFdpZHRoKQogICAgICAgICAgICAuY3NzKCJoZWlnaHQiLCBlbC5vZmZzZXRIZWlnaHQpOwogICAgICAgICAgZXJyb3JEaXYudGV4dChlcnIubWVzc2FnZSk7CiAgICAgICAgICAkZWwuYWZ0ZXIoZXJyb3JEaXYpOwoKICAgICAgICAgIC8vIFJlYWxseSBkdW1iIHdheSB0byBrZWVwIHRoZSBzaXplL3Bvc2l0aW9uIG9mIHRoZSBlcnJvciBpbiBzeW5jIHdpdGgKICAgICAgICAgIC8vIHRoZSBwYXJlbnQgZWxlbWVudCBhcyB0aGUgd2luZG93IGlzIHJlc2l6ZWQgb3Igd2hhdGV2ZXIuCiAgICAgICAgICB2YXIgaW50SWQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKCFlcnJvckRpdlswXS5wYXJlbnRFbGVtZW50KSB7CiAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRJZCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVycm9yRGl2CiAgICAgICAgICAgICAgLmNzcygidG9wIiwgZWwub2Zmc2V0VG9wKQogICAgICAgICAgICAgIC5jc3MoImxlZnQiLCBlbC5vZmZzZXRMZWZ0KQogICAgICAgICAgICAgIC5jc3MoIm1heFdpZHRoIiwgZWwub2Zmc2V0V2lkdGgpCiAgICAgICAgICAgICAgLmNzcygiaGVpZ2h0IiwgZWwub2Zmc2V0SGVpZ2h0KTsKICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgY2xlYXJFcnJvcjogZnVuY3Rpb24oZWwpIHsKICAgICAgdmFyICRlbCA9ICQoZWwpOwogICAgICB2YXIgZGlzcGxheSA9ICRlbC5kYXRhKCJyZXN0b3JlLWRpc3BsYXktbW9kZSIpOwogICAgICAkZWwuZGF0YSgicmVzdG9yZS1kaXNwbGF5LW1vZGUiLCBudWxsKTsKCiAgICAgIGlmIChkaXNwbGF5ID09PSAiaW5saW5lIiB8fCBkaXNwbGF5ID09PSAiaW5saW5lLWJsb2NrIikgewogICAgICAgIGlmIChkaXNwbGF5KQogICAgICAgICAgJGVsLmNzcygiZGlzcGxheSIsIGRpc3BsYXkpOwogICAgICAgICQoZWwubmV4dFNpYmxpbmcpLmZpbHRlcigiLmh0bWx3aWRnZXRzLWVycm9yIikucmVtb3ZlKCk7CiAgICAgIH0gZWxzZSBpZiAoZGlzcGxheSA9PT0gImJsb2NrIil7CiAgICAgICAgJGVsLmNzcygidmlzaWJpbGl0eSIsICJpbmhlcml0Iik7CiAgICAgICAgJChlbC5uZXh0U2libGluZykuZmlsdGVyKCIuaHRtbHdpZGdldHMtZXJyb3IiKS5yZW1vdmUoKTsKICAgICAgfQogICAgfSwKICAgIHNpemluZzoge30KICB9OwoKICAvLyBDYWxsZWQgYnkgd2lkZ2V0IGJpbmRpbmdzIHRvIHJlZ2lzdGVyIGEgbmV3IHR5cGUgb2Ygd2lkZ2V0LiBUaGUgZGVmaW5pdGlvbgogIC8vIG9iamVjdCBjYW4gY29udGFpbiB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CiAgLy8gLSBuYW1lIChyZXF1aXJlZCkgLSBBIHN0cmluZyBpbmRpY2F0aW5nIHRoZSBiaW5kaW5nIG5hbWUsIHdoaWNoIHdpbGwgYmUKICAvLyAgIHVzZWQgYnkgZGVmYXVsdCBhcyB0aGUgQ1NTIGNsYXNzbmFtZSB0byBsb29rIGZvci4KICAvLyAtIGluaXRpYWxpemUgKG9wdGlvbmFsKSAtIEEgZnVuY3Rpb24oZWwpIHRoYXQgd2lsbCBiZSBjYWxsZWQgb25jZSBwZXIKICAvLyAgIHdpZGdldCBlbGVtZW50OyBpZiBhIHZhbHVlIGlzIHJldHVybmVkLCBpdCB3aWxsIGJlIHBhc3NlZCBhcyB0aGUgdGhpcmQKICAvLyAgIHZhbHVlIHRvIHJlbmRlclZhbHVlLgogIC8vIC0gcmVuZGVyVmFsdWUgKHJlcXVpcmVkKSAtIEEgZnVuY3Rpb24oZWwsIGRhdGEsIGluaXRWYWx1ZSkgdGhhdCB3aWxsIGJlCiAgLy8gICBjYWxsZWQgd2l0aCBkYXRhLiBTdGF0aWMgY29udGV4dHMgd2lsbCBjYXVzZSB0aGlzIHRvIGJlIGNhbGxlZCBvbmNlIHBlcgogIC8vICAgZWxlbWVudDsgU2hpbnkgYXBwcyB3aWxsIGNhdXNlIHRoaXMgdG8gYmUgY2FsbGVkIG11bHRpcGxlIHRpbWVzIHBlcgogIC8vICAgZWxlbWVudCwgYXMgdGhlIGRhdGEgY2hhbmdlcy4KICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0ID0gZnVuY3Rpb24oZGVmaW5pdGlvbikgewogICAgaWYgKCFkZWZpbml0aW9uLm5hbWUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJXaWRnZXQgbXVzdCBoYXZlIGEgbmFtZSIpOwogICAgfQogICAgaWYgKCFkZWZpbml0aW9uLnR5cGUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJXaWRnZXQgbXVzdCBoYXZlIGEgdHlwZSIpOwogICAgfQogICAgLy8gQ3VycmVudGx5IHdlIG9ubHkgc3VwcG9ydCBvdXRwdXQgd2lkZ2V0cwogICAgaWYgKGRlZmluaXRpb24udHlwZSAhPT0gIm91dHB1dCIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbnJlY29nbml6ZWQgd2lkZ2V0IHR5cGUgJyIgKyBkZWZpbml0aW9uLnR5cGUgKyAiJyIpOwogICAgfQogICAgLy8gVE9ETzogVmVyaWZ5IHRoYXQgLm5hbWUgaXMgYSB2YWxpZCBDU1MgY2xhc3NuYW1lCgogICAgLy8gU3VwcG9ydCBuZXctc3R5bGUgaW5zdGFuY2UtYm91bmQgZGVmaW5pdGlvbnMuIE9sZC1zdHlsZSBjbGFzcy1ib3VuZAogICAgLy8gZGVmaW5pdGlvbnMgaGF2ZSBvbmUgd2lkZ2V0ICJvYmplY3QiIHBlciB3aWRnZXQgcGVyIHR5cGUvY2xhc3Mgb2YKICAgIC8vIHdpZGdldDsgdGhlIHJlbmRlclZhbHVlIGFuZCByZXNpemUgbWV0aG9kcyBvbiBzdWNoIHdpZGdldCBvYmplY3RzCiAgICAvLyB0YWtlIGVsIGFuZCBpbnN0YW5jZSBhcmd1bWVudHMsIGJlY2F1c2UgdGhlIHdpZGdldCBvYmplY3QgY2FuJ3QKICAgIC8vIHN0b3JlIHRoZW0uIE5ldy1zdHlsZSBpbnN0YW5jZS1ib3VuZCBkZWZpbml0aW9ucyBoYXZlIG9uZSB3aWRnZXQKICAgIC8vIG9iamVjdCBwZXIgd2lkZ2V0IGluc3RhbmNlOyB0aGUgZGVmaW5pdGlvbiB0aGF0J3MgcGFzc2VkIGluIGRvZXNuJ3QKICAgIC8vIHByb3ZpZGUgcmVuZGVyVmFsdWUgb3IgcmVzaXplIG1ldGhvZHMgYXQgYWxsLCBqdXN0IHRoZSBzaW5nbGUgbWV0aG9kCiAgICAvLyAgIGZhY3RvcnkoZWwsIHdpZHRoLCBoZWlnaHQpCiAgICAvLyB3aGljaCByZXR1cm5zIGFuIG9iamVjdCB0aGF0IGhhcyByZW5kZXJWYWx1ZSh4KSBhbmQgcmVzaXplKHcsIGgpLgogICAgLy8gVGhpcyBlbmFibGVzIGEgZmFyIG1vcmUgbmF0dXJhbCBwcm9ncmFtbWluZyBzdHlsZSBmb3IgdGhlIHdpZGdldAogICAgLy8gYXV0aG9yLCB3aG8gY2FuIHN0b3JlIHBlci1pbnN0YW5jZSBzdGF0ZSB1c2luZyBlaXRoZXIgT08tc3R5bGUKICAgIC8vIGluc3RhbmNlIGZpZWxkcyBvciBmdW5jdGlvbmFsLXN0eWxlIGNsb3N1cmUgdmFyaWFibGVzIChJIGd1ZXNzIHRoaXMKICAgIC8vIGlzIGluIGNvbnRyYXN0IHRvIHdoYXQgY2FuIG9ubHkgYmUgY2FsbGVkIEMtc3R5bGUgcHNldWRvLU9PIHdoaWNoIGlzCiAgICAvLyB3aGF0IHdlIHJlcXVpcmVkIGJlZm9yZSkuCiAgICBpZiAoZGVmaW5pdGlvbi5mYWN0b3J5KSB7CiAgICAgIGRlZmluaXRpb24gPSBjcmVhdGVMZWdhY3lEZWZpbml0aW9uQWRhcHRlcihkZWZpbml0aW9uKTsKICAgIH0KCiAgICBpZiAoIWRlZmluaXRpb24ucmVuZGVyVmFsdWUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJXaWRnZXQgbXVzdCBoYXZlIGEgcmVuZGVyVmFsdWUgZnVuY3Rpb24iKTsKICAgIH0KCiAgICAvLyBGb3Igc3RhdGljIHJlbmRlcmluZyAobm9uLVNoaW55KSwgdXNlIGEgc2ltcGxlIHdpZGdldCByZWdpc3RyYXRpb24KICAgIC8vIHNjaGVtZS4gV2UgYWxzbyB1c2UgdGhpcyBzY2hlbWUgZm9yIFNoaW55IGFwcHMvZG9jdW1lbnRzIHRoYXQgYWxzbwogICAgLy8gY29udGFpbiBzdGF0aWMgd2lkZ2V0cy4KICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzID0gd2luZG93LkhUTUxXaWRnZXRzLndpZGdldHMgfHwgW107CiAgICAvLyBNZXJnZSBkZWZhdWx0cyBpbnRvIHRoZSBkZWZpbml0aW9uOyBkb24ndCBtdXRhdGUgdGhlIG9yaWdpbmFsIGRlZmluaXRpb24uCiAgICB2YXIgc3RhdGljQmluZGluZyA9IGV4dGVuZCh7fSwgZGVmYXVsdHMsIGRlZmluaXRpb24pOwogICAgb3ZlcnJpZGVNZXRob2Qoc3RhdGljQmluZGluZywgImZpbmQiLCBmdW5jdGlvbihzdXBlcmZ1bmMpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNjb3BlKSB7CiAgICAgICAgdmFyIHJlc3VsdHMgPSBzdXBlcmZ1bmMoc2NvcGUpOwogICAgICAgIC8vIEZpbHRlciBvdXQgU2hpbnkgb3V0cHV0cywgd2Ugb25seSB3YW50IHRoZSBzdGF0aWMga2luZAogICAgICAgIHJldHVybiBmaWx0ZXJCeUNsYXNzKHJlc3VsdHMsICJodG1sLXdpZGdldC1vdXRwdXQiLCBmYWxzZSk7CiAgICAgIH07CiAgICB9KTsKICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzLnB1c2goc3RhdGljQmluZGluZyk7CgogICAgaWYgKHNoaW55TW9kZSkgewogICAgICAvLyBTaGlueSBpcyBydW5uaW5nLiBSZWdpc3RlciB0aGUgZGVmaW5pdGlvbiB3aXRoIGFuIG91dHB1dCBiaW5kaW5nLgogICAgICAvLyBUaGUgZGVmaW5pdGlvbiBpdHNlbGYgd2lsbCBub3QgYmUgdGhlIG91dHB1dCBiaW5kaW5nLCBpbnN0ZWFkCiAgICAgIC8vIHdlIHdpbGwgbWFrZSBhbiBvdXRwdXQgYmluZGluZyBvYmplY3QgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlCiAgICAgIC8vIGRlZmluaXRpb24uIFRoaXMgaXMgYmVjYXVzZSB3ZSBmb29saXNobHkgdXNlZCB0aGUgc2FtZSBtZXRob2QKICAgICAgLy8gbmFtZSAocmVuZGVyVmFsdWUpIGZvciBodG1sd2lkZ2V0cyBkZWZpbml0aW9uIGFuZCBTaGlueSBiaW5kaW5ncwogICAgICAvLyBidXQgdGhleSBhY3R1YWxseSBoYXZlIHF1aXRlIGRpZmZlcmVudCBzZW1hbnRpY3MgKHRoZSBTaGlueQogICAgICAvLyBiaW5kaW5ncyByZWNlaXZlIGRhdGEgdGhhdCBpbmNsdWRlcyBsb3RzIG9mIG1ldGFkYXRhIHRoYXQgaXQKICAgICAgLy8gc3RyaXBzIG9mZiBiZWZvcmUgY2FsbGluZyBodG1sd2lkZ2V0cyByZW5kZXJWYWx1ZSkuIFdlIGNhbid0CiAgICAgIC8vIGp1c3QgaWdub3JlIHRoZSBkaWZmZXJlbmNlIGJlY2F1c2UgaW4gc29tZSB3aWRnZXRzIGl0J3MgaGVscGZ1bAogICAgICAvLyB0byBjYWxsIHRoaXMucmVuZGVyVmFsdWUoKSBmcm9tIGluc2lkZSBvZiByZXNpemUoKSwgYW5kIGlmCiAgICAgIC8vIHdlJ3JlIG5vdCBkZWxlZ2F0aW5nLCB0aGVuIHRoYXQgY2FsbCB3aWxsIGdvIHRvIHRoZSBTaGlueQogICAgICAvLyB2ZXJzaW9uIGluc3RlYWQgb2YgdGhlIGh0bWx3aWRnZXRzIHZlcnNpb24uCgogICAgICAvLyBNZXJnZSBkZWZhdWx0cyB3aXRoIGRlZmluaXRpb24sIHdpdGhvdXQgbXV0YXRpbmcgZWl0aGVyLgogICAgICB2YXIgYmluZGluZ0RlZiA9IGV4dGVuZCh7fSwgZGVmYXVsdHMsIGRlZmluaXRpb24pOwoKICAgICAgLy8gVGhpcyBvYmplY3Qgd2lsbCBiZSBvdXIgYWN0dWFsIFNoaW55IGJpbmRpbmcuCiAgICAgIHZhciBzaGlueUJpbmRpbmcgPSBuZXcgU2hpbnkuT3V0cHV0QmluZGluZygpOwoKICAgICAgLy8gV2l0aCBhIGZldyBleGNlcHRpb25zLCB3ZSdsbCB3YW50IHRvIHNpbXBseSB1c2UgdGhlIGJpbmRpbmdEZWYncwogICAgICAvLyB2ZXJzaW9uIG9mIG1ldGhvZHMgaWYgdGhleSBhcmUgYXZhaWxhYmxlLCBvdGhlcndpc2UgZmFsbCBiYWNrIHRvCiAgICAgIC8vIFNoaW55J3MgZGVmYXVsdHMuIE5PVEU6IElmIFNoaW55J3Mgb3V0cHV0IGJpbmRpbmdzIGdhaW4gYWRkaXRpb25hbAogICAgICAvLyBtZXRob2RzIGluIHRoZSBmdXR1cmUsIGFuZCB3ZSB3YW50IHRoZW0gdG8gYmUgb3ZlcnJpZGVhYmxlIGJ5CiAgICAgIC8vIEhUTUxXaWRnZXQgYmluZGluZyBkZWZpbml0aW9ucywgdGhlbiB3ZSdsbCBuZWVkIHRvIGFkZCB0aGVtIHRvIHRoaXMKICAgICAgLy8gbGlzdC4KICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAiZ2V0SWQiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAib25WYWx1ZUNoYW5nZSIpOwogICAgICBkZWxlZ2F0ZU1ldGhvZChzaGlueUJpbmRpbmcsIGJpbmRpbmdEZWYsICJvblZhbHVlRXJyb3IiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAicmVuZGVyRXJyb3IiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAiY2xlYXJFcnJvciIpOwogICAgICBkZWxlZ2F0ZU1ldGhvZChzaGlueUJpbmRpbmcsIGJpbmRpbmdEZWYsICJzaG93UHJvZ3Jlc3MiKTsKCiAgICAgIC8vIFRoZSBmaW5kLCByZW5kZXJWYWx1ZSwgYW5kIHJlc2l6ZSBhcmUgaGFuZGxlZCBkaWZmZXJlbnRseSwgYmVjYXVzZSB3ZQogICAgICAvLyB3YW50IHRvIGFjdHVhbGx5IGRlY29yYXRlIHRoZSBiZWhhdmlvciBvZiB0aGUgYmluZGluZ0RlZiBtZXRob2RzLgoKICAgICAgc2hpbnlCaW5kaW5nLmZpbmQgPSBmdW5jdGlvbihzY29wZSkgewogICAgICAgIHZhciByZXN1bHRzID0gYmluZGluZ0RlZi5maW5kKHNjb3BlKTsKCiAgICAgICAgLy8gT25seSByZXR1cm4gZWxlbWVudHMgdGhhdCBhcmUgU2hpbnkgb3V0cHV0cywgbm90IHN0YXRpYyBvbmVzCiAgICAgICAgdmFyIGR5bmFtaWNSZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoIi5odG1sLXdpZGdldC1vdXRwdXQiKTsKCiAgICAgICAgLy8gSXQncyBwb3NzaWJsZSB0aGF0IHdoYXRldmVyIGNhdXNlZCBTaGlueSB0byB0aGluayB0aGVyZSBtaWdodCBiZQogICAgICAgIC8vIG5ldyBkeW5hbWljIG91dHB1dHMsIGFsc28gY2F1c2VkIHRoZXJlIHRvIGJlIG5ldyBzdGF0aWMgb3V0cHV0cy4KICAgICAgICAvLyBTaW5jZSB0aGVyZSBtaWdodCBiZSBsb3RzIG9mIGRpZmZlcmVudCBodG1sd2lkZ2V0cyBiaW5kaW5ncywgd2UKICAgICAgICAvLyBzY2hlZHVsZSBleGVjdXRpb24gZm9yIGxhdGVyLS1ubyBuZWVkIHRvIHN0YXRpY1JlbmRlciBtdWx0aXBsZQogICAgICAgIC8vIHRpbWVzLgogICAgICAgIGlmIChyZXN1bHRzLmxlbmd0aCAhPT0gZHluYW1pY1Jlc3VsdHMubGVuZ3RoKQogICAgICAgICAgc2NoZWR1bGVTdGF0aWNSZW5kZXIoKTsKCiAgICAgICAgcmV0dXJuIGR5bmFtaWNSZXN1bHRzOwogICAgICB9OwoKICAgICAgLy8gV3JhcCByZW5kZXJWYWx1ZSB0byBoYW5kbGUgaW5pdGlhbGl6YXRpb24sIHdoaWNoIHVuZm9ydHVuYXRlbHkgaXNuJ3QKICAgICAgLy8gc3VwcG9ydGVkIG5hdGl2ZWx5IGJ5IFNoaW55IGF0IHRoZSB0aW1lIG9mIHRoaXMgd3JpdGluZy4KCiAgICAgIHNoaW55QmluZGluZy5yZW5kZXJWYWx1ZSA9IGZ1bmN0aW9uKGVsLCBkYXRhKSB7CiAgICAgICAgU2hpbnkucmVuZGVyRGVwZW5kZW5jaWVzKGRhdGEuZGVwcyk7CiAgICAgICAgLy8gUmVzb2x2ZSBzdHJpbmdzIG1hcmtlZCBhcyBqYXZhc2NyaXB0IGxpdGVyYWxzIHRvIG9iamVjdHMKICAgICAgICBpZiAoIShkYXRhLmV2YWxzIGluc3RhbmNlb2YgQXJyYXkpKSBkYXRhLmV2YWxzID0gW2RhdGEuZXZhbHNdOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBkYXRhLmV2YWxzICYmIGkgPCBkYXRhLmV2YWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB3aW5kb3cuSFRNTFdpZGdldHMuZXZhbHVhdGVTdHJpbmdNZW1iZXIoZGF0YS54LCBkYXRhLmV2YWxzW2ldKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFiaW5kaW5nRGVmLnJlbmRlck9uTnVsbFZhbHVlKSB7CiAgICAgICAgICBpZiAoZGF0YS54ID09PSBudWxsKSB7CiAgICAgICAgICAgIGVsLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZWwuc3R5bGUudmlzaWJpbGl0eSA9ICJpbmhlcml0IjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIikpIHsKICAgICAgICAgIGluaXRTaXppbmcoZWwpOwoKICAgICAgICAgIGVsZW1lbnREYXRhKGVsLCAiaW5pdGlhbGl6ZWQiLCB0cnVlKTsKICAgICAgICAgIGlmIChiaW5kaW5nRGVmLmluaXRpYWxpemUpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGJpbmRpbmdEZWYuaW5pdGlhbGl6ZShlbCwgZWwub2Zmc2V0V2lkdGgsCiAgICAgICAgICAgICAgZWwub2Zmc2V0SGVpZ2h0KTsKICAgICAgICAgICAgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIsIHJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGJpbmRpbmdEZWYucmVuZGVyVmFsdWUoZWwsIGRhdGEueCwgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpKTsKICAgICAgICBldmFsQW5kUnVuKGRhdGEuanNIb29rcy5yZW5kZXIsIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiKSwgW2VsLCBkYXRhLnhdKTsKICAgICAgfTsKCiAgICAgIC8vIE9ubHkgb3ZlcnJpZGUgcmVzaXplIGlmIGJpbmRpbmdEZWYgaW1wbGVtZW50cyBpdAogICAgICBpZiAoYmluZGluZ0RlZi5yZXNpemUpIHsKICAgICAgICBzaGlueUJpbmRpbmcucmVzaXplID0gZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgIC8vIFNoaW55IGNhbiBjYWxsIHJlc2l6ZSBiZWZvcmUgaW5pdGlhbGl6ZS9yZW5kZXJWYWx1ZSBoYXZlIGJlZW4KICAgICAgICAgIC8vIGNhbGxlZCwgd2hpY2ggZG9lc24ndCBtYWtlIHNlbnNlIGZvciB3aWRnZXRzLgogICAgICAgICAgaWYgKGVsZW1lbnREYXRhKGVsLCAiaW5pdGlhbGl6ZWQiKSkgewogICAgICAgICAgICBiaW5kaW5nRGVmLnJlc2l6ZShlbCwgd2lkdGgsIGhlaWdodCwgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CgogICAgICBTaGlueS5vdXRwdXRCaW5kaW5ncy5yZWdpc3RlcihzaGlueUJpbmRpbmcsIGJpbmRpbmdEZWYubmFtZSk7CiAgICB9CiAgfTsKCiAgdmFyIHNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCA9IG51bGw7CiAgZnVuY3Rpb24gc2NoZWR1bGVTdGF0aWNSZW5kZXIoKSB7CiAgICBpZiAoIXNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCkgewogICAgICBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCA9IG51bGw7CiAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpOwogICAgICB9LCAxKTsKICAgIH0KICB9CgogIC8vIFJlbmRlciBzdGF0aWMgd2lkZ2V0cyBhZnRlciB0aGUgZG9jdW1lbnQgZmluaXNoZXMgbG9hZGluZwogIC8vIFN0YXRpY2FsbHkgcmVuZGVyIGFsbCBlbGVtZW50cyB0aGF0IGFyZSBvZiB0aGlzIHdpZGdldCdzIGNsYXNzCiAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlciA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGJpbmRpbmdzID0gd2luZG93LkhUTUxXaWRnZXRzLndpZGdldHMgfHwgW107CiAgICBmb3JFYWNoKGJpbmRpbmdzLCBmdW5jdGlvbihiaW5kaW5nKSB7CiAgICAgIHZhciBtYXRjaGVzID0gYmluZGluZy5maW5kKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7CiAgICAgIGZvckVhY2gobWF0Y2hlcywgZnVuY3Rpb24oZWwpIHsKICAgICAgICB2YXIgc2l6ZU9iaiA9IGluaXRTaXppbmcoZWwsIGJpbmRpbmcpOwoKICAgICAgICBpZiAoaGFzQ2xhc3MoZWwsICJodG1sLXdpZGdldC1zdGF0aWMtYm91bmQiKSkKICAgICAgICAgIHJldHVybjsKICAgICAgICBlbC5jbGFzc05hbWUgPSBlbC5jbGFzc05hbWUgKyAiIGh0bWwtd2lkZ2V0LXN0YXRpYy1ib3VuZCI7CgogICAgICAgIHZhciBpbml0UmVzdWx0OwogICAgICAgIGlmIChiaW5kaW5nLmluaXRpYWxpemUpIHsKICAgICAgICAgIGluaXRSZXN1bHQgPSBiaW5kaW5nLmluaXRpYWxpemUoZWwsCiAgICAgICAgICAgIHNpemVPYmogPyBzaXplT2JqLmdldFdpZHRoKCkgOiBlbC5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgc2l6ZU9iaiA/IHNpemVPYmouZ2V0SGVpZ2h0KCkgOiBlbC5vZmZzZXRIZWlnaHQKICAgICAgICAgICk7CiAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IiwgaW5pdFJlc3VsdCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYmluZGluZy5yZXNpemUpIHsKICAgICAgICAgIHZhciBsYXN0U2l6ZSA9IHsKICAgICAgICAgICAgdzogc2l6ZU9iaiA/IHNpemVPYmouZ2V0V2lkdGgoKSA6IGVsLm9mZnNldFdpZHRoLAogICAgICAgICAgICBoOiBzaXplT2JqID8gc2l6ZU9iai5nZXRIZWlnaHQoKSA6IGVsLm9mZnNldEhlaWdodAogICAgICAgICAgfTsKICAgICAgICAgIHZhciByZXNpemVIYW5kbGVyID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICB2YXIgc2l6ZSA9IHsKICAgICAgICAgICAgICB3OiBzaXplT2JqID8gc2l6ZU9iai5nZXRXaWR0aCgpIDogZWwub2Zmc2V0V2lkdGgsCiAgICAgICAgICAgICAgaDogc2l6ZU9iaiA/IHNpemVPYmouZ2V0SGVpZ2h0KCkgOiBlbC5vZmZzZXRIZWlnaHQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKHNpemUudyA9PT0gMCAmJiBzaXplLmggPT09IDApCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoc2l6ZS53ID09PSBsYXN0U2l6ZS53ICYmIHNpemUuaCA9PT0gbGFzdFNpemUuaCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGxhc3RTaXplID0gc2l6ZTsKICAgICAgICAgICAgYmluZGluZy5yZXNpemUoZWwsIHNpemUudywgc2l6ZS5oLCBpbml0UmVzdWx0KTsKICAgICAgICAgIH07CgogICAgICAgICAgb24od2luZG93LCAicmVzaXplIiwgcmVzaXplSGFuZGxlcik7CgogICAgICAgICAgLy8gVGhpcyBpcyBuZWVkZWQgZm9yIGNhc2VzIHdoZXJlIHdlJ3JlIHJ1bm5pbmcgaW4gYSBTaGlueQogICAgICAgICAgLy8gYXBwLCBidXQgdGhlIHdpZGdldCBpdHNlbGYgaXMgbm90IGEgU2hpbnkgb3V0cHV0LCBidXQKICAgICAgICAgIC8vIHJhdGhlciBhIHNpbXBsZSBzdGF0aWMgd2lkZ2V0LiBPbmUgZXhhbXBsZSBvZiB0aGlzIGlzCiAgICAgICAgICAvLyBhbiBybWFya2Rvd24gZG9jdW1lbnQgdGhhdCBoYXMgcnVudGltZTpzaGlueSBhbmQgd2lkZ2V0CiAgICAgICAgICAvLyB0aGF0IGlzbid0IGluIGEgcmVuZGVyIGZ1bmN0aW9uLiBTaGlueSBvbmx5IGtub3dzIHRvCiAgICAgICAgICAvLyBjYWxsIHJlc2l6ZSBoYW5kbGVycyBmb3IgU2hpbnkgb3V0cHV0cywgbm90IGZvciBzdGF0aWMKICAgICAgICAgIC8vIHdpZGdldHMsIHNvIHdlIGRvIGl0IG91cnNlbHZlcy4KICAgICAgICAgIGlmICh3aW5kb3cualF1ZXJ5KSB7CiAgICAgICAgICAgIHdpbmRvdy5qUXVlcnkoZG9jdW1lbnQpLm9uKAogICAgICAgICAgICAgICJzaG93bi5odG1sd2lkZ2V0cyBzaG93bi5icy50YWIuaHRtbHdpZGdldHMgc2hvd24uYnMuY29sbGFwc2UuaHRtbHdpZGdldHMiLAogICAgICAgICAgICAgIHJlc2l6ZUhhbmRsZXIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgd2luZG93LmpRdWVyeShkb2N1bWVudCkub24oCiAgICAgICAgICAgICAgImhpZGRlbi5odG1sd2lkZ2V0cyBoaWRkZW4uYnMudGFiLmh0bWx3aWRnZXRzIGhpZGRlbi5icy5jb2xsYXBzZS5odG1sd2lkZ2V0cyIsCiAgICAgICAgICAgICAgcmVzaXplSGFuZGxlcgogICAgICAgICAgICApOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFRoaXMgaXMgbmVlZGVkIGZvciB0aGUgc3BlY2lmaWMgY2FzZSBvZiBpb3NsaWRlcywgd2hpY2gKICAgICAgICAgIC8vIGZsaXBzIHNsaWRlcyBiZXR3ZWVuIGRpc3BsYXk6bm9uZSBhbmQgZGlzcGxheTpibG9jay4KICAgICAgICAgIC8vIElkZWFsbHkgd2Ugd291bGQgbm90IGhhdmUgdG8gaGF2ZSBpb3NsaWRlLXNwZWNpZmljIGNvZGUKICAgICAgICAgIC8vIGhlcmUsIGJ1dCByYXRoZXIgaGF2ZSBpb3NsaWRlcyByYWlzZSBhIGdlbmVyaWMgZXZlbnQsCiAgICAgICAgICAvLyBidXQgdGhlIHJtYXJrZG93biBwYWNrYWdlIGp1c3Qgd2VudCB0byBDUkFOIHNvIHRoZQogICAgICAgICAgLy8gd2luZG93IHRvIGdldHRpbmcgdGhhdCBmaXhlZCBtYXkgYmUgbG9uZy4KICAgICAgICAgIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICAgICAgICAvLyBJdCdzIE9LIHRvIGxpbWl0IHRoaXMgdG8gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIKICAgICAgICAgICAgLy8gYnJvd3NlcnMgYmVjYXVzZSBpb3NsaWRlcyBpdHNlbGYgb25seSBzdXBwb3J0cwogICAgICAgICAgICAvLyBzdWNoIGJyb3dzZXJzLgogICAgICAgICAgICBvbihkb2N1bWVudCwgInNsaWRlZW50ZXIiLCByZXNpemVIYW5kbGVyKTsKICAgICAgICAgICAgb24oZG9jdW1lbnQsICJzbGlkZWxlYXZlIiwgcmVzaXplSGFuZGxlcik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgc2NyaXB0RGF0YSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInNjcmlwdFtkYXRhLWZvcj0nIiArIGVsLmlkICsgIiddW3R5cGU9J2FwcGxpY2F0aW9uL2pzb24nXSIpOwogICAgICAgIGlmIChzY3JpcHREYXRhKSB7CiAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2Uoc2NyaXB0RGF0YS50ZXh0Q29udGVudCB8fCBzY3JpcHREYXRhLnRleHQpOwogICAgICAgICAgLy8gUmVzb2x2ZSBzdHJpbmdzIG1hcmtlZCBhcyBqYXZhc2NyaXB0IGxpdGVyYWxzIHRvIG9iamVjdHMKICAgICAgICAgIGlmICghKGRhdGEuZXZhbHMgaW5zdGFuY2VvZiBBcnJheSkpIGRhdGEuZXZhbHMgPSBbZGF0YS5ldmFsc107CiAgICAgICAgICBmb3IgKHZhciBrID0gMDsgZGF0YS5ldmFscyAmJiBrIDwgZGF0YS5ldmFscy5sZW5ndGg7IGsrKykgewogICAgICAgICAgICB3aW5kb3cuSFRNTFdpZGdldHMuZXZhbHVhdGVTdHJpbmdNZW1iZXIoZGF0YS54LCBkYXRhLmV2YWxzW2tdKTsKICAgICAgICAgIH0KICAgICAgICAgIGJpbmRpbmcucmVuZGVyVmFsdWUoZWwsIGRhdGEueCwgaW5pdFJlc3VsdCk7CiAgICAgICAgICBldmFsQW5kUnVuKGRhdGEuanNIb29rcy5yZW5kZXIsIGluaXRSZXN1bHQsIFtlbCwgZGF0YS54XSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwoKICAgIGludm9rZVBvc3RSZW5kZXJIYW5kbGVycygpOwogIH0KCgogIGZ1bmN0aW9uIGhhc19qUXVlcnkzKCkgewogICAgaWYgKCF3aW5kb3cualF1ZXJ5KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciAkdmVyc2lvbiA9IHdpbmRvdy5qUXVlcnkuZm4uanF1ZXJ5OwogICAgdmFyICRtYWpvcl92ZXJzaW9uID0gcGFyc2VJbnQoJHZlcnNpb24uc3BsaXQoIi4iKVswXSk7CiAgICByZXR1cm4gJG1ham9yX3ZlcnNpb24gPj0gMzsKICB9CgogIC8qCiAgLyBTaGlueSAxLjQgYnVtcGVkIGpRdWVyeSBmcm9tIDEueCB0byAzLnggd2hpY2ggbWVhbnMgalF1ZXJ5J3MKICAvIG9uLXJlYWR5IGhhbmRsZXIgKGkuZS4sICQoZm4pKSBpcyBub3cgYXN5bmNyb25vdXMgKGkuZS4sIGl0IG5vdwogIC8gcmVhbGx5IG1lYW5zICQoc2V0VGltZW91dChmbikpLgogIC8gaHR0cHM6Ly9qcXVlcnkuY29tL3VwZ3JhZGUtZ3VpZGUvMy4wLyNicmVha2luZy1jaGFuZ2UtZG9jdW1lbnQtcmVhZHktaGFuZGxlcnMtYXJlLW5vdy1hc3luY2hyb25vdXMKICAvCiAgLyBTaW5jZSBTaGlueSB1c2VzICQoKSB0byBzY2hlZHVsZSBpbml0U2hpbnksIHNoaW55Pj0xLjQgY2FsbHMgaW5pdFNoaW55CiAgLyBvbmUgdGljayBsYXRlciB0aGFuIGl0IGRpZCBiZWZvcmUsIHdoaWNoIG1lYW5zIHN0YXRpY1JlbmRlcigpIGlzCiAgLyBjYWxsZWQgcmVuZGVyVmFsdWUoKSBlYXJsaWVyIHRoYW4gKGFkdmFuY2VkKSB3aWRnZXQgYXV0aG9ycyBtaWdodCBiZSBleHBlY3RpbmcuCiAgLyBodHRwczovL2dpdGh1Yi5jb20vcnN0dWRpby9zaGlueS9pc3N1ZXMvMjYzMAogIC8KICAvIEZvciBhIGNvbmNyZXRlIGV4YW1wbGUsIGxlYWZsZXQgaGFzIHNvbWUgbWV0aG9kcyAoZS5nLiwgdXBkYXRlQm91bmRzKQogIC8gd2hpY2ggcmVmZXJlbmNlIFNoaW55IG1ldGhvZHMgcmVnaXN0ZXJlZCBpbiBpbml0U2hpbnkgKGUuZy4sIHNldElucHV0VmFsdWUpLgogIC8gU2luY2UgbGVhZmxldCBpcyBwcml2eSB0byB0aGlzIGxpZmUtY3ljbGUsIGl0IGtub3dzIHRvIHVzZSBzZXRUaW1lb3V0KCkgdG8KICAvIGRlbGF5IGV4ZWN1dGlvbiBvZiB0aG9zZSBtZXRob2RzICh1bnRpbCBTaGlueSBtZXRob2RzIGFyZSByZWFkeSkKICAvIGh0dHBzOi8vZ2l0aHViLmNvbS9yc3R1ZGlvL2xlYWZsZXQvYmxvYi8xOGVjOTgxL2phdmFzY3JpcHQvc3JjL2luZGV4LmpzI0wyNjYtTDI2OAogIC8KICAvIElkZWFsbHkgd2lkZ2V0IGF1dGhvcnMgd291bGRuJ3QgbmVlZCB0byB1c2UgdGhpcyBzZXRUaW1lb3V0KCkgaGFjayB0aGF0CiAgLyBsZWFmbGV0IHVzZXMgdG8gY2FsbCBTaGlueSBtZXRob2RzIG9uIGEgc3RhdGljUmVuZGVyKCkuIEluIHRoZSBsb25nIHJ1biwKICAvIHRoZSBsb2dpYyBpbml0U2hpbnkgc2hvdWxkIGJlIGJyb2tlbiB1cCBzbyB0aGF0IG1ldGhvZCByZWdpc3RyYXRpb24gaGFwcGVucwogIC8gcmlnaHQgYXdheSwgYnV0IGJpbmRpbmcgaGFwcGVucyBsYXRlci4KICAqLwogIGZ1bmN0aW9uIG1heWJlU3RhdGljUmVuZGVyTGF0ZXIoKSB7CiAgICBpZiAoc2hpbnlNb2RlICYmIGhhc19qUXVlcnkzKCkpIHsKICAgICAgd2luZG93LmpRdWVyeSh3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKTsKICAgIH0gZWxzZSB7CiAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTsKICAgIH0KICB9CgogIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgZnVuY3Rpb24oKSB7CiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBhcmd1bWVudHMuY2FsbGVlLCBmYWxzZSk7CiAgICAgIG1heWJlU3RhdGljUmVuZGVyTGF0ZXIoKTsKICAgIH0sIGZhbHNlKTsKICB9IGVsc2UgaWYgKGRvY3VtZW50LmF0dGFjaEV2ZW50KSB7CiAgICBkb2N1bWVudC5hdHRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIiwgZnVuY3Rpb24oKSB7CiAgICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiKSB7CiAgICAgICAgZG9jdW1lbnQuZGV0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGFyZ3VtZW50cy5jYWxsZWUpOwogICAgICAgIG1heWJlU3RhdGljUmVuZGVyTGF0ZXIoKTsKICAgICAgfQogICAgfSk7CiAgfQoKCiAgd2luZG93LkhUTUxXaWRnZXRzLmdldEF0dGFjaG1lbnRVcmwgPSBmdW5jdGlvbihkZXBuYW1lLCBrZXkpIHsKICAgIC8vIElmIG5vIGtleSwgZGVmYXVsdCB0byB0aGUgZmlyc3QgaXRlbQogICAgaWYgKHR5cGVvZihrZXkpID09PSAidW5kZWZpbmVkIikKICAgICAga2V5ID0gMTsKCiAgICB2YXIgbGluayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRlcG5hbWUgKyAiLSIgKyBrZXkgKyAiLWF0dGFjaG1lbnQiKTsKICAgIGlmICghbGluaykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkF0dGFjaG1lbnQgIiArIGRlcG5hbWUgKyAiLyIgKyBrZXkgKyAiIG5vdCBmb3VuZCBpbiBkb2N1bWVudCIpOwogICAgfQogICAgcmV0dXJuIGxpbmsuZ2V0QXR0cmlidXRlKCJocmVmIik7CiAgfTsKCiAgd2luZG93LkhUTUxXaWRnZXRzLmRhdGFmcmFtZVRvRDMgPSBmdW5jdGlvbihkZikgewogICAgdmFyIG5hbWVzID0gW107CiAgICB2YXIgbGVuZ3RoOwogICAgZm9yICh2YXIgbmFtZSBpbiBkZikgewogICAgICAgIGlmIChkZi5oYXNPd25Qcm9wZXJ0eShuYW1lKSkKICAgICAgICAgICAgbmFtZXMucHVzaChuYW1lKTsKICAgICAgICBpZiAodHlwZW9mKGRmW25hbWVdKSAhPT0gIm9iamVjdCIgfHwgdHlwZW9mKGRmW25hbWVdLmxlbmd0aCkgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQWxsIGZpZWxkcyBtdXN0IGJlIGFycmF5cyIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mKGxlbmd0aCkgIT09ICJ1bmRlZmluZWQiICYmIGxlbmd0aCAhPT0gZGZbbmFtZV0ubGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQWxsIGZpZWxkcyBtdXN0IGJlIGFycmF5cyBvZiB0aGUgc2FtZSBsZW5ndGgiKTsKICAgICAgICB9CiAgICAgICAgbGVuZ3RoID0gZGZbbmFtZV0ubGVuZ3RoOwogICAgfQogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHZhciBpdGVtOwogICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgbGVuZ3RoOyByb3crKykgewogICAgICAgIGl0ZW0gPSB7fTsKICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCBuYW1lcy5sZW5ndGg7IGNvbCsrKSB7CiAgICAgICAgICAgIGl0ZW1bbmFtZXNbY29sXV0gPSBkZltuYW1lc1tjb2xdXVtyb3ddOwogICAgICAgIH0KICAgICAgICByZXN1bHRzLnB1c2goaXRlbSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICB3aW5kb3cuSFRNTFdpZGdldHMudHJhbnNwb3NlQXJyYXkyRCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICAgIGlmIChhcnJheS5sZW5ndGggPT09IDApIHJldHVybiBhcnJheTsKICAgICAgdmFyIG5ld0FycmF5ID0gYXJyYXlbMF0ubWFwKGZ1bmN0aW9uKGNvbCwgaSkgewogICAgICAgICAgcmV0dXJuIGFycmF5Lm1hcChmdW5jdGlvbihyb3cpIHsKICAgICAgICAgICAgICByZXR1cm4gcm93W2ldCiAgICAgICAgICB9KQogICAgICB9KTsKICAgICAgcmV0dXJuIG5ld0FycmF5OwogIH07CiAgLy8gU3BsaXQgdmFsdWUgYXQgc3BsaXRDaGFyLCBidXQgYWxsb3cgc3BsaXRDaGFyIHRvIGJlIGVzY2FwZWQKICAvLyB1c2luZyBlc2NhcGVDaGFyLiBBbnkgb3RoZXIgY2hhcmFjdGVycyBlc2NhcGVkIGJ5IGVzY2FwZUNoYXIKICAvLyB3aWxsIGJlIGluY2x1ZGVkIGFzIHVzdWFsIChpbmNsdWRpbmcgZXNjYXBlQ2hhciBpdHNlbGYpLgogIGZ1bmN0aW9uIHNwbGl0V2l0aEVzY2FwZSh2YWx1ZSwgc3BsaXRDaGFyLCBlc2NhcGVDaGFyKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgdmFyIGVzY2FwZU1vZGUgPSBmYWxzZTsKICAgIHZhciBjdXJyZW50UmVzdWx0ID0gIiI7CiAgICBmb3IgKHZhciBwb3MgPSAwOyBwb3MgPCB2YWx1ZS5sZW5ndGg7IHBvcysrKSB7CiAgICAgIGlmICghZXNjYXBlTW9kZSkgewogICAgICAgIGlmICh2YWx1ZVtwb3NdID09PSBzcGxpdENoYXIpIHsKICAgICAgICAgIHJlc3VsdHMucHVzaChjdXJyZW50UmVzdWx0KTsKICAgICAgICAgIGN1cnJlbnRSZXN1bHQgPSAiIjsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlW3Bvc10gPT09IGVzY2FwZUNoYXIpIHsKICAgICAgICAgIGVzY2FwZU1vZGUgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdXJyZW50UmVzdWx0ICs9IHZhbHVlW3Bvc107CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGN1cnJlbnRSZXN1bHQgKz0gdmFsdWVbcG9zXTsKICAgICAgICBlc2NhcGVNb2RlID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGlmIChjdXJyZW50UmVzdWx0ICE9PSAiIikgewogICAgICByZXN1bHRzLnB1c2goY3VycmVudFJlc3VsdCk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9CiAgLy8gRnVuY3Rpb24gYXV0aG9yZWQgYnkgWWlodWkvSkogQWxsYWlyZQogIHdpbmRvdy5IVE1MV2lkZ2V0cy5ldmFsdWF0ZVN0cmluZ01lbWJlciA9IGZ1bmN0aW9uKG8sIG1lbWJlcikgewogICAgdmFyIHBhcnRzID0gc3BsaXRXaXRoRXNjYXBlKG1lbWJlciwgJy4nLCAnXFwnKTsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gcGFydHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIHZhciBwYXJ0ID0gcGFydHNbaV07CiAgICAgIC8vIHBhcnQgbWF5IGJlIGEgY2hhcmFjdGVyIG9yICdudW1lcmljJyBtZW1iZXIgbmFtZQogICAgICBpZiAobyAhPT0gbnVsbCAmJiB0eXBlb2YgbyA9PT0gIm9iamVjdCIgJiYgcGFydCBpbiBvKSB7CiAgICAgICAgaWYgKGkgPT0gKGwgLSAxKSkgeyAvLyBpZiB3ZSBhcmUgYXQgdGhlIGVuZCBvZiB0aGUgbGluZSB0aGVuIGV2YWx1bGF0ZQogICAgICAgICAgaWYgKHR5cGVvZiBvW3BhcnRdID09PSAic3RyaW5nIikKICAgICAgICAgICAgb1twYXJ0XSA9IHRyeUV2YWwob1twYXJ0XSk7CiAgICAgICAgfSBlbHNlIHsgLy8gb3RoZXJ3aXNlIGNvbnRpbnVlIHRvIG5leHQgZW1iZWRkZWQgb2JqZWN0CiAgICAgICAgICBvID0gb1twYXJ0XTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvLyBSZXRyaWV2ZSB0aGUgSFRNTFdpZGdldCBpbnN0YW5jZSAoaS5lLiB0aGUgcmV0dXJuIHZhbHVlIG9mIGFuCiAgLy8gSFRNTFdpZGdldCBiaW5kaW5nJ3MgaW5pdGlhbGl6ZSgpIG9yIGZhY3RvcnkoKSBmdW5jdGlvbikKICAvLyBhc3NvY2lhdGVkIHdpdGggYW4gZWxlbWVudCwgb3IgbnVsbCBpZiBub25lLgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKGVsKSB7CiAgICByZXR1cm4gZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpOwogIH07CgogIC8vIEZpbmRzIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBzY29wZSB0aGF0IG1hdGNoZXMgdGhlIHNlbGVjdG9yLAogIC8vIGFuZCByZXR1cm5zIHRoZSBIVE1MV2lkZ2V0IGluc3RhbmNlIChpLmUuIHRoZSByZXR1cm4gdmFsdWUgb2YKICAvLyBhbiBIVE1MV2lkZ2V0IGJpbmRpbmcncyBpbml0aWFsaXplKCkgb3IgZmFjdG9yeSgpIGZ1bmN0aW9uKQogIC8vIGFzc29jaWF0ZWQgd2l0aCB0aGF0IGVsZW1lbnQsIGlmIGFueS4gSWYgbm8gZWxlbWVudCBtYXRjaGVzIHRoZQogIC8vIHNlbGVjdG9yLCBvciB0aGUgZmlyc3QgbWF0Y2hpbmcgZWxlbWVudCBoYXMgbm8gSFRNTFdpZGdldAogIC8vIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCBpdCwgdGhlbiBudWxsIGlzIHJldHVybmVkLgogIC8vCiAgLy8gVGhlIHNjb3BlIGFyZ3VtZW50IGlzIG9wdGlvbmFsLCBhbmQgZGVmYXVsdHMgdG8gd2luZG93LmRvY3VtZW50LgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5maW5kID0gZnVuY3Rpb24oc2NvcGUsIHNlbGVjdG9yKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7CiAgICAgIHNlbGVjdG9yID0gc2NvcGU7CiAgICAgIHNjb3BlID0gZG9jdW1lbnQ7CiAgICB9CgogICAgdmFyIGVsID0gc2NvcGUucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7CiAgICBpZiAoZWwgPT09IG51bGwpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gd2luZG93LkhUTUxXaWRnZXRzLmdldEluc3RhbmNlKGVsKTsKICAgIH0KICB9OwoKICAvLyBGaW5kcyBhbGwgZWxlbWVudHMgaW4gdGhlIHNjb3BlIHRoYXQgbWF0Y2ggdGhlIHNlbGVjdG9yLCBhbmQKICAvLyByZXR1cm5zIHRoZSBIVE1MV2lkZ2V0IGluc3RhbmNlcyAoaS5lLiB0aGUgcmV0dXJuIHZhbHVlcyBvZgogIC8vIGFuIEhUTUxXaWRnZXQgYmluZGluZydzIGluaXRpYWxpemUoKSBvciBmYWN0b3J5KCkgZnVuY3Rpb24pCiAgLy8gYXNzb2NpYXRlZCB3aXRoIHRoZSBlbGVtZW50cywgaW4gYW4gYXJyYXkuIElmIGVsZW1lbnRzIHRoYXQKICAvLyBtYXRjaCB0aGUgc2VsZWN0b3IgZG9uJ3QgaGF2ZSBhbiBhc3NvY2lhdGVkIEhUTUxXaWRnZXQKICAvLyBpbnN0YW5jZSwgdGhlIHJldHVybmVkIGFycmF5IHdpbGwgY29udGFpbiBudWxscy4KICAvLwogIC8vIFRoZSBzY29wZSBhcmd1bWVudCBpcyBvcHRpb25hbCwgYW5kIGRlZmF1bHRzIHRvIHdpbmRvdy5kb2N1bWVudC4KICB3aW5kb3cuSFRNTFdpZGdldHMuZmluZEFsbCA9IGZ1bmN0aW9uKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkgewogICAgICBzZWxlY3RvciA9IHNjb3BlOwogICAgICBzY29wZSA9IGRvY3VtZW50OwogICAgfQoKICAgIHZhciBub2RlcyA9IHNjb3BlLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgcmVzdWx0cy5wdXNoKHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRJbnN0YW5jZShub2Rlc1tpXSkpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgdmFyIHBvc3RSZW5kZXJIYW5kbGVycyA9IFtdOwogIGZ1bmN0aW9uIGludm9rZVBvc3RSZW5kZXJIYW5kbGVycygpIHsKICAgIHdoaWxlIChwb3N0UmVuZGVySGFuZGxlcnMubGVuZ3RoKSB7CiAgICAgIHZhciBoYW5kbGVyID0gcG9zdFJlbmRlckhhbmRsZXJzLnNoaWZ0KCk7CiAgICAgIGlmIChoYW5kbGVyKSB7CiAgICAgICAgaGFuZGxlcigpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZWdpc3RlciB0aGUgZ2l2ZW4gY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgaW52b2tlZCBhZnRlciB0aGUKICAvLyBuZXh0IHRpbWUgc3RhdGljIHdpZGdldHMgYXJlIHJlbmRlcmVkLgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5hZGRQb3N0UmVuZGVySGFuZGxlciA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICBwb3N0UmVuZGVySGFuZGxlcnMucHVzaChjYWxsYmFjayk7CiAgfTsKCiAgLy8gVGFrZXMgYSBuZXctc3R5bGUgaW5zdGFuY2UtYm91bmQgZGVmaW5pdGlvbiwgYW5kIHJldHVybnMgYW4KICAvLyBvbGQtc3R5bGUgY2xhc3MtYm91bmQgZGVmaW5pdGlvbi4gVGhpcyBzYXZlcyB1cyBmcm9tIGhhdmluZwogIC8vIHRvIHJld3JpdGUgYWxsIHRoZSBsb2dpYyBpbiB0aGlzIGZpbGUgdG8gYWNjb21vZGF0ZSBib3RoCiAgLy8gdHlwZXMgb2YgZGVmaW5pdGlvbnMuCiAgZnVuY3Rpb24gY3JlYXRlTGVnYWN5RGVmaW5pdGlvbkFkYXB0ZXIoZGVmbikgewogICAgdmFyIHJlc3VsdCA9IHsKICAgICAgbmFtZTogZGVmbi5uYW1lLAogICAgICB0eXBlOiBkZWZuLnR5cGUsCiAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGVsLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgcmV0dXJuIGRlZm4uZmFjdG9yeShlbCwgd2lkdGgsIGhlaWdodCk7CiAgICAgIH0sCiAgICAgIHJlbmRlclZhbHVlOiBmdW5jdGlvbihlbCwgeCwgaW5zdGFuY2UpIHsKICAgICAgICByZXR1cm4gaW5zdGFuY2UucmVuZGVyVmFsdWUoeCk7CiAgICAgIH0sCiAgICAgIHJlc2l6ZTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQsIGluc3RhbmNlKSB7CiAgICAgICAgcmV0dXJuIGluc3RhbmNlLnJlc2l6ZSh3aWR0aCwgaGVpZ2h0KTsKICAgICAgfQogICAgfTsKCiAgICBpZiAoZGVmbi5maW5kKQogICAgICByZXN1bHQuZmluZCA9IGRlZm4uZmluZDsKICAgIGlmIChkZWZuLnJlbmRlckVycm9yKQogICAgICByZXN1bHQucmVuZGVyRXJyb3IgPSBkZWZuLnJlbmRlckVycm9yOwogICAgaWYgKGRlZm4uY2xlYXJFcnJvcikKICAgICAgcmVzdWx0LmNsZWFyRXJyb3IgPSBkZWZuLmNsZWFyRXJyb3I7CgogICAgcmV0dXJuIHJlc3VsdDsKICB9Cn0pKCk7Cgo="></script>
<script src="data:application/x-javascript;base64,Ly8gaHR0cHM6Ly9kM2pzLm9yZyBWZXJzaW9uIDUuMS4wLiBDb3B5cmlnaHQgMjAxOCBNaWtlIEJvc3RvY2suCihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7Cgl0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBmYWN0b3J5KGV4cG9ydHMpIDoKCXR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShbJ2V4cG9ydHMnXSwgZmFjdG9yeSkgOgoJKGZhY3RvcnkoKGdsb2JhbC5kMyA9IGdsb2JhbC5kMyB8fCB7fSkpKTsKfSh0aGlzLCAoZnVuY3Rpb24gKGV4cG9ydHMpIHsgJ3VzZSBzdHJpY3QnOwoKdmFyIHZlcnNpb24gPSAiNS4xLjAiOwoKZnVuY3Rpb24gYXNjZW5kaW5nKGEsIGIpIHsKICByZXR1cm4gYSA8IGIgPyAtMSA6IGEgPiBiID8gMSA6IGEgPj0gYiA/IDAgOiBOYU47Cn0KCmZ1bmN0aW9uIGJpc2VjdG9yKGNvbXBhcmUpIHsKICBpZiAoY29tcGFyZS5sZW5ndGggPT09IDEpIGNvbXBhcmUgPSBhc2NlbmRpbmdDb21wYXJhdG9yKGNvbXBhcmUpOwogIHJldHVybiB7CiAgICBsZWZ0OiBmdW5jdGlvbihhLCB4LCBsbywgaGkpIHsKICAgICAgaWYgKGxvID09IG51bGwpIGxvID0gMDsKICAgICAgaWYgKGhpID09IG51bGwpIGhpID0gYS5sZW5ndGg7CiAgICAgIHdoaWxlIChsbyA8IGhpKSB7CiAgICAgICAgdmFyIG1pZCA9IGxvICsgaGkgPj4+IDE7CiAgICAgICAgaWYgKGNvbXBhcmUoYVttaWRdLCB4KSA8IDApIGxvID0gbWlkICsgMTsKICAgICAgICBlbHNlIGhpID0gbWlkOwogICAgICB9CiAgICAgIHJldHVybiBsbzsKICAgIH0sCiAgICByaWdodDogZnVuY3Rpb24oYSwgeCwgbG8sIGhpKSB7CiAgICAgIGlmIChsbyA9PSBudWxsKSBsbyA9IDA7CiAgICAgIGlmIChoaSA9PSBudWxsKSBoaSA9IGEubGVuZ3RoOwogICAgICB3aGlsZSAobG8gPCBoaSkgewogICAgICAgIHZhciBtaWQgPSBsbyArIGhpID4+PiAxOwogICAgICAgIGlmIChjb21wYXJlKGFbbWlkXSwgeCkgPiAwKSBoaSA9IG1pZDsKICAgICAgICBlbHNlIGxvID0gbWlkICsgMTsKICAgICAgfQogICAgICByZXR1cm4gbG87CiAgICB9CiAgfTsKfQoKZnVuY3Rpb24gYXNjZW5kaW5nQ29tcGFyYXRvcihmKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKGQsIHgpIHsKICAgIHJldHVybiBhc2NlbmRpbmcoZihkKSwgeCk7CiAgfTsKfQoKdmFyIGFzY2VuZGluZ0Jpc2VjdCA9IGJpc2VjdG9yKGFzY2VuZGluZyk7CnZhciBiaXNlY3RSaWdodCA9IGFzY2VuZGluZ0Jpc2VjdC5yaWdodDsKdmFyIGJpc2VjdExlZnQgPSBhc2NlbmRpbmdCaXNlY3QubGVmdDsKCmZ1bmN0aW9uIHBhaXJzKGFycmF5LCBmKSB7CiAgaWYgKGYgPT0gbnVsbCkgZiA9IHBhaXI7CiAgdmFyIGkgPSAwLCBuID0gYXJyYXkubGVuZ3RoIC0gMSwgcCA9IGFycmF5WzBdLCBwYWlycyA9IG5ldyBBcnJheShuIDwgMCA/IDAgOiBuKTsKICB3aGlsZSAoaSA8IG4pIHBhaXJzW2ldID0gZihwLCBwID0gYXJyYXlbKytpXSk7CiAgcmV0dXJuIHBhaXJzOwp9CgpmdW5jdGlvbiBwYWlyKGEsIGIpIHsKICByZXR1cm4gW2EsIGJdOwp9CgpmdW5jdGlvbiBjcm9zcyh2YWx1ZXMwLCB2YWx1ZXMxLCByZWR1Y2UpIHsKICB2YXIgbjAgPSB2YWx1ZXMwLmxlbmd0aCwKICAgICAgbjEgPSB2YWx1ZXMxLmxlbmd0aCwKICAgICAgdmFsdWVzID0gbmV3IEFycmF5KG4wICogbjEpLAogICAgICBpMCwKICAgICAgaTEsCiAgICAgIGksCiAgICAgIHZhbHVlMDsKCiAgaWYgKHJlZHVjZSA9PSBudWxsKSByZWR1Y2UgPSBwYWlyOwoKICBmb3IgKGkwID0gaSA9IDA7IGkwIDwgbjA7ICsraTApIHsKICAgIGZvciAodmFsdWUwID0gdmFsdWVzMFtpMF0sIGkxID0gMDsgaTEgPCBuMTsgKytpMSwgKytpKSB7CiAgICAgIHZhbHVlc1tpXSA9IHJlZHVjZSh2YWx1ZTAsIHZhbHVlczFbaTFdKTsKICAgIH0KICB9CgogIHJldHVybiB2YWx1ZXM7Cn0KCmZ1bmN0aW9uIGRlc2NlbmRpbmcoYSwgYikgewogIHJldHVybiBiIDwgYSA/IC0xIDogYiA+IGEgPyAxIDogYiA+PSBhID8gMCA6IE5hTjsKfQoKZnVuY3Rpb24gbnVtYmVyKHgpIHsKICByZXR1cm4geCA9PT0gbnVsbCA/IE5hTiA6ICt4Owp9CgpmdW5jdGlvbiB2YXJpYW5jZSh2YWx1ZXMsIHZhbHVlb2YpIHsKICB2YXIgbiA9IHZhbHVlcy5sZW5ndGgsCiAgICAgIG0gPSAwLAogICAgICBpID0gLTEsCiAgICAgIG1lYW4gPSAwLAogICAgICB2YWx1ZSwKICAgICAgZGVsdGEsCiAgICAgIHN1bSA9IDA7CgogIGlmICh2YWx1ZW9mID09IG51bGwpIHsKICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgIGlmICghaXNOYU4odmFsdWUgPSBudW1iZXIodmFsdWVzW2ldKSkpIHsKICAgICAgICBkZWx0YSA9IHZhbHVlIC0gbWVhbjsKICAgICAgICBtZWFuICs9IGRlbHRhIC8gKyttOwogICAgICAgIHN1bSArPSBkZWx0YSAqICh2YWx1ZSAtIG1lYW4pOwogICAgICB9CiAgICB9CiAgfQoKICBlbHNlIHsKICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgIGlmICghaXNOYU4odmFsdWUgPSBudW1iZXIodmFsdWVvZih2YWx1ZXNbaV0sIGksIHZhbHVlcykpKSkgewogICAgICAgIGRlbHRhID0gdmFsdWUgLSBtZWFuOwogICAgICAgIG1lYW4gKz0gZGVsdGEgLyArK207CiAgICAgICAgc3VtICs9IGRlbHRhICogKHZhbHVlIC0gbWVhbik7CiAgICAgIH0KICAgIH0KICB9CgogIGlmIChtID4gMSkgcmV0dXJuIHN1bSAvIChtIC0gMSk7Cn0KCmZ1bmN0aW9uIGRldmlhdGlvbihhcnJheSwgZikgewogIHZhciB2ID0gdmFyaWFuY2UoYXJyYXksIGYpOwogIHJldHVybiB2ID8gTWF0aC5zcXJ0KHYpIDogdjsKfQoKZnVuY3Rpb24gZXh0ZW50KHZhbHVlcywgdmFsdWVvZikgewogIHZhciBuID0gdmFsdWVzLmxlbmd0aCwKICAgICAgaSA9IC0xLAogICAgICB2YWx1ZSwKICAgICAgbWluLAogICAgICBtYXg7CgogIGlmICh2YWx1ZW9mID09IG51bGwpIHsKICAgIHdoaWxlICgrK2kgPCBuKSB7IC8vIEZpbmQgdGhlIGZpcnN0IGNvbXBhcmFibGUgdmFsdWUuCiAgICAgIGlmICgodmFsdWUgPSB2YWx1ZXNbaV0pICE9IG51bGwgJiYgdmFsdWUgPj0gdmFsdWUpIHsKICAgICAgICBtaW4gPSBtYXggPSB2YWx1ZTsKICAgICAgICB3aGlsZSAoKytpIDwgbikgeyAvLyBDb21wYXJlIHRoZSByZW1haW5pbmcgdmFsdWVzLgogICAgICAgICAgaWYgKCh2YWx1ZSA9IHZhbHVlc1tpXSkgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAobWluID4gdmFsdWUpIG1pbiA9IHZhbHVlOwogICAgICAgICAgICBpZiAobWF4IDwgdmFsdWUpIG1heCA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZWxzZSB7CiAgICB3aGlsZSAoKytpIDwgbikgeyAvLyBGaW5kIHRoZSBmaXJzdCBjb21wYXJhYmxlIHZhbHVlLgogICAgICBpZiAoKHZhbHVlID0gdmFsdWVvZih2YWx1ZXNbaV0sIGksIHZhbHVlcykpICE9IG51bGwgJiYgdmFsdWUgPj0gdmFsdWUpIHsKICAgICAgICBtaW4gPSBtYXggPSB2YWx1ZTsKICAgICAgICB3aGlsZSAoKytpIDwgbikgeyAvLyBDb21wYXJlIHRoZSByZW1haW5pbmcgdmFsdWVzLgogICAgICAgICAgaWYgKCh2YWx1ZSA9IHZhbHVlb2YodmFsdWVzW2ldLCBpLCB2YWx1ZXMpKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChtaW4gPiB2YWx1ZSkgbWluID0gdmFsdWU7CiAgICAgICAgICAgIGlmIChtYXggPCB2YWx1ZSkgbWF4ID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICByZXR1cm4gW21pbiwgbWF4XTsKfQoKdmFyIGFycmF5ID0gQXJyYXkucHJvdG90eXBlOwoKdmFyIHNsaWNlID0gYXJyYXkuc2xpY2U7CnZhciBtYXAgPSBhcnJheS5tYXA7CgpmdW5jdGlvbiBjb25zdGFudCh4KSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHg7CiAgfTsKfQoKZnVuY3Rpb24gaWRlbnRpdHkoeCkgewogIHJldHVybiB4Owp9CgpmdW5jdGlvbiBzZXF1ZW5jZShzdGFydCwgc3RvcCwgc3RlcCkgewogIHN0YXJ0ID0gK3N0YXJ0LCBzdG9wID0gK3N0b3AsIHN0ZXAgPSAobiA9IGFyZ3VtZW50cy5sZW5ndGgpIDwgMiA/IChzdG9wID0gc3RhcnQsIHN0YXJ0ID0gMCwgMSkgOiBuIDwgMyA/IDEgOiArc3RlcDsKCiAgdmFyIGkgPSAtMSwKICAgICAgbiA9IE1hdGgubWF4KDAsIE1hdGguY2VpbCgoc3RvcCAtIHN0YXJ0KSAvIHN0ZXApKSB8IDAsCiAgICAgIHJhbmdlID0gbmV3IEFycmF5KG4pOwoKICB3aGlsZSAoKytpIDwgbikgewogICAgcmFuZ2VbaV0gPSBzdGFydCArIGkgKiBzdGVwOwogIH0KCiAgcmV0dXJuIHJhbmdlOwp9Cgp2YXIgZTEwID0gTWF0aC5zcXJ0KDUwKSwKICAgIGU1ID0gTWF0aC5zcXJ0KDEwKSwKICAgIGUyID0gTWF0aC5zcXJ0KDIpOwoKZnVuY3Rpb24gdGlja3Moc3RhcnQsIHN0b3AsIGNvdW50KSB7CiAgdmFyIHJldmVyc2UsCiAgICAgIGkgPSAtMSwKICAgICAgbiwKICAgICAgdGlja3MsCiAgICAgIHN0ZXA7CgogIHN0b3AgPSArc3RvcCwgc3RhcnQgPSArc3RhcnQsIGNvdW50ID0gK2NvdW50OwogIGlmIChzdGFydCA9PT0gc3RvcCAmJiBjb3VudCA+IDApIHJldHVybiBbc3RhcnRdOwogIGlmIChyZXZlcnNlID0gc3RvcCA8IHN0YXJ0KSBuID0gc3RhcnQsIHN0YXJ0ID0gc3RvcCwgc3RvcCA9IG47CiAgaWYgKChzdGVwID0gdGlja0luY3JlbWVudChzdGFydCwgc3RvcCwgY291bnQpKSA9PT0gMCB8fCAhaXNGaW5pdGUoc3RlcCkpIHJldHVybiBbXTsKCiAgaWYgKHN0ZXAgPiAwKSB7CiAgICBzdGFydCA9IE1hdGguY2VpbChzdGFydCAvIHN0ZXApOwogICAgc3RvcCA9IE1hdGguZmxvb3Ioc3RvcCAvIHN0ZXApOwogICAgdGlja3MgPSBuZXcgQXJyYXkobiA9IE1hdGguY2VpbChzdG9wIC0gc3RhcnQgKyAxKSk7CiAgICB3aGlsZSAoKytpIDwgbikgdGlja3NbaV0gPSAoc3RhcnQgKyBpKSAqIHN0ZXA7CiAgfSBlbHNlIHsKICAgIHN0YXJ0ID0gTWF0aC5mbG9vcihzdGFydCAqIHN0ZXApOwogICAgc3RvcCA9IE1hdGguY2VpbChzdG9wICogc3RlcCk7CiAgICB0aWNrcyA9IG5ldyBBcnJheShuID0gTWF0aC5jZWlsKHN0YXJ0IC0gc3RvcCArIDEpKTsKICAgIHdoaWxlICgrK2kgPCBuKSB0aWNrc1tpXSA9IChzdGFydCAtIGkpIC8gc3RlcDsKICB9CgogIGlmIChyZXZlcnNlKSB0aWNrcy5yZXZlcnNlKCk7CgogIHJldHVybiB0aWNrczsKfQoKZnVuY3Rpb24gdGlja0luY3JlbWVudChzdGFydCwgc3RvcCwgY291bnQpIHsKICB2YXIgc3RlcCA9IChzdG9wIC0gc3RhcnQpIC8gTWF0aC5tYXgoMCwgY291bnQpLAogICAgICBwb3dlciA9IE1hdGguZmxvb3IoTWF0aC5sb2coc3RlcCkgLyBNYXRoLkxOMTApLAogICAgICBlcnJvciA9IHN0ZXAgLyBNYXRoLnBvdygxMCwgcG93ZXIpOwogIHJldHVybiBwb3dlciA+PSAwCiAgICAgID8gKGVycm9yID49IGUxMCA/IDEwIDogZXJyb3IgPj0gZTUgPyA1IDogZXJyb3IgPj0gZTIgPyAyIDogMSkgKiBNYXRoLnBvdygxMCwgcG93ZXIpCiAgICAgIDogLU1hdGgucG93KDEwLCAtcG93ZXIpIC8gKGVycm9yID49IGUxMCA/IDEwIDogZXJyb3IgPj0gZTUgPyA1IDogZXJyb3IgPj0gZTIgPyAyIDogMSk7Cn0KCmZ1bmN0aW9uIHRpY2tTdGVwKHN0YXJ0LCBzdG9wLCBjb3VudCkgewogIHZhciBzdGVwMCA9IE1hdGguYWJzKHN0b3AgLSBzdGFydCkgLyBNYXRoLm1heCgwLCBjb3VudCksCiAgICAgIHN0ZXAxID0gTWF0aC5wb3coMTAsIE1hdGguZmxvb3IoTWF0aC5sb2coc3RlcDApIC8gTWF0aC5MTjEwKSksCiAgICAgIGVycm9yID0gc3RlcDAgLyBzdGVwMTsKICBpZiAoZXJyb3IgPj0gZTEwKSBzdGVwMSAqPSAxMDsKICBlbHNlIGlmIChlcnJvciA+PSBlNSkgc3RlcDEgKj0gNTsKICBlbHNlIGlmIChlcnJvciA+PSBlMikgc3RlcDEgKj0gMjsKICByZXR1cm4gc3RvcCA8IHN0YXJ0ID8gLXN0ZXAxIDogc3RlcDE7Cn0KCmZ1bmN0aW9uIHRocmVzaG9sZFN0dXJnZXModmFsdWVzKSB7CiAgcmV0dXJuIE1hdGguY2VpbChNYXRoLmxvZyh2YWx1ZXMubGVuZ3RoKSAvIE1hdGguTE4yKSArIDE7Cn0KCmZ1bmN0aW9uIGhpc3RvZ3JhbSgpIHsKICB2YXIgdmFsdWUgPSBpZGVudGl0eSwKICAgICAgZG9tYWluID0gZXh0ZW50LAogICAgICB0aHJlc2hvbGQgPSB0aHJlc2hvbGRTdHVyZ2VzOwoKICBmdW5jdGlvbiBoaXN0b2dyYW0oZGF0YSkgewogICAgdmFyIGksCiAgICAgICAgbiA9IGRhdGEubGVuZ3RoLAogICAgICAgIHgsCiAgICAgICAgdmFsdWVzID0gbmV3IEFycmF5KG4pOwoKICAgIGZvciAoaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgdmFsdWVzW2ldID0gdmFsdWUoZGF0YVtpXSwgaSwgZGF0YSk7CiAgICB9CgogICAgdmFyIHh6ID0gZG9tYWluKHZhbHVlcyksCiAgICAgICAgeDAgPSB4elswXSwKICAgICAgICB4MSA9IHh6WzFdLAogICAgICAgIHR6ID0gdGhyZXNob2xkKHZhbHVlcywgeDAsIHgxKTsKCiAgICAvLyBDb252ZXJ0IG51bWJlciBvZiB0aHJlc2hvbGRzIGludG8gdW5pZm9ybSB0aHJlc2hvbGRzLgogICAgaWYgKCFBcnJheS5pc0FycmF5KHR6KSkgewogICAgICB0eiA9IHRpY2tTdGVwKHgwLCB4MSwgdHopOwogICAgICB0eiA9IHNlcXVlbmNlKE1hdGguY2VpbCh4MCAvIHR6KSAqIHR6LCBNYXRoLmZsb29yKHgxIC8gdHopICogdHosIHR6KTsgLy8gZXhjbHVzaXZlCiAgICB9CgogICAgLy8gUmVtb3ZlIGFueSB0aHJlc2hvbGRzIG91dHNpZGUgdGhlIGRvbWFpbi4KICAgIHZhciBtID0gdHoubGVuZ3RoOwogICAgd2hpbGUgKHR6WzBdIDw9IHgwKSB0ei5zaGlmdCgpLCAtLW07CiAgICB3aGlsZSAodHpbbSAtIDFdID4geDEpIHR6LnBvcCgpLCAtLW07CgogICAgdmFyIGJpbnMgPSBuZXcgQXJyYXkobSArIDEpLAogICAgICAgIGJpbjsKCiAgICAvLyBJbml0aWFsaXplIGJpbnMuCiAgICBmb3IgKGkgPSAwOyBpIDw9IG07ICsraSkgewogICAgICBiaW4gPSBiaW5zW2ldID0gW107CiAgICAgIGJpbi54MCA9IGkgPiAwID8gdHpbaSAtIDFdIDogeDA7CiAgICAgIGJpbi54MSA9IGkgPCBtID8gdHpbaV0gOiB4MTsKICAgIH0KCiAgICAvLyBBc3NpZ24gZGF0YSB0byBiaW5zIGJ5IHZhbHVlLCBpZ25vcmluZyBhbnkgb3V0c2lkZSB0aGUgZG9tYWluLgogICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICB4ID0gdmFsdWVzW2ldOwogICAgICBpZiAoeDAgPD0geCAmJiB4IDw9IHgxKSB7CiAgICAgICAgYmluc1tiaXNlY3RSaWdodCh0eiwgeCwgMCwgbSldLnB1c2goZGF0YVtpXSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gYmluczsKICB9CgogIGhpc3RvZ3JhbS52YWx1ZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHZhbHVlID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQoXyksIGhpc3RvZ3JhbSkgOiB2YWx1ZTsKICB9OwoKICBoaXN0b2dyYW0uZG9tYWluID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZG9tYWluID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQoW19bMF0sIF9bMV1dKSwgaGlzdG9ncmFtKSA6IGRvbWFpbjsKICB9OwoKICBoaXN0b2dyYW0udGhyZXNob2xkcyA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHRocmVzaG9sZCA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IEFycmF5LmlzQXJyYXkoXykgPyBjb25zdGFudChzbGljZS5jYWxsKF8pKSA6IGNvbnN0YW50KF8pLCBoaXN0b2dyYW0pIDogdGhyZXNob2xkOwogIH07CgogIHJldHVybiBoaXN0b2dyYW07Cn0KCmZ1bmN0aW9uIHRocmVzaG9sZCh2YWx1ZXMsIHAsIHZhbHVlb2YpIHsKICBpZiAodmFsdWVvZiA9PSBudWxsKSB2YWx1ZW9mID0gbnVtYmVyOwogIGlmICghKG4gPSB2YWx1ZXMubGVuZ3RoKSkgcmV0dXJuOwogIGlmICgocCA9ICtwKSA8PSAwIHx8IG4gPCAyKSByZXR1cm4gK3ZhbHVlb2YodmFsdWVzWzBdLCAwLCB2YWx1ZXMpOwogIGlmIChwID49IDEpIHJldHVybiArdmFsdWVvZih2YWx1ZXNbbiAtIDFdLCBuIC0gMSwgdmFsdWVzKTsKICB2YXIgbiwKICAgICAgaSA9IChuIC0gMSkgKiBwLAogICAgICBpMCA9IE1hdGguZmxvb3IoaSksCiAgICAgIHZhbHVlMCA9ICt2YWx1ZW9mKHZhbHVlc1tpMF0sIGkwLCB2YWx1ZXMpLAogICAgICB2YWx1ZTEgPSArdmFsdWVvZih2YWx1ZXNbaTAgKyAxXSwgaTAgKyAxLCB2YWx1ZXMpOwogIHJldHVybiB2YWx1ZTAgKyAodmFsdWUxIC0gdmFsdWUwKSAqIChpIC0gaTApOwp9CgpmdW5jdGlvbiBmcmVlZG1hbkRpYWNvbmlzKHZhbHVlcywgbWluLCBtYXgpIHsKICB2YWx1ZXMgPSBtYXAuY2FsbCh2YWx1ZXMsIG51bWJlcikuc29ydChhc2NlbmRpbmcpOwogIHJldHVybiBNYXRoLmNlaWwoKG1heCAtIG1pbikgLyAoMiAqICh0aHJlc2hvbGQodmFsdWVzLCAwLjc1KSAtIHRocmVzaG9sZCh2YWx1ZXMsIDAuMjUpKSAqIE1hdGgucG93KHZhbHVlcy5sZW5ndGgsIC0xIC8gMykpKTsKfQoKZnVuY3Rpb24gc2NvdHQodmFsdWVzLCBtaW4sIG1heCkgewogIHJldHVybiBNYXRoLmNlaWwoKG1heCAtIG1pbikgLyAoMy41ICogZGV2aWF0aW9uKHZhbHVlcykgKiBNYXRoLnBvdyh2YWx1ZXMubGVuZ3RoLCAtMSAvIDMpKSk7Cn0KCmZ1bmN0aW9uIG1heCh2YWx1ZXMsIHZhbHVlb2YpIHsKICB2YXIgbiA9IHZhbHVlcy5sZW5ndGgsCiAgICAgIGkgPSAtMSwKICAgICAgdmFsdWUsCiAgICAgIG1heDsKCiAgaWYgKHZhbHVlb2YgPT0gbnVsbCkgewogICAgd2hpbGUgKCsraSA8IG4pIHsgLy8gRmluZCB0aGUgZmlyc3QgY29tcGFyYWJsZSB2YWx1ZS4KICAgICAgaWYgKCh2YWx1ZSA9IHZhbHVlc1tpXSkgIT0gbnVsbCAmJiB2YWx1ZSA+PSB2YWx1ZSkgewogICAgICAgIG1heCA9IHZhbHVlOwogICAgICAgIHdoaWxlICgrK2kgPCBuKSB7IC8vIENvbXBhcmUgdGhlIHJlbWFpbmluZyB2YWx1ZXMuCiAgICAgICAgICBpZiAoKHZhbHVlID0gdmFsdWVzW2ldKSAhPSBudWxsICYmIHZhbHVlID4gbWF4KSB7CiAgICAgICAgICAgIG1heCA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZWxzZSB7CiAgICB3aGlsZSAoKytpIDwgbikgeyAvLyBGaW5kIHRoZSBmaXJzdCBjb21wYXJhYmxlIHZhbHVlLgogICAgICBpZiAoKHZhbHVlID0gdmFsdWVvZih2YWx1ZXNbaV0sIGksIHZhbHVlcykpICE9IG51bGwgJiYgdmFsdWUgPj0gdmFsdWUpIHsKICAgICAgICBtYXggPSB2YWx1ZTsKICAgICAgICB3aGlsZSAoKytpIDwgbikgeyAvLyBDb21wYXJlIHRoZSByZW1haW5pbmcgdmFsdWVzLgogICAgICAgICAgaWYgKCh2YWx1ZSA9IHZhbHVlb2YodmFsdWVzW2ldLCBpLCB2YWx1ZXMpKSAhPSBudWxsICYmIHZhbHVlID4gbWF4KSB7CiAgICAgICAgICAgIG1heCA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgcmV0dXJuIG1heDsKfQoKZnVuY3Rpb24gbWVhbih2YWx1ZXMsIHZhbHVlb2YpIHsKICB2YXIgbiA9IHZhbHVlcy5sZW5ndGgsCiAgICAgIG0gPSBuLAogICAgICBpID0gLTEsCiAgICAgIHZhbHVlLAogICAgICBzdW0gPSAwOwoKICBpZiAodmFsdWVvZiA9PSBudWxsKSB7CiAgICB3aGlsZSAoKytpIDwgbikgewogICAgICBpZiAoIWlzTmFOKHZhbHVlID0gbnVtYmVyKHZhbHVlc1tpXSkpKSBzdW0gKz0gdmFsdWU7CiAgICAgIGVsc2UgLS1tOwogICAgfQogIH0KCiAgZWxzZSB7CiAgICB3aGlsZSAoKytpIDwgbikgewogICAgICBpZiAoIWlzTmFOKHZhbHVlID0gbnVtYmVyKHZhbHVlb2YodmFsdWVzW2ldLCBpLCB2YWx1ZXMpKSkpIHN1bSArPSB2YWx1ZTsKICAgICAgZWxzZSAtLW07CiAgICB9CiAgfQoKICBpZiAobSkgcmV0dXJuIHN1bSAvIG07Cn0KCmZ1bmN0aW9uIG1lZGlhbih2YWx1ZXMsIHZhbHVlb2YpIHsKICB2YXIgbiA9IHZhbHVlcy5sZW5ndGgsCiAgICAgIGkgPSAtMSwKICAgICAgdmFsdWUsCiAgICAgIG51bWJlcnMgPSBbXTsKCiAgaWYgKHZhbHVlb2YgPT0gbnVsbCkgewogICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgaWYgKCFpc05hTih2YWx1ZSA9IG51bWJlcih2YWx1ZXNbaV0pKSkgewogICAgICAgIG51bWJlcnMucHVzaCh2YWx1ZSk7CiAgICAgIH0KICAgIH0KICB9CgogIGVsc2UgewogICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgaWYgKCFpc05hTih2YWx1ZSA9IG51bWJlcih2YWx1ZW9mKHZhbHVlc1tpXSwgaSwgdmFsdWVzKSkpKSB7CiAgICAgICAgbnVtYmVycy5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgfQogIH0KCiAgcmV0dXJuIHRocmVzaG9sZChudW1iZXJzLnNvcnQoYXNjZW5kaW5nKSwgMC41KTsKfQoKZnVuY3Rpb24gbWVyZ2UoYXJyYXlzKSB7CiAgdmFyIG4gPSBhcnJheXMubGVuZ3RoLAogICAgICBtLAogICAgICBpID0gLTEsCiAgICAgIGogPSAwLAogICAgICBtZXJnZWQsCiAgICAgIGFycmF5OwoKICB3aGlsZSAoKytpIDwgbikgaiArPSBhcnJheXNbaV0ubGVuZ3RoOwogIG1lcmdlZCA9IG5ldyBBcnJheShqKTsKCiAgd2hpbGUgKC0tbiA+PSAwKSB7CiAgICBhcnJheSA9IGFycmF5c1tuXTsKICAgIG0gPSBhcnJheS5sZW5ndGg7CiAgICB3aGlsZSAoLS1tID49IDApIHsKICAgICAgbWVyZ2VkWy0tal0gPSBhcnJheVttXTsKICAgIH0KICB9CgogIHJldHVybiBtZXJnZWQ7Cn0KCmZ1bmN0aW9uIG1pbih2YWx1ZXMsIHZhbHVlb2YpIHsKICB2YXIgbiA9IHZhbHVlcy5sZW5ndGgsCiAgICAgIGkgPSAtMSwKICAgICAgdmFsdWUsCiAgICAgIG1pbjsKCiAgaWYgKHZhbHVlb2YgPT0gbnVsbCkgewogICAgd2hpbGUgKCsraSA8IG4pIHsgLy8gRmluZCB0aGUgZmlyc3QgY29tcGFyYWJsZSB2YWx1ZS4KICAgICAgaWYgKCh2YWx1ZSA9IHZhbHVlc1tpXSkgIT0gbnVsbCAmJiB2YWx1ZSA+PSB2YWx1ZSkgewogICAgICAgIG1pbiA9IHZhbHVlOwogICAgICAgIHdoaWxlICgrK2kgPCBuKSB7IC8vIENvbXBhcmUgdGhlIHJlbWFpbmluZyB2YWx1ZXMuCiAgICAgICAgICBpZiAoKHZhbHVlID0gdmFsdWVzW2ldKSAhPSBudWxsICYmIG1pbiA+IHZhbHVlKSB7CiAgICAgICAgICAgIG1pbiA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZWxzZSB7CiAgICB3aGlsZSAoKytpIDwgbikgeyAvLyBGaW5kIHRoZSBmaXJzdCBjb21wYXJhYmxlIHZhbHVlLgogICAgICBpZiAoKHZhbHVlID0gdmFsdWVvZih2YWx1ZXNbaV0sIGksIHZhbHVlcykpICE9IG51bGwgJiYgdmFsdWUgPj0gdmFsdWUpIHsKICAgICAgICBtaW4gPSB2YWx1ZTsKICAgICAgICB3aGlsZSAoKytpIDwgbikgeyAvLyBDb21wYXJlIHRoZSByZW1haW5pbmcgdmFsdWVzLgogICAgICAgICAgaWYgKCh2YWx1ZSA9IHZhbHVlb2YodmFsdWVzW2ldLCBpLCB2YWx1ZXMpKSAhPSBudWxsICYmIG1pbiA+IHZhbHVlKSB7CiAgICAgICAgICAgIG1pbiA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgcmV0dXJuIG1pbjsKfQoKZnVuY3Rpb24gcGVybXV0ZShhcnJheSwgaW5kZXhlcykgewogIHZhciBpID0gaW5kZXhlcy5sZW5ndGgsIHBlcm11dGVzID0gbmV3IEFycmF5KGkpOwogIHdoaWxlIChpLS0pIHBlcm11dGVzW2ldID0gYXJyYXlbaW5kZXhlc1tpXV07CiAgcmV0dXJuIHBlcm11dGVzOwp9CgpmdW5jdGlvbiBzY2FuKHZhbHVlcywgY29tcGFyZSkgewogIGlmICghKG4gPSB2YWx1ZXMubGVuZ3RoKSkgcmV0dXJuOwogIHZhciBuLAogICAgICBpID0gMCwKICAgICAgaiA9IDAsCiAgICAgIHhpLAogICAgICB4aiA9IHZhbHVlc1tqXTsKCiAgaWYgKGNvbXBhcmUgPT0gbnVsbCkgY29tcGFyZSA9IGFzY2VuZGluZzsKCiAgd2hpbGUgKCsraSA8IG4pIHsKICAgIGlmIChjb21wYXJlKHhpID0gdmFsdWVzW2ldLCB4aikgPCAwIHx8IGNvbXBhcmUoeGosIHhqKSAhPT0gMCkgewogICAgICB4aiA9IHhpLCBqID0gaTsKICAgIH0KICB9CgogIGlmIChjb21wYXJlKHhqLCB4aikgPT09IDApIHJldHVybiBqOwp9CgpmdW5jdGlvbiBzaHVmZmxlKGFycmF5LCBpMCwgaTEpIHsKICB2YXIgbSA9IChpMSA9PSBudWxsID8gYXJyYXkubGVuZ3RoIDogaTEpIC0gKGkwID0gaTAgPT0gbnVsbCA/IDAgOiAraTApLAogICAgICB0LAogICAgICBpOwoKICB3aGlsZSAobSkgewogICAgaSA9IE1hdGgucmFuZG9tKCkgKiBtLS0gfCAwOwogICAgdCA9IGFycmF5W20gKyBpMF07CiAgICBhcnJheVttICsgaTBdID0gYXJyYXlbaSArIGkwXTsKICAgIGFycmF5W2kgKyBpMF0gPSB0OwogIH0KCiAgcmV0dXJuIGFycmF5Owp9CgpmdW5jdGlvbiBzdW0odmFsdWVzLCB2YWx1ZW9mKSB7CiAgdmFyIG4gPSB2YWx1ZXMubGVuZ3RoLAogICAgICBpID0gLTEsCiAgICAgIHZhbHVlLAogICAgICBzdW0gPSAwOwoKICBpZiAodmFsdWVvZiA9PSBudWxsKSB7CiAgICB3aGlsZSAoKytpIDwgbikgewogICAgICBpZiAodmFsdWUgPSArdmFsdWVzW2ldKSBzdW0gKz0gdmFsdWU7IC8vIE5vdGU6IHplcm8gYW5kIG51bGwgYXJlIGVxdWl2YWxlbnQuCiAgICB9CiAgfQoKICBlbHNlIHsKICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgIGlmICh2YWx1ZSA9ICt2YWx1ZW9mKHZhbHVlc1tpXSwgaSwgdmFsdWVzKSkgc3VtICs9IHZhbHVlOwogICAgfQogIH0KCiAgcmV0dXJuIHN1bTsKfQoKZnVuY3Rpb24gdHJhbnNwb3NlKG1hdHJpeCkgewogIGlmICghKG4gPSBtYXRyaXgubGVuZ3RoKSkgcmV0dXJuIFtdOwogIGZvciAodmFyIGkgPSAtMSwgbSA9IG1pbihtYXRyaXgsIGxlbmd0aCksIHRyYW5zcG9zZSA9IG5ldyBBcnJheShtKTsgKytpIDwgbTspIHsKICAgIGZvciAodmFyIGogPSAtMSwgbiwgcm93ID0gdHJhbnNwb3NlW2ldID0gbmV3IEFycmF5KG4pOyArK2ogPCBuOykgewogICAgICByb3dbal0gPSBtYXRyaXhbal1baV07CiAgICB9CiAgfQogIHJldHVybiB0cmFuc3Bvc2U7Cn0KCmZ1bmN0aW9uIGxlbmd0aChkKSB7CiAgcmV0dXJuIGQubGVuZ3RoOwp9CgpmdW5jdGlvbiB6aXAoKSB7CiAgcmV0dXJuIHRyYW5zcG9zZShhcmd1bWVudHMpOwp9Cgp2YXIgc2xpY2UkMSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTsKCmZ1bmN0aW9uIGlkZW50aXR5JDEoeCkgewogIHJldHVybiB4Owp9Cgp2YXIgdG9wID0gMSwKICAgIHJpZ2h0ID0gMiwKICAgIGJvdHRvbSA9IDMsCiAgICBsZWZ0ID0gNCwKICAgIGVwc2lsb24gPSAxZS02OwoKZnVuY3Rpb24gdHJhbnNsYXRlWCh4KSB7CiAgcmV0dXJuICJ0cmFuc2xhdGUoIiArICh4ICsgMC41KSArICIsMCkiOwp9CgpmdW5jdGlvbiB0cmFuc2xhdGVZKHkpIHsKICByZXR1cm4gInRyYW5zbGF0ZSgwLCIgKyAoeSArIDAuNSkgKyAiKSI7Cn0KCmZ1bmN0aW9uIG51bWJlciQxKHNjYWxlKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKGQpIHsKICAgIHJldHVybiArc2NhbGUoZCk7CiAgfTsKfQoKZnVuY3Rpb24gY2VudGVyKHNjYWxlKSB7CiAgdmFyIG9mZnNldCA9IE1hdGgubWF4KDAsIHNjYWxlLmJhbmR3aWR0aCgpIC0gMSkgLyAyOyAvLyBBZGp1c3QgZm9yIDAuNXB4IG9mZnNldC4KICBpZiAoc2NhbGUucm91bmQoKSkgb2Zmc2V0ID0gTWF0aC5yb3VuZChvZmZzZXQpOwogIHJldHVybiBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gK3NjYWxlKGQpICsgb2Zmc2V0OwogIH07Cn0KCmZ1bmN0aW9uIGVudGVyaW5nKCkgewogIHJldHVybiAhdGhpcy5fX2F4aXM7Cn0KCmZ1bmN0aW9uIGF4aXMob3JpZW50LCBzY2FsZSkgewogIHZhciB0aWNrQXJndW1lbnRzID0gW10sCiAgICAgIHRpY2tWYWx1ZXMgPSBudWxsLAogICAgICB0aWNrRm9ybWF0ID0gbnVsbCwKICAgICAgdGlja1NpemVJbm5lciA9IDYsCiAgICAgIHRpY2tTaXplT3V0ZXIgPSA2LAogICAgICB0aWNrUGFkZGluZyA9IDMsCiAgICAgIGsgPSBvcmllbnQgPT09IHRvcCB8fCBvcmllbnQgPT09IGxlZnQgPyAtMSA6IDEsCiAgICAgIHggPSBvcmllbnQgPT09IGxlZnQgfHwgb3JpZW50ID09PSByaWdodCA/ICJ4IiA6ICJ5IiwKICAgICAgdHJhbnNmb3JtID0gb3JpZW50ID09PSB0b3AgfHwgb3JpZW50ID09PSBib3R0b20gPyB0cmFuc2xhdGVYIDogdHJhbnNsYXRlWTsKCiAgZnVuY3Rpb24gYXhpcyhjb250ZXh0KSB7CiAgICB2YXIgdmFsdWVzID0gdGlja1ZhbHVlcyA9PSBudWxsID8gKHNjYWxlLnRpY2tzID8gc2NhbGUudGlja3MuYXBwbHkoc2NhbGUsIHRpY2tBcmd1bWVudHMpIDogc2NhbGUuZG9tYWluKCkpIDogdGlja1ZhbHVlcywKICAgICAgICBmb3JtYXQgPSB0aWNrRm9ybWF0ID09IG51bGwgPyAoc2NhbGUudGlja0Zvcm1hdCA/IHNjYWxlLnRpY2tGb3JtYXQuYXBwbHkoc2NhbGUsIHRpY2tBcmd1bWVudHMpIDogaWRlbnRpdHkkMSkgOiB0aWNrRm9ybWF0LAogICAgICAgIHNwYWNpbmcgPSBNYXRoLm1heCh0aWNrU2l6ZUlubmVyLCAwKSArIHRpY2tQYWRkaW5nLAogICAgICAgIHJhbmdlID0gc2NhbGUucmFuZ2UoKSwKICAgICAgICByYW5nZTAgPSArcmFuZ2VbMF0gKyAwLjUsCiAgICAgICAgcmFuZ2UxID0gK3JhbmdlW3JhbmdlLmxlbmd0aCAtIDFdICsgMC41LAogICAgICAgIHBvc2l0aW9uID0gKHNjYWxlLmJhbmR3aWR0aCA/IGNlbnRlciA6IG51bWJlciQxKShzY2FsZS5jb3B5KCkpLAogICAgICAgIHNlbGVjdGlvbiA9IGNvbnRleHQuc2VsZWN0aW9uID8gY29udGV4dC5zZWxlY3Rpb24oKSA6IGNvbnRleHQsCiAgICAgICAgcGF0aCA9IHNlbGVjdGlvbi5zZWxlY3RBbGwoIi5kb21haW4iKS5kYXRhKFtudWxsXSksCiAgICAgICAgdGljayA9IHNlbGVjdGlvbi5zZWxlY3RBbGwoIi50aWNrIikuZGF0YSh2YWx1ZXMsIHNjYWxlKS5vcmRlcigpLAogICAgICAgIHRpY2tFeGl0ID0gdGljay5leGl0KCksCiAgICAgICAgdGlja0VudGVyID0gdGljay5lbnRlcigpLmFwcGVuZCgiZyIpLmF0dHIoImNsYXNzIiwgInRpY2siKSwKICAgICAgICBsaW5lID0gdGljay5zZWxlY3QoImxpbmUiKSwKICAgICAgICB0ZXh0ID0gdGljay5zZWxlY3QoInRleHQiKTsKCiAgICBwYXRoID0gcGF0aC5tZXJnZShwYXRoLmVudGVyKCkuaW5zZXJ0KCJwYXRoIiwgIi50aWNrIikKICAgICAgICAuYXR0cigiY2xhc3MiLCAiZG9tYWluIikKICAgICAgICAuYXR0cigic3Ryb2tlIiwgIiMwMDAiKSk7CgogICAgdGljayA9IHRpY2subWVyZ2UodGlja0VudGVyKTsKCiAgICBsaW5lID0gbGluZS5tZXJnZSh0aWNrRW50ZXIuYXBwZW5kKCJsaW5lIikKICAgICAgICAuYXR0cigic3Ryb2tlIiwgIiMwMDAiKQogICAgICAgIC5hdHRyKHggKyAiMiIsIGsgKiB0aWNrU2l6ZUlubmVyKSk7CgogICAgdGV4dCA9IHRleHQubWVyZ2UodGlja0VudGVyLmFwcGVuZCgidGV4dCIpCiAgICAgICAgLmF0dHIoImZpbGwiLCAiIzAwMCIpCiAgICAgICAgLmF0dHIoeCwgayAqIHNwYWNpbmcpCiAgICAgICAgLmF0dHIoImR5Iiwgb3JpZW50ID09PSB0b3AgPyAiMGVtIiA6IG9yaWVudCA9PT0gYm90dG9tID8gIjAuNzFlbSIgOiAiMC4zMmVtIikpOwoKICAgIGlmIChjb250ZXh0ICE9PSBzZWxlY3Rpb24pIHsKICAgICAgcGF0aCA9IHBhdGgudHJhbnNpdGlvbihjb250ZXh0KTsKICAgICAgdGljayA9IHRpY2sudHJhbnNpdGlvbihjb250ZXh0KTsKICAgICAgbGluZSA9IGxpbmUudHJhbnNpdGlvbihjb250ZXh0KTsKICAgICAgdGV4dCA9IHRleHQudHJhbnNpdGlvbihjb250ZXh0KTsKCiAgICAgIHRpY2tFeGl0ID0gdGlja0V4aXQudHJhbnNpdGlvbihjb250ZXh0KQogICAgICAgICAgLmF0dHIoIm9wYWNpdHkiLCBlcHNpbG9uKQogICAgICAgICAgLmF0dHIoInRyYW5zZm9ybSIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGlzRmluaXRlKGQgPSBwb3NpdGlvbihkKSkgPyB0cmFuc2Zvcm0oZCkgOiB0aGlzLmdldEF0dHJpYnV0ZSgidHJhbnNmb3JtIik7IH0pOwoKICAgICAgdGlja0VudGVyCiAgICAgICAgICAuYXR0cigib3BhY2l0eSIsIGVwc2lsb24pCiAgICAgICAgICAuYXR0cigidHJhbnNmb3JtIiwgZnVuY3Rpb24oZCkgeyB2YXIgcCA9IHRoaXMucGFyZW50Tm9kZS5fX2F4aXM7IHJldHVybiB0cmFuc2Zvcm0ocCAmJiBpc0Zpbml0ZShwID0gcChkKSkgPyBwIDogcG9zaXRpb24oZCkpOyB9KTsKICAgIH0KCiAgICB0aWNrRXhpdC5yZW1vdmUoKTsKCiAgICBwYXRoCiAgICAgICAgLmF0dHIoImQiLCBvcmllbnQgPT09IGxlZnQgfHwgb3JpZW50ID09IHJpZ2h0CiAgICAgICAgICAgID8gIk0iICsgayAqIHRpY2tTaXplT3V0ZXIgKyAiLCIgKyByYW5nZTAgKyAiSDAuNVYiICsgcmFuZ2UxICsgIkgiICsgayAqIHRpY2tTaXplT3V0ZXIKICAgICAgICAgICAgOiAiTSIgKyByYW5nZTAgKyAiLCIgKyBrICogdGlja1NpemVPdXRlciArICJWMC41SCIgKyByYW5nZTEgKyAiViIgKyBrICogdGlja1NpemVPdXRlcik7CgogICAgdGljawogICAgICAgIC5hdHRyKCJvcGFjaXR5IiwgMSkKICAgICAgICAuYXR0cigidHJhbnNmb3JtIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gdHJhbnNmb3JtKHBvc2l0aW9uKGQpKTsgfSk7CgogICAgbGluZQogICAgICAgIC5hdHRyKHggKyAiMiIsIGsgKiB0aWNrU2l6ZUlubmVyKTsKCiAgICB0ZXh0CiAgICAgICAgLmF0dHIoeCwgayAqIHNwYWNpbmcpCiAgICAgICAgLnRleHQoZm9ybWF0KTsKCiAgICBzZWxlY3Rpb24uZmlsdGVyKGVudGVyaW5nKQogICAgICAgIC5hdHRyKCJmaWxsIiwgIm5vbmUiKQogICAgICAgIC5hdHRyKCJmb250LXNpemUiLCAxMCkKICAgICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAic2Fucy1zZXJpZiIpCiAgICAgICAgLmF0dHIoInRleHQtYW5jaG9yIiwgb3JpZW50ID09PSByaWdodCA/ICJzdGFydCIgOiBvcmllbnQgPT09IGxlZnQgPyAiZW5kIiA6ICJtaWRkbGUiKTsKCiAgICBzZWxlY3Rpb24KICAgICAgICAuZWFjaChmdW5jdGlvbigpIHsgdGhpcy5fX2F4aXMgPSBwb3NpdGlvbjsgfSk7CiAgfQoKICBheGlzLnNjYWxlID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoc2NhbGUgPSBfLCBheGlzKSA6IHNjYWxlOwogIH07CgogIGF4aXMudGlja3MgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aWNrQXJndW1lbnRzID0gc2xpY2UkMS5jYWxsKGFyZ3VtZW50cyksIGF4aXM7CiAgfTsKCiAgYXhpcy50aWNrQXJndW1lbnRzID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodGlja0FyZ3VtZW50cyA9IF8gPT0gbnVsbCA/IFtdIDogc2xpY2UkMS5jYWxsKF8pLCBheGlzKSA6IHRpY2tBcmd1bWVudHMuc2xpY2UoKTsKICB9OwoKICBheGlzLnRpY2tWYWx1ZXMgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0aWNrVmFsdWVzID0gXyA9PSBudWxsID8gbnVsbCA6IHNsaWNlJDEuY2FsbChfKSwgYXhpcykgOiB0aWNrVmFsdWVzICYmIHRpY2tWYWx1ZXMuc2xpY2UoKTsKICB9OwoKICBheGlzLnRpY2tGb3JtYXQgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0aWNrRm9ybWF0ID0gXywgYXhpcykgOiB0aWNrRm9ybWF0OwogIH07CgogIGF4aXMudGlja1NpemUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0aWNrU2l6ZUlubmVyID0gdGlja1NpemVPdXRlciA9ICtfLCBheGlzKSA6IHRpY2tTaXplSW5uZXI7CiAgfTsKCiAgYXhpcy50aWNrU2l6ZUlubmVyID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodGlja1NpemVJbm5lciA9ICtfLCBheGlzKSA6IHRpY2tTaXplSW5uZXI7CiAgfTsKCiAgYXhpcy50aWNrU2l6ZU91dGVyID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodGlja1NpemVPdXRlciA9ICtfLCBheGlzKSA6IHRpY2tTaXplT3V0ZXI7CiAgfTsKCiAgYXhpcy50aWNrUGFkZGluZyA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHRpY2tQYWRkaW5nID0gK18sIGF4aXMpIDogdGlja1BhZGRpbmc7CiAgfTsKCiAgcmV0dXJuIGF4aXM7Cn0KCmZ1bmN0aW9uIGF4aXNUb3Aoc2NhbGUpIHsKICByZXR1cm4gYXhpcyh0b3AsIHNjYWxlKTsKfQoKZnVuY3Rpb24gYXhpc1JpZ2h0KHNjYWxlKSB7CiAgcmV0dXJuIGF4aXMocmlnaHQsIHNjYWxlKTsKfQoKZnVuY3Rpb24gYXhpc0JvdHRvbShzY2FsZSkgewogIHJldHVybiBheGlzKGJvdHRvbSwgc2NhbGUpOwp9CgpmdW5jdGlvbiBheGlzTGVmdChzY2FsZSkgewogIHJldHVybiBheGlzKGxlZnQsIHNjYWxlKTsKfQoKdmFyIG5vb3AgPSB7dmFsdWU6IGZ1bmN0aW9uKCkge319OwoKZnVuY3Rpb24gZGlzcGF0Y2goKSB7CiAgZm9yICh2YXIgaSA9IDAsIG4gPSBhcmd1bWVudHMubGVuZ3RoLCBfID0ge30sIHQ7IGkgPCBuOyArK2kpIHsKICAgIGlmICghKHQgPSBhcmd1bWVudHNbaV0gKyAiIikgfHwgKHQgaW4gXykpIHRocm93IG5ldyBFcnJvcigiaWxsZWdhbCB0eXBlOiAiICsgdCk7CiAgICBfW3RdID0gW107CiAgfQogIHJldHVybiBuZXcgRGlzcGF0Y2goXyk7Cn0KCmZ1bmN0aW9uIERpc3BhdGNoKF8pIHsKICB0aGlzLl8gPSBfOwp9CgpmdW5jdGlvbiBwYXJzZVR5cGVuYW1lcyh0eXBlbmFtZXMsIHR5cGVzKSB7CiAgcmV0dXJuIHR5cGVuYW1lcy50cmltKCkuc3BsaXQoL158XHMrLykubWFwKGZ1bmN0aW9uKHQpIHsKICAgIHZhciBuYW1lID0gIiIsIGkgPSB0LmluZGV4T2YoIi4iKTsKICAgIGlmIChpID49IDApIG5hbWUgPSB0LnNsaWNlKGkgKyAxKSwgdCA9IHQuc2xpY2UoMCwgaSk7CiAgICBpZiAodCAmJiAhdHlwZXMuaGFzT3duUHJvcGVydHkodCkpIHRocm93IG5ldyBFcnJvcigidW5rbm93biB0eXBlOiAiICsgdCk7CiAgICByZXR1cm4ge3R5cGU6IHQsIG5hbWU6IG5hbWV9OwogIH0pOwp9CgpEaXNwYXRjaC5wcm90b3R5cGUgPSBkaXNwYXRjaC5wcm90b3R5cGUgPSB7CiAgY29uc3RydWN0b3I6IERpc3BhdGNoLAogIG9uOiBmdW5jdGlvbih0eXBlbmFtZSwgY2FsbGJhY2spIHsKICAgIHZhciBfID0gdGhpcy5fLAogICAgICAgIFQgPSBwYXJzZVR5cGVuYW1lcyh0eXBlbmFtZSArICIiLCBfKSwKICAgICAgICB0LAogICAgICAgIGkgPSAtMSwKICAgICAgICBuID0gVC5sZW5ndGg7CgogICAgLy8gSWYgbm8gY2FsbGJhY2sgd2FzIHNwZWNpZmllZCwgcmV0dXJuIHRoZSBjYWxsYmFjayBvZiB0aGUgZ2l2ZW4gdHlwZSBhbmQgbmFtZS4KICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgewogICAgICB3aGlsZSAoKytpIDwgbikgaWYgKCh0ID0gKHR5cGVuYW1lID0gVFtpXSkudHlwZSkgJiYgKHQgPSBnZXQoX1t0XSwgdHlwZW5hbWUubmFtZSkpKSByZXR1cm4gdDsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIElmIGEgdHlwZSB3YXMgc3BlY2lmaWVkLCBzZXQgdGhlIGNhbGxiYWNrIGZvciB0aGUgZ2l2ZW4gdHlwZSBhbmQgbmFtZS4KICAgIC8vIE90aGVyd2lzZSwgaWYgYSBudWxsIGNhbGxiYWNrIHdhcyBzcGVjaWZpZWQsIHJlbW92ZSBjYWxsYmFja3Mgb2YgdGhlIGdpdmVuIG5hbWUuCiAgICBpZiAoY2FsbGJhY2sgIT0gbnVsbCAmJiB0eXBlb2YgY2FsbGJhY2sgIT09ICJmdW5jdGlvbiIpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBjYWxsYmFjazogIiArIGNhbGxiYWNrKTsKICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgIGlmICh0ID0gKHR5cGVuYW1lID0gVFtpXSkudHlwZSkgX1t0XSA9IHNldChfW3RdLCB0eXBlbmFtZS5uYW1lLCBjYWxsYmFjayk7CiAgICAgIGVsc2UgaWYgKGNhbGxiYWNrID09IG51bGwpIGZvciAodCBpbiBfKSBfW3RdID0gc2V0KF9bdF0sIHR5cGVuYW1lLm5hbWUsIG51bGwpOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0sCiAgY29weTogZnVuY3Rpb24oKSB7CiAgICB2YXIgY29weSA9IHt9LCBfID0gdGhpcy5fOwogICAgZm9yICh2YXIgdCBpbiBfKSBjb3B5W3RdID0gX1t0XS5zbGljZSgpOwogICAgcmV0dXJuIG5ldyBEaXNwYXRjaChjb3B5KTsKICB9LAogIGNhbGw6IGZ1bmN0aW9uKHR5cGUsIHRoYXQpIHsKICAgIGlmICgobiA9IGFyZ3VtZW50cy5sZW5ndGggLSAyKSA+IDApIGZvciAodmFyIGFyZ3MgPSBuZXcgQXJyYXkobiksIGkgPSAwLCBuLCB0OyBpIDwgbjsgKytpKSBhcmdzW2ldID0gYXJndW1lbnRzW2kgKyAyXTsKICAgIGlmICghdGhpcy5fLmhhc093blByb3BlcnR5KHR5cGUpKSB0aHJvdyBuZXcgRXJyb3IoInVua25vd24gdHlwZTogIiArIHR5cGUpOwogICAgZm9yICh0ID0gdGhpcy5fW3R5cGVdLCBpID0gMCwgbiA9IHQubGVuZ3RoOyBpIDwgbjsgKytpKSB0W2ldLnZhbHVlLmFwcGx5KHRoYXQsIGFyZ3MpOwogIH0sCiAgYXBwbHk6IGZ1bmN0aW9uKHR5cGUsIHRoYXQsIGFyZ3MpIHsKICAgIGlmICghdGhpcy5fLmhhc093blByb3BlcnR5KHR5cGUpKSB0aHJvdyBuZXcgRXJyb3IoInVua25vd24gdHlwZTogIiArIHR5cGUpOwogICAgZm9yICh2YXIgdCA9IHRoaXMuX1t0eXBlXSwgaSA9IDAsIG4gPSB0Lmxlbmd0aDsgaSA8IG47ICsraSkgdFtpXS52YWx1ZS5hcHBseSh0aGF0LCBhcmdzKTsKICB9Cn07CgpmdW5jdGlvbiBnZXQodHlwZSwgbmFtZSkgewogIGZvciAodmFyIGkgPSAwLCBuID0gdHlwZS5sZW5ndGgsIGM7IGkgPCBuOyArK2kpIHsKICAgIGlmICgoYyA9IHR5cGVbaV0pLm5hbWUgPT09IG5hbWUpIHsKICAgICAgcmV0dXJuIGMudmFsdWU7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBzZXQodHlwZSwgbmFtZSwgY2FsbGJhY2spIHsKICBmb3IgKHZhciBpID0gMCwgbiA9IHR5cGUubGVuZ3RoOyBpIDwgbjsgKytpKSB7CiAgICBpZiAodHlwZVtpXS5uYW1lID09PSBuYW1lKSB7CiAgICAgIHR5cGVbaV0gPSBub29wLCB0eXBlID0gdHlwZS5zbGljZSgwLCBpKS5jb25jYXQodHlwZS5zbGljZShpICsgMSkpOwogICAgICBicmVhazsKICAgIH0KICB9CiAgaWYgKGNhbGxiYWNrICE9IG51bGwpIHR5cGUucHVzaCh7bmFtZTogbmFtZSwgdmFsdWU6IGNhbGxiYWNrfSk7CiAgcmV0dXJuIHR5cGU7Cn0KCnZhciB4aHRtbCA9ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIjsKCnZhciBuYW1lc3BhY2VzID0gewogIHN2ZzogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiwKICB4aHRtbDogeGh0bWwsCiAgeGxpbms6ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiwKICB4bWw6ICJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UiLAogIHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC94bWxucy8iCn07CgpmdW5jdGlvbiBuYW1lc3BhY2UobmFtZSkgewogIHZhciBwcmVmaXggPSBuYW1lICs9ICIiLCBpID0gcHJlZml4LmluZGV4T2YoIjoiKTsKICBpZiAoaSA+PSAwICYmIChwcmVmaXggPSBuYW1lLnNsaWNlKDAsIGkpKSAhPT0gInhtbG5zIikgbmFtZSA9IG5hbWUuc2xpY2UoaSArIDEpOwogIHJldHVybiBuYW1lc3BhY2VzLmhhc093blByb3BlcnR5KHByZWZpeCkgPyB7c3BhY2U6IG5hbWVzcGFjZXNbcHJlZml4XSwgbG9jYWw6IG5hbWV9IDogbmFtZTsKfQoKZnVuY3Rpb24gY3JlYXRvckluaGVyaXQobmFtZSkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHZhciBkb2N1bWVudCA9IHRoaXMub3duZXJEb2N1bWVudCwKICAgICAgICB1cmkgPSB0aGlzLm5hbWVzcGFjZVVSSTsKICAgIHJldHVybiB1cmkgPT09IHhodG1sICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5uYW1lc3BhY2VVUkkgPT09IHhodG1sCiAgICAgICAgPyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG5hbWUpCiAgICAgICAgOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlModXJpLCBuYW1lKTsKICB9Owp9CgpmdW5jdGlvbiBjcmVhdG9yRml4ZWQoZnVsbG5hbWUpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhmdWxsbmFtZS5zcGFjZSwgZnVsbG5hbWUubG9jYWwpOwogIH07Cn0KCmZ1bmN0aW9uIGNyZWF0b3IobmFtZSkgewogIHZhciBmdWxsbmFtZSA9IG5hbWVzcGFjZShuYW1lKTsKICByZXR1cm4gKGZ1bGxuYW1lLmxvY2FsCiAgICAgID8gY3JlYXRvckZpeGVkCiAgICAgIDogY3JlYXRvckluaGVyaXQpKGZ1bGxuYW1lKTsKfQoKZnVuY3Rpb24gbm9uZSgpIHt9CgpmdW5jdGlvbiBzZWxlY3RvcihzZWxlY3RvcikgewogIHJldHVybiBzZWxlY3RvciA9PSBudWxsID8gbm9uZSA6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7CiAgfTsKfQoKZnVuY3Rpb24gc2VsZWN0aW9uX3NlbGVjdChzZWxlY3QpIHsKICBpZiAodHlwZW9mIHNlbGVjdCAhPT0gImZ1bmN0aW9uIikgc2VsZWN0ID0gc2VsZWN0b3Ioc2VsZWN0KTsKCiAgZm9yICh2YXIgZ3JvdXBzID0gdGhpcy5fZ3JvdXBzLCBtID0gZ3JvdXBzLmxlbmd0aCwgc3ViZ3JvdXBzID0gbmV3IEFycmF5KG0pLCBqID0gMDsgaiA8IG07ICsraikgewogICAgZm9yICh2YXIgZ3JvdXAgPSBncm91cHNbal0sIG4gPSBncm91cC5sZW5ndGgsIHN1Ymdyb3VwID0gc3ViZ3JvdXBzW2pdID0gbmV3IEFycmF5KG4pLCBub2RlLCBzdWJub2RlLCBpID0gMDsgaSA8IG47ICsraSkgewogICAgICBpZiAoKG5vZGUgPSBncm91cFtpXSkgJiYgKHN1Ym5vZGUgPSBzZWxlY3QuY2FsbChub2RlLCBub2RlLl9fZGF0YV9fLCBpLCBncm91cCkpKSB7CiAgICAgICAgaWYgKCJfX2RhdGFfXyIgaW4gbm9kZSkgc3Vibm9kZS5fX2RhdGFfXyA9IG5vZGUuX19kYXRhX187CiAgICAgICAgc3ViZ3JvdXBbaV0gPSBzdWJub2RlOwogICAgICB9CiAgICB9CiAgfQoKICByZXR1cm4gbmV3IFNlbGVjdGlvbihzdWJncm91cHMsIHRoaXMuX3BhcmVudHMpOwp9CgpmdW5jdGlvbiBlbXB0eSgpIHsKICByZXR1cm4gW107Cn0KCmZ1bmN0aW9uIHNlbGVjdG9yQWxsKHNlbGVjdG9yKSB7CiAgcmV0dXJuIHNlbGVjdG9yID09IG51bGwgPyBlbXB0eSA6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgfTsKfQoKZnVuY3Rpb24gc2VsZWN0aW9uX3NlbGVjdEFsbChzZWxlY3QpIHsKICBpZiAodHlwZW9mIHNlbGVjdCAhPT0gImZ1bmN0aW9uIikgc2VsZWN0ID0gc2VsZWN0b3JBbGwoc2VsZWN0KTsKCiAgZm9yICh2YXIgZ3JvdXBzID0gdGhpcy5fZ3JvdXBzLCBtID0gZ3JvdXBzLmxlbmd0aCwgc3ViZ3JvdXBzID0gW10sIHBhcmVudHMgPSBbXSwgaiA9IDA7IGogPCBtOyArK2opIHsKICAgIGZvciAodmFyIGdyb3VwID0gZ3JvdXBzW2pdLCBuID0gZ3JvdXAubGVuZ3RoLCBub2RlLCBpID0gMDsgaSA8IG47ICsraSkgewogICAgICBpZiAobm9kZSA9IGdyb3VwW2ldKSB7CiAgICAgICAgc3ViZ3JvdXBzLnB1c2goc2VsZWN0LmNhbGwobm9kZSwgbm9kZS5fX2RhdGFfXywgaSwgZ3JvdXApKTsKICAgICAgICBwYXJlbnRzLnB1c2gobm9kZSk7CiAgICAgIH0KICAgIH0KICB9CgogIHJldHVybiBuZXcgU2VsZWN0aW9uKHN1Ymdyb3VwcywgcGFyZW50cyk7Cn0KCnZhciBtYXRjaGVyID0gZnVuY3Rpb24oc2VsZWN0b3IpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5tYXRjaGVzKHNlbGVjdG9yKTsKICB9Owp9OwoKaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gInVuZGVmaW5lZCIpIHsKICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICBpZiAoIWVsZW1lbnQubWF0Y2hlcykgewogICAgdmFyIHZlbmRvck1hdGNoZXMgPSBlbGVtZW50LndlYmtpdE1hdGNoZXNTZWxlY3RvcgogICAgICAgIHx8IGVsZW1lbnQubXNNYXRjaGVzU2VsZWN0b3IKICAgICAgICB8fCBlbGVtZW50Lm1vek1hdGNoZXNTZWxlY3RvcgogICAgICAgIHx8IGVsZW1lbnQub01hdGNoZXNTZWxlY3RvcjsKICAgIG1hdGNoZXIgPSBmdW5jdGlvbihzZWxlY3RvcikgewogICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHZlbmRvck1hdGNoZXMuY2FsbCh0aGlzLCBzZWxlY3Rvcik7CiAgICAgIH07CiAgICB9OwogIH0KfQoKdmFyIG1hdGNoZXIkMSA9IG1hdGNoZXI7CgpmdW5jdGlvbiBzZWxlY3Rpb25fZmlsdGVyKG1hdGNoKSB7CiAgaWYgKHR5cGVvZiBtYXRjaCAhPT0gImZ1bmN0aW9uIikgbWF0Y2ggPSBtYXRjaGVyJDEobWF0Y2gpOwoKICBmb3IgKHZhciBncm91cHMgPSB0aGlzLl9ncm91cHMsIG0gPSBncm91cHMubGVuZ3RoLCBzdWJncm91cHMgPSBuZXcgQXJyYXkobSksIGogPSAwOyBqIDwgbTsgKytqKSB7CiAgICBmb3IgKHZhciBncm91cCA9IGdyb3Vwc1tqXSwgbiA9IGdyb3VwLmxlbmd0aCwgc3ViZ3JvdXAgPSBzdWJncm91cHNbal0gPSBbXSwgbm9kZSwgaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgaWYgKChub2RlID0gZ3JvdXBbaV0pICYmIG1hdGNoLmNhbGwobm9kZSwgbm9kZS5fX2RhdGFfXywgaSwgZ3JvdXApKSB7CiAgICAgICAgc3ViZ3JvdXAucHVzaChub2RlKTsKICAgICAgfQogICAgfQogIH0KCiAgcmV0dXJuIG5ldyBTZWxlY3Rpb24oc3ViZ3JvdXBzLCB0aGlzLl9wYXJlbnRzKTsKfQoKZnVuY3Rpb24gc3BhcnNlKHVwZGF0ZSkgewogIHJldHVybiBuZXcgQXJyYXkodXBkYXRlLmxlbmd0aCk7Cn0KCmZ1bmN0aW9uIHNlbGVjdGlvbl9lbnRlcigpIHsKICByZXR1cm4gbmV3IFNlbGVjdGlvbih0aGlzLl9lbnRlciB8fCB0aGlzLl9ncm91cHMubWFwKHNwYXJzZSksIHRoaXMuX3BhcmVudHMpOwp9CgpmdW5jdGlvbiBFbnRlck5vZGUocGFyZW50LCBkYXR1bSkgewogIHRoaXMub3duZXJEb2N1bWVudCA9IHBhcmVudC5vd25lckRvY3VtZW50OwogIHRoaXMubmFtZXNwYWNlVVJJID0gcGFyZW50Lm5hbWVzcGFjZVVSSTsKICB0aGlzLl9uZXh0ID0gbnVsbDsKICB0aGlzLl9wYXJlbnQgPSBwYXJlbnQ7CiAgdGhpcy5fX2RhdGFfXyA9IGRhdHVtOwp9CgpFbnRlck5vZGUucHJvdG90eXBlID0gewogIGNvbnN0cnVjdG9yOiBFbnRlck5vZGUsCiAgYXBwZW5kQ2hpbGQ6IGZ1bmN0aW9uKGNoaWxkKSB7IHJldHVybiB0aGlzLl9wYXJlbnQuaW5zZXJ0QmVmb3JlKGNoaWxkLCB0aGlzLl9uZXh0KTsgfSwKICBpbnNlcnRCZWZvcmU6IGZ1bmN0aW9uKGNoaWxkLCBuZXh0KSB7IHJldHVybiB0aGlzLl9wYXJlbnQuaW5zZXJ0QmVmb3JlKGNoaWxkLCBuZXh0KTsgfSwKICBxdWVyeVNlbGVjdG9yOiBmdW5jdGlvbihzZWxlY3RvcikgeyByZXR1cm4gdGhpcy5fcGFyZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpOyB9LAogIHF1ZXJ5U2VsZWN0b3JBbGw6IGZ1bmN0aW9uKHNlbGVjdG9yKSB7IHJldHVybiB0aGlzLl9wYXJlbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7IH0KfTsKCmZ1bmN0aW9uIGNvbnN0YW50JDEoeCkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB4OwogIH07Cn0KCnZhciBrZXlQcmVmaXggPSAiJCI7IC8vIFByb3RlY3QgYWdhaW5zdCBrZXlzIGxpa2Ug4oCcX19wcm90b19f4oCdLgoKZnVuY3Rpb24gYmluZEluZGV4KHBhcmVudCwgZ3JvdXAsIGVudGVyLCB1cGRhdGUsIGV4aXQsIGRhdGEpIHsKICB2YXIgaSA9IDAsCiAgICAgIG5vZGUsCiAgICAgIGdyb3VwTGVuZ3RoID0gZ3JvdXAubGVuZ3RoLAogICAgICBkYXRhTGVuZ3RoID0gZGF0YS5sZW5ndGg7CgogIC8vIFB1dCBhbnkgbm9uLW51bGwgbm9kZXMgdGhhdCBmaXQgaW50byB1cGRhdGUuCiAgLy8gUHV0IGFueSBudWxsIG5vZGVzIGludG8gZW50ZXIuCiAgLy8gUHV0IGFueSByZW1haW5pbmcgZGF0YSBpbnRvIGVudGVyLgogIGZvciAoOyBpIDwgZGF0YUxlbmd0aDsgKytpKSB7CiAgICBpZiAobm9kZSA9IGdyb3VwW2ldKSB7CiAgICAgIG5vZGUuX19kYXRhX18gPSBkYXRhW2ldOwogICAgICB1cGRhdGVbaV0gPSBub2RlOwogICAgfSBlbHNlIHsKICAgICAgZW50ZXJbaV0gPSBuZXcgRW50ZXJOb2RlKHBhcmVudCwgZGF0YVtpXSk7CiAgICB9CiAgfQoKICAvLyBQdXQgYW55IG5vbi1udWxsIG5vZGVzIHRoYXQgZG9u4oCZdCBmaXQgaW50byBleGl0LgogIGZvciAoOyBpIDwgZ3JvdXBMZW5ndGg7ICsraSkgewogICAgaWYgKG5vZGUgPSBncm91cFtpXSkgewogICAgICBleGl0W2ldID0gbm9kZTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIGJpbmRLZXkocGFyZW50LCBncm91cCwgZW50ZXIsIHVwZGF0ZSwgZXhpdCwgZGF0YSwga2V5KSB7CiAgdmFyIGksCiAgICAgIG5vZGUsCiAgICAgIG5vZGVCeUtleVZhbHVlID0ge30sCiAgICAgIGdyb3VwTGVuZ3RoID0gZ3JvdXAubGVuZ3RoLAogICAgICBkYXRhTGVuZ3RoID0gZGF0YS5sZW5ndGgsCiAgICAgIGtleVZhbHVlcyA9IG5ldyBBcnJheShncm91cExlbmd0aCksCiAgICAgIGtleVZhbHVlOwoKICAvLyBDb21wdXRlIHRoZSBrZXkgZm9yIGVhY2ggbm9kZS4KICAvLyBJZiBtdWx0aXBsZSBub2RlcyBoYXZlIHRoZSBzYW1lIGtleSwgdGhlIGR1cGxpY2F0ZXMgYXJlIGFkZGVkIHRvIGV4aXQuCiAgZm9yIChpID0gMDsgaSA8IGdyb3VwTGVuZ3RoOyArK2kpIHsKICAgIGlmIChub2RlID0gZ3JvdXBbaV0pIHsKICAgICAga2V5VmFsdWVzW2ldID0ga2V5VmFsdWUgPSBrZXlQcmVmaXggKyBrZXkuY2FsbChub2RlLCBub2RlLl9fZGF0YV9fLCBpLCBncm91cCk7CiAgICAgIGlmIChrZXlWYWx1ZSBpbiBub2RlQnlLZXlWYWx1ZSkgewogICAgICAgIGV4aXRbaV0gPSBub2RlOwogICAgICB9IGVsc2UgewogICAgICAgIG5vZGVCeUtleVZhbHVlW2tleVZhbHVlXSA9IG5vZGU7CiAgICAgIH0KICAgIH0KICB9CgogIC8vIENvbXB1dGUgdGhlIGtleSBmb3IgZWFjaCBkYXR1bS4KICAvLyBJZiB0aGVyZSBhIG5vZGUgYXNzb2NpYXRlZCB3aXRoIHRoaXMga2V5LCBqb2luIGFuZCBhZGQgaXQgdG8gdXBkYXRlLgogIC8vIElmIHRoZXJlIGlzIG5vdCAob3IgdGhlIGtleSBpcyBhIGR1cGxpY2F0ZSksIGFkZCBpdCB0byBlbnRlci4KICBmb3IgKGkgPSAwOyBpIDwgZGF0YUxlbmd0aDsgKytpKSB7CiAgICBrZXlWYWx1ZSA9IGtleVByZWZpeCArIGtleS5jYWxsKHBhcmVudCwgZGF0YVtpXSwgaSwgZGF0YSk7CiAgICBpZiAobm9kZSA9IG5vZGVCeUtleVZhbHVlW2tleVZhbHVlXSkgewogICAgICB1cGRhdGVbaV0gPSBub2RlOwogICAgICBub2RlLl9fZGF0YV9fID0gZGF0YVtpXTsKICAgICAgbm9kZUJ5S2V5VmFsdWVba2V5VmFsdWVdID0gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIGVudGVyW2ldID0gbmV3IEVudGVyTm9kZShwYXJlbnQsIGRhdGFbaV0pOwogICAgfQogIH0KCiAgLy8gQWRkIGFueSByZW1haW5pbmcgbm9kZXMgdGhhdCB3ZXJlIG5vdCBib3VuZCB0byBkYXRhIHRvIGV4aXQuCiAgZm9yIChpID0gMDsgaSA8IGdyb3VwTGVuZ3RoOyArK2kpIHsKICAgIGlmICgobm9kZSA9IGdyb3VwW2ldKSAmJiAobm9kZUJ5S2V5VmFsdWVba2V5VmFsdWVzW2ldXSA9PT0gbm9kZSkpIHsKICAgICAgZXhpdFtpXSA9IG5vZGU7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBzZWxlY3Rpb25fZGF0YSh2YWx1ZSwga2V5KSB7CiAgaWYgKCF2YWx1ZSkgewogICAgZGF0YSA9IG5ldyBBcnJheSh0aGlzLnNpemUoKSksIGogPSAtMTsKICAgIHRoaXMuZWFjaChmdW5jdGlvbihkKSB7IGRhdGFbKytqXSA9IGQ7IH0pOwogICAgcmV0dXJuIGRhdGE7CiAgfQoKICB2YXIgYmluZCA9IGtleSA/IGJpbmRLZXkgOiBiaW5kSW5kZXgsCiAgICAgIHBhcmVudHMgPSB0aGlzLl9wYXJlbnRzLAogICAgICBncm91cHMgPSB0aGlzLl9ncm91cHM7CgogIGlmICh0eXBlb2YgdmFsdWUgIT09ICJmdW5jdGlvbiIpIHZhbHVlID0gY29uc3RhbnQkMSh2YWx1ZSk7CgogIGZvciAodmFyIG0gPSBncm91cHMubGVuZ3RoLCB1cGRhdGUgPSBuZXcgQXJyYXkobSksIGVudGVyID0gbmV3IEFycmF5KG0pLCBleGl0ID0gbmV3IEFycmF5KG0pLCBqID0gMDsgaiA8IG07ICsraikgewogICAgdmFyIHBhcmVudCA9IHBhcmVudHNbal0sCiAgICAgICAgZ3JvdXAgPSBncm91cHNbal0sCiAgICAgICAgZ3JvdXBMZW5ndGggPSBncm91cC5sZW5ndGgsCiAgICAgICAgZGF0YSA9IHZhbHVlLmNhbGwocGFyZW50LCBwYXJlbnQgJiYgcGFyZW50Ll9fZGF0YV9fLCBqLCBwYXJlbnRzKSwKICAgICAgICBkYXRhTGVuZ3RoID0gZGF0YS5sZW5ndGgsCiAgICAgICAgZW50ZXJHcm91cCA9IGVudGVyW2pdID0gbmV3IEFycmF5KGRhdGFMZW5ndGgpLAogICAgICAgIHVwZGF0ZUdyb3VwID0gdXBkYXRlW2pdID0gbmV3IEFycmF5KGRhdGFMZW5ndGgpLAogICAgICAgIGV4aXRHcm91cCA9IGV4aXRbal0gPSBuZXcgQXJyYXkoZ3JvdXBMZW5ndGgpOwoKICAgIGJpbmQocGFyZW50LCBncm91cCwgZW50ZXJHcm91cCwgdXBkYXRlR3JvdXAsIGV4aXRHcm91cCwgZGF0YSwga2V5KTsKCiAgICAvLyBOb3cgY29ubmVjdCB0aGUgZW50ZXIgbm9kZXMgdG8gdGhlaXIgZm9sbG93aW5nIHVwZGF0ZSBub2RlLCBzdWNoIHRoYXQKICAgIC8vIGFwcGVuZENoaWxkIGNhbiBpbnNlcnQgdGhlIG1hdGVyaWFsaXplZCBlbnRlciBub2RlIGJlZm9yZSB0aGlzIG5vZGUsCiAgICAvLyByYXRoZXIgdGhhbiBhdCB0aGUgZW5kIG9mIHRoZSBwYXJlbnQgbm9kZS4KICAgIGZvciAodmFyIGkwID0gMCwgaTEgPSAwLCBwcmV2aW91cywgbmV4dDsgaTAgPCBkYXRhTGVuZ3RoOyArK2kwKSB7CiAgICAgIGlmIChwcmV2aW91cyA9IGVudGVyR3JvdXBbaTBdKSB7CiAgICAgICAgaWYgKGkwID49IGkxKSBpMSA9IGkwICsgMTsKICAgICAgICB3aGlsZSAoIShuZXh0ID0gdXBkYXRlR3JvdXBbaTFdKSAmJiArK2kxIDwgZGF0YUxlbmd0aCk7CiAgICAgICAgcHJldmlvdXMuX25leHQgPSBuZXh0IHx8IG51bGw7CiAgICAgIH0KICAgIH0KICB9CgogIHVwZGF0ZSA9IG5ldyBTZWxlY3Rpb24odXBkYXRlLCBwYXJlbnRzKTsKICB1cGRhdGUuX2VudGVyID0gZW50ZXI7CiAgdXBkYXRlLl9leGl0ID0gZXhpdDsKICByZXR1cm4gdXBkYXRlOwp9CgpmdW5jdGlvbiBzZWxlY3Rpb25fZXhpdCgpIHsKICByZXR1cm4gbmV3IFNlbGVjdGlvbih0aGlzLl9leGl0IHx8IHRoaXMuX2dyb3Vwcy5tYXAoc3BhcnNlKSwgdGhpcy5fcGFyZW50cyk7Cn0KCmZ1bmN0aW9uIHNlbGVjdGlvbl9tZXJnZShzZWxlY3Rpb24kJDEpIHsKCiAgZm9yICh2YXIgZ3JvdXBzMCA9IHRoaXMuX2dyb3VwcywgZ3JvdXBzMSA9IHNlbGVjdGlvbiQkMS5fZ3JvdXBzLCBtMCA9IGdyb3VwczAubGVuZ3RoLCBtMSA9IGdyb3VwczEubGVuZ3RoLCBtID0gTWF0aC5taW4obTAsIG0xKSwgbWVyZ2VzID0gbmV3IEFycmF5KG0wKSwgaiA9IDA7IGogPCBtOyArK2opIHsKICAgIGZvciAodmFyIGdyb3VwMCA9IGdyb3VwczBbal0sIGdyb3VwMSA9IGdyb3VwczFbal0sIG4gPSBncm91cDAubGVuZ3RoLCBtZXJnZSA9IG1lcmdlc1tqXSA9IG5ldyBBcnJheShuKSwgbm9kZSwgaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgaWYgKG5vZGUgPSBncm91cDBbaV0gfHwgZ3JvdXAxW2ldKSB7CiAgICAgICAgbWVyZ2VbaV0gPSBub2RlOwogICAgICB9CiAgICB9CiAgfQoKICBmb3IgKDsgaiA8IG0wOyArK2opIHsKICAgIG1lcmdlc1tqXSA9IGdyb3VwczBbal07CiAgfQoKICByZXR1cm4gbmV3IFNlbGVjdGlvbihtZXJnZXMsIHRoaXMuX3BhcmVudHMpOwp9CgpmdW5jdGlvbiBzZWxlY3Rpb25fb3JkZXIoKSB7CgogIGZvciAodmFyIGdyb3VwcyA9IHRoaXMuX2dyb3VwcywgaiA9IC0xLCBtID0gZ3JvdXBzLmxlbmd0aDsgKytqIDwgbTspIHsKICAgIGZvciAodmFyIGdyb3VwID0gZ3JvdXBzW2pdLCBpID0gZ3JvdXAubGVuZ3RoIC0gMSwgbmV4dCA9IGdyb3VwW2ldLCBub2RlOyAtLWkgPj0gMDspIHsKICAgICAgaWYgKG5vZGUgPSBncm91cFtpXSkgewogICAgICAgIGlmIChuZXh0ICYmIG5leHQgIT09IG5vZGUubmV4dFNpYmxpbmcpIG5leHQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobm9kZSwgbmV4dCk7CiAgICAgICAgbmV4dCA9IG5vZGU7CiAgICAgIH0KICAgIH0KICB9CgogIHJldHVybiB0aGlzOwp9CgpmdW5jdGlvbiBzZWxlY3Rpb25fc29ydChjb21wYXJlKSB7CiAgaWYgKCFjb21wYXJlKSBjb21wYXJlID0gYXNjZW5kaW5nJDE7CgogIGZ1bmN0aW9uIGNvbXBhcmVOb2RlKGEsIGIpIHsKICAgIHJldHVybiBhICYmIGIgPyBjb21wYXJlKGEuX19kYXRhX18sIGIuX19kYXRhX18pIDogIWEgLSAhYjsKICB9CgogIGZvciAodmFyIGdyb3VwcyA9IHRoaXMuX2dyb3VwcywgbSA9IGdyb3Vwcy5sZW5ndGgsIHNvcnRncm91cHMgPSBuZXcgQXJyYXkobSksIGogPSAwOyBqIDwgbTsgKytqKSB7CiAgICBmb3IgKHZhciBncm91cCA9IGdyb3Vwc1tqXSwgbiA9IGdyb3VwLmxlbmd0aCwgc29ydGdyb3VwID0gc29ydGdyb3Vwc1tqXSA9IG5ldyBBcnJheShuKSwgbm9kZSwgaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgaWYgKG5vZGUgPSBncm91cFtpXSkgewogICAgICAgIHNvcnRncm91cFtpXSA9IG5vZGU7CiAgICAgIH0KICAgIH0KICAgIHNvcnRncm91cC5zb3J0KGNvbXBhcmVOb2RlKTsKICB9CgogIHJldHVybiBuZXcgU2VsZWN0aW9uKHNvcnRncm91cHMsIHRoaXMuX3BhcmVudHMpLm9yZGVyKCk7Cn0KCmZ1bmN0aW9uIGFzY2VuZGluZyQxKGEsIGIpIHsKICByZXR1cm4gYSA8IGIgPyAtMSA6IGEgPiBiID8gMSA6IGEgPj0gYiA/IDAgOiBOYU47Cn0KCmZ1bmN0aW9uIHNlbGVjdGlvbl9jYWxsKCkgewogIHZhciBjYWxsYmFjayA9IGFyZ3VtZW50c1swXTsKICBhcmd1bWVudHNbMF0gPSB0aGlzOwogIGNhbGxiYWNrLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgcmV0dXJuIHRoaXM7Cn0KCmZ1bmN0aW9uIHNlbGVjdGlvbl9ub2RlcygpIHsKICB2YXIgbm9kZXMgPSBuZXcgQXJyYXkodGhpcy5zaXplKCkpLCBpID0gLTE7CiAgdGhpcy5lYWNoKGZ1bmN0aW9uKCkgeyBub2Rlc1srK2ldID0gdGhpczsgfSk7CiAgcmV0dXJuIG5vZGVzOwp9CgpmdW5jdGlvbiBzZWxlY3Rpb25fbm9kZSgpIHsKCiAgZm9yICh2YXIgZ3JvdXBzID0gdGhpcy5fZ3JvdXBzLCBqID0gMCwgbSA9IGdyb3Vwcy5sZW5ndGg7IGogPCBtOyArK2opIHsKICAgIGZvciAodmFyIGdyb3VwID0gZ3JvdXBzW2pdLCBpID0gMCwgbiA9IGdyb3VwLmxlbmd0aDsgaSA8IG47ICsraSkgewogICAgICB2YXIgbm9kZSA9IGdyb3VwW2ldOwogICAgICBpZiAobm9kZSkgcmV0dXJuIG5vZGU7CiAgICB9CiAgfQoKICByZXR1cm4gbnVsbDsKfQoKZnVuY3Rpb24gc2VsZWN0aW9uX3NpemUoKSB7CiAgdmFyIHNpemUgPSAwOwogIHRoaXMuZWFjaChmdW5jdGlvbigpIHsgKytzaXplOyB9KTsKICByZXR1cm4gc2l6ZTsKfQoKZnVuY3Rpb24gc2VsZWN0aW9uX2VtcHR5KCkgewogIHJldHVybiAhdGhpcy5ub2RlKCk7Cn0KCmZ1bmN0aW9uIHNlbGVjdGlvbl9lYWNoKGNhbGxiYWNrKSB7CgogIGZvciAodmFyIGdyb3VwcyA9IHRoaXMuX2dyb3VwcywgaiA9IDAsIG0gPSBncm91cHMubGVuZ3RoOyBqIDwgbTsgKytqKSB7CiAgICBmb3IgKHZhciBncm91cCA9IGdyb3Vwc1tqXSwgaSA9IDAsIG4gPSBncm91cC5sZW5ndGgsIG5vZGU7IGkgPCBuOyArK2kpIHsKICAgICAgaWYgKG5vZGUgPSBncm91cFtpXSkgY2FsbGJhY2suY2FsbChub2RlLCBub2RlLl9fZGF0YV9fLCBpLCBncm91cCk7CiAgICB9CiAgfQoKICByZXR1cm4gdGhpczsKfQoKZnVuY3Rpb24gYXR0clJlbW92ZShuYW1lKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgdGhpcy5yZW1vdmVBdHRyaWJ1dGUobmFtZSk7CiAgfTsKfQoKZnVuY3Rpb24gYXR0clJlbW92ZU5TKGZ1bGxuYW1lKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgdGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyhmdWxsbmFtZS5zcGFjZSwgZnVsbG5hbWUubG9jYWwpOwogIH07Cn0KCmZ1bmN0aW9uIGF0dHJDb25zdGFudChuYW1lLCB2YWx1ZSkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHRoaXMuc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTsKICB9Owp9CgpmdW5jdGlvbiBhdHRyQ29uc3RhbnROUyhmdWxsbmFtZSwgdmFsdWUpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB0aGlzLnNldEF0dHJpYnV0ZU5TKGZ1bGxuYW1lLnNwYWNlLCBmdWxsbmFtZS5sb2NhbCwgdmFsdWUpOwogIH07Cn0KCmZ1bmN0aW9uIGF0dHJGdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHZhciB2ID0gdmFsdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIGlmICh2ID09IG51bGwpIHRoaXMucmVtb3ZlQXR0cmlidXRlKG5hbWUpOwogICAgZWxzZSB0aGlzLnNldEF0dHJpYnV0ZShuYW1lLCB2KTsKICB9Owp9CgpmdW5jdGlvbiBhdHRyRnVuY3Rpb25OUyhmdWxsbmFtZSwgdmFsdWUpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB2YXIgdiA9IHZhbHVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICBpZiAodiA9PSBudWxsKSB0aGlzLnJlbW92ZUF0dHJpYnV0ZU5TKGZ1bGxuYW1lLnNwYWNlLCBmdWxsbmFtZS5sb2NhbCk7CiAgICBlbHNlIHRoaXMuc2V0QXR0cmlidXRlTlMoZnVsbG5hbWUuc3BhY2UsIGZ1bGxuYW1lLmxvY2FsLCB2KTsKICB9Owp9CgpmdW5jdGlvbiBzZWxlY3Rpb25fYXR0cihuYW1lLCB2YWx1ZSkgewogIHZhciBmdWxsbmFtZSA9IG5hbWVzcGFjZShuYW1lKTsKCiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSB7CiAgICB2YXIgbm9kZSA9IHRoaXMubm9kZSgpOwogICAgcmV0dXJuIGZ1bGxuYW1lLmxvY2FsCiAgICAgICAgPyBub2RlLmdldEF0dHJpYnV0ZU5TKGZ1bGxuYW1lLnNwYWNlLCBmdWxsbmFtZS5sb2NhbCkKICAgICAgICA6IG5vZGUuZ2V0QXR0cmlidXRlKGZ1bGxuYW1lKTsKICB9CgogIHJldHVybiB0aGlzLmVhY2goKHZhbHVlID09IG51bGwKICAgICAgPyAoZnVsbG5hbWUubG9jYWwgPyBhdHRyUmVtb3ZlTlMgOiBhdHRyUmVtb3ZlKSA6ICh0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIKICAgICAgPyAoZnVsbG5hbWUubG9jYWwgPyBhdHRyRnVuY3Rpb25OUyA6IGF0dHJGdW5jdGlvbikKICAgICAgOiAoZnVsbG5hbWUubG9jYWwgPyBhdHRyQ29uc3RhbnROUyA6IGF0dHJDb25zdGFudCkpKShmdWxsbmFtZSwgdmFsdWUpKTsKfQoKZnVuY3Rpb24gZGVmYXVsdFZpZXcobm9kZSkgewogIHJldHVybiAobm9kZS5vd25lckRvY3VtZW50ICYmIG5vZGUub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldykgLy8gbm9kZSBpcyBhIE5vZGUKICAgICAgfHwgKG5vZGUuZG9jdW1lbnQgJiYgbm9kZSkgLy8gbm9kZSBpcyBhIFdpbmRvdwogICAgICB8fCBub2RlLmRlZmF1bHRWaWV3OyAvLyBub2RlIGlzIGEgRG9jdW1lbnQKfQoKZnVuY3Rpb24gc3R5bGVSZW1vdmUobmFtZSkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHRoaXMuc3R5bGUucmVtb3ZlUHJvcGVydHkobmFtZSk7CiAgfTsKfQoKZnVuY3Rpb24gc3R5bGVDb25zdGFudChuYW1lLCB2YWx1ZSwgcHJpb3JpdHkpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB0aGlzLnN0eWxlLnNldFByb3BlcnR5KG5hbWUsIHZhbHVlLCBwcmlvcml0eSk7CiAgfTsKfQoKZnVuY3Rpb24gc3R5bGVGdW5jdGlvbihuYW1lLCB2YWx1ZSwgcHJpb3JpdHkpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB2YXIgdiA9IHZhbHVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICBpZiAodiA9PSBudWxsKSB0aGlzLnN0eWxlLnJlbW92ZVByb3BlcnR5KG5hbWUpOwogICAgZWxzZSB0aGlzLnN0eWxlLnNldFByb3BlcnR5KG5hbWUsIHYsIHByaW9yaXR5KTsKICB9Owp9CgpmdW5jdGlvbiBzZWxlY3Rpb25fc3R5bGUobmFtZSwgdmFsdWUsIHByaW9yaXR5KSB7CiAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPiAxCiAgICAgID8gdGhpcy5lYWNoKCh2YWx1ZSA9PSBudWxsCiAgICAgICAgICAgID8gc3R5bGVSZW1vdmUgOiB0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIKICAgICAgICAgICAgPyBzdHlsZUZ1bmN0aW9uCiAgICAgICAgICAgIDogc3R5bGVDb25zdGFudCkobmFtZSwgdmFsdWUsIHByaW9yaXR5ID09IG51bGwgPyAiIiA6IHByaW9yaXR5KSkKICAgICAgOiBzdHlsZVZhbHVlKHRoaXMubm9kZSgpLCBuYW1lKTsKfQoKZnVuY3Rpb24gc3R5bGVWYWx1ZShub2RlLCBuYW1lKSB7CiAgcmV0dXJuIG5vZGUuc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShuYW1lKQogICAgICB8fCBkZWZhdWx0Vmlldyhub2RlKS5nZXRDb21wdXRlZFN0eWxlKG5vZGUsIG51bGwpLmdldFByb3BlcnR5VmFsdWUobmFtZSk7Cn0KCmZ1bmN0aW9uIHByb3BlcnR5UmVtb3ZlKG5hbWUpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICBkZWxldGUgdGhpc1tuYW1lXTsKICB9Owp9CgpmdW5jdGlvbiBwcm9wZXJ0eUNvbnN0YW50KG5hbWUsIHZhbHVlKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgdGhpc1tuYW1lXSA9IHZhbHVlOwogIH07Cn0KCmZ1bmN0aW9uIHByb3BlcnR5RnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB2YXIgdiA9IHZhbHVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICBpZiAodiA9PSBudWxsKSBkZWxldGUgdGhpc1tuYW1lXTsKICAgIGVsc2UgdGhpc1tuYW1lXSA9IHY7CiAgfTsKfQoKZnVuY3Rpb24gc2VsZWN0aW9uX3Byb3BlcnR5KG5hbWUsIHZhbHVlKSB7CiAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPiAxCiAgICAgID8gdGhpcy5lYWNoKCh2YWx1ZSA9PSBudWxsCiAgICAgICAgICA/IHByb3BlcnR5UmVtb3ZlIDogdHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iCiAgICAgICAgICA/IHByb3BlcnR5RnVuY3Rpb24KICAgICAgICAgIDogcHJvcGVydHlDb25zdGFudCkobmFtZSwgdmFsdWUpKQogICAgICA6IHRoaXMubm9kZSgpW25hbWVdOwp9CgpmdW5jdGlvbiBjbGFzc0FycmF5KHN0cmluZykgewogIHJldHVybiBzdHJpbmcudHJpbSgpLnNwbGl0KC9efFxzKy8pOwp9CgpmdW5jdGlvbiBjbGFzc0xpc3Qobm9kZSkgewogIHJldHVybiBub2RlLmNsYXNzTGlzdCB8fCBuZXcgQ2xhc3NMaXN0KG5vZGUpOwp9CgpmdW5jdGlvbiBDbGFzc0xpc3Qobm9kZSkgewogIHRoaXMuX25vZGUgPSBub2RlOwogIHRoaXMuX25hbWVzID0gY2xhc3NBcnJheShub2RlLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSB8fCAiIik7Cn0KCkNsYXNzTGlzdC5wcm90b3R5cGUgPSB7CiAgYWRkOiBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgaSA9IHRoaXMuX25hbWVzLmluZGV4T2YobmFtZSk7CiAgICBpZiAoaSA8IDApIHsKICAgICAgdGhpcy5fbmFtZXMucHVzaChuYW1lKTsKICAgICAgdGhpcy5fbm9kZS5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgdGhpcy5fbmFtZXMuam9pbigiICIpKTsKICAgIH0KICB9LAogIHJlbW92ZTogZnVuY3Rpb24obmFtZSkgewogICAgdmFyIGkgPSB0aGlzLl9uYW1lcy5pbmRleE9mKG5hbWUpOwogICAgaWYgKGkgPj0gMCkgewogICAgICB0aGlzLl9uYW1lcy5zcGxpY2UoaSwgMSk7CiAgICAgIHRoaXMuX25vZGUuc2V0QXR0cmlidXRlKCJjbGFzcyIsIHRoaXMuX25hbWVzLmpvaW4oIiAiKSk7CiAgICB9CiAgfSwKICBjb250YWluczogZnVuY3Rpb24obmFtZSkgewogICAgcmV0dXJuIHRoaXMuX25hbWVzLmluZGV4T2YobmFtZSkgPj0gMDsKICB9Cn07CgpmdW5jdGlvbiBjbGFzc2VkQWRkKG5vZGUsIG5hbWVzKSB7CiAgdmFyIGxpc3QgPSBjbGFzc0xpc3Qobm9kZSksIGkgPSAtMSwgbiA9IG5hbWVzLmxlbmd0aDsKICB3aGlsZSAoKytpIDwgbikgbGlzdC5hZGQobmFtZXNbaV0pOwp9CgpmdW5jdGlvbiBjbGFzc2VkUmVtb3ZlKG5vZGUsIG5hbWVzKSB7CiAgdmFyIGxpc3QgPSBjbGFzc0xpc3Qobm9kZSksIGkgPSAtMSwgbiA9IG5hbWVzLmxlbmd0aDsKICB3aGlsZSAoKytpIDwgbikgbGlzdC5yZW1vdmUobmFtZXNbaV0pOwp9CgpmdW5jdGlvbiBjbGFzc2VkVHJ1ZShuYW1lcykgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIGNsYXNzZWRBZGQodGhpcywgbmFtZXMpOwogIH07Cn0KCmZ1bmN0aW9uIGNsYXNzZWRGYWxzZShuYW1lcykgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIGNsYXNzZWRSZW1vdmUodGhpcywgbmFtZXMpOwogIH07Cn0KCmZ1bmN0aW9uIGNsYXNzZWRGdW5jdGlvbihuYW1lcywgdmFsdWUpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAodmFsdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKSA/IGNsYXNzZWRBZGQgOiBjbGFzc2VkUmVtb3ZlKSh0aGlzLCBuYW1lcyk7CiAgfTsKfQoKZnVuY3Rpb24gc2VsZWN0aW9uX2NsYXNzZWQobmFtZSwgdmFsdWUpIHsKICB2YXIgbmFtZXMgPSBjbGFzc0FycmF5KG5hbWUgKyAiIik7CgogIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgewogICAgdmFyIGxpc3QgPSBjbGFzc0xpc3QodGhpcy5ub2RlKCkpLCBpID0gLTEsIG4gPSBuYW1lcy5sZW5ndGg7CiAgICB3aGlsZSAoKytpIDwgbikgaWYgKCFsaXN0LmNvbnRhaW5zKG5hbWVzW2ldKSkgcmV0dXJuIGZhbHNlOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICByZXR1cm4gdGhpcy5lYWNoKCh0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIKICAgICAgPyBjbGFzc2VkRnVuY3Rpb24gOiB2YWx1ZQogICAgICA/IGNsYXNzZWRUcnVlCiAgICAgIDogY2xhc3NlZEZhbHNlKShuYW1lcywgdmFsdWUpKTsKfQoKZnVuY3Rpb24gdGV4dFJlbW92ZSgpIHsKICB0aGlzLnRleHRDb250ZW50ID0gIiI7Cn0KCmZ1bmN0aW9uIHRleHRDb25zdGFudCh2YWx1ZSkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHRoaXMudGV4dENvbnRlbnQgPSB2YWx1ZTsKICB9Owp9CgpmdW5jdGlvbiB0ZXh0RnVuY3Rpb24odmFsdWUpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB2YXIgdiA9IHZhbHVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB0aGlzLnRleHRDb250ZW50ID0gdiA9PSBudWxsID8gIiIgOiB2OwogIH07Cn0KCmZ1bmN0aW9uIHNlbGVjdGlvbl90ZXh0KHZhbHVlKSB7CiAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGgKICAgICAgPyB0aGlzLmVhY2godmFsdWUgPT0gbnVsbAogICAgICAgICAgPyB0ZXh0UmVtb3ZlIDogKHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIgogICAgICAgICAgPyB0ZXh0RnVuY3Rpb24KICAgICAgICAgIDogdGV4dENvbnN0YW50KSh2YWx1ZSkpCiAgICAgIDogdGhpcy5ub2RlKCkudGV4dENvbnRlbnQ7Cn0KCmZ1bmN0aW9uIGh0bWxSZW1vdmUoKSB7CiAgdGhpcy5pbm5lckhUTUwgPSAiIjsKfQoKZnVuY3Rpb24gaHRtbENvbnN0YW50KHZhbHVlKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgdGhpcy5pbm5lckhUTUwgPSB2YWx1ZTsKICB9Owp9CgpmdW5jdGlvbiBodG1sRnVuY3Rpb24odmFsdWUpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB2YXIgdiA9IHZhbHVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB0aGlzLmlubmVySFRNTCA9IHYgPT0gbnVsbCA/ICIiIDogdjsKICB9Owp9CgpmdW5jdGlvbiBzZWxlY3Rpb25faHRtbCh2YWx1ZSkgewogIHJldHVybiBhcmd1bWVudHMubGVuZ3RoCiAgICAgID8gdGhpcy5lYWNoKHZhbHVlID09IG51bGwKICAgICAgICAgID8gaHRtbFJlbW92ZSA6ICh0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIKICAgICAgICAgID8gaHRtbEZ1bmN0aW9uCiAgICAgICAgICA6IGh0bWxDb25zdGFudCkodmFsdWUpKQogICAgICA6IHRoaXMubm9kZSgpLmlubmVySFRNTDsKfQoKZnVuY3Rpb24gcmFpc2UoKSB7CiAgaWYgKHRoaXMubmV4dFNpYmxpbmcpIHRoaXMucGFyZW50Tm9kZS5hcHBlbmRDaGlsZCh0aGlzKTsKfQoKZnVuY3Rpb24gc2VsZWN0aW9uX3JhaXNlKCkgewogIHJldHVybiB0aGlzLmVhY2gocmFpc2UpOwp9CgpmdW5jdGlvbiBsb3dlcigpIHsKICBpZiAodGhpcy5wcmV2aW91c1NpYmxpbmcpIHRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcywgdGhpcy5wYXJlbnROb2RlLmZpcnN0Q2hpbGQpOwp9CgpmdW5jdGlvbiBzZWxlY3Rpb25fbG93ZXIoKSB7CiAgcmV0dXJuIHRoaXMuZWFjaChsb3dlcik7Cn0KCmZ1bmN0aW9uIHNlbGVjdGlvbl9hcHBlbmQobmFtZSkgewogIHZhciBjcmVhdGUgPSB0eXBlb2YgbmFtZSA9PT0gImZ1bmN0aW9uIiA/IG5hbWUgOiBjcmVhdG9yKG5hbWUpOwogIHJldHVybiB0aGlzLnNlbGVjdChmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLmFwcGVuZENoaWxkKGNyZWF0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKICB9KTsKfQoKZnVuY3Rpb24gY29uc3RhbnROdWxsKCkgewogIHJldHVybiBudWxsOwp9CgpmdW5jdGlvbiBzZWxlY3Rpb25faW5zZXJ0KG5hbWUsIGJlZm9yZSkgewogIHZhciBjcmVhdGUgPSB0eXBlb2YgbmFtZSA9PT0gImZ1bmN0aW9uIiA/IG5hbWUgOiBjcmVhdG9yKG5hbWUpLAogICAgICBzZWxlY3QgPSBiZWZvcmUgPT0gbnVsbCA/IGNvbnN0YW50TnVsbCA6IHR5cGVvZiBiZWZvcmUgPT09ICJmdW5jdGlvbiIgPyBiZWZvcmUgOiBzZWxlY3RvcihiZWZvcmUpOwogIHJldHVybiB0aGlzLnNlbGVjdChmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLmluc2VydEJlZm9yZShjcmVhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgc2VsZWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgbnVsbCk7CiAgfSk7Cn0KCmZ1bmN0aW9uIHJlbW92ZSgpIHsKICB2YXIgcGFyZW50ID0gdGhpcy5wYXJlbnROb2RlOwogIGlmIChwYXJlbnQpIHBhcmVudC5yZW1vdmVDaGlsZCh0aGlzKTsKfQoKZnVuY3Rpb24gc2VsZWN0aW9uX3JlbW92ZSgpIHsKICByZXR1cm4gdGhpcy5lYWNoKHJlbW92ZSk7Cn0KCmZ1bmN0aW9uIHNlbGVjdGlvbl9jbG9uZVNoYWxsb3coKSB7CiAgcmV0dXJuIHRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5jbG9uZU5vZGUoZmFsc2UpLCB0aGlzLm5leHRTaWJsaW5nKTsKfQoKZnVuY3Rpb24gc2VsZWN0aW9uX2Nsb25lRGVlcCgpIHsKICByZXR1cm4gdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLmNsb25lTm9kZSh0cnVlKSwgdGhpcy5uZXh0U2libGluZyk7Cn0KCmZ1bmN0aW9uIHNlbGVjdGlvbl9jbG9uZShkZWVwKSB7CiAgcmV0dXJuIHRoaXMuc2VsZWN0KGRlZXAgPyBzZWxlY3Rpb25fY2xvbmVEZWVwIDogc2VsZWN0aW9uX2Nsb25lU2hhbGxvdyk7Cn0KCmZ1bmN0aW9uIHNlbGVjdGlvbl9kYXR1bSh2YWx1ZSkgewogIHJldHVybiBhcmd1bWVudHMubGVuZ3RoCiAgICAgID8gdGhpcy5wcm9wZXJ0eSgiX19kYXRhX18iLCB2YWx1ZSkKICAgICAgOiB0aGlzLm5vZGUoKS5fX2RhdGFfXzsKfQoKdmFyIGZpbHRlckV2ZW50cyA9IHt9OwoKZXhwb3J0cy5ldmVudCA9IG51bGw7CgppZiAodHlwZW9mIGRvY3VtZW50ICE9PSAidW5kZWZpbmVkIikgewogIHZhciBlbGVtZW50JDEgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgaWYgKCEoIm9ubW91c2VlbnRlciIgaW4gZWxlbWVudCQxKSkgewogICAgZmlsdGVyRXZlbnRzID0ge21vdXNlZW50ZXI6ICJtb3VzZW92ZXIiLCBtb3VzZWxlYXZlOiAibW91c2VvdXQifTsKICB9Cn0KCmZ1bmN0aW9uIGZpbHRlckNvbnRleHRMaXN0ZW5lcihsaXN0ZW5lciwgaW5kZXgsIGdyb3VwKSB7CiAgbGlzdGVuZXIgPSBjb250ZXh0TGlzdGVuZXIobGlzdGVuZXIsIGluZGV4LCBncm91cCk7CiAgcmV0dXJuIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICB2YXIgcmVsYXRlZCA9IGV2ZW50LnJlbGF0ZWRUYXJnZXQ7CiAgICBpZiAoIXJlbGF0ZWQgfHwgKHJlbGF0ZWQgIT09IHRoaXMgJiYgIShyZWxhdGVkLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKHRoaXMpICYgOCkpKSB7CiAgICAgIGxpc3RlbmVyLmNhbGwodGhpcywgZXZlbnQpOwogICAgfQogIH07Cn0KCmZ1bmN0aW9uIGNvbnRleHRMaXN0ZW5lcihsaXN0ZW5lciwgaW5kZXgsIGdyb3VwKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKGV2ZW50MSkgewogICAgdmFyIGV2ZW50MCA9IGV4cG9ydHMuZXZlbnQ7IC8vIEV2ZW50cyBjYW4gYmUgcmVlbnRyYW50IChlLmcuLCBmb2N1cykuCiAgICBleHBvcnRzLmV2ZW50ID0gZXZlbnQxOwogICAgdHJ5IHsKICAgICAgbGlzdGVuZXIuY2FsbCh0aGlzLCB0aGlzLl9fZGF0YV9fLCBpbmRleCwgZ3JvdXApOwogICAgfSBmaW5hbGx5IHsKICAgICAgZXhwb3J0cy5ldmVudCA9IGV2ZW50MDsKICAgIH0KICB9Owp9CgpmdW5jdGlvbiBwYXJzZVR5cGVuYW1lcyQxKHR5cGVuYW1lcykgewogIHJldHVybiB0eXBlbmFtZXMudHJpbSgpLnNwbGl0KC9efFxzKy8pLm1hcChmdW5jdGlvbih0KSB7CiAgICB2YXIgbmFtZSA9ICIiLCBpID0gdC5pbmRleE9mKCIuIik7CiAgICBpZiAoaSA+PSAwKSBuYW1lID0gdC5zbGljZShpICsgMSksIHQgPSB0LnNsaWNlKDAsIGkpOwogICAgcmV0dXJuIHt0eXBlOiB0LCBuYW1lOiBuYW1lfTsKICB9KTsKfQoKZnVuY3Rpb24gb25SZW1vdmUodHlwZW5hbWUpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB2YXIgb24gPSB0aGlzLl9fb247CiAgICBpZiAoIW9uKSByZXR1cm47CiAgICBmb3IgKHZhciBqID0gMCwgaSA9IC0xLCBtID0gb24ubGVuZ3RoLCBvOyBqIDwgbTsgKytqKSB7CiAgICAgIGlmIChvID0gb25bal0sICghdHlwZW5hbWUudHlwZSB8fCBvLnR5cGUgPT09IHR5cGVuYW1lLnR5cGUpICYmIG8ubmFtZSA9PT0gdHlwZW5hbWUubmFtZSkgewogICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcihvLnR5cGUsIG8ubGlzdGVuZXIsIG8uY2FwdHVyZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb25bKytpXSA9IG87CiAgICAgIH0KICAgIH0KICAgIGlmICgrK2kpIG9uLmxlbmd0aCA9IGk7CiAgICBlbHNlIGRlbGV0ZSB0aGlzLl9fb247CiAgfTsKfQoKZnVuY3Rpb24gb25BZGQodHlwZW5hbWUsIHZhbHVlLCBjYXB0dXJlKSB7CiAgdmFyIHdyYXAgPSBmaWx0ZXJFdmVudHMuaGFzT3duUHJvcGVydHkodHlwZW5hbWUudHlwZSkgPyBmaWx0ZXJDb250ZXh0TGlzdGVuZXIgOiBjb250ZXh0TGlzdGVuZXI7CiAgcmV0dXJuIGZ1bmN0aW9uKGQsIGksIGdyb3VwKSB7CiAgICB2YXIgb24gPSB0aGlzLl9fb24sIG8sIGxpc3RlbmVyID0gd3JhcCh2YWx1ZSwgaSwgZ3JvdXApOwogICAgaWYgKG9uKSBmb3IgKHZhciBqID0gMCwgbSA9IG9uLmxlbmd0aDsgaiA8IG07ICsraikgewogICAgICBpZiAoKG8gPSBvbltqXSkudHlwZSA9PT0gdHlwZW5hbWUudHlwZSAmJiBvLm5hbWUgPT09IHR5cGVuYW1lLm5hbWUpIHsKICAgICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIoby50eXBlLCBvLmxpc3RlbmVyLCBvLmNhcHR1cmUpOwogICAgICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcihvLnR5cGUsIG8ubGlzdGVuZXIgPSBsaXN0ZW5lciwgby5jYXB0dXJlID0gY2FwdHVyZSk7CiAgICAgICAgby52YWx1ZSA9IHZhbHVlOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKHR5cGVuYW1lLnR5cGUsIGxpc3RlbmVyLCBjYXB0dXJlKTsKICAgIG8gPSB7dHlwZTogdHlwZW5hbWUudHlwZSwgbmFtZTogdHlwZW5hbWUubmFtZSwgdmFsdWU6IHZhbHVlLCBsaXN0ZW5lcjogbGlzdGVuZXIsIGNhcHR1cmU6IGNhcHR1cmV9OwogICAgaWYgKCFvbikgdGhpcy5fX29uID0gW29dOwogICAgZWxzZSBvbi5wdXNoKG8pOwogIH07Cn0KCmZ1bmN0aW9uIHNlbGVjdGlvbl9vbih0eXBlbmFtZSwgdmFsdWUsIGNhcHR1cmUpIHsKICB2YXIgdHlwZW5hbWVzID0gcGFyc2VUeXBlbmFtZXMkMSh0eXBlbmFtZSArICIiKSwgaSwgbiA9IHR5cGVuYW1lcy5sZW5ndGgsIHQ7CgogIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgewogICAgdmFyIG9uID0gdGhpcy5ub2RlKCkuX19vbjsKICAgIGlmIChvbikgZm9yICh2YXIgaiA9IDAsIG0gPSBvbi5sZW5ndGgsIG87IGogPCBtOyArK2opIHsKICAgICAgZm9yIChpID0gMCwgbyA9IG9uW2pdOyBpIDwgbjsgKytpKSB7CiAgICAgICAgaWYgKCh0ID0gdHlwZW5hbWVzW2ldKS50eXBlID09PSBvLnR5cGUgJiYgdC5uYW1lID09PSBvLm5hbWUpIHsKICAgICAgICAgIHJldHVybiBvLnZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuOwogIH0KCiAgb24gPSB2YWx1ZSA/IG9uQWRkIDogb25SZW1vdmU7CiAgaWYgKGNhcHR1cmUgPT0gbnVsbCkgY2FwdHVyZSA9IGZhbHNlOwogIGZvciAoaSA9IDA7IGkgPCBuOyArK2kpIHRoaXMuZWFjaChvbih0eXBlbmFtZXNbaV0sIHZhbHVlLCBjYXB0dXJlKSk7CiAgcmV0dXJuIHRoaXM7Cn0KCmZ1bmN0aW9uIGN1c3RvbUV2ZW50KGV2ZW50MSwgbGlzdGVuZXIsIHRoYXQsIGFyZ3MpIHsKICB2YXIgZXZlbnQwID0gZXhwb3J0cy5ldmVudDsKICBldmVudDEuc291cmNlRXZlbnQgPSBleHBvcnRzLmV2ZW50OwogIGV4cG9ydHMuZXZlbnQgPSBldmVudDE7CiAgdHJ5IHsKICAgIHJldHVybiBsaXN0ZW5lci5hcHBseSh0aGF0LCBhcmdzKTsKICB9IGZpbmFsbHkgewogICAgZXhwb3J0cy5ldmVudCA9IGV2ZW50MDsKICB9Cn0KCmZ1bmN0aW9uIGRpc3BhdGNoRXZlbnQobm9kZSwgdHlwZSwgcGFyYW1zKSB7CiAgdmFyIHdpbmRvdyA9IGRlZmF1bHRWaWV3KG5vZGUpLAogICAgICBldmVudCA9IHdpbmRvdy5DdXN0b21FdmVudDsKCiAgaWYgKHR5cGVvZiBldmVudCA9PT0gImZ1bmN0aW9uIikgewogICAgZXZlbnQgPSBuZXcgZXZlbnQodHlwZSwgcGFyYW1zKTsKICB9IGVsc2UgewogICAgZXZlbnQgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRXZlbnQoIkV2ZW50Iik7CiAgICBpZiAocGFyYW1zKSBldmVudC5pbml0RXZlbnQodHlwZSwgcGFyYW1zLmJ1YmJsZXMsIHBhcmFtcy5jYW5jZWxhYmxlKSwgZXZlbnQuZGV0YWlsID0gcGFyYW1zLmRldGFpbDsKICAgIGVsc2UgZXZlbnQuaW5pdEV2ZW50KHR5cGUsIGZhbHNlLCBmYWxzZSk7CiAgfQoKICBub2RlLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwp9CgpmdW5jdGlvbiBkaXNwYXRjaENvbnN0YW50KHR5cGUsIHBhcmFtcykgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkaXNwYXRjaEV2ZW50KHRoaXMsIHR5cGUsIHBhcmFtcyk7CiAgfTsKfQoKZnVuY3Rpb24gZGlzcGF0Y2hGdW5jdGlvbih0eXBlLCBwYXJhbXMpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZGlzcGF0Y2hFdmVudCh0aGlzLCB0eXBlLCBwYXJhbXMuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgfTsKfQoKZnVuY3Rpb24gc2VsZWN0aW9uX2Rpc3BhdGNoKHR5cGUsIHBhcmFtcykgewogIHJldHVybiB0aGlzLmVhY2goKHR5cGVvZiBwYXJhbXMgPT09ICJmdW5jdGlvbiIKICAgICAgPyBkaXNwYXRjaEZ1bmN0aW9uCiAgICAgIDogZGlzcGF0Y2hDb25zdGFudCkodHlwZSwgcGFyYW1zKSk7Cn0KCnZhciByb290ID0gW251bGxdOwoKZnVuY3Rpb24gU2VsZWN0aW9uKGdyb3VwcywgcGFyZW50cykgewogIHRoaXMuX2dyb3VwcyA9IGdyb3VwczsKICB0aGlzLl9wYXJlbnRzID0gcGFyZW50czsKfQoKZnVuY3Rpb24gc2VsZWN0aW9uKCkgewogIHJldHVybiBuZXcgU2VsZWN0aW9uKFtbZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50XV0sIHJvb3QpOwp9CgpTZWxlY3Rpb24ucHJvdG90eXBlID0gc2VsZWN0aW9uLnByb3RvdHlwZSA9IHsKICBjb25zdHJ1Y3RvcjogU2VsZWN0aW9uLAogIHNlbGVjdDogc2VsZWN0aW9uX3NlbGVjdCwKICBzZWxlY3RBbGw6IHNlbGVjdGlvbl9zZWxlY3RBbGwsCiAgZmlsdGVyOiBzZWxlY3Rpb25fZmlsdGVyLAogIGRhdGE6IHNlbGVjdGlvbl9kYXRhLAogIGVudGVyOiBzZWxlY3Rpb25fZW50ZXIsCiAgZXhpdDogc2VsZWN0aW9uX2V4aXQsCiAgbWVyZ2U6IHNlbGVjdGlvbl9tZXJnZSwKICBvcmRlcjogc2VsZWN0aW9uX29yZGVyLAogIHNvcnQ6IHNlbGVjdGlvbl9zb3J0LAogIGNhbGw6IHNlbGVjdGlvbl9jYWxsLAogIG5vZGVzOiBzZWxlY3Rpb25fbm9kZXMsCiAgbm9kZTogc2VsZWN0aW9uX25vZGUsCiAgc2l6ZTogc2VsZWN0aW9uX3NpemUsCiAgZW1wdHk6IHNlbGVjdGlvbl9lbXB0eSwKICBlYWNoOiBzZWxlY3Rpb25fZWFjaCwKICBhdHRyOiBzZWxlY3Rpb25fYXR0ciwKICBzdHlsZTogc2VsZWN0aW9uX3N0eWxlLAogIHByb3BlcnR5OiBzZWxlY3Rpb25fcHJvcGVydHksCiAgY2xhc3NlZDogc2VsZWN0aW9uX2NsYXNzZWQsCiAgdGV4dDogc2VsZWN0aW9uX3RleHQsCiAgaHRtbDogc2VsZWN0aW9uX2h0bWwsCiAgcmFpc2U6IHNlbGVjdGlvbl9yYWlzZSwKICBsb3dlcjogc2VsZWN0aW9uX2xvd2VyLAogIGFwcGVuZDogc2VsZWN0aW9uX2FwcGVuZCwKICBpbnNlcnQ6IHNlbGVjdGlvbl9pbnNlcnQsCiAgcmVtb3ZlOiBzZWxlY3Rpb25fcmVtb3ZlLAogIGNsb25lOiBzZWxlY3Rpb25fY2xvbmUsCiAgZGF0dW06IHNlbGVjdGlvbl9kYXR1bSwKICBvbjogc2VsZWN0aW9uX29uLAogIGRpc3BhdGNoOiBzZWxlY3Rpb25fZGlzcGF0Y2gKfTsKCmZ1bmN0aW9uIHNlbGVjdChzZWxlY3RvcikgewogIHJldHVybiB0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciCiAgICAgID8gbmV3IFNlbGVjdGlvbihbW2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpXV0sIFtkb2N1bWVudC5kb2N1bWVudEVsZW1lbnRdKQogICAgICA6IG5ldyBTZWxlY3Rpb24oW1tzZWxlY3Rvcl1dLCByb290KTsKfQoKZnVuY3Rpb24gY3JlYXRlKG5hbWUpIHsKICByZXR1cm4gc2VsZWN0KGNyZWF0b3IobmFtZSkuY2FsbChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpKTsKfQoKdmFyIG5leHRJZCA9IDA7CgpmdW5jdGlvbiBsb2NhbCgpIHsKICByZXR1cm4gbmV3IExvY2FsOwp9CgpmdW5jdGlvbiBMb2NhbCgpIHsKICB0aGlzLl8gPSAiQCIgKyAoKytuZXh0SWQpLnRvU3RyaW5nKDM2KTsKfQoKTG9jYWwucHJvdG90eXBlID0gbG9jYWwucHJvdG90eXBlID0gewogIGNvbnN0cnVjdG9yOiBMb2NhbCwKICBnZXQ6IGZ1bmN0aW9uKG5vZGUpIHsKICAgIHZhciBpZCA9IHRoaXMuXzsKICAgIHdoaWxlICghKGlkIGluIG5vZGUpKSBpZiAoIShub2RlID0gbm9kZS5wYXJlbnROb2RlKSkgcmV0dXJuOwogICAgcmV0dXJuIG5vZGVbaWRdOwogIH0sCiAgc2V0OiBmdW5jdGlvbihub2RlLCB2YWx1ZSkgewogICAgcmV0dXJuIG5vZGVbdGhpcy5fXSA9IHZhbHVlOwogIH0sCiAgcmVtb3ZlOiBmdW5jdGlvbihub2RlKSB7CiAgICByZXR1cm4gdGhpcy5fIGluIG5vZGUgJiYgZGVsZXRlIG5vZGVbdGhpcy5fXTsKICB9LAogIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl87CiAgfQp9OwoKZnVuY3Rpb24gc291cmNlRXZlbnQoKSB7CiAgdmFyIGN1cnJlbnQgPSBleHBvcnRzLmV2ZW50LCBzb3VyY2U7CiAgd2hpbGUgKHNvdXJjZSA9IGN1cnJlbnQuc291cmNlRXZlbnQpIGN1cnJlbnQgPSBzb3VyY2U7CiAgcmV0dXJuIGN1cnJlbnQ7Cn0KCmZ1bmN0aW9uIHBvaW50KG5vZGUsIGV2ZW50KSB7CiAgdmFyIHN2ZyA9IG5vZGUub3duZXJTVkdFbGVtZW50IHx8IG5vZGU7CgogIGlmIChzdmcuY3JlYXRlU1ZHUG9pbnQpIHsKICAgIHZhciBwb2ludCA9IHN2Zy5jcmVhdGVTVkdQb2ludCgpOwogICAgcG9pbnQueCA9IGV2ZW50LmNsaWVudFgsIHBvaW50LnkgPSBldmVudC5jbGllbnRZOwogICAgcG9pbnQgPSBwb2ludC5tYXRyaXhUcmFuc2Zvcm0obm9kZS5nZXRTY3JlZW5DVE0oKS5pbnZlcnNlKCkpOwogICAgcmV0dXJuIFtwb2ludC54LCBwb2ludC55XTsKICB9CgogIHZhciByZWN0ID0gbm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICByZXR1cm4gW2V2ZW50LmNsaWVudFggLSByZWN0LmxlZnQgLSBub2RlLmNsaWVudExlZnQsIGV2ZW50LmNsaWVudFkgLSByZWN0LnRvcCAtIG5vZGUuY2xpZW50VG9wXTsKfQoKZnVuY3Rpb24gbW91c2Uobm9kZSkgewogIHZhciBldmVudCA9IHNvdXJjZUV2ZW50KCk7CiAgaWYgKGV2ZW50LmNoYW5nZWRUb3VjaGVzKSBldmVudCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdOwogIHJldHVybiBwb2ludChub2RlLCBldmVudCk7Cn0KCmZ1bmN0aW9uIHNlbGVjdEFsbChzZWxlY3RvcikgewogIHJldHVybiB0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciCiAgICAgID8gbmV3IFNlbGVjdGlvbihbZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcildLCBbZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50XSkKICAgICAgOiBuZXcgU2VsZWN0aW9uKFtzZWxlY3RvciA9PSBudWxsID8gW10gOiBzZWxlY3Rvcl0sIHJvb3QpOwp9CgpmdW5jdGlvbiB0b3VjaChub2RlLCB0b3VjaGVzLCBpZGVudGlmaWVyKSB7CiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAzKSBpZGVudGlmaWVyID0gdG91Y2hlcywgdG91Y2hlcyA9IHNvdXJjZUV2ZW50KCkuY2hhbmdlZFRvdWNoZXM7CgogIGZvciAodmFyIGkgPSAwLCBuID0gdG91Y2hlcyA/IHRvdWNoZXMubGVuZ3RoIDogMCwgdG91Y2g7IGkgPCBuOyArK2kpIHsKICAgIGlmICgodG91Y2ggPSB0b3VjaGVzW2ldKS5pZGVudGlmaWVyID09PSBpZGVudGlmaWVyKSB7CiAgICAgIHJldHVybiBwb2ludChub2RlLCB0b3VjaCk7CiAgICB9CiAgfQoKICByZXR1cm4gbnVsbDsKfQoKZnVuY3Rpb24gdG91Y2hlcyhub2RlLCB0b3VjaGVzKSB7CiAgaWYgKHRvdWNoZXMgPT0gbnVsbCkgdG91Y2hlcyA9IHNvdXJjZUV2ZW50KCkudG91Y2hlczsKCiAgZm9yICh2YXIgaSA9IDAsIG4gPSB0b3VjaGVzID8gdG91Y2hlcy5sZW5ndGggOiAwLCBwb2ludHMgPSBuZXcgQXJyYXkobik7IGkgPCBuOyArK2kpIHsKICAgIHBvaW50c1tpXSA9IHBvaW50KG5vZGUsIHRvdWNoZXNbaV0pOwogIH0KCiAgcmV0dXJuIHBvaW50czsKfQoKZnVuY3Rpb24gbm9wcm9wYWdhdGlvbigpIHsKICBleHBvcnRzLmV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwp9CgpmdW5jdGlvbiBub2V2ZW50KCkgewogIGV4cG9ydHMuZXZlbnQucHJldmVudERlZmF1bHQoKTsKICBleHBvcnRzLmV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwp9CgpmdW5jdGlvbiBkcmFnRGlzYWJsZSh2aWV3KSB7CiAgdmFyIHJvb3QgPSB2aWV3LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwKICAgICAgc2VsZWN0aW9uJCQxID0gc2VsZWN0KHZpZXcpLm9uKCJkcmFnc3RhcnQuZHJhZyIsIG5vZXZlbnQsIHRydWUpOwogIGlmICgib25zZWxlY3RzdGFydCIgaW4gcm9vdCkgewogICAgc2VsZWN0aW9uJCQxLm9uKCJzZWxlY3RzdGFydC5kcmFnIiwgbm9ldmVudCwgdHJ1ZSk7CiAgfSBlbHNlIHsKICAgIHJvb3QuX19ub3NlbGVjdCA9IHJvb3Quc3R5bGUuTW96VXNlclNlbGVjdDsKICAgIHJvb3Quc3R5bGUuTW96VXNlclNlbGVjdCA9ICJub25lIjsKICB9Cn0KCmZ1bmN0aW9uIHllc2RyYWcodmlldywgbm9jbGljaykgewogIHZhciByb290ID0gdmlldy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsCiAgICAgIHNlbGVjdGlvbiQkMSA9IHNlbGVjdCh2aWV3KS5vbigiZHJhZ3N0YXJ0LmRyYWciLCBudWxsKTsKICBpZiAobm9jbGljaykgewogICAgc2VsZWN0aW9uJCQxLm9uKCJjbGljay5kcmFnIiwgbm9ldmVudCwgdHJ1ZSk7CiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBzZWxlY3Rpb24kJDEub24oImNsaWNrLmRyYWciLCBudWxsKTsgfSwgMCk7CiAgfQogIGlmICgib25zZWxlY3RzdGFydCIgaW4gcm9vdCkgewogICAgc2VsZWN0aW9uJCQxLm9uKCJzZWxlY3RzdGFydC5kcmFnIiwgbnVsbCk7CiAgfSBlbHNlIHsKICAgIHJvb3Quc3R5bGUuTW96VXNlclNlbGVjdCA9IHJvb3QuX19ub3NlbGVjdDsKICAgIGRlbGV0ZSByb290Ll9fbm9zZWxlY3Q7CiAgfQp9CgpmdW5jdGlvbiBjb25zdGFudCQyKHgpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4geDsKICB9Owp9CgpmdW5jdGlvbiBEcmFnRXZlbnQodGFyZ2V0LCB0eXBlLCBzdWJqZWN0LCBpZCwgYWN0aXZlLCB4LCB5LCBkeCwgZHksIGRpc3BhdGNoKSB7CiAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7CiAgdGhpcy50eXBlID0gdHlwZTsKICB0aGlzLnN1YmplY3QgPSBzdWJqZWN0OwogIHRoaXMuaWRlbnRpZmllciA9IGlkOwogIHRoaXMuYWN0aXZlID0gYWN0aXZlOwogIHRoaXMueCA9IHg7CiAgdGhpcy55ID0geTsKICB0aGlzLmR4ID0gZHg7CiAgdGhpcy5keSA9IGR5OwogIHRoaXMuXyA9IGRpc3BhdGNoOwp9CgpEcmFnRXZlbnQucHJvdG90eXBlLm9uID0gZnVuY3Rpb24oKSB7CiAgdmFyIHZhbHVlID0gdGhpcy5fLm9uLmFwcGx5KHRoaXMuXywgYXJndW1lbnRzKTsKICByZXR1cm4gdmFsdWUgPT09IHRoaXMuXyA/IHRoaXMgOiB2YWx1ZTsKfTsKCi8vIElnbm9yZSByaWdodC1jbGljaywgc2luY2UgdGhhdCBzaG91bGQgb3BlbiB0aGUgY29udGV4dCBtZW51LgpmdW5jdGlvbiBkZWZhdWx0RmlsdGVyKCkgewogIHJldHVybiAhZXhwb3J0cy5ldmVudC5idXR0b247Cn0KCmZ1bmN0aW9uIGRlZmF1bHRDb250YWluZXIoKSB7CiAgcmV0dXJuIHRoaXMucGFyZW50Tm9kZTsKfQoKZnVuY3Rpb24gZGVmYXVsdFN1YmplY3QoZCkgewogIHJldHVybiBkID09IG51bGwgPyB7eDogZXhwb3J0cy5ldmVudC54LCB5OiBleHBvcnRzLmV2ZW50Lnl9IDogZDsKfQoKZnVuY3Rpb24gZGVmYXVsdFRvdWNoYWJsZSgpIHsKICByZXR1cm4gIm9udG91Y2hzdGFydCIgaW4gdGhpczsKfQoKZnVuY3Rpb24gZHJhZygpIHsKICB2YXIgZmlsdGVyID0gZGVmYXVsdEZpbHRlciwKICAgICAgY29udGFpbmVyID0gZGVmYXVsdENvbnRhaW5lciwKICAgICAgc3ViamVjdCA9IGRlZmF1bHRTdWJqZWN0LAogICAgICB0b3VjaGFibGUgPSBkZWZhdWx0VG91Y2hhYmxlLAogICAgICBnZXN0dXJlcyA9IHt9LAogICAgICBsaXN0ZW5lcnMgPSBkaXNwYXRjaCgic3RhcnQiLCAiZHJhZyIsICJlbmQiKSwKICAgICAgYWN0aXZlID0gMCwKICAgICAgbW91c2Vkb3dueCwKICAgICAgbW91c2Vkb3dueSwKICAgICAgbW91c2Vtb3ZpbmcsCiAgICAgIHRvdWNoZW5kaW5nLAogICAgICBjbGlja0Rpc3RhbmNlMiA9IDA7CgogIGZ1bmN0aW9uIGRyYWcoc2VsZWN0aW9uJCQxKSB7CiAgICBzZWxlY3Rpb24kJDEKICAgICAgICAub24oIm1vdXNlZG93bi5kcmFnIiwgbW91c2Vkb3duZWQpCiAgICAgIC5maWx0ZXIodG91Y2hhYmxlKQogICAgICAgIC5vbigidG91Y2hzdGFydC5kcmFnIiwgdG91Y2hzdGFydGVkKQogICAgICAgIC5vbigidG91Y2htb3ZlLmRyYWciLCB0b3VjaG1vdmVkKQogICAgICAgIC5vbigidG91Y2hlbmQuZHJhZyB0b3VjaGNhbmNlbC5kcmFnIiwgdG91Y2hlbmRlZCkKICAgICAgICAuc3R5bGUoInRvdWNoLWFjdGlvbiIsICJub25lIikKICAgICAgICAuc3R5bGUoIi13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvciIsICJyZ2JhKDAsMCwwLDApIik7CiAgfQoKICBmdW5jdGlvbiBtb3VzZWRvd25lZCgpIHsKICAgIGlmICh0b3VjaGVuZGluZyB8fCAhZmlsdGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHJldHVybjsKICAgIHZhciBnZXN0dXJlID0gYmVmb3Jlc3RhcnQoIm1vdXNlIiwgY29udGFpbmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIG1vdXNlLCB0aGlzLCBhcmd1bWVudHMpOwogICAgaWYgKCFnZXN0dXJlKSByZXR1cm47CiAgICBzZWxlY3QoZXhwb3J0cy5ldmVudC52aWV3KS5vbigibW91c2Vtb3ZlLmRyYWciLCBtb3VzZW1vdmVkLCB0cnVlKS5vbigibW91c2V1cC5kcmFnIiwgbW91c2V1cHBlZCwgdHJ1ZSk7CiAgICBkcmFnRGlzYWJsZShleHBvcnRzLmV2ZW50LnZpZXcpOwogICAgbm9wcm9wYWdhdGlvbigpOwogICAgbW91c2Vtb3ZpbmcgPSBmYWxzZTsKICAgIG1vdXNlZG93bnggPSBleHBvcnRzLmV2ZW50LmNsaWVudFg7CiAgICBtb3VzZWRvd255ID0gZXhwb3J0cy5ldmVudC5jbGllbnRZOwogICAgZ2VzdHVyZSgic3RhcnQiKTsKICB9CgogIGZ1bmN0aW9uIG1vdXNlbW92ZWQoKSB7CiAgICBub2V2ZW50KCk7CiAgICBpZiAoIW1vdXNlbW92aW5nKSB7CiAgICAgIHZhciBkeCA9IGV4cG9ydHMuZXZlbnQuY2xpZW50WCAtIG1vdXNlZG93bngsIGR5ID0gZXhwb3J0cy5ldmVudC5jbGllbnRZIC0gbW91c2Vkb3dueTsKICAgICAgbW91c2Vtb3ZpbmcgPSBkeCAqIGR4ICsgZHkgKiBkeSA+IGNsaWNrRGlzdGFuY2UyOwogICAgfQogICAgZ2VzdHVyZXMubW91c2UoImRyYWciKTsKICB9CgogIGZ1bmN0aW9uIG1vdXNldXBwZWQoKSB7CiAgICBzZWxlY3QoZXhwb3J0cy5ldmVudC52aWV3KS5vbigibW91c2Vtb3ZlLmRyYWcgbW91c2V1cC5kcmFnIiwgbnVsbCk7CiAgICB5ZXNkcmFnKGV4cG9ydHMuZXZlbnQudmlldywgbW91c2Vtb3ZpbmcpOwogICAgbm9ldmVudCgpOwogICAgZ2VzdHVyZXMubW91c2UoImVuZCIpOwogIH0KCiAgZnVuY3Rpb24gdG91Y2hzdGFydGVkKCkgewogICAgaWYgKCFmaWx0ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgcmV0dXJuOwogICAgdmFyIHRvdWNoZXMkJDEgPSBleHBvcnRzLmV2ZW50LmNoYW5nZWRUb3VjaGVzLAogICAgICAgIGMgPSBjb250YWluZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSwKICAgICAgICBuID0gdG91Y2hlcyQkMS5sZW5ndGgsIGksIGdlc3R1cmU7CgogICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICBpZiAoZ2VzdHVyZSA9IGJlZm9yZXN0YXJ0KHRvdWNoZXMkJDFbaV0uaWRlbnRpZmllciwgYywgdG91Y2gsIHRoaXMsIGFyZ3VtZW50cykpIHsKICAgICAgICBub3Byb3BhZ2F0aW9uKCk7CiAgICAgICAgZ2VzdHVyZSgic3RhcnQiKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdG91Y2htb3ZlZCgpIHsKICAgIHZhciB0b3VjaGVzJCQxID0gZXhwb3J0cy5ldmVudC5jaGFuZ2VkVG91Y2hlcywKICAgICAgICBuID0gdG91Y2hlcyQkMS5sZW5ndGgsIGksIGdlc3R1cmU7CgogICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICBpZiAoZ2VzdHVyZSA9IGdlc3R1cmVzW3RvdWNoZXMkJDFbaV0uaWRlbnRpZmllcl0pIHsKICAgICAgICBub2V2ZW50KCk7CiAgICAgICAgZ2VzdHVyZSgiZHJhZyIpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiB0b3VjaGVuZGVkKCkgewogICAgdmFyIHRvdWNoZXMkJDEgPSBleHBvcnRzLmV2ZW50LmNoYW5nZWRUb3VjaGVzLAogICAgICAgIG4gPSB0b3VjaGVzJCQxLmxlbmd0aCwgaSwgZ2VzdHVyZTsKCiAgICBpZiAodG91Y2hlbmRpbmcpIGNsZWFyVGltZW91dCh0b3VjaGVuZGluZyk7CiAgICB0b3VjaGVuZGluZyA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHRvdWNoZW5kaW5nID0gbnVsbDsgfSwgNTAwKTsgLy8gR2hvc3QgY2xpY2tzIGFyZSBkZWxheWVkIQogICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICBpZiAoZ2VzdHVyZSA9IGdlc3R1cmVzW3RvdWNoZXMkJDFbaV0uaWRlbnRpZmllcl0pIHsKICAgICAgICBub3Byb3BhZ2F0aW9uKCk7CiAgICAgICAgZ2VzdHVyZSgiZW5kIik7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGJlZm9yZXN0YXJ0KGlkLCBjb250YWluZXIsIHBvaW50JCQxLCB0aGF0LCBhcmdzKSB7CiAgICB2YXIgcCA9IHBvaW50JCQxKGNvbnRhaW5lciwgaWQpLCBzLCBkeCwgZHksCiAgICAgICAgc3VibGlzdGVuZXJzID0gbGlzdGVuZXJzLmNvcHkoKTsKCiAgICBpZiAoIWN1c3RvbUV2ZW50KG5ldyBEcmFnRXZlbnQoZHJhZywgImJlZm9yZXN0YXJ0IiwgcywgaWQsIGFjdGl2ZSwgcFswXSwgcFsxXSwgMCwgMCwgc3VibGlzdGVuZXJzKSwgZnVuY3Rpb24oKSB7CiAgICAgIGlmICgoZXhwb3J0cy5ldmVudC5zdWJqZWN0ID0gcyA9IHN1YmplY3QuYXBwbHkodGhhdCwgYXJncykpID09IG51bGwpIHJldHVybiBmYWxzZTsKICAgICAgZHggPSBzLnggLSBwWzBdIHx8IDA7CiAgICAgIGR5ID0gcy55IC0gcFsxXSB8fCAwOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0pKSByZXR1cm47CgogICAgcmV0dXJuIGZ1bmN0aW9uIGdlc3R1cmUodHlwZSkgewogICAgICB2YXIgcDAgPSBwLCBuOwogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlICJzdGFydCI6IGdlc3R1cmVzW2lkXSA9IGdlc3R1cmUsIG4gPSBhY3RpdmUrKzsgYnJlYWs7CiAgICAgICAgY2FzZSAiZW5kIjogZGVsZXRlIGdlc3R1cmVzW2lkXSwgLS1hY3RpdmU7IC8vIG5vYnJlYWsKICAgICAgICBjYXNlICJkcmFnIjogcCA9IHBvaW50JCQxKGNvbnRhaW5lciwgaWQpLCBuID0gYWN0aXZlOyBicmVhazsKICAgICAgfQogICAgICBjdXN0b21FdmVudChuZXcgRHJhZ0V2ZW50KGRyYWcsIHR5cGUsIHMsIGlkLCBuLCBwWzBdICsgZHgsIHBbMV0gKyBkeSwgcFswXSAtIHAwWzBdLCBwWzFdIC0gcDBbMV0sIHN1Ymxpc3RlbmVycyksIHN1Ymxpc3RlbmVycy5hcHBseSwgc3VibGlzdGVuZXJzLCBbdHlwZSwgdGhhdCwgYXJnc10pOwogICAgfTsKICB9CgogIGRyYWcuZmlsdGVyID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZmlsdGVyID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMighIV8pLCBkcmFnKSA6IGZpbHRlcjsKICB9OwoKICBkcmFnLmNvbnRhaW5lciA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGNvbnRhaW5lciA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IGNvbnN0YW50JDIoXyksIGRyYWcpIDogY29udGFpbmVyOwogIH07CgogIGRyYWcuc3ViamVjdCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHN1YmplY3QgPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQyKF8pLCBkcmFnKSA6IHN1YmplY3Q7CiAgfTsKCiAgZHJhZy50b3VjaGFibGUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0b3VjaGFibGUgPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQyKCEhXyksIGRyYWcpIDogdG91Y2hhYmxlOwogIH07CgogIGRyYWcub24gPSBmdW5jdGlvbigpIHsKICAgIHZhciB2YWx1ZSA9IGxpc3RlbmVycy5vbi5hcHBseShsaXN0ZW5lcnMsIGFyZ3VtZW50cyk7CiAgICByZXR1cm4gdmFsdWUgPT09IGxpc3RlbmVycyA/IGRyYWcgOiB2YWx1ZTsKICB9OwoKICBkcmFnLmNsaWNrRGlzdGFuY2UgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChjbGlja0Rpc3RhbmNlMiA9IChfID0gK18pICogXywgZHJhZykgOiBNYXRoLnNxcnQoY2xpY2tEaXN0YW5jZTIpOwogIH07CgogIHJldHVybiBkcmFnOwp9CgpmdW5jdGlvbiBkZWZpbmUoY29uc3RydWN0b3IsIGZhY3RvcnksIHByb3RvdHlwZSkgewogIGNvbnN0cnVjdG9yLnByb3RvdHlwZSA9IGZhY3RvcnkucHJvdG90eXBlID0gcHJvdG90eXBlOwogIHByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGNvbnN0cnVjdG9yOwp9CgpmdW5jdGlvbiBleHRlbmQocGFyZW50LCBkZWZpbml0aW9uKSB7CiAgdmFyIHByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUocGFyZW50LnByb3RvdHlwZSk7CiAgZm9yICh2YXIga2V5IGluIGRlZmluaXRpb24pIHByb3RvdHlwZVtrZXldID0gZGVmaW5pdGlvbltrZXldOwogIHJldHVybiBwcm90b3R5cGU7Cn0KCmZ1bmN0aW9uIENvbG9yKCkge30KCnZhciBkYXJrZXIgPSAwLjc7CnZhciBicmlnaHRlciA9IDEgLyBkYXJrZXI7Cgp2YXIgcmVJID0gIlxccyooWystXT9cXGQrKVxccyoiLAogICAgcmVOID0gIlxccyooWystXT9cXGQqXFwuP1xcZCsoPzpbZUVdWystXT9cXGQrKT8pXFxzKiIsCiAgICByZVAgPSAiXFxzKihbKy1dP1xcZCpcXC4/XFxkKyg/OltlRV1bKy1dP1xcZCspPyklXFxzKiIsCiAgICByZUhleDMgPSAvXiMoWzAtOWEtZl17M30pJC8sCiAgICByZUhleDYgPSAvXiMoWzAtOWEtZl17Nn0pJC8sCiAgICByZVJnYkludGVnZXIgPSBuZXcgUmVnRXhwKCJecmdiXFwoIiArIFtyZUksIHJlSSwgcmVJXSArICJcXCkkIiksCiAgICByZVJnYlBlcmNlbnQgPSBuZXcgUmVnRXhwKCJecmdiXFwoIiArIFtyZVAsIHJlUCwgcmVQXSArICJcXCkkIiksCiAgICByZVJnYmFJbnRlZ2VyID0gbmV3IFJlZ0V4cCgiXnJnYmFcXCgiICsgW3JlSSwgcmVJLCByZUksIHJlTl0gKyAiXFwpJCIpLAogICAgcmVSZ2JhUGVyY2VudCA9IG5ldyBSZWdFeHAoIl5yZ2JhXFwoIiArIFtyZVAsIHJlUCwgcmVQLCByZU5dICsgIlxcKSQiKSwKICAgIHJlSHNsUGVyY2VudCA9IG5ldyBSZWdFeHAoIl5oc2xcXCgiICsgW3JlTiwgcmVQLCByZVBdICsgIlxcKSQiKSwKICAgIHJlSHNsYVBlcmNlbnQgPSBuZXcgUmVnRXhwKCJeaHNsYVxcKCIgKyBbcmVOLCByZVAsIHJlUCwgcmVOXSArICJcXCkkIik7Cgp2YXIgbmFtZWQgPSB7CiAgYWxpY2VibHVlOiAweGYwZjhmZiwKICBhbnRpcXVld2hpdGU6IDB4ZmFlYmQ3LAogIGFxdWE6IDB4MDBmZmZmLAogIGFxdWFtYXJpbmU6IDB4N2ZmZmQ0LAogIGF6dXJlOiAweGYwZmZmZiwKICBiZWlnZTogMHhmNWY1ZGMsCiAgYmlzcXVlOiAweGZmZTRjNCwKICBibGFjazogMHgwMDAwMDAsCiAgYmxhbmNoZWRhbG1vbmQ6IDB4ZmZlYmNkLAogIGJsdWU6IDB4MDAwMGZmLAogIGJsdWV2aW9sZXQ6IDB4OGEyYmUyLAogIGJyb3duOiAweGE1MmEyYSwKICBidXJseXdvb2Q6IDB4ZGViODg3LAogIGNhZGV0Ymx1ZTogMHg1ZjllYTAsCiAgY2hhcnRyZXVzZTogMHg3ZmZmMDAsCiAgY2hvY29sYXRlOiAweGQyNjkxZSwKICBjb3JhbDogMHhmZjdmNTAsCiAgY29ybmZsb3dlcmJsdWU6IDB4NjQ5NWVkLAogIGNvcm5zaWxrOiAweGZmZjhkYywKICBjcmltc29uOiAweGRjMTQzYywKICBjeWFuOiAweDAwZmZmZiwKICBkYXJrYmx1ZTogMHgwMDAwOGIsCiAgZGFya2N5YW46IDB4MDA4YjhiLAogIGRhcmtnb2xkZW5yb2Q6IDB4Yjg4NjBiLAogIGRhcmtncmF5OiAweGE5YTlhOSwKICBkYXJrZ3JlZW46IDB4MDA2NDAwLAogIGRhcmtncmV5OiAweGE5YTlhOSwKICBkYXJra2hha2k6IDB4YmRiNzZiLAogIGRhcmttYWdlbnRhOiAweDhiMDA4YiwKICBkYXJrb2xpdmVncmVlbjogMHg1NTZiMmYsCiAgZGFya29yYW5nZTogMHhmZjhjMDAsCiAgZGFya29yY2hpZDogMHg5OTMyY2MsCiAgZGFya3JlZDogMHg4YjAwMDAsCiAgZGFya3NhbG1vbjogMHhlOTk2N2EsCiAgZGFya3NlYWdyZWVuOiAweDhmYmM4ZiwKICBkYXJrc2xhdGVibHVlOiAweDQ4M2Q4YiwKICBkYXJrc2xhdGVncmF5OiAweDJmNGY0ZiwKICBkYXJrc2xhdGVncmV5OiAweDJmNGY0ZiwKICBkYXJrdHVycXVvaXNlOiAweDAwY2VkMSwKICBkYXJrdmlvbGV0OiAweDk0MDBkMywKICBkZWVwcGluazogMHhmZjE0OTMsCiAgZGVlcHNreWJsdWU6IDB4MDBiZmZmLAogIGRpbWdyYXk6IDB4Njk2OTY5LAogIGRpbWdyZXk6IDB4Njk2OTY5LAogIGRvZGdlcmJsdWU6IDB4MWU5MGZmLAogIGZpcmVicmljazogMHhiMjIyMjIsCiAgZmxvcmFsd2hpdGU6IDB4ZmZmYWYwLAogIGZvcmVzdGdyZWVuOiAweDIyOGIyMiwKICBmdWNoc2lhOiAweGZmMDBmZiwKICBnYWluc2Jvcm86IDB4ZGNkY2RjLAogIGdob3N0d2hpdGU6IDB4ZjhmOGZmLAogIGdvbGQ6IDB4ZmZkNzAwLAogIGdvbGRlbnJvZDogMHhkYWE1MjAsCiAgZ3JheTogMHg4MDgwODAsCiAgZ3JlZW46IDB4MDA4MDAwLAogIGdyZWVueWVsbG93OiAweGFkZmYyZiwKICBncmV5OiAweDgwODA4MCwKICBob25leWRldzogMHhmMGZmZjAsCiAgaG90cGluazogMHhmZjY5YjQsCiAgaW5kaWFucmVkOiAweGNkNWM1YywKICBpbmRpZ286IDB4NGIwMDgyLAogIGl2b3J5OiAweGZmZmZmMCwKICBraGFraTogMHhmMGU2OGMsCiAgbGF2ZW5kZXI6IDB4ZTZlNmZhLAogIGxhdmVuZGVyYmx1c2g6IDB4ZmZmMGY1LAogIGxhd25ncmVlbjogMHg3Y2ZjMDAsCiAgbGVtb25jaGlmZm9uOiAweGZmZmFjZCwKICBsaWdodGJsdWU6IDB4YWRkOGU2LAogIGxpZ2h0Y29yYWw6IDB4ZjA4MDgwLAogIGxpZ2h0Y3lhbjogMHhlMGZmZmYsCiAgbGlnaHRnb2xkZW5yb2R5ZWxsb3c6IDB4ZmFmYWQyLAogIGxpZ2h0Z3JheTogMHhkM2QzZDMsCiAgbGlnaHRncmVlbjogMHg5MGVlOTAsCiAgbGlnaHRncmV5OiAweGQzZDNkMywKICBsaWdodHBpbms6IDB4ZmZiNmMxLAogIGxpZ2h0c2FsbW9uOiAweGZmYTA3YSwKICBsaWdodHNlYWdyZWVuOiAweDIwYjJhYSwKICBsaWdodHNreWJsdWU6IDB4ODdjZWZhLAogIGxpZ2h0c2xhdGVncmF5OiAweDc3ODg5OSwKICBsaWdodHNsYXRlZ3JleTogMHg3Nzg4OTksCiAgbGlnaHRzdGVlbGJsdWU6IDB4YjBjNGRlLAogIGxpZ2h0eWVsbG93OiAweGZmZmZlMCwKICBsaW1lOiAweDAwZmYwMCwKICBsaW1lZ3JlZW46IDB4MzJjZDMyLAogIGxpbmVuOiAweGZhZjBlNiwKICBtYWdlbnRhOiAweGZmMDBmZiwKICBtYXJvb246IDB4ODAwMDAwLAogIG1lZGl1bWFxdWFtYXJpbmU6IDB4NjZjZGFhLAogIG1lZGl1bWJsdWU6IDB4MDAwMGNkLAogIG1lZGl1bW9yY2hpZDogMHhiYTU1ZDMsCiAgbWVkaXVtcHVycGxlOiAweDkzNzBkYiwKICBtZWRpdW1zZWFncmVlbjogMHgzY2IzNzEsCiAgbWVkaXVtc2xhdGVibHVlOiAweDdiNjhlZSwKICBtZWRpdW1zcHJpbmdncmVlbjogMHgwMGZhOWEsCiAgbWVkaXVtdHVycXVvaXNlOiAweDQ4ZDFjYywKICBtZWRpdW12aW9sZXRyZWQ6IDB4YzcxNTg1LAogIG1pZG5pZ2h0Ymx1ZTogMHgxOTE5NzAsCiAgbWludGNyZWFtOiAweGY1ZmZmYSwKICBtaXN0eXJvc2U6IDB4ZmZlNGUxLAogIG1vY2Nhc2luOiAweGZmZTRiNSwKICBuYXZham93aGl0ZTogMHhmZmRlYWQsCiAgbmF2eTogMHgwMDAwODAsCiAgb2xkbGFjZTogMHhmZGY1ZTYsCiAgb2xpdmU6IDB4ODA4MDAwLAogIG9saXZlZHJhYjogMHg2YjhlMjMsCiAgb3JhbmdlOiAweGZmYTUwMCwKICBvcmFuZ2VyZWQ6IDB4ZmY0NTAwLAogIG9yY2hpZDogMHhkYTcwZDYsCiAgcGFsZWdvbGRlbnJvZDogMHhlZWU4YWEsCiAgcGFsZWdyZWVuOiAweDk4ZmI5OCwKICBwYWxldHVycXVvaXNlOiAweGFmZWVlZSwKICBwYWxldmlvbGV0cmVkOiAweGRiNzA5MywKICBwYXBheWF3aGlwOiAweGZmZWZkNSwKICBwZWFjaHB1ZmY6IDB4ZmZkYWI5LAogIHBlcnU6IDB4Y2Q4NTNmLAogIHBpbms6IDB4ZmZjMGNiLAogIHBsdW06IDB4ZGRhMGRkLAogIHBvd2RlcmJsdWU6IDB4YjBlMGU2LAogIHB1cnBsZTogMHg4MDAwODAsCiAgcmViZWNjYXB1cnBsZTogMHg2NjMzOTksCiAgcmVkOiAweGZmMDAwMCwKICByb3N5YnJvd246IDB4YmM4ZjhmLAogIHJveWFsYmx1ZTogMHg0MTY5ZTEsCiAgc2FkZGxlYnJvd246IDB4OGI0NTEzLAogIHNhbG1vbjogMHhmYTgwNzIsCiAgc2FuZHlicm93bjogMHhmNGE0NjAsCiAgc2VhZ3JlZW46IDB4MmU4YjU3LAogIHNlYXNoZWxsOiAweGZmZjVlZSwKICBzaWVubmE6IDB4YTA1MjJkLAogIHNpbHZlcjogMHhjMGMwYzAsCiAgc2t5Ymx1ZTogMHg4N2NlZWIsCiAgc2xhdGVibHVlOiAweDZhNWFjZCwKICBzbGF0ZWdyYXk6IDB4NzA4MDkwLAogIHNsYXRlZ3JleTogMHg3MDgwOTAsCiAgc25vdzogMHhmZmZhZmEsCiAgc3ByaW5nZ3JlZW46IDB4MDBmZjdmLAogIHN0ZWVsYmx1ZTogMHg0NjgyYjQsCiAgdGFuOiAweGQyYjQ4YywKICB0ZWFsOiAweDAwODA4MCwKICB0aGlzdGxlOiAweGQ4YmZkOCwKICB0b21hdG86IDB4ZmY2MzQ3LAogIHR1cnF1b2lzZTogMHg0MGUwZDAsCiAgdmlvbGV0OiAweGVlODJlZSwKICB3aGVhdDogMHhmNWRlYjMsCiAgd2hpdGU6IDB4ZmZmZmZmLAogIHdoaXRlc21va2U6IDB4ZjVmNWY1LAogIHllbGxvdzogMHhmZmZmMDAsCiAgeWVsbG93Z3JlZW46IDB4OWFjZDMyCn07CgpkZWZpbmUoQ29sb3IsIGNvbG9yLCB7CiAgZGlzcGxheWFibGU6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMucmdiKCkuZGlzcGxheWFibGUoKTsKICB9LAogIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLnJnYigpICsgIiI7CiAgfQp9KTsKCmZ1bmN0aW9uIGNvbG9yKGZvcm1hdCkgewogIHZhciBtOwogIGZvcm1hdCA9IChmb3JtYXQgKyAiIikudHJpbSgpLnRvTG93ZXJDYXNlKCk7CiAgcmV0dXJuIChtID0gcmVIZXgzLmV4ZWMoZm9ybWF0KSkgPyAobSA9IHBhcnNlSW50KG1bMV0sIDE2KSwgbmV3IFJnYigobSA+PiA4ICYgMHhmKSB8IChtID4+IDQgJiAweDBmMCksIChtID4+IDQgJiAweGYpIHwgKG0gJiAweGYwKSwgKChtICYgMHhmKSA8PCA0KSB8IChtICYgMHhmKSwgMSkpIC8vICNmMDAKICAgICAgOiAobSA9IHJlSGV4Ni5leGVjKGZvcm1hdCkpID8gcmdibihwYXJzZUludChtWzFdLCAxNikpIC8vICNmZjAwMDAKICAgICAgOiAobSA9IHJlUmdiSW50ZWdlci5leGVjKGZvcm1hdCkpID8gbmV3IFJnYihtWzFdLCBtWzJdLCBtWzNdLCAxKSAvLyByZ2IoMjU1LCAwLCAwKQogICAgICA6IChtID0gcmVSZ2JQZXJjZW50LmV4ZWMoZm9ybWF0KSkgPyBuZXcgUmdiKG1bMV0gKiAyNTUgLyAxMDAsIG1bMl0gKiAyNTUgLyAxMDAsIG1bM10gKiAyNTUgLyAxMDAsIDEpIC8vIHJnYigxMDAlLCAwJSwgMCUpCiAgICAgIDogKG0gPSByZVJnYmFJbnRlZ2VyLmV4ZWMoZm9ybWF0KSkgPyByZ2JhKG1bMV0sIG1bMl0sIG1bM10sIG1bNF0pIC8vIHJnYmEoMjU1LCAwLCAwLCAxKQogICAgICA6IChtID0gcmVSZ2JhUGVyY2VudC5leGVjKGZvcm1hdCkpID8gcmdiYShtWzFdICogMjU1IC8gMTAwLCBtWzJdICogMjU1IC8gMTAwLCBtWzNdICogMjU1IC8gMTAwLCBtWzRdKSAvLyByZ2IoMTAwJSwgMCUsIDAlLCAxKQogICAgICA6IChtID0gcmVIc2xQZXJjZW50LmV4ZWMoZm9ybWF0KSkgPyBoc2xhKG1bMV0sIG1bMl0gLyAxMDAsIG1bM10gLyAxMDAsIDEpIC8vIGhzbCgxMjAsIDUwJSwgNTAlKQogICAgICA6IChtID0gcmVIc2xhUGVyY2VudC5leGVjKGZvcm1hdCkpID8gaHNsYShtWzFdLCBtWzJdIC8gMTAwLCBtWzNdIC8gMTAwLCBtWzRdKSAvLyBoc2xhKDEyMCwgNTAlLCA1MCUsIDEpCiAgICAgIDogbmFtZWQuaGFzT3duUHJvcGVydHkoZm9ybWF0KSA/IHJnYm4obmFtZWRbZm9ybWF0XSkKICAgICAgOiBmb3JtYXQgPT09ICJ0cmFuc3BhcmVudCIgPyBuZXcgUmdiKE5hTiwgTmFOLCBOYU4sIDApCiAgICAgIDogbnVsbDsKfQoKZnVuY3Rpb24gcmdibihuKSB7CiAgcmV0dXJuIG5ldyBSZ2IobiA+PiAxNiAmIDB4ZmYsIG4gPj4gOCAmIDB4ZmYsIG4gJiAweGZmLCAxKTsKfQoKZnVuY3Rpb24gcmdiYShyLCBnLCBiLCBhKSB7CiAgaWYgKGEgPD0gMCkgciA9IGcgPSBiID0gTmFOOwogIHJldHVybiBuZXcgUmdiKHIsIGcsIGIsIGEpOwp9CgpmdW5jdGlvbiByZ2JDb252ZXJ0KG8pIHsKICBpZiAoIShvIGluc3RhbmNlb2YgQ29sb3IpKSBvID0gY29sb3Iobyk7CiAgaWYgKCFvKSByZXR1cm4gbmV3IFJnYjsKICBvID0gby5yZ2IoKTsKICByZXR1cm4gbmV3IFJnYihvLnIsIG8uZywgby5iLCBvLm9wYWNpdHkpOwp9CgpmdW5jdGlvbiByZ2IociwgZywgYiwgb3BhY2l0eSkgewogIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gcmdiQ29udmVydChyKSA6IG5ldyBSZ2IociwgZywgYiwgb3BhY2l0eSA9PSBudWxsID8gMSA6IG9wYWNpdHkpOwp9CgpmdW5jdGlvbiBSZ2IociwgZywgYiwgb3BhY2l0eSkgewogIHRoaXMuciA9ICtyOwogIHRoaXMuZyA9ICtnOwogIHRoaXMuYiA9ICtiOwogIHRoaXMub3BhY2l0eSA9ICtvcGFjaXR5Owp9CgpkZWZpbmUoUmdiLCByZ2IsIGV4dGVuZChDb2xvciwgewogIGJyaWdodGVyOiBmdW5jdGlvbihrKSB7CiAgICBrID0gayA9PSBudWxsID8gYnJpZ2h0ZXIgOiBNYXRoLnBvdyhicmlnaHRlciwgayk7CiAgICByZXR1cm4gbmV3IFJnYih0aGlzLnIgKiBrLCB0aGlzLmcgKiBrLCB0aGlzLmIgKiBrLCB0aGlzLm9wYWNpdHkpOwogIH0sCiAgZGFya2VyOiBmdW5jdGlvbihrKSB7CiAgICBrID0gayA9PSBudWxsID8gZGFya2VyIDogTWF0aC5wb3coZGFya2VyLCBrKTsKICAgIHJldHVybiBuZXcgUmdiKHRoaXMuciAqIGssIHRoaXMuZyAqIGssIHRoaXMuYiAqIGssIHRoaXMub3BhY2l0eSk7CiAgfSwKICByZ2I6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBkaXNwbGF5YWJsZTogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gKDAgPD0gdGhpcy5yICYmIHRoaXMuciA8PSAyNTUpCiAgICAgICAgJiYgKDAgPD0gdGhpcy5nICYmIHRoaXMuZyA8PSAyNTUpCiAgICAgICAgJiYgKDAgPD0gdGhpcy5iICYmIHRoaXMuYiA8PSAyNTUpCiAgICAgICAgJiYgKDAgPD0gdGhpcy5vcGFjaXR5ICYmIHRoaXMub3BhY2l0eSA8PSAxKTsKICB9LAogIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsKICAgIHZhciBhID0gdGhpcy5vcGFjaXR5OyBhID0gaXNOYU4oYSkgPyAxIDogTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgYSkpOwogICAgcmV0dXJuIChhID09PSAxID8gInJnYigiIDogInJnYmEoIikKICAgICAgICArIE1hdGgubWF4KDAsIE1hdGgubWluKDI1NSwgTWF0aC5yb3VuZCh0aGlzLnIpIHx8IDApKSArICIsICIKICAgICAgICArIE1hdGgubWF4KDAsIE1hdGgubWluKDI1NSwgTWF0aC5yb3VuZCh0aGlzLmcpIHx8IDApKSArICIsICIKICAgICAgICArIE1hdGgubWF4KDAsIE1hdGgubWluKDI1NSwgTWF0aC5yb3VuZCh0aGlzLmIpIHx8IDApKQogICAgICAgICsgKGEgPT09IDEgPyAiKSIgOiAiLCAiICsgYSArICIpIik7CiAgfQp9KSk7CgpmdW5jdGlvbiBoc2xhKGgsIHMsIGwsIGEpIHsKICBpZiAoYSA8PSAwKSBoID0gcyA9IGwgPSBOYU47CiAgZWxzZSBpZiAobCA8PSAwIHx8IGwgPj0gMSkgaCA9IHMgPSBOYU47CiAgZWxzZSBpZiAocyA8PSAwKSBoID0gTmFOOwogIHJldHVybiBuZXcgSHNsKGgsIHMsIGwsIGEpOwp9CgpmdW5jdGlvbiBoc2xDb252ZXJ0KG8pIHsKICBpZiAobyBpbnN0YW5jZW9mIEhzbCkgcmV0dXJuIG5ldyBIc2woby5oLCBvLnMsIG8ubCwgby5vcGFjaXR5KTsKICBpZiAoIShvIGluc3RhbmNlb2YgQ29sb3IpKSBvID0gY29sb3Iobyk7CiAgaWYgKCFvKSByZXR1cm4gbmV3IEhzbDsKICBpZiAobyBpbnN0YW5jZW9mIEhzbCkgcmV0dXJuIG87CiAgbyA9IG8ucmdiKCk7CiAgdmFyIHIgPSBvLnIgLyAyNTUsCiAgICAgIGcgPSBvLmcgLyAyNTUsCiAgICAgIGIgPSBvLmIgLyAyNTUsCiAgICAgIG1pbiA9IE1hdGgubWluKHIsIGcsIGIpLAogICAgICBtYXggPSBNYXRoLm1heChyLCBnLCBiKSwKICAgICAgaCA9IE5hTiwKICAgICAgcyA9IG1heCAtIG1pbiwKICAgICAgbCA9IChtYXggKyBtaW4pIC8gMjsKICBpZiAocykgewogICAgaWYgKHIgPT09IG1heCkgaCA9IChnIC0gYikgLyBzICsgKGcgPCBiKSAqIDY7CiAgICBlbHNlIGlmIChnID09PSBtYXgpIGggPSAoYiAtIHIpIC8gcyArIDI7CiAgICBlbHNlIGggPSAociAtIGcpIC8gcyArIDQ7CiAgICBzIC89IGwgPCAwLjUgPyBtYXggKyBtaW4gOiAyIC0gbWF4IC0gbWluOwogICAgaCAqPSA2MDsKICB9IGVsc2UgewogICAgcyA9IGwgPiAwICYmIGwgPCAxID8gMCA6IGg7CiAgfQogIHJldHVybiBuZXcgSHNsKGgsIHMsIGwsIG8ub3BhY2l0eSk7Cn0KCmZ1bmN0aW9uIGhzbChoLCBzLCBsLCBvcGFjaXR5KSB7CiAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPyBoc2xDb252ZXJ0KGgpIDogbmV3IEhzbChoLCBzLCBsLCBvcGFjaXR5ID09IG51bGwgPyAxIDogb3BhY2l0eSk7Cn0KCmZ1bmN0aW9uIEhzbChoLCBzLCBsLCBvcGFjaXR5KSB7CiAgdGhpcy5oID0gK2g7CiAgdGhpcy5zID0gK3M7CiAgdGhpcy5sID0gK2w7CiAgdGhpcy5vcGFjaXR5ID0gK29wYWNpdHk7Cn0KCmRlZmluZShIc2wsIGhzbCwgZXh0ZW5kKENvbG9yLCB7CiAgYnJpZ2h0ZXI6IGZ1bmN0aW9uKGspIHsKICAgIGsgPSBrID09IG51bGwgPyBicmlnaHRlciA6IE1hdGgucG93KGJyaWdodGVyLCBrKTsKICAgIHJldHVybiBuZXcgSHNsKHRoaXMuaCwgdGhpcy5zLCB0aGlzLmwgKiBrLCB0aGlzLm9wYWNpdHkpOwogIH0sCiAgZGFya2VyOiBmdW5jdGlvbihrKSB7CiAgICBrID0gayA9PSBudWxsID8gZGFya2VyIDogTWF0aC5wb3coZGFya2VyLCBrKTsKICAgIHJldHVybiBuZXcgSHNsKHRoaXMuaCwgdGhpcy5zLCB0aGlzLmwgKiBrLCB0aGlzLm9wYWNpdHkpOwogIH0sCiAgcmdiOiBmdW5jdGlvbigpIHsKICAgIHZhciBoID0gdGhpcy5oICUgMzYwICsgKHRoaXMuaCA8IDApICogMzYwLAogICAgICAgIHMgPSBpc05hTihoKSB8fCBpc05hTih0aGlzLnMpID8gMCA6IHRoaXMucywKICAgICAgICBsID0gdGhpcy5sLAogICAgICAgIG0yID0gbCArIChsIDwgMC41ID8gbCA6IDEgLSBsKSAqIHMsCiAgICAgICAgbTEgPSAyICogbCAtIG0yOwogICAgcmV0dXJuIG5ldyBSZ2IoCiAgICAgIGhzbDJyZ2IoaCA+PSAyNDAgPyBoIC0gMjQwIDogaCArIDEyMCwgbTEsIG0yKSwKICAgICAgaHNsMnJnYihoLCBtMSwgbTIpLAogICAgICBoc2wycmdiKGggPCAxMjAgPyBoICsgMjQwIDogaCAtIDEyMCwgbTEsIG0yKSwKICAgICAgdGhpcy5vcGFjaXR5CiAgICApOwogIH0sCiAgZGlzcGxheWFibGU6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuICgwIDw9IHRoaXMucyAmJiB0aGlzLnMgPD0gMSB8fCBpc05hTih0aGlzLnMpKQogICAgICAgICYmICgwIDw9IHRoaXMubCAmJiB0aGlzLmwgPD0gMSkKICAgICAgICAmJiAoMCA8PSB0aGlzLm9wYWNpdHkgJiYgdGhpcy5vcGFjaXR5IDw9IDEpOwogIH0KfSkpOwoKLyogRnJvbSBGdkQgMTMuMzcsIENTUyBDb2xvciBNb2R1bGUgTGV2ZWwgMyAqLwpmdW5jdGlvbiBoc2wycmdiKGgsIG0xLCBtMikgewogIHJldHVybiAoaCA8IDYwID8gbTEgKyAobTIgLSBtMSkgKiBoIC8gNjAKICAgICAgOiBoIDwgMTgwID8gbTIKICAgICAgOiBoIDwgMjQwID8gbTEgKyAobTIgLSBtMSkgKiAoMjQwIC0gaCkgLyA2MAogICAgICA6IG0xKSAqIDI1NTsKfQoKdmFyIGRlZzJyYWQgPSBNYXRoLlBJIC8gMTgwOwp2YXIgcmFkMmRlZyA9IDE4MCAvIE1hdGguUEk7CgovLyBodHRwczovL2JldGEub2JzZXJ2YWJsZWhxLmNvbS9AbWJvc3RvY2svbGFiLWFuZC1yZ2IKdmFyIEsgPSAxOCwKICAgIFhuID0gMC45NjQyMiwKICAgIFluID0gMSwKICAgIFpuID0gMC44MjUyMSwKICAgIHQwID0gNCAvIDI5LAogICAgdDEgPSA2IC8gMjksCiAgICB0MiA9IDMgKiB0MSAqIHQxLAogICAgdDMgPSB0MSAqIHQxICogdDE7CgpmdW5jdGlvbiBsYWJDb252ZXJ0KG8pIHsKICBpZiAobyBpbnN0YW5jZW9mIExhYikgcmV0dXJuIG5ldyBMYWIoby5sLCBvLmEsIG8uYiwgby5vcGFjaXR5KTsKICBpZiAobyBpbnN0YW5jZW9mIEhjbCkgewogICAgaWYgKGlzTmFOKG8uaCkpIHJldHVybiBuZXcgTGFiKG8ubCwgMCwgMCwgby5vcGFjaXR5KTsKICAgIHZhciBoID0gby5oICogZGVnMnJhZDsKICAgIHJldHVybiBuZXcgTGFiKG8ubCwgTWF0aC5jb3MoaCkgKiBvLmMsIE1hdGguc2luKGgpICogby5jLCBvLm9wYWNpdHkpOwogIH0KICBpZiAoIShvIGluc3RhbmNlb2YgUmdiKSkgbyA9IHJnYkNvbnZlcnQobyk7CiAgdmFyIHIgPSByZ2IybHJnYihvLnIpLAogICAgICBnID0gcmdiMmxyZ2Ioby5nKSwKICAgICAgYiA9IHJnYjJscmdiKG8uYiksCiAgICAgIHkgPSB4eXoybGFiKCgwLjIyMjUwNDUgKiByICsgMC43MTY4Nzg2ICogZyArIDAuMDYwNjE2OSAqIGIpIC8gWW4pLCB4LCB6OwogIGlmIChyID09PSBnICYmIGcgPT09IGIpIHggPSB6ID0geTsgZWxzZSB7CiAgICB4ID0geHl6MmxhYigoMC40MzYwNzQ3ICogciArIDAuMzg1MDY0OSAqIGcgKyAwLjE0MzA4MDQgKiBiKSAvIFhuKTsKICAgIHogPSB4eXoybGFiKCgwLjAxMzkzMjIgKiByICsgMC4wOTcxMDQ1ICogZyArIDAuNzE0MTczMyAqIGIpIC8gWm4pOwogIH0KICByZXR1cm4gbmV3IExhYigxMTYgKiB5IC0gMTYsIDUwMCAqICh4IC0geSksIDIwMCAqICh5IC0geiksIG8ub3BhY2l0eSk7Cn0KCmZ1bmN0aW9uIGdyYXkobCwgb3BhY2l0eSkgewogIHJldHVybiBuZXcgTGFiKGwsIDAsIDAsIG9wYWNpdHkgPT0gbnVsbCA/IDEgOiBvcGFjaXR5KTsKfQoKZnVuY3Rpb24gbGFiKGwsIGEsIGIsIG9wYWNpdHkpIHsKICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA9PT0gMSA/IGxhYkNvbnZlcnQobCkgOiBuZXcgTGFiKGwsIGEsIGIsIG9wYWNpdHkgPT0gbnVsbCA/IDEgOiBvcGFjaXR5KTsKfQoKZnVuY3Rpb24gTGFiKGwsIGEsIGIsIG9wYWNpdHkpIHsKICB0aGlzLmwgPSArbDsKICB0aGlzLmEgPSArYTsKICB0aGlzLmIgPSArYjsKICB0aGlzLm9wYWNpdHkgPSArb3BhY2l0eTsKfQoKZGVmaW5lKExhYiwgbGFiLCBleHRlbmQoQ29sb3IsIHsKICBicmlnaHRlcjogZnVuY3Rpb24oaykgewogICAgcmV0dXJuIG5ldyBMYWIodGhpcy5sICsgSyAqIChrID09IG51bGwgPyAxIDogayksIHRoaXMuYSwgdGhpcy5iLCB0aGlzLm9wYWNpdHkpOwogIH0sCiAgZGFya2VyOiBmdW5jdGlvbihrKSB7CiAgICByZXR1cm4gbmV3IExhYih0aGlzLmwgLSBLICogKGsgPT0gbnVsbCA/IDEgOiBrKSwgdGhpcy5hLCB0aGlzLmIsIHRoaXMub3BhY2l0eSk7CiAgfSwKICByZ2I6IGZ1bmN0aW9uKCkgewogICAgdmFyIHkgPSAodGhpcy5sICsgMTYpIC8gMTE2LAogICAgICAgIHggPSBpc05hTih0aGlzLmEpID8geSA6IHkgKyB0aGlzLmEgLyA1MDAsCiAgICAgICAgeiA9IGlzTmFOKHRoaXMuYikgPyB5IDogeSAtIHRoaXMuYiAvIDIwMDsKICAgIHggPSBYbiAqIGxhYjJ4eXooeCk7CiAgICB5ID0gWW4gKiBsYWIyeHl6KHkpOwogICAgeiA9IFpuICogbGFiMnh5eih6KTsKICAgIHJldHVybiBuZXcgUmdiKAogICAgICBscmdiMnJnYiggMy4xMzM4NTYxICogeCAtIDEuNjE2ODY2NyAqIHkgLSAwLjQ5MDYxNDYgKiB6KSwKICAgICAgbHJnYjJyZ2IoLTAuOTc4NzY4NCAqIHggKyAxLjkxNjE0MTUgKiB5ICsgMC4wMzM0NTQwICogeiksCiAgICAgIGxyZ2IycmdiKCAwLjA3MTk0NTMgKiB4IC0gMC4yMjg5OTE0ICogeSArIDEuNDA1MjQyNyAqIHopLAogICAgICB0aGlzLm9wYWNpdHkKICAgICk7CiAgfQp9KSk7CgpmdW5jdGlvbiB4eXoybGFiKHQpIHsKICByZXR1cm4gdCA+IHQzID8gTWF0aC5wb3codCwgMSAvIDMpIDogdCAvIHQyICsgdDA7Cn0KCmZ1bmN0aW9uIGxhYjJ4eXoodCkgewogIHJldHVybiB0ID4gdDEgPyB0ICogdCAqIHQgOiB0MiAqICh0IC0gdDApOwp9CgpmdW5jdGlvbiBscmdiMnJnYih4KSB7CiAgcmV0dXJuIDI1NSAqICh4IDw9IDAuMDAzMTMwOCA/IDEyLjkyICogeCA6IDEuMDU1ICogTWF0aC5wb3coeCwgMSAvIDIuNCkgLSAwLjA1NSk7Cn0KCmZ1bmN0aW9uIHJnYjJscmdiKHgpIHsKICByZXR1cm4gKHggLz0gMjU1KSA8PSAwLjA0MDQ1ID8geCAvIDEyLjkyIDogTWF0aC5wb3coKHggKyAwLjA1NSkgLyAxLjA1NSwgMi40KTsKfQoKZnVuY3Rpb24gaGNsQ29udmVydChvKSB7CiAgaWYgKG8gaW5zdGFuY2VvZiBIY2wpIHJldHVybiBuZXcgSGNsKG8uaCwgby5jLCBvLmwsIG8ub3BhY2l0eSk7CiAgaWYgKCEobyBpbnN0YW5jZW9mIExhYikpIG8gPSBsYWJDb252ZXJ0KG8pOwogIGlmIChvLmEgPT09IDAgJiYgby5iID09PSAwKSByZXR1cm4gbmV3IEhjbChOYU4sIDAsIG8ubCwgby5vcGFjaXR5KTsKICB2YXIgaCA9IE1hdGguYXRhbjIoby5iLCBvLmEpICogcmFkMmRlZzsKICByZXR1cm4gbmV3IEhjbChoIDwgMCA/IGggKyAzNjAgOiBoLCBNYXRoLnNxcnQoby5hICogby5hICsgby5iICogby5iKSwgby5sLCBvLm9wYWNpdHkpOwp9CgpmdW5jdGlvbiBsY2gobCwgYywgaCwgb3BhY2l0eSkgewogIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gaGNsQ29udmVydChsKSA6IG5ldyBIY2woaCwgYywgbCwgb3BhY2l0eSA9PSBudWxsID8gMSA6IG9wYWNpdHkpOwp9CgpmdW5jdGlvbiBoY2woaCwgYywgbCwgb3BhY2l0eSkgewogIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gaGNsQ29udmVydChoKSA6IG5ldyBIY2woaCwgYywgbCwgb3BhY2l0eSA9PSBudWxsID8gMSA6IG9wYWNpdHkpOwp9CgpmdW5jdGlvbiBIY2woaCwgYywgbCwgb3BhY2l0eSkgewogIHRoaXMuaCA9ICtoOwogIHRoaXMuYyA9ICtjOwogIHRoaXMubCA9ICtsOwogIHRoaXMub3BhY2l0eSA9ICtvcGFjaXR5Owp9CgpkZWZpbmUoSGNsLCBoY2wsIGV4dGVuZChDb2xvciwgewogIGJyaWdodGVyOiBmdW5jdGlvbihrKSB7CiAgICByZXR1cm4gbmV3IEhjbCh0aGlzLmgsIHRoaXMuYywgdGhpcy5sICsgSyAqIChrID09IG51bGwgPyAxIDogayksIHRoaXMub3BhY2l0eSk7CiAgfSwKICBkYXJrZXI6IGZ1bmN0aW9uKGspIHsKICAgIHJldHVybiBuZXcgSGNsKHRoaXMuaCwgdGhpcy5jLCB0aGlzLmwgLSBLICogKGsgPT0gbnVsbCA/IDEgOiBrKSwgdGhpcy5vcGFjaXR5KTsKICB9LAogIHJnYjogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gbGFiQ29udmVydCh0aGlzKS5yZ2IoKTsKICB9Cn0pKTsKCnZhciBBID0gLTAuMTQ4NjEsCiAgICBCID0gKzEuNzgyNzcsCiAgICBDID0gLTAuMjkyMjcsCiAgICBEID0gLTAuOTA2NDksCiAgICBFID0gKzEuOTcyOTQsCiAgICBFRCA9IEUgKiBELAogICAgRUIgPSBFICogQiwKICAgIEJDX0RBID0gQiAqIEMgLSBEICogQTsKCmZ1bmN0aW9uIGN1YmVoZWxpeENvbnZlcnQobykgewogIGlmIChvIGluc3RhbmNlb2YgQ3ViZWhlbGl4KSByZXR1cm4gbmV3IEN1YmVoZWxpeChvLmgsIG8ucywgby5sLCBvLm9wYWNpdHkpOwogIGlmICghKG8gaW5zdGFuY2VvZiBSZ2IpKSBvID0gcmdiQ29udmVydChvKTsKICB2YXIgciA9IG8uciAvIDI1NSwKICAgICAgZyA9IG8uZyAvIDI1NSwKICAgICAgYiA9IG8uYiAvIDI1NSwKICAgICAgbCA9IChCQ19EQSAqIGIgKyBFRCAqIHIgLSBFQiAqIGcpIC8gKEJDX0RBICsgRUQgLSBFQiksCiAgICAgIGJsID0gYiAtIGwsCiAgICAgIGsgPSAoRSAqIChnIC0gbCkgLSBDICogYmwpIC8gRCwKICAgICAgcyA9IE1hdGguc3FydChrICogayArIGJsICogYmwpIC8gKEUgKiBsICogKDEgLSBsKSksIC8vIE5hTiBpZiBsPTAgb3IgbD0xCiAgICAgIGggPSBzID8gTWF0aC5hdGFuMihrLCBibCkgKiByYWQyZGVnIC0gMTIwIDogTmFOOwogIHJldHVybiBuZXcgQ3ViZWhlbGl4KGggPCAwID8gaCArIDM2MCA6IGgsIHMsIGwsIG8ub3BhY2l0eSk7Cn0KCmZ1bmN0aW9uIGN1YmVoZWxpeChoLCBzLCBsLCBvcGFjaXR5KSB7CiAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPyBjdWJlaGVsaXhDb252ZXJ0KGgpIDogbmV3IEN1YmVoZWxpeChoLCBzLCBsLCBvcGFjaXR5ID09IG51bGwgPyAxIDogb3BhY2l0eSk7Cn0KCmZ1bmN0aW9uIEN1YmVoZWxpeChoLCBzLCBsLCBvcGFjaXR5KSB7CiAgdGhpcy5oID0gK2g7CiAgdGhpcy5zID0gK3M7CiAgdGhpcy5sID0gK2w7CiAgdGhpcy5vcGFjaXR5ID0gK29wYWNpdHk7Cn0KCmRlZmluZShDdWJlaGVsaXgsIGN1YmVoZWxpeCwgZXh0ZW5kKENvbG9yLCB7CiAgYnJpZ2h0ZXI6IGZ1bmN0aW9uKGspIHsKICAgIGsgPSBrID09IG51bGwgPyBicmlnaHRlciA6IE1hdGgucG93KGJyaWdodGVyLCBrKTsKICAgIHJldHVybiBuZXcgQ3ViZWhlbGl4KHRoaXMuaCwgdGhpcy5zLCB0aGlzLmwgKiBrLCB0aGlzLm9wYWNpdHkpOwogIH0sCiAgZGFya2VyOiBmdW5jdGlvbihrKSB7CiAgICBrID0gayA9PSBudWxsID8gZGFya2VyIDogTWF0aC5wb3coZGFya2VyLCBrKTsKICAgIHJldHVybiBuZXcgQ3ViZWhlbGl4KHRoaXMuaCwgdGhpcy5zLCB0aGlzLmwgKiBrLCB0aGlzLm9wYWNpdHkpOwogIH0sCiAgcmdiOiBmdW5jdGlvbigpIHsKICAgIHZhciBoID0gaXNOYU4odGhpcy5oKSA/IDAgOiAodGhpcy5oICsgMTIwKSAqIGRlZzJyYWQsCiAgICAgICAgbCA9ICt0aGlzLmwsCiAgICAgICAgYSA9IGlzTmFOKHRoaXMucykgPyAwIDogdGhpcy5zICogbCAqICgxIC0gbCksCiAgICAgICAgY29zaCA9IE1hdGguY29zKGgpLAogICAgICAgIHNpbmggPSBNYXRoLnNpbihoKTsKICAgIHJldHVybiBuZXcgUmdiKAogICAgICAyNTUgKiAobCArIGEgKiAoQSAqIGNvc2ggKyBCICogc2luaCkpLAogICAgICAyNTUgKiAobCArIGEgKiAoQyAqIGNvc2ggKyBEICogc2luaCkpLAogICAgICAyNTUgKiAobCArIGEgKiAoRSAqIGNvc2gpKSwKICAgICAgdGhpcy5vcGFjaXR5CiAgICApOwogIH0KfSkpOwoKZnVuY3Rpb24gYmFzaXModDEsIHYwLCB2MSwgdjIsIHYzKSB7CiAgdmFyIHQyID0gdDEgKiB0MSwgdDMgPSB0MiAqIHQxOwogIHJldHVybiAoKDEgLSAzICogdDEgKyAzICogdDIgLSB0MykgKiB2MAogICAgICArICg0IC0gNiAqIHQyICsgMyAqIHQzKSAqIHYxCiAgICAgICsgKDEgKyAzICogdDEgKyAzICogdDIgLSAzICogdDMpICogdjIKICAgICAgKyB0MyAqIHYzKSAvIDY7Cn0KCmZ1bmN0aW9uIGJhc2lzJDEodmFsdWVzKSB7CiAgdmFyIG4gPSB2YWx1ZXMubGVuZ3RoIC0gMTsKICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgdmFyIGkgPSB0IDw9IDAgPyAodCA9IDApIDogdCA+PSAxID8gKHQgPSAxLCBuIC0gMSkgOiBNYXRoLmZsb29yKHQgKiBuKSwKICAgICAgICB2MSA9IHZhbHVlc1tpXSwKICAgICAgICB2MiA9IHZhbHVlc1tpICsgMV0sCiAgICAgICAgdjAgPSBpID4gMCA/IHZhbHVlc1tpIC0gMV0gOiAyICogdjEgLSB2MiwKICAgICAgICB2MyA9IGkgPCBuIC0gMSA/IHZhbHVlc1tpICsgMl0gOiAyICogdjIgLSB2MTsKICAgIHJldHVybiBiYXNpcygodCAtIGkgLyBuKSAqIG4sIHYwLCB2MSwgdjIsIHYzKTsKICB9Owp9CgpmdW5jdGlvbiBiYXNpc0Nsb3NlZCh2YWx1ZXMpIHsKICB2YXIgbiA9IHZhbHVlcy5sZW5ndGg7CiAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgIHZhciBpID0gTWF0aC5mbG9vcigoKHQgJT0gMSkgPCAwID8gKyt0IDogdCkgKiBuKSwKICAgICAgICB2MCA9IHZhbHVlc1soaSArIG4gLSAxKSAlIG5dLAogICAgICAgIHYxID0gdmFsdWVzW2kgJSBuXSwKICAgICAgICB2MiA9IHZhbHVlc1soaSArIDEpICUgbl0sCiAgICAgICAgdjMgPSB2YWx1ZXNbKGkgKyAyKSAlIG5dOwogICAgcmV0dXJuIGJhc2lzKCh0IC0gaSAvIG4pICogbiwgdjAsIHYxLCB2MiwgdjMpOwogIH07Cn0KCmZ1bmN0aW9uIGNvbnN0YW50JDMoeCkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB4OwogIH07Cn0KCmZ1bmN0aW9uIGxpbmVhcihhLCBkKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgIHJldHVybiBhICsgdCAqIGQ7CiAgfTsKfQoKZnVuY3Rpb24gZXhwb25lbnRpYWwoYSwgYiwgeSkgewogIHJldHVybiBhID0gTWF0aC5wb3coYSwgeSksIGIgPSBNYXRoLnBvdyhiLCB5KSAtIGEsIHkgPSAxIC8geSwgZnVuY3Rpb24odCkgewogICAgcmV0dXJuIE1hdGgucG93KGEgKyB0ICogYiwgeSk7CiAgfTsKfQoKZnVuY3Rpb24gaHVlKGEsIGIpIHsKICB2YXIgZCA9IGIgLSBhOwogIHJldHVybiBkID8gbGluZWFyKGEsIGQgPiAxODAgfHwgZCA8IC0xODAgPyBkIC0gMzYwICogTWF0aC5yb3VuZChkIC8gMzYwKSA6IGQpIDogY29uc3RhbnQkMyhpc05hTihhKSA/IGIgOiBhKTsKfQoKZnVuY3Rpb24gZ2FtbWEoeSkgewogIHJldHVybiAoeSA9ICt5KSA9PT0gMSA/IG5vZ2FtbWEgOiBmdW5jdGlvbihhLCBiKSB7CiAgICByZXR1cm4gYiAtIGEgPyBleHBvbmVudGlhbChhLCBiLCB5KSA6IGNvbnN0YW50JDMoaXNOYU4oYSkgPyBiIDogYSk7CiAgfTsKfQoKZnVuY3Rpb24gbm9nYW1tYShhLCBiKSB7CiAgdmFyIGQgPSBiIC0gYTsKICByZXR1cm4gZCA/IGxpbmVhcihhLCBkKSA6IGNvbnN0YW50JDMoaXNOYU4oYSkgPyBiIDogYSk7Cn0KCnZhciBpbnRlcnBvbGF0ZVJnYiA9IChmdW5jdGlvbiByZ2JHYW1tYSh5KSB7CiAgdmFyIGNvbG9yJCQxID0gZ2FtbWEoeSk7CgogIGZ1bmN0aW9uIHJnYiQkMShzdGFydCwgZW5kKSB7CiAgICB2YXIgciA9IGNvbG9yJCQxKChzdGFydCA9IHJnYihzdGFydCkpLnIsIChlbmQgPSByZ2IoZW5kKSkuciksCiAgICAgICAgZyA9IGNvbG9yJCQxKHN0YXJ0LmcsIGVuZC5nKSwKICAgICAgICBiID0gY29sb3IkJDEoc3RhcnQuYiwgZW5kLmIpLAogICAgICAgIG9wYWNpdHkgPSBub2dhbW1hKHN0YXJ0Lm9wYWNpdHksIGVuZC5vcGFjaXR5KTsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIHN0YXJ0LnIgPSByKHQpOwogICAgICBzdGFydC5nID0gZyh0KTsKICAgICAgc3RhcnQuYiA9IGIodCk7CiAgICAgIHN0YXJ0Lm9wYWNpdHkgPSBvcGFjaXR5KHQpOwogICAgICByZXR1cm4gc3RhcnQgKyAiIjsKICAgIH07CiAgfQoKICByZ2IkJDEuZ2FtbWEgPSByZ2JHYW1tYTsKCiAgcmV0dXJuIHJnYiQkMTsKfSkoMSk7CgpmdW5jdGlvbiByZ2JTcGxpbmUoc3BsaW5lKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKGNvbG9ycykgewogICAgdmFyIG4gPSBjb2xvcnMubGVuZ3RoLAogICAgICAgIHIgPSBuZXcgQXJyYXkobiksCiAgICAgICAgZyA9IG5ldyBBcnJheShuKSwKICAgICAgICBiID0gbmV3IEFycmF5KG4pLAogICAgICAgIGksIGNvbG9yJCQxOwogICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICBjb2xvciQkMSA9IHJnYihjb2xvcnNbaV0pOwogICAgICByW2ldID0gY29sb3IkJDEuciB8fCAwOwogICAgICBnW2ldID0gY29sb3IkJDEuZyB8fCAwOwogICAgICBiW2ldID0gY29sb3IkJDEuYiB8fCAwOwogICAgfQogICAgciA9IHNwbGluZShyKTsKICAgIGcgPSBzcGxpbmUoZyk7CiAgICBiID0gc3BsaW5lKGIpOwogICAgY29sb3IkJDEub3BhY2l0eSA9IDE7CiAgICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgICBjb2xvciQkMS5yID0gcih0KTsKICAgICAgY29sb3IkJDEuZyA9IGcodCk7CiAgICAgIGNvbG9yJCQxLmIgPSBiKHQpOwogICAgICByZXR1cm4gY29sb3IkJDEgKyAiIjsKICAgIH07CiAgfTsKfQoKdmFyIHJnYkJhc2lzID0gcmdiU3BsaW5lKGJhc2lzJDEpOwp2YXIgcmdiQmFzaXNDbG9zZWQgPSByZ2JTcGxpbmUoYmFzaXNDbG9zZWQpOwoKZnVuY3Rpb24gYXJyYXkkMShhLCBiKSB7CiAgdmFyIG5iID0gYiA/IGIubGVuZ3RoIDogMCwKICAgICAgbmEgPSBhID8gTWF0aC5taW4obmIsIGEubGVuZ3RoKSA6IDAsCiAgICAgIHggPSBuZXcgQXJyYXkobmEpLAogICAgICBjID0gbmV3IEFycmF5KG5iKSwKICAgICAgaTsKCiAgZm9yIChpID0gMDsgaSA8IG5hOyArK2kpIHhbaV0gPSBpbnRlcnBvbGF0ZVZhbHVlKGFbaV0sIGJbaV0pOwogIGZvciAoOyBpIDwgbmI7ICsraSkgY1tpXSA9IGJbaV07CgogIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICBmb3IgKGkgPSAwOyBpIDwgbmE7ICsraSkgY1tpXSA9IHhbaV0odCk7CiAgICByZXR1cm4gYzsKICB9Owp9CgpmdW5jdGlvbiBkYXRlKGEsIGIpIHsKICB2YXIgZCA9IG5ldyBEYXRlOwogIHJldHVybiBhID0gK2EsIGIgLT0gYSwgZnVuY3Rpb24odCkgewogICAgcmV0dXJuIGQuc2V0VGltZShhICsgYiAqIHQpLCBkOwogIH07Cn0KCmZ1bmN0aW9uIHJlaW50ZXJwb2xhdGUoYSwgYikgewogIHJldHVybiBhID0gK2EsIGIgLT0gYSwgZnVuY3Rpb24odCkgewogICAgcmV0dXJuIGEgKyBiICogdDsKICB9Owp9CgpmdW5jdGlvbiBvYmplY3QoYSwgYikgewogIHZhciBpID0ge30sCiAgICAgIGMgPSB7fSwKICAgICAgazsKCiAgaWYgKGEgPT09IG51bGwgfHwgdHlwZW9mIGEgIT09ICJvYmplY3QiKSBhID0ge307CiAgaWYgKGIgPT09IG51bGwgfHwgdHlwZW9mIGIgIT09ICJvYmplY3QiKSBiID0ge307CgogIGZvciAoayBpbiBiKSB7CiAgICBpZiAoayBpbiBhKSB7CiAgICAgIGlba10gPSBpbnRlcnBvbGF0ZVZhbHVlKGFba10sIGJba10pOwogICAgfSBlbHNlIHsKICAgICAgY1trXSA9IGJba107CiAgICB9CiAgfQoKICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgZm9yIChrIGluIGkpIGNba10gPSBpW2tdKHQpOwogICAgcmV0dXJuIGM7CiAgfTsKfQoKdmFyIHJlQSA9IC9bLStdPyg/OlxkK1wuP1xkKnxcLj9cZCspKD86W2VFXVstK10/XGQrKT8vZywKICAgIHJlQiA9IG5ldyBSZWdFeHAocmVBLnNvdXJjZSwgImciKTsKCmZ1bmN0aW9uIHplcm8oYikgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHJldHVybiBiOwogIH07Cn0KCmZ1bmN0aW9uIG9uZShiKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgIHJldHVybiBiKHQpICsgIiI7CiAgfTsKfQoKZnVuY3Rpb24gaW50ZXJwb2xhdGVTdHJpbmcoYSwgYikgewogIHZhciBiaSA9IHJlQS5sYXN0SW5kZXggPSByZUIubGFzdEluZGV4ID0gMCwgLy8gc2NhbiBpbmRleCBmb3IgbmV4dCBudW1iZXIgaW4gYgogICAgICBhbSwgLy8gY3VycmVudCBtYXRjaCBpbiBhCiAgICAgIGJtLCAvLyBjdXJyZW50IG1hdGNoIGluIGIKICAgICAgYnMsIC8vIHN0cmluZyBwcmVjZWRpbmcgY3VycmVudCBudW1iZXIgaW4gYiwgaWYgYW55CiAgICAgIGkgPSAtMSwgLy8gaW5kZXggaW4gcwogICAgICBzID0gW10sIC8vIHN0cmluZyBjb25zdGFudHMgYW5kIHBsYWNlaG9sZGVycwogICAgICBxID0gW107IC8vIG51bWJlciBpbnRlcnBvbGF0b3JzCgogIC8vIENvZXJjZSBpbnB1dHMgdG8gc3RyaW5ncy4KICBhID0gYSArICIiLCBiID0gYiArICIiOwoKICAvLyBJbnRlcnBvbGF0ZSBwYWlycyBvZiBudW1iZXJzIGluIGEgJiBiLgogIHdoaWxlICgoYW0gPSByZUEuZXhlYyhhKSkKICAgICAgJiYgKGJtID0gcmVCLmV4ZWMoYikpKSB7CiAgICBpZiAoKGJzID0gYm0uaW5kZXgpID4gYmkpIHsgLy8gYSBzdHJpbmcgcHJlY2VkZXMgdGhlIG5leHQgbnVtYmVyIGluIGIKICAgICAgYnMgPSBiLnNsaWNlKGJpLCBicyk7CiAgICAgIGlmIChzW2ldKSBzW2ldICs9IGJzOyAvLyBjb2FsZXNjZSB3aXRoIHByZXZpb3VzIHN0cmluZwogICAgICBlbHNlIHNbKytpXSA9IGJzOwogICAgfQogICAgaWYgKChhbSA9IGFtWzBdKSA9PT0gKGJtID0gYm1bMF0pKSB7IC8vIG51bWJlcnMgaW4gYSAmIGIgbWF0Y2gKICAgICAgaWYgKHNbaV0pIHNbaV0gKz0gYm07IC8vIGNvYWxlc2NlIHdpdGggcHJldmlvdXMgc3RyaW5nCiAgICAgIGVsc2Ugc1srK2ldID0gYm07CiAgICB9IGVsc2UgeyAvLyBpbnRlcnBvbGF0ZSBub24tbWF0Y2hpbmcgbnVtYmVycwogICAgICBzWysraV0gPSBudWxsOwogICAgICBxLnB1c2goe2k6IGksIHg6IHJlaW50ZXJwb2xhdGUoYW0sIGJtKX0pOwogICAgfQogICAgYmkgPSByZUIubGFzdEluZGV4OwogIH0KCiAgLy8gQWRkIHJlbWFpbnMgb2YgYi4KICBpZiAoYmkgPCBiLmxlbmd0aCkgewogICAgYnMgPSBiLnNsaWNlKGJpKTsKICAgIGlmIChzW2ldKSBzW2ldICs9IGJzOyAvLyBjb2FsZXNjZSB3aXRoIHByZXZpb3VzIHN0cmluZwogICAgZWxzZSBzWysraV0gPSBiczsKICB9CgogIC8vIFNwZWNpYWwgb3B0aW1pemF0aW9uIGZvciBvbmx5IGEgc2luZ2xlIG1hdGNoLgogIC8vIE90aGVyd2lzZSwgaW50ZXJwb2xhdGUgZWFjaCBvZiB0aGUgbnVtYmVycyBhbmQgcmVqb2luIHRoZSBzdHJpbmcuCiAgcmV0dXJuIHMubGVuZ3RoIDwgMiA/IChxWzBdCiAgICAgID8gb25lKHFbMF0ueCkKICAgICAgOiB6ZXJvKGIpKQogICAgICA6IChiID0gcS5sZW5ndGgsIGZ1bmN0aW9uKHQpIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBvOyBpIDwgYjsgKytpKSBzWyhvID0gcVtpXSkuaV0gPSBvLngodCk7CiAgICAgICAgICByZXR1cm4gcy5qb2luKCIiKTsKICAgICAgICB9KTsKfQoKZnVuY3Rpb24gaW50ZXJwb2xhdGVWYWx1ZShhLCBiKSB7CiAgdmFyIHQgPSB0eXBlb2YgYiwgYzsKICByZXR1cm4gYiA9PSBudWxsIHx8IHQgPT09ICJib29sZWFuIiA/IGNvbnN0YW50JDMoYikKICAgICAgOiAodCA9PT0gIm51bWJlciIgPyByZWludGVycG9sYXRlCiAgICAgIDogdCA9PT0gInN0cmluZyIgPyAoKGMgPSBjb2xvcihiKSkgPyAoYiA9IGMsIGludGVycG9sYXRlUmdiKSA6IGludGVycG9sYXRlU3RyaW5nKQogICAgICA6IGIgaW5zdGFuY2VvZiBjb2xvciA/IGludGVycG9sYXRlUmdiCiAgICAgIDogYiBpbnN0YW5jZW9mIERhdGUgPyBkYXRlCiAgICAgIDogQXJyYXkuaXNBcnJheShiKSA/IGFycmF5JDEKICAgICAgOiB0eXBlb2YgYi52YWx1ZU9mICE9PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBiLnRvU3RyaW5nICE9PSAiZnVuY3Rpb24iIHx8IGlzTmFOKGIpID8gb2JqZWN0CiAgICAgIDogcmVpbnRlcnBvbGF0ZSkoYSwgYik7Cn0KCmZ1bmN0aW9uIGludGVycG9sYXRlUm91bmQoYSwgYikgewogIHJldHVybiBhID0gK2EsIGIgLT0gYSwgZnVuY3Rpb24odCkgewogICAgcmV0dXJuIE1hdGgucm91bmQoYSArIGIgKiB0KTsKICB9Owp9Cgp2YXIgZGVncmVlcyA9IDE4MCAvIE1hdGguUEk7Cgp2YXIgaWRlbnRpdHkkMiA9IHsKICB0cmFuc2xhdGVYOiAwLAogIHRyYW5zbGF0ZVk6IDAsCiAgcm90YXRlOiAwLAogIHNrZXdYOiAwLAogIHNjYWxlWDogMSwKICBzY2FsZVk6IDEKfTsKCmZ1bmN0aW9uIGRlY29tcG9zZShhLCBiLCBjLCBkLCBlLCBmKSB7CiAgdmFyIHNjYWxlWCwgc2NhbGVZLCBza2V3WDsKICBpZiAoc2NhbGVYID0gTWF0aC5zcXJ0KGEgKiBhICsgYiAqIGIpKSBhIC89IHNjYWxlWCwgYiAvPSBzY2FsZVg7CiAgaWYgKHNrZXdYID0gYSAqIGMgKyBiICogZCkgYyAtPSBhICogc2tld1gsIGQgLT0gYiAqIHNrZXdYOwogIGlmIChzY2FsZVkgPSBNYXRoLnNxcnQoYyAqIGMgKyBkICogZCkpIGMgLz0gc2NhbGVZLCBkIC89IHNjYWxlWSwgc2tld1ggLz0gc2NhbGVZOwogIGlmIChhICogZCA8IGIgKiBjKSBhID0gLWEsIGIgPSAtYiwgc2tld1ggPSAtc2tld1gsIHNjYWxlWCA9IC1zY2FsZVg7CiAgcmV0dXJuIHsKICAgIHRyYW5zbGF0ZVg6IGUsCiAgICB0cmFuc2xhdGVZOiBmLAogICAgcm90YXRlOiBNYXRoLmF0YW4yKGIsIGEpICogZGVncmVlcywKICAgIHNrZXdYOiBNYXRoLmF0YW4oc2tld1gpICogZGVncmVlcywKICAgIHNjYWxlWDogc2NhbGVYLAogICAgc2NhbGVZOiBzY2FsZVkKICB9Owp9Cgp2YXIgY3NzTm9kZSwKICAgIGNzc1Jvb3QsCiAgICBjc3NWaWV3LAogICAgc3ZnTm9kZTsKCmZ1bmN0aW9uIHBhcnNlQ3NzKHZhbHVlKSB7CiAgaWYgKHZhbHVlID09PSAibm9uZSIpIHJldHVybiBpZGVudGl0eSQyOwogIGlmICghY3NzTm9kZSkgY3NzTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpLCBjc3NSb290ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCBjc3NWaWV3ID0gZG9jdW1lbnQuZGVmYXVsdFZpZXc7CiAgY3NzTm9kZS5zdHlsZS50cmFuc2Zvcm0gPSB2YWx1ZTsKICB2YWx1ZSA9IGNzc1ZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShjc3NSb290LmFwcGVuZENoaWxkKGNzc05vZGUpLCBudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKCJ0cmFuc2Zvcm0iKTsKICBjc3NSb290LnJlbW92ZUNoaWxkKGNzc05vZGUpOwogIHZhbHVlID0gdmFsdWUuc2xpY2UoNywgLTEpLnNwbGl0KCIsIik7CiAgcmV0dXJuIGRlY29tcG9zZSgrdmFsdWVbMF0sICt2YWx1ZVsxXSwgK3ZhbHVlWzJdLCArdmFsdWVbM10sICt2YWx1ZVs0XSwgK3ZhbHVlWzVdKTsKfQoKZnVuY3Rpb24gcGFyc2VTdmcodmFsdWUpIHsKICBpZiAodmFsdWUgPT0gbnVsbCkgcmV0dXJuIGlkZW50aXR5JDI7CiAgaWYgKCFzdmdOb2RlKSBzdmdOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsICJnIik7CiAgc3ZnTm9kZS5zZXRBdHRyaWJ1dGUoInRyYW5zZm9ybSIsIHZhbHVlKTsKICBpZiAoISh2YWx1ZSA9IHN2Z05vZGUudHJhbnNmb3JtLmJhc2VWYWwuY29uc29saWRhdGUoKSkpIHJldHVybiBpZGVudGl0eSQyOwogIHZhbHVlID0gdmFsdWUubWF0cml4OwogIHJldHVybiBkZWNvbXBvc2UodmFsdWUuYSwgdmFsdWUuYiwgdmFsdWUuYywgdmFsdWUuZCwgdmFsdWUuZSwgdmFsdWUuZik7Cn0KCmZ1bmN0aW9uIGludGVycG9sYXRlVHJhbnNmb3JtKHBhcnNlLCBweENvbW1hLCBweFBhcmVuLCBkZWdQYXJlbikgewoKICBmdW5jdGlvbiBwb3AocykgewogICAgcmV0dXJuIHMubGVuZ3RoID8gcy5wb3AoKSArICIgIiA6ICIiOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNsYXRlKHhhLCB5YSwgeGIsIHliLCBzLCBxKSB7CiAgICBpZiAoeGEgIT09IHhiIHx8IHlhICE9PSB5YikgewogICAgICB2YXIgaSA9IHMucHVzaCgidHJhbnNsYXRlKCIsIG51bGwsIHB4Q29tbWEsIG51bGwsIHB4UGFyZW4pOwogICAgICBxLnB1c2goe2k6IGkgLSA0LCB4OiByZWludGVycG9sYXRlKHhhLCB4Yil9LCB7aTogaSAtIDIsIHg6IHJlaW50ZXJwb2xhdGUoeWEsIHliKX0pOwogICAgfSBlbHNlIGlmICh4YiB8fCB5YikgewogICAgICBzLnB1c2goInRyYW5zbGF0ZSgiICsgeGIgKyBweENvbW1hICsgeWIgKyBweFBhcmVuKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJvdGF0ZShhLCBiLCBzLCBxKSB7CiAgICBpZiAoYSAhPT0gYikgewogICAgICBpZiAoYSAtIGIgPiAxODApIGIgKz0gMzYwOyBlbHNlIGlmIChiIC0gYSA+IDE4MCkgYSArPSAzNjA7IC8vIHNob3J0ZXN0IHBhdGgKICAgICAgcS5wdXNoKHtpOiBzLnB1c2gocG9wKHMpICsgInJvdGF0ZSgiLCBudWxsLCBkZWdQYXJlbikgLSAyLCB4OiByZWludGVycG9sYXRlKGEsIGIpfSk7CiAgICB9IGVsc2UgaWYgKGIpIHsKICAgICAgcy5wdXNoKHBvcChzKSArICJyb3RhdGUoIiArIGIgKyBkZWdQYXJlbik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBza2V3WChhLCBiLCBzLCBxKSB7CiAgICBpZiAoYSAhPT0gYikgewogICAgICBxLnB1c2goe2k6IHMucHVzaChwb3AocykgKyAic2tld1goIiwgbnVsbCwgZGVnUGFyZW4pIC0gMiwgeDogcmVpbnRlcnBvbGF0ZShhLCBiKX0pOwogICAgfSBlbHNlIGlmIChiKSB7CiAgICAgIHMucHVzaChwb3AocykgKyAic2tld1goIiArIGIgKyBkZWdQYXJlbik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzY2FsZSh4YSwgeWEsIHhiLCB5YiwgcywgcSkgewogICAgaWYgKHhhICE9PSB4YiB8fCB5YSAhPT0geWIpIHsKICAgICAgdmFyIGkgPSBzLnB1c2gocG9wKHMpICsgInNjYWxlKCIsIG51bGwsICIsIiwgbnVsbCwgIikiKTsKICAgICAgcS5wdXNoKHtpOiBpIC0gNCwgeDogcmVpbnRlcnBvbGF0ZSh4YSwgeGIpfSwge2k6IGkgLSAyLCB4OiByZWludGVycG9sYXRlKHlhLCB5Yil9KTsKICAgIH0gZWxzZSBpZiAoeGIgIT09IDEgfHwgeWIgIT09IDEpIHsKICAgICAgcy5wdXNoKHBvcChzKSArICJzY2FsZSgiICsgeGIgKyAiLCIgKyB5YiArICIpIik7CiAgICB9CiAgfQoKICByZXR1cm4gZnVuY3Rpb24oYSwgYikgewogICAgdmFyIHMgPSBbXSwgLy8gc3RyaW5nIGNvbnN0YW50cyBhbmQgcGxhY2Vob2xkZXJzCiAgICAgICAgcSA9IFtdOyAvLyBudW1iZXIgaW50ZXJwb2xhdG9ycwogICAgYSA9IHBhcnNlKGEpLCBiID0gcGFyc2UoYik7CiAgICB0cmFuc2xhdGUoYS50cmFuc2xhdGVYLCBhLnRyYW5zbGF0ZVksIGIudHJhbnNsYXRlWCwgYi50cmFuc2xhdGVZLCBzLCBxKTsKICAgIHJvdGF0ZShhLnJvdGF0ZSwgYi5yb3RhdGUsIHMsIHEpOwogICAgc2tld1goYS5za2V3WCwgYi5za2V3WCwgcywgcSk7CiAgICBzY2FsZShhLnNjYWxlWCwgYS5zY2FsZVksIGIuc2NhbGVYLCBiLnNjYWxlWSwgcywgcSk7CiAgICBhID0gYiA9IG51bGw7IC8vIGdjCiAgICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgICB2YXIgaSA9IC0xLCBuID0gcS5sZW5ndGgsIG87CiAgICAgIHdoaWxlICgrK2kgPCBuKSBzWyhvID0gcVtpXSkuaV0gPSBvLngodCk7CiAgICAgIHJldHVybiBzLmpvaW4oIiIpOwogICAgfTsKICB9Owp9Cgp2YXIgaW50ZXJwb2xhdGVUcmFuc2Zvcm1Dc3MgPSBpbnRlcnBvbGF0ZVRyYW5zZm9ybShwYXJzZUNzcywgInB4LCAiLCAicHgpIiwgImRlZykiKTsKdmFyIGludGVycG9sYXRlVHJhbnNmb3JtU3ZnID0gaW50ZXJwb2xhdGVUcmFuc2Zvcm0ocGFyc2VTdmcsICIsICIsICIpIiwgIikiKTsKCnZhciByaG8gPSBNYXRoLlNRUlQyLAogICAgcmhvMiA9IDIsCiAgICByaG80ID0gNCwKICAgIGVwc2lsb24yID0gMWUtMTI7CgpmdW5jdGlvbiBjb3NoKHgpIHsKICByZXR1cm4gKCh4ID0gTWF0aC5leHAoeCkpICsgMSAvIHgpIC8gMjsKfQoKZnVuY3Rpb24gc2luaCh4KSB7CiAgcmV0dXJuICgoeCA9IE1hdGguZXhwKHgpKSAtIDEgLyB4KSAvIDI7Cn0KCmZ1bmN0aW9uIHRhbmgoeCkgewogIHJldHVybiAoKHggPSBNYXRoLmV4cCgyICogeCkpIC0gMSkgLyAoeCArIDEpOwp9CgovLyBwMCA9IFt1eDAsIHV5MCwgdzBdCi8vIHAxID0gW3V4MSwgdXkxLCB3MV0KZnVuY3Rpb24gaW50ZXJwb2xhdGVab29tKHAwLCBwMSkgewogIHZhciB1eDAgPSBwMFswXSwgdXkwID0gcDBbMV0sIHcwID0gcDBbMl0sCiAgICAgIHV4MSA9IHAxWzBdLCB1eTEgPSBwMVsxXSwgdzEgPSBwMVsyXSwKICAgICAgZHggPSB1eDEgLSB1eDAsCiAgICAgIGR5ID0gdXkxIC0gdXkwLAogICAgICBkMiA9IGR4ICogZHggKyBkeSAqIGR5LAogICAgICBpLAogICAgICBTOwoKICAvLyBTcGVjaWFsIGNhc2UgZm9yIHUwIOKJhSB1MS4KICBpZiAoZDIgPCBlcHNpbG9uMikgewogICAgUyA9IE1hdGgubG9nKHcxIC8gdzApIC8gcmhvOwogICAgaSA9IGZ1bmN0aW9uKHQpIHsKICAgICAgcmV0dXJuIFsKICAgICAgICB1eDAgKyB0ICogZHgsCiAgICAgICAgdXkwICsgdCAqIGR5LAogICAgICAgIHcwICogTWF0aC5leHAocmhvICogdCAqIFMpCiAgICAgIF07CiAgICB9OwogIH0KCiAgLy8gR2VuZXJhbCBjYXNlLgogIGVsc2UgewogICAgdmFyIGQxID0gTWF0aC5zcXJ0KGQyKSwKICAgICAgICBiMCA9ICh3MSAqIHcxIC0gdzAgKiB3MCArIHJobzQgKiBkMikgLyAoMiAqIHcwICogcmhvMiAqIGQxKSwKICAgICAgICBiMSA9ICh3MSAqIHcxIC0gdzAgKiB3MCAtIHJobzQgKiBkMikgLyAoMiAqIHcxICogcmhvMiAqIGQxKSwKICAgICAgICByMCA9IE1hdGgubG9nKE1hdGguc3FydChiMCAqIGIwICsgMSkgLSBiMCksCiAgICAgICAgcjEgPSBNYXRoLmxvZyhNYXRoLnNxcnQoYjEgKiBiMSArIDEpIC0gYjEpOwogICAgUyA9IChyMSAtIHIwKSAvIHJobzsKICAgIGkgPSBmdW5jdGlvbih0KSB7CiAgICAgIHZhciBzID0gdCAqIFMsCiAgICAgICAgICBjb3NocjAgPSBjb3NoKHIwKSwKICAgICAgICAgIHUgPSB3MCAvIChyaG8yICogZDEpICogKGNvc2hyMCAqIHRhbmgocmhvICogcyArIHIwKSAtIHNpbmgocjApKTsKICAgICAgcmV0dXJuIFsKICAgICAgICB1eDAgKyB1ICogZHgsCiAgICAgICAgdXkwICsgdSAqIGR5LAogICAgICAgIHcwICogY29zaHIwIC8gY29zaChyaG8gKiBzICsgcjApCiAgICAgIF07CiAgICB9OwogIH0KCiAgaS5kdXJhdGlvbiA9IFMgKiAxMDAwOwoKICByZXR1cm4gaTsKfQoKZnVuY3Rpb24gaHNsJDEoaHVlJCQxKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKHN0YXJ0LCBlbmQpIHsKICAgIHZhciBoID0gaHVlJCQxKChzdGFydCA9IGhzbChzdGFydCkpLmgsIChlbmQgPSBoc2woZW5kKSkuaCksCiAgICAgICAgcyA9IG5vZ2FtbWEoc3RhcnQucywgZW5kLnMpLAogICAgICAgIGwgPSBub2dhbW1hKHN0YXJ0LmwsIGVuZC5sKSwKICAgICAgICBvcGFjaXR5ID0gbm9nYW1tYShzdGFydC5vcGFjaXR5LCBlbmQub3BhY2l0eSk7CiAgICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgICBzdGFydC5oID0gaCh0KTsKICAgICAgc3RhcnQucyA9IHModCk7CiAgICAgIHN0YXJ0LmwgPSBsKHQpOwogICAgICBzdGFydC5vcGFjaXR5ID0gb3BhY2l0eSh0KTsKICAgICAgcmV0dXJuIHN0YXJ0ICsgIiI7CiAgICB9OwogIH0KfQoKdmFyIGhzbCQyID0gaHNsJDEoaHVlKTsKdmFyIGhzbExvbmcgPSBoc2wkMShub2dhbW1hKTsKCmZ1bmN0aW9uIGxhYiQxKHN0YXJ0LCBlbmQpIHsKICB2YXIgbCA9IG5vZ2FtbWEoKHN0YXJ0ID0gbGFiKHN0YXJ0KSkubCwgKGVuZCA9IGxhYihlbmQpKS5sKSwKICAgICAgYSA9IG5vZ2FtbWEoc3RhcnQuYSwgZW5kLmEpLAogICAgICBiID0gbm9nYW1tYShzdGFydC5iLCBlbmQuYiksCiAgICAgIG9wYWNpdHkgPSBub2dhbW1hKHN0YXJ0Lm9wYWNpdHksIGVuZC5vcGFjaXR5KTsKICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgc3RhcnQubCA9IGwodCk7CiAgICBzdGFydC5hID0gYSh0KTsKICAgIHN0YXJ0LmIgPSBiKHQpOwogICAgc3RhcnQub3BhY2l0eSA9IG9wYWNpdHkodCk7CiAgICByZXR1cm4gc3RhcnQgKyAiIjsKICB9Owp9CgpmdW5jdGlvbiBoY2wkMShodWUkJDEpIHsKICByZXR1cm4gZnVuY3Rpb24oc3RhcnQsIGVuZCkgewogICAgdmFyIGggPSBodWUkJDEoKHN0YXJ0ID0gaGNsKHN0YXJ0KSkuaCwgKGVuZCA9IGhjbChlbmQpKS5oKSwKICAgICAgICBjID0gbm9nYW1tYShzdGFydC5jLCBlbmQuYyksCiAgICAgICAgbCA9IG5vZ2FtbWEoc3RhcnQubCwgZW5kLmwpLAogICAgICAgIG9wYWNpdHkgPSBub2dhbW1hKHN0YXJ0Lm9wYWNpdHksIGVuZC5vcGFjaXR5KTsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIHN0YXJ0LmggPSBoKHQpOwogICAgICBzdGFydC5jID0gYyh0KTsKICAgICAgc3RhcnQubCA9IGwodCk7CiAgICAgIHN0YXJ0Lm9wYWNpdHkgPSBvcGFjaXR5KHQpOwogICAgICByZXR1cm4gc3RhcnQgKyAiIjsKICAgIH07CiAgfQp9Cgp2YXIgaGNsJDIgPSBoY2wkMShodWUpOwp2YXIgaGNsTG9uZyA9IGhjbCQxKG5vZ2FtbWEpOwoKZnVuY3Rpb24gY3ViZWhlbGl4JDEoaHVlJCQxKSB7CiAgcmV0dXJuIChmdW5jdGlvbiBjdWJlaGVsaXhHYW1tYSh5KSB7CiAgICB5ID0gK3k7CgogICAgZnVuY3Rpb24gY3ViZWhlbGl4JCQxKHN0YXJ0LCBlbmQpIHsKICAgICAgdmFyIGggPSBodWUkJDEoKHN0YXJ0ID0gY3ViZWhlbGl4KHN0YXJ0KSkuaCwgKGVuZCA9IGN1YmVoZWxpeChlbmQpKS5oKSwKICAgICAgICAgIHMgPSBub2dhbW1hKHN0YXJ0LnMsIGVuZC5zKSwKICAgICAgICAgIGwgPSBub2dhbW1hKHN0YXJ0LmwsIGVuZC5sKSwKICAgICAgICAgIG9wYWNpdHkgPSBub2dhbW1hKHN0YXJ0Lm9wYWNpdHksIGVuZC5vcGFjaXR5KTsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgICAgICBzdGFydC5oID0gaCh0KTsKICAgICAgICBzdGFydC5zID0gcyh0KTsKICAgICAgICBzdGFydC5sID0gbChNYXRoLnBvdyh0LCB5KSk7CiAgICAgICAgc3RhcnQub3BhY2l0eSA9IG9wYWNpdHkodCk7CiAgICAgICAgcmV0dXJuIHN0YXJ0ICsgIiI7CiAgICAgIH07CiAgICB9CgogICAgY3ViZWhlbGl4JCQxLmdhbW1hID0gY3ViZWhlbGl4R2FtbWE7CgogICAgcmV0dXJuIGN1YmVoZWxpeCQkMTsKICB9KSgxKTsKfQoKdmFyIGN1YmVoZWxpeCQyID0gY3ViZWhlbGl4JDEoaHVlKTsKdmFyIGN1YmVoZWxpeExvbmcgPSBjdWJlaGVsaXgkMShub2dhbW1hKTsKCmZ1bmN0aW9uIHF1YW50aXplKGludGVycG9sYXRvciwgbikgewogIHZhciBzYW1wbGVzID0gbmV3IEFycmF5KG4pOwogIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgKytpKSBzYW1wbGVzW2ldID0gaW50ZXJwb2xhdG9yKGkgLyAobiAtIDEpKTsKICByZXR1cm4gc2FtcGxlczsKfQoKdmFyIGZyYW1lID0gMCwgLy8gaXMgYW4gYW5pbWF0aW9uIGZyYW1lIHBlbmRpbmc/CiAgICB0aW1lb3V0ID0gMCwgLy8gaXMgYSB0aW1lb3V0IHBlbmRpbmc/CiAgICBpbnRlcnZhbCA9IDAsIC8vIGFyZSBhbnkgdGltZXJzIGFjdGl2ZT8KICAgIHBva2VEZWxheSA9IDEwMDAsIC8vIGhvdyBmcmVxdWVudGx5IHdlIGNoZWNrIGZvciBjbG9jayBza2V3CiAgICB0YXNrSGVhZCwKICAgIHRhc2tUYWlsLAogICAgY2xvY2tMYXN0ID0gMCwKICAgIGNsb2NrTm93ID0gMCwKICAgIGNsb2NrU2tldyA9IDAsCiAgICBjbG9jayA9IHR5cGVvZiBwZXJmb3JtYW5jZSA9PT0gIm9iamVjdCIgJiYgcGVyZm9ybWFuY2Uubm93ID8gcGVyZm9ybWFuY2UgOiBEYXRlLAogICAgc2V0RnJhbWUgPSB0eXBlb2Ygd2luZG93ID09PSAib2JqZWN0IiAmJiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lID8gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS5iaW5kKHdpbmRvdykgOiBmdW5jdGlvbihmKSB7IHNldFRpbWVvdXQoZiwgMTcpOyB9OwoKZnVuY3Rpb24gbm93KCkgewogIHJldHVybiBjbG9ja05vdyB8fCAoc2V0RnJhbWUoY2xlYXJOb3cpLCBjbG9ja05vdyA9IGNsb2NrLm5vdygpICsgY2xvY2tTa2V3KTsKfQoKZnVuY3Rpb24gY2xlYXJOb3coKSB7CiAgY2xvY2tOb3cgPSAwOwp9CgpmdW5jdGlvbiBUaW1lcigpIHsKICB0aGlzLl9jYWxsID0KICB0aGlzLl90aW1lID0KICB0aGlzLl9uZXh0ID0gbnVsbDsKfQoKVGltZXIucHJvdG90eXBlID0gdGltZXIucHJvdG90eXBlID0gewogIGNvbnN0cnVjdG9yOiBUaW1lciwKICByZXN0YXJ0OiBmdW5jdGlvbihjYWxsYmFjaywgZGVsYXksIHRpbWUpIHsKICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgIT09ICJmdW5jdGlvbiIpIHRocm93IG5ldyBUeXBlRXJyb3IoImNhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICB0aW1lID0gKHRpbWUgPT0gbnVsbCA/IG5vdygpIDogK3RpbWUpICsgKGRlbGF5ID09IG51bGwgPyAwIDogK2RlbGF5KTsKICAgIGlmICghdGhpcy5fbmV4dCAmJiB0YXNrVGFpbCAhPT0gdGhpcykgewogICAgICBpZiAodGFza1RhaWwpIHRhc2tUYWlsLl9uZXh0ID0gdGhpczsKICAgICAgZWxzZSB0YXNrSGVhZCA9IHRoaXM7CiAgICAgIHRhc2tUYWlsID0gdGhpczsKICAgIH0KICAgIHRoaXMuX2NhbGwgPSBjYWxsYmFjazsKICAgIHRoaXMuX3RpbWUgPSB0aW1lOwogICAgc2xlZXAoKTsKICB9LAogIHN0b3A6IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMuX2NhbGwpIHsKICAgICAgdGhpcy5fY2FsbCA9IG51bGw7CiAgICAgIHRoaXMuX3RpbWUgPSBJbmZpbml0eTsKICAgICAgc2xlZXAoKTsKICAgIH0KICB9Cn07CgpmdW5jdGlvbiB0aW1lcihjYWxsYmFjaywgZGVsYXksIHRpbWUpIHsKICB2YXIgdCA9IG5ldyBUaW1lcjsKICB0LnJlc3RhcnQoY2FsbGJhY2ssIGRlbGF5LCB0aW1lKTsKICByZXR1cm4gdDsKfQoKZnVuY3Rpb24gdGltZXJGbHVzaCgpIHsKICBub3coKTsgLy8gR2V0IHRoZSBjdXJyZW50IHRpbWUsIGlmIG5vdCBhbHJlYWR5IHNldC4KICArK2ZyYW1lOyAvLyBQcmV0ZW5kIHdl4oCZdmUgc2V0IGFuIGFsYXJtLCBpZiB3ZSBoYXZlbuKAmXQgYWxyZWFkeS4KICB2YXIgdCA9IHRhc2tIZWFkLCBlOwogIHdoaWxlICh0KSB7CiAgICBpZiAoKGUgPSBjbG9ja05vdyAtIHQuX3RpbWUpID49IDApIHQuX2NhbGwuY2FsbChudWxsLCBlKTsKICAgIHQgPSB0Ll9uZXh0OwogIH0KICAtLWZyYW1lOwp9CgpmdW5jdGlvbiB3YWtlKCkgewogIGNsb2NrTm93ID0gKGNsb2NrTGFzdCA9IGNsb2NrLm5vdygpKSArIGNsb2NrU2tldzsKICBmcmFtZSA9IHRpbWVvdXQgPSAwOwogIHRyeSB7CiAgICB0aW1lckZsdXNoKCk7CiAgfSBmaW5hbGx5IHsKICAgIGZyYW1lID0gMDsKICAgIG5hcCgpOwogICAgY2xvY2tOb3cgPSAwOwogIH0KfQoKZnVuY3Rpb24gcG9rZSgpIHsKICB2YXIgbm93ID0gY2xvY2subm93KCksIGRlbGF5ID0gbm93IC0gY2xvY2tMYXN0OwogIGlmIChkZWxheSA+IHBva2VEZWxheSkgY2xvY2tTa2V3IC09IGRlbGF5LCBjbG9ja0xhc3QgPSBub3c7Cn0KCmZ1bmN0aW9uIG5hcCgpIHsKICB2YXIgdDAsIHQxID0gdGFza0hlYWQsIHQyLCB0aW1lID0gSW5maW5pdHk7CiAgd2hpbGUgKHQxKSB7CiAgICBpZiAodDEuX2NhbGwpIHsKICAgICAgaWYgKHRpbWUgPiB0MS5fdGltZSkgdGltZSA9IHQxLl90aW1lOwogICAgICB0MCA9IHQxLCB0MSA9IHQxLl9uZXh0OwogICAgfSBlbHNlIHsKICAgICAgdDIgPSB0MS5fbmV4dCwgdDEuX25leHQgPSBudWxsOwogICAgICB0MSA9IHQwID8gdDAuX25leHQgPSB0MiA6IHRhc2tIZWFkID0gdDI7CiAgICB9CiAgfQogIHRhc2tUYWlsID0gdDA7CiAgc2xlZXAodGltZSk7Cn0KCmZ1bmN0aW9uIHNsZWVwKHRpbWUpIHsKICBpZiAoZnJhbWUpIHJldHVybjsgLy8gU29vbmVzdCBhbGFybSBhbHJlYWR5IHNldCwgb3Igd2lsbCBiZS4KICBpZiAodGltZW91dCkgdGltZW91dCA9IGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICB2YXIgZGVsYXkgPSB0aW1lIC0gY2xvY2tOb3c7IC8vIFN0cmljdGx5IGxlc3MgdGhhbiBpZiB3ZSByZWNvbXB1dGVkIGNsb2NrTm93LgogIGlmIChkZWxheSA+IDI0KSB7CiAgICBpZiAodGltZSA8IEluZmluaXR5KSB0aW1lb3V0ID0gc2V0VGltZW91dCh3YWtlLCB0aW1lIC0gY2xvY2subm93KCkgLSBjbG9ja1NrZXcpOwogICAgaWYgKGludGVydmFsKSBpbnRlcnZhbCA9IGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpOwogIH0gZWxzZSB7CiAgICBpZiAoIWludGVydmFsKSBjbG9ja0xhc3QgPSBjbG9jay5ub3coKSwgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChwb2tlLCBwb2tlRGVsYXkpOwogICAgZnJhbWUgPSAxLCBzZXRGcmFtZSh3YWtlKTsKICB9Cn0KCmZ1bmN0aW9uIHRpbWVvdXQkMShjYWxsYmFjaywgZGVsYXksIHRpbWUpIHsKICB2YXIgdCA9IG5ldyBUaW1lcjsKICBkZWxheSA9IGRlbGF5ID09IG51bGwgPyAwIDogK2RlbGF5OwogIHQucmVzdGFydChmdW5jdGlvbihlbGFwc2VkKSB7CiAgICB0LnN0b3AoKTsKICAgIGNhbGxiYWNrKGVsYXBzZWQgKyBkZWxheSk7CiAgfSwgZGVsYXksIHRpbWUpOwogIHJldHVybiB0Owp9CgpmdW5jdGlvbiBpbnRlcnZhbCQxKGNhbGxiYWNrLCBkZWxheSwgdGltZSkgewogIHZhciB0ID0gbmV3IFRpbWVyLCB0b3RhbCA9IGRlbGF5OwogIGlmIChkZWxheSA9PSBudWxsKSByZXR1cm4gdC5yZXN0YXJ0KGNhbGxiYWNrLCBkZWxheSwgdGltZSksIHQ7CiAgZGVsYXkgPSArZGVsYXksIHRpbWUgPSB0aW1lID09IG51bGwgPyBub3coKSA6ICt0aW1lOwogIHQucmVzdGFydChmdW5jdGlvbiB0aWNrKGVsYXBzZWQpIHsKICAgIGVsYXBzZWQgKz0gdG90YWw7CiAgICB0LnJlc3RhcnQodGljaywgdG90YWwgKz0gZGVsYXksIHRpbWUpOwogICAgY2FsbGJhY2soZWxhcHNlZCk7CiAgfSwgZGVsYXksIHRpbWUpOwogIHJldHVybiB0Owp9Cgp2YXIgZW1wdHlPbiA9IGRpc3BhdGNoKCJzdGFydCIsICJlbmQiLCAiaW50ZXJydXB0Iik7CnZhciBlbXB0eVR3ZWVuID0gW107Cgp2YXIgQ1JFQVRFRCA9IDA7CnZhciBTQ0hFRFVMRUQgPSAxOwp2YXIgU1RBUlRJTkcgPSAyOwp2YXIgU1RBUlRFRCA9IDM7CnZhciBSVU5OSU5HID0gNDsKdmFyIEVORElORyA9IDU7CnZhciBFTkRFRCA9IDY7CgpmdW5jdGlvbiBzY2hlZHVsZShub2RlLCBuYW1lLCBpZCwgaW5kZXgsIGdyb3VwLCB0aW1pbmcpIHsKICB2YXIgc2NoZWR1bGVzID0gbm9kZS5fX3RyYW5zaXRpb247CiAgaWYgKCFzY2hlZHVsZXMpIG5vZGUuX190cmFuc2l0aW9uID0ge307CiAgZWxzZSBpZiAoaWQgaW4gc2NoZWR1bGVzKSByZXR1cm47CiAgY3JlYXRlJDEobm9kZSwgaWQsIHsKICAgIG5hbWU6IG5hbWUsCiAgICBpbmRleDogaW5kZXgsIC8vIEZvciBjb250ZXh0IGR1cmluZyBjYWxsYmFjay4KICAgIGdyb3VwOiBncm91cCwgLy8gRm9yIGNvbnRleHQgZHVyaW5nIGNhbGxiYWNrLgogICAgb246IGVtcHR5T24sCiAgICB0d2VlbjogZW1wdHlUd2VlbiwKICAgIHRpbWU6IHRpbWluZy50aW1lLAogICAgZGVsYXk6IHRpbWluZy5kZWxheSwKICAgIGR1cmF0aW9uOiB0aW1pbmcuZHVyYXRpb24sCiAgICBlYXNlOiB0aW1pbmcuZWFzZSwKICAgIHRpbWVyOiBudWxsLAogICAgc3RhdGU6IENSRUFURUQKICB9KTsKfQoKZnVuY3Rpb24gaW5pdChub2RlLCBpZCkgewogIHZhciBzY2hlZHVsZSA9IGdldCQxKG5vZGUsIGlkKTsKICBpZiAoc2NoZWR1bGUuc3RhdGUgPiBDUkVBVEVEKSB0aHJvdyBuZXcgRXJyb3IoInRvbyBsYXRlOyBhbHJlYWR5IHNjaGVkdWxlZCIpOwogIHJldHVybiBzY2hlZHVsZTsKfQoKZnVuY3Rpb24gc2V0JDEobm9kZSwgaWQpIHsKICB2YXIgc2NoZWR1bGUgPSBnZXQkMShub2RlLCBpZCk7CiAgaWYgKHNjaGVkdWxlLnN0YXRlID4gU1RBUlRJTkcpIHRocm93IG5ldyBFcnJvcigidG9vIGxhdGU7IGFscmVhZHkgc3RhcnRlZCIpOwogIHJldHVybiBzY2hlZHVsZTsKfQoKZnVuY3Rpb24gZ2V0JDEobm9kZSwgaWQpIHsKICB2YXIgc2NoZWR1bGUgPSBub2RlLl9fdHJhbnNpdGlvbjsKICBpZiAoIXNjaGVkdWxlIHx8ICEoc2NoZWR1bGUgPSBzY2hlZHVsZVtpZF0pKSB0aHJvdyBuZXcgRXJyb3IoInRyYW5zaXRpb24gbm90IGZvdW5kIik7CiAgcmV0dXJuIHNjaGVkdWxlOwp9CgpmdW5jdGlvbiBjcmVhdGUkMShub2RlLCBpZCwgc2VsZikgewogIHZhciBzY2hlZHVsZXMgPSBub2RlLl9fdHJhbnNpdGlvbiwKICAgICAgdHdlZW47CgogIC8vIEluaXRpYWxpemUgdGhlIHNlbGYgdGltZXIgd2hlbiB0aGUgdHJhbnNpdGlvbiBpcyBjcmVhdGVkLgogIC8vIE5vdGUgdGhlIGFjdHVhbCBkZWxheSBpcyBub3Qga25vd24gdW50aWwgdGhlIGZpcnN0IGNhbGxiYWNrIQogIHNjaGVkdWxlc1tpZF0gPSBzZWxmOwogIHNlbGYudGltZXIgPSB0aW1lcihzY2hlZHVsZSwgMCwgc2VsZi50aW1lKTsKCiAgZnVuY3Rpb24gc2NoZWR1bGUoZWxhcHNlZCkgewogICAgc2VsZi5zdGF0ZSA9IFNDSEVEVUxFRDsKICAgIHNlbGYudGltZXIucmVzdGFydChzdGFydCwgc2VsZi5kZWxheSwgc2VsZi50aW1lKTsKCiAgICAvLyBJZiB0aGUgZWxhcHNlZCBkZWxheSBpcyBsZXNzIHRoYW4gb3VyIGZpcnN0IHNsZWVwLCBzdGFydCBpbW1lZGlhdGVseS4KICAgIGlmIChzZWxmLmRlbGF5IDw9IGVsYXBzZWQpIHN0YXJ0KGVsYXBzZWQgLSBzZWxmLmRlbGF5KTsKICB9CgogIGZ1bmN0aW9uIHN0YXJ0KGVsYXBzZWQpIHsKICAgIHZhciBpLCBqLCBuLCBvOwoKICAgIC8vIElmIHRoZSBzdGF0ZSBpcyBub3QgU0NIRURVTEVELCB0aGVuIHdlIHByZXZpb3VzbHkgZXJyb3JlZCBvbiBzdGFydC4KICAgIGlmIChzZWxmLnN0YXRlICE9PSBTQ0hFRFVMRUQpIHJldHVybiBzdG9wKCk7CgogICAgZm9yIChpIGluIHNjaGVkdWxlcykgewogICAgICBvID0gc2NoZWR1bGVzW2ldOwogICAgICBpZiAoby5uYW1lICE9PSBzZWxmLm5hbWUpIGNvbnRpbnVlOwoKICAgICAgLy8gV2hpbGUgdGhpcyBlbGVtZW50IGFscmVhZHkgaGFzIGEgc3RhcnRpbmcgdHJhbnNpdGlvbiBkdXJpbmcgdGhpcyBmcmFtZSwKICAgICAgLy8gZGVmZXIgc3RhcnRpbmcgYW4gaW50ZXJydXB0aW5nIHRyYW5zaXRpb24gdW50aWwgdGhhdCB0cmFuc2l0aW9uIGhhcyBhCiAgICAgIC8vIGNoYW5jZSB0byB0aWNrIChhbmQgcG9zc2libHkgZW5kKTsgc2VlIGQzL2QzLXRyYW5zaXRpb24jNTQhCiAgICAgIGlmIChvLnN0YXRlID09PSBTVEFSVEVEKSByZXR1cm4gdGltZW91dCQxKHN0YXJ0KTsKCiAgICAgIC8vIEludGVycnVwdCB0aGUgYWN0aXZlIHRyYW5zaXRpb24sIGlmIGFueS4KICAgICAgLy8gRGlzcGF0Y2ggdGhlIGludGVycnVwdCBldmVudC4KICAgICAgaWYgKG8uc3RhdGUgPT09IFJVTk5JTkcpIHsKICAgICAgICBvLnN0YXRlID0gRU5ERUQ7CiAgICAgICAgby50aW1lci5zdG9wKCk7CiAgICAgICAgby5vbi5jYWxsKCJpbnRlcnJ1cHQiLCBub2RlLCBub2RlLl9fZGF0YV9fLCBvLmluZGV4LCBvLmdyb3VwKTsKICAgICAgICBkZWxldGUgc2NoZWR1bGVzW2ldOwogICAgICB9CgogICAgICAvLyBDYW5jZWwgYW55IHByZS1lbXB0ZWQgdHJhbnNpdGlvbnMuIE5vIGludGVycnVwdCBldmVudCBpcyBkaXNwYXRjaGVkCiAgICAgIC8vIGJlY2F1c2UgdGhlIGNhbmNlbGxlZCB0cmFuc2l0aW9ucyBuZXZlciBzdGFydGVkLiBOb3RlIHRoYXQgdGhpcyBhbHNvCiAgICAgIC8vIHJlbW92ZXMgdGhpcyB0cmFuc2l0aW9uIGZyb20gdGhlIHBlbmRpbmcgbGlzdCEKICAgICAgZWxzZSBpZiAoK2kgPCBpZCkgewogICAgICAgIG8uc3RhdGUgPSBFTkRFRDsKICAgICAgICBvLnRpbWVyLnN0b3AoKTsKICAgICAgICBkZWxldGUgc2NoZWR1bGVzW2ldOwogICAgICB9CiAgICB9CgogICAgLy8gRGVmZXIgdGhlIGZpcnN0IHRpY2sgdG8gZW5kIG9mIHRoZSBjdXJyZW50IGZyYW1lOyBzZWUgZDMvZDMjMTU3Ni4KICAgIC8vIE5vdGUgdGhlIHRyYW5zaXRpb24gbWF5IGJlIGNhbmNlbGVkIGFmdGVyIHN0YXJ0IGFuZCBiZWZvcmUgdGhlIGZpcnN0IHRpY2shCiAgICAvLyBOb3RlIHRoaXMgbXVzdCBiZSBzY2hlZHVsZWQgYmVmb3JlIHRoZSBzdGFydCBldmVudDsgc2VlIGQzL2QzLXRyYW5zaXRpb24jMTYhCiAgICAvLyBBc3N1bWluZyB0aGlzIGlzIHN1Y2Nlc3NmdWwsIHN1YnNlcXVlbnQgY2FsbGJhY2tzIGdvIHN0cmFpZ2h0IHRvIHRpY2suCiAgICB0aW1lb3V0JDEoZnVuY3Rpb24oKSB7CiAgICAgIGlmIChzZWxmLnN0YXRlID09PSBTVEFSVEVEKSB7CiAgICAgICAgc2VsZi5zdGF0ZSA9IFJVTk5JTkc7CiAgICAgICAgc2VsZi50aW1lci5yZXN0YXJ0KHRpY2ssIHNlbGYuZGVsYXksIHNlbGYudGltZSk7CiAgICAgICAgdGljayhlbGFwc2VkKTsKICAgICAgfQogICAgfSk7CgogICAgLy8gRGlzcGF0Y2ggdGhlIHN0YXJ0IGV2ZW50LgogICAgLy8gTm90ZSB0aGlzIG11c3QgYmUgZG9uZSBiZWZvcmUgdGhlIHR3ZWVuIGFyZSBpbml0aWFsaXplZC4KICAgIHNlbGYuc3RhdGUgPSBTVEFSVElORzsKICAgIHNlbGYub24uY2FsbCgic3RhcnQiLCBub2RlLCBub2RlLl9fZGF0YV9fLCBzZWxmLmluZGV4LCBzZWxmLmdyb3VwKTsKICAgIGlmIChzZWxmLnN0YXRlICE9PSBTVEFSVElORykgcmV0dXJuOyAvLyBpbnRlcnJ1cHRlZAogICAgc2VsZi5zdGF0ZSA9IFNUQVJURUQ7CgogICAgLy8gSW5pdGlhbGl6ZSB0aGUgdHdlZW4sIGRlbGV0aW5nIG51bGwgdHdlZW4uCiAgICB0d2VlbiA9IG5ldyBBcnJheShuID0gc2VsZi50d2Vlbi5sZW5ndGgpOwogICAgZm9yIChpID0gMCwgaiA9IC0xOyBpIDwgbjsgKytpKSB7CiAgICAgIGlmIChvID0gc2VsZi50d2VlbltpXS52YWx1ZS5jYWxsKG5vZGUsIG5vZGUuX19kYXRhX18sIHNlbGYuaW5kZXgsIHNlbGYuZ3JvdXApKSB7CiAgICAgICAgdHdlZW5bKytqXSA9IG87CiAgICAgIH0KICAgIH0KICAgIHR3ZWVuLmxlbmd0aCA9IGogKyAxOwogIH0KCiAgZnVuY3Rpb24gdGljayhlbGFwc2VkKSB7CiAgICB2YXIgdCA9IGVsYXBzZWQgPCBzZWxmLmR1cmF0aW9uID8gc2VsZi5lYXNlLmNhbGwobnVsbCwgZWxhcHNlZCAvIHNlbGYuZHVyYXRpb24pIDogKHNlbGYudGltZXIucmVzdGFydChzdG9wKSwgc2VsZi5zdGF0ZSA9IEVORElORywgMSksCiAgICAgICAgaSA9IC0xLAogICAgICAgIG4gPSB0d2Vlbi5sZW5ndGg7CgogICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgdHdlZW5baV0uY2FsbChudWxsLCB0KTsKICAgIH0KCiAgICAvLyBEaXNwYXRjaCB0aGUgZW5kIGV2ZW50LgogICAgaWYgKHNlbGYuc3RhdGUgPT09IEVORElORykgewogICAgICBzZWxmLm9uLmNhbGwoImVuZCIsIG5vZGUsIG5vZGUuX19kYXRhX18sIHNlbGYuaW5kZXgsIHNlbGYuZ3JvdXApOwogICAgICBzdG9wKCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzdG9wKCkgewogICAgc2VsZi5zdGF0ZSA9IEVOREVEOwogICAgc2VsZi50aW1lci5zdG9wKCk7CiAgICBkZWxldGUgc2NoZWR1bGVzW2lkXTsKICAgIGZvciAodmFyIGkgaW4gc2NoZWR1bGVzKSByZXR1cm47IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnMKICAgIGRlbGV0ZSBub2RlLl9fdHJhbnNpdGlvbjsKICB9Cn0KCmZ1bmN0aW9uIGludGVycnVwdChub2RlLCBuYW1lKSB7CiAgdmFyIHNjaGVkdWxlcyA9IG5vZGUuX190cmFuc2l0aW9uLAogICAgICBzY2hlZHVsZSQkMSwKICAgICAgYWN0aXZlLAogICAgICBlbXB0eSA9IHRydWUsCiAgICAgIGk7CgogIGlmICghc2NoZWR1bGVzKSByZXR1cm47CgogIG5hbWUgPSBuYW1lID09IG51bGwgPyBudWxsIDogbmFtZSArICIiOwoKICBmb3IgKGkgaW4gc2NoZWR1bGVzKSB7CiAgICBpZiAoKHNjaGVkdWxlJCQxID0gc2NoZWR1bGVzW2ldKS5uYW1lICE9PSBuYW1lKSB7IGVtcHR5ID0gZmFsc2U7IGNvbnRpbnVlOyB9CiAgICBhY3RpdmUgPSBzY2hlZHVsZSQkMS5zdGF0ZSA+IFNUQVJUSU5HICYmIHNjaGVkdWxlJCQxLnN0YXRlIDwgRU5ESU5HOwogICAgc2NoZWR1bGUkJDEuc3RhdGUgPSBFTkRFRDsKICAgIHNjaGVkdWxlJCQxLnRpbWVyLnN0b3AoKTsKICAgIGlmIChhY3RpdmUpIHNjaGVkdWxlJCQxLm9uLmNhbGwoImludGVycnVwdCIsIG5vZGUsIG5vZGUuX19kYXRhX18sIHNjaGVkdWxlJCQxLmluZGV4LCBzY2hlZHVsZSQkMS5ncm91cCk7CiAgICBkZWxldGUgc2NoZWR1bGVzW2ldOwogIH0KCiAgaWYgKGVtcHR5KSBkZWxldGUgbm9kZS5fX3RyYW5zaXRpb247Cn0KCmZ1bmN0aW9uIHNlbGVjdGlvbl9pbnRlcnJ1cHQobmFtZSkgewogIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICBpbnRlcnJ1cHQodGhpcywgbmFtZSk7CiAgfSk7Cn0KCmZ1bmN0aW9uIHR3ZWVuUmVtb3ZlKGlkLCBuYW1lKSB7CiAgdmFyIHR3ZWVuMCwgdHdlZW4xOwogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHZhciBzY2hlZHVsZSQkMSA9IHNldCQxKHRoaXMsIGlkKSwKICAgICAgICB0d2VlbiA9IHNjaGVkdWxlJCQxLnR3ZWVuOwoKICAgIC8vIElmIHRoaXMgbm9kZSBzaGFyZWQgdHdlZW4gd2l0aCB0aGUgcHJldmlvdXMgbm9kZSwKICAgIC8vIGp1c3QgYXNzaWduIHRoZSB1cGRhdGVkIHNoYXJlZCB0d2VlbiBhbmQgd2XigJlyZSBkb25lIQogICAgLy8gT3RoZXJ3aXNlLCBjb3B5LW9uLXdyaXRlLgogICAgaWYgKHR3ZWVuICE9PSB0d2VlbjApIHsKICAgICAgdHdlZW4xID0gdHdlZW4wID0gdHdlZW47CiAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gdHdlZW4xLmxlbmd0aDsgaSA8IG47ICsraSkgewogICAgICAgIGlmICh0d2VlbjFbaV0ubmFtZSA9PT0gbmFtZSkgewogICAgICAgICAgdHdlZW4xID0gdHdlZW4xLnNsaWNlKCk7CiAgICAgICAgICB0d2VlbjEuc3BsaWNlKGksIDEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc2NoZWR1bGUkJDEudHdlZW4gPSB0d2VlbjE7CiAgfTsKfQoKZnVuY3Rpb24gdHdlZW5GdW5jdGlvbihpZCwgbmFtZSwgdmFsdWUpIHsKICB2YXIgdHdlZW4wLCB0d2VlbjE7CiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gImZ1bmN0aW9uIikgdGhyb3cgbmV3IEVycm9yOwogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHZhciBzY2hlZHVsZSQkMSA9IHNldCQxKHRoaXMsIGlkKSwKICAgICAgICB0d2VlbiA9IHNjaGVkdWxlJCQxLnR3ZWVuOwoKICAgIC8vIElmIHRoaXMgbm9kZSBzaGFyZWQgdHdlZW4gd2l0aCB0aGUgcHJldmlvdXMgbm9kZSwKICAgIC8vIGp1c3QgYXNzaWduIHRoZSB1cGRhdGVkIHNoYXJlZCB0d2VlbiBhbmQgd2XigJlyZSBkb25lIQogICAgLy8gT3RoZXJ3aXNlLCBjb3B5LW9uLXdyaXRlLgogICAgaWYgKHR3ZWVuICE9PSB0d2VlbjApIHsKICAgICAgdHdlZW4xID0gKHR3ZWVuMCA9IHR3ZWVuKS5zbGljZSgpOwogICAgICBmb3IgKHZhciB0ID0ge25hbWU6IG5hbWUsIHZhbHVlOiB2YWx1ZX0sIGkgPSAwLCBuID0gdHdlZW4xLmxlbmd0aDsgaSA8IG47ICsraSkgewogICAgICAgIGlmICh0d2VlbjFbaV0ubmFtZSA9PT0gbmFtZSkgewogICAgICAgICAgdHdlZW4xW2ldID0gdDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoaSA9PT0gbikgdHdlZW4xLnB1c2godCk7CiAgICB9CgogICAgc2NoZWR1bGUkJDEudHdlZW4gPSB0d2VlbjE7CiAgfTsKfQoKZnVuY3Rpb24gdHJhbnNpdGlvbl90d2VlbihuYW1lLCB2YWx1ZSkgewogIHZhciBpZCA9IHRoaXMuX2lkOwoKICBuYW1lICs9ICIiOwoKICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHsKICAgIHZhciB0d2VlbiA9IGdldCQxKHRoaXMubm9kZSgpLCBpZCkudHdlZW47CiAgICBmb3IgKHZhciBpID0gMCwgbiA9IHR3ZWVuLmxlbmd0aCwgdDsgaSA8IG47ICsraSkgewogICAgICBpZiAoKHQgPSB0d2VlbltpXSkubmFtZSA9PT0gbmFtZSkgewogICAgICAgIHJldHVybiB0LnZhbHVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CgogIHJldHVybiB0aGlzLmVhY2goKHZhbHVlID09IG51bGwgPyB0d2VlblJlbW92ZSA6IHR3ZWVuRnVuY3Rpb24pKGlkLCBuYW1lLCB2YWx1ZSkpOwp9CgpmdW5jdGlvbiB0d2VlblZhbHVlKHRyYW5zaXRpb24sIG5hbWUsIHZhbHVlKSB7CiAgdmFyIGlkID0gdHJhbnNpdGlvbi5faWQ7CgogIHRyYW5zaXRpb24uZWFjaChmdW5jdGlvbigpIHsKICAgIHZhciBzY2hlZHVsZSQkMSA9IHNldCQxKHRoaXMsIGlkKTsKICAgIChzY2hlZHVsZSQkMS52YWx1ZSB8fCAoc2NoZWR1bGUkJDEudmFsdWUgPSB7fSkpW25hbWVdID0gdmFsdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9KTsKCiAgcmV0dXJuIGZ1bmN0aW9uKG5vZGUpIHsKICAgIHJldHVybiBnZXQkMShub2RlLCBpZCkudmFsdWVbbmFtZV07CiAgfTsKfQoKZnVuY3Rpb24gaW50ZXJwb2xhdGUoYSwgYikgewogIHZhciBjOwogIHJldHVybiAodHlwZW9mIGIgPT09ICJudW1iZXIiID8gcmVpbnRlcnBvbGF0ZQogICAgICA6IGIgaW5zdGFuY2VvZiBjb2xvciA/IGludGVycG9sYXRlUmdiCiAgICAgIDogKGMgPSBjb2xvcihiKSkgPyAoYiA9IGMsIGludGVycG9sYXRlUmdiKQogICAgICA6IGludGVycG9sYXRlU3RyaW5nKShhLCBiKTsKfQoKZnVuY3Rpb24gYXR0clJlbW92ZSQxKG5hbWUpIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB0aGlzLnJlbW92ZUF0dHJpYnV0ZShuYW1lKTsKICB9Owp9CgpmdW5jdGlvbiBhdHRyUmVtb3ZlTlMkMShmdWxsbmFtZSkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHRoaXMucmVtb3ZlQXR0cmlidXRlTlMoZnVsbG5hbWUuc3BhY2UsIGZ1bGxuYW1lLmxvY2FsKTsKICB9Owp9CgpmdW5jdGlvbiBhdHRyQ29uc3RhbnQkMShuYW1lLCBpbnRlcnBvbGF0ZSQkMSwgdmFsdWUxKSB7CiAgdmFyIHZhbHVlMDAsCiAgICAgIGludGVycG9sYXRlMDsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB2YXIgdmFsdWUwID0gdGhpcy5nZXRBdHRyaWJ1dGUobmFtZSk7CiAgICByZXR1cm4gdmFsdWUwID09PSB2YWx1ZTEgPyBudWxsCiAgICAgICAgOiB2YWx1ZTAgPT09IHZhbHVlMDAgPyBpbnRlcnBvbGF0ZTAKICAgICAgICA6IGludGVycG9sYXRlMCA9IGludGVycG9sYXRlJCQxKHZhbHVlMDAgPSB2YWx1ZTAsIHZhbHVlMSk7CiAgfTsKfQoKZnVuY3Rpb24gYXR0ckNvbnN0YW50TlMkMShmdWxsbmFtZSwgaW50ZXJwb2xhdGUkJDEsIHZhbHVlMSkgewogIHZhciB2YWx1ZTAwLAogICAgICBpbnRlcnBvbGF0ZTA7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgdmFyIHZhbHVlMCA9IHRoaXMuZ2V0QXR0cmlidXRlTlMoZnVsbG5hbWUuc3BhY2UsIGZ1bGxuYW1lLmxvY2FsKTsKICAgIHJldHVybiB2YWx1ZTAgPT09IHZhbHVlMSA/IG51bGwKICAgICAgICA6IHZhbHVlMCA9PT0gdmFsdWUwMCA/IGludGVycG9sYXRlMAogICAgICAgIDogaW50ZXJwb2xhdGUwID0gaW50ZXJwb2xhdGUkJDEodmFsdWUwMCA9IHZhbHVlMCwgdmFsdWUxKTsKICB9Owp9CgpmdW5jdGlvbiBhdHRyRnVuY3Rpb24kMShuYW1lLCBpbnRlcnBvbGF0ZSQkMSwgdmFsdWUpIHsKICB2YXIgdmFsdWUwMCwKICAgICAgdmFsdWUxMCwKICAgICAgaW50ZXJwb2xhdGUwOwogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHZhciB2YWx1ZTAsIHZhbHVlMSA9IHZhbHVlKHRoaXMpOwogICAgaWYgKHZhbHVlMSA9PSBudWxsKSByZXR1cm4gdm9pZCB0aGlzLnJlbW92ZUF0dHJpYnV0ZShuYW1lKTsKICAgIHZhbHVlMCA9IHRoaXMuZ2V0QXR0cmlidXRlKG5hbWUpOwogICAgcmV0dXJuIHZhbHVlMCA9PT0gdmFsdWUxID8gbnVsbAogICAgICAgIDogdmFsdWUwID09PSB2YWx1ZTAwICYmIHZhbHVlMSA9PT0gdmFsdWUxMCA/IGludGVycG9sYXRlMAogICAgICAgIDogaW50ZXJwb2xhdGUwID0gaW50ZXJwb2xhdGUkJDEodmFsdWUwMCA9IHZhbHVlMCwgdmFsdWUxMCA9IHZhbHVlMSk7CiAgfTsKfQoKZnVuY3Rpb24gYXR0ckZ1bmN0aW9uTlMkMShmdWxsbmFtZSwgaW50ZXJwb2xhdGUkJDEsIHZhbHVlKSB7CiAgdmFyIHZhbHVlMDAsCiAgICAgIHZhbHVlMTAsCiAgICAgIGludGVycG9sYXRlMDsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB2YXIgdmFsdWUwLCB2YWx1ZTEgPSB2YWx1ZSh0aGlzKTsKICAgIGlmICh2YWx1ZTEgPT0gbnVsbCkgcmV0dXJuIHZvaWQgdGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyhmdWxsbmFtZS5zcGFjZSwgZnVsbG5hbWUubG9jYWwpOwogICAgdmFsdWUwID0gdGhpcy5nZXRBdHRyaWJ1dGVOUyhmdWxsbmFtZS5zcGFjZSwgZnVsbG5hbWUubG9jYWwpOwogICAgcmV0dXJuIHZhbHVlMCA9PT0gdmFsdWUxID8gbnVsbAogICAgICAgIDogdmFsdWUwID09PSB2YWx1ZTAwICYmIHZhbHVlMSA9PT0gdmFsdWUxMCA/IGludGVycG9sYXRlMAogICAgICAgIDogaW50ZXJwb2xhdGUwID0gaW50ZXJwb2xhdGUkJDEodmFsdWUwMCA9IHZhbHVlMCwgdmFsdWUxMCA9IHZhbHVlMSk7CiAgfTsKfQoKZnVuY3Rpb24gdHJhbnNpdGlvbl9hdHRyKG5hbWUsIHZhbHVlKSB7CiAgdmFyIGZ1bGxuYW1lID0gbmFtZXNwYWNlKG5hbWUpLCBpID0gZnVsbG5hbWUgPT09ICJ0cmFuc2Zvcm0iID8gaW50ZXJwb2xhdGVUcmFuc2Zvcm1TdmcgOiBpbnRlcnBvbGF0ZTsKICByZXR1cm4gdGhpcy5hdHRyVHdlZW4obmFtZSwgdHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iCiAgICAgID8gKGZ1bGxuYW1lLmxvY2FsID8gYXR0ckZ1bmN0aW9uTlMkMSA6IGF0dHJGdW5jdGlvbiQxKShmdWxsbmFtZSwgaSwgdHdlZW5WYWx1ZSh0aGlzLCAiYXR0ci4iICsgbmFtZSwgdmFsdWUpKQogICAgICA6IHZhbHVlID09IG51bGwgPyAoZnVsbG5hbWUubG9jYWwgPyBhdHRyUmVtb3ZlTlMkMSA6IGF0dHJSZW1vdmUkMSkoZnVsbG5hbWUpCiAgICAgIDogKGZ1bGxuYW1lLmxvY2FsID8gYXR0ckNvbnN0YW50TlMkMSA6IGF0dHJDb25zdGFudCQxKShmdWxsbmFtZSwgaSwgdmFsdWUgKyAiIikpOwp9CgpmdW5jdGlvbiBhdHRyVHdlZW5OUyhmdWxsbmFtZSwgdmFsdWUpIHsKICBmdW5jdGlvbiB0d2VlbigpIHsKICAgIHZhciBub2RlID0gdGhpcywgaSA9IHZhbHVlLmFwcGx5KG5vZGUsIGFyZ3VtZW50cyk7CiAgICByZXR1cm4gaSAmJiBmdW5jdGlvbih0KSB7CiAgICAgIG5vZGUuc2V0QXR0cmlidXRlTlMoZnVsbG5hbWUuc3BhY2UsIGZ1bGxuYW1lLmxvY2FsLCBpKHQpKTsKICAgIH07CiAgfQogIHR3ZWVuLl92YWx1ZSA9IHZhbHVlOwogIHJldHVybiB0d2VlbjsKfQoKZnVuY3Rpb24gYXR0clR3ZWVuKG5hbWUsIHZhbHVlKSB7CiAgZnVuY3Rpb24gdHdlZW4oKSB7CiAgICB2YXIgbm9kZSA9IHRoaXMsIGkgPSB2YWx1ZS5hcHBseShub2RlLCBhcmd1bWVudHMpOwogICAgcmV0dXJuIGkgJiYgZnVuY3Rpb24odCkgewogICAgICBub2RlLnNldEF0dHJpYnV0ZShuYW1lLCBpKHQpKTsKICAgIH07CiAgfQogIHR3ZWVuLl92YWx1ZSA9IHZhbHVlOwogIHJldHVybiB0d2VlbjsKfQoKZnVuY3Rpb24gdHJhbnNpdGlvbl9hdHRyVHdlZW4obmFtZSwgdmFsdWUpIHsKICB2YXIga2V5ID0gImF0dHIuIiArIG5hbWU7CiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSByZXR1cm4gKGtleSA9IHRoaXMudHdlZW4oa2V5KSkgJiYga2V5Ll92YWx1ZTsKICBpZiAodmFsdWUgPT0gbnVsbCkgcmV0dXJuIHRoaXMudHdlZW4oa2V5LCBudWxsKTsKICBpZiAodHlwZW9mIHZhbHVlICE9PSAiZnVuY3Rpb24iKSB0aHJvdyBuZXcgRXJyb3I7CiAgdmFyIGZ1bGxuYW1lID0gbmFtZXNwYWNlKG5hbWUpOwogIHJldHVybiB0aGlzLnR3ZWVuKGtleSwgKGZ1bGxuYW1lLmxvY2FsID8gYXR0clR3ZWVuTlMgOiBhdHRyVHdlZW4pKGZ1bGxuYW1lLCB2YWx1ZSkpOwp9CgpmdW5jdGlvbiBkZWxheUZ1bmN0aW9uKGlkLCB2YWx1ZSkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIGluaXQodGhpcywgaWQpLmRlbGF5ID0gK3ZhbHVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfQoKZnVuY3Rpb24gZGVsYXlDb25zdGFudChpZCwgdmFsdWUpIHsKICByZXR1cm4gdmFsdWUgPSArdmFsdWUsIGZ1bmN0aW9uKCkgewogICAgaW5pdCh0aGlzLCBpZCkuZGVsYXkgPSB2YWx1ZTsKICB9Owp9CgpmdW5jdGlvbiB0cmFuc2l0aW9uX2RlbGF5KHZhbHVlKSB7CiAgdmFyIGlkID0gdGhpcy5faWQ7CgogIHJldHVybiBhcmd1bWVudHMubGVuZ3RoCiAgICAgID8gdGhpcy5lYWNoKCh0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIKICAgICAgICAgID8gZGVsYXlGdW5jdGlvbgogICAgICAgICAgOiBkZWxheUNvbnN0YW50KShpZCwgdmFsdWUpKQogICAgICA6IGdldCQxKHRoaXMubm9kZSgpLCBpZCkuZGVsYXk7Cn0KCmZ1bmN0aW9uIGR1cmF0aW9uRnVuY3Rpb24oaWQsIHZhbHVlKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgc2V0JDEodGhpcywgaWQpLmR1cmF0aW9uID0gK3ZhbHVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfQoKZnVuY3Rpb24gZHVyYXRpb25Db25zdGFudChpZCwgdmFsdWUpIHsKICByZXR1cm4gdmFsdWUgPSArdmFsdWUsIGZ1bmN0aW9uKCkgewogICAgc2V0JDEodGhpcywgaWQpLmR1cmF0aW9uID0gdmFsdWU7CiAgfTsKfQoKZnVuY3Rpb24gdHJhbnNpdGlvbl9kdXJhdGlvbih2YWx1ZSkgewogIHZhciBpZCA9IHRoaXMuX2lkOwoKICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aAogICAgICA/IHRoaXMuZWFjaCgodHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iCiAgICAgICAgICA/IGR1cmF0aW9uRnVuY3Rpb24KICAgICAgICAgIDogZHVyYXRpb25Db25zdGFudCkoaWQsIHZhbHVlKSkKICAgICAgOiBnZXQkMSh0aGlzLm5vZGUoKSwgaWQpLmR1cmF0aW9uOwp9CgpmdW5jdGlvbiBlYXNlQ29uc3RhbnQoaWQsIHZhbHVlKSB7CiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gImZ1bmN0aW9uIikgdGhyb3cgbmV3IEVycm9yOwogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHNldCQxKHRoaXMsIGlkKS5lYXNlID0gdmFsdWU7CiAgfTsKfQoKZnVuY3Rpb24gdHJhbnNpdGlvbl9lYXNlKHZhbHVlKSB7CiAgdmFyIGlkID0gdGhpcy5faWQ7CgogIHJldHVybiBhcmd1bWVudHMubGVuZ3RoCiAgICAgID8gdGhpcy5lYWNoKGVhc2VDb25zdGFudChpZCwgdmFsdWUpKQogICAgICA6IGdldCQxKHRoaXMubm9kZSgpLCBpZCkuZWFzZTsKfQoKZnVuY3Rpb24gdHJhbnNpdGlvbl9maWx0ZXIobWF0Y2gpIHsKICBpZiAodHlwZW9mIG1hdGNoICE9PSAiZnVuY3Rpb24iKSBtYXRjaCA9IG1hdGNoZXIkMShtYXRjaCk7CgogIGZvciAodmFyIGdyb3VwcyA9IHRoaXMuX2dyb3VwcywgbSA9IGdyb3Vwcy5sZW5ndGgsIHN1Ymdyb3VwcyA9IG5ldyBBcnJheShtKSwgaiA9IDA7IGogPCBtOyArK2opIHsKICAgIGZvciAodmFyIGdyb3VwID0gZ3JvdXBzW2pdLCBuID0gZ3JvdXAubGVuZ3RoLCBzdWJncm91cCA9IHN1Ymdyb3Vwc1tqXSA9IFtdLCBub2RlLCBpID0gMDsgaSA8IG47ICsraSkgewogICAgICBpZiAoKG5vZGUgPSBncm91cFtpXSkgJiYgbWF0Y2guY2FsbChub2RlLCBub2RlLl9fZGF0YV9fLCBpLCBncm91cCkpIHsKICAgICAgICBzdWJncm91cC5wdXNoKG5vZGUpOwogICAgICB9CiAgICB9CiAgfQoKICByZXR1cm4gbmV3IFRyYW5zaXRpb24oc3ViZ3JvdXBzLCB0aGlzLl9wYXJlbnRzLCB0aGlzLl9uYW1lLCB0aGlzLl9pZCk7Cn0KCmZ1bmN0aW9uIHRyYW5zaXRpb25fbWVyZ2UodHJhbnNpdGlvbiQkMSkgewogIGlmICh0cmFuc2l0aW9uJCQxLl9pZCAhPT0gdGhpcy5faWQpIHRocm93IG5ldyBFcnJvcjsKCiAgZm9yICh2YXIgZ3JvdXBzMCA9IHRoaXMuX2dyb3VwcywgZ3JvdXBzMSA9IHRyYW5zaXRpb24kJDEuX2dyb3VwcywgbTAgPSBncm91cHMwLmxlbmd0aCwgbTEgPSBncm91cHMxLmxlbmd0aCwgbSA9IE1hdGgubWluKG0wLCBtMSksIG1lcmdlcyA9IG5ldyBBcnJheShtMCksIGogPSAwOyBqIDwgbTsgKytqKSB7CiAgICBmb3IgKHZhciBncm91cDAgPSBncm91cHMwW2pdLCBncm91cDEgPSBncm91cHMxW2pdLCBuID0gZ3JvdXAwLmxlbmd0aCwgbWVyZ2UgPSBtZXJnZXNbal0gPSBuZXcgQXJyYXkobiksIG5vZGUsIGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgIGlmIChub2RlID0gZ3JvdXAwW2ldIHx8IGdyb3VwMVtpXSkgewogICAgICAgIG1lcmdlW2ldID0gbm9kZTsKICAgICAgfQogICAgfQogIH0KCiAgZm9yICg7IGogPCBtMDsgKytqKSB7CiAgICBtZXJnZXNbal0gPSBncm91cHMwW2pdOwogIH0KCiAgcmV0dXJuIG5ldyBUcmFuc2l0aW9uKG1lcmdlcywgdGhpcy5fcGFyZW50cywgdGhpcy5fbmFtZSwgdGhpcy5faWQpOwp9CgpmdW5jdGlvbiBzdGFydChuYW1lKSB7CiAgcmV0dXJuIChuYW1lICsgIiIpLnRyaW0oKS5zcGxpdCgvXnxccysvKS5ldmVyeShmdW5jdGlvbih0KSB7CiAgICB2YXIgaSA9IHQuaW5kZXhPZigiLiIpOwogICAgaWYgKGkgPj0gMCkgdCA9IHQuc2xpY2UoMCwgaSk7CiAgICByZXR1cm4gIXQgfHwgdCA9PT0gInN0YXJ0IjsKICB9KTsKfQoKZnVuY3Rpb24gb25GdW5jdGlvbihpZCwgbmFtZSwgbGlzdGVuZXIpIHsKICB2YXIgb24wLCBvbjEsIHNpdCA9IHN0YXJ0KG5hbWUpID8gaW5pdCA6IHNldCQxOwogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHZhciBzY2hlZHVsZSQkMSA9IHNpdCh0aGlzLCBpZCksCiAgICAgICAgb24gPSBzY2hlZHVsZSQkMS5vbjsKCiAgICAvLyBJZiB0aGlzIG5vZGUgc2hhcmVkIGEgZGlzcGF0Y2ggd2l0aCB0aGUgcHJldmlvdXMgbm9kZSwKICAgIC8vIGp1c3QgYXNzaWduIHRoZSB1cGRhdGVkIHNoYXJlZCBkaXNwYXRjaCBhbmQgd2XigJlyZSBkb25lIQogICAgLy8gT3RoZXJ3aXNlLCBjb3B5LW9uLXdyaXRlLgogICAgaWYgKG9uICE9PSBvbjApIChvbjEgPSAob24wID0gb24pLmNvcHkoKSkub24obmFtZSwgbGlzdGVuZXIpOwoKICAgIHNjaGVkdWxlJCQxLm9uID0gb24xOwogIH07Cn0KCmZ1bmN0aW9uIHRyYW5zaXRpb25fb24obmFtZSwgbGlzdGVuZXIpIHsKICB2YXIgaWQgPSB0aGlzLl9pZDsKCiAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPCAyCiAgICAgID8gZ2V0JDEodGhpcy5ub2RlKCksIGlkKS5vbi5vbihuYW1lKQogICAgICA6IHRoaXMuZWFjaChvbkZ1bmN0aW9uKGlkLCBuYW1lLCBsaXN0ZW5lcikpOwp9CgpmdW5jdGlvbiByZW1vdmVGdW5jdGlvbihpZCkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHZhciBwYXJlbnQgPSB0aGlzLnBhcmVudE5vZGU7CiAgICBmb3IgKHZhciBpIGluIHRoaXMuX190cmFuc2l0aW9uKSBpZiAoK2kgIT09IGlkKSByZXR1cm47CiAgICBpZiAocGFyZW50KSBwYXJlbnQucmVtb3ZlQ2hpbGQodGhpcyk7CiAgfTsKfQoKZnVuY3Rpb24gdHJhbnNpdGlvbl9yZW1vdmUoKSB7CiAgcmV0dXJuIHRoaXMub24oImVuZC5yZW1vdmUiLCByZW1vdmVGdW5jdGlvbih0aGlzLl9pZCkpOwp9CgpmdW5jdGlvbiB0cmFuc2l0aW9uX3NlbGVjdChzZWxlY3QkJDEpIHsKICB2YXIgbmFtZSA9IHRoaXMuX25hbWUsCiAgICAgIGlkID0gdGhpcy5faWQ7CgogIGlmICh0eXBlb2Ygc2VsZWN0JCQxICE9PSAiZnVuY3Rpb24iKSBzZWxlY3QkJDEgPSBzZWxlY3RvcihzZWxlY3QkJDEpOwoKICBmb3IgKHZhciBncm91cHMgPSB0aGlzLl9ncm91cHMsIG0gPSBncm91cHMubGVuZ3RoLCBzdWJncm91cHMgPSBuZXcgQXJyYXkobSksIGogPSAwOyBqIDwgbTsgKytqKSB7CiAgICBmb3IgKHZhciBncm91cCA9IGdyb3Vwc1tqXSwgbiA9IGdyb3VwLmxlbmd0aCwgc3ViZ3JvdXAgPSBzdWJncm91cHNbal0gPSBuZXcgQXJyYXkobiksIG5vZGUsIHN1Ym5vZGUsIGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgIGlmICgobm9kZSA9IGdyb3VwW2ldKSAmJiAoc3Vibm9kZSA9IHNlbGVjdCQkMS5jYWxsKG5vZGUsIG5vZGUuX19kYXRhX18sIGksIGdyb3VwKSkpIHsKICAgICAgICBpZiAoIl9fZGF0YV9fIiBpbiBub2RlKSBzdWJub2RlLl9fZGF0YV9fID0gbm9kZS5fX2RhdGFfXzsKICAgICAgICBzdWJncm91cFtpXSA9IHN1Ym5vZGU7CiAgICAgICAgc2NoZWR1bGUoc3ViZ3JvdXBbaV0sIG5hbWUsIGlkLCBpLCBzdWJncm91cCwgZ2V0JDEobm9kZSwgaWQpKTsKICAgICAgfQogICAgfQogIH0KCiAgcmV0dXJuIG5ldyBUcmFuc2l0aW9uKHN1Ymdyb3VwcywgdGhpcy5fcGFyZW50cywgbmFtZSwgaWQpOwp9CgpmdW5jdGlvbiB0cmFuc2l0aW9uX3NlbGVjdEFsbChzZWxlY3QkJDEpIHsKICB2YXIgbmFtZSA9IHRoaXMuX25hbWUsCiAgICAgIGlkID0gdGhpcy5faWQ7CgogIGlmICh0eXBlb2Ygc2VsZWN0JCQxICE9PSAiZnVuY3Rpb24iKSBzZWxlY3QkJDEgPSBzZWxlY3RvckFsbChzZWxlY3QkJDEpOwoKICBmb3IgKHZhciBncm91cHMgPSB0aGlzLl9ncm91cHMsIG0gPSBncm91cHMubGVuZ3RoLCBzdWJncm91cHMgPSBbXSwgcGFyZW50cyA9IFtdLCBqID0gMDsgaiA8IG07ICsraikgewogICAgZm9yICh2YXIgZ3JvdXAgPSBncm91cHNbal0sIG4gPSBncm91cC5sZW5ndGgsIG5vZGUsIGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgIGlmIChub2RlID0gZ3JvdXBbaV0pIHsKICAgICAgICBmb3IgKHZhciBjaGlsZHJlbiA9IHNlbGVjdCQkMS5jYWxsKG5vZGUsIG5vZGUuX19kYXRhX18sIGksIGdyb3VwKSwgY2hpbGQsIGluaGVyaXQgPSBnZXQkMShub2RlLCBpZCksIGsgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBrIDwgbDsgKytrKSB7CiAgICAgICAgICBpZiAoY2hpbGQgPSBjaGlsZHJlbltrXSkgewogICAgICAgICAgICBzY2hlZHVsZShjaGlsZCwgbmFtZSwgaWQsIGssIGNoaWxkcmVuLCBpbmhlcml0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3ViZ3JvdXBzLnB1c2goY2hpbGRyZW4pOwogICAgICAgIHBhcmVudHMucHVzaChub2RlKTsKICAgICAgfQogICAgfQogIH0KCiAgcmV0dXJuIG5ldyBUcmFuc2l0aW9uKHN1Ymdyb3VwcywgcGFyZW50cywgbmFtZSwgaWQpOwp9Cgp2YXIgU2VsZWN0aW9uJDEgPSBzZWxlY3Rpb24ucHJvdG90eXBlLmNvbnN0cnVjdG9yOwoKZnVuY3Rpb24gdHJhbnNpdGlvbl9zZWxlY3Rpb24oKSB7CiAgcmV0dXJuIG5ldyBTZWxlY3Rpb24kMSh0aGlzLl9ncm91cHMsIHRoaXMuX3BhcmVudHMpOwp9CgpmdW5jdGlvbiBzdHlsZVJlbW92ZSQxKG5hbWUsIGludGVycG9sYXRlJCQxKSB7CiAgdmFyIHZhbHVlMDAsCiAgICAgIHZhbHVlMTAsCiAgICAgIGludGVycG9sYXRlMDsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB2YXIgdmFsdWUwID0gc3R5bGVWYWx1ZSh0aGlzLCBuYW1lKSwKICAgICAgICB2YWx1ZTEgPSAodGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuYW1lKSwgc3R5bGVWYWx1ZSh0aGlzLCBuYW1lKSk7CiAgICByZXR1cm4gdmFsdWUwID09PSB2YWx1ZTEgPyBudWxsCiAgICAgICAgOiB2YWx1ZTAgPT09IHZhbHVlMDAgJiYgdmFsdWUxID09PSB2YWx1ZTEwID8gaW50ZXJwb2xhdGUwCiAgICAgICAgOiBpbnRlcnBvbGF0ZTAgPSBpbnRlcnBvbGF0ZSQkMSh2YWx1ZTAwID0gdmFsdWUwLCB2YWx1ZTEwID0gdmFsdWUxKTsKICB9Owp9CgpmdW5jdGlvbiBzdHlsZVJlbW92ZUVuZChuYW1lKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgdGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuYW1lKTsKICB9Owp9CgpmdW5jdGlvbiBzdHlsZUNvbnN0YW50JDEobmFtZSwgaW50ZXJwb2xhdGUkJDEsIHZhbHVlMSkgewogIHZhciB2YWx1ZTAwLAogICAgICBpbnRlcnBvbGF0ZTA7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgdmFyIHZhbHVlMCA9IHN0eWxlVmFsdWUodGhpcywgbmFtZSk7CiAgICByZXR1cm4gdmFsdWUwID09PSB2YWx1ZTEgPyBudWxsCiAgICAgICAgOiB2YWx1ZTAgPT09IHZhbHVlMDAgPyBpbnRlcnBvbGF0ZTAKICAgICAgICA6IGludGVycG9sYXRlMCA9IGludGVycG9sYXRlJCQxKHZhbHVlMDAgPSB2YWx1ZTAsIHZhbHVlMSk7CiAgfTsKfQoKZnVuY3Rpb24gc3R5bGVGdW5jdGlvbiQxKG5hbWUsIGludGVycG9sYXRlJCQxLCB2YWx1ZSkgewogIHZhciB2YWx1ZTAwLAogICAgICB2YWx1ZTEwLAogICAgICBpbnRlcnBvbGF0ZTA7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgdmFyIHZhbHVlMCA9IHN0eWxlVmFsdWUodGhpcywgbmFtZSksCiAgICAgICAgdmFsdWUxID0gdmFsdWUodGhpcyk7CiAgICBpZiAodmFsdWUxID09IG51bGwpIHZhbHVlMSA9ICh0aGlzLnN0eWxlLnJlbW92ZVByb3BlcnR5KG5hbWUpLCBzdHlsZVZhbHVlKHRoaXMsIG5hbWUpKTsKICAgIHJldHVybiB2YWx1ZTAgPT09IHZhbHVlMSA/IG51bGwKICAgICAgICA6IHZhbHVlMCA9PT0gdmFsdWUwMCAmJiB2YWx1ZTEgPT09IHZhbHVlMTAgPyBpbnRlcnBvbGF0ZTAKICAgICAgICA6IGludGVycG9sYXRlMCA9IGludGVycG9sYXRlJCQxKHZhbHVlMDAgPSB2YWx1ZTAsIHZhbHVlMTAgPSB2YWx1ZTEpOwogIH07Cn0KCmZ1bmN0aW9uIHRyYW5zaXRpb25fc3R5bGUobmFtZSwgdmFsdWUsIHByaW9yaXR5KSB7CiAgdmFyIGkgPSAobmFtZSArPSAiIikgPT09ICJ0cmFuc2Zvcm0iID8gaW50ZXJwb2xhdGVUcmFuc2Zvcm1Dc3MgOiBpbnRlcnBvbGF0ZTsKICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/IHRoaXMKICAgICAgICAgIC5zdHlsZVR3ZWVuKG5hbWUsIHN0eWxlUmVtb3ZlJDEobmFtZSwgaSkpCiAgICAgICAgICAub24oImVuZC5zdHlsZS4iICsgbmFtZSwgc3R5bGVSZW1vdmVFbmQobmFtZSkpCiAgICAgIDogdGhpcy5zdHlsZVR3ZWVuKG5hbWUsIHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIgogICAgICAgICAgPyBzdHlsZUZ1bmN0aW9uJDEobmFtZSwgaSwgdHdlZW5WYWx1ZSh0aGlzLCAic3R5bGUuIiArIG5hbWUsIHZhbHVlKSkKICAgICAgICAgIDogc3R5bGVDb25zdGFudCQxKG5hbWUsIGksIHZhbHVlICsgIiIpLCBwcmlvcml0eSk7Cn0KCmZ1bmN0aW9uIHN0eWxlVHdlZW4obmFtZSwgdmFsdWUsIHByaW9yaXR5KSB7CiAgZnVuY3Rpb24gdHdlZW4oKSB7CiAgICB2YXIgbm9kZSA9IHRoaXMsIGkgPSB2YWx1ZS5hcHBseShub2RlLCBhcmd1bWVudHMpOwogICAgcmV0dXJuIGkgJiYgZnVuY3Rpb24odCkgewogICAgICBub2RlLnN0eWxlLnNldFByb3BlcnR5KG5hbWUsIGkodCksIHByaW9yaXR5KTsKICAgIH07CiAgfQogIHR3ZWVuLl92YWx1ZSA9IHZhbHVlOwogIHJldHVybiB0d2VlbjsKfQoKZnVuY3Rpb24gdHJhbnNpdGlvbl9zdHlsZVR3ZWVuKG5hbWUsIHZhbHVlLCBwcmlvcml0eSkgewogIHZhciBrZXkgPSAic3R5bGUuIiArIChuYW1lICs9ICIiKTsKICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHJldHVybiAoa2V5ID0gdGhpcy50d2VlbihrZXkpKSAmJiBrZXkuX3ZhbHVlOwogIGlmICh2YWx1ZSA9PSBudWxsKSByZXR1cm4gdGhpcy50d2VlbihrZXksIG51bGwpOwogIGlmICh0eXBlb2YgdmFsdWUgIT09ICJmdW5jdGlvbiIpIHRocm93IG5ldyBFcnJvcjsKICByZXR1cm4gdGhpcy50d2VlbihrZXksIHN0eWxlVHdlZW4obmFtZSwgdmFsdWUsIHByaW9yaXR5ID09IG51bGwgPyAiIiA6IHByaW9yaXR5KSk7Cn0KCmZ1bmN0aW9uIHRleHRDb25zdGFudCQxKHZhbHVlKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgdGhpcy50ZXh0Q29udGVudCA9IHZhbHVlOwogIH07Cn0KCmZ1bmN0aW9uIHRleHRGdW5jdGlvbiQxKHZhbHVlKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgdmFyIHZhbHVlMSA9IHZhbHVlKHRoaXMpOwogICAgdGhpcy50ZXh0Q29udGVudCA9IHZhbHVlMSA9PSBudWxsID8gIiIgOiB2YWx1ZTE7CiAgfTsKfQoKZnVuY3Rpb24gdHJhbnNpdGlvbl90ZXh0KHZhbHVlKSB7CiAgcmV0dXJuIHRoaXMudHdlZW4oInRleHQiLCB0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIKICAgICAgPyB0ZXh0RnVuY3Rpb24kMSh0d2VlblZhbHVlKHRoaXMsICJ0ZXh0IiwgdmFsdWUpKQogICAgICA6IHRleHRDb25zdGFudCQxKHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVlICsgIiIpKTsKfQoKZnVuY3Rpb24gdHJhbnNpdGlvbl90cmFuc2l0aW9uKCkgewogIHZhciBuYW1lID0gdGhpcy5fbmFtZSwKICAgICAgaWQwID0gdGhpcy5faWQsCiAgICAgIGlkMSA9IG5ld0lkKCk7CgogIGZvciAodmFyIGdyb3VwcyA9IHRoaXMuX2dyb3VwcywgbSA9IGdyb3Vwcy5sZW5ndGgsIGogPSAwOyBqIDwgbTsgKytqKSB7CiAgICBmb3IgKHZhciBncm91cCA9IGdyb3Vwc1tqXSwgbiA9IGdyb3VwLmxlbmd0aCwgbm9kZSwgaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgaWYgKG5vZGUgPSBncm91cFtpXSkgewogICAgICAgIHZhciBpbmhlcml0ID0gZ2V0JDEobm9kZSwgaWQwKTsKICAgICAgICBzY2hlZHVsZShub2RlLCBuYW1lLCBpZDEsIGksIGdyb3VwLCB7CiAgICAgICAgICB0aW1lOiBpbmhlcml0LnRpbWUgKyBpbmhlcml0LmRlbGF5ICsgaW5oZXJpdC5kdXJhdGlvbiwKICAgICAgICAgIGRlbGF5OiAwLAogICAgICAgICAgZHVyYXRpb246IGluaGVyaXQuZHVyYXRpb24sCiAgICAgICAgICBlYXNlOiBpbmhlcml0LmVhc2UKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0KCiAgcmV0dXJuIG5ldyBUcmFuc2l0aW9uKGdyb3VwcywgdGhpcy5fcGFyZW50cywgbmFtZSwgaWQxKTsKfQoKdmFyIGlkID0gMDsKCmZ1bmN0aW9uIFRyYW5zaXRpb24oZ3JvdXBzLCBwYXJlbnRzLCBuYW1lLCBpZCkgewogIHRoaXMuX2dyb3VwcyA9IGdyb3VwczsKICB0aGlzLl9wYXJlbnRzID0gcGFyZW50czsKICB0aGlzLl9uYW1lID0gbmFtZTsKICB0aGlzLl9pZCA9IGlkOwp9CgpmdW5jdGlvbiB0cmFuc2l0aW9uKG5hbWUpIHsKICByZXR1cm4gc2VsZWN0aW9uKCkudHJhbnNpdGlvbihuYW1lKTsKfQoKZnVuY3Rpb24gbmV3SWQoKSB7CiAgcmV0dXJuICsraWQ7Cn0KCnZhciBzZWxlY3Rpb25fcHJvdG90eXBlID0gc2VsZWN0aW9uLnByb3RvdHlwZTsKClRyYW5zaXRpb24ucHJvdG90eXBlID0gdHJhbnNpdGlvbi5wcm90b3R5cGUgPSB7CiAgY29uc3RydWN0b3I6IFRyYW5zaXRpb24sCiAgc2VsZWN0OiB0cmFuc2l0aW9uX3NlbGVjdCwKICBzZWxlY3RBbGw6IHRyYW5zaXRpb25fc2VsZWN0QWxsLAogIGZpbHRlcjogdHJhbnNpdGlvbl9maWx0ZXIsCiAgbWVyZ2U6IHRyYW5zaXRpb25fbWVyZ2UsCiAgc2VsZWN0aW9uOiB0cmFuc2l0aW9uX3NlbGVjdGlvbiwKICB0cmFuc2l0aW9uOiB0cmFuc2l0aW9uX3RyYW5zaXRpb24sCiAgY2FsbDogc2VsZWN0aW9uX3Byb3RvdHlwZS5jYWxsLAogIG5vZGVzOiBzZWxlY3Rpb25fcHJvdG90eXBlLm5vZGVzLAogIG5vZGU6IHNlbGVjdGlvbl9wcm90b3R5cGUubm9kZSwKICBzaXplOiBzZWxlY3Rpb25fcHJvdG90eXBlLnNpemUsCiAgZW1wdHk6IHNlbGVjdGlvbl9wcm90b3R5cGUuZW1wdHksCiAgZWFjaDogc2VsZWN0aW9uX3Byb3RvdHlwZS5lYWNoLAogIG9uOiB0cmFuc2l0aW9uX29uLAogIGF0dHI6IHRyYW5zaXRpb25fYXR0ciwKICBhdHRyVHdlZW46IHRyYW5zaXRpb25fYXR0clR3ZWVuLAogIHN0eWxlOiB0cmFuc2l0aW9uX3N0eWxlLAogIHN0eWxlVHdlZW46IHRyYW5zaXRpb25fc3R5bGVUd2VlbiwKICB0ZXh0OiB0cmFuc2l0aW9uX3RleHQsCiAgcmVtb3ZlOiB0cmFuc2l0aW9uX3JlbW92ZSwKICB0d2VlbjogdHJhbnNpdGlvbl90d2VlbiwKICBkZWxheTogdHJhbnNpdGlvbl9kZWxheSwKICBkdXJhdGlvbjogdHJhbnNpdGlvbl9kdXJhdGlvbiwKICBlYXNlOiB0cmFuc2l0aW9uX2Vhc2UKfTsKCmZ1bmN0aW9uIGxpbmVhciQxKHQpIHsKICByZXR1cm4gK3Q7Cn0KCmZ1bmN0aW9uIHF1YWRJbih0KSB7CiAgcmV0dXJuIHQgKiB0Owp9CgpmdW5jdGlvbiBxdWFkT3V0KHQpIHsKICByZXR1cm4gdCAqICgyIC0gdCk7Cn0KCmZ1bmN0aW9uIHF1YWRJbk91dCh0KSB7CiAgcmV0dXJuICgodCAqPSAyKSA8PSAxID8gdCAqIHQgOiAtLXQgKiAoMiAtIHQpICsgMSkgLyAyOwp9CgpmdW5jdGlvbiBjdWJpY0luKHQpIHsKICByZXR1cm4gdCAqIHQgKiB0Owp9CgpmdW5jdGlvbiBjdWJpY091dCh0KSB7CiAgcmV0dXJuIC0tdCAqIHQgKiB0ICsgMTsKfQoKZnVuY3Rpb24gY3ViaWNJbk91dCh0KSB7CiAgcmV0dXJuICgodCAqPSAyKSA8PSAxID8gdCAqIHQgKiB0IDogKHQgLT0gMikgKiB0ICogdCArIDIpIC8gMjsKfQoKdmFyIGV4cG9uZW50ID0gMzsKCnZhciBwb2x5SW4gPSAoZnVuY3Rpb24gY3VzdG9tKGUpIHsKICBlID0gK2U7CgogIGZ1bmN0aW9uIHBvbHlJbih0KSB7CiAgICByZXR1cm4gTWF0aC5wb3codCwgZSk7CiAgfQoKICBwb2x5SW4uZXhwb25lbnQgPSBjdXN0b207CgogIHJldHVybiBwb2x5SW47Cn0pKGV4cG9uZW50KTsKCnZhciBwb2x5T3V0ID0gKGZ1bmN0aW9uIGN1c3RvbShlKSB7CiAgZSA9ICtlOwoKICBmdW5jdGlvbiBwb2x5T3V0KHQpIHsKICAgIHJldHVybiAxIC0gTWF0aC5wb3coMSAtIHQsIGUpOwogIH0KCiAgcG9seU91dC5leHBvbmVudCA9IGN1c3RvbTsKCiAgcmV0dXJuIHBvbHlPdXQ7Cn0pKGV4cG9uZW50KTsKCnZhciBwb2x5SW5PdXQgPSAoZnVuY3Rpb24gY3VzdG9tKGUpIHsKICBlID0gK2U7CgogIGZ1bmN0aW9uIHBvbHlJbk91dCh0KSB7CiAgICByZXR1cm4gKCh0ICo9IDIpIDw9IDEgPyBNYXRoLnBvdyh0LCBlKSA6IDIgLSBNYXRoLnBvdygyIC0gdCwgZSkpIC8gMjsKICB9CgogIHBvbHlJbk91dC5leHBvbmVudCA9IGN1c3RvbTsKCiAgcmV0dXJuIHBvbHlJbk91dDsKfSkoZXhwb25lbnQpOwoKdmFyIHBpID0gTWF0aC5QSSwKICAgIGhhbGZQaSA9IHBpIC8gMjsKCmZ1bmN0aW9uIHNpbkluKHQpIHsKICByZXR1cm4gMSAtIE1hdGguY29zKHQgKiBoYWxmUGkpOwp9CgpmdW5jdGlvbiBzaW5PdXQodCkgewogIHJldHVybiBNYXRoLnNpbih0ICogaGFsZlBpKTsKfQoKZnVuY3Rpb24gc2luSW5PdXQodCkgewogIHJldHVybiAoMSAtIE1hdGguY29zKHBpICogdCkpIC8gMjsKfQoKZnVuY3Rpb24gZXhwSW4odCkgewogIHJldHVybiBNYXRoLnBvdygyLCAxMCAqIHQgLSAxMCk7Cn0KCmZ1bmN0aW9uIGV4cE91dCh0KSB7CiAgcmV0dXJuIDEgLSBNYXRoLnBvdygyLCAtMTAgKiB0KTsKfQoKZnVuY3Rpb24gZXhwSW5PdXQodCkgewogIHJldHVybiAoKHQgKj0gMikgPD0gMSA/IE1hdGgucG93KDIsIDEwICogdCAtIDEwKSA6IDIgLSBNYXRoLnBvdygyLCAxMCAtIDEwICogdCkpIC8gMjsKfQoKZnVuY3Rpb24gY2lyY2xlSW4odCkgewogIHJldHVybiAxIC0gTWF0aC5zcXJ0KDEgLSB0ICogdCk7Cn0KCmZ1bmN0aW9uIGNpcmNsZU91dCh0KSB7CiAgcmV0dXJuIE1hdGguc3FydCgxIC0gLS10ICogdCk7Cn0KCmZ1bmN0aW9uIGNpcmNsZUluT3V0KHQpIHsKICByZXR1cm4gKCh0ICo9IDIpIDw9IDEgPyAxIC0gTWF0aC5zcXJ0KDEgLSB0ICogdCkgOiBNYXRoLnNxcnQoMSAtICh0IC09IDIpICogdCkgKyAxKSAvIDI7Cn0KCnZhciBiMSA9IDQgLyAxMSwKICAgIGIyID0gNiAvIDExLAogICAgYjMgPSA4IC8gMTEsCiAgICBiNCA9IDMgLyA0LAogICAgYjUgPSA5IC8gMTEsCiAgICBiNiA9IDEwIC8gMTEsCiAgICBiNyA9IDE1IC8gMTYsCiAgICBiOCA9IDIxIC8gMjIsCiAgICBiOSA9IDYzIC8gNjQsCiAgICBiMCA9IDEgLyBiMSAvIGIxOwoKZnVuY3Rpb24gYm91bmNlSW4odCkgewogIHJldHVybiAxIC0gYm91bmNlT3V0KDEgLSB0KTsKfQoKZnVuY3Rpb24gYm91bmNlT3V0KHQpIHsKICByZXR1cm4gKHQgPSArdCkgPCBiMSA/IGIwICogdCAqIHQgOiB0IDwgYjMgPyBiMCAqICh0IC09IGIyKSAqIHQgKyBiNCA6IHQgPCBiNiA/IGIwICogKHQgLT0gYjUpICogdCArIGI3IDogYjAgKiAodCAtPSBiOCkgKiB0ICsgYjk7Cn0KCmZ1bmN0aW9uIGJvdW5jZUluT3V0KHQpIHsKICByZXR1cm4gKCh0ICo9IDIpIDw9IDEgPyAxIC0gYm91bmNlT3V0KDEgLSB0KSA6IGJvdW5jZU91dCh0IC0gMSkgKyAxKSAvIDI7Cn0KCnZhciBvdmVyc2hvb3QgPSAxLjcwMTU4OwoKdmFyIGJhY2tJbiA9IChmdW5jdGlvbiBjdXN0b20ocykgewogIHMgPSArczsKCiAgZnVuY3Rpb24gYmFja0luKHQpIHsKICAgIHJldHVybiB0ICogdCAqICgocyArIDEpICogdCAtIHMpOwogIH0KCiAgYmFja0luLm92ZXJzaG9vdCA9IGN1c3RvbTsKCiAgcmV0dXJuIGJhY2tJbjsKfSkob3ZlcnNob290KTsKCnZhciBiYWNrT3V0ID0gKGZ1bmN0aW9uIGN1c3RvbShzKSB7CiAgcyA9ICtzOwoKICBmdW5jdGlvbiBiYWNrT3V0KHQpIHsKICAgIHJldHVybiAtLXQgKiB0ICogKChzICsgMSkgKiB0ICsgcykgKyAxOwogIH0KCiAgYmFja091dC5vdmVyc2hvb3QgPSBjdXN0b207CgogIHJldHVybiBiYWNrT3V0Owp9KShvdmVyc2hvb3QpOwoKdmFyIGJhY2tJbk91dCA9IChmdW5jdGlvbiBjdXN0b20ocykgewogIHMgPSArczsKCiAgZnVuY3Rpb24gYmFja0luT3V0KHQpIHsKICAgIHJldHVybiAoKHQgKj0gMikgPCAxID8gdCAqIHQgKiAoKHMgKyAxKSAqIHQgLSBzKSA6ICh0IC09IDIpICogdCAqICgocyArIDEpICogdCArIHMpICsgMikgLyAyOwogIH0KCiAgYmFja0luT3V0Lm92ZXJzaG9vdCA9IGN1c3RvbTsKCiAgcmV0dXJuIGJhY2tJbk91dDsKfSkob3ZlcnNob290KTsKCnZhciB0YXUgPSAyICogTWF0aC5QSSwKICAgIGFtcGxpdHVkZSA9IDEsCiAgICBwZXJpb2QgPSAwLjM7Cgp2YXIgZWxhc3RpY0luID0gKGZ1bmN0aW9uIGN1c3RvbShhLCBwKSB7CiAgdmFyIHMgPSBNYXRoLmFzaW4oMSAvIChhID0gTWF0aC5tYXgoMSwgYSkpKSAqIChwIC89IHRhdSk7CgogIGZ1bmN0aW9uIGVsYXN0aWNJbih0KSB7CiAgICByZXR1cm4gYSAqIE1hdGgucG93KDIsIDEwICogLS10KSAqIE1hdGguc2luKChzIC0gdCkgLyBwKTsKICB9CgogIGVsYXN0aWNJbi5hbXBsaXR1ZGUgPSBmdW5jdGlvbihhKSB7IHJldHVybiBjdXN0b20oYSwgcCAqIHRhdSk7IH07CiAgZWxhc3RpY0luLnBlcmlvZCA9IGZ1bmN0aW9uKHApIHsgcmV0dXJuIGN1c3RvbShhLCBwKTsgfTsKCiAgcmV0dXJuIGVsYXN0aWNJbjsKfSkoYW1wbGl0dWRlLCBwZXJpb2QpOwoKdmFyIGVsYXN0aWNPdXQgPSAoZnVuY3Rpb24gY3VzdG9tKGEsIHApIHsKICB2YXIgcyA9IE1hdGguYXNpbigxIC8gKGEgPSBNYXRoLm1heCgxLCBhKSkpICogKHAgLz0gdGF1KTsKCiAgZnVuY3Rpb24gZWxhc3RpY091dCh0KSB7CiAgICByZXR1cm4gMSAtIGEgKiBNYXRoLnBvdygyLCAtMTAgKiAodCA9ICt0KSkgKiBNYXRoLnNpbigodCArIHMpIC8gcCk7CiAgfQoKICBlbGFzdGljT3V0LmFtcGxpdHVkZSA9IGZ1bmN0aW9uKGEpIHsgcmV0dXJuIGN1c3RvbShhLCBwICogdGF1KTsgfTsKICBlbGFzdGljT3V0LnBlcmlvZCA9IGZ1bmN0aW9uKHApIHsgcmV0dXJuIGN1c3RvbShhLCBwKTsgfTsKCiAgcmV0dXJuIGVsYXN0aWNPdXQ7Cn0pKGFtcGxpdHVkZSwgcGVyaW9kKTsKCnZhciBlbGFzdGljSW5PdXQgPSAoZnVuY3Rpb24gY3VzdG9tKGEsIHApIHsKICB2YXIgcyA9IE1hdGguYXNpbigxIC8gKGEgPSBNYXRoLm1heCgxLCBhKSkpICogKHAgLz0gdGF1KTsKCiAgZnVuY3Rpb24gZWxhc3RpY0luT3V0KHQpIHsKICAgIHJldHVybiAoKHQgPSB0ICogMiAtIDEpIDwgMAogICAgICAgID8gYSAqIE1hdGgucG93KDIsIDEwICogdCkgKiBNYXRoLnNpbigocyAtIHQpIC8gcCkKICAgICAgICA6IDIgLSBhICogTWF0aC5wb3coMiwgLTEwICogdCkgKiBNYXRoLnNpbigocyArIHQpIC8gcCkpIC8gMjsKICB9CgogIGVsYXN0aWNJbk91dC5hbXBsaXR1ZGUgPSBmdW5jdGlvbihhKSB7IHJldHVybiBjdXN0b20oYSwgcCAqIHRhdSk7IH07CiAgZWxhc3RpY0luT3V0LnBlcmlvZCA9IGZ1bmN0aW9uKHApIHsgcmV0dXJuIGN1c3RvbShhLCBwKTsgfTsKCiAgcmV0dXJuIGVsYXN0aWNJbk91dDsKfSkoYW1wbGl0dWRlLCBwZXJpb2QpOwoKdmFyIGRlZmF1bHRUaW1pbmcgPSB7CiAgdGltZTogbnVsbCwgLy8gU2V0IG9uIHVzZS4KICBkZWxheTogMCwKICBkdXJhdGlvbjogMjUwLAogIGVhc2U6IGN1YmljSW5PdXQKfTsKCmZ1bmN0aW9uIGluaGVyaXQobm9kZSwgaWQpIHsKICB2YXIgdGltaW5nOwogIHdoaWxlICghKHRpbWluZyA9IG5vZGUuX190cmFuc2l0aW9uKSB8fCAhKHRpbWluZyA9IHRpbWluZ1tpZF0pKSB7CiAgICBpZiAoIShub2RlID0gbm9kZS5wYXJlbnROb2RlKSkgewogICAgICByZXR1cm4gZGVmYXVsdFRpbWluZy50aW1lID0gbm93KCksIGRlZmF1bHRUaW1pbmc7CiAgICB9CiAgfQogIHJldHVybiB0aW1pbmc7Cn0KCmZ1bmN0aW9uIHNlbGVjdGlvbl90cmFuc2l0aW9uKG5hbWUpIHsKICB2YXIgaWQsCiAgICAgIHRpbWluZzsKCiAgaWYgKG5hbWUgaW5zdGFuY2VvZiBUcmFuc2l0aW9uKSB7CiAgICBpZCA9IG5hbWUuX2lkLCBuYW1lID0gbmFtZS5fbmFtZTsKICB9IGVsc2UgewogICAgaWQgPSBuZXdJZCgpLCAodGltaW5nID0gZGVmYXVsdFRpbWluZykudGltZSA9IG5vdygpLCBuYW1lID0gbmFtZSA9PSBudWxsID8gbnVsbCA6IG5hbWUgKyAiIjsKICB9CgogIGZvciAodmFyIGdyb3VwcyA9IHRoaXMuX2dyb3VwcywgbSA9IGdyb3Vwcy5sZW5ndGgsIGogPSAwOyBqIDwgbTsgKytqKSB7CiAgICBmb3IgKHZhciBncm91cCA9IGdyb3Vwc1tqXSwgbiA9IGdyb3VwLmxlbmd0aCwgbm9kZSwgaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgaWYgKG5vZGUgPSBncm91cFtpXSkgewogICAgICAgIHNjaGVkdWxlKG5vZGUsIG5hbWUsIGlkLCBpLCBncm91cCwgdGltaW5nIHx8IGluaGVyaXQobm9kZSwgaWQpKTsKICAgICAgfQogICAgfQogIH0KCiAgcmV0dXJuIG5ldyBUcmFuc2l0aW9uKGdyb3VwcywgdGhpcy5fcGFyZW50cywgbmFtZSwgaWQpOwp9CgpzZWxlY3Rpb24ucHJvdG90eXBlLmludGVycnVwdCA9IHNlbGVjdGlvbl9pbnRlcnJ1cHQ7CnNlbGVjdGlvbi5wcm90b3R5cGUudHJhbnNpdGlvbiA9IHNlbGVjdGlvbl90cmFuc2l0aW9uOwoKdmFyIHJvb3QkMSA9IFtudWxsXTsKCmZ1bmN0aW9uIGFjdGl2ZShub2RlLCBuYW1lKSB7CiAgdmFyIHNjaGVkdWxlcyA9IG5vZGUuX190cmFuc2l0aW9uLAogICAgICBzY2hlZHVsZSQkMSwKICAgICAgaTsKCiAgaWYgKHNjaGVkdWxlcykgewogICAgbmFtZSA9IG5hbWUgPT0gbnVsbCA/IG51bGwgOiBuYW1lICsgIiI7CiAgICBmb3IgKGkgaW4gc2NoZWR1bGVzKSB7CiAgICAgIGlmICgoc2NoZWR1bGUkJDEgPSBzY2hlZHVsZXNbaV0pLnN0YXRlID4gU0NIRURVTEVEICYmIHNjaGVkdWxlJCQxLm5hbWUgPT09IG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFRyYW5zaXRpb24oW1tub2RlXV0sIHJvb3QkMSwgbmFtZSwgK2kpOwogICAgICB9CiAgICB9CiAgfQoKICByZXR1cm4gbnVsbDsKfQoKZnVuY3Rpb24gY29uc3RhbnQkNCh4KSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHg7CiAgfTsKfQoKZnVuY3Rpb24gQnJ1c2hFdmVudCh0YXJnZXQsIHR5cGUsIHNlbGVjdGlvbikgewogIHRoaXMudGFyZ2V0ID0gdGFyZ2V0OwogIHRoaXMudHlwZSA9IHR5cGU7CiAgdGhpcy5zZWxlY3Rpb24gPSBzZWxlY3Rpb247Cn0KCmZ1bmN0aW9uIG5vcHJvcGFnYXRpb24kMSgpIHsKICBleHBvcnRzLmV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwp9CgpmdW5jdGlvbiBub2V2ZW50JDEoKSB7CiAgZXhwb3J0cy5ldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogIGV4cG9ydHMuZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7Cn0KCnZhciBNT0RFX0RSQUcgPSB7bmFtZTogImRyYWcifSwKICAgIE1PREVfU1BBQ0UgPSB7bmFtZTogInNwYWNlIn0sCiAgICBNT0RFX0hBTkRMRSA9IHtuYW1lOiAiaGFuZGxlIn0sCiAgICBNT0RFX0NFTlRFUiA9IHtuYW1lOiAiY2VudGVyIn07Cgp2YXIgWCA9IHsKICBuYW1lOiAieCIsCiAgaGFuZGxlczogWyJlIiwgInciXS5tYXAodHlwZSksCiAgaW5wdXQ6IGZ1bmN0aW9uKHgsIGUpIHsgcmV0dXJuIHggJiYgW1t4WzBdLCBlWzBdWzFdXSwgW3hbMV0sIGVbMV1bMV1dXTsgfSwKICBvdXRwdXQ6IGZ1bmN0aW9uKHh5KSB7IHJldHVybiB4eSAmJiBbeHlbMF1bMF0sIHh5WzFdWzBdXTsgfQp9OwoKdmFyIFkgPSB7CiAgbmFtZTogInkiLAogIGhhbmRsZXM6IFsibiIsICJzIl0ubWFwKHR5cGUpLAogIGlucHV0OiBmdW5jdGlvbih5LCBlKSB7IHJldHVybiB5ICYmIFtbZVswXVswXSwgeVswXV0sIFtlWzFdWzBdLCB5WzFdXV07IH0sCiAgb3V0cHV0OiBmdW5jdGlvbih4eSkgeyByZXR1cm4geHkgJiYgW3h5WzBdWzFdLCB4eVsxXVsxXV07IH0KfTsKCnZhciBYWSA9IHsKICBuYW1lOiAieHkiLAogIGhhbmRsZXM6IFsibiIsICJlIiwgInMiLCAidyIsICJudyIsICJuZSIsICJzZSIsICJzdyJdLm1hcCh0eXBlKSwKICBpbnB1dDogZnVuY3Rpb24oeHkpIHsgcmV0dXJuIHh5OyB9LAogIG91dHB1dDogZnVuY3Rpb24oeHkpIHsgcmV0dXJuIHh5OyB9Cn07Cgp2YXIgY3Vyc29ycyA9IHsKICBvdmVybGF5OiAiY3Jvc3NoYWlyIiwKICBzZWxlY3Rpb246ICJtb3ZlIiwKICBuOiAibnMtcmVzaXplIiwKICBlOiAiZXctcmVzaXplIiwKICBzOiAibnMtcmVzaXplIiwKICB3OiAiZXctcmVzaXplIiwKICBudzogIm53c2UtcmVzaXplIiwKICBuZTogIm5lc3ctcmVzaXplIiwKICBzZTogIm53c2UtcmVzaXplIiwKICBzdzogIm5lc3ctcmVzaXplIgp9OwoKdmFyIGZsaXBYID0gewogIGU6ICJ3IiwKICB3OiAiZSIsCiAgbnc6ICJuZSIsCiAgbmU6ICJudyIsCiAgc2U6ICJzdyIsCiAgc3c6ICJzZSIKfTsKCnZhciBmbGlwWSA9IHsKICBuOiAicyIsCiAgczogIm4iLAogIG53OiAic3ciLAogIG5lOiAic2UiLAogIHNlOiAibmUiLAogIHN3OiAibnciCn07Cgp2YXIgc2lnbnNYID0gewogIG92ZXJsYXk6ICsxLAogIHNlbGVjdGlvbjogKzEsCiAgbjogbnVsbCwKICBlOiArMSwKICBzOiBudWxsLAogIHc6IC0xLAogIG53OiAtMSwKICBuZTogKzEsCiAgc2U6ICsxLAogIHN3OiAtMQp9OwoKdmFyIHNpZ25zWSA9IHsKICBvdmVybGF5OiArMSwKICBzZWxlY3Rpb246ICsxLAogIG46IC0xLAogIGU6IG51bGwsCiAgczogKzEsCiAgdzogbnVsbCwKICBudzogLTEsCiAgbmU6IC0xLAogIHNlOiArMSwKICBzdzogKzEKfTsKCmZ1bmN0aW9uIHR5cGUodCkgewogIHJldHVybiB7dHlwZTogdH07Cn0KCi8vIElnbm9yZSByaWdodC1jbGljaywgc2luY2UgdGhhdCBzaG91bGQgb3BlbiB0aGUgY29udGV4dCBtZW51LgpmdW5jdGlvbiBkZWZhdWx0RmlsdGVyJDEoKSB7CiAgcmV0dXJuICFleHBvcnRzLmV2ZW50LmJ1dHRvbjsKfQoKZnVuY3Rpb24gZGVmYXVsdEV4dGVudCgpIHsKICB2YXIgc3ZnID0gdGhpcy5vd25lclNWR0VsZW1lbnQgfHwgdGhpczsKICByZXR1cm4gW1swLCAwXSwgW3N2Zy53aWR0aC5iYXNlVmFsLnZhbHVlLCBzdmcuaGVpZ2h0LmJhc2VWYWwudmFsdWVdXTsKfQoKLy8gTGlrZSBkMy5sb2NhbCwgYnV0IHdpdGggdGhlIG5hbWUg4oCcX19icnVzaOKAnSByYXRoZXIgdGhhbiBhdXRvLWdlbmVyYXRlZC4KZnVuY3Rpb24gbG9jYWwkMShub2RlKSB7CiAgd2hpbGUgKCFub2RlLl9fYnJ1c2gpIGlmICghKG5vZGUgPSBub2RlLnBhcmVudE5vZGUpKSByZXR1cm47CiAgcmV0dXJuIG5vZGUuX19icnVzaDsKfQoKZnVuY3Rpb24gZW1wdHkkMShleHRlbnQpIHsKICByZXR1cm4gZXh0ZW50WzBdWzBdID09PSBleHRlbnRbMV1bMF0KICAgICAgfHwgZXh0ZW50WzBdWzFdID09PSBleHRlbnRbMV1bMV07Cn0KCmZ1bmN0aW9uIGJydXNoU2VsZWN0aW9uKG5vZGUpIHsKICB2YXIgc3RhdGUgPSBub2RlLl9fYnJ1c2g7CiAgcmV0dXJuIHN0YXRlID8gc3RhdGUuZGltLm91dHB1dChzdGF0ZS5zZWxlY3Rpb24pIDogbnVsbDsKfQoKZnVuY3Rpb24gYnJ1c2hYKCkgewogIHJldHVybiBicnVzaCQxKFgpOwp9CgpmdW5jdGlvbiBicnVzaFkoKSB7CiAgcmV0dXJuIGJydXNoJDEoWSk7Cn0KCmZ1bmN0aW9uIGJydXNoKCkgewogIHJldHVybiBicnVzaCQxKFhZKTsKfQoKZnVuY3Rpb24gYnJ1c2gkMShkaW0pIHsKICB2YXIgZXh0ZW50ID0gZGVmYXVsdEV4dGVudCwKICAgICAgZmlsdGVyID0gZGVmYXVsdEZpbHRlciQxLAogICAgICBsaXN0ZW5lcnMgPSBkaXNwYXRjaChicnVzaCwgInN0YXJ0IiwgImJydXNoIiwgImVuZCIpLAogICAgICBoYW5kbGVTaXplID0gNiwKICAgICAgdG91Y2hlbmRpbmc7CgogIGZ1bmN0aW9uIGJydXNoKGdyb3VwKSB7CiAgICB2YXIgb3ZlcmxheSA9IGdyb3VwCiAgICAgICAgLnByb3BlcnR5KCJfX2JydXNoIiwgaW5pdGlhbGl6ZSkKICAgICAgLnNlbGVjdEFsbCgiLm92ZXJsYXkiKQogICAgICAuZGF0YShbdHlwZSgib3ZlcmxheSIpXSk7CgogICAgb3ZlcmxheS5lbnRlcigpLmFwcGVuZCgicmVjdCIpCiAgICAgICAgLmF0dHIoImNsYXNzIiwgIm92ZXJsYXkiKQogICAgICAgIC5hdHRyKCJwb2ludGVyLWV2ZW50cyIsICJhbGwiKQogICAgICAgIC5hdHRyKCJjdXJzb3IiLCBjdXJzb3JzLm92ZXJsYXkpCiAgICAgIC5tZXJnZShvdmVybGF5KQogICAgICAgIC5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGV4dGVudCA9IGxvY2FsJDEodGhpcykuZXh0ZW50OwogICAgICAgICAgc2VsZWN0KHRoaXMpCiAgICAgICAgICAgICAgLmF0dHIoIngiLCBleHRlbnRbMF1bMF0pCiAgICAgICAgICAgICAgLmF0dHIoInkiLCBleHRlbnRbMF1bMV0pCiAgICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgZXh0ZW50WzFdWzBdIC0gZXh0ZW50WzBdWzBdKQogICAgICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLCBleHRlbnRbMV1bMV0gLSBleHRlbnRbMF1bMV0pOwogICAgICAgIH0pOwoKICAgIGdyb3VwLnNlbGVjdEFsbCgiLnNlbGVjdGlvbiIpCiAgICAgIC5kYXRhKFt0eXBlKCJzZWxlY3Rpb24iKV0pCiAgICAgIC5lbnRlcigpLmFwcGVuZCgicmVjdCIpCiAgICAgICAgLmF0dHIoImNsYXNzIiwgInNlbGVjdGlvbiIpCiAgICAgICAgLmF0dHIoImN1cnNvciIsIGN1cnNvcnMuc2VsZWN0aW9uKQogICAgICAgIC5hdHRyKCJmaWxsIiwgIiM3NzciKQogICAgICAgIC5hdHRyKCJmaWxsLW9wYWNpdHkiLCAwLjMpCiAgICAgICAgLmF0dHIoInN0cm9rZSIsICIjZmZmIikKICAgICAgICAuYXR0cigic2hhcGUtcmVuZGVyaW5nIiwgImNyaXNwRWRnZXMiKTsKCiAgICB2YXIgaGFuZGxlID0gZ3JvdXAuc2VsZWN0QWxsKCIuaGFuZGxlIikKICAgICAgLmRhdGEoZGltLmhhbmRsZXMsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQudHlwZTsgfSk7CgogICAgaGFuZGxlLmV4aXQoKS5yZW1vdmUoKTsKCiAgICBoYW5kbGUuZW50ZXIoKS5hcHBlbmQoInJlY3QiKQogICAgICAgIC5hdHRyKCJjbGFzcyIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuICJoYW5kbGUgaGFuZGxlLS0iICsgZC50eXBlOyB9KQogICAgICAgIC5hdHRyKCJjdXJzb3IiLCBmdW5jdGlvbihkKSB7IHJldHVybiBjdXJzb3JzW2QudHlwZV07IH0pOwoKICAgIGdyb3VwCiAgICAgICAgLmVhY2gocmVkcmF3KQogICAgICAgIC5hdHRyKCJmaWxsIiwgIm5vbmUiKQogICAgICAgIC5hdHRyKCJwb2ludGVyLWV2ZW50cyIsICJhbGwiKQogICAgICAgIC5zdHlsZSgiLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yIiwgInJnYmEoMCwwLDAsMCkiKQogICAgICAgIC5vbigibW91c2Vkb3duLmJydXNoIHRvdWNoc3RhcnQuYnJ1c2giLCBzdGFydGVkKTsKICB9CgogIGJydXNoLm1vdmUgPSBmdW5jdGlvbihncm91cCwgc2VsZWN0aW9uJCQxKSB7CiAgICBpZiAoZ3JvdXAuc2VsZWN0aW9uKSB7CiAgICAgIGdyb3VwCiAgICAgICAgICAub24oInN0YXJ0LmJydXNoIiwgZnVuY3Rpb24oKSB7IGVtaXR0ZXIodGhpcywgYXJndW1lbnRzKS5iZWZvcmVzdGFydCgpLnN0YXJ0KCk7IH0pCiAgICAgICAgICAub24oImludGVycnVwdC5icnVzaCBlbmQuYnJ1c2giLCBmdW5jdGlvbigpIHsgZW1pdHRlcih0aGlzLCBhcmd1bWVudHMpLmVuZCgpOyB9KQogICAgICAgICAgLnR3ZWVuKCJicnVzaCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsCiAgICAgICAgICAgICAgICBzdGF0ZSA9IHRoYXQuX19icnVzaCwKICAgICAgICAgICAgICAgIGVtaXQgPSBlbWl0dGVyKHRoYXQsIGFyZ3VtZW50cyksCiAgICAgICAgICAgICAgICBzZWxlY3Rpb24wID0gc3RhdGUuc2VsZWN0aW9uLAogICAgICAgICAgICAgICAgc2VsZWN0aW9uMSA9IGRpbS5pbnB1dCh0eXBlb2Ygc2VsZWN0aW9uJCQxID09PSAiZnVuY3Rpb24iID8gc2VsZWN0aW9uJCQxLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBzZWxlY3Rpb24kJDEsIHN0YXRlLmV4dGVudCksCiAgICAgICAgICAgICAgICBpID0gaW50ZXJwb2xhdGVWYWx1ZShzZWxlY3Rpb24wLCBzZWxlY3Rpb24xKTsKCiAgICAgICAgICAgIGZ1bmN0aW9uIHR3ZWVuKHQpIHsKICAgICAgICAgICAgICBzdGF0ZS5zZWxlY3Rpb24gPSB0ID09PSAxICYmIGVtcHR5JDEoc2VsZWN0aW9uMSkgPyBudWxsIDogaSh0KTsKICAgICAgICAgICAgICByZWRyYXcuY2FsbCh0aGF0KTsKICAgICAgICAgICAgICBlbWl0LmJydXNoKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzZWxlY3Rpb24wICYmIHNlbGVjdGlvbjEgPyB0d2VlbiA6IHR3ZWVuKDEpOwogICAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBncm91cAogICAgICAgICAgLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywKICAgICAgICAgICAgICAgIGFyZ3MgPSBhcmd1bWVudHMsCiAgICAgICAgICAgICAgICBzdGF0ZSA9IHRoYXQuX19icnVzaCwKICAgICAgICAgICAgICAgIHNlbGVjdGlvbjEgPSBkaW0uaW5wdXQodHlwZW9mIHNlbGVjdGlvbiQkMSA9PT0gImZ1bmN0aW9uIiA/IHNlbGVjdGlvbiQkMS5hcHBseSh0aGF0LCBhcmdzKSA6IHNlbGVjdGlvbiQkMSwgc3RhdGUuZXh0ZW50KSwKICAgICAgICAgICAgICAgIGVtaXQgPSBlbWl0dGVyKHRoYXQsIGFyZ3MpLmJlZm9yZXN0YXJ0KCk7CgogICAgICAgICAgICBpbnRlcnJ1cHQodGhhdCk7CiAgICAgICAgICAgIHN0YXRlLnNlbGVjdGlvbiA9IHNlbGVjdGlvbjEgPT0gbnVsbCB8fCBlbXB0eSQxKHNlbGVjdGlvbjEpID8gbnVsbCA6IHNlbGVjdGlvbjE7CiAgICAgICAgICAgIHJlZHJhdy5jYWxsKHRoYXQpOwogICAgICAgICAgICBlbWl0LnN0YXJ0KCkuYnJ1c2goKS5lbmQoKTsKICAgICAgICAgIH0pOwogICAgfQogIH07CgogIGZ1bmN0aW9uIHJlZHJhdygpIHsKICAgIHZhciBncm91cCA9IHNlbGVjdCh0aGlzKSwKICAgICAgICBzZWxlY3Rpb24kJDEgPSBsb2NhbCQxKHRoaXMpLnNlbGVjdGlvbjsKCiAgICBpZiAoc2VsZWN0aW9uJCQxKSB7CiAgICAgIGdyb3VwLnNlbGVjdEFsbCgiLnNlbGVjdGlvbiIpCiAgICAgICAgICAuc3R5bGUoImRpc3BsYXkiLCBudWxsKQogICAgICAgICAgLmF0dHIoIngiLCBzZWxlY3Rpb24kJDFbMF1bMF0pCiAgICAgICAgICAuYXR0cigieSIsIHNlbGVjdGlvbiQkMVswXVsxXSkKICAgICAgICAgIC5hdHRyKCJ3aWR0aCIsIHNlbGVjdGlvbiQkMVsxXVswXSAtIHNlbGVjdGlvbiQkMVswXVswXSkKICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLCBzZWxlY3Rpb24kJDFbMV1bMV0gLSBzZWxlY3Rpb24kJDFbMF1bMV0pOwoKICAgICAgZ3JvdXAuc2VsZWN0QWxsKCIuaGFuZGxlIikKICAgICAgICAgIC5zdHlsZSgiZGlzcGxheSIsIG51bGwpCiAgICAgICAgICAuYXR0cigieCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQudHlwZVtkLnR5cGUubGVuZ3RoIC0gMV0gPT09ICJlIiA/IHNlbGVjdGlvbiQkMVsxXVswXSAtIGhhbmRsZVNpemUgLyAyIDogc2VsZWN0aW9uJCQxWzBdWzBdIC0gaGFuZGxlU2l6ZSAvIDI7IH0pCiAgICAgICAgICAuYXR0cigieSIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQudHlwZVswXSA9PT0gInMiID8gc2VsZWN0aW9uJCQxWzFdWzFdIC0gaGFuZGxlU2l6ZSAvIDIgOiBzZWxlY3Rpb24kJDFbMF1bMV0gLSBoYW5kbGVTaXplIC8gMjsgfSkKICAgICAgICAgIC5hdHRyKCJ3aWR0aCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQudHlwZSA9PT0gIm4iIHx8IGQudHlwZSA9PT0gInMiID8gc2VsZWN0aW9uJCQxWzFdWzBdIC0gc2VsZWN0aW9uJCQxWzBdWzBdICsgaGFuZGxlU2l6ZSA6IGhhbmRsZVNpemU7IH0pCiAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC50eXBlID09PSAiZSIgfHwgZC50eXBlID09PSAidyIgPyBzZWxlY3Rpb24kJDFbMV1bMV0gLSBzZWxlY3Rpb24kJDFbMF1bMV0gKyBoYW5kbGVTaXplIDogaGFuZGxlU2l6ZTsgfSk7CiAgICB9CgogICAgZWxzZSB7CiAgICAgIGdyb3VwLnNlbGVjdEFsbCgiLnNlbGVjdGlvbiwuaGFuZGxlIikKICAgICAgICAgIC5zdHlsZSgiZGlzcGxheSIsICJub25lIikKICAgICAgICAgIC5hdHRyKCJ4IiwgbnVsbCkKICAgICAgICAgIC5hdHRyKCJ5IiwgbnVsbCkKICAgICAgICAgIC5hdHRyKCJ3aWR0aCIsIG51bGwpCiAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgbnVsbCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBlbWl0dGVyKHRoYXQsIGFyZ3MpIHsKICAgIHJldHVybiB0aGF0Ll9fYnJ1c2guZW1pdHRlciB8fCBuZXcgRW1pdHRlcih0aGF0LCBhcmdzKTsKICB9CgogIGZ1bmN0aW9uIEVtaXR0ZXIodGhhdCwgYXJncykgewogICAgdGhpcy50aGF0ID0gdGhhdDsKICAgIHRoaXMuYXJncyA9IGFyZ3M7CiAgICB0aGlzLnN0YXRlID0gdGhhdC5fX2JydXNoOwogICAgdGhpcy5hY3RpdmUgPSAwOwogIH0KCiAgRW1pdHRlci5wcm90b3R5cGUgPSB7CiAgICBiZWZvcmVzdGFydDogZnVuY3Rpb24oKSB7CiAgICAgIGlmICgrK3RoaXMuYWN0aXZlID09PSAxKSB0aGlzLnN0YXRlLmVtaXR0ZXIgPSB0aGlzLCB0aGlzLnN0YXJ0aW5nID0gdHJ1ZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAogICAgc3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy5zdGFydGluZykgdGhpcy5zdGFydGluZyA9IGZhbHNlLCB0aGlzLmVtaXQoInN0YXJ0Iik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIGJydXNoOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5lbWl0KCJicnVzaCIpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICBlbmQ6IGZ1bmN0aW9uKCkgewogICAgICBpZiAoLS10aGlzLmFjdGl2ZSA9PT0gMCkgZGVsZXRlIHRoaXMuc3RhdGUuZW1pdHRlciwgdGhpcy5lbWl0KCJlbmQiKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAogICAgZW1pdDogZnVuY3Rpb24odHlwZSkgewogICAgICBjdXN0b21FdmVudChuZXcgQnJ1c2hFdmVudChicnVzaCwgdHlwZSwgZGltLm91dHB1dCh0aGlzLnN0YXRlLnNlbGVjdGlvbikpLCBsaXN0ZW5lcnMuYXBwbHksIGxpc3RlbmVycywgW3R5cGUsIHRoaXMudGhhdCwgdGhpcy5hcmdzXSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gc3RhcnRlZCgpIHsKICAgIGlmIChleHBvcnRzLmV2ZW50LnRvdWNoZXMpIHsgaWYgKGV4cG9ydHMuZXZlbnQuY2hhbmdlZFRvdWNoZXMubGVuZ3RoIDwgZXhwb3J0cy5ldmVudC50b3VjaGVzLmxlbmd0aCkgcmV0dXJuIG5vZXZlbnQkMSgpOyB9CiAgICBlbHNlIGlmICh0b3VjaGVuZGluZykgcmV0dXJuOwogICAgaWYgKCFmaWx0ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgcmV0dXJuOwoKICAgIHZhciB0aGF0ID0gdGhpcywKICAgICAgICB0eXBlID0gZXhwb3J0cy5ldmVudC50YXJnZXQuX19kYXRhX18udHlwZSwKICAgICAgICBtb2RlID0gKGV4cG9ydHMuZXZlbnQubWV0YUtleSA/IHR5cGUgPSAib3ZlcmxheSIgOiB0eXBlKSA9PT0gInNlbGVjdGlvbiIgPyBNT0RFX0RSQUcgOiAoZXhwb3J0cy5ldmVudC5hbHRLZXkgPyBNT0RFX0NFTlRFUiA6IE1PREVfSEFORExFKSwKICAgICAgICBzaWduWCA9IGRpbSA9PT0gWSA/IG51bGwgOiBzaWduc1hbdHlwZV0sCiAgICAgICAgc2lnblkgPSBkaW0gPT09IFggPyBudWxsIDogc2lnbnNZW3R5cGVdLAogICAgICAgIHN0YXRlID0gbG9jYWwkMSh0aGF0KSwKICAgICAgICBleHRlbnQgPSBzdGF0ZS5leHRlbnQsCiAgICAgICAgc2VsZWN0aW9uJCQxID0gc3RhdGUuc2VsZWN0aW9uLAogICAgICAgIFcgPSBleHRlbnRbMF1bMF0sIHcwLCB3MSwKICAgICAgICBOID0gZXh0ZW50WzBdWzFdLCBuMCwgbjEsCiAgICAgICAgRSA9IGV4dGVudFsxXVswXSwgZTAsIGUxLAogICAgICAgIFMgPSBleHRlbnRbMV1bMV0sIHMwLCBzMSwKICAgICAgICBkeCwKICAgICAgICBkeSwKICAgICAgICBtb3ZpbmcsCiAgICAgICAgc2hpZnRpbmcgPSBzaWduWCAmJiBzaWduWSAmJiBleHBvcnRzLmV2ZW50LnNoaWZ0S2V5LAogICAgICAgIGxvY2tYLAogICAgICAgIGxvY2tZLAogICAgICAgIHBvaW50MCA9IG1vdXNlKHRoYXQpLAogICAgICAgIHBvaW50JCQxID0gcG9pbnQwLAogICAgICAgIGVtaXQgPSBlbWl0dGVyKHRoYXQsIGFyZ3VtZW50cykuYmVmb3Jlc3RhcnQoKTsKCiAgICBpZiAodHlwZSA9PT0gIm92ZXJsYXkiKSB7CiAgICAgIHN0YXRlLnNlbGVjdGlvbiA9IHNlbGVjdGlvbiQkMSA9IFsKICAgICAgICBbdzAgPSBkaW0gPT09IFkgPyBXIDogcG9pbnQwWzBdLCBuMCA9IGRpbSA9PT0gWCA/IE4gOiBwb2ludDBbMV1dLAogICAgICAgIFtlMCA9IGRpbSA9PT0gWSA/IEUgOiB3MCwgczAgPSBkaW0gPT09IFggPyBTIDogbjBdCiAgICAgIF07CiAgICB9IGVsc2UgewogICAgICB3MCA9IHNlbGVjdGlvbiQkMVswXVswXTsKICAgICAgbjAgPSBzZWxlY3Rpb24kJDFbMF1bMV07CiAgICAgIGUwID0gc2VsZWN0aW9uJCQxWzFdWzBdOwogICAgICBzMCA9IHNlbGVjdGlvbiQkMVsxXVsxXTsKICAgIH0KCiAgICB3MSA9IHcwOwogICAgbjEgPSBuMDsKICAgIGUxID0gZTA7CiAgICBzMSA9IHMwOwoKICAgIHZhciBncm91cCA9IHNlbGVjdCh0aGF0KQogICAgICAgIC5hdHRyKCJwb2ludGVyLWV2ZW50cyIsICJub25lIik7CgogICAgdmFyIG92ZXJsYXkgPSBncm91cC5zZWxlY3RBbGwoIi5vdmVybGF5IikKICAgICAgICAuYXR0cigiY3Vyc29yIiwgY3Vyc29yc1t0eXBlXSk7CgogICAgaWYgKGV4cG9ydHMuZXZlbnQudG91Y2hlcykgewogICAgICBncm91cAogICAgICAgICAgLm9uKCJ0b3VjaG1vdmUuYnJ1c2giLCBtb3ZlZCwgdHJ1ZSkKICAgICAgICAgIC5vbigidG91Y2hlbmQuYnJ1c2ggdG91Y2hjYW5jZWwuYnJ1c2giLCBlbmRlZCwgdHJ1ZSk7CiAgICB9IGVsc2UgewogICAgICB2YXIgdmlldyA9IHNlbGVjdChleHBvcnRzLmV2ZW50LnZpZXcpCiAgICAgICAgICAub24oImtleWRvd24uYnJ1c2giLCBrZXlkb3duZWQsIHRydWUpCiAgICAgICAgICAub24oImtleXVwLmJydXNoIiwga2V5dXBwZWQsIHRydWUpCiAgICAgICAgICAub24oIm1vdXNlbW92ZS5icnVzaCIsIG1vdmVkLCB0cnVlKQogICAgICAgICAgLm9uKCJtb3VzZXVwLmJydXNoIiwgZW5kZWQsIHRydWUpOwoKICAgICAgZHJhZ0Rpc2FibGUoZXhwb3J0cy5ldmVudC52aWV3KTsKICAgIH0KCiAgICBub3Byb3BhZ2F0aW9uJDEoKTsKICAgIGludGVycnVwdCh0aGF0KTsKICAgIHJlZHJhdy5jYWxsKHRoYXQpOwogICAgZW1pdC5zdGFydCgpOwoKICAgIGZ1bmN0aW9uIG1vdmVkKCkgewogICAgICB2YXIgcG9pbnQxID0gbW91c2UodGhhdCk7CiAgICAgIGlmIChzaGlmdGluZyAmJiAhbG9ja1ggJiYgIWxvY2tZKSB7CiAgICAgICAgaWYgKE1hdGguYWJzKHBvaW50MVswXSAtIHBvaW50JCQxWzBdKSA+IE1hdGguYWJzKHBvaW50MVsxXSAtIHBvaW50JCQxWzFdKSkgbG9ja1kgPSB0cnVlOwogICAgICAgIGVsc2UgbG9ja1ggPSB0cnVlOwogICAgICB9CiAgICAgIHBvaW50JCQxID0gcG9pbnQxOwogICAgICBtb3ZpbmcgPSB0cnVlOwogICAgICBub2V2ZW50JDEoKTsKICAgICAgbW92ZSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIG1vdmUoKSB7CiAgICAgIHZhciB0OwoKICAgICAgZHggPSBwb2ludCQkMVswXSAtIHBvaW50MFswXTsKICAgICAgZHkgPSBwb2ludCQkMVsxXSAtIHBvaW50MFsxXTsKCiAgICAgIHN3aXRjaCAobW9kZSkgewogICAgICAgIGNhc2UgTU9ERV9TUEFDRToKICAgICAgICBjYXNlIE1PREVfRFJBRzogewogICAgICAgICAgaWYgKHNpZ25YKSBkeCA9IE1hdGgubWF4KFcgLSB3MCwgTWF0aC5taW4oRSAtIGUwLCBkeCkpLCB3MSA9IHcwICsgZHgsIGUxID0gZTAgKyBkeDsKICAgICAgICAgIGlmIChzaWduWSkgZHkgPSBNYXRoLm1heChOIC0gbjAsIE1hdGgubWluKFMgLSBzMCwgZHkpKSwgbjEgPSBuMCArIGR5LCBzMSA9IHMwICsgZHk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgY2FzZSBNT0RFX0hBTkRMRTogewogICAgICAgICAgaWYgKHNpZ25YIDwgMCkgZHggPSBNYXRoLm1heChXIC0gdzAsIE1hdGgubWluKEUgLSB3MCwgZHgpKSwgdzEgPSB3MCArIGR4LCBlMSA9IGUwOwogICAgICAgICAgZWxzZSBpZiAoc2lnblggPiAwKSBkeCA9IE1hdGgubWF4KFcgLSBlMCwgTWF0aC5taW4oRSAtIGUwLCBkeCkpLCB3MSA9IHcwLCBlMSA9IGUwICsgZHg7CiAgICAgICAgICBpZiAoc2lnblkgPCAwKSBkeSA9IE1hdGgubWF4KE4gLSBuMCwgTWF0aC5taW4oUyAtIG4wLCBkeSkpLCBuMSA9IG4wICsgZHksIHMxID0gczA7CiAgICAgICAgICBlbHNlIGlmIChzaWduWSA+IDApIGR5ID0gTWF0aC5tYXgoTiAtIHMwLCBNYXRoLm1pbihTIC0gczAsIGR5KSksIG4xID0gbjAsIHMxID0gczAgKyBkeTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjYXNlIE1PREVfQ0VOVEVSOiB7CiAgICAgICAgICBpZiAoc2lnblgpIHcxID0gTWF0aC5tYXgoVywgTWF0aC5taW4oRSwgdzAgLSBkeCAqIHNpZ25YKSksIGUxID0gTWF0aC5tYXgoVywgTWF0aC5taW4oRSwgZTAgKyBkeCAqIHNpZ25YKSk7CiAgICAgICAgICBpZiAoc2lnblkpIG4xID0gTWF0aC5tYXgoTiwgTWF0aC5taW4oUywgbjAgLSBkeSAqIHNpZ25ZKSksIHMxID0gTWF0aC5tYXgoTiwgTWF0aC5taW4oUywgczAgKyBkeSAqIHNpZ25ZKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChlMSA8IHcxKSB7CiAgICAgICAgc2lnblggKj0gLTE7CiAgICAgICAgdCA9IHcwLCB3MCA9IGUwLCBlMCA9IHQ7CiAgICAgICAgdCA9IHcxLCB3MSA9IGUxLCBlMSA9IHQ7CiAgICAgICAgaWYgKHR5cGUgaW4gZmxpcFgpIG92ZXJsYXkuYXR0cigiY3Vyc29yIiwgY3Vyc29yc1t0eXBlID0gZmxpcFhbdHlwZV1dKTsKICAgICAgfQoKICAgICAgaWYgKHMxIDwgbjEpIHsKICAgICAgICBzaWduWSAqPSAtMTsKICAgICAgICB0ID0gbjAsIG4wID0gczAsIHMwID0gdDsKICAgICAgICB0ID0gbjEsIG4xID0gczEsIHMxID0gdDsKICAgICAgICBpZiAodHlwZSBpbiBmbGlwWSkgb3ZlcmxheS5hdHRyKCJjdXJzb3IiLCBjdXJzb3JzW3R5cGUgPSBmbGlwWVt0eXBlXV0pOwogICAgICB9CgogICAgICBpZiAoc3RhdGUuc2VsZWN0aW9uKSBzZWxlY3Rpb24kJDEgPSBzdGF0ZS5zZWxlY3Rpb247IC8vIE1heSBiZSBzZXQgYnkgYnJ1c2gubW92ZSEKICAgICAgaWYgKGxvY2tYKSB3MSA9IHNlbGVjdGlvbiQkMVswXVswXSwgZTEgPSBzZWxlY3Rpb24kJDFbMV1bMF07CiAgICAgIGlmIChsb2NrWSkgbjEgPSBzZWxlY3Rpb24kJDFbMF1bMV0sIHMxID0gc2VsZWN0aW9uJCQxWzFdWzFdOwoKICAgICAgaWYgKHNlbGVjdGlvbiQkMVswXVswXSAhPT0gdzEKICAgICAgICAgIHx8IHNlbGVjdGlvbiQkMVswXVsxXSAhPT0gbjEKICAgICAgICAgIHx8IHNlbGVjdGlvbiQkMVsxXVswXSAhPT0gZTEKICAgICAgICAgIHx8IHNlbGVjdGlvbiQkMVsxXVsxXSAhPT0gczEpIHsKICAgICAgICBzdGF0ZS5zZWxlY3Rpb24gPSBbW3cxLCBuMV0sIFtlMSwgczFdXTsKICAgICAgICByZWRyYXcuY2FsbCh0aGF0KTsKICAgICAgICBlbWl0LmJydXNoKCk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBlbmRlZCgpIHsKICAgICAgbm9wcm9wYWdhdGlvbiQxKCk7CiAgICAgIGlmIChleHBvcnRzLmV2ZW50LnRvdWNoZXMpIHsKICAgICAgICBpZiAoZXhwb3J0cy5ldmVudC50b3VjaGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgIGlmICh0b3VjaGVuZGluZykgY2xlYXJUaW1lb3V0KHRvdWNoZW5kaW5nKTsKICAgICAgICB0b3VjaGVuZGluZyA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHRvdWNoZW5kaW5nID0gbnVsbDsgfSwgNTAwKTsgLy8gR2hvc3QgY2xpY2tzIGFyZSBkZWxheWVkIQogICAgICAgIGdyb3VwLm9uKCJ0b3VjaG1vdmUuYnJ1c2ggdG91Y2hlbmQuYnJ1c2ggdG91Y2hjYW5jZWwuYnJ1c2giLCBudWxsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB5ZXNkcmFnKGV4cG9ydHMuZXZlbnQudmlldywgbW92aW5nKTsKICAgICAgICB2aWV3Lm9uKCJrZXlkb3duLmJydXNoIGtleXVwLmJydXNoIG1vdXNlbW92ZS5icnVzaCBtb3VzZXVwLmJydXNoIiwgbnVsbCk7CiAgICAgIH0KICAgICAgZ3JvdXAuYXR0cigicG9pbnRlci1ldmVudHMiLCAiYWxsIik7CiAgICAgIG92ZXJsYXkuYXR0cigiY3Vyc29yIiwgY3Vyc29ycy5vdmVybGF5KTsKICAgICAgaWYgKHN0YXRlLnNlbGVjdGlvbikgc2VsZWN0aW9uJCQxID0gc3RhdGUuc2VsZWN0aW9uOyAvLyBNYXkgYmUgc2V0IGJ5IGJydXNoLm1vdmUgKG9uIHN0YXJ0KSEKICAgICAgaWYgKGVtcHR5JDEoc2VsZWN0aW9uJCQxKSkgc3RhdGUuc2VsZWN0aW9uID0gbnVsbCwgcmVkcmF3LmNhbGwodGhhdCk7CiAgICAgIGVtaXQuZW5kKCk7CiAgICB9CgogICAgZnVuY3Rpb24ga2V5ZG93bmVkKCkgewogICAgICBzd2l0Y2ggKGV4cG9ydHMuZXZlbnQua2V5Q29kZSkgewogICAgICAgIGNhc2UgMTY6IHsgLy8gU0hJRlQKICAgICAgICAgIHNoaWZ0aW5nID0gc2lnblggJiYgc2lnblk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgY2FzZSAxODogeyAvLyBBTFQKICAgICAgICAgIGlmIChtb2RlID09PSBNT0RFX0hBTkRMRSkgewogICAgICAgICAgICBpZiAoc2lnblgpIGUwID0gZTEgLSBkeCAqIHNpZ25YLCB3MCA9IHcxICsgZHggKiBzaWduWDsKICAgICAgICAgICAgaWYgKHNpZ25ZKSBzMCA9IHMxIC0gZHkgKiBzaWduWSwgbjAgPSBuMSArIGR5ICogc2lnblk7CiAgICAgICAgICAgIG1vZGUgPSBNT0RFX0NFTlRFUjsKICAgICAgICAgICAgbW92ZSgpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNhc2UgMzI6IHsgLy8gU1BBQ0U7IHRha2VzIHByaW9yaXR5IG92ZXIgQUxUCiAgICAgICAgICBpZiAobW9kZSA9PT0gTU9ERV9IQU5ETEUgfHwgbW9kZSA9PT0gTU9ERV9DRU5URVIpIHsKICAgICAgICAgICAgaWYgKHNpZ25YIDwgMCkgZTAgPSBlMSAtIGR4OyBlbHNlIGlmIChzaWduWCA+IDApIHcwID0gdzEgLSBkeDsKICAgICAgICAgICAgaWYgKHNpZ25ZIDwgMCkgczAgPSBzMSAtIGR5OyBlbHNlIGlmIChzaWduWSA+IDApIG4wID0gbjEgLSBkeTsKICAgICAgICAgICAgbW9kZSA9IE1PREVfU1BBQ0U7CiAgICAgICAgICAgIG92ZXJsYXkuYXR0cigiY3Vyc29yIiwgY3Vyc29ycy5zZWxlY3Rpb24pOwogICAgICAgICAgICBtb3ZlKCk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgZGVmYXVsdDogcmV0dXJuOwogICAgICB9CiAgICAgIG5vZXZlbnQkMSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGtleXVwcGVkKCkgewogICAgICBzd2l0Y2ggKGV4cG9ydHMuZXZlbnQua2V5Q29kZSkgewogICAgICAgIGNhc2UgMTY6IHsgLy8gU0hJRlQKICAgICAgICAgIGlmIChzaGlmdGluZykgewogICAgICAgICAgICBsb2NrWCA9IGxvY2tZID0gc2hpZnRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgbW92ZSgpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNhc2UgMTg6IHsgLy8gQUxUCiAgICAgICAgICBpZiAobW9kZSA9PT0gTU9ERV9DRU5URVIpIHsKICAgICAgICAgICAgaWYgKHNpZ25YIDwgMCkgZTAgPSBlMTsgZWxzZSBpZiAoc2lnblggPiAwKSB3MCA9IHcxOwogICAgICAgICAgICBpZiAoc2lnblkgPCAwKSBzMCA9IHMxOyBlbHNlIGlmIChzaWduWSA+IDApIG4wID0gbjE7CiAgICAgICAgICAgIG1vZGUgPSBNT0RFX0hBTkRMRTsKICAgICAgICAgICAgbW92ZSgpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNhc2UgMzI6IHsgLy8gU1BBQ0UKICAgICAgICAgIGlmIChtb2RlID09PSBNT0RFX1NQQUNFKSB7CiAgICAgICAgICAgIGlmIChleHBvcnRzLmV2ZW50LmFsdEtleSkgewogICAgICAgICAgICAgIGlmIChzaWduWCkgZTAgPSBlMSAtIGR4ICogc2lnblgsIHcwID0gdzEgKyBkeCAqIHNpZ25YOwogICAgICAgICAgICAgIGlmIChzaWduWSkgczAgPSBzMSAtIGR5ICogc2lnblksIG4wID0gbjEgKyBkeSAqIHNpZ25ZOwogICAgICAgICAgICAgIG1vZGUgPSBNT0RFX0NFTlRFUjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAoc2lnblggPCAwKSBlMCA9IGUxOyBlbHNlIGlmIChzaWduWCA+IDApIHcwID0gdzE7CiAgICAgICAgICAgICAgaWYgKHNpZ25ZIDwgMCkgczAgPSBzMTsgZWxzZSBpZiAoc2lnblkgPiAwKSBuMCA9IG4xOwogICAgICAgICAgICAgIG1vZGUgPSBNT0RFX0hBTkRMRTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvdmVybGF5LmF0dHIoImN1cnNvciIsIGN1cnNvcnNbdHlwZV0pOwogICAgICAgICAgICBtb3ZlKCk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgZGVmYXVsdDogcmV0dXJuOwogICAgICB9CiAgICAgIG5vZXZlbnQkMSgpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHsKICAgIHZhciBzdGF0ZSA9IHRoaXMuX19icnVzaCB8fCB7c2VsZWN0aW9uOiBudWxsfTsKICAgIHN0YXRlLmV4dGVudCA9IGV4dGVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgc3RhdGUuZGltID0gZGltOwogICAgcmV0dXJuIHN0YXRlOwogIH0KCiAgYnJ1c2guZXh0ZW50ID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZXh0ZW50ID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkNChbWytfWzBdWzBdLCArX1swXVsxXV0sIFsrX1sxXVswXSwgK19bMV1bMV1dXSksIGJydXNoKSA6IGV4dGVudDsKICB9OwoKICBicnVzaC5maWx0ZXIgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChmaWx0ZXIgPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQ0KCEhXyksIGJydXNoKSA6IGZpbHRlcjsKICB9OwoKICBicnVzaC5oYW5kbGVTaXplID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoaGFuZGxlU2l6ZSA9ICtfLCBicnVzaCkgOiBoYW5kbGVTaXplOwogIH07CgogIGJydXNoLm9uID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgdmFsdWUgPSBsaXN0ZW5lcnMub24uYXBwbHkobGlzdGVuZXJzLCBhcmd1bWVudHMpOwogICAgcmV0dXJuIHZhbHVlID09PSBsaXN0ZW5lcnMgPyBicnVzaCA6IHZhbHVlOwogIH07CgogIHJldHVybiBicnVzaDsKfQoKdmFyIGNvcyA9IE1hdGguY29zOwp2YXIgc2luID0gTWF0aC5zaW47CnZhciBwaSQxID0gTWF0aC5QSTsKdmFyIGhhbGZQaSQxID0gcGkkMSAvIDI7CnZhciB0YXUkMSA9IHBpJDEgKiAyOwp2YXIgbWF4JDEgPSBNYXRoLm1heDsKCmZ1bmN0aW9uIGNvbXBhcmVWYWx1ZShjb21wYXJlKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBjb21wYXJlKAogICAgICBhLnNvdXJjZS52YWx1ZSArIGEudGFyZ2V0LnZhbHVlLAogICAgICBiLnNvdXJjZS52YWx1ZSArIGIudGFyZ2V0LnZhbHVlCiAgICApOwogIH07Cn0KCmZ1bmN0aW9uIGNob3JkKCkgewogIHZhciBwYWRBbmdsZSA9IDAsCiAgICAgIHNvcnRHcm91cHMgPSBudWxsLAogICAgICBzb3J0U3ViZ3JvdXBzID0gbnVsbCwKICAgICAgc29ydENob3JkcyA9IG51bGw7CgogIGZ1bmN0aW9uIGNob3JkKG1hdHJpeCkgewogICAgdmFyIG4gPSBtYXRyaXgubGVuZ3RoLAogICAgICAgIGdyb3VwU3VtcyA9IFtdLAogICAgICAgIGdyb3VwSW5kZXggPSBzZXF1ZW5jZShuKSwKICAgICAgICBzdWJncm91cEluZGV4ID0gW10sCiAgICAgICAgY2hvcmRzID0gW10sCiAgICAgICAgZ3JvdXBzID0gY2hvcmRzLmdyb3VwcyA9IG5ldyBBcnJheShuKSwKICAgICAgICBzdWJncm91cHMgPSBuZXcgQXJyYXkobiAqIG4pLAogICAgICAgIGssCiAgICAgICAgeCwKICAgICAgICB4MCwKICAgICAgICBkeCwKICAgICAgICBpLAogICAgICAgIGo7CgogICAgLy8gQ29tcHV0ZSB0aGUgc3VtLgogICAgayA9IDAsIGkgPSAtMTsgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgeCA9IDAsIGogPSAtMTsgd2hpbGUgKCsraiA8IG4pIHsKICAgICAgICB4ICs9IG1hdHJpeFtpXVtqXTsKICAgICAgfQogICAgICBncm91cFN1bXMucHVzaCh4KTsKICAgICAgc3ViZ3JvdXBJbmRleC5wdXNoKHNlcXVlbmNlKG4pKTsKICAgICAgayArPSB4OwogICAgfQoKICAgIC8vIFNvcnQgZ3JvdXBz4oCmCiAgICBpZiAoc29ydEdyb3VwcykgZ3JvdXBJbmRleC5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgcmV0dXJuIHNvcnRHcm91cHMoZ3JvdXBTdW1zW2FdLCBncm91cFN1bXNbYl0pOwogICAgfSk7CgogICAgLy8gU29ydCBzdWJncm91cHPigKYKICAgIGlmIChzb3J0U3ViZ3JvdXBzKSBzdWJncm91cEluZGV4LmZvckVhY2goZnVuY3Rpb24oZCwgaSkgewogICAgICBkLnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgIHJldHVybiBzb3J0U3ViZ3JvdXBzKG1hdHJpeFtpXVthXSwgbWF0cml4W2ldW2JdKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICAvLyBDb252ZXJ0IHRoZSBzdW0gdG8gc2NhbGluZyBmYWN0b3IgZm9yIFswLCAycGldLgogICAgLy8gVE9ETyBBbGxvdyBzdGFydCBhbmQgZW5kIGFuZ2xlIHRvIGJlIHNwZWNpZmllZD8KICAgIC8vIFRPRE8gQWxsb3cgcGFkZGluZyB0byBiZSBzcGVjaWZpZWQgYXMgcGVyY2VudGFnZT8KICAgIGsgPSBtYXgkMSgwLCB0YXUkMSAtIHBhZEFuZ2xlICogbikgLyBrOwogICAgZHggPSBrID8gcGFkQW5nbGUgOiB0YXUkMSAvIG47CgogICAgLy8gQ29tcHV0ZSB0aGUgc3RhcnQgYW5kIGVuZCBhbmdsZSBmb3IgZWFjaCBncm91cCBhbmQgc3ViZ3JvdXAuCiAgICAvLyBOb3RlOiBPcGVyYSBoYXMgYSBidWcgcmVvcmRlcmluZyBvYmplY3QgbGl0ZXJhbCBwcm9wZXJ0aWVzIQogICAgeCA9IDAsIGkgPSAtMTsgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgeDAgPSB4LCBqID0gLTE7IHdoaWxlICgrK2ogPCBuKSB7CiAgICAgICAgdmFyIGRpID0gZ3JvdXBJbmRleFtpXSwKICAgICAgICAgICAgZGogPSBzdWJncm91cEluZGV4W2RpXVtqXSwKICAgICAgICAgICAgdiA9IG1hdHJpeFtkaV1bZGpdLAogICAgICAgICAgICBhMCA9IHgsCiAgICAgICAgICAgIGExID0geCArPSB2ICogazsKICAgICAgICBzdWJncm91cHNbZGogKiBuICsgZGldID0gewogICAgICAgICAgaW5kZXg6IGRpLAogICAgICAgICAgc3ViaW5kZXg6IGRqLAogICAgICAgICAgc3RhcnRBbmdsZTogYTAsCiAgICAgICAgICBlbmRBbmdsZTogYTEsCiAgICAgICAgICB2YWx1ZTogdgogICAgICAgIH07CiAgICAgIH0KICAgICAgZ3JvdXBzW2RpXSA9IHsKICAgICAgICBpbmRleDogZGksCiAgICAgICAgc3RhcnRBbmdsZTogeDAsCiAgICAgICAgZW5kQW5nbGU6IHgsCiAgICAgICAgdmFsdWU6IGdyb3VwU3Vtc1tkaV0KICAgICAgfTsKICAgICAgeCArPSBkeDsKICAgIH0KCiAgICAvLyBHZW5lcmF0ZSBjaG9yZHMgZm9yIGVhY2ggKG5vbi1lbXB0eSkgc3ViZ3JvdXAtc3ViZ3JvdXAgbGluay4KICAgIGkgPSAtMTsgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgaiA9IGkgLSAxOyB3aGlsZSAoKytqIDwgbikgewogICAgICAgIHZhciBzb3VyY2UgPSBzdWJncm91cHNbaiAqIG4gKyBpXSwKICAgICAgICAgICAgdGFyZ2V0ID0gc3ViZ3JvdXBzW2kgKiBuICsgal07CiAgICAgICAgaWYgKHNvdXJjZS52YWx1ZSB8fCB0YXJnZXQudmFsdWUpIHsKICAgICAgICAgIGNob3Jkcy5wdXNoKHNvdXJjZS52YWx1ZSA8IHRhcmdldC52YWx1ZQogICAgICAgICAgICAgID8ge3NvdXJjZTogdGFyZ2V0LCB0YXJnZXQ6IHNvdXJjZX0KICAgICAgICAgICAgICA6IHtzb3VyY2U6IHNvdXJjZSwgdGFyZ2V0OiB0YXJnZXR9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gc29ydENob3JkcyA/IGNob3Jkcy5zb3J0KHNvcnRDaG9yZHMpIDogY2hvcmRzOwogIH0KCiAgY2hvcmQucGFkQW5nbGUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChwYWRBbmdsZSA9IG1heCQxKDAsIF8pLCBjaG9yZCkgOiBwYWRBbmdsZTsKICB9OwoKICBjaG9yZC5zb3J0R3JvdXBzID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoc29ydEdyb3VwcyA9IF8sIGNob3JkKSA6IHNvcnRHcm91cHM7CiAgfTsKCiAgY2hvcmQuc29ydFN1Ymdyb3VwcyA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHNvcnRTdWJncm91cHMgPSBfLCBjaG9yZCkgOiBzb3J0U3ViZ3JvdXBzOwogIH07CgogIGNob3JkLnNvcnRDaG9yZHMgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChfID09IG51bGwgPyBzb3J0Q2hvcmRzID0gbnVsbCA6IChzb3J0Q2hvcmRzID0gY29tcGFyZVZhbHVlKF8pKS5fID0gXywgY2hvcmQpIDogc29ydENob3JkcyAmJiBzb3J0Q2hvcmRzLl87CiAgfTsKCiAgcmV0dXJuIGNob3JkOwp9Cgp2YXIgc2xpY2UkMiA9IEFycmF5LnByb3RvdHlwZS5zbGljZTsKCmZ1bmN0aW9uIGNvbnN0YW50JDUoeCkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB4OwogIH07Cn0KCnZhciBwaSQyID0gTWF0aC5QSSwKICAgIHRhdSQyID0gMiAqIHBpJDIsCiAgICBlcHNpbG9uJDEgPSAxZS02LAogICAgdGF1RXBzaWxvbiA9IHRhdSQyIC0gZXBzaWxvbiQxOwoKZnVuY3Rpb24gUGF0aCgpIHsKICB0aGlzLl94MCA9IHRoaXMuX3kwID0gLy8gc3RhcnQgb2YgY3VycmVudCBzdWJwYXRoCiAgdGhpcy5feDEgPSB0aGlzLl95MSA9IG51bGw7IC8vIGVuZCBvZiBjdXJyZW50IHN1YnBhdGgKICB0aGlzLl8gPSAiIjsKfQoKZnVuY3Rpb24gcGF0aCgpIHsKICByZXR1cm4gbmV3IFBhdGg7Cn0KClBhdGgucHJvdG90eXBlID0gcGF0aC5wcm90b3R5cGUgPSB7CiAgY29uc3RydWN0b3I6IFBhdGgsCiAgbW92ZVRvOiBmdW5jdGlvbih4LCB5KSB7CiAgICB0aGlzLl8gKz0gIk0iICsgKHRoaXMuX3gwID0gdGhpcy5feDEgPSAreCkgKyAiLCIgKyAodGhpcy5feTAgPSB0aGlzLl95MSA9ICt5KTsKICB9LAogIGNsb3NlUGF0aDogZnVuY3Rpb24oKSB7CiAgICBpZiAodGhpcy5feDEgIT09IG51bGwpIHsKICAgICAgdGhpcy5feDEgPSB0aGlzLl94MCwgdGhpcy5feTEgPSB0aGlzLl95MDsKICAgICAgdGhpcy5fICs9ICJaIjsKICAgIH0KICB9LAogIGxpbmVUbzogZnVuY3Rpb24oeCwgeSkgewogICAgdGhpcy5fICs9ICJMIiArICh0aGlzLl94MSA9ICt4KSArICIsIiArICh0aGlzLl95MSA9ICt5KTsKICB9LAogIHF1YWRyYXRpY0N1cnZlVG86IGZ1bmN0aW9uKHgxLCB5MSwgeCwgeSkgewogICAgdGhpcy5fICs9ICJRIiArICgreDEpICsgIiwiICsgKCt5MSkgKyAiLCIgKyAodGhpcy5feDEgPSAreCkgKyAiLCIgKyAodGhpcy5feTEgPSAreSk7CiAgfSwKICBiZXppZXJDdXJ2ZVRvOiBmdW5jdGlvbih4MSwgeTEsIHgyLCB5MiwgeCwgeSkgewogICAgdGhpcy5fICs9ICJDIiArICgreDEpICsgIiwiICsgKCt5MSkgKyAiLCIgKyAoK3gyKSArICIsIiArICgreTIpICsgIiwiICsgKHRoaXMuX3gxID0gK3gpICsgIiwiICsgKHRoaXMuX3kxID0gK3kpOwogIH0sCiAgYXJjVG86IGZ1bmN0aW9uKHgxLCB5MSwgeDIsIHkyLCByKSB7CiAgICB4MSA9ICt4MSwgeTEgPSAreTEsIHgyID0gK3gyLCB5MiA9ICt5MiwgciA9ICtyOwogICAgdmFyIHgwID0gdGhpcy5feDEsCiAgICAgICAgeTAgPSB0aGlzLl95MSwKICAgICAgICB4MjEgPSB4MiAtIHgxLAogICAgICAgIHkyMSA9IHkyIC0geTEsCiAgICAgICAgeDAxID0geDAgLSB4MSwKICAgICAgICB5MDEgPSB5MCAtIHkxLAogICAgICAgIGwwMV8yID0geDAxICogeDAxICsgeTAxICogeTAxOwoKICAgIC8vIElzIHRoZSByYWRpdXMgbmVnYXRpdmU/IEVycm9yLgogICAgaWYgKHIgPCAwKSB0aHJvdyBuZXcgRXJyb3IoIm5lZ2F0aXZlIHJhZGl1czogIiArIHIpOwoKICAgIC8vIElzIHRoaXMgcGF0aCBlbXB0eT8gTW92ZSB0byAoeDEseTEpLgogICAgaWYgKHRoaXMuX3gxID09PSBudWxsKSB7CiAgICAgIHRoaXMuXyArPSAiTSIgKyAodGhpcy5feDEgPSB4MSkgKyAiLCIgKyAodGhpcy5feTEgPSB5MSk7CiAgICB9CgogICAgLy8gT3IsIGlzICh4MSx5MSkgY29pbmNpZGVudCB3aXRoICh4MCx5MCk/IERvIG5vdGhpbmcuCiAgICBlbHNlIGlmICghKGwwMV8yID4gZXBzaWxvbiQxKSkge30KCiAgICAvLyBPciwgYXJlICh4MCx5MCksICh4MSx5MSkgYW5kICh4Mix5MikgY29sbGluZWFyPwogICAgLy8gRXF1aXZhbGVudGx5LCBpcyAoeDEseTEpIGNvaW5jaWRlbnQgd2l0aCAoeDIseTIpPwogICAgLy8gT3IsIGlzIHRoZSByYWRpdXMgemVybz8gTGluZSB0byAoeDEseTEpLgogICAgZWxzZSBpZiAoIShNYXRoLmFicyh5MDEgKiB4MjEgLSB5MjEgKiB4MDEpID4gZXBzaWxvbiQxKSB8fCAhcikgewogICAgICB0aGlzLl8gKz0gIkwiICsgKHRoaXMuX3gxID0geDEpICsgIiwiICsgKHRoaXMuX3kxID0geTEpOwogICAgfQoKICAgIC8vIE90aGVyd2lzZSwgZHJhdyBhbiBhcmMhCiAgICBlbHNlIHsKICAgICAgdmFyIHgyMCA9IHgyIC0geDAsCiAgICAgICAgICB5MjAgPSB5MiAtIHkwLAogICAgICAgICAgbDIxXzIgPSB4MjEgKiB4MjEgKyB5MjEgKiB5MjEsCiAgICAgICAgICBsMjBfMiA9IHgyMCAqIHgyMCArIHkyMCAqIHkyMCwKICAgICAgICAgIGwyMSA9IE1hdGguc3FydChsMjFfMiksCiAgICAgICAgICBsMDEgPSBNYXRoLnNxcnQobDAxXzIpLAogICAgICAgICAgbCA9IHIgKiBNYXRoLnRhbigocGkkMiAtIE1hdGguYWNvcygobDIxXzIgKyBsMDFfMiAtIGwyMF8yKSAvICgyICogbDIxICogbDAxKSkpIC8gMiksCiAgICAgICAgICB0MDEgPSBsIC8gbDAxLAogICAgICAgICAgdDIxID0gbCAvIGwyMTsKCiAgICAgIC8vIElmIHRoZSBzdGFydCB0YW5nZW50IGlzIG5vdCBjb2luY2lkZW50IHdpdGggKHgwLHkwKSwgbGluZSB0by4KICAgICAgaWYgKE1hdGguYWJzKHQwMSAtIDEpID4gZXBzaWxvbiQxKSB7CiAgICAgICAgdGhpcy5fICs9ICJMIiArICh4MSArIHQwMSAqIHgwMSkgKyAiLCIgKyAoeTEgKyB0MDEgKiB5MDEpOwogICAgICB9CgogICAgICB0aGlzLl8gKz0gIkEiICsgciArICIsIiArIHIgKyAiLDAsMCwiICsgKCsoeTAxICogeDIwID4geDAxICogeTIwKSkgKyAiLCIgKyAodGhpcy5feDEgPSB4MSArIHQyMSAqIHgyMSkgKyAiLCIgKyAodGhpcy5feTEgPSB5MSArIHQyMSAqIHkyMSk7CiAgICB9CiAgfSwKICBhcmM6IGZ1bmN0aW9uKHgsIHksIHIsIGEwLCBhMSwgY2N3KSB7CiAgICB4ID0gK3gsIHkgPSAreSwgciA9ICtyOwogICAgdmFyIGR4ID0gciAqIE1hdGguY29zKGEwKSwKICAgICAgICBkeSA9IHIgKiBNYXRoLnNpbihhMCksCiAgICAgICAgeDAgPSB4ICsgZHgsCiAgICAgICAgeTAgPSB5ICsgZHksCiAgICAgICAgY3cgPSAxIF4gY2N3LAogICAgICAgIGRhID0gY2N3ID8gYTAgLSBhMSA6IGExIC0gYTA7CgogICAgLy8gSXMgdGhlIHJhZGl1cyBuZWdhdGl2ZT8gRXJyb3IuCiAgICBpZiAociA8IDApIHRocm93IG5ldyBFcnJvcigibmVnYXRpdmUgcmFkaXVzOiAiICsgcik7CgogICAgLy8gSXMgdGhpcyBwYXRoIGVtcHR5PyBNb3ZlIHRvICh4MCx5MCkuCiAgICBpZiAodGhpcy5feDEgPT09IG51bGwpIHsKICAgICAgdGhpcy5fICs9ICJNIiArIHgwICsgIiwiICsgeTA7CiAgICB9CgogICAgLy8gT3IsIGlzICh4MCx5MCkgbm90IGNvaW5jaWRlbnQgd2l0aCB0aGUgcHJldmlvdXMgcG9pbnQ/IExpbmUgdG8gKHgwLHkwKS4KICAgIGVsc2UgaWYgKE1hdGguYWJzKHRoaXMuX3gxIC0geDApID4gZXBzaWxvbiQxIHx8IE1hdGguYWJzKHRoaXMuX3kxIC0geTApID4gZXBzaWxvbiQxKSB7CiAgICAgIHRoaXMuXyArPSAiTCIgKyB4MCArICIsIiArIHkwOwogICAgfQoKICAgIC8vIElzIHRoaXMgYXJjIGVtcHR5PyBXZeKAmXJlIGRvbmUuCiAgICBpZiAoIXIpIHJldHVybjsKCiAgICAvLyBEb2VzIHRoZSBhbmdsZSBnbyB0aGUgd3Jvbmcgd2F5PyBGbGlwIHRoZSBkaXJlY3Rpb24uCiAgICBpZiAoZGEgPCAwKSBkYSA9IGRhICUgdGF1JDIgKyB0YXUkMjsKCiAgICAvLyBJcyB0aGlzIGEgY29tcGxldGUgY2lyY2xlPyBEcmF3IHR3byBhcmNzIHRvIGNvbXBsZXRlIHRoZSBjaXJjbGUuCiAgICBpZiAoZGEgPiB0YXVFcHNpbG9uKSB7CiAgICAgIHRoaXMuXyArPSAiQSIgKyByICsgIiwiICsgciArICIsMCwxLCIgKyBjdyArICIsIiArICh4IC0gZHgpICsgIiwiICsgKHkgLSBkeSkgKyAiQSIgKyByICsgIiwiICsgciArICIsMCwxLCIgKyBjdyArICIsIiArICh0aGlzLl94MSA9IHgwKSArICIsIiArICh0aGlzLl95MSA9IHkwKTsKICAgIH0KCiAgICAvLyBJcyB0aGlzIGFyYyBub24tZW1wdHk/IERyYXcgYW4gYXJjIQogICAgZWxzZSBpZiAoZGEgPiBlcHNpbG9uJDEpIHsKICAgICAgdGhpcy5fICs9ICJBIiArIHIgKyAiLCIgKyByICsgIiwwLCIgKyAoKyhkYSA+PSBwaSQyKSkgKyAiLCIgKyBjdyArICIsIiArICh0aGlzLl94MSA9IHggKyByICogTWF0aC5jb3MoYTEpKSArICIsIiArICh0aGlzLl95MSA9IHkgKyByICogTWF0aC5zaW4oYTEpKTsKICAgIH0KICB9LAogIHJlY3Q6IGZ1bmN0aW9uKHgsIHksIHcsIGgpIHsKICAgIHRoaXMuXyArPSAiTSIgKyAodGhpcy5feDAgPSB0aGlzLl94MSA9ICt4KSArICIsIiArICh0aGlzLl95MCA9IHRoaXMuX3kxID0gK3kpICsgImgiICsgKCt3KSArICJ2IiArICgraCkgKyAiaCIgKyAoLXcpICsgIloiOwogIH0sCiAgdG9TdHJpbmc6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuXzsKICB9Cn07CgpmdW5jdGlvbiBkZWZhdWx0U291cmNlKGQpIHsKICByZXR1cm4gZC5zb3VyY2U7Cn0KCmZ1bmN0aW9uIGRlZmF1bHRUYXJnZXQoZCkgewogIHJldHVybiBkLnRhcmdldDsKfQoKZnVuY3Rpb24gZGVmYXVsdFJhZGl1cyhkKSB7CiAgcmV0dXJuIGQucmFkaXVzOwp9CgpmdW5jdGlvbiBkZWZhdWx0U3RhcnRBbmdsZShkKSB7CiAgcmV0dXJuIGQuc3RhcnRBbmdsZTsKfQoKZnVuY3Rpb24gZGVmYXVsdEVuZEFuZ2xlKGQpIHsKICByZXR1cm4gZC5lbmRBbmdsZTsKfQoKZnVuY3Rpb24gcmliYm9uKCkgewogIHZhciBzb3VyY2UgPSBkZWZhdWx0U291cmNlLAogICAgICB0YXJnZXQgPSBkZWZhdWx0VGFyZ2V0LAogICAgICByYWRpdXMgPSBkZWZhdWx0UmFkaXVzLAogICAgICBzdGFydEFuZ2xlID0gZGVmYXVsdFN0YXJ0QW5nbGUsCiAgICAgIGVuZEFuZ2xlID0gZGVmYXVsdEVuZEFuZ2xlLAogICAgICBjb250ZXh0ID0gbnVsbDsKCiAgZnVuY3Rpb24gcmliYm9uKCkgewogICAgdmFyIGJ1ZmZlciwKICAgICAgICBhcmd2ID0gc2xpY2UkMi5jYWxsKGFyZ3VtZW50cyksCiAgICAgICAgcyA9IHNvdXJjZS5hcHBseSh0aGlzLCBhcmd2KSwKICAgICAgICB0ID0gdGFyZ2V0LmFwcGx5KHRoaXMsIGFyZ3YpLAogICAgICAgIHNyID0gK3JhZGl1cy5hcHBseSh0aGlzLCAoYXJndlswXSA9IHMsIGFyZ3YpKSwKICAgICAgICBzYTAgPSBzdGFydEFuZ2xlLmFwcGx5KHRoaXMsIGFyZ3YpIC0gaGFsZlBpJDEsCiAgICAgICAgc2ExID0gZW5kQW5nbGUuYXBwbHkodGhpcywgYXJndikgLSBoYWxmUGkkMSwKICAgICAgICBzeDAgPSBzciAqIGNvcyhzYTApLAogICAgICAgIHN5MCA9IHNyICogc2luKHNhMCksCiAgICAgICAgdHIgPSArcmFkaXVzLmFwcGx5KHRoaXMsIChhcmd2WzBdID0gdCwgYXJndikpLAogICAgICAgIHRhMCA9IHN0YXJ0QW5nbGUuYXBwbHkodGhpcywgYXJndikgLSBoYWxmUGkkMSwKICAgICAgICB0YTEgPSBlbmRBbmdsZS5hcHBseSh0aGlzLCBhcmd2KSAtIGhhbGZQaSQxOwoKICAgIGlmICghY29udGV4dCkgY29udGV4dCA9IGJ1ZmZlciA9IHBhdGgoKTsKCiAgICBjb250ZXh0Lm1vdmVUbyhzeDAsIHN5MCk7CiAgICBjb250ZXh0LmFyYygwLCAwLCBzciwgc2EwLCBzYTEpOwogICAgaWYgKHNhMCAhPT0gdGEwIHx8IHNhMSAhPT0gdGExKSB7IC8vIFRPRE8gc3IgIT09IHRyPwogICAgICBjb250ZXh0LnF1YWRyYXRpY0N1cnZlVG8oMCwgMCwgdHIgKiBjb3ModGEwKSwgdHIgKiBzaW4odGEwKSk7CiAgICAgIGNvbnRleHQuYXJjKDAsIDAsIHRyLCB0YTAsIHRhMSk7CiAgICB9CiAgICBjb250ZXh0LnF1YWRyYXRpY0N1cnZlVG8oMCwgMCwgc3gwLCBzeTApOwogICAgY29udGV4dC5jbG9zZVBhdGgoKTsKCiAgICBpZiAoYnVmZmVyKSByZXR1cm4gY29udGV4dCA9IG51bGwsIGJ1ZmZlciArICIiIHx8IG51bGw7CiAgfQoKICByaWJib24ucmFkaXVzID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocmFkaXVzID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkNSgrXyksIHJpYmJvbikgOiByYWRpdXM7CiAgfTsKCiAgcmliYm9uLnN0YXJ0QW5nbGUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChzdGFydEFuZ2xlID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkNSgrXyksIHJpYmJvbikgOiBzdGFydEFuZ2xlOwogIH07CgogIHJpYmJvbi5lbmRBbmdsZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGVuZEFuZ2xlID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkNSgrXyksIHJpYmJvbikgOiBlbmRBbmdsZTsKICB9OwoKICByaWJib24uc291cmNlID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoc291cmNlID0gXywgcmliYm9uKSA6IHNvdXJjZTsKICB9OwoKICByaWJib24udGFyZ2V0ID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodGFyZ2V0ID0gXywgcmliYm9uKSA6IHRhcmdldDsKICB9OwoKICByaWJib24uY29udGV4dCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGNvbnRleHQgPSBfID09IG51bGwgPyBudWxsIDogXywgcmliYm9uKSA6IGNvbnRleHQ7CiAgfTsKCiAgcmV0dXJuIHJpYmJvbjsKfQoKdmFyIHByZWZpeCA9ICIkIjsKCmZ1bmN0aW9uIE1hcCgpIHt9CgpNYXAucHJvdG90eXBlID0gbWFwJDEucHJvdG90eXBlID0gewogIGNvbnN0cnVjdG9yOiBNYXAsCiAgaGFzOiBmdW5jdGlvbihrZXkpIHsKICAgIHJldHVybiAocHJlZml4ICsga2V5KSBpbiB0aGlzOwogIH0sCiAgZ2V0OiBmdW5jdGlvbihrZXkpIHsKICAgIHJldHVybiB0aGlzW3ByZWZpeCArIGtleV07CiAgfSwKICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgIHRoaXNbcHJlZml4ICsga2V5XSA9IHZhbHVlOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICByZW1vdmU6IGZ1bmN0aW9uKGtleSkgewogICAgdmFyIHByb3BlcnR5ID0gcHJlZml4ICsga2V5OwogICAgcmV0dXJuIHByb3BlcnR5IGluIHRoaXMgJiYgZGVsZXRlIHRoaXNbcHJvcGVydHldOwogIH0sCiAgY2xlYXI6IGZ1bmN0aW9uKCkgewogICAgZm9yICh2YXIgcHJvcGVydHkgaW4gdGhpcykgaWYgKHByb3BlcnR5WzBdID09PSBwcmVmaXgpIGRlbGV0ZSB0aGlzW3Byb3BlcnR5XTsKICB9LAogIGtleXM6IGZ1bmN0aW9uKCkgewogICAgdmFyIGtleXMgPSBbXTsKICAgIGZvciAodmFyIHByb3BlcnR5IGluIHRoaXMpIGlmIChwcm9wZXJ0eVswXSA9PT0gcHJlZml4KSBrZXlzLnB1c2gocHJvcGVydHkuc2xpY2UoMSkpOwogICAgcmV0dXJuIGtleXM7CiAgfSwKICB2YWx1ZXM6IGZ1bmN0aW9uKCkgewogICAgdmFyIHZhbHVlcyA9IFtdOwogICAgZm9yICh2YXIgcHJvcGVydHkgaW4gdGhpcykgaWYgKHByb3BlcnR5WzBdID09PSBwcmVmaXgpIHZhbHVlcy5wdXNoKHRoaXNbcHJvcGVydHldKTsKICAgIHJldHVybiB2YWx1ZXM7CiAgfSwKICBlbnRyaWVzOiBmdW5jdGlvbigpIHsKICAgIHZhciBlbnRyaWVzID0gW107CiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiB0aGlzKSBpZiAocHJvcGVydHlbMF0gPT09IHByZWZpeCkgZW50cmllcy5wdXNoKHtrZXk6IHByb3BlcnR5LnNsaWNlKDEpLCB2YWx1ZTogdGhpc1twcm9wZXJ0eV19KTsKICAgIHJldHVybiBlbnRyaWVzOwogIH0sCiAgc2l6ZTogZnVuY3Rpb24oKSB7CiAgICB2YXIgc2l6ZSA9IDA7CiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiB0aGlzKSBpZiAocHJvcGVydHlbMF0gPT09IHByZWZpeCkgKytzaXplOwogICAgcmV0dXJuIHNpemU7CiAgfSwKICBlbXB0eTogZnVuY3Rpb24oKSB7CiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiB0aGlzKSBpZiAocHJvcGVydHlbMF0gPT09IHByZWZpeCkgcmV0dXJuIGZhbHNlOwogICAgcmV0dXJuIHRydWU7CiAgfSwKICBlYWNoOiBmdW5jdGlvbihmKSB7CiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiB0aGlzKSBpZiAocHJvcGVydHlbMF0gPT09IHByZWZpeCkgZih0aGlzW3Byb3BlcnR5XSwgcHJvcGVydHkuc2xpY2UoMSksIHRoaXMpOwogIH0KfTsKCmZ1bmN0aW9uIG1hcCQxKG9iamVjdCwgZikgewogIHZhciBtYXAgPSBuZXcgTWFwOwoKICAvLyBDb3B5IGNvbnN0cnVjdG9yLgogIGlmIChvYmplY3QgaW5zdGFuY2VvZiBNYXApIG9iamVjdC5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHsgbWFwLnNldChrZXksIHZhbHVlKTsgfSk7CgogIC8vIEluZGV4IGFycmF5IGJ5IG51bWVyaWMgaW5kZXggb3Igc3BlY2lmaWVkIGtleSBmdW5jdGlvbi4KICBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iamVjdCkpIHsKICAgIHZhciBpID0gLTEsCiAgICAgICAgbiA9IG9iamVjdC5sZW5ndGgsCiAgICAgICAgbzsKCiAgICBpZiAoZiA9PSBudWxsKSB3aGlsZSAoKytpIDwgbikgbWFwLnNldChpLCBvYmplY3RbaV0pOwogICAgZWxzZSB3aGlsZSAoKytpIDwgbikgbWFwLnNldChmKG8gPSBvYmplY3RbaV0sIGksIG9iamVjdCksIG8pOwogIH0KCiAgLy8gQ29udmVydCBvYmplY3QgdG8gbWFwLgogIGVsc2UgaWYgKG9iamVjdCkgZm9yICh2YXIga2V5IGluIG9iamVjdCkgbWFwLnNldChrZXksIG9iamVjdFtrZXldKTsKCiAgcmV0dXJuIG1hcDsKfQoKZnVuY3Rpb24gbmVzdCgpIHsKICB2YXIga2V5cyA9IFtdLAogICAgICBzb3J0S2V5cyA9IFtdLAogICAgICBzb3J0VmFsdWVzLAogICAgICByb2xsdXAsCiAgICAgIG5lc3Q7CgogIGZ1bmN0aW9uIGFwcGx5KGFycmF5LCBkZXB0aCwgY3JlYXRlUmVzdWx0LCBzZXRSZXN1bHQpIHsKICAgIGlmIChkZXB0aCA+PSBrZXlzLmxlbmd0aCkgewogICAgICBpZiAoc29ydFZhbHVlcyAhPSBudWxsKSBhcnJheS5zb3J0KHNvcnRWYWx1ZXMpOwogICAgICByZXR1cm4gcm9sbHVwICE9IG51bGwgPyByb2xsdXAoYXJyYXkpIDogYXJyYXk7CiAgICB9CgogICAgdmFyIGkgPSAtMSwKICAgICAgICBuID0gYXJyYXkubGVuZ3RoLAogICAgICAgIGtleSA9IGtleXNbZGVwdGgrK10sCiAgICAgICAga2V5VmFsdWUsCiAgICAgICAgdmFsdWUsCiAgICAgICAgdmFsdWVzQnlLZXkgPSBtYXAkMSgpLAogICAgICAgIHZhbHVlcywKICAgICAgICByZXN1bHQgPSBjcmVhdGVSZXN1bHQoKTsKCiAgICB3aGlsZSAoKytpIDwgbikgewogICAgICBpZiAodmFsdWVzID0gdmFsdWVzQnlLZXkuZ2V0KGtleVZhbHVlID0ga2V5KHZhbHVlID0gYXJyYXlbaV0pICsgIiIpKSB7CiAgICAgICAgdmFsdWVzLnB1c2godmFsdWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhbHVlc0J5S2V5LnNldChrZXlWYWx1ZSwgW3ZhbHVlXSk7CiAgICAgIH0KICAgIH0KCiAgICB2YWx1ZXNCeUtleS5lYWNoKGZ1bmN0aW9uKHZhbHVlcywga2V5KSB7CiAgICAgIHNldFJlc3VsdChyZXN1bHQsIGtleSwgYXBwbHkodmFsdWVzLCBkZXB0aCwgY3JlYXRlUmVzdWx0LCBzZXRSZXN1bHQpKTsKICAgIH0pOwoKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICBmdW5jdGlvbiBlbnRyaWVzKG1hcCwgZGVwdGgpIHsKICAgIGlmICgrK2RlcHRoID4ga2V5cy5sZW5ndGgpIHJldHVybiBtYXA7CiAgICB2YXIgYXJyYXksIHNvcnRLZXkgPSBzb3J0S2V5c1tkZXB0aCAtIDFdOwogICAgaWYgKHJvbGx1cCAhPSBudWxsICYmIGRlcHRoID49IGtleXMubGVuZ3RoKSBhcnJheSA9IG1hcC5lbnRyaWVzKCk7CiAgICBlbHNlIGFycmF5ID0gW10sIG1hcC5lYWNoKGZ1bmN0aW9uKHYsIGspIHsgYXJyYXkucHVzaCh7a2V5OiBrLCB2YWx1ZXM6IGVudHJpZXModiwgZGVwdGgpfSk7IH0pOwogICAgcmV0dXJuIHNvcnRLZXkgIT0gbnVsbCA/IGFycmF5LnNvcnQoZnVuY3Rpb24oYSwgYikgeyByZXR1cm4gc29ydEtleShhLmtleSwgYi5rZXkpOyB9KSA6IGFycmF5OwogIH0KCiAgcmV0dXJuIG5lc3QgPSB7CiAgICBvYmplY3Q6IGZ1bmN0aW9uKGFycmF5KSB7IHJldHVybiBhcHBseShhcnJheSwgMCwgY3JlYXRlT2JqZWN0LCBzZXRPYmplY3QpOyB9LAogICAgbWFwOiBmdW5jdGlvbihhcnJheSkgeyByZXR1cm4gYXBwbHkoYXJyYXksIDAsIGNyZWF0ZU1hcCwgc2V0TWFwKTsgfSwKICAgIGVudHJpZXM6IGZ1bmN0aW9uKGFycmF5KSB7IHJldHVybiBlbnRyaWVzKGFwcGx5KGFycmF5LCAwLCBjcmVhdGVNYXAsIHNldE1hcCksIDApOyB9LAogICAga2V5OiBmdW5jdGlvbihkKSB7IGtleXMucHVzaChkKTsgcmV0dXJuIG5lc3Q7IH0sCiAgICBzb3J0S2V5czogZnVuY3Rpb24ob3JkZXIpIHsgc29ydEtleXNba2V5cy5sZW5ndGggLSAxXSA9IG9yZGVyOyByZXR1cm4gbmVzdDsgfSwKICAgIHNvcnRWYWx1ZXM6IGZ1bmN0aW9uKG9yZGVyKSB7IHNvcnRWYWx1ZXMgPSBvcmRlcjsgcmV0dXJuIG5lc3Q7IH0sCiAgICByb2xsdXA6IGZ1bmN0aW9uKGYpIHsgcm9sbHVwID0gZjsgcmV0dXJuIG5lc3Q7IH0KICB9Owp9CgpmdW5jdGlvbiBjcmVhdGVPYmplY3QoKSB7CiAgcmV0dXJuIHt9Owp9CgpmdW5jdGlvbiBzZXRPYmplY3Qob2JqZWN0LCBrZXksIHZhbHVlKSB7CiAgb2JqZWN0W2tleV0gPSB2YWx1ZTsKfQoKZnVuY3Rpb24gY3JlYXRlTWFwKCkgewogIHJldHVybiBtYXAkMSgpOwp9CgpmdW5jdGlvbiBzZXRNYXAobWFwLCBrZXksIHZhbHVlKSB7CiAgbWFwLnNldChrZXksIHZhbHVlKTsKfQoKZnVuY3Rpb24gU2V0KCkge30KCnZhciBwcm90byA9IG1hcCQxLnByb3RvdHlwZTsKClNldC5wcm90b3R5cGUgPSBzZXQkMi5wcm90b3R5cGUgPSB7CiAgY29uc3RydWN0b3I6IFNldCwKICBoYXM6IHByb3RvLmhhcywKICBhZGQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICB2YWx1ZSArPSAiIjsKICAgIHRoaXNbcHJlZml4ICsgdmFsdWVdID0gdmFsdWU7CiAgICByZXR1cm4gdGhpczsKICB9LAogIHJlbW92ZTogcHJvdG8ucmVtb3ZlLAogIGNsZWFyOiBwcm90by5jbGVhciwKICB2YWx1ZXM6IHByb3RvLmtleXMsCiAgc2l6ZTogcHJvdG8uc2l6ZSwKICBlbXB0eTogcHJvdG8uZW1wdHksCiAgZWFjaDogcHJvdG8uZWFjaAp9OwoKZnVuY3Rpb24gc2V0JDIob2JqZWN0LCBmKSB7CiAgdmFyIHNldCA9IG5ldyBTZXQ7CgogIC8vIENvcHkgY29uc3RydWN0b3IuCiAgaWYgKG9iamVjdCBpbnN0YW5jZW9mIFNldCkgb2JqZWN0LmVhY2goZnVuY3Rpb24odmFsdWUpIHsgc2V0LmFkZCh2YWx1ZSk7IH0pOwoKICAvLyBPdGhlcndpc2UsIGFzc3VtZSBpdOKAmXMgYW4gYXJyYXkuCiAgZWxzZSBpZiAob2JqZWN0KSB7CiAgICB2YXIgaSA9IC0xLCBuID0gb2JqZWN0Lmxlbmd0aDsKICAgIGlmIChmID09IG51bGwpIHdoaWxlICgrK2kgPCBuKSBzZXQuYWRkKG9iamVjdFtpXSk7CiAgICBlbHNlIHdoaWxlICgrK2kgPCBuKSBzZXQuYWRkKGYob2JqZWN0W2ldLCBpLCBvYmplY3QpKTsKICB9CgogIHJldHVybiBzZXQ7Cn0KCmZ1bmN0aW9uIGtleXMobWFwKSB7CiAgdmFyIGtleXMgPSBbXTsKICBmb3IgKHZhciBrZXkgaW4gbWFwKSBrZXlzLnB1c2goa2V5KTsKICByZXR1cm4ga2V5czsKfQoKZnVuY3Rpb24gdmFsdWVzKG1hcCkgewogIHZhciB2YWx1ZXMgPSBbXTsKICBmb3IgKHZhciBrZXkgaW4gbWFwKSB2YWx1ZXMucHVzaChtYXBba2V5XSk7CiAgcmV0dXJuIHZhbHVlczsKfQoKZnVuY3Rpb24gZW50cmllcyhtYXApIHsKICB2YXIgZW50cmllcyA9IFtdOwogIGZvciAodmFyIGtleSBpbiBtYXApIGVudHJpZXMucHVzaCh7a2V5OiBrZXksIHZhbHVlOiBtYXBba2V5XX0pOwogIHJldHVybiBlbnRyaWVzOwp9Cgp2YXIgYXJyYXkkMiA9IEFycmF5LnByb3RvdHlwZTsKCnZhciBzbGljZSQzID0gYXJyYXkkMi5zbGljZTsKCmZ1bmN0aW9uIGFzY2VuZGluZyQyKGEsIGIpIHsKICByZXR1cm4gYSAtIGI7Cn0KCmZ1bmN0aW9uIGFyZWEocmluZykgewogIHZhciBpID0gMCwgbiA9IHJpbmcubGVuZ3RoLCBhcmVhID0gcmluZ1tuIC0gMV1bMV0gKiByaW5nWzBdWzBdIC0gcmluZ1tuIC0gMV1bMF0gKiByaW5nWzBdWzFdOwogIHdoaWxlICgrK2kgPCBuKSBhcmVhICs9IHJpbmdbaSAtIDFdWzFdICogcmluZ1tpXVswXSAtIHJpbmdbaSAtIDFdWzBdICogcmluZ1tpXVsxXTsKICByZXR1cm4gYXJlYTsKfQoKZnVuY3Rpb24gY29uc3RhbnQkNih4KSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHg7CiAgfTsKfQoKZnVuY3Rpb24gY29udGFpbnMocmluZywgaG9sZSkgewogIHZhciBpID0gLTEsIG4gPSBob2xlLmxlbmd0aCwgYzsKICB3aGlsZSAoKytpIDwgbikgaWYgKGMgPSByaW5nQ29udGFpbnMocmluZywgaG9sZVtpXSkpIHJldHVybiBjOwogIHJldHVybiAwOwp9CgpmdW5jdGlvbiByaW5nQ29udGFpbnMocmluZywgcG9pbnQpIHsKICB2YXIgeCA9IHBvaW50WzBdLCB5ID0gcG9pbnRbMV0sIGNvbnRhaW5zID0gLTE7CiAgZm9yICh2YXIgaSA9IDAsIG4gPSByaW5nLmxlbmd0aCwgaiA9IG4gLSAxOyBpIDwgbjsgaiA9IGkrKykgewogICAgdmFyIHBpID0gcmluZ1tpXSwgeGkgPSBwaVswXSwgeWkgPSBwaVsxXSwgcGogPSByaW5nW2pdLCB4aiA9IHBqWzBdLCB5aiA9IHBqWzFdOwogICAgaWYgKHNlZ21lbnRDb250YWlucyhwaSwgcGosIHBvaW50KSkgcmV0dXJuIDA7CiAgICBpZiAoKCh5aSA+IHkpICE9PSAoeWogPiB5KSkgJiYgKCh4IDwgKHhqIC0geGkpICogKHkgLSB5aSkgLyAoeWogLSB5aSkgKyB4aSkpKSBjb250YWlucyA9IC1jb250YWluczsKICB9CiAgcmV0dXJuIGNvbnRhaW5zOwp9CgpmdW5jdGlvbiBzZWdtZW50Q29udGFpbnMoYSwgYiwgYykgewogIHZhciBpOyByZXR1cm4gY29sbGluZWFyKGEsIGIsIGMpICYmIHdpdGhpbihhW2kgPSArKGFbMF0gPT09IGJbMF0pXSwgY1tpXSwgYltpXSk7Cn0KCmZ1bmN0aW9uIGNvbGxpbmVhcihhLCBiLCBjKSB7CiAgcmV0dXJuIChiWzBdIC0gYVswXSkgKiAoY1sxXSAtIGFbMV0pID09PSAoY1swXSAtIGFbMF0pICogKGJbMV0gLSBhWzFdKTsKfQoKZnVuY3Rpb24gd2l0aGluKHAsIHEsIHIpIHsKICByZXR1cm4gcCA8PSBxICYmIHEgPD0gciB8fCByIDw9IHEgJiYgcSA8PSBwOwp9CgpmdW5jdGlvbiBub29wJDEoKSB7fQoKdmFyIGNhc2VzID0gWwogIFtdLAogIFtbWzEuMCwgMS41XSwgWzAuNSwgMS4wXV1dLAogIFtbWzEuNSwgMS4wXSwgWzEuMCwgMS41XV1dLAogIFtbWzEuNSwgMS4wXSwgWzAuNSwgMS4wXV1dLAogIFtbWzEuMCwgMC41XSwgWzEuNSwgMS4wXV1dLAogIFtbWzEuMCwgMS41XSwgWzAuNSwgMS4wXV0sIFtbMS4wLCAwLjVdLCBbMS41LCAxLjBdXV0sCiAgW1tbMS4wLCAwLjVdLCBbMS4wLCAxLjVdXV0sCiAgW1tbMS4wLCAwLjVdLCBbMC41LCAxLjBdXV0sCiAgW1tbMC41LCAxLjBdLCBbMS4wLCAwLjVdXV0sCiAgW1tbMS4wLCAxLjVdLCBbMS4wLCAwLjVdXV0sCiAgW1tbMC41LCAxLjBdLCBbMS4wLCAwLjVdXSwgW1sxLjUsIDEuMF0sIFsxLjAsIDEuNV1dXSwKICBbW1sxLjUsIDEuMF0sIFsxLjAsIDAuNV1dXSwKICBbW1swLjUsIDEuMF0sIFsxLjUsIDEuMF1dXSwKICBbW1sxLjAsIDEuNV0sIFsxLjUsIDEuMF1dXSwKICBbW1swLjUsIDEuMF0sIFsxLjAsIDEuNV1dXSwKICBbXQpdOwoKZnVuY3Rpb24gY29udG91cnMoKSB7CiAgdmFyIGR4ID0gMSwKICAgICAgZHkgPSAxLAogICAgICB0aHJlc2hvbGQkJDEgPSB0aHJlc2hvbGRTdHVyZ2VzLAogICAgICBzbW9vdGggPSBzbW9vdGhMaW5lYXI7CgogIGZ1bmN0aW9uIGNvbnRvdXJzKHZhbHVlcykgewogICAgdmFyIHR6ID0gdGhyZXNob2xkJCQxKHZhbHVlcyk7CgogICAgLy8gQ29udmVydCBudW1iZXIgb2YgdGhyZXNob2xkcyBpbnRvIHVuaWZvcm0gdGhyZXNob2xkcy4KICAgIGlmICghQXJyYXkuaXNBcnJheSh0eikpIHsKICAgICAgdmFyIGRvbWFpbiA9IGV4dGVudCh2YWx1ZXMpLCBzdGFydCA9IGRvbWFpblswXSwgc3RvcCA9IGRvbWFpblsxXTsKICAgICAgdHogPSB0aWNrU3RlcChzdGFydCwgc3RvcCwgdHopOwogICAgICB0eiA9IHNlcXVlbmNlKE1hdGguZmxvb3Ioc3RhcnQgLyB0eikgKiB0eiwgTWF0aC5mbG9vcihzdG9wIC8gdHopICogdHosIHR6KTsKICAgIH0gZWxzZSB7CiAgICAgIHR6ID0gdHouc2xpY2UoKS5zb3J0KGFzY2VuZGluZyQyKTsKICAgIH0KCiAgICByZXR1cm4gdHoubWFwKGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiBjb250b3VyKHZhbHVlcywgdmFsdWUpOwogICAgfSk7CiAgfQoKICAvLyBBY2N1bXVsYXRlLCBzbW9vdGggY29udG91ciByaW5ncywgYXNzaWduIGhvbGVzIHRvIGV4dGVyaW9yIHJpbmdzLgogIC8vIEJhc2VkIG9uIGh0dHBzOi8vZ2l0aHViLmNvbS9tYm9zdG9jay9zaGFwZWZpbGUvYmxvYi92MC42LjIvc2hwL3BvbHlnb24uanMKICBmdW5jdGlvbiBjb250b3VyKHZhbHVlcywgdmFsdWUpIHsKICAgIHZhciBwb2x5Z29ucyA9IFtdLAogICAgICAgIGhvbGVzID0gW107CgogICAgaXNvcmluZ3ModmFsdWVzLCB2YWx1ZSwgZnVuY3Rpb24ocmluZykgewogICAgICBzbW9vdGgocmluZywgdmFsdWVzLCB2YWx1ZSk7CiAgICAgIGlmIChhcmVhKHJpbmcpID4gMCkgcG9seWdvbnMucHVzaChbcmluZ10pOwogICAgICBlbHNlIGhvbGVzLnB1c2gocmluZyk7CiAgICB9KTsKCiAgICBob2xlcy5mb3JFYWNoKGZ1bmN0aW9uKGhvbGUpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBwb2x5Z29ucy5sZW5ndGgsIHBvbHlnb247IGkgPCBuOyArK2kpIHsKICAgICAgICBpZiAoY29udGFpbnMoKHBvbHlnb24gPSBwb2x5Z29uc1tpXSlbMF0sIGhvbGUpICE9PSAtMSkgewogICAgICAgICAgcG9seWdvbi5wdXNoKGhvbGUpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIHsKICAgICAgdHlwZTogIk11bHRpUG9seWdvbiIsCiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgY29vcmRpbmF0ZXM6IHBvbHlnb25zCiAgICB9OwogIH0KCiAgLy8gTWFyY2hpbmcgc3F1YXJlcyB3aXRoIGlzb2xpbmVzIHN0aXRjaGVkIGludG8gcmluZ3MuCiAgLy8gQmFzZWQgb24gaHR0cHM6Ly9naXRodWIuY29tL3RvcG9qc29uL3RvcG9qc29uLWNsaWVudC9ibG9iL3YzLjAuMC9zcmMvc3RpdGNoLmpzCiAgZnVuY3Rpb24gaXNvcmluZ3ModmFsdWVzLCB2YWx1ZSwgY2FsbGJhY2spIHsKICAgIHZhciBmcmFnbWVudEJ5U3RhcnQgPSBuZXcgQXJyYXksCiAgICAgICAgZnJhZ21lbnRCeUVuZCA9IG5ldyBBcnJheSwKICAgICAgICB4LCB5LCB0MCwgdDEsIHQyLCB0MzsKCiAgICAvLyBTcGVjaWFsIGNhc2UgZm9yIHRoZSBmaXJzdCByb3cgKHkgPSAtMSwgdDIgPSB0MyA9IDApLgogICAgeCA9IHkgPSAtMTsKICAgIHQxID0gdmFsdWVzWzBdID49IHZhbHVlOwogICAgY2FzZXNbdDEgPDwgMV0uZm9yRWFjaChzdGl0Y2gpOwogICAgd2hpbGUgKCsreCA8IGR4IC0gMSkgewogICAgICB0MCA9IHQxLCB0MSA9IHZhbHVlc1t4ICsgMV0gPj0gdmFsdWU7CiAgICAgIGNhc2VzW3QwIHwgdDEgPDwgMV0uZm9yRWFjaChzdGl0Y2gpOwogICAgfQogICAgY2FzZXNbdDEgPDwgMF0uZm9yRWFjaChzdGl0Y2gpOwoKICAgIC8vIEdlbmVyYWwgY2FzZSBmb3IgdGhlIGludGVybWVkaWF0ZSByb3dzLgogICAgd2hpbGUgKCsreSA8IGR5IC0gMSkgewogICAgICB4ID0gLTE7CiAgICAgIHQxID0gdmFsdWVzW3kgKiBkeCArIGR4XSA+PSB2YWx1ZTsKICAgICAgdDIgPSB2YWx1ZXNbeSAqIGR4XSA+PSB2YWx1ZTsKICAgICAgY2FzZXNbdDEgPDwgMSB8IHQyIDw8IDJdLmZvckVhY2goc3RpdGNoKTsKICAgICAgd2hpbGUgKCsreCA8IGR4IC0gMSkgewogICAgICAgIHQwID0gdDEsIHQxID0gdmFsdWVzW3kgKiBkeCArIGR4ICsgeCArIDFdID49IHZhbHVlOwogICAgICAgIHQzID0gdDIsIHQyID0gdmFsdWVzW3kgKiBkeCArIHggKyAxXSA+PSB2YWx1ZTsKICAgICAgICBjYXNlc1t0MCB8IHQxIDw8IDEgfCB0MiA8PCAyIHwgdDMgPDwgM10uZm9yRWFjaChzdGl0Y2gpOwogICAgICB9CiAgICAgIGNhc2VzW3QxIHwgdDIgPDwgM10uZm9yRWFjaChzdGl0Y2gpOwogICAgfQoKICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgdGhlIGxhc3Qgcm93ICh5ID0gZHkgLSAxLCB0MCA9IHQxID0gMCkuCiAgICB4ID0gLTE7CiAgICB0MiA9IHZhbHVlc1t5ICogZHhdID49IHZhbHVlOwogICAgY2FzZXNbdDIgPDwgMl0uZm9yRWFjaChzdGl0Y2gpOwogICAgd2hpbGUgKCsreCA8IGR4IC0gMSkgewogICAgICB0MyA9IHQyLCB0MiA9IHZhbHVlc1t5ICogZHggKyB4ICsgMV0gPj0gdmFsdWU7CiAgICAgIGNhc2VzW3QyIDw8IDIgfCB0MyA8PCAzXS5mb3JFYWNoKHN0aXRjaCk7CiAgICB9CiAgICBjYXNlc1t0MiA8PCAzXS5mb3JFYWNoKHN0aXRjaCk7CgogICAgZnVuY3Rpb24gc3RpdGNoKGxpbmUpIHsKICAgICAgdmFyIHN0YXJ0ID0gW2xpbmVbMF1bMF0gKyB4LCBsaW5lWzBdWzFdICsgeV0sCiAgICAgICAgICBlbmQgPSBbbGluZVsxXVswXSArIHgsIGxpbmVbMV1bMV0gKyB5XSwKICAgICAgICAgIHN0YXJ0SW5kZXggPSBpbmRleChzdGFydCksCiAgICAgICAgICBlbmRJbmRleCA9IGluZGV4KGVuZCksCiAgICAgICAgICBmLCBnOwogICAgICBpZiAoZiA9IGZyYWdtZW50QnlFbmRbc3RhcnRJbmRleF0pIHsKICAgICAgICBpZiAoZyA9IGZyYWdtZW50QnlTdGFydFtlbmRJbmRleF0pIHsKICAgICAgICAgIGRlbGV0ZSBmcmFnbWVudEJ5RW5kW2YuZW5kXTsKICAgICAgICAgIGRlbGV0ZSBmcmFnbWVudEJ5U3RhcnRbZy5zdGFydF07CiAgICAgICAgICBpZiAoZiA9PT0gZykgewogICAgICAgICAgICBmLnJpbmcucHVzaChlbmQpOwogICAgICAgICAgICBjYWxsYmFjayhmLnJpbmcpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZnJhZ21lbnRCeVN0YXJ0W2Yuc3RhcnRdID0gZnJhZ21lbnRCeUVuZFtnLmVuZF0gPSB7c3RhcnQ6IGYuc3RhcnQsIGVuZDogZy5lbmQsIHJpbmc6IGYucmluZy5jb25jYXQoZy5yaW5nKX07CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlbGV0ZSBmcmFnbWVudEJ5RW5kW2YuZW5kXTsKICAgICAgICAgIGYucmluZy5wdXNoKGVuZCk7CiAgICAgICAgICBmcmFnbWVudEJ5RW5kW2YuZW5kID0gZW5kSW5kZXhdID0gZjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZiA9IGZyYWdtZW50QnlTdGFydFtlbmRJbmRleF0pIHsKICAgICAgICBpZiAoZyA9IGZyYWdtZW50QnlFbmRbc3RhcnRJbmRleF0pIHsKICAgICAgICAgIGRlbGV0ZSBmcmFnbWVudEJ5U3RhcnRbZi5zdGFydF07CiAgICAgICAgICBkZWxldGUgZnJhZ21lbnRCeUVuZFtnLmVuZF07CiAgICAgICAgICBpZiAoZiA9PT0gZykgewogICAgICAgICAgICBmLnJpbmcucHVzaChlbmQpOwogICAgICAgICAgICBjYWxsYmFjayhmLnJpbmcpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZnJhZ21lbnRCeVN0YXJ0W2cuc3RhcnRdID0gZnJhZ21lbnRCeUVuZFtmLmVuZF0gPSB7c3RhcnQ6IGcuc3RhcnQsIGVuZDogZi5lbmQsIHJpbmc6IGcucmluZy5jb25jYXQoZi5yaW5nKX07CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlbGV0ZSBmcmFnbWVudEJ5U3RhcnRbZi5zdGFydF07CiAgICAgICAgICBmLnJpbmcudW5zaGlmdChzdGFydCk7CiAgICAgICAgICBmcmFnbWVudEJ5U3RhcnRbZi5zdGFydCA9IHN0YXJ0SW5kZXhdID0gZjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZnJhZ21lbnRCeVN0YXJ0W3N0YXJ0SW5kZXhdID0gZnJhZ21lbnRCeUVuZFtlbmRJbmRleF0gPSB7c3RhcnQ6IHN0YXJ0SW5kZXgsIGVuZDogZW5kSW5kZXgsIHJpbmc6IFtzdGFydCwgZW5kXX07CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGluZGV4KHBvaW50KSB7CiAgICByZXR1cm4gcG9pbnRbMF0gKiAyICsgcG9pbnRbMV0gKiAoZHggKyAxKSAqIDQ7CiAgfQoKICBmdW5jdGlvbiBzbW9vdGhMaW5lYXIocmluZywgdmFsdWVzLCB2YWx1ZSkgewogICAgcmluZy5mb3JFYWNoKGZ1bmN0aW9uKHBvaW50KSB7CiAgICAgIHZhciB4ID0gcG9pbnRbMF0sCiAgICAgICAgICB5ID0gcG9pbnRbMV0sCiAgICAgICAgICB4dCA9IHggfCAwLAogICAgICAgICAgeXQgPSB5IHwgMCwKICAgICAgICAgIHYwLAogICAgICAgICAgdjEgPSB2YWx1ZXNbeXQgKiBkeCArIHh0XTsKICAgICAgaWYgKHggPiAwICYmIHggPCBkeCAmJiB4dCA9PT0geCkgewogICAgICAgIHYwID0gdmFsdWVzW3l0ICogZHggKyB4dCAtIDFdOwogICAgICAgIHBvaW50WzBdID0geCArICh2YWx1ZSAtIHYwKSAvICh2MSAtIHYwKSAtIDAuNTsKICAgICAgfQogICAgICBpZiAoeSA+IDAgJiYgeSA8IGR5ICYmIHl0ID09PSB5KSB7CiAgICAgICAgdjAgPSB2YWx1ZXNbKHl0IC0gMSkgKiBkeCArIHh0XTsKICAgICAgICBwb2ludFsxXSA9IHkgKyAodmFsdWUgLSB2MCkgLyAodjEgLSB2MCkgLSAwLjU7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgY29udG91cnMuY29udG91ciA9IGNvbnRvdXI7CgogIGNvbnRvdXJzLnNpemUgPSBmdW5jdGlvbihfKSB7CiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBbZHgsIGR5XTsKICAgIHZhciBfMCA9IE1hdGguY2VpbChfWzBdKSwgXzEgPSBNYXRoLmNlaWwoX1sxXSk7CiAgICBpZiAoIShfMCA+IDApIHx8ICEoXzEgPiAwKSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHNpemUiKTsKICAgIHJldHVybiBkeCA9IF8wLCBkeSA9IF8xLCBjb250b3VyczsKICB9OwoKICBjb250b3Vycy50aHJlc2hvbGRzID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodGhyZXNob2xkJCQxID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogQXJyYXkuaXNBcnJheShfKSA/IGNvbnN0YW50JDYoc2xpY2UkMy5jYWxsKF8pKSA6IGNvbnN0YW50JDYoXyksIGNvbnRvdXJzKSA6IHRocmVzaG9sZCQkMTsKICB9OwoKICBjb250b3Vycy5zbW9vdGggPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChzbW9vdGggPSBfID8gc21vb3RoTGluZWFyIDogbm9vcCQxLCBjb250b3VycykgOiBzbW9vdGggPT09IHNtb290aExpbmVhcjsKICB9OwoKICByZXR1cm4gY29udG91cnM7Cn0KCi8vIFRPRE8gT3B0aW1pemUgZWRnZSBjYXNlcy4KLy8gVE9ETyBPcHRpbWl6ZSBpbmRleCBjYWxjdWxhdGlvbi4KLy8gVE9ETyBPcHRpbWl6ZSBhcmd1bWVudHMuCmZ1bmN0aW9uIGJsdXJYKHNvdXJjZSwgdGFyZ2V0LCByKSB7CiAgdmFyIG4gPSBzb3VyY2Uud2lkdGgsCiAgICAgIG0gPSBzb3VyY2UuaGVpZ2h0LAogICAgICB3ID0gKHIgPDwgMSkgKyAxOwogIGZvciAodmFyIGogPSAwOyBqIDwgbTsgKytqKSB7CiAgICBmb3IgKHZhciBpID0gMCwgc3IgPSAwOyBpIDwgbiArIHI7ICsraSkgewogICAgICBpZiAoaSA8IG4pIHsKICAgICAgICBzciArPSBzb3VyY2UuZGF0YVtpICsgaiAqIG5dOwogICAgICB9CiAgICAgIGlmIChpID49IHIpIHsKICAgICAgICBpZiAoaSA+PSB3KSB7CiAgICAgICAgICBzciAtPSBzb3VyY2UuZGF0YVtpIC0gdyArIGogKiBuXTsKICAgICAgICB9CiAgICAgICAgdGFyZ2V0LmRhdGFbaSAtIHIgKyBqICogbl0gPSBzciAvIE1hdGgubWluKGkgKyAxLCBuIC0gMSArIHcgLSBpLCB3KTsKICAgICAgfQogICAgfQogIH0KfQoKLy8gVE9ETyBPcHRpbWl6ZSBlZGdlIGNhc2VzLgovLyBUT0RPIE9wdGltaXplIGluZGV4IGNhbGN1bGF0aW9uLgovLyBUT0RPIE9wdGltaXplIGFyZ3VtZW50cy4KZnVuY3Rpb24gYmx1clkoc291cmNlLCB0YXJnZXQsIHIpIHsKICB2YXIgbiA9IHNvdXJjZS53aWR0aCwKICAgICAgbSA9IHNvdXJjZS5oZWlnaHQsCiAgICAgIHcgPSAociA8PCAxKSArIDE7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgIGZvciAodmFyIGogPSAwLCBzciA9IDA7IGogPCBtICsgcjsgKytqKSB7CiAgICAgIGlmIChqIDwgbSkgewogICAgICAgIHNyICs9IHNvdXJjZS5kYXRhW2kgKyBqICogbl07CiAgICAgIH0KICAgICAgaWYgKGogPj0gcikgewogICAgICAgIGlmIChqID49IHcpIHsKICAgICAgICAgIHNyIC09IHNvdXJjZS5kYXRhW2kgKyAoaiAtIHcpICogbl07CiAgICAgICAgfQogICAgICAgIHRhcmdldC5kYXRhW2kgKyAoaiAtIHIpICogbl0gPSBzciAvIE1hdGgubWluKGogKyAxLCBtIC0gMSArIHcgLSBqLCB3KTsKICAgICAgfQogICAgfQogIH0KfQoKZnVuY3Rpb24gZGVmYXVsdFgoZCkgewogIHJldHVybiBkWzBdOwp9CgpmdW5jdGlvbiBkZWZhdWx0WShkKSB7CiAgcmV0dXJuIGRbMV07Cn0KCmZ1bmN0aW9uIGRlbnNpdHkoKSB7CiAgdmFyIHggPSBkZWZhdWx0WCwKICAgICAgeSA9IGRlZmF1bHRZLAogICAgICBkeCA9IDk2MCwKICAgICAgZHkgPSA1MDAsCiAgICAgIHIgPSAyMCwgLy8gYmx1ciByYWRpdXMKICAgICAgayA9IDIsIC8vIGxvZzIoZ3JpZCBjZWxsIHNpemUpCiAgICAgIG8gPSByICogMywgLy8gZ3JpZCBvZmZzZXQsIHRvIHBhZCBmb3IgYmx1cgogICAgICBuID0gKGR4ICsgbyAqIDIpID4+IGssIC8vIGdyaWQgd2lkdGgKICAgICAgbSA9IChkeSArIG8gKiAyKSA+PiBrLCAvLyBncmlkIGhlaWdodAogICAgICB0aHJlc2hvbGQkJDEgPSBjb25zdGFudCQ2KDIwKTsKCiAgZnVuY3Rpb24gZGVuc2l0eShkYXRhKSB7CiAgICB2YXIgdmFsdWVzMCA9IG5ldyBGbG9hdDMyQXJyYXkobiAqIG0pLAogICAgICAgIHZhbHVlczEgPSBuZXcgRmxvYXQzMkFycmF5KG4gKiBtKTsKCiAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24oZCwgaSwgZGF0YSkgewogICAgICB2YXIgeGkgPSAoeChkLCBpLCBkYXRhKSArIG8pID4+IGssCiAgICAgICAgICB5aSA9ICh5KGQsIGksIGRhdGEpICsgbykgPj4gazsKICAgICAgaWYgKHhpID49IDAgJiYgeGkgPCBuICYmIHlpID49IDAgJiYgeWkgPCBtKSB7CiAgICAgICAgKyt2YWx1ZXMwW3hpICsgeWkgKiBuXTsKICAgICAgfQogICAgfSk7CgogICAgLy8gVE9ETyBPcHRpbWl6ZS4KICAgIGJsdXJYKHt3aWR0aDogbiwgaGVpZ2h0OiBtLCBkYXRhOiB2YWx1ZXMwfSwge3dpZHRoOiBuLCBoZWlnaHQ6IG0sIGRhdGE6IHZhbHVlczF9LCByID4+IGspOwogICAgYmx1clkoe3dpZHRoOiBuLCBoZWlnaHQ6IG0sIGRhdGE6IHZhbHVlczF9LCB7d2lkdGg6IG4sIGhlaWdodDogbSwgZGF0YTogdmFsdWVzMH0sIHIgPj4gayk7CiAgICBibHVyWCh7d2lkdGg6IG4sIGhlaWdodDogbSwgZGF0YTogdmFsdWVzMH0sIHt3aWR0aDogbiwgaGVpZ2h0OiBtLCBkYXRhOiB2YWx1ZXMxfSwgciA+PiBrKTsKICAgIGJsdXJZKHt3aWR0aDogbiwgaGVpZ2h0OiBtLCBkYXRhOiB2YWx1ZXMxfSwge3dpZHRoOiBuLCBoZWlnaHQ6IG0sIGRhdGE6IHZhbHVlczB9LCByID4+IGspOwogICAgYmx1clgoe3dpZHRoOiBuLCBoZWlnaHQ6IG0sIGRhdGE6IHZhbHVlczB9LCB7d2lkdGg6IG4sIGhlaWdodDogbSwgZGF0YTogdmFsdWVzMX0sIHIgPj4gayk7CiAgICBibHVyWSh7d2lkdGg6IG4sIGhlaWdodDogbSwgZGF0YTogdmFsdWVzMX0sIHt3aWR0aDogbiwgaGVpZ2h0OiBtLCBkYXRhOiB2YWx1ZXMwfSwgciA+PiBrKTsKCiAgICB2YXIgdHogPSB0aHJlc2hvbGQkJDEodmFsdWVzMCk7CgogICAgLy8gQ29udmVydCBudW1iZXIgb2YgdGhyZXNob2xkcyBpbnRvIHVuaWZvcm0gdGhyZXNob2xkcy4KICAgIGlmICghQXJyYXkuaXNBcnJheSh0eikpIHsKICAgICAgdmFyIHN0b3AgPSBtYXgodmFsdWVzMCk7CiAgICAgIHR6ID0gdGlja1N0ZXAoMCwgc3RvcCwgdHopOwogICAgICB0eiA9IHNlcXVlbmNlKDAsIE1hdGguZmxvb3Ioc3RvcCAvIHR6KSAqIHR6LCB0eik7CiAgICAgIHR6LnNoaWZ0KCk7CiAgICB9CgogICAgcmV0dXJuIGNvbnRvdXJzKCkKICAgICAgICAudGhyZXNob2xkcyh0eikKICAgICAgICAuc2l6ZShbbiwgbV0pCiAgICAgICh2YWx1ZXMwKQogICAgICAgIC5tYXAodHJhbnNmb3JtKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZm9ybShnZW9tZXRyeSkgewogICAgZ2VvbWV0cnkudmFsdWUgKj0gTWF0aC5wb3coMiwgLTIgKiBrKTsgLy8gRGVuc2l0eSBpbiBwb2ludHMgcGVyIHNxdWFyZSBwaXhlbC4KICAgIGdlb21ldHJ5LmNvb3JkaW5hdGVzLmZvckVhY2godHJhbnNmb3JtUG9seWdvbik7CiAgICByZXR1cm4gZ2VvbWV0cnk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2Zvcm1Qb2x5Z29uKGNvb3JkaW5hdGVzKSB7CiAgICBjb29yZGluYXRlcy5mb3JFYWNoKHRyYW5zZm9ybVJpbmcpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmb3JtUmluZyhjb29yZGluYXRlcykgewogICAgY29vcmRpbmF0ZXMuZm9yRWFjaCh0cmFuc2Zvcm1Qb2ludCk7CiAgfQoKICAvLyBUT0RPIE9wdGltaXplLgogIGZ1bmN0aW9uIHRyYW5zZm9ybVBvaW50KGNvb3JkaW5hdGVzKSB7CiAgICBjb29yZGluYXRlc1swXSA9IGNvb3JkaW5hdGVzWzBdICogTWF0aC5wb3coMiwgaykgLSBvOwogICAgY29vcmRpbmF0ZXNbMV0gPSBjb29yZGluYXRlc1sxXSAqIE1hdGgucG93KDIsIGspIC0gbzsKICB9CgogIGZ1bmN0aW9uIHJlc2l6ZSgpIHsKICAgIG8gPSByICogMzsKICAgIG4gPSAoZHggKyBvICogMikgPj4gazsKICAgIG0gPSAoZHkgKyBvICogMikgPj4gazsKICAgIHJldHVybiBkZW5zaXR5OwogIH0KCiAgZGVuc2l0eS54ID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoeCA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IGNvbnN0YW50JDYoK18pLCBkZW5zaXR5KSA6IHg7CiAgfTsKCiAgZGVuc2l0eS55ID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoeSA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IGNvbnN0YW50JDYoK18pLCBkZW5zaXR5KSA6IHk7CiAgfTsKCiAgZGVuc2l0eS5zaXplID0gZnVuY3Rpb24oXykgewogICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gW2R4LCBkeV07CiAgICB2YXIgXzAgPSBNYXRoLmNlaWwoX1swXSksIF8xID0gTWF0aC5jZWlsKF9bMV0pOwogICAgaWYgKCEoXzAgPj0gMCkgJiYgIShfMCA+PSAwKSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHNpemUiKTsKICAgIHJldHVybiBkeCA9IF8wLCBkeSA9IF8xLCByZXNpemUoKTsKICB9OwoKICBkZW5zaXR5LmNlbGxTaXplID0gZnVuY3Rpb24oXykgewogICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gMSA8PCBrOwogICAgaWYgKCEoKF8gPSArXykgPj0gMSkpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBjZWxsIHNpemUiKTsKICAgIHJldHVybiBrID0gTWF0aC5mbG9vcihNYXRoLmxvZyhfKSAvIE1hdGguTE4yKSwgcmVzaXplKCk7CiAgfTsKCiAgZGVuc2l0eS50aHJlc2hvbGRzID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodGhyZXNob2xkJCQxID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogQXJyYXkuaXNBcnJheShfKSA/IGNvbnN0YW50JDYoc2xpY2UkMy5jYWxsKF8pKSA6IGNvbnN0YW50JDYoXyksIGRlbnNpdHkpIDogdGhyZXNob2xkJCQxOwogIH07CgogIGRlbnNpdHkuYmFuZHdpZHRoID0gZnVuY3Rpb24oXykgewogICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gTWF0aC5zcXJ0KHIgKiAociArIDEpKTsKICAgIGlmICghKChfID0gK18pID49IDApKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgYmFuZHdpZHRoIik7CiAgICByZXR1cm4gciA9IE1hdGgucm91bmQoKE1hdGguc3FydCg0ICogXyAqIF8gKyAxKSAtIDEpIC8gMiksIHJlc2l6ZSgpOwogIH07CgogIHJldHVybiBkZW5zaXR5Owp9Cgp2YXIgRU9MID0ge30sCiAgICBFT0YgPSB7fSwKICAgIFFVT1RFID0gMzQsCiAgICBORVdMSU5FID0gMTAsCiAgICBSRVRVUk4gPSAxMzsKCmZ1bmN0aW9uIG9iamVjdENvbnZlcnRlcihjb2x1bW5zKSB7CiAgcmV0dXJuIG5ldyBGdW5jdGlvbigiZCIsICJyZXR1cm4geyIgKyBjb2x1bW5zLm1hcChmdW5jdGlvbihuYW1lLCBpKSB7CiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobmFtZSkgKyAiOiBkWyIgKyBpICsgIl0iOwogIH0pLmpvaW4oIiwiKSArICJ9Iik7Cn0KCmZ1bmN0aW9uIGN1c3RvbUNvbnZlcnRlcihjb2x1bW5zLCBmKSB7CiAgdmFyIG9iamVjdCA9IG9iamVjdENvbnZlcnRlcihjb2x1bW5zKTsKICByZXR1cm4gZnVuY3Rpb24ocm93LCBpKSB7CiAgICByZXR1cm4gZihvYmplY3Qocm93KSwgaSwgY29sdW1ucyk7CiAgfTsKfQoKLy8gQ29tcHV0ZSB1bmlxdWUgY29sdW1ucyBpbiBvcmRlciBvZiBkaXNjb3ZlcnkuCmZ1bmN0aW9uIGluZmVyQ29sdW1ucyhyb3dzKSB7CiAgdmFyIGNvbHVtblNldCA9IE9iamVjdC5jcmVhdGUobnVsbCksCiAgICAgIGNvbHVtbnMgPSBbXTsKCiAgcm93cy5mb3JFYWNoKGZ1bmN0aW9uKHJvdykgewogICAgZm9yICh2YXIgY29sdW1uIGluIHJvdykgewogICAgICBpZiAoIShjb2x1bW4gaW4gY29sdW1uU2V0KSkgewogICAgICAgIGNvbHVtbnMucHVzaChjb2x1bW5TZXRbY29sdW1uXSA9IGNvbHVtbik7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgcmV0dXJuIGNvbHVtbnM7Cn0KCmZ1bmN0aW9uIGRzdkZvcm1hdChkZWxpbWl0ZXIpIHsKICB2YXIgcmVGb3JtYXQgPSBuZXcgUmVnRXhwKCJbXCIiICsgZGVsaW1pdGVyICsgIlxuXHJdIiksCiAgICAgIERFTElNSVRFUiA9IGRlbGltaXRlci5jaGFyQ29kZUF0KDApOwoKICBmdW5jdGlvbiBwYXJzZSh0ZXh0LCBmKSB7CiAgICB2YXIgY29udmVydCwgY29sdW1ucywgcm93cyA9IHBhcnNlUm93cyh0ZXh0LCBmdW5jdGlvbihyb3csIGkpIHsKICAgICAgaWYgKGNvbnZlcnQpIHJldHVybiBjb252ZXJ0KHJvdywgaSAtIDEpOwogICAgICBjb2x1bW5zID0gcm93LCBjb252ZXJ0ID0gZiA/IGN1c3RvbUNvbnZlcnRlcihyb3csIGYpIDogb2JqZWN0Q29udmVydGVyKHJvdyk7CiAgICB9KTsKICAgIHJvd3MuY29sdW1ucyA9IGNvbHVtbnMgfHwgW107CiAgICByZXR1cm4gcm93czsKICB9CgogIGZ1bmN0aW9uIHBhcnNlUm93cyh0ZXh0LCBmKSB7CiAgICB2YXIgcm93cyA9IFtdLCAvLyBvdXRwdXQgcm93cwogICAgICAgIE4gPSB0ZXh0Lmxlbmd0aCwKICAgICAgICBJID0gMCwgLy8gY3VycmVudCBjaGFyYWN0ZXIgaW5kZXgKICAgICAgICBuID0gMCwgLy8gY3VycmVudCBsaW5lIG51bWJlcgogICAgICAgIHQsIC8vIGN1cnJlbnQgdG9rZW4KICAgICAgICBlb2YgPSBOIDw9IDAsIC8vIGN1cnJlbnQgdG9rZW4gZm9sbG93ZWQgYnkgRU9GPwogICAgICAgIGVvbCA9IGZhbHNlOyAvLyBjdXJyZW50IHRva2VuIGZvbGxvd2VkIGJ5IEVPTD8KCiAgICAvLyBTdHJpcCB0aGUgdHJhaWxpbmcgbmV3bGluZS4KICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQoTiAtIDEpID09PSBORVdMSU5FKSAtLU47CiAgICBpZiAodGV4dC5jaGFyQ29kZUF0KE4gLSAxKSA9PT0gUkVUVVJOKSAtLU47CgogICAgZnVuY3Rpb24gdG9rZW4oKSB7CiAgICAgIGlmIChlb2YpIHJldHVybiBFT0Y7CiAgICAgIGlmIChlb2wpIHJldHVybiBlb2wgPSBmYWxzZSwgRU9MOwoKICAgICAgLy8gVW5lc2NhcGUgcXVvdGVzLgogICAgICB2YXIgaSwgaiA9IEksIGM7CiAgICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQoaikgPT09IFFVT1RFKSB7CiAgICAgICAgd2hpbGUgKEkrKyA8IE4gJiYgdGV4dC5jaGFyQ29kZUF0KEkpICE9PSBRVU9URSB8fCB0ZXh0LmNoYXJDb2RlQXQoKytJKSA9PT0gUVVPVEUpOwogICAgICAgIGlmICgoaSA9IEkpID49IE4pIGVvZiA9IHRydWU7CiAgICAgICAgZWxzZSBpZiAoKGMgPSB0ZXh0LmNoYXJDb2RlQXQoSSsrKSkgPT09IE5FV0xJTkUpIGVvbCA9IHRydWU7CiAgICAgICAgZWxzZSBpZiAoYyA9PT0gUkVUVVJOKSB7IGVvbCA9IHRydWU7IGlmICh0ZXh0LmNoYXJDb2RlQXQoSSkgPT09IE5FV0xJTkUpICsrSTsgfQogICAgICAgIHJldHVybiB0ZXh0LnNsaWNlKGogKyAxLCBpIC0gMSkucmVwbGFjZSgvIiIvZywgIlwiIik7CiAgICAgIH0KCiAgICAgIC8vIEZpbmQgbmV4dCBkZWxpbWl0ZXIgb3IgbmV3bGluZS4KICAgICAgd2hpbGUgKEkgPCBOKSB7CiAgICAgICAgaWYgKChjID0gdGV4dC5jaGFyQ29kZUF0KGkgPSBJKyspKSA9PT0gTkVXTElORSkgZW9sID0gdHJ1ZTsKICAgICAgICBlbHNlIGlmIChjID09PSBSRVRVUk4pIHsgZW9sID0gdHJ1ZTsgaWYgKHRleHQuY2hhckNvZGVBdChJKSA9PT0gTkVXTElORSkgKytJOyB9CiAgICAgICAgZWxzZSBpZiAoYyAhPT0gREVMSU1JVEVSKSBjb250aW51ZTsKICAgICAgICByZXR1cm4gdGV4dC5zbGljZShqLCBpKTsKICAgICAgfQoKICAgICAgLy8gUmV0dXJuIGxhc3QgdG9rZW4gYmVmb3JlIEVPRi4KICAgICAgcmV0dXJuIGVvZiA9IHRydWUsIHRleHQuc2xpY2UoaiwgTik7CiAgICB9CgogICAgd2hpbGUgKCh0ID0gdG9rZW4oKSkgIT09IEVPRikgewogICAgICB2YXIgcm93ID0gW107CiAgICAgIHdoaWxlICh0ICE9PSBFT0wgJiYgdCAhPT0gRU9GKSByb3cucHVzaCh0KSwgdCA9IHRva2VuKCk7CiAgICAgIGlmIChmICYmIChyb3cgPSBmKHJvdywgbisrKSkgPT0gbnVsbCkgY29udGludWU7CiAgICAgIHJvd3MucHVzaChyb3cpOwogICAgfQoKICAgIHJldHVybiByb3dzOwogIH0KCiAgZnVuY3Rpb24gZm9ybWF0KHJvd3MsIGNvbHVtbnMpIHsKICAgIGlmIChjb2x1bW5zID09IG51bGwpIGNvbHVtbnMgPSBpbmZlckNvbHVtbnMocm93cyk7CiAgICByZXR1cm4gW2NvbHVtbnMubWFwKGZvcm1hdFZhbHVlKS5qb2luKGRlbGltaXRlcildLmNvbmNhdChyb3dzLm1hcChmdW5jdGlvbihyb3cpIHsKICAgICAgcmV0dXJuIGNvbHVtbnMubWFwKGZ1bmN0aW9uKGNvbHVtbikgewogICAgICAgIHJldHVybiBmb3JtYXRWYWx1ZShyb3dbY29sdW1uXSk7CiAgICAgIH0pLmpvaW4oZGVsaW1pdGVyKTsKICAgIH0pKS5qb2luKCJcbiIpOwogIH0KCiAgZnVuY3Rpb24gZm9ybWF0Um93cyhyb3dzKSB7CiAgICByZXR1cm4gcm93cy5tYXAoZm9ybWF0Um93KS5qb2luKCJcbiIpOwogIH0KCiAgZnVuY3Rpb24gZm9ybWF0Um93KHJvdykgewogICAgcmV0dXJuIHJvdy5tYXAoZm9ybWF0VmFsdWUpLmpvaW4oZGVsaW1pdGVyKTsKICB9CgogIGZ1bmN0aW9uIGZvcm1hdFZhbHVlKHRleHQpIHsKICAgIHJldHVybiB0ZXh0ID09IG51bGwgPyAiIgogICAgICAgIDogcmVGb3JtYXQudGVzdCh0ZXh0ICs9ICIiKSA/ICJcIiIgKyB0ZXh0LnJlcGxhY2UoLyIvZywgIlwiXCIiKSArICJcIiIKICAgICAgICA6IHRleHQ7CiAgfQoKICByZXR1cm4gewogICAgcGFyc2U6IHBhcnNlLAogICAgcGFyc2VSb3dzOiBwYXJzZVJvd3MsCiAgICBmb3JtYXQ6IGZvcm1hdCwKICAgIGZvcm1hdFJvd3M6IGZvcm1hdFJvd3MKICB9Owp9Cgp2YXIgY3N2ID0gZHN2Rm9ybWF0KCIsIik7Cgp2YXIgY3N2UGFyc2UgPSBjc3YucGFyc2U7CnZhciBjc3ZQYXJzZVJvd3MgPSBjc3YucGFyc2VSb3dzOwp2YXIgY3N2Rm9ybWF0ID0gY3N2LmZvcm1hdDsKdmFyIGNzdkZvcm1hdFJvd3MgPSBjc3YuZm9ybWF0Um93czsKCnZhciB0c3YgPSBkc3ZGb3JtYXQoIlx0Iik7Cgp2YXIgdHN2UGFyc2UgPSB0c3YucGFyc2U7CnZhciB0c3ZQYXJzZVJvd3MgPSB0c3YucGFyc2VSb3dzOwp2YXIgdHN2Rm9ybWF0ID0gdHN2LmZvcm1hdDsKdmFyIHRzdkZvcm1hdFJvd3MgPSB0c3YuZm9ybWF0Um93czsKCmZ1bmN0aW9uIHJlc3BvbnNlQmxvYihyZXNwb25zZSkgewogIGlmICghcmVzcG9uc2Uub2spIHRocm93IG5ldyBFcnJvcihyZXNwb25zZS5zdGF0dXMgKyAiICIgKyByZXNwb25zZS5zdGF0dXNUZXh0KTsKICByZXR1cm4gcmVzcG9uc2UuYmxvYigpOwp9CgpmdW5jdGlvbiBibG9iKGlucHV0LCBpbml0KSB7CiAgcmV0dXJuIGZldGNoKGlucHV0LCBpbml0KS50aGVuKHJlc3BvbnNlQmxvYik7Cn0KCmZ1bmN0aW9uIHJlc3BvbnNlQXJyYXlCdWZmZXIocmVzcG9uc2UpIHsKICBpZiAoIXJlc3BvbnNlLm9rKSB0aHJvdyBuZXcgRXJyb3IocmVzcG9uc2Uuc3RhdHVzICsgIiAiICsgcmVzcG9uc2Uuc3RhdHVzVGV4dCk7CiAgcmV0dXJuIHJlc3BvbnNlLmFycmF5QnVmZmVyKCk7Cn0KCmZ1bmN0aW9uIGJ1ZmZlcihpbnB1dCwgaW5pdCkgewogIHJldHVybiBmZXRjaChpbnB1dCwgaW5pdCkudGhlbihyZXNwb25zZUFycmF5QnVmZmVyKTsKfQoKZnVuY3Rpb24gcmVzcG9uc2VUZXh0KHJlc3BvbnNlKSB7CiAgaWYgKCFyZXNwb25zZS5vaykgdGhyb3cgbmV3IEVycm9yKHJlc3BvbnNlLnN0YXR1cyArICIgIiArIHJlc3BvbnNlLnN0YXR1c1RleHQpOwogIHJldHVybiByZXNwb25zZS50ZXh0KCk7Cn0KCmZ1bmN0aW9uIHRleHQoaW5wdXQsIGluaXQpIHsKICByZXR1cm4gZmV0Y2goaW5wdXQsIGluaXQpLnRoZW4ocmVzcG9uc2VUZXh0KTsKfQoKZnVuY3Rpb24gZHN2UGFyc2UocGFyc2UpIHsKICByZXR1cm4gZnVuY3Rpb24oaW5wdXQsIGluaXQsIHJvdykgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIgJiYgdHlwZW9mIGluaXQgPT09ICJmdW5jdGlvbiIpIHJvdyA9IGluaXQsIGluaXQgPSB1bmRlZmluZWQ7CiAgICByZXR1cm4gdGV4dChpbnB1dCwgaW5pdCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICByZXR1cm4gcGFyc2UocmVzcG9uc2UsIHJvdyk7CiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiBkc3YoZGVsaW1pdGVyLCBpbnB1dCwgaW5pdCwgcm93KSB7CiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDMgJiYgdHlwZW9mIGluaXQgPT09ICJmdW5jdGlvbiIpIHJvdyA9IGluaXQsIGluaXQgPSB1bmRlZmluZWQ7CiAgdmFyIGZvcm1hdCA9IGRzdkZvcm1hdChkZWxpbWl0ZXIpOwogIHJldHVybiB0ZXh0KGlucHV0LCBpbml0KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICByZXR1cm4gZm9ybWF0LnBhcnNlKHJlc3BvbnNlLCByb3cpOwogIH0pOwp9Cgp2YXIgY3N2JDEgPSBkc3ZQYXJzZShjc3ZQYXJzZSk7CnZhciB0c3YkMSA9IGRzdlBhcnNlKHRzdlBhcnNlKTsKCmZ1bmN0aW9uIGltYWdlKGlucHV0LCBpbml0KSB7CiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgdmFyIGltYWdlID0gbmV3IEltYWdlOwogICAgZm9yICh2YXIga2V5IGluIGluaXQpIGltYWdlW2tleV0gPSBpbml0W2tleV07CiAgICBpbWFnZS5vbmVycm9yID0gcmVqZWN0OwogICAgaW1hZ2Uub25sb2FkID0gZnVuY3Rpb24oKSB7IHJlc29sdmUoaW1hZ2UpOyB9OwogICAgaW1hZ2Uuc3JjID0gaW5wdXQ7CiAgfSk7Cn0KCmZ1bmN0aW9uIHJlc3BvbnNlSnNvbihyZXNwb25zZSkgewogIGlmICghcmVzcG9uc2Uub2spIHRocm93IG5ldyBFcnJvcihyZXNwb25zZS5zdGF0dXMgKyAiICIgKyByZXNwb25zZS5zdGF0dXNUZXh0KTsKICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwp9CgpmdW5jdGlvbiBqc29uKGlucHV0LCBpbml0KSB7CiAgcmV0dXJuIGZldGNoKGlucHV0LCBpbml0KS50aGVuKHJlc3BvbnNlSnNvbik7Cn0KCmZ1bmN0aW9uIHBhcnNlcih0eXBlKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0LCBpbml0KSAgewogICAgcmV0dXJuIHRleHQoaW5wdXQsIGluaXQpLnRoZW4oZnVuY3Rpb24odGV4dCQkMSkgewogICAgICByZXR1cm4gKG5ldyBET01QYXJzZXIpLnBhcnNlRnJvbVN0cmluZyh0ZXh0JCQxLCB0eXBlKTsKICAgIH0pOwogIH07Cn0KCnZhciB4bWwgPSBwYXJzZXIoImFwcGxpY2F0aW9uL3htbCIpOwoKdmFyIGh0bWwgPSBwYXJzZXIoInRleHQvaHRtbCIpOwoKdmFyIHN2ZyA9IHBhcnNlcigiaW1hZ2Uvc3ZnK3htbCIpOwoKZnVuY3Rpb24gY2VudGVyJDEoeCwgeSkgewogIHZhciBub2RlczsKCiAgaWYgKHggPT0gbnVsbCkgeCA9IDA7CiAgaWYgKHkgPT0gbnVsbCkgeSA9IDA7CgogIGZ1bmN0aW9uIGZvcmNlKCkgewogICAgdmFyIGksCiAgICAgICAgbiA9IG5vZGVzLmxlbmd0aCwKICAgICAgICBub2RlLAogICAgICAgIHN4ID0gMCwKICAgICAgICBzeSA9IDA7CgogICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICBub2RlID0gbm9kZXNbaV0sIHN4ICs9IG5vZGUueCwgc3kgKz0gbm9kZS55OwogICAgfQoKICAgIGZvciAoc3ggPSBzeCAvIG4gLSB4LCBzeSA9IHN5IC8gbiAtIHksIGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgIG5vZGUgPSBub2Rlc1tpXSwgbm9kZS54IC09IHN4LCBub2RlLnkgLT0gc3k7CiAgICB9CiAgfQoKICBmb3JjZS5pbml0aWFsaXplID0gZnVuY3Rpb24oXykgewogICAgbm9kZXMgPSBfOwogIH07CgogIGZvcmNlLnggPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh4ID0gK18sIGZvcmNlKSA6IHg7CiAgfTsKCiAgZm9yY2UueSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHkgPSArXywgZm9yY2UpIDogeTsKICB9OwoKICByZXR1cm4gZm9yY2U7Cn0KCmZ1bmN0aW9uIGNvbnN0YW50JDcoeCkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB4OwogIH07Cn0KCmZ1bmN0aW9uIGppZ2dsZSgpIHsKICByZXR1cm4gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMWUtNjsKfQoKZnVuY3Rpb24gdHJlZV9hZGQoZCkgewogIHZhciB4ID0gK3RoaXMuX3guY2FsbChudWxsLCBkKSwKICAgICAgeSA9ICt0aGlzLl95LmNhbGwobnVsbCwgZCk7CiAgcmV0dXJuIGFkZCh0aGlzLmNvdmVyKHgsIHkpLCB4LCB5LCBkKTsKfQoKZnVuY3Rpb24gYWRkKHRyZWUsIHgsIHksIGQpIHsKICBpZiAoaXNOYU4oeCkgfHwgaXNOYU4oeSkpIHJldHVybiB0cmVlOyAvLyBpZ25vcmUgaW52YWxpZCBwb2ludHMKCiAgdmFyIHBhcmVudCwKICAgICAgbm9kZSA9IHRyZWUuX3Jvb3QsCiAgICAgIGxlYWYgPSB7ZGF0YTogZH0sCiAgICAgIHgwID0gdHJlZS5feDAsCiAgICAgIHkwID0gdHJlZS5feTAsCiAgICAgIHgxID0gdHJlZS5feDEsCiAgICAgIHkxID0gdHJlZS5feTEsCiAgICAgIHhtLAogICAgICB5bSwKICAgICAgeHAsCiAgICAgIHlwLAogICAgICByaWdodCwKICAgICAgYm90dG9tLAogICAgICBpLAogICAgICBqOwoKICAvLyBJZiB0aGUgdHJlZSBpcyBlbXB0eSwgaW5pdGlhbGl6ZSB0aGUgcm9vdCBhcyBhIGxlYWYuCiAgaWYgKCFub2RlKSByZXR1cm4gdHJlZS5fcm9vdCA9IGxlYWYsIHRyZWU7CgogIC8vIEZpbmQgdGhlIGV4aXN0aW5nIGxlYWYgZm9yIHRoZSBuZXcgcG9pbnQsIG9yIGFkZCBpdC4KICB3aGlsZSAobm9kZS5sZW5ndGgpIHsKICAgIGlmIChyaWdodCA9IHggPj0gKHhtID0gKHgwICsgeDEpIC8gMikpIHgwID0geG07IGVsc2UgeDEgPSB4bTsKICAgIGlmIChib3R0b20gPSB5ID49ICh5bSA9ICh5MCArIHkxKSAvIDIpKSB5MCA9IHltOyBlbHNlIHkxID0geW07CiAgICBpZiAocGFyZW50ID0gbm9kZSwgIShub2RlID0gbm9kZVtpID0gYm90dG9tIDw8IDEgfCByaWdodF0pKSByZXR1cm4gcGFyZW50W2ldID0gbGVhZiwgdHJlZTsKICB9CgogIC8vIElzIHRoZSBuZXcgcG9pbnQgaXMgZXhhY3RseSBjb2luY2lkZW50IHdpdGggdGhlIGV4aXN0aW5nIHBvaW50PwogIHhwID0gK3RyZWUuX3guY2FsbChudWxsLCBub2RlLmRhdGEpOwogIHlwID0gK3RyZWUuX3kuY2FsbChudWxsLCBub2RlLmRhdGEpOwogIGlmICh4ID09PSB4cCAmJiB5ID09PSB5cCkgcmV0dXJuIGxlYWYubmV4dCA9IG5vZGUsIHBhcmVudCA/IHBhcmVudFtpXSA9IGxlYWYgOiB0cmVlLl9yb290ID0gbGVhZiwgdHJlZTsKCiAgLy8gT3RoZXJ3aXNlLCBzcGxpdCB0aGUgbGVhZiBub2RlIHVudGlsIHRoZSBvbGQgYW5kIG5ldyBwb2ludCBhcmUgc2VwYXJhdGVkLgogIGRvIHsKICAgIHBhcmVudCA9IHBhcmVudCA/IHBhcmVudFtpXSA9IG5ldyBBcnJheSg0KSA6IHRyZWUuX3Jvb3QgPSBuZXcgQXJyYXkoNCk7CiAgICBpZiAocmlnaHQgPSB4ID49ICh4bSA9ICh4MCArIHgxKSAvIDIpKSB4MCA9IHhtOyBlbHNlIHgxID0geG07CiAgICBpZiAoYm90dG9tID0geSA+PSAoeW0gPSAoeTAgKyB5MSkgLyAyKSkgeTAgPSB5bTsgZWxzZSB5MSA9IHltOwogIH0gd2hpbGUgKChpID0gYm90dG9tIDw8IDEgfCByaWdodCkgPT09IChqID0gKHlwID49IHltKSA8PCAxIHwgKHhwID49IHhtKSkpOwogIHJldHVybiBwYXJlbnRbal0gPSBub2RlLCBwYXJlbnRbaV0gPSBsZWFmLCB0cmVlOwp9CgpmdW5jdGlvbiBhZGRBbGwoZGF0YSkgewogIHZhciBkLCBpLCBuID0gZGF0YS5sZW5ndGgsCiAgICAgIHgsCiAgICAgIHksCiAgICAgIHh6ID0gbmV3IEFycmF5KG4pLAogICAgICB5eiA9IG5ldyBBcnJheShuKSwKICAgICAgeDAgPSBJbmZpbml0eSwKICAgICAgeTAgPSBJbmZpbml0eSwKICAgICAgeDEgPSAtSW5maW5pdHksCiAgICAgIHkxID0gLUluZmluaXR5OwoKICAvLyBDb21wdXRlIHRoZSBwb2ludHMgYW5kIHRoZWlyIGV4dGVudC4KICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICBpZiAoaXNOYU4oeCA9ICt0aGlzLl94LmNhbGwobnVsbCwgZCA9IGRhdGFbaV0pKSB8fCBpc05hTih5ID0gK3RoaXMuX3kuY2FsbChudWxsLCBkKSkpIGNvbnRpbnVlOwogICAgeHpbaV0gPSB4OwogICAgeXpbaV0gPSB5OwogICAgaWYgKHggPCB4MCkgeDAgPSB4OwogICAgaWYgKHggPiB4MSkgeDEgPSB4OwogICAgaWYgKHkgPCB5MCkgeTAgPSB5OwogICAgaWYgKHkgPiB5MSkgeTEgPSB5OwogIH0KCiAgLy8gSWYgdGhlcmUgd2VyZSBubyAodmFsaWQpIHBvaW50cywgaW5oZXJpdCB0aGUgZXhpc3RpbmcgZXh0ZW50LgogIGlmICh4MSA8IHgwKSB4MCA9IHRoaXMuX3gwLCB4MSA9IHRoaXMuX3gxOwogIGlmICh5MSA8IHkwKSB5MCA9IHRoaXMuX3kwLCB5MSA9IHRoaXMuX3kxOwoKICAvLyBFeHBhbmQgdGhlIHRyZWUgdG8gY292ZXIgdGhlIG5ldyBwb2ludHMuCiAgdGhpcy5jb3Zlcih4MCwgeTApLmNvdmVyKHgxLCB5MSk7CgogIC8vIEFkZCB0aGUgbmV3IHBvaW50cy4KICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICBhZGQodGhpcywgeHpbaV0sIHl6W2ldLCBkYXRhW2ldKTsKICB9CgogIHJldHVybiB0aGlzOwp9CgpmdW5jdGlvbiB0cmVlX2NvdmVyKHgsIHkpIHsKICBpZiAoaXNOYU4oeCA9ICt4KSB8fCBpc05hTih5ID0gK3kpKSByZXR1cm4gdGhpczsgLy8gaWdub3JlIGludmFsaWQgcG9pbnRzCgogIHZhciB4MCA9IHRoaXMuX3gwLAogICAgICB5MCA9IHRoaXMuX3kwLAogICAgICB4MSA9IHRoaXMuX3gxLAogICAgICB5MSA9IHRoaXMuX3kxOwoKICAvLyBJZiB0aGUgcXVhZHRyZWUgaGFzIG5vIGV4dGVudCwgaW5pdGlhbGl6ZSB0aGVtLgogIC8vIEludGVnZXIgZXh0ZW50IGFyZSBuZWNlc3Nhcnkgc28gdGhhdCBpZiB3ZSBsYXRlciBkb3VibGUgdGhlIGV4dGVudCwKICAvLyB0aGUgZXhpc3RpbmcgcXVhZHJhbnQgYm91bmRhcmllcyBkb27igJl0IGNoYW5nZSBkdWUgdG8gZmxvYXRpbmcgcG9pbnQgZXJyb3IhCiAgaWYgKGlzTmFOKHgwKSkgewogICAgeDEgPSAoeDAgPSBNYXRoLmZsb29yKHgpKSArIDE7CiAgICB5MSA9ICh5MCA9IE1hdGguZmxvb3IoeSkpICsgMTsKICB9CgogIC8vIE90aGVyd2lzZSwgZG91YmxlIHJlcGVhdGVkbHkgdG8gY292ZXIuCiAgZWxzZSBpZiAoeDAgPiB4IHx8IHggPiB4MSB8fCB5MCA+IHkgfHwgeSA+IHkxKSB7CiAgICB2YXIgeiA9IHgxIC0geDAsCiAgICAgICAgbm9kZSA9IHRoaXMuX3Jvb3QsCiAgICAgICAgcGFyZW50LAogICAgICAgIGk7CgogICAgc3dpdGNoIChpID0gKHkgPCAoeTAgKyB5MSkgLyAyKSA8PCAxIHwgKHggPCAoeDAgKyB4MSkgLyAyKSkgewogICAgICBjYXNlIDA6IHsKICAgICAgICBkbyBwYXJlbnQgPSBuZXcgQXJyYXkoNCksIHBhcmVudFtpXSA9IG5vZGUsIG5vZGUgPSBwYXJlbnQ7CiAgICAgICAgd2hpbGUgKHogKj0gMiwgeDEgPSB4MCArIHosIHkxID0geTAgKyB6LCB4ID4geDEgfHwgeSA+IHkxKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjYXNlIDE6IHsKICAgICAgICBkbyBwYXJlbnQgPSBuZXcgQXJyYXkoNCksIHBhcmVudFtpXSA9IG5vZGUsIG5vZGUgPSBwYXJlbnQ7CiAgICAgICAgd2hpbGUgKHogKj0gMiwgeDAgPSB4MSAtIHosIHkxID0geTAgKyB6LCB4MCA+IHggfHwgeSA+IHkxKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjYXNlIDI6IHsKICAgICAgICBkbyBwYXJlbnQgPSBuZXcgQXJyYXkoNCksIHBhcmVudFtpXSA9IG5vZGUsIG5vZGUgPSBwYXJlbnQ7CiAgICAgICAgd2hpbGUgKHogKj0gMiwgeDEgPSB4MCArIHosIHkwID0geTEgLSB6LCB4ID4geDEgfHwgeTAgPiB5KTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjYXNlIDM6IHsKICAgICAgICBkbyBwYXJlbnQgPSBuZXcgQXJyYXkoNCksIHBhcmVudFtpXSA9IG5vZGUsIG5vZGUgPSBwYXJlbnQ7CiAgICAgICAgd2hpbGUgKHogKj0gMiwgeDAgPSB4MSAtIHosIHkwID0geTEgLSB6LCB4MCA+IHggfHwgeTAgPiB5KTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQoKICAgIGlmICh0aGlzLl9yb290ICYmIHRoaXMuX3Jvb3QubGVuZ3RoKSB0aGlzLl9yb290ID0gbm9kZTsKICB9CgogIC8vIElmIHRoZSBxdWFkdHJlZSBjb3ZlcnMgdGhlIHBvaW50IGFscmVhZHksIGp1c3QgcmV0dXJuLgogIGVsc2UgcmV0dXJuIHRoaXM7CgogIHRoaXMuX3gwID0geDA7CiAgdGhpcy5feTAgPSB5MDsKICB0aGlzLl94MSA9IHgxOwogIHRoaXMuX3kxID0geTE7CiAgcmV0dXJuIHRoaXM7Cn0KCmZ1bmN0aW9uIHRyZWVfZGF0YSgpIHsKICB2YXIgZGF0YSA9IFtdOwogIHRoaXMudmlzaXQoZnVuY3Rpb24obm9kZSkgewogICAgaWYgKCFub2RlLmxlbmd0aCkgZG8gZGF0YS5wdXNoKG5vZGUuZGF0YSk7IHdoaWxlIChub2RlID0gbm9kZS5uZXh0KQogIH0pOwogIHJldHVybiBkYXRhOwp9CgpmdW5jdGlvbiB0cmVlX2V4dGVudChfKSB7CiAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGgKICAgICAgPyB0aGlzLmNvdmVyKCtfWzBdWzBdLCArX1swXVsxXSkuY292ZXIoK19bMV1bMF0sICtfWzFdWzFdKQogICAgICA6IGlzTmFOKHRoaXMuX3gwKSA/IHVuZGVmaW5lZCA6IFtbdGhpcy5feDAsIHRoaXMuX3kwXSwgW3RoaXMuX3gxLCB0aGlzLl95MV1dOwp9CgpmdW5jdGlvbiBRdWFkKG5vZGUsIHgwLCB5MCwgeDEsIHkxKSB7CiAgdGhpcy5ub2RlID0gbm9kZTsKICB0aGlzLngwID0geDA7CiAgdGhpcy55MCA9IHkwOwogIHRoaXMueDEgPSB4MTsKICB0aGlzLnkxID0geTE7Cn0KCmZ1bmN0aW9uIHRyZWVfZmluZCh4LCB5LCByYWRpdXMpIHsKICB2YXIgZGF0YSwKICAgICAgeDAgPSB0aGlzLl94MCwKICAgICAgeTAgPSB0aGlzLl95MCwKICAgICAgeDEsCiAgICAgIHkxLAogICAgICB4MiwKICAgICAgeTIsCiAgICAgIHgzID0gdGhpcy5feDEsCiAgICAgIHkzID0gdGhpcy5feTEsCiAgICAgIHF1YWRzID0gW10sCiAgICAgIG5vZGUgPSB0aGlzLl9yb290LAogICAgICBxLAogICAgICBpOwoKICBpZiAobm9kZSkgcXVhZHMucHVzaChuZXcgUXVhZChub2RlLCB4MCwgeTAsIHgzLCB5MykpOwogIGlmIChyYWRpdXMgPT0gbnVsbCkgcmFkaXVzID0gSW5maW5pdHk7CiAgZWxzZSB7CiAgICB4MCA9IHggLSByYWRpdXMsIHkwID0geSAtIHJhZGl1czsKICAgIHgzID0geCArIHJhZGl1cywgeTMgPSB5ICsgcmFkaXVzOwogICAgcmFkaXVzICo9IHJhZGl1czsKICB9CgogIHdoaWxlIChxID0gcXVhZHMucG9wKCkpIHsKCiAgICAvLyBTdG9wIHNlYXJjaGluZyBpZiB0aGlzIHF1YWRyYW50IGNhbuKAmXQgY29udGFpbiBhIGNsb3NlciBub2RlLgogICAgaWYgKCEobm9kZSA9IHEubm9kZSkKICAgICAgICB8fCAoeDEgPSBxLngwKSA+IHgzCiAgICAgICAgfHwgKHkxID0gcS55MCkgPiB5MwogICAgICAgIHx8ICh4MiA9IHEueDEpIDwgeDAKICAgICAgICB8fCAoeTIgPSBxLnkxKSA8IHkwKSBjb250aW51ZTsKCiAgICAvLyBCaXNlY3QgdGhlIGN1cnJlbnQgcXVhZHJhbnQuCiAgICBpZiAobm9kZS5sZW5ndGgpIHsKICAgICAgdmFyIHhtID0gKHgxICsgeDIpIC8gMiwKICAgICAgICAgIHltID0gKHkxICsgeTIpIC8gMjsKCiAgICAgIHF1YWRzLnB1c2goCiAgICAgICAgbmV3IFF1YWQobm9kZVszXSwgeG0sIHltLCB4MiwgeTIpLAogICAgICAgIG5ldyBRdWFkKG5vZGVbMl0sIHgxLCB5bSwgeG0sIHkyKSwKICAgICAgICBuZXcgUXVhZChub2RlWzFdLCB4bSwgeTEsIHgyLCB5bSksCiAgICAgICAgbmV3IFF1YWQobm9kZVswXSwgeDEsIHkxLCB4bSwgeW0pCiAgICAgICk7CgogICAgICAvLyBWaXNpdCB0aGUgY2xvc2VzdCBxdWFkcmFudCBmaXJzdC4KICAgICAgaWYgKGkgPSAoeSA+PSB5bSkgPDwgMSB8ICh4ID49IHhtKSkgewogICAgICAgIHEgPSBxdWFkc1txdWFkcy5sZW5ndGggLSAxXTsKICAgICAgICBxdWFkc1txdWFkcy5sZW5ndGggLSAxXSA9IHF1YWRzW3F1YWRzLmxlbmd0aCAtIDEgLSBpXTsKICAgICAgICBxdWFkc1txdWFkcy5sZW5ndGggLSAxIC0gaV0gPSBxOwogICAgICB9CiAgICB9CgogICAgLy8gVmlzaXQgdGhpcyBwb2ludC4gKFZpc2l0aW5nIGNvaW5jaWRlbnQgcG9pbnRzIGlzbuKAmXQgbmVjZXNzYXJ5ISkKICAgIGVsc2UgewogICAgICB2YXIgZHggPSB4IC0gK3RoaXMuX3guY2FsbChudWxsLCBub2RlLmRhdGEpLAogICAgICAgICAgZHkgPSB5IC0gK3RoaXMuX3kuY2FsbChudWxsLCBub2RlLmRhdGEpLAogICAgICAgICAgZDIgPSBkeCAqIGR4ICsgZHkgKiBkeTsKICAgICAgaWYgKGQyIDwgcmFkaXVzKSB7CiAgICAgICAgdmFyIGQgPSBNYXRoLnNxcnQocmFkaXVzID0gZDIpOwogICAgICAgIHgwID0geCAtIGQsIHkwID0geSAtIGQ7CiAgICAgICAgeDMgPSB4ICsgZCwgeTMgPSB5ICsgZDsKICAgICAgICBkYXRhID0gbm9kZS5kYXRhOwogICAgICB9CiAgICB9CiAgfQoKICByZXR1cm4gZGF0YTsKfQoKZnVuY3Rpb24gdHJlZV9yZW1vdmUoZCkgewogIGlmIChpc05hTih4ID0gK3RoaXMuX3guY2FsbChudWxsLCBkKSkgfHwgaXNOYU4oeSA9ICt0aGlzLl95LmNhbGwobnVsbCwgZCkpKSByZXR1cm4gdGhpczsgLy8gaWdub3JlIGludmFsaWQgcG9pbnRzCgogIHZhciBwYXJlbnQsCiAgICAgIG5vZGUgPSB0aGlzLl9yb290LAogICAgICByZXRhaW5lciwKICAgICAgcHJldmlvdXMsCiAgICAgIG5leHQsCiAgICAgIHgwID0gdGhpcy5feDAsCiAgICAgIHkwID0gdGhpcy5feTAsCiAgICAgIHgxID0gdGhpcy5feDEsCiAgICAgIHkxID0gdGhpcy5feTEsCiAgICAgIHgsCiAgICAgIHksCiAgICAgIHhtLAogICAgICB5bSwKICAgICAgcmlnaHQsCiAgICAgIGJvdHRvbSwKICAgICAgaSwKICAgICAgajsKCiAgLy8gSWYgdGhlIHRyZWUgaXMgZW1wdHksIGluaXRpYWxpemUgdGhlIHJvb3QgYXMgYSBsZWFmLgogIGlmICghbm9kZSkgcmV0dXJuIHRoaXM7CgogIC8vIEZpbmQgdGhlIGxlYWYgbm9kZSBmb3IgdGhlIHBvaW50LgogIC8vIFdoaWxlIGRlc2NlbmRpbmcsIGFsc28gcmV0YWluIHRoZSBkZWVwZXN0IHBhcmVudCB3aXRoIGEgbm9uLXJlbW92ZWQgc2libGluZy4KICBpZiAobm9kZS5sZW5ndGgpIHdoaWxlICh0cnVlKSB7CiAgICBpZiAocmlnaHQgPSB4ID49ICh4bSA9ICh4MCArIHgxKSAvIDIpKSB4MCA9IHhtOyBlbHNlIHgxID0geG07CiAgICBpZiAoYm90dG9tID0geSA+PSAoeW0gPSAoeTAgKyB5MSkgLyAyKSkgeTAgPSB5bTsgZWxzZSB5MSA9IHltOwogICAgaWYgKCEocGFyZW50ID0gbm9kZSwgbm9kZSA9IG5vZGVbaSA9IGJvdHRvbSA8PCAxIHwgcmlnaHRdKSkgcmV0dXJuIHRoaXM7CiAgICBpZiAoIW5vZGUubGVuZ3RoKSBicmVhazsKICAgIGlmIChwYXJlbnRbKGkgKyAxKSAmIDNdIHx8IHBhcmVudFsoaSArIDIpICYgM10gfHwgcGFyZW50WyhpICsgMykgJiAzXSkgcmV0YWluZXIgPSBwYXJlbnQsIGogPSBpOwogIH0KCiAgLy8gRmluZCB0aGUgcG9pbnQgdG8gcmVtb3ZlLgogIHdoaWxlIChub2RlLmRhdGEgIT09IGQpIGlmICghKHByZXZpb3VzID0gbm9kZSwgbm9kZSA9IG5vZGUubmV4dCkpIHJldHVybiB0aGlzOwogIGlmIChuZXh0ID0gbm9kZS5uZXh0KSBkZWxldGUgbm9kZS5uZXh0OwoKICAvLyBJZiB0aGVyZSBhcmUgbXVsdGlwbGUgY29pbmNpZGVudCBwb2ludHMsIHJlbW92ZSBqdXN0IHRoZSBwb2ludC4KICBpZiAocHJldmlvdXMpIHJldHVybiBuZXh0ID8gcHJldmlvdXMubmV4dCA9IG5leHQgOiBkZWxldGUgcHJldmlvdXMubmV4dCwgdGhpczsKCiAgLy8gSWYgdGhpcyBpcyB0aGUgcm9vdCBwb2ludCwgcmVtb3ZlIGl0LgogIGlmICghcGFyZW50KSByZXR1cm4gdGhpcy5fcm9vdCA9IG5leHQsIHRoaXM7CgogIC8vIFJlbW92ZSB0aGlzIGxlYWYuCiAgbmV4dCA/IHBhcmVudFtpXSA9IG5leHQgOiBkZWxldGUgcGFyZW50W2ldOwoKICAvLyBJZiB0aGUgcGFyZW50IG5vdyBjb250YWlucyBleGFjdGx5IG9uZSBsZWFmLCBjb2xsYXBzZSBzdXBlcmZsdW91cyBwYXJlbnRzLgogIGlmICgobm9kZSA9IHBhcmVudFswXSB8fCBwYXJlbnRbMV0gfHwgcGFyZW50WzJdIHx8IHBhcmVudFszXSkKICAgICAgJiYgbm9kZSA9PT0gKHBhcmVudFszXSB8fCBwYXJlbnRbMl0gfHwgcGFyZW50WzFdIHx8IHBhcmVudFswXSkKICAgICAgJiYgIW5vZGUubGVuZ3RoKSB7CiAgICBpZiAocmV0YWluZXIpIHJldGFpbmVyW2pdID0gbm9kZTsKICAgIGVsc2UgdGhpcy5fcm9vdCA9IG5vZGU7CiAgfQoKICByZXR1cm4gdGhpczsKfQoKZnVuY3Rpb24gcmVtb3ZlQWxsKGRhdGEpIHsKICBmb3IgKHZhciBpID0gMCwgbiA9IGRhdGEubGVuZ3RoOyBpIDwgbjsgKytpKSB0aGlzLnJlbW92ZShkYXRhW2ldKTsKICByZXR1cm4gdGhpczsKfQoKZnVuY3Rpb24gdHJlZV9yb290KCkgewogIHJldHVybiB0aGlzLl9yb290Owp9CgpmdW5jdGlvbiB0cmVlX3NpemUoKSB7CiAgdmFyIHNpemUgPSAwOwogIHRoaXMudmlzaXQoZnVuY3Rpb24obm9kZSkgewogICAgaWYgKCFub2RlLmxlbmd0aCkgZG8gKytzaXplOyB3aGlsZSAobm9kZSA9IG5vZGUubmV4dCkKICB9KTsKICByZXR1cm4gc2l6ZTsKfQoKZnVuY3Rpb24gdHJlZV92aXNpdChjYWxsYmFjaykgewogIHZhciBxdWFkcyA9IFtdLCBxLCBub2RlID0gdGhpcy5fcm9vdCwgY2hpbGQsIHgwLCB5MCwgeDEsIHkxOwogIGlmIChub2RlKSBxdWFkcy5wdXNoKG5ldyBRdWFkKG5vZGUsIHRoaXMuX3gwLCB0aGlzLl95MCwgdGhpcy5feDEsIHRoaXMuX3kxKSk7CiAgd2hpbGUgKHEgPSBxdWFkcy5wb3AoKSkgewogICAgaWYgKCFjYWxsYmFjayhub2RlID0gcS5ub2RlLCB4MCA9IHEueDAsIHkwID0gcS55MCwgeDEgPSBxLngxLCB5MSA9IHEueTEpICYmIG5vZGUubGVuZ3RoKSB7CiAgICAgIHZhciB4bSA9ICh4MCArIHgxKSAvIDIsIHltID0gKHkwICsgeTEpIC8gMjsKICAgICAgaWYgKGNoaWxkID0gbm9kZVszXSkgcXVhZHMucHVzaChuZXcgUXVhZChjaGlsZCwgeG0sIHltLCB4MSwgeTEpKTsKICAgICAgaWYgKGNoaWxkID0gbm9kZVsyXSkgcXVhZHMucHVzaChuZXcgUXVhZChjaGlsZCwgeDAsIHltLCB4bSwgeTEpKTsKICAgICAgaWYgKGNoaWxkID0gbm9kZVsxXSkgcXVhZHMucHVzaChuZXcgUXVhZChjaGlsZCwgeG0sIHkwLCB4MSwgeW0pKTsKICAgICAgaWYgKGNoaWxkID0gbm9kZVswXSkgcXVhZHMucHVzaChuZXcgUXVhZChjaGlsZCwgeDAsIHkwLCB4bSwgeW0pKTsKICAgIH0KICB9CiAgcmV0dXJuIHRoaXM7Cn0KCmZ1bmN0aW9uIHRyZWVfdmlzaXRBZnRlcihjYWxsYmFjaykgewogIHZhciBxdWFkcyA9IFtdLCBuZXh0ID0gW10sIHE7CiAgaWYgKHRoaXMuX3Jvb3QpIHF1YWRzLnB1c2gobmV3IFF1YWQodGhpcy5fcm9vdCwgdGhpcy5feDAsIHRoaXMuX3kwLCB0aGlzLl94MSwgdGhpcy5feTEpKTsKICB3aGlsZSAocSA9IHF1YWRzLnBvcCgpKSB7CiAgICB2YXIgbm9kZSA9IHEubm9kZTsKICAgIGlmIChub2RlLmxlbmd0aCkgewogICAgICB2YXIgY2hpbGQsIHgwID0gcS54MCwgeTAgPSBxLnkwLCB4MSA9IHEueDEsIHkxID0gcS55MSwgeG0gPSAoeDAgKyB4MSkgLyAyLCB5bSA9ICh5MCArIHkxKSAvIDI7CiAgICAgIGlmIChjaGlsZCA9IG5vZGVbMF0pIHF1YWRzLnB1c2gobmV3IFF1YWQoY2hpbGQsIHgwLCB5MCwgeG0sIHltKSk7CiAgICAgIGlmIChjaGlsZCA9IG5vZGVbMV0pIHF1YWRzLnB1c2gobmV3IFF1YWQoY2hpbGQsIHhtLCB5MCwgeDEsIHltKSk7CiAgICAgIGlmIChjaGlsZCA9IG5vZGVbMl0pIHF1YWRzLnB1c2gobmV3IFF1YWQoY2hpbGQsIHgwLCB5bSwgeG0sIHkxKSk7CiAgICAgIGlmIChjaGlsZCA9IG5vZGVbM10pIHF1YWRzLnB1c2gobmV3IFF1YWQoY2hpbGQsIHhtLCB5bSwgeDEsIHkxKSk7CiAgICB9CiAgICBuZXh0LnB1c2gocSk7CiAgfQogIHdoaWxlIChxID0gbmV4dC5wb3AoKSkgewogICAgY2FsbGJhY2socS5ub2RlLCBxLngwLCBxLnkwLCBxLngxLCBxLnkxKTsKICB9CiAgcmV0dXJuIHRoaXM7Cn0KCmZ1bmN0aW9uIGRlZmF1bHRYJDEoZCkgewogIHJldHVybiBkWzBdOwp9CgpmdW5jdGlvbiB0cmVlX3goXykgewogIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHRoaXMuX3ggPSBfLCB0aGlzKSA6IHRoaXMuX3g7Cn0KCmZ1bmN0aW9uIGRlZmF1bHRZJDEoZCkgewogIHJldHVybiBkWzFdOwp9CgpmdW5jdGlvbiB0cmVlX3koXykgewogIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHRoaXMuX3kgPSBfLCB0aGlzKSA6IHRoaXMuX3k7Cn0KCmZ1bmN0aW9uIHF1YWR0cmVlKG5vZGVzLCB4LCB5KSB7CiAgdmFyIHRyZWUgPSBuZXcgUXVhZHRyZWUoeCA9PSBudWxsID8gZGVmYXVsdFgkMSA6IHgsIHkgPT0gbnVsbCA/IGRlZmF1bHRZJDEgOiB5LCBOYU4sIE5hTiwgTmFOLCBOYU4pOwogIHJldHVybiBub2RlcyA9PSBudWxsID8gdHJlZSA6IHRyZWUuYWRkQWxsKG5vZGVzKTsKfQoKZnVuY3Rpb24gUXVhZHRyZWUoeCwgeSwgeDAsIHkwLCB4MSwgeTEpIHsKICB0aGlzLl94ID0geDsKICB0aGlzLl95ID0geTsKICB0aGlzLl94MCA9IHgwOwogIHRoaXMuX3kwID0geTA7CiAgdGhpcy5feDEgPSB4MTsKICB0aGlzLl95MSA9IHkxOwogIHRoaXMuX3Jvb3QgPSB1bmRlZmluZWQ7Cn0KCmZ1bmN0aW9uIGxlYWZfY29weShsZWFmKSB7CiAgdmFyIGNvcHkgPSB7ZGF0YTogbGVhZi5kYXRhfSwgbmV4dCA9IGNvcHk7CiAgd2hpbGUgKGxlYWYgPSBsZWFmLm5leHQpIG5leHQgPSBuZXh0Lm5leHQgPSB7ZGF0YTogbGVhZi5kYXRhfTsKICByZXR1cm4gY29weTsKfQoKdmFyIHRyZWVQcm90byA9IHF1YWR0cmVlLnByb3RvdHlwZSA9IFF1YWR0cmVlLnByb3RvdHlwZTsKCnRyZWVQcm90by5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgdmFyIGNvcHkgPSBuZXcgUXVhZHRyZWUodGhpcy5feCwgdGhpcy5feSwgdGhpcy5feDAsIHRoaXMuX3kwLCB0aGlzLl94MSwgdGhpcy5feTEpLAogICAgICBub2RlID0gdGhpcy5fcm9vdCwKICAgICAgbm9kZXMsCiAgICAgIGNoaWxkOwoKICBpZiAoIW5vZGUpIHJldHVybiBjb3B5OwoKICBpZiAoIW5vZGUubGVuZ3RoKSByZXR1cm4gY29weS5fcm9vdCA9IGxlYWZfY29weShub2RlKSwgY29weTsKCiAgbm9kZXMgPSBbe3NvdXJjZTogbm9kZSwgdGFyZ2V0OiBjb3B5Ll9yb290ID0gbmV3IEFycmF5KDQpfV07CiAgd2hpbGUgKG5vZGUgPSBub2Rlcy5wb3AoKSkgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OyArK2kpIHsKICAgICAgaWYgKGNoaWxkID0gbm9kZS5zb3VyY2VbaV0pIHsKICAgICAgICBpZiAoY2hpbGQubGVuZ3RoKSBub2Rlcy5wdXNoKHtzb3VyY2U6IGNoaWxkLCB0YXJnZXQ6IG5vZGUudGFyZ2V0W2ldID0gbmV3IEFycmF5KDQpfSk7CiAgICAgICAgZWxzZSBub2RlLnRhcmdldFtpXSA9IGxlYWZfY29weShjaGlsZCk7CiAgICAgIH0KICAgIH0KICB9CgogIHJldHVybiBjb3B5Owp9OwoKdHJlZVByb3RvLmFkZCA9IHRyZWVfYWRkOwp0cmVlUHJvdG8uYWRkQWxsID0gYWRkQWxsOwp0cmVlUHJvdG8uY292ZXIgPSB0cmVlX2NvdmVyOwp0cmVlUHJvdG8uZGF0YSA9IHRyZWVfZGF0YTsKdHJlZVByb3RvLmV4dGVudCA9IHRyZWVfZXh0ZW50Owp0cmVlUHJvdG8uZmluZCA9IHRyZWVfZmluZDsKdHJlZVByb3RvLnJlbW92ZSA9IHRyZWVfcmVtb3ZlOwp0cmVlUHJvdG8ucmVtb3ZlQWxsID0gcmVtb3ZlQWxsOwp0cmVlUHJvdG8ucm9vdCA9IHRyZWVfcm9vdDsKdHJlZVByb3RvLnNpemUgPSB0cmVlX3NpemU7CnRyZWVQcm90by52aXNpdCA9IHRyZWVfdmlzaXQ7CnRyZWVQcm90by52aXNpdEFmdGVyID0gdHJlZV92aXNpdEFmdGVyOwp0cmVlUHJvdG8ueCA9IHRyZWVfeDsKdHJlZVByb3RvLnkgPSB0cmVlX3k7CgpmdW5jdGlvbiB4KGQpIHsKICByZXR1cm4gZC54ICsgZC52eDsKfQoKZnVuY3Rpb24geShkKSB7CiAgcmV0dXJuIGQueSArIGQudnk7Cn0KCmZ1bmN0aW9uIGNvbGxpZGUocmFkaXVzKSB7CiAgdmFyIG5vZGVzLAogICAgICByYWRpaSwKICAgICAgc3RyZW5ndGggPSAxLAogICAgICBpdGVyYXRpb25zID0gMTsKCiAgaWYgKHR5cGVvZiByYWRpdXMgIT09ICJmdW5jdGlvbiIpIHJhZGl1cyA9IGNvbnN0YW50JDcocmFkaXVzID09IG51bGwgPyAxIDogK3JhZGl1cyk7CgogIGZ1bmN0aW9uIGZvcmNlKCkgewogICAgdmFyIGksIG4gPSBub2Rlcy5sZW5ndGgsCiAgICAgICAgdHJlZSwKICAgICAgICBub2RlLAogICAgICAgIHhpLAogICAgICAgIHlpLAogICAgICAgIHJpLAogICAgICAgIHJpMjsKCiAgICBmb3IgKHZhciBrID0gMDsgayA8IGl0ZXJhdGlvbnM7ICsraykgewogICAgICB0cmVlID0gcXVhZHRyZWUobm9kZXMsIHgsIHkpLnZpc2l0QWZ0ZXIocHJlcGFyZSk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgICBub2RlID0gbm9kZXNbaV07CiAgICAgICAgcmkgPSByYWRpaVtub2RlLmluZGV4XSwgcmkyID0gcmkgKiByaTsKICAgICAgICB4aSA9IG5vZGUueCArIG5vZGUudng7CiAgICAgICAgeWkgPSBub2RlLnkgKyBub2RlLnZ5OwogICAgICAgIHRyZWUudmlzaXQoYXBwbHkpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYXBwbHkocXVhZCwgeDAsIHkwLCB4MSwgeTEpIHsKICAgICAgdmFyIGRhdGEgPSBxdWFkLmRhdGEsIHJqID0gcXVhZC5yLCByID0gcmkgKyByajsKICAgICAgaWYgKGRhdGEpIHsKICAgICAgICBpZiAoZGF0YS5pbmRleCA+IG5vZGUuaW5kZXgpIHsKICAgICAgICAgIHZhciB4ID0geGkgLSBkYXRhLnggLSBkYXRhLnZ4LAogICAgICAgICAgICAgIHkgPSB5aSAtIGRhdGEueSAtIGRhdGEudnksCiAgICAgICAgICAgICAgbCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICBpZiAobCA8IHIgKiByKSB7CiAgICAgICAgICAgIGlmICh4ID09PSAwKSB4ID0gamlnZ2xlKCksIGwgKz0geCAqIHg7CiAgICAgICAgICAgIGlmICh5ID09PSAwKSB5ID0gamlnZ2xlKCksIGwgKz0geSAqIHk7CiAgICAgICAgICAgIGwgPSAociAtIChsID0gTWF0aC5zcXJ0KGwpKSkgLyBsICogc3RyZW5ndGg7CiAgICAgICAgICAgIG5vZGUudnggKz0gKHggKj0gbCkgKiAociA9IChyaiAqPSByaikgLyAocmkyICsgcmopKTsKICAgICAgICAgICAgbm9kZS52eSArPSAoeSAqPSBsKSAqIHI7CiAgICAgICAgICAgIGRhdGEudnggLT0geCAqIChyID0gMSAtIHIpOwogICAgICAgICAgICBkYXRhLnZ5IC09IHkgKiByOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgcmV0dXJuIHgwID4geGkgKyByIHx8IHgxIDwgeGkgLSByIHx8IHkwID4geWkgKyByIHx8IHkxIDwgeWkgLSByOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcHJlcGFyZShxdWFkKSB7CiAgICBpZiAocXVhZC5kYXRhKSByZXR1cm4gcXVhZC5yID0gcmFkaWlbcXVhZC5kYXRhLmluZGV4XTsKICAgIGZvciAodmFyIGkgPSBxdWFkLnIgPSAwOyBpIDwgNDsgKytpKSB7CiAgICAgIGlmIChxdWFkW2ldICYmIHF1YWRbaV0uciA+IHF1YWQucikgewogICAgICAgIHF1YWQuciA9IHF1YWRbaV0ucjsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHsKICAgIGlmICghbm9kZXMpIHJldHVybjsKICAgIHZhciBpLCBuID0gbm9kZXMubGVuZ3RoLCBub2RlOwogICAgcmFkaWkgPSBuZXcgQXJyYXkobik7CiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSBub2RlID0gbm9kZXNbaV0sIHJhZGlpW25vZGUuaW5kZXhdID0gK3JhZGl1cyhub2RlLCBpLCBub2Rlcyk7CiAgfQoKICBmb3JjZS5pbml0aWFsaXplID0gZnVuY3Rpb24oXykgewogICAgbm9kZXMgPSBfOwogICAgaW5pdGlhbGl6ZSgpOwogIH07CgogIGZvcmNlLml0ZXJhdGlvbnMgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpdGVyYXRpb25zID0gK18sIGZvcmNlKSA6IGl0ZXJhdGlvbnM7CiAgfTsKCiAgZm9yY2Uuc3RyZW5ndGggPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChzdHJlbmd0aCA9ICtfLCBmb3JjZSkgOiBzdHJlbmd0aDsKICB9OwoKICBmb3JjZS5yYWRpdXMgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChyYWRpdXMgPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQ3KCtfKSwgaW5pdGlhbGl6ZSgpLCBmb3JjZSkgOiByYWRpdXM7CiAgfTsKCiAgcmV0dXJuIGZvcmNlOwp9CgpmdW5jdGlvbiBpbmRleChkKSB7CiAgcmV0dXJuIGQuaW5kZXg7Cn0KCmZ1bmN0aW9uIGZpbmQobm9kZUJ5SWQsIG5vZGVJZCkgewogIHZhciBub2RlID0gbm9kZUJ5SWQuZ2V0KG5vZGVJZCk7CiAgaWYgKCFub2RlKSB0aHJvdyBuZXcgRXJyb3IoIm1pc3Npbmc6ICIgKyBub2RlSWQpOwogIHJldHVybiBub2RlOwp9CgpmdW5jdGlvbiBsaW5rKGxpbmtzKSB7CiAgdmFyIGlkID0gaW5kZXgsCiAgICAgIHN0cmVuZ3RoID0gZGVmYXVsdFN0cmVuZ3RoLAogICAgICBzdHJlbmd0aHMsCiAgICAgIGRpc3RhbmNlID0gY29uc3RhbnQkNygzMCksCiAgICAgIGRpc3RhbmNlcywKICAgICAgbm9kZXMsCiAgICAgIGNvdW50LAogICAgICBiaWFzLAogICAgICBpdGVyYXRpb25zID0gMTsKCiAgaWYgKGxpbmtzID09IG51bGwpIGxpbmtzID0gW107CgogIGZ1bmN0aW9uIGRlZmF1bHRTdHJlbmd0aChsaW5rKSB7CiAgICByZXR1cm4gMSAvIE1hdGgubWluKGNvdW50W2xpbmsuc291cmNlLmluZGV4XSwgY291bnRbbGluay50YXJnZXQuaW5kZXhdKTsKICB9CgogIGZ1bmN0aW9uIGZvcmNlKGFscGhhKSB7CiAgICBmb3IgKHZhciBrID0gMCwgbiA9IGxpbmtzLmxlbmd0aDsgayA8IGl0ZXJhdGlvbnM7ICsraykgewogICAgICBmb3IgKHZhciBpID0gMCwgbGluaywgc291cmNlLCB0YXJnZXQsIHgsIHksIGwsIGI7IGkgPCBuOyArK2kpIHsKICAgICAgICBsaW5rID0gbGlua3NbaV0sIHNvdXJjZSA9IGxpbmsuc291cmNlLCB0YXJnZXQgPSBsaW5rLnRhcmdldDsKICAgICAgICB4ID0gdGFyZ2V0LnggKyB0YXJnZXQudnggLSBzb3VyY2UueCAtIHNvdXJjZS52eCB8fCBqaWdnbGUoKTsKICAgICAgICB5ID0gdGFyZ2V0LnkgKyB0YXJnZXQudnkgLSBzb3VyY2UueSAtIHNvdXJjZS52eSB8fCBqaWdnbGUoKTsKICAgICAgICBsID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkpOwogICAgICAgIGwgPSAobCAtIGRpc3RhbmNlc1tpXSkgLyBsICogYWxwaGEgKiBzdHJlbmd0aHNbaV07CiAgICAgICAgeCAqPSBsLCB5ICo9IGw7CiAgICAgICAgdGFyZ2V0LnZ4IC09IHggKiAoYiA9IGJpYXNbaV0pOwogICAgICAgIHRhcmdldC52eSAtPSB5ICogYjsKICAgICAgICBzb3VyY2UudnggKz0geCAqIChiID0gMSAtIGIpOwogICAgICAgIHNvdXJjZS52eSArPSB5ICogYjsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHsKICAgIGlmICghbm9kZXMpIHJldHVybjsKCiAgICB2YXIgaSwKICAgICAgICBuID0gbm9kZXMubGVuZ3RoLAogICAgICAgIG0gPSBsaW5rcy5sZW5ndGgsCiAgICAgICAgbm9kZUJ5SWQgPSBtYXAkMShub2RlcywgaWQpLAogICAgICAgIGxpbms7CgogICAgZm9yIChpID0gMCwgY291bnQgPSBuZXcgQXJyYXkobik7IGkgPCBtOyArK2kpIHsKICAgICAgbGluayA9IGxpbmtzW2ldLCBsaW5rLmluZGV4ID0gaTsKICAgICAgaWYgKHR5cGVvZiBsaW5rLnNvdXJjZSAhPT0gIm9iamVjdCIpIGxpbmsuc291cmNlID0gZmluZChub2RlQnlJZCwgbGluay5zb3VyY2UpOwogICAgICBpZiAodHlwZW9mIGxpbmsudGFyZ2V0ICE9PSAib2JqZWN0IikgbGluay50YXJnZXQgPSBmaW5kKG5vZGVCeUlkLCBsaW5rLnRhcmdldCk7CiAgICAgIGNvdW50W2xpbmsuc291cmNlLmluZGV4XSA9IChjb3VudFtsaW5rLnNvdXJjZS5pbmRleF0gfHwgMCkgKyAxOwogICAgICBjb3VudFtsaW5rLnRhcmdldC5pbmRleF0gPSAoY291bnRbbGluay50YXJnZXQuaW5kZXhdIHx8IDApICsgMTsKICAgIH0KCiAgICBmb3IgKGkgPSAwLCBiaWFzID0gbmV3IEFycmF5KG0pOyBpIDwgbTsgKytpKSB7CiAgICAgIGxpbmsgPSBsaW5rc1tpXSwgYmlhc1tpXSA9IGNvdW50W2xpbmsuc291cmNlLmluZGV4XSAvIChjb3VudFtsaW5rLnNvdXJjZS5pbmRleF0gKyBjb3VudFtsaW5rLnRhcmdldC5pbmRleF0pOwogICAgfQoKICAgIHN0cmVuZ3RocyA9IG5ldyBBcnJheShtKSwgaW5pdGlhbGl6ZVN0cmVuZ3RoKCk7CiAgICBkaXN0YW5jZXMgPSBuZXcgQXJyYXkobSksIGluaXRpYWxpemVEaXN0YW5jZSgpOwogIH0KCiAgZnVuY3Rpb24gaW5pdGlhbGl6ZVN0cmVuZ3RoKCkgewogICAgaWYgKCFub2RlcykgcmV0dXJuOwoKICAgIGZvciAodmFyIGkgPSAwLCBuID0gbGlua3MubGVuZ3RoOyBpIDwgbjsgKytpKSB7CiAgICAgIHN0cmVuZ3Roc1tpXSA9ICtzdHJlbmd0aChsaW5rc1tpXSwgaSwgbGlua3MpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdGlhbGl6ZURpc3RhbmNlKCkgewogICAgaWYgKCFub2RlcykgcmV0dXJuOwoKICAgIGZvciAodmFyIGkgPSAwLCBuID0gbGlua3MubGVuZ3RoOyBpIDwgbjsgKytpKSB7CiAgICAgIGRpc3RhbmNlc1tpXSA9ICtkaXN0YW5jZShsaW5rc1tpXSwgaSwgbGlua3MpOwogICAgfQogIH0KCiAgZm9yY2UuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKF8pIHsKICAgIG5vZGVzID0gXzsKICAgIGluaXRpYWxpemUoKTsKICB9OwoKICBmb3JjZS5saW5rcyA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGxpbmtzID0gXywgaW5pdGlhbGl6ZSgpLCBmb3JjZSkgOiBsaW5rczsKICB9OwoKICBmb3JjZS5pZCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGlkID0gXywgZm9yY2UpIDogaWQ7CiAgfTsKCiAgZm9yY2UuaXRlcmF0aW9ucyA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGl0ZXJhdGlvbnMgPSArXywgZm9yY2UpIDogaXRlcmF0aW9uczsKICB9OwoKICBmb3JjZS5zdHJlbmd0aCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHN0cmVuZ3RoID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkNygrXyksIGluaXRpYWxpemVTdHJlbmd0aCgpLCBmb3JjZSkgOiBzdHJlbmd0aDsKICB9OwoKICBmb3JjZS5kaXN0YW5jZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGRpc3RhbmNlID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkNygrXyksIGluaXRpYWxpemVEaXN0YW5jZSgpLCBmb3JjZSkgOiBkaXN0YW5jZTsKICB9OwoKICByZXR1cm4gZm9yY2U7Cn0KCmZ1bmN0aW9uIHgkMShkKSB7CiAgcmV0dXJuIGQueDsKfQoKZnVuY3Rpb24geSQxKGQpIHsKICByZXR1cm4gZC55Owp9Cgp2YXIgaW5pdGlhbFJhZGl1cyA9IDEwLAogICAgaW5pdGlhbEFuZ2xlID0gTWF0aC5QSSAqICgzIC0gTWF0aC5zcXJ0KDUpKTsKCmZ1bmN0aW9uIHNpbXVsYXRpb24obm9kZXMpIHsKICB2YXIgc2ltdWxhdGlvbiwKICAgICAgYWxwaGEgPSAxLAogICAgICBhbHBoYU1pbiA9IDAuMDAxLAogICAgICBhbHBoYURlY2F5ID0gMSAtIE1hdGgucG93KGFscGhhTWluLCAxIC8gMzAwKSwKICAgICAgYWxwaGFUYXJnZXQgPSAwLAogICAgICB2ZWxvY2l0eURlY2F5ID0gMC42LAogICAgICBmb3JjZXMgPSBtYXAkMSgpLAogICAgICBzdGVwcGVyID0gdGltZXIoc3RlcCksCiAgICAgIGV2ZW50ID0gZGlzcGF0Y2goInRpY2siLCAiZW5kIik7CgogIGlmIChub2RlcyA9PSBudWxsKSBub2RlcyA9IFtdOwoKICBmdW5jdGlvbiBzdGVwKCkgewogICAgdGljaygpOwogICAgZXZlbnQuY2FsbCgidGljayIsIHNpbXVsYXRpb24pOwogICAgaWYgKGFscGhhIDwgYWxwaGFNaW4pIHsKICAgICAgc3RlcHBlci5zdG9wKCk7CiAgICAgIGV2ZW50LmNhbGwoImVuZCIsIHNpbXVsYXRpb24pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdGljaygpIHsKICAgIHZhciBpLCBuID0gbm9kZXMubGVuZ3RoLCBub2RlOwoKICAgIGFscGhhICs9IChhbHBoYVRhcmdldCAtIGFscGhhKSAqIGFscGhhRGVjYXk7CgogICAgZm9yY2VzLmVhY2goZnVuY3Rpb24oZm9yY2UpIHsKICAgICAgZm9yY2UoYWxwaGEpOwogICAgfSk7CgogICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICBub2RlID0gbm9kZXNbaV07CiAgICAgIGlmIChub2RlLmZ4ID09IG51bGwpIG5vZGUueCArPSBub2RlLnZ4ICo9IHZlbG9jaXR5RGVjYXk7CiAgICAgIGVsc2Ugbm9kZS54ID0gbm9kZS5meCwgbm9kZS52eCA9IDA7CiAgICAgIGlmIChub2RlLmZ5ID09IG51bGwpIG5vZGUueSArPSBub2RlLnZ5ICo9IHZlbG9jaXR5RGVjYXk7CiAgICAgIGVsc2Ugbm9kZS55ID0gbm9kZS5meSwgbm9kZS52eSA9IDA7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbml0aWFsaXplTm9kZXMoKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbiA9IG5vZGVzLmxlbmd0aCwgbm9kZTsgaSA8IG47ICsraSkgewogICAgICBub2RlID0gbm9kZXNbaV0sIG5vZGUuaW5kZXggPSBpOwogICAgICBpZiAoaXNOYU4obm9kZS54KSB8fCBpc05hTihub2RlLnkpKSB7CiAgICAgICAgdmFyIHJhZGl1cyA9IGluaXRpYWxSYWRpdXMgKiBNYXRoLnNxcnQoaSksIGFuZ2xlID0gaSAqIGluaXRpYWxBbmdsZTsKICAgICAgICBub2RlLnggPSByYWRpdXMgKiBNYXRoLmNvcyhhbmdsZSk7CiAgICAgICAgbm9kZS55ID0gcmFkaXVzICogTWF0aC5zaW4oYW5nbGUpOwogICAgICB9CiAgICAgIGlmIChpc05hTihub2RlLnZ4KSB8fCBpc05hTihub2RlLnZ5KSkgewogICAgICAgIG5vZGUudnggPSBub2RlLnZ5ID0gMDsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdGlhbGl6ZUZvcmNlKGZvcmNlKSB7CiAgICBpZiAoZm9yY2UuaW5pdGlhbGl6ZSkgZm9yY2UuaW5pdGlhbGl6ZShub2Rlcyk7CiAgICByZXR1cm4gZm9yY2U7CiAgfQoKICBpbml0aWFsaXplTm9kZXMoKTsKCiAgcmV0dXJuIHNpbXVsYXRpb24gPSB7CiAgICB0aWNrOiB0aWNrLAoKICAgIHJlc3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc3RlcHBlci5yZXN0YXJ0KHN0ZXApLCBzaW11bGF0aW9uOwogICAgfSwKCiAgICBzdG9wOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHN0ZXBwZXIuc3RvcCgpLCBzaW11bGF0aW9uOwogICAgfSwKCiAgICBub2RlczogZnVuY3Rpb24oXykgewogICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChub2RlcyA9IF8sIGluaXRpYWxpemVOb2RlcygpLCBmb3JjZXMuZWFjaChpbml0aWFsaXplRm9yY2UpLCBzaW11bGF0aW9uKSA6IG5vZGVzOwogICAgfSwKCiAgICBhbHBoYTogZnVuY3Rpb24oXykgewogICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChhbHBoYSA9ICtfLCBzaW11bGF0aW9uKSA6IGFscGhhOwogICAgfSwKCiAgICBhbHBoYU1pbjogZnVuY3Rpb24oXykgewogICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChhbHBoYU1pbiA9ICtfLCBzaW11bGF0aW9uKSA6IGFscGhhTWluOwogICAgfSwKCiAgICBhbHBoYURlY2F5OiBmdW5jdGlvbihfKSB7CiAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGFscGhhRGVjYXkgPSArXywgc2ltdWxhdGlvbikgOiArYWxwaGFEZWNheTsKICAgIH0sCgogICAgYWxwaGFUYXJnZXQ6IGZ1bmN0aW9uKF8pIHsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoYWxwaGFUYXJnZXQgPSArXywgc2ltdWxhdGlvbikgOiBhbHBoYVRhcmdldDsKICAgIH0sCgogICAgdmVsb2NpdHlEZWNheTogZnVuY3Rpb24oXykgewogICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh2ZWxvY2l0eURlY2F5ID0gMSAtIF8sIHNpbXVsYXRpb24pIDogMSAtIHZlbG9jaXR5RGVjYXk7CiAgICB9LAoKICAgIGZvcmNlOiBmdW5jdGlvbihuYW1lLCBfKSB7CiAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID4gMSA/IChfID09IG51bGwgPyBmb3JjZXMucmVtb3ZlKG5hbWUpIDogZm9yY2VzLnNldChuYW1lLCBpbml0aWFsaXplRm9yY2UoXykpLCBzaW11bGF0aW9uKSA6IGZvcmNlcy5nZXQobmFtZSk7CiAgICB9LAoKICAgIGZpbmQ6IGZ1bmN0aW9uKHgsIHksIHJhZGl1cykgewogICAgICB2YXIgaSA9IDAsCiAgICAgICAgICBuID0gbm9kZXMubGVuZ3RoLAogICAgICAgICAgZHgsCiAgICAgICAgICBkeSwKICAgICAgICAgIGQyLAogICAgICAgICAgbm9kZSwKICAgICAgICAgIGNsb3Nlc3Q7CgogICAgICBpZiAocmFkaXVzID09IG51bGwpIHJhZGl1cyA9IEluZmluaXR5OwogICAgICBlbHNlIHJhZGl1cyAqPSByYWRpdXM7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgICAgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIGR4ID0geCAtIG5vZGUueDsKICAgICAgICBkeSA9IHkgLSBub2RlLnk7CiAgICAgICAgZDIgPSBkeCAqIGR4ICsgZHkgKiBkeTsKICAgICAgICBpZiAoZDIgPCByYWRpdXMpIGNsb3Nlc3QgPSBub2RlLCByYWRpdXMgPSBkMjsKICAgICAgfQoKICAgICAgcmV0dXJuIGNsb3Nlc3Q7CiAgICB9LAoKICAgIG9uOiBmdW5jdGlvbihuYW1lLCBfKSB7CiAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID4gMSA/IChldmVudC5vbihuYW1lLCBfKSwgc2ltdWxhdGlvbikgOiBldmVudC5vbihuYW1lKTsKICAgIH0KICB9Owp9CgpmdW5jdGlvbiBtYW55Qm9keSgpIHsKICB2YXIgbm9kZXMsCiAgICAgIG5vZGUsCiAgICAgIGFscGhhLAogICAgICBzdHJlbmd0aCA9IGNvbnN0YW50JDcoLTMwKSwKICAgICAgc3RyZW5ndGhzLAogICAgICBkaXN0YW5jZU1pbjIgPSAxLAogICAgICBkaXN0YW5jZU1heDIgPSBJbmZpbml0eSwKICAgICAgdGhldGEyID0gMC44MTsKCiAgZnVuY3Rpb24gZm9yY2UoXykgewogICAgdmFyIGksIG4gPSBub2Rlcy5sZW5ndGgsIHRyZWUgPSBxdWFkdHJlZShub2RlcywgeCQxLCB5JDEpLnZpc2l0QWZ0ZXIoYWNjdW11bGF0ZSk7CiAgICBmb3IgKGFscGhhID0gXywgaSA9IDA7IGkgPCBuOyArK2kpIG5vZGUgPSBub2Rlc1tpXSwgdHJlZS52aXNpdChhcHBseSk7CiAgfQoKICBmdW5jdGlvbiBpbml0aWFsaXplKCkgewogICAgaWYgKCFub2RlcykgcmV0dXJuOwogICAgdmFyIGksIG4gPSBub2Rlcy5sZW5ndGgsIG5vZGU7CiAgICBzdHJlbmd0aHMgPSBuZXcgQXJyYXkobik7CiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSBub2RlID0gbm9kZXNbaV0sIHN0cmVuZ3Roc1tub2RlLmluZGV4XSA9ICtzdHJlbmd0aChub2RlLCBpLCBub2Rlcyk7CiAgfQoKICBmdW5jdGlvbiBhY2N1bXVsYXRlKHF1YWQpIHsKICAgIHZhciBzdHJlbmd0aCA9IDAsIHEsIGMsIHdlaWdodCA9IDAsIHgsIHksIGk7CgogICAgLy8gRm9yIGludGVybmFsIG5vZGVzLCBhY2N1bXVsYXRlIGZvcmNlcyBmcm9tIGNoaWxkIHF1YWRyYW50cy4KICAgIGlmIChxdWFkLmxlbmd0aCkgewogICAgICBmb3IgKHggPSB5ID0gaSA9IDA7IGkgPCA0OyArK2kpIHsKICAgICAgICBpZiAoKHEgPSBxdWFkW2ldKSAmJiAoYyA9IE1hdGguYWJzKHEudmFsdWUpKSkgewogICAgICAgICAgc3RyZW5ndGggKz0gcS52YWx1ZSwgd2VpZ2h0ICs9IGMsIHggKz0gYyAqIHEueCwgeSArPSBjICogcS55OwogICAgICAgIH0KICAgICAgfQogICAgICBxdWFkLnggPSB4IC8gd2VpZ2h0OwogICAgICBxdWFkLnkgPSB5IC8gd2VpZ2h0OwogICAgfQoKICAgIC8vIEZvciBsZWFmIG5vZGVzLCBhY2N1bXVsYXRlIGZvcmNlcyBmcm9tIGNvaW5jaWRlbnQgcXVhZHJhbnRzLgogICAgZWxzZSB7CiAgICAgIHEgPSBxdWFkOwogICAgICBxLnggPSBxLmRhdGEueDsKICAgICAgcS55ID0gcS5kYXRhLnk7CiAgICAgIGRvIHN0cmVuZ3RoICs9IHN0cmVuZ3Roc1txLmRhdGEuaW5kZXhdOwogICAgICB3aGlsZSAocSA9IHEubmV4dCk7CiAgICB9CgogICAgcXVhZC52YWx1ZSA9IHN0cmVuZ3RoOwogIH0KCiAgZnVuY3Rpb24gYXBwbHkocXVhZCwgeDEsIF8sIHgyKSB7CiAgICBpZiAoIXF1YWQudmFsdWUpIHJldHVybiB0cnVlOwoKICAgIHZhciB4ID0gcXVhZC54IC0gbm9kZS54LAogICAgICAgIHkgPSBxdWFkLnkgLSBub2RlLnksCiAgICAgICAgdyA9IHgyIC0geDEsCiAgICAgICAgbCA9IHggKiB4ICsgeSAqIHk7CgogICAgLy8gQXBwbHkgdGhlIEJhcm5lcy1IdXQgYXBwcm94aW1hdGlvbiBpZiBwb3NzaWJsZS4KICAgIC8vIExpbWl0IGZvcmNlcyBmb3IgdmVyeSBjbG9zZSBub2RlczsgcmFuZG9taXplIGRpcmVjdGlvbiBpZiBjb2luY2lkZW50LgogICAgaWYgKHcgKiB3IC8gdGhldGEyIDwgbCkgewogICAgICBpZiAobCA8IGRpc3RhbmNlTWF4MikgewogICAgICAgIGlmICh4ID09PSAwKSB4ID0gamlnZ2xlKCksIGwgKz0geCAqIHg7CiAgICAgICAgaWYgKHkgPT09IDApIHkgPSBqaWdnbGUoKSwgbCArPSB5ICogeTsKICAgICAgICBpZiAobCA8IGRpc3RhbmNlTWluMikgbCA9IE1hdGguc3FydChkaXN0YW5jZU1pbjIgKiBsKTsKICAgICAgICBub2RlLnZ4ICs9IHggKiBxdWFkLnZhbHVlICogYWxwaGEgLyBsOwogICAgICAgIG5vZGUudnkgKz0geSAqIHF1YWQudmFsdWUgKiBhbHBoYSAvIGw7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gT3RoZXJ3aXNlLCBwcm9jZXNzIHBvaW50cyBkaXJlY3RseS4KICAgIGVsc2UgaWYgKHF1YWQubGVuZ3RoIHx8IGwgPj0gZGlzdGFuY2VNYXgyKSByZXR1cm47CgogICAgLy8gTGltaXQgZm9yY2VzIGZvciB2ZXJ5IGNsb3NlIG5vZGVzOyByYW5kb21pemUgZGlyZWN0aW9uIGlmIGNvaW5jaWRlbnQuCiAgICBpZiAocXVhZC5kYXRhICE9PSBub2RlIHx8IHF1YWQubmV4dCkgewogICAgICBpZiAoeCA9PT0gMCkgeCA9IGppZ2dsZSgpLCBsICs9IHggKiB4OwogICAgICBpZiAoeSA9PT0gMCkgeSA9IGppZ2dsZSgpLCBsICs9IHkgKiB5OwogICAgICBpZiAobCA8IGRpc3RhbmNlTWluMikgbCA9IE1hdGguc3FydChkaXN0YW5jZU1pbjIgKiBsKTsKICAgIH0KCiAgICBkbyBpZiAocXVhZC5kYXRhICE9PSBub2RlKSB7CiAgICAgIHcgPSBzdHJlbmd0aHNbcXVhZC5kYXRhLmluZGV4XSAqIGFscGhhIC8gbDsKICAgICAgbm9kZS52eCArPSB4ICogdzsKICAgICAgbm9kZS52eSArPSB5ICogdzsKICAgIH0gd2hpbGUgKHF1YWQgPSBxdWFkLm5leHQpOwogIH0KCiAgZm9yY2UuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKF8pIHsKICAgIG5vZGVzID0gXzsKICAgIGluaXRpYWxpemUoKTsKICB9OwoKICBmb3JjZS5zdHJlbmd0aCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHN0cmVuZ3RoID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkNygrXyksIGluaXRpYWxpemUoKSwgZm9yY2UpIDogc3RyZW5ndGg7CiAgfTsKCiAgZm9yY2UuZGlzdGFuY2VNaW4gPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChkaXN0YW5jZU1pbjIgPSBfICogXywgZm9yY2UpIDogTWF0aC5zcXJ0KGRpc3RhbmNlTWluMik7CiAgfTsKCiAgZm9yY2UuZGlzdGFuY2VNYXggPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChkaXN0YW5jZU1heDIgPSBfICogXywgZm9yY2UpIDogTWF0aC5zcXJ0KGRpc3RhbmNlTWF4Mik7CiAgfTsKCiAgZm9yY2UudGhldGEgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0aGV0YTIgPSBfICogXywgZm9yY2UpIDogTWF0aC5zcXJ0KHRoZXRhMik7CiAgfTsKCiAgcmV0dXJuIGZvcmNlOwp9CgpmdW5jdGlvbiByYWRpYWwocmFkaXVzLCB4LCB5KSB7CiAgdmFyIG5vZGVzLAogICAgICBzdHJlbmd0aCA9IGNvbnN0YW50JDcoMC4xKSwKICAgICAgc3RyZW5ndGhzLAogICAgICByYWRpdXNlczsKCiAgaWYgKHR5cGVvZiByYWRpdXMgIT09ICJmdW5jdGlvbiIpIHJhZGl1cyA9IGNvbnN0YW50JDcoK3JhZGl1cyk7CiAgaWYgKHggPT0gbnVsbCkgeCA9IDA7CiAgaWYgKHkgPT0gbnVsbCkgeSA9IDA7CgogIGZ1bmN0aW9uIGZvcmNlKGFscGhhKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbiA9IG5vZGVzLmxlbmd0aDsgaSA8IG47ICsraSkgewogICAgICB2YXIgbm9kZSA9IG5vZGVzW2ldLAogICAgICAgICAgZHggPSBub2RlLnggLSB4IHx8IDFlLTYsCiAgICAgICAgICBkeSA9IG5vZGUueSAtIHkgfHwgMWUtNiwKICAgICAgICAgIHIgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpLAogICAgICAgICAgayA9IChyYWRpdXNlc1tpXSAtIHIpICogc3RyZW5ndGhzW2ldICogYWxwaGEgLyByOwogICAgICBub2RlLnZ4ICs9IGR4ICogazsKICAgICAgbm9kZS52eSArPSBkeSAqIGs7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbml0aWFsaXplKCkgewogICAgaWYgKCFub2RlcykgcmV0dXJuOwogICAgdmFyIGksIG4gPSBub2Rlcy5sZW5ndGg7CiAgICBzdHJlbmd0aHMgPSBuZXcgQXJyYXkobik7CiAgICByYWRpdXNlcyA9IG5ldyBBcnJheShuKTsKICAgIGZvciAoaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgcmFkaXVzZXNbaV0gPSArcmFkaXVzKG5vZGVzW2ldLCBpLCBub2Rlcyk7CiAgICAgIHN0cmVuZ3Roc1tpXSA9IGlzTmFOKHJhZGl1c2VzW2ldKSA/IDAgOiArc3RyZW5ndGgobm9kZXNbaV0sIGksIG5vZGVzKTsKICAgIH0KICB9CgogIGZvcmNlLmluaXRpYWxpemUgPSBmdW5jdGlvbihfKSB7CiAgICBub2RlcyA9IF8sIGluaXRpYWxpemUoKTsKICB9OwoKICBmb3JjZS5zdHJlbmd0aCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHN0cmVuZ3RoID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkNygrXyksIGluaXRpYWxpemUoKSwgZm9yY2UpIDogc3RyZW5ndGg7CiAgfTsKCiAgZm9yY2UucmFkaXVzID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocmFkaXVzID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkNygrXyksIGluaXRpYWxpemUoKSwgZm9yY2UpIDogcmFkaXVzOwogIH07CgogIGZvcmNlLnggPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh4ID0gK18sIGZvcmNlKSA6IHg7CiAgfTsKCiAgZm9yY2UueSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHkgPSArXywgZm9yY2UpIDogeTsKICB9OwoKICByZXR1cm4gZm9yY2U7Cn0KCmZ1bmN0aW9uIHgkMih4KSB7CiAgdmFyIHN0cmVuZ3RoID0gY29uc3RhbnQkNygwLjEpLAogICAgICBub2RlcywKICAgICAgc3RyZW5ndGhzLAogICAgICB4ejsKCiAgaWYgKHR5cGVvZiB4ICE9PSAiZnVuY3Rpb24iKSB4ID0gY29uc3RhbnQkNyh4ID09IG51bGwgPyAwIDogK3gpOwoKICBmdW5jdGlvbiBmb3JjZShhbHBoYSkgewogICAgZm9yICh2YXIgaSA9IDAsIG4gPSBub2Rlcy5sZW5ndGgsIG5vZGU7IGkgPCBuOyArK2kpIHsKICAgICAgbm9kZSA9IG5vZGVzW2ldLCBub2RlLnZ4ICs9ICh4eltpXSAtIG5vZGUueCkgKiBzdHJlbmd0aHNbaV0gKiBhbHBoYTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7CiAgICBpZiAoIW5vZGVzKSByZXR1cm47CiAgICB2YXIgaSwgbiA9IG5vZGVzLmxlbmd0aDsKICAgIHN0cmVuZ3RocyA9IG5ldyBBcnJheShuKTsKICAgIHh6ID0gbmV3IEFycmF5KG4pOwogICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICBzdHJlbmd0aHNbaV0gPSBpc05hTih4eltpXSA9ICt4KG5vZGVzW2ldLCBpLCBub2RlcykpID8gMCA6ICtzdHJlbmd0aChub2Rlc1tpXSwgaSwgbm9kZXMpOwogICAgfQogIH0KCiAgZm9yY2UuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKF8pIHsKICAgIG5vZGVzID0gXzsKICAgIGluaXRpYWxpemUoKTsKICB9OwoKICBmb3JjZS5zdHJlbmd0aCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHN0cmVuZ3RoID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkNygrXyksIGluaXRpYWxpemUoKSwgZm9yY2UpIDogc3RyZW5ndGg7CiAgfTsKCiAgZm9yY2UueCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHggPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQ3KCtfKSwgaW5pdGlhbGl6ZSgpLCBmb3JjZSkgOiB4OwogIH07CgogIHJldHVybiBmb3JjZTsKfQoKZnVuY3Rpb24geSQyKHkpIHsKICB2YXIgc3RyZW5ndGggPSBjb25zdGFudCQ3KDAuMSksCiAgICAgIG5vZGVzLAogICAgICBzdHJlbmd0aHMsCiAgICAgIHl6OwoKICBpZiAodHlwZW9mIHkgIT09ICJmdW5jdGlvbiIpIHkgPSBjb25zdGFudCQ3KHkgPT0gbnVsbCA/IDAgOiAreSk7CgogIGZ1bmN0aW9uIGZvcmNlKGFscGhhKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbiA9IG5vZGVzLmxlbmd0aCwgbm9kZTsgaSA8IG47ICsraSkgewogICAgICBub2RlID0gbm9kZXNbaV0sIG5vZGUudnkgKz0gKHl6W2ldIC0gbm9kZS55KSAqIHN0cmVuZ3Roc1tpXSAqIGFscGhhOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHsKICAgIGlmICghbm9kZXMpIHJldHVybjsKICAgIHZhciBpLCBuID0gbm9kZXMubGVuZ3RoOwogICAgc3RyZW5ndGhzID0gbmV3IEFycmF5KG4pOwogICAgeXogPSBuZXcgQXJyYXkobik7CiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgIHN0cmVuZ3Roc1tpXSA9IGlzTmFOKHl6W2ldID0gK3kobm9kZXNbaV0sIGksIG5vZGVzKSkgPyAwIDogK3N0cmVuZ3RoKG5vZGVzW2ldLCBpLCBub2Rlcyk7CiAgICB9CiAgfQoKICBmb3JjZS5pbml0aWFsaXplID0gZnVuY3Rpb24oXykgewogICAgbm9kZXMgPSBfOwogICAgaW5pdGlhbGl6ZSgpOwogIH07CgogIGZvcmNlLnN0cmVuZ3RoID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoc3RyZW5ndGggPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQ3KCtfKSwgaW5pdGlhbGl6ZSgpLCBmb3JjZSkgOiBzdHJlbmd0aDsKICB9OwoKICBmb3JjZS55ID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoeSA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IGNvbnN0YW50JDcoK18pLCBpbml0aWFsaXplKCksIGZvcmNlKSA6IHk7CiAgfTsKCiAgcmV0dXJuIGZvcmNlOwp9CgovLyBDb21wdXRlcyB0aGUgZGVjaW1hbCBjb2VmZmljaWVudCBhbmQgZXhwb25lbnQgb2YgdGhlIHNwZWNpZmllZCBudW1iZXIgeCB3aXRoCi8vIHNpZ25pZmljYW50IGRpZ2l0cyBwLCB3aGVyZSB4IGlzIHBvc2l0aXZlIGFuZCBwIGlzIGluIFsxLCAyMV0gb3IgdW5kZWZpbmVkLgovLyBGb3IgZXhhbXBsZSwgZm9ybWF0RGVjaW1hbCgxLjIzKSByZXR1cm5zIFsiMTIzIiwgMF0uCmZ1bmN0aW9uIGZvcm1hdERlY2ltYWwoeCwgcCkgewogIGlmICgoaSA9ICh4ID0gcCA/IHgudG9FeHBvbmVudGlhbChwIC0gMSkgOiB4LnRvRXhwb25lbnRpYWwoKSkuaW5kZXhPZigiZSIpKSA8IDApIHJldHVybiBudWxsOyAvLyBOYU4sIMKxSW5maW5pdHkKICB2YXIgaSwgY29lZmZpY2llbnQgPSB4LnNsaWNlKDAsIGkpOwoKICAvLyBUaGUgc3RyaW5nIHJldHVybmVkIGJ5IHRvRXhwb25lbnRpYWwgZWl0aGVyIGhhcyB0aGUgZm9ybSBcZFwuXGQrZVstK11cZCsKICAvLyAoZS5nLiwgMS4yZSszKSBvciB0aGUgZm9ybSBcZGVbLStdXGQrIChlLmcuLCAxZSszKS4KICByZXR1cm4gWwogICAgY29lZmZpY2llbnQubGVuZ3RoID4gMSA/IGNvZWZmaWNpZW50WzBdICsgY29lZmZpY2llbnQuc2xpY2UoMikgOiBjb2VmZmljaWVudCwKICAgICt4LnNsaWNlKGkgKyAxKQogIF07Cn0KCmZ1bmN0aW9uIGV4cG9uZW50JDEoeCkgewogIHJldHVybiB4ID0gZm9ybWF0RGVjaW1hbChNYXRoLmFicyh4KSksIHggPyB4WzFdIDogTmFOOwp9CgpmdW5jdGlvbiBmb3JtYXRHcm91cChncm91cGluZywgdGhvdXNhbmRzKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlLCB3aWR0aCkgewogICAgdmFyIGkgPSB2YWx1ZS5sZW5ndGgsCiAgICAgICAgdCA9IFtdLAogICAgICAgIGogPSAwLAogICAgICAgIGcgPSBncm91cGluZ1swXSwKICAgICAgICBsZW5ndGggPSAwOwoKICAgIHdoaWxlIChpID4gMCAmJiBnID4gMCkgewogICAgICBpZiAobGVuZ3RoICsgZyArIDEgPiB3aWR0aCkgZyA9IE1hdGgubWF4KDEsIHdpZHRoIC0gbGVuZ3RoKTsKICAgICAgdC5wdXNoKHZhbHVlLnN1YnN0cmluZyhpIC09IGcsIGkgKyBnKSk7CiAgICAgIGlmICgobGVuZ3RoICs9IGcgKyAxKSA+IHdpZHRoKSBicmVhazsKICAgICAgZyA9IGdyb3VwaW5nW2ogPSAoaiArIDEpICUgZ3JvdXBpbmcubGVuZ3RoXTsKICAgIH0KCiAgICByZXR1cm4gdC5yZXZlcnNlKCkuam9pbih0aG91c2FuZHMpOwogIH07Cn0KCmZ1bmN0aW9uIGZvcm1hdE51bWVyYWxzKG51bWVyYWxzKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICByZXR1cm4gdmFsdWUucmVwbGFjZSgvWzAtOV0vZywgZnVuY3Rpb24oaSkgewogICAgICByZXR1cm4gbnVtZXJhbHNbK2ldOwogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gZm9ybWF0RGVmYXVsdCh4LCBwKSB7CiAgeCA9IHgudG9QcmVjaXNpb24ocCk7CgogIG91dDogZm9yICh2YXIgbiA9IHgubGVuZ3RoLCBpID0gMSwgaTAgPSAtMSwgaTE7IGkgPCBuOyArK2kpIHsKICAgIHN3aXRjaCAoeFtpXSkgewogICAgICBjYXNlICIuIjogaTAgPSBpMSA9IGk7IGJyZWFrOwogICAgICBjYXNlICIwIjogaWYgKGkwID09PSAwKSBpMCA9IGk7IGkxID0gaTsgYnJlYWs7CiAgICAgIGNhc2UgImUiOiBicmVhayBvdXQ7CiAgICAgIGRlZmF1bHQ6IGlmIChpMCA+IDApIGkwID0gMDsgYnJlYWs7CiAgICB9CiAgfQoKICByZXR1cm4gaTAgPiAwID8geC5zbGljZSgwLCBpMCkgKyB4LnNsaWNlKGkxICsgMSkgOiB4Owp9Cgp2YXIgcHJlZml4RXhwb25lbnQ7CgpmdW5jdGlvbiBmb3JtYXRQcmVmaXhBdXRvKHgsIHApIHsKICB2YXIgZCA9IGZvcm1hdERlY2ltYWwoeCwgcCk7CiAgaWYgKCFkKSByZXR1cm4geCArICIiOwogIHZhciBjb2VmZmljaWVudCA9IGRbMF0sCiAgICAgIGV4cG9uZW50ID0gZFsxXSwKICAgICAgaSA9IGV4cG9uZW50IC0gKHByZWZpeEV4cG9uZW50ID0gTWF0aC5tYXgoLTgsIE1hdGgubWluKDgsIE1hdGguZmxvb3IoZXhwb25lbnQgLyAzKSkpICogMykgKyAxLAogICAgICBuID0gY29lZmZpY2llbnQubGVuZ3RoOwogIHJldHVybiBpID09PSBuID8gY29lZmZpY2llbnQKICAgICAgOiBpID4gbiA/IGNvZWZmaWNpZW50ICsgbmV3IEFycmF5KGkgLSBuICsgMSkuam9pbigiMCIpCiAgICAgIDogaSA+IDAgPyBjb2VmZmljaWVudC5zbGljZSgwLCBpKSArICIuIiArIGNvZWZmaWNpZW50LnNsaWNlKGkpCiAgICAgIDogIjAuIiArIG5ldyBBcnJheSgxIC0gaSkuam9pbigiMCIpICsgZm9ybWF0RGVjaW1hbCh4LCBNYXRoLm1heCgwLCBwICsgaSAtIDEpKVswXTsgLy8gbGVzcyB0aGFuIDF5IQp9CgpmdW5jdGlvbiBmb3JtYXRSb3VuZGVkKHgsIHApIHsKICB2YXIgZCA9IGZvcm1hdERlY2ltYWwoeCwgcCk7CiAgaWYgKCFkKSByZXR1cm4geCArICIiOwogIHZhciBjb2VmZmljaWVudCA9IGRbMF0sCiAgICAgIGV4cG9uZW50ID0gZFsxXTsKICByZXR1cm4gZXhwb25lbnQgPCAwID8gIjAuIiArIG5ldyBBcnJheSgtZXhwb25lbnQpLmpvaW4oIjAiKSArIGNvZWZmaWNpZW50CiAgICAgIDogY29lZmZpY2llbnQubGVuZ3RoID4gZXhwb25lbnQgKyAxID8gY29lZmZpY2llbnQuc2xpY2UoMCwgZXhwb25lbnQgKyAxKSArICIuIiArIGNvZWZmaWNpZW50LnNsaWNlKGV4cG9uZW50ICsgMSkKICAgICAgOiBjb2VmZmljaWVudCArIG5ldyBBcnJheShleHBvbmVudCAtIGNvZWZmaWNpZW50Lmxlbmd0aCArIDIpLmpvaW4oIjAiKTsKfQoKdmFyIGZvcm1hdFR5cGVzID0gewogICIiOiBmb3JtYXREZWZhdWx0LAogICIlIjogZnVuY3Rpb24oeCwgcCkgeyByZXR1cm4gKHggKiAxMDApLnRvRml4ZWQocCk7IH0sCiAgImIiOiBmdW5jdGlvbih4KSB7IHJldHVybiBNYXRoLnJvdW5kKHgpLnRvU3RyaW5nKDIpOyB9LAogICJjIjogZnVuY3Rpb24oeCkgeyByZXR1cm4geCArICIiOyB9LAogICJkIjogZnVuY3Rpb24oeCkgeyByZXR1cm4gTWF0aC5yb3VuZCh4KS50b1N0cmluZygxMCk7IH0sCiAgImUiOiBmdW5jdGlvbih4LCBwKSB7IHJldHVybiB4LnRvRXhwb25lbnRpYWwocCk7IH0sCiAgImYiOiBmdW5jdGlvbih4LCBwKSB7IHJldHVybiB4LnRvRml4ZWQocCk7IH0sCiAgImciOiBmdW5jdGlvbih4LCBwKSB7IHJldHVybiB4LnRvUHJlY2lzaW9uKHApOyB9LAogICJvIjogZnVuY3Rpb24oeCkgeyByZXR1cm4gTWF0aC5yb3VuZCh4KS50b1N0cmluZyg4KTsgfSwKICAicCI6IGZ1bmN0aW9uKHgsIHApIHsgcmV0dXJuIGZvcm1hdFJvdW5kZWQoeCAqIDEwMCwgcCk7IH0sCiAgInIiOiBmb3JtYXRSb3VuZGVkLAogICJzIjogZm9ybWF0UHJlZml4QXV0bywKICAiWCI6IGZ1bmN0aW9uKHgpIHsgcmV0dXJuIE1hdGgucm91bmQoeCkudG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCk7IH0sCiAgIngiOiBmdW5jdGlvbih4KSB7IHJldHVybiBNYXRoLnJvdW5kKHgpLnRvU3RyaW5nKDE2KTsgfQp9OwoKLy8gW1tmaWxsXWFsaWduXVtzaWduXVtzeW1ib2xdWzBdW3dpZHRoXVssXVsucHJlY2lzaW9uXVt0eXBlXQp2YXIgcmUgPSAvXig/OiguKT8oWzw+PV5dKSk/KFsrXC1cKCBdKT8oWyQjXSk/KDApPyhcZCspPygsKT8oXC5cZCspPyhbYS16JV0pPyQvaTsKCmZ1bmN0aW9uIGZvcm1hdFNwZWNpZmllcihzcGVjaWZpZXIpIHsKICByZXR1cm4gbmV3IEZvcm1hdFNwZWNpZmllcihzcGVjaWZpZXIpOwp9Cgpmb3JtYXRTcGVjaWZpZXIucHJvdG90eXBlID0gRm9ybWF0U3BlY2lmaWVyLnByb3RvdHlwZTsgLy8gaW5zdGFuY2VvZgoKZnVuY3Rpb24gRm9ybWF0U3BlY2lmaWVyKHNwZWNpZmllcikgewogIGlmICghKG1hdGNoID0gcmUuZXhlYyhzcGVjaWZpZXIpKSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGZvcm1hdDogIiArIHNwZWNpZmllcik7CgogIHZhciBtYXRjaCwKICAgICAgZmlsbCA9IG1hdGNoWzFdIHx8ICIgIiwKICAgICAgYWxpZ24gPSBtYXRjaFsyXSB8fCAiPiIsCiAgICAgIHNpZ24gPSBtYXRjaFszXSB8fCAiLSIsCiAgICAgIHN5bWJvbCA9IG1hdGNoWzRdIHx8ICIiLAogICAgICB6ZXJvID0gISFtYXRjaFs1XSwKICAgICAgd2lkdGggPSBtYXRjaFs2XSAmJiArbWF0Y2hbNl0sCiAgICAgIGNvbW1hID0gISFtYXRjaFs3XSwKICAgICAgcHJlY2lzaW9uID0gbWF0Y2hbOF0gJiYgK21hdGNoWzhdLnNsaWNlKDEpLAogICAgICB0eXBlID0gbWF0Y2hbOV0gfHwgIiI7CgogIC8vIFRoZSAibiIgdHlwZSBpcyBhbiBhbGlhcyBmb3IgIixnIi4KICBpZiAodHlwZSA9PT0gIm4iKSBjb21tYSA9IHRydWUsIHR5cGUgPSAiZyI7CgogIC8vIE1hcCBpbnZhbGlkIHR5cGVzIHRvIHRoZSBkZWZhdWx0IGZvcm1hdC4KICBlbHNlIGlmICghZm9ybWF0VHlwZXNbdHlwZV0pIHR5cGUgPSAiIjsKCiAgLy8gSWYgemVybyBmaWxsIGlzIHNwZWNpZmllZCwgcGFkZGluZyBnb2VzIGFmdGVyIHNpZ24gYW5kIGJlZm9yZSBkaWdpdHMuCiAgaWYgKHplcm8gfHwgKGZpbGwgPT09ICIwIiAmJiBhbGlnbiA9PT0gIj0iKSkgemVybyA9IHRydWUsIGZpbGwgPSAiMCIsIGFsaWduID0gIj0iOwoKICB0aGlzLmZpbGwgPSBmaWxsOwogIHRoaXMuYWxpZ24gPSBhbGlnbjsKICB0aGlzLnNpZ24gPSBzaWduOwogIHRoaXMuc3ltYm9sID0gc3ltYm9sOwogIHRoaXMuemVybyA9IHplcm87CiAgdGhpcy53aWR0aCA9IHdpZHRoOwogIHRoaXMuY29tbWEgPSBjb21tYTsKICB0aGlzLnByZWNpc2lvbiA9IHByZWNpc2lvbjsKICB0aGlzLnR5cGUgPSB0eXBlOwp9CgpGb3JtYXRTcGVjaWZpZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMuZmlsbAogICAgICArIHRoaXMuYWxpZ24KICAgICAgKyB0aGlzLnNpZ24KICAgICAgKyB0aGlzLnN5bWJvbAogICAgICArICh0aGlzLnplcm8gPyAiMCIgOiAiIikKICAgICAgKyAodGhpcy53aWR0aCA9PSBudWxsID8gIiIgOiBNYXRoLm1heCgxLCB0aGlzLndpZHRoIHwgMCkpCiAgICAgICsgKHRoaXMuY29tbWEgPyAiLCIgOiAiIikKICAgICAgKyAodGhpcy5wcmVjaXNpb24gPT0gbnVsbCA/ICIiIDogIi4iICsgTWF0aC5tYXgoMCwgdGhpcy5wcmVjaXNpb24gfCAwKSkKICAgICAgKyB0aGlzLnR5cGU7Cn07CgpmdW5jdGlvbiBpZGVudGl0eSQzKHgpIHsKICByZXR1cm4geDsKfQoKdmFyIHByZWZpeGVzID0gWyJ5IiwieiIsImEiLCJmIiwicCIsIm4iLCJceEI1IiwibSIsIiIsImsiLCJNIiwiRyIsIlQiLCJQIiwiRSIsIloiLCJZIl07CgpmdW5jdGlvbiBmb3JtYXRMb2NhbGUobG9jYWxlKSB7CiAgdmFyIGdyb3VwID0gbG9jYWxlLmdyb3VwaW5nICYmIGxvY2FsZS50aG91c2FuZHMgPyBmb3JtYXRHcm91cChsb2NhbGUuZ3JvdXBpbmcsIGxvY2FsZS50aG91c2FuZHMpIDogaWRlbnRpdHkkMywKICAgICAgY3VycmVuY3kgPSBsb2NhbGUuY3VycmVuY3ksCiAgICAgIGRlY2ltYWwgPSBsb2NhbGUuZGVjaW1hbCwKICAgICAgbnVtZXJhbHMgPSBsb2NhbGUubnVtZXJhbHMgPyBmb3JtYXROdW1lcmFscyhsb2NhbGUubnVtZXJhbHMpIDogaWRlbnRpdHkkMywKICAgICAgcGVyY2VudCA9IGxvY2FsZS5wZXJjZW50IHx8ICIlIjsKCiAgZnVuY3Rpb24gbmV3Rm9ybWF0KHNwZWNpZmllcikgewogICAgc3BlY2lmaWVyID0gZm9ybWF0U3BlY2lmaWVyKHNwZWNpZmllcik7CgogICAgdmFyIGZpbGwgPSBzcGVjaWZpZXIuZmlsbCwKICAgICAgICBhbGlnbiA9IHNwZWNpZmllci5hbGlnbiwKICAgICAgICBzaWduID0gc3BlY2lmaWVyLnNpZ24sCiAgICAgICAgc3ltYm9sID0gc3BlY2lmaWVyLnN5bWJvbCwKICAgICAgICB6ZXJvID0gc3BlY2lmaWVyLnplcm8sCiAgICAgICAgd2lkdGggPSBzcGVjaWZpZXIud2lkdGgsCiAgICAgICAgY29tbWEgPSBzcGVjaWZpZXIuY29tbWEsCiAgICAgICAgcHJlY2lzaW9uID0gc3BlY2lmaWVyLnByZWNpc2lvbiwKICAgICAgICB0eXBlID0gc3BlY2lmaWVyLnR5cGU7CgogICAgLy8gQ29tcHV0ZSB0aGUgcHJlZml4IGFuZCBzdWZmaXguCiAgICAvLyBGb3IgU0ktcHJlZml4LCB0aGUgc3VmZml4IGlzIGxhemlseSBjb21wdXRlZC4KICAgIHZhciBwcmVmaXggPSBzeW1ib2wgPT09ICIkIiA/IGN1cnJlbmN5WzBdIDogc3ltYm9sID09PSAiIyIgJiYgL1tib3hYXS8udGVzdCh0eXBlKSA/ICIwIiArIHR5cGUudG9Mb3dlckNhc2UoKSA6ICIiLAogICAgICAgIHN1ZmZpeCA9IHN5bWJvbCA9PT0gIiQiID8gY3VycmVuY3lbMV0gOiAvWyVwXS8udGVzdCh0eXBlKSA/IHBlcmNlbnQgOiAiIjsKCiAgICAvLyBXaGF0IGZvcm1hdCBmdW5jdGlvbiBzaG91bGQgd2UgdXNlPwogICAgLy8gSXMgdGhpcyBhbiBpbnRlZ2VyIHR5cGU/CiAgICAvLyBDYW4gdGhpcyB0eXBlIGdlbmVyYXRlIGV4cG9uZW50aWFsIG5vdGF0aW9uPwogICAgdmFyIGZvcm1hdFR5cGUgPSBmb3JtYXRUeXBlc1t0eXBlXSwKICAgICAgICBtYXliZVN1ZmZpeCA9ICF0eXBlIHx8IC9bZGVmZ3BycyVdLy50ZXN0KHR5cGUpOwoKICAgIC8vIFNldCB0aGUgZGVmYXVsdCBwcmVjaXNpb24gaWYgbm90IHNwZWNpZmllZCwKICAgIC8vIG9yIGNsYW1wIHRoZSBzcGVjaWZpZWQgcHJlY2lzaW9uIHRvIHRoZSBzdXBwb3J0ZWQgcmFuZ2UuCiAgICAvLyBGb3Igc2lnbmlmaWNhbnQgcHJlY2lzaW9uLCBpdCBtdXN0IGJlIGluIFsxLCAyMV0uCiAgICAvLyBGb3IgZml4ZWQgcHJlY2lzaW9uLCBpdCBtdXN0IGJlIGluIFswLCAyMF0uCiAgICBwcmVjaXNpb24gPSBwcmVjaXNpb24gPT0gbnVsbCA/ICh0eXBlID8gNiA6IDEyKQogICAgICAgIDogL1tncHJzXS8udGVzdCh0eXBlKSA/IE1hdGgubWF4KDEsIE1hdGgubWluKDIxLCBwcmVjaXNpb24pKQogICAgICAgIDogTWF0aC5tYXgoMCwgTWF0aC5taW4oMjAsIHByZWNpc2lvbikpOwoKICAgIGZ1bmN0aW9uIGZvcm1hdCh2YWx1ZSkgewogICAgICB2YXIgdmFsdWVQcmVmaXggPSBwcmVmaXgsCiAgICAgICAgICB2YWx1ZVN1ZmZpeCA9IHN1ZmZpeCwKICAgICAgICAgIGksIG4sIGM7CgogICAgICBpZiAodHlwZSA9PT0gImMiKSB7CiAgICAgICAgdmFsdWVTdWZmaXggPSBmb3JtYXRUeXBlKHZhbHVlKSArIHZhbHVlU3VmZml4OwogICAgICAgIHZhbHVlID0gIiI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFsdWUgPSArdmFsdWU7CgogICAgICAgIC8vIFBlcmZvcm0gdGhlIGluaXRpYWwgZm9ybWF0dGluZy4KICAgICAgICB2YXIgdmFsdWVOZWdhdGl2ZSA9IHZhbHVlIDwgMDsKICAgICAgICB2YWx1ZSA9IGZvcm1hdFR5cGUoTWF0aC5hYnModmFsdWUpLCBwcmVjaXNpb24pOwoKICAgICAgICAvLyBJZiBhIG5lZ2F0aXZlIHZhbHVlIHJvdW5kcyB0byB6ZXJvIGR1cmluZyBmb3JtYXR0aW5nLCB0cmVhdCBhcyBwb3NpdGl2ZS4KICAgICAgICBpZiAodmFsdWVOZWdhdGl2ZSAmJiArdmFsdWUgPT09IDApIHZhbHVlTmVnYXRpdmUgPSBmYWxzZTsKCiAgICAgICAgLy8gQ29tcHV0ZSB0aGUgcHJlZml4IGFuZCBzdWZmaXguCiAgICAgICAgdmFsdWVQcmVmaXggPSAodmFsdWVOZWdhdGl2ZSA/IChzaWduID09PSAiKCIgPyBzaWduIDogIi0iKSA6IHNpZ24gPT09ICItIiB8fCBzaWduID09PSAiKCIgPyAiIiA6IHNpZ24pICsgdmFsdWVQcmVmaXg7CiAgICAgICAgdmFsdWVTdWZmaXggPSAodHlwZSA9PT0gInMiID8gcHJlZml4ZXNbOCArIHByZWZpeEV4cG9uZW50IC8gM10gOiAiIikgKyB2YWx1ZVN1ZmZpeCArICh2YWx1ZU5lZ2F0aXZlICYmIHNpZ24gPT09ICIoIiA/ICIpIiA6ICIiKTsKCiAgICAgICAgLy8gQnJlYWsgdGhlIGZvcm1hdHRlZCB2YWx1ZSBpbnRvIHRoZSBpbnRlZ2VyIOKAnHZhbHVl4oCdIHBhcnQgdGhhdCBjYW4gYmUKICAgICAgICAvLyBncm91cGVkLCBhbmQgZnJhY3Rpb25hbCBvciBleHBvbmVudGlhbCDigJxzdWZmaXjigJ0gcGFydCB0aGF0IGlzIG5vdC4KICAgICAgICBpZiAobWF5YmVTdWZmaXgpIHsKICAgICAgICAgIGkgPSAtMSwgbiA9IHZhbHVlLmxlbmd0aDsKICAgICAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgICAgIGlmIChjID0gdmFsdWUuY2hhckNvZGVBdChpKSwgNDggPiBjIHx8IGMgPiA1NykgewogICAgICAgICAgICAgIHZhbHVlU3VmZml4ID0gKGMgPT09IDQ2ID8gZGVjaW1hbCArIHZhbHVlLnNsaWNlKGkgKyAxKSA6IHZhbHVlLnNsaWNlKGkpKSArIHZhbHVlU3VmZml4OwogICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuc2xpY2UoMCwgaSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIElmIHRoZSBmaWxsIGNoYXJhY3RlciBpcyBub3QgIjAiLCBncm91cGluZyBpcyBhcHBsaWVkIGJlZm9yZSBwYWRkaW5nLgogICAgICBpZiAoY29tbWEgJiYgIXplcm8pIHZhbHVlID0gZ3JvdXAodmFsdWUsIEluZmluaXR5KTsKCiAgICAgIC8vIENvbXB1dGUgdGhlIHBhZGRpbmcuCiAgICAgIHZhciBsZW5ndGggPSB2YWx1ZVByZWZpeC5sZW5ndGggKyB2YWx1ZS5sZW5ndGggKyB2YWx1ZVN1ZmZpeC5sZW5ndGgsCiAgICAgICAgICBwYWRkaW5nID0gbGVuZ3RoIDwgd2lkdGggPyBuZXcgQXJyYXkod2lkdGggLSBsZW5ndGggKyAxKS5qb2luKGZpbGwpIDogIiI7CgogICAgICAvLyBJZiB0aGUgZmlsbCBjaGFyYWN0ZXIgaXMgIjAiLCBncm91cGluZyBpcyBhcHBsaWVkIGFmdGVyIHBhZGRpbmcuCiAgICAgIGlmIChjb21tYSAmJiB6ZXJvKSB2YWx1ZSA9IGdyb3VwKHBhZGRpbmcgKyB2YWx1ZSwgcGFkZGluZy5sZW5ndGggPyB3aWR0aCAtIHZhbHVlU3VmZml4Lmxlbmd0aCA6IEluZmluaXR5KSwgcGFkZGluZyA9ICIiOwoKICAgICAgLy8gUmVjb25zdHJ1Y3QgdGhlIGZpbmFsIG91dHB1dCBiYXNlZCBvbiB0aGUgZGVzaXJlZCBhbGlnbm1lbnQuCiAgICAgIHN3aXRjaCAoYWxpZ24pIHsKICAgICAgICBjYXNlICI8IjogdmFsdWUgPSB2YWx1ZVByZWZpeCArIHZhbHVlICsgdmFsdWVTdWZmaXggKyBwYWRkaW5nOyBicmVhazsKICAgICAgICBjYXNlICI9IjogdmFsdWUgPSB2YWx1ZVByZWZpeCArIHBhZGRpbmcgKyB2YWx1ZSArIHZhbHVlU3VmZml4OyBicmVhazsKICAgICAgICBjYXNlICJeIjogdmFsdWUgPSBwYWRkaW5nLnNsaWNlKDAsIGxlbmd0aCA9IHBhZGRpbmcubGVuZ3RoID4+IDEpICsgdmFsdWVQcmVmaXggKyB2YWx1ZSArIHZhbHVlU3VmZml4ICsgcGFkZGluZy5zbGljZShsZW5ndGgpOyBicmVhazsKICAgICAgICBkZWZhdWx0OiB2YWx1ZSA9IHBhZGRpbmcgKyB2YWx1ZVByZWZpeCArIHZhbHVlICsgdmFsdWVTdWZmaXg7IGJyZWFrOwogICAgICB9CgogICAgICByZXR1cm4gbnVtZXJhbHModmFsdWUpOwogICAgfQoKICAgIGZvcm1hdC50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc3BlY2lmaWVyICsgIiI7CiAgICB9OwoKICAgIHJldHVybiBmb3JtYXQ7CiAgfQoKICBmdW5jdGlvbiBmb3JtYXRQcmVmaXgoc3BlY2lmaWVyLCB2YWx1ZSkgewogICAgdmFyIGYgPSBuZXdGb3JtYXQoKHNwZWNpZmllciA9IGZvcm1hdFNwZWNpZmllcihzcGVjaWZpZXIpLCBzcGVjaWZpZXIudHlwZSA9ICJmIiwgc3BlY2lmaWVyKSksCiAgICAgICAgZSA9IE1hdGgubWF4KC04LCBNYXRoLm1pbig4LCBNYXRoLmZsb29yKGV4cG9uZW50JDEodmFsdWUpIC8gMykpKSAqIDMsCiAgICAgICAgayA9IE1hdGgucG93KDEwLCAtZSksCiAgICAgICAgcHJlZml4ID0gcHJlZml4ZXNbOCArIGUgLyAzXTsKICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gZihrICogdmFsdWUpICsgcHJlZml4OwogICAgfTsKICB9CgogIHJldHVybiB7CiAgICBmb3JtYXQ6IG5ld0Zvcm1hdCwKICAgIGZvcm1hdFByZWZpeDogZm9ybWF0UHJlZml4CiAgfTsKfQoKdmFyIGxvY2FsZTsKCmRlZmF1bHRMb2NhbGUoewogIGRlY2ltYWw6ICIuIiwKICB0aG91c2FuZHM6ICIsIiwKICBncm91cGluZzogWzNdLAogIGN1cnJlbmN5OiBbIiQiLCAiIl0KfSk7CgpmdW5jdGlvbiBkZWZhdWx0TG9jYWxlKGRlZmluaXRpb24pIHsKICBsb2NhbGUgPSBmb3JtYXRMb2NhbGUoZGVmaW5pdGlvbik7CiAgZXhwb3J0cy5mb3JtYXQgPSBsb2NhbGUuZm9ybWF0OwogIGV4cG9ydHMuZm9ybWF0UHJlZml4ID0gbG9jYWxlLmZvcm1hdFByZWZpeDsKICByZXR1cm4gbG9jYWxlOwp9CgpmdW5jdGlvbiBwcmVjaXNpb25GaXhlZChzdGVwKSB7CiAgcmV0dXJuIE1hdGgubWF4KDAsIC1leHBvbmVudCQxKE1hdGguYWJzKHN0ZXApKSk7Cn0KCmZ1bmN0aW9uIHByZWNpc2lvblByZWZpeChzdGVwLCB2YWx1ZSkgewogIHJldHVybiBNYXRoLm1heCgwLCBNYXRoLm1heCgtOCwgTWF0aC5taW4oOCwgTWF0aC5mbG9vcihleHBvbmVudCQxKHZhbHVlKSAvIDMpKSkgKiAzIC0gZXhwb25lbnQkMShNYXRoLmFicyhzdGVwKSkpOwp9CgpmdW5jdGlvbiBwcmVjaXNpb25Sb3VuZChzdGVwLCBtYXgpIHsKICBzdGVwID0gTWF0aC5hYnMoc3RlcCksIG1heCA9IE1hdGguYWJzKG1heCkgLSBzdGVwOwogIHJldHVybiBNYXRoLm1heCgwLCBleHBvbmVudCQxKG1heCkgLSBleHBvbmVudCQxKHN0ZXApKSArIDE7Cn0KCi8vIEFkZHMgZmxvYXRpbmcgcG9pbnQgbnVtYmVycyB3aXRoIHR3aWNlIHRoZSBub3JtYWwgcHJlY2lzaW9uLgovLyBSZWZlcmVuY2U6IEouIFIuIFNoZXdjaHVrLCBBZGFwdGl2ZSBQcmVjaXNpb24gRmxvYXRpbmctUG9pbnQgQXJpdGhtZXRpYyBhbmQKLy8gRmFzdCBSb2J1c3QgR2VvbWV0cmljIFByZWRpY2F0ZXMsIERpc2NyZXRlICYgQ29tcHV0YXRpb25hbCBHZW9tZXRyeSAxOCgzKQovLyAzMDXigJMzNjMgKDE5OTcpLgovLyBDb2RlIGFkYXB0ZWQgZnJvbSBHZW9ncmFwaGljTGliIGJ5IENoYXJsZXMgRi4gRi4gS2FybmV5LAovLyBodHRwOi8vZ2VvZ3JhcGhpY2xpYi5zb3VyY2Vmb3JnZS5uZXQvCgpmdW5jdGlvbiBhZGRlcigpIHsKICByZXR1cm4gbmV3IEFkZGVyOwp9CgpmdW5jdGlvbiBBZGRlcigpIHsKICB0aGlzLnJlc2V0KCk7Cn0KCkFkZGVyLnByb3RvdHlwZSA9IHsKICBjb25zdHJ1Y3RvcjogQWRkZXIsCiAgcmVzZXQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5zID0gLy8gcm91bmRlZCB2YWx1ZQogICAgdGhpcy50ID0gMDsgLy8gZXhhY3QgZXJyb3IKICB9LAogIGFkZDogZnVuY3Rpb24oeSkgewogICAgYWRkJDEodGVtcCwgeSwgdGhpcy50KTsKICAgIGFkZCQxKHRoaXMsIHRlbXAucywgdGhpcy5zKTsKICAgIGlmICh0aGlzLnMpIHRoaXMudCArPSB0ZW1wLnQ7CiAgICBlbHNlIHRoaXMucyA9IHRlbXAudDsKICB9LAogIHZhbHVlT2Y6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuczsKICB9Cn07Cgp2YXIgdGVtcCA9IG5ldyBBZGRlcjsKCmZ1bmN0aW9uIGFkZCQxKGFkZGVyLCBhLCBiKSB7CiAgdmFyIHggPSBhZGRlci5zID0gYSArIGIsCiAgICAgIGJ2ID0geCAtIGEsCiAgICAgIGF2ID0geCAtIGJ2OwogIGFkZGVyLnQgPSAoYSAtIGF2KSArIChiIC0gYnYpOwp9Cgp2YXIgZXBzaWxvbiQyID0gMWUtNjsKdmFyIGVwc2lsb24yJDEgPSAxZS0xMjsKdmFyIHBpJDMgPSBNYXRoLlBJOwp2YXIgaGFsZlBpJDIgPSBwaSQzIC8gMjsKdmFyIHF1YXJ0ZXJQaSA9IHBpJDMgLyA0Owp2YXIgdGF1JDMgPSBwaSQzICogMjsKCnZhciBkZWdyZWVzJDEgPSAxODAgLyBwaSQzOwp2YXIgcmFkaWFucyA9IHBpJDMgLyAxODA7Cgp2YXIgYWJzID0gTWF0aC5hYnM7CnZhciBhdGFuID0gTWF0aC5hdGFuOwp2YXIgYXRhbjIgPSBNYXRoLmF0YW4yOwp2YXIgY29zJDEgPSBNYXRoLmNvczsKdmFyIGNlaWwgPSBNYXRoLmNlaWw7CnZhciBleHAgPSBNYXRoLmV4cDsKdmFyIGxvZyA9IE1hdGgubG9nOwp2YXIgcG93ID0gTWF0aC5wb3c7CnZhciBzaW4kMSA9IE1hdGguc2luOwp2YXIgc2lnbiA9IE1hdGguc2lnbiB8fCBmdW5jdGlvbih4KSB7IHJldHVybiB4ID4gMCA/IDEgOiB4IDwgMCA/IC0xIDogMDsgfTsKdmFyIHNxcnQgPSBNYXRoLnNxcnQ7CnZhciB0YW4gPSBNYXRoLnRhbjsKCmZ1bmN0aW9uIGFjb3MoeCkgewogIHJldHVybiB4ID4gMSA/IDAgOiB4IDwgLTEgPyBwaSQzIDogTWF0aC5hY29zKHgpOwp9CgpmdW5jdGlvbiBhc2luKHgpIHsKICByZXR1cm4geCA+IDEgPyBoYWxmUGkkMiA6IHggPCAtMSA/IC1oYWxmUGkkMiA6IE1hdGguYXNpbih4KTsKfQoKZnVuY3Rpb24gaGF2ZXJzaW4oeCkgewogIHJldHVybiAoeCA9IHNpbiQxKHggLyAyKSkgKiB4Owp9CgpmdW5jdGlvbiBub29wJDIoKSB7fQoKZnVuY3Rpb24gc3RyZWFtR2VvbWV0cnkoZ2VvbWV0cnksIHN0cmVhbSkgewogIGlmIChnZW9tZXRyeSAmJiBzdHJlYW1HZW9tZXRyeVR5cGUuaGFzT3duUHJvcGVydHkoZ2VvbWV0cnkudHlwZSkpIHsKICAgIHN0cmVhbUdlb21ldHJ5VHlwZVtnZW9tZXRyeS50eXBlXShnZW9tZXRyeSwgc3RyZWFtKTsKICB9Cn0KCnZhciBzdHJlYW1PYmplY3RUeXBlID0gewogIEZlYXR1cmU6IGZ1bmN0aW9uKG9iamVjdCwgc3RyZWFtKSB7CiAgICBzdHJlYW1HZW9tZXRyeShvYmplY3QuZ2VvbWV0cnksIHN0cmVhbSk7CiAgfSwKICBGZWF0dXJlQ29sbGVjdGlvbjogZnVuY3Rpb24ob2JqZWN0LCBzdHJlYW0pIHsKICAgIHZhciBmZWF0dXJlcyA9IG9iamVjdC5mZWF0dXJlcywgaSA9IC0xLCBuID0gZmVhdHVyZXMubGVuZ3RoOwogICAgd2hpbGUgKCsraSA8IG4pIHN0cmVhbUdlb21ldHJ5KGZlYXR1cmVzW2ldLmdlb21ldHJ5LCBzdHJlYW0pOwogIH0KfTsKCnZhciBzdHJlYW1HZW9tZXRyeVR5cGUgPSB7CiAgU3BoZXJlOiBmdW5jdGlvbihvYmplY3QsIHN0cmVhbSkgewogICAgc3RyZWFtLnNwaGVyZSgpOwogIH0sCiAgUG9pbnQ6IGZ1bmN0aW9uKG9iamVjdCwgc3RyZWFtKSB7CiAgICBvYmplY3QgPSBvYmplY3QuY29vcmRpbmF0ZXM7CiAgICBzdHJlYW0ucG9pbnQob2JqZWN0WzBdLCBvYmplY3RbMV0sIG9iamVjdFsyXSk7CiAgfSwKICBNdWx0aVBvaW50OiBmdW5jdGlvbihvYmplY3QsIHN0cmVhbSkgewogICAgdmFyIGNvb3JkaW5hdGVzID0gb2JqZWN0LmNvb3JkaW5hdGVzLCBpID0gLTEsIG4gPSBjb29yZGluYXRlcy5sZW5ndGg7CiAgICB3aGlsZSAoKytpIDwgbikgb2JqZWN0ID0gY29vcmRpbmF0ZXNbaV0sIHN0cmVhbS5wb2ludChvYmplY3RbMF0sIG9iamVjdFsxXSwgb2JqZWN0WzJdKTsKICB9LAogIExpbmVTdHJpbmc6IGZ1bmN0aW9uKG9iamVjdCwgc3RyZWFtKSB7CiAgICBzdHJlYW1MaW5lKG9iamVjdC5jb29yZGluYXRlcywgc3RyZWFtLCAwKTsKICB9LAogIE11bHRpTGluZVN0cmluZzogZnVuY3Rpb24ob2JqZWN0LCBzdHJlYW0pIHsKICAgIHZhciBjb29yZGluYXRlcyA9IG9iamVjdC5jb29yZGluYXRlcywgaSA9IC0xLCBuID0gY29vcmRpbmF0ZXMubGVuZ3RoOwogICAgd2hpbGUgKCsraSA8IG4pIHN0cmVhbUxpbmUoY29vcmRpbmF0ZXNbaV0sIHN0cmVhbSwgMCk7CiAgfSwKICBQb2x5Z29uOiBmdW5jdGlvbihvYmplY3QsIHN0cmVhbSkgewogICAgc3RyZWFtUG9seWdvbihvYmplY3QuY29vcmRpbmF0ZXMsIHN0cmVhbSk7CiAgfSwKICBNdWx0aVBvbHlnb246IGZ1bmN0aW9uKG9iamVjdCwgc3RyZWFtKSB7CiAgICB2YXIgY29vcmRpbmF0ZXMgPSBvYmplY3QuY29vcmRpbmF0ZXMsIGkgPSAtMSwgbiA9IGNvb3JkaW5hdGVzLmxlbmd0aDsKICAgIHdoaWxlICgrK2kgPCBuKSBzdHJlYW1Qb2x5Z29uKGNvb3JkaW5hdGVzW2ldLCBzdHJlYW0pOwogIH0sCiAgR2VvbWV0cnlDb2xsZWN0aW9uOiBmdW5jdGlvbihvYmplY3QsIHN0cmVhbSkgewogICAgdmFyIGdlb21ldHJpZXMgPSBvYmplY3QuZ2VvbWV0cmllcywgaSA9IC0xLCBuID0gZ2VvbWV0cmllcy5sZW5ndGg7CiAgICB3aGlsZSAoKytpIDwgbikgc3RyZWFtR2VvbWV0cnkoZ2VvbWV0cmllc1tpXSwgc3RyZWFtKTsKICB9Cn07CgpmdW5jdGlvbiBzdHJlYW1MaW5lKGNvb3JkaW5hdGVzLCBzdHJlYW0sIGNsb3NlZCkgewogIHZhciBpID0gLTEsIG4gPSBjb29yZGluYXRlcy5sZW5ndGggLSBjbG9zZWQsIGNvb3JkaW5hdGU7CiAgc3RyZWFtLmxpbmVTdGFydCgpOwogIHdoaWxlICgrK2kgPCBuKSBjb29yZGluYXRlID0gY29vcmRpbmF0ZXNbaV0sIHN0cmVhbS5wb2ludChjb29yZGluYXRlWzBdLCBjb29yZGluYXRlWzFdLCBjb29yZGluYXRlWzJdKTsKICBzdHJlYW0ubGluZUVuZCgpOwp9CgpmdW5jdGlvbiBzdHJlYW1Qb2x5Z29uKGNvb3JkaW5hdGVzLCBzdHJlYW0pIHsKICB2YXIgaSA9IC0xLCBuID0gY29vcmRpbmF0ZXMubGVuZ3RoOwogIHN0cmVhbS5wb2x5Z29uU3RhcnQoKTsKICB3aGlsZSAoKytpIDwgbikgc3RyZWFtTGluZShjb29yZGluYXRlc1tpXSwgc3RyZWFtLCAxKTsKICBzdHJlYW0ucG9seWdvbkVuZCgpOwp9CgpmdW5jdGlvbiBnZW9TdHJlYW0ob2JqZWN0LCBzdHJlYW0pIHsKICBpZiAob2JqZWN0ICYmIHN0cmVhbU9iamVjdFR5cGUuaGFzT3duUHJvcGVydHkob2JqZWN0LnR5cGUpKSB7CiAgICBzdHJlYW1PYmplY3RUeXBlW29iamVjdC50eXBlXShvYmplY3QsIHN0cmVhbSk7CiAgfSBlbHNlIHsKICAgIHN0cmVhbUdlb21ldHJ5KG9iamVjdCwgc3RyZWFtKTsKICB9Cn0KCnZhciBhcmVhUmluZ1N1bSA9IGFkZGVyKCk7Cgp2YXIgYXJlYVN1bSA9IGFkZGVyKCksCiAgICBsYW1iZGEwMCwKICAgIHBoaTAwLAogICAgbGFtYmRhMCwKICAgIGNvc1BoaTAsCiAgICBzaW5QaGkwOwoKdmFyIGFyZWFTdHJlYW0gPSB7CiAgcG9pbnQ6IG5vb3AkMiwKICBsaW5lU3RhcnQ6IG5vb3AkMiwKICBsaW5lRW5kOiBub29wJDIsCiAgcG9seWdvblN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIGFyZWFSaW5nU3VtLnJlc2V0KCk7CiAgICBhcmVhU3RyZWFtLmxpbmVTdGFydCA9IGFyZWFSaW5nU3RhcnQ7CiAgICBhcmVhU3RyZWFtLmxpbmVFbmQgPSBhcmVhUmluZ0VuZDsKICB9LAogIHBvbHlnb25FbmQ6IGZ1bmN0aW9uKCkgewogICAgdmFyIGFyZWFSaW5nID0gK2FyZWFSaW5nU3VtOwogICAgYXJlYVN1bS5hZGQoYXJlYVJpbmcgPCAwID8gdGF1JDMgKyBhcmVhUmluZyA6IGFyZWFSaW5nKTsKICAgIHRoaXMubGluZVN0YXJ0ID0gdGhpcy5saW5lRW5kID0gdGhpcy5wb2ludCA9IG5vb3AkMjsKICB9LAogIHNwaGVyZTogZnVuY3Rpb24oKSB7CiAgICBhcmVhU3VtLmFkZCh0YXUkMyk7CiAgfQp9OwoKZnVuY3Rpb24gYXJlYVJpbmdTdGFydCgpIHsKICBhcmVhU3RyZWFtLnBvaW50ID0gYXJlYVBvaW50Rmlyc3Q7Cn0KCmZ1bmN0aW9uIGFyZWFSaW5nRW5kKCkgewogIGFyZWFQb2ludChsYW1iZGEwMCwgcGhpMDApOwp9CgpmdW5jdGlvbiBhcmVhUG9pbnRGaXJzdChsYW1iZGEsIHBoaSkgewogIGFyZWFTdHJlYW0ucG9pbnQgPSBhcmVhUG9pbnQ7CiAgbGFtYmRhMDAgPSBsYW1iZGEsIHBoaTAwID0gcGhpOwogIGxhbWJkYSAqPSByYWRpYW5zLCBwaGkgKj0gcmFkaWFuczsKICBsYW1iZGEwID0gbGFtYmRhLCBjb3NQaGkwID0gY29zJDEocGhpID0gcGhpIC8gMiArIHF1YXJ0ZXJQaSksIHNpblBoaTAgPSBzaW4kMShwaGkpOwp9CgpmdW5jdGlvbiBhcmVhUG9pbnQobGFtYmRhLCBwaGkpIHsKICBsYW1iZGEgKj0gcmFkaWFucywgcGhpICo9IHJhZGlhbnM7CiAgcGhpID0gcGhpIC8gMiArIHF1YXJ0ZXJQaTsgLy8gaGFsZiB0aGUgYW5ndWxhciBkaXN0YW5jZSBmcm9tIHNvdXRoIHBvbGUKCiAgLy8gU3BoZXJpY2FsIGV4Y2VzcyBFIGZvciBhIHNwaGVyaWNhbCB0cmlhbmdsZSB3aXRoIHZlcnRpY2VzOiBzb3V0aCBwb2xlLAogIC8vIHByZXZpb3VzIHBvaW50LCBjdXJyZW50IHBvaW50LiAgVXNlcyBhIGZvcm11bGEgZGVyaXZlZCBmcm9tIENhZ25vbGnigJlzCiAgLy8gdGhlb3JlbS4gIFNlZSBUb2RodW50ZXIsIFNwaGVyaWNhbCBUcmlnLiAoMTg3MSksIFNlYy4gMTAzLCBFcS4gKDIpLgogIHZhciBkTGFtYmRhID0gbGFtYmRhIC0gbGFtYmRhMCwKICAgICAgc2RMYW1iZGEgPSBkTGFtYmRhID49IDAgPyAxIDogLTEsCiAgICAgIGFkTGFtYmRhID0gc2RMYW1iZGEgKiBkTGFtYmRhLAogICAgICBjb3NQaGkgPSBjb3MkMShwaGkpLAogICAgICBzaW5QaGkgPSBzaW4kMShwaGkpLAogICAgICBrID0gc2luUGhpMCAqIHNpblBoaSwKICAgICAgdSA9IGNvc1BoaTAgKiBjb3NQaGkgKyBrICogY29zJDEoYWRMYW1iZGEpLAogICAgICB2ID0gayAqIHNkTGFtYmRhICogc2luJDEoYWRMYW1iZGEpOwogIGFyZWFSaW5nU3VtLmFkZChhdGFuMih2LCB1KSk7CgogIC8vIEFkdmFuY2UgdGhlIHByZXZpb3VzIHBvaW50cy4KICBsYW1iZGEwID0gbGFtYmRhLCBjb3NQaGkwID0gY29zUGhpLCBzaW5QaGkwID0gc2luUGhpOwp9CgpmdW5jdGlvbiBhcmVhJDEob2JqZWN0KSB7CiAgYXJlYVN1bS5yZXNldCgpOwogIGdlb1N0cmVhbShvYmplY3QsIGFyZWFTdHJlYW0pOwogIHJldHVybiBhcmVhU3VtICogMjsKfQoKZnVuY3Rpb24gc3BoZXJpY2FsKGNhcnRlc2lhbikgewogIHJldHVybiBbYXRhbjIoY2FydGVzaWFuWzFdLCBjYXJ0ZXNpYW5bMF0pLCBhc2luKGNhcnRlc2lhblsyXSldOwp9CgpmdW5jdGlvbiBjYXJ0ZXNpYW4oc3BoZXJpY2FsKSB7CiAgdmFyIGxhbWJkYSA9IHNwaGVyaWNhbFswXSwgcGhpID0gc3BoZXJpY2FsWzFdLCBjb3NQaGkgPSBjb3MkMShwaGkpOwogIHJldHVybiBbY29zUGhpICogY29zJDEobGFtYmRhKSwgY29zUGhpICogc2luJDEobGFtYmRhKSwgc2luJDEocGhpKV07Cn0KCmZ1bmN0aW9uIGNhcnRlc2lhbkRvdChhLCBiKSB7CiAgcmV0dXJuIGFbMF0gKiBiWzBdICsgYVsxXSAqIGJbMV0gKyBhWzJdICogYlsyXTsKfQoKZnVuY3Rpb24gY2FydGVzaWFuQ3Jvc3MoYSwgYikgewogIHJldHVybiBbYVsxXSAqIGJbMl0gLSBhWzJdICogYlsxXSwgYVsyXSAqIGJbMF0gLSBhWzBdICogYlsyXSwgYVswXSAqIGJbMV0gLSBhWzFdICogYlswXV07Cn0KCi8vIFRPRE8gcmV0dXJuIGEKZnVuY3Rpb24gY2FydGVzaWFuQWRkSW5QbGFjZShhLCBiKSB7CiAgYVswXSArPSBiWzBdLCBhWzFdICs9IGJbMV0sIGFbMl0gKz0gYlsyXTsKfQoKZnVuY3Rpb24gY2FydGVzaWFuU2NhbGUodmVjdG9yLCBrKSB7CiAgcmV0dXJuIFt2ZWN0b3JbMF0gKiBrLCB2ZWN0b3JbMV0gKiBrLCB2ZWN0b3JbMl0gKiBrXTsKfQoKLy8gVE9ETyByZXR1cm4gZApmdW5jdGlvbiBjYXJ0ZXNpYW5Ob3JtYWxpemVJblBsYWNlKGQpIHsKICB2YXIgbCA9IHNxcnQoZFswXSAqIGRbMF0gKyBkWzFdICogZFsxXSArIGRbMl0gKiBkWzJdKTsKICBkWzBdIC89IGwsIGRbMV0gLz0gbCwgZFsyXSAvPSBsOwp9Cgp2YXIgbGFtYmRhMCQxLCBwaGkwLCBsYW1iZGExLCBwaGkxLCAvLyBib3VuZHMKICAgIGxhbWJkYTIsIC8vIHByZXZpb3VzIGxhbWJkYS1jb29yZGluYXRlCiAgICBsYW1iZGEwMCQxLCBwaGkwMCQxLCAvLyBmaXJzdCBwb2ludAogICAgcDAsIC8vIHByZXZpb3VzIDNEIHBvaW50CiAgICBkZWx0YVN1bSA9IGFkZGVyKCksCiAgICByYW5nZXMsCiAgICByYW5nZTsKCnZhciBib3VuZHNTdHJlYW0gPSB7CiAgcG9pbnQ6IGJvdW5kc1BvaW50LAogIGxpbmVTdGFydDogYm91bmRzTGluZVN0YXJ0LAogIGxpbmVFbmQ6IGJvdW5kc0xpbmVFbmQsCiAgcG9seWdvblN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIGJvdW5kc1N0cmVhbS5wb2ludCA9IGJvdW5kc1JpbmdQb2ludDsKICAgIGJvdW5kc1N0cmVhbS5saW5lU3RhcnQgPSBib3VuZHNSaW5nU3RhcnQ7CiAgICBib3VuZHNTdHJlYW0ubGluZUVuZCA9IGJvdW5kc1JpbmdFbmQ7CiAgICBkZWx0YVN1bS5yZXNldCgpOwogICAgYXJlYVN0cmVhbS5wb2x5Z29uU3RhcnQoKTsKICB9LAogIHBvbHlnb25FbmQ6IGZ1bmN0aW9uKCkgewogICAgYXJlYVN0cmVhbS5wb2x5Z29uRW5kKCk7CiAgICBib3VuZHNTdHJlYW0ucG9pbnQgPSBib3VuZHNQb2ludDsKICAgIGJvdW5kc1N0cmVhbS5saW5lU3RhcnQgPSBib3VuZHNMaW5lU3RhcnQ7CiAgICBib3VuZHNTdHJlYW0ubGluZUVuZCA9IGJvdW5kc0xpbmVFbmQ7CiAgICBpZiAoYXJlYVJpbmdTdW0gPCAwKSBsYW1iZGEwJDEgPSAtKGxhbWJkYTEgPSAxODApLCBwaGkwID0gLShwaGkxID0gOTApOwogICAgZWxzZSBpZiAoZGVsdGFTdW0gPiBlcHNpbG9uJDIpIHBoaTEgPSA5MDsKICAgIGVsc2UgaWYgKGRlbHRhU3VtIDwgLWVwc2lsb24kMikgcGhpMCA9IC05MDsKICAgIHJhbmdlWzBdID0gbGFtYmRhMCQxLCByYW5nZVsxXSA9IGxhbWJkYTE7CiAgfQp9OwoKZnVuY3Rpb24gYm91bmRzUG9pbnQobGFtYmRhLCBwaGkpIHsKICByYW5nZXMucHVzaChyYW5nZSA9IFtsYW1iZGEwJDEgPSBsYW1iZGEsIGxhbWJkYTEgPSBsYW1iZGFdKTsKICBpZiAocGhpIDwgcGhpMCkgcGhpMCA9IHBoaTsKICBpZiAocGhpID4gcGhpMSkgcGhpMSA9IHBoaTsKfQoKZnVuY3Rpb24gbGluZVBvaW50KGxhbWJkYSwgcGhpKSB7CiAgdmFyIHAgPSBjYXJ0ZXNpYW4oW2xhbWJkYSAqIHJhZGlhbnMsIHBoaSAqIHJhZGlhbnNdKTsKICBpZiAocDApIHsKICAgIHZhciBub3JtYWwgPSBjYXJ0ZXNpYW5Dcm9zcyhwMCwgcCksCiAgICAgICAgZXF1YXRvcmlhbCA9IFtub3JtYWxbMV0sIC1ub3JtYWxbMF0sIDBdLAogICAgICAgIGluZmxlY3Rpb24gPSBjYXJ0ZXNpYW5Dcm9zcyhlcXVhdG9yaWFsLCBub3JtYWwpOwogICAgY2FydGVzaWFuTm9ybWFsaXplSW5QbGFjZShpbmZsZWN0aW9uKTsKICAgIGluZmxlY3Rpb24gPSBzcGhlcmljYWwoaW5mbGVjdGlvbik7CiAgICB2YXIgZGVsdGEgPSBsYW1iZGEgLSBsYW1iZGEyLAogICAgICAgIHNpZ24kJDEgPSBkZWx0YSA+IDAgPyAxIDogLTEsCiAgICAgICAgbGFtYmRhaSA9IGluZmxlY3Rpb25bMF0gKiBkZWdyZWVzJDEgKiBzaWduJCQxLAogICAgICAgIHBoaWksCiAgICAgICAgYW50aW1lcmlkaWFuID0gYWJzKGRlbHRhKSA+IDE4MDsKICAgIGlmIChhbnRpbWVyaWRpYW4gXiAoc2lnbiQkMSAqIGxhbWJkYTIgPCBsYW1iZGFpICYmIGxhbWJkYWkgPCBzaWduJCQxICogbGFtYmRhKSkgewogICAgICBwaGlpID0gaW5mbGVjdGlvblsxXSAqIGRlZ3JlZXMkMTsKICAgICAgaWYgKHBoaWkgPiBwaGkxKSBwaGkxID0gcGhpaTsKICAgIH0gZWxzZSBpZiAobGFtYmRhaSA9IChsYW1iZGFpICsgMzYwKSAlIDM2MCAtIDE4MCwgYW50aW1lcmlkaWFuIF4gKHNpZ24kJDEgKiBsYW1iZGEyIDwgbGFtYmRhaSAmJiBsYW1iZGFpIDwgc2lnbiQkMSAqIGxhbWJkYSkpIHsKICAgICAgcGhpaSA9IC1pbmZsZWN0aW9uWzFdICogZGVncmVlcyQxOwogICAgICBpZiAocGhpaSA8IHBoaTApIHBoaTAgPSBwaGlpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHBoaSA8IHBoaTApIHBoaTAgPSBwaGk7CiAgICAgIGlmIChwaGkgPiBwaGkxKSBwaGkxID0gcGhpOwogICAgfQogICAgaWYgKGFudGltZXJpZGlhbikgewogICAgICBpZiAobGFtYmRhIDwgbGFtYmRhMikgewogICAgICAgIGlmIChhbmdsZShsYW1iZGEwJDEsIGxhbWJkYSkgPiBhbmdsZShsYW1iZGEwJDEsIGxhbWJkYTEpKSBsYW1iZGExID0gbGFtYmRhOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChhbmdsZShsYW1iZGEsIGxhbWJkYTEpID4gYW5nbGUobGFtYmRhMCQxLCBsYW1iZGExKSkgbGFtYmRhMCQxID0gbGFtYmRhOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZiAobGFtYmRhMSA+PSBsYW1iZGEwJDEpIHsKICAgICAgICBpZiAobGFtYmRhIDwgbGFtYmRhMCQxKSBsYW1iZGEwJDEgPSBsYW1iZGE7CiAgICAgICAgaWYgKGxhbWJkYSA+IGxhbWJkYTEpIGxhbWJkYTEgPSBsYW1iZGE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGxhbWJkYSA+IGxhbWJkYTIpIHsKICAgICAgICAgIGlmIChhbmdsZShsYW1iZGEwJDEsIGxhbWJkYSkgPiBhbmdsZShsYW1iZGEwJDEsIGxhbWJkYTEpKSBsYW1iZGExID0gbGFtYmRhOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoYW5nbGUobGFtYmRhLCBsYW1iZGExKSA+IGFuZ2xlKGxhbWJkYTAkMSwgbGFtYmRhMSkpIGxhbWJkYTAkMSA9IGxhbWJkYTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9IGVsc2UgewogICAgcmFuZ2VzLnB1c2gocmFuZ2UgPSBbbGFtYmRhMCQxID0gbGFtYmRhLCBsYW1iZGExID0gbGFtYmRhXSk7CiAgfQogIGlmIChwaGkgPCBwaGkwKSBwaGkwID0gcGhpOwogIGlmIChwaGkgPiBwaGkxKSBwaGkxID0gcGhpOwogIHAwID0gcCwgbGFtYmRhMiA9IGxhbWJkYTsKfQoKZnVuY3Rpb24gYm91bmRzTGluZVN0YXJ0KCkgewogIGJvdW5kc1N0cmVhbS5wb2ludCA9IGxpbmVQb2ludDsKfQoKZnVuY3Rpb24gYm91bmRzTGluZUVuZCgpIHsKICByYW5nZVswXSA9IGxhbWJkYTAkMSwgcmFuZ2VbMV0gPSBsYW1iZGExOwogIGJvdW5kc1N0cmVhbS5wb2ludCA9IGJvdW5kc1BvaW50OwogIHAwID0gbnVsbDsKfQoKZnVuY3Rpb24gYm91bmRzUmluZ1BvaW50KGxhbWJkYSwgcGhpKSB7CiAgaWYgKHAwKSB7CiAgICB2YXIgZGVsdGEgPSBsYW1iZGEgLSBsYW1iZGEyOwogICAgZGVsdGFTdW0uYWRkKGFicyhkZWx0YSkgPiAxODAgPyBkZWx0YSArIChkZWx0YSA+IDAgPyAzNjAgOiAtMzYwKSA6IGRlbHRhKTsKICB9IGVsc2UgewogICAgbGFtYmRhMDAkMSA9IGxhbWJkYSwgcGhpMDAkMSA9IHBoaTsKICB9CiAgYXJlYVN0cmVhbS5wb2ludChsYW1iZGEsIHBoaSk7CiAgbGluZVBvaW50KGxhbWJkYSwgcGhpKTsKfQoKZnVuY3Rpb24gYm91bmRzUmluZ1N0YXJ0KCkgewogIGFyZWFTdHJlYW0ubGluZVN0YXJ0KCk7Cn0KCmZ1bmN0aW9uIGJvdW5kc1JpbmdFbmQoKSB7CiAgYm91bmRzUmluZ1BvaW50KGxhbWJkYTAwJDEsIHBoaTAwJDEpOwogIGFyZWFTdHJlYW0ubGluZUVuZCgpOwogIGlmIChhYnMoZGVsdGFTdW0pID4gZXBzaWxvbiQyKSBsYW1iZGEwJDEgPSAtKGxhbWJkYTEgPSAxODApOwogIHJhbmdlWzBdID0gbGFtYmRhMCQxLCByYW5nZVsxXSA9IGxhbWJkYTE7CiAgcDAgPSBudWxsOwp9CgovLyBGaW5kcyB0aGUgbGVmdC1yaWdodCBkaXN0YW5jZSBiZXR3ZWVuIHR3byBsb25naXR1ZGVzLgovLyBUaGlzIGlzIGFsbW9zdCB0aGUgc2FtZSBhcyAobGFtYmRhMSAtIGxhbWJkYTAgKyAzNjDCsCkgJSAzNjDCsCwgZXhjZXB0IHRoYXQgd2Ugd2FudAovLyB0aGUgZGlzdGFuY2UgYmV0d2VlbiDCsTE4MMKwIHRvIGJlIDM2MMKwLgpmdW5jdGlvbiBhbmdsZShsYW1iZGEwLCBsYW1iZGExKSB7CiAgcmV0dXJuIChsYW1iZGExIC09IGxhbWJkYTApIDwgMCA/IGxhbWJkYTEgKyAzNjAgOiBsYW1iZGExOwp9CgpmdW5jdGlvbiByYW5nZUNvbXBhcmUoYSwgYikgewogIHJldHVybiBhWzBdIC0gYlswXTsKfQoKZnVuY3Rpb24gcmFuZ2VDb250YWlucyhyYW5nZSwgeCkgewogIHJldHVybiByYW5nZVswXSA8PSByYW5nZVsxXSA/IHJhbmdlWzBdIDw9IHggJiYgeCA8PSByYW5nZVsxXSA6IHggPCByYW5nZVswXSB8fCByYW5nZVsxXSA8IHg7Cn0KCmZ1bmN0aW9uIGJvdW5kcyhmZWF0dXJlKSB7CiAgdmFyIGksIG4sIGEsIGIsIG1lcmdlZCwgZGVsdGFNYXgsIGRlbHRhOwoKICBwaGkxID0gbGFtYmRhMSA9IC0obGFtYmRhMCQxID0gcGhpMCA9IEluZmluaXR5KTsKICByYW5nZXMgPSBbXTsKICBnZW9TdHJlYW0oZmVhdHVyZSwgYm91bmRzU3RyZWFtKTsKCiAgLy8gRmlyc3QsIHNvcnQgcmFuZ2VzIGJ5IHRoZWlyIG1pbmltdW0gbG9uZ2l0dWRlcy4KICBpZiAobiA9IHJhbmdlcy5sZW5ndGgpIHsKICAgIHJhbmdlcy5zb3J0KHJhbmdlQ29tcGFyZSk7CgogICAgLy8gVGhlbiwgbWVyZ2UgYW55IHJhbmdlcyB0aGF0IG92ZXJsYXAuCiAgICBmb3IgKGkgPSAxLCBhID0gcmFuZ2VzWzBdLCBtZXJnZWQgPSBbYV07IGkgPCBuOyArK2kpIHsKICAgICAgYiA9IHJhbmdlc1tpXTsKICAgICAgaWYgKHJhbmdlQ29udGFpbnMoYSwgYlswXSkgfHwgcmFuZ2VDb250YWlucyhhLCBiWzFdKSkgewogICAgICAgIGlmIChhbmdsZShhWzBdLCBiWzFdKSA+IGFuZ2xlKGFbMF0sIGFbMV0pKSBhWzFdID0gYlsxXTsKICAgICAgICBpZiAoYW5nbGUoYlswXSwgYVsxXSkgPiBhbmdsZShhWzBdLCBhWzFdKSkgYVswXSA9IGJbMF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWVyZ2VkLnB1c2goYSA9IGIpOwogICAgICB9CiAgICB9CgogICAgLy8gRmluYWxseSwgZmluZCB0aGUgbGFyZ2VzdCBnYXAgYmV0d2VlbiB0aGUgbWVyZ2VkIHJhbmdlcy4KICAgIC8vIFRoZSBmaW5hbCBib3VuZGluZyBib3ggd2lsbCBiZSB0aGUgaW52ZXJzZSBvZiB0aGlzIGdhcC4KICAgIGZvciAoZGVsdGFNYXggPSAtSW5maW5pdHksIG4gPSBtZXJnZWQubGVuZ3RoIC0gMSwgaSA9IDAsIGEgPSBtZXJnZWRbbl07IGkgPD0gbjsgYSA9IGIsICsraSkgewogICAgICBiID0gbWVyZ2VkW2ldOwogICAgICBpZiAoKGRlbHRhID0gYW5nbGUoYVsxXSwgYlswXSkpID4gZGVsdGFNYXgpIGRlbHRhTWF4ID0gZGVsdGEsIGxhbWJkYTAkMSA9IGJbMF0sIGxhbWJkYTEgPSBhWzFdOwogICAgfQogIH0KCiAgcmFuZ2VzID0gcmFuZ2UgPSBudWxsOwoKICByZXR1cm4gbGFtYmRhMCQxID09PSBJbmZpbml0eSB8fCBwaGkwID09PSBJbmZpbml0eQogICAgICA/IFtbTmFOLCBOYU5dLCBbTmFOLCBOYU5dXQogICAgICA6IFtbbGFtYmRhMCQxLCBwaGkwXSwgW2xhbWJkYTEsIHBoaTFdXTsKfQoKdmFyIFcwLCBXMSwKICAgIFgwLCBZMCwgWjAsCiAgICBYMSwgWTEsIFoxLAogICAgWDIsIFkyLCBaMiwKICAgIGxhbWJkYTAwJDIsIHBoaTAwJDIsIC8vIGZpcnN0IHBvaW50CiAgICB4MCwgeTAsIHowOyAvLyBwcmV2aW91cyBwb2ludAoKdmFyIGNlbnRyb2lkU3RyZWFtID0gewogIHNwaGVyZTogbm9vcCQyLAogIHBvaW50OiBjZW50cm9pZFBvaW50LAogIGxpbmVTdGFydDogY2VudHJvaWRMaW5lU3RhcnQsCiAgbGluZUVuZDogY2VudHJvaWRMaW5lRW5kLAogIHBvbHlnb25TdGFydDogZnVuY3Rpb24oKSB7CiAgICBjZW50cm9pZFN0cmVhbS5saW5lU3RhcnQgPSBjZW50cm9pZFJpbmdTdGFydDsKICAgIGNlbnRyb2lkU3RyZWFtLmxpbmVFbmQgPSBjZW50cm9pZFJpbmdFbmQ7CiAgfSwKICBwb2x5Z29uRW5kOiBmdW5jdGlvbigpIHsKICAgIGNlbnRyb2lkU3RyZWFtLmxpbmVTdGFydCA9IGNlbnRyb2lkTGluZVN0YXJ0OwogICAgY2VudHJvaWRTdHJlYW0ubGluZUVuZCA9IGNlbnRyb2lkTGluZUVuZDsKICB9Cn07CgovLyBBcml0aG1ldGljIG1lYW4gb2YgQ2FydGVzaWFuIHZlY3RvcnMuCmZ1bmN0aW9uIGNlbnRyb2lkUG9pbnQobGFtYmRhLCBwaGkpIHsKICBsYW1iZGEgKj0gcmFkaWFucywgcGhpICo9IHJhZGlhbnM7CiAgdmFyIGNvc1BoaSA9IGNvcyQxKHBoaSk7CiAgY2VudHJvaWRQb2ludENhcnRlc2lhbihjb3NQaGkgKiBjb3MkMShsYW1iZGEpLCBjb3NQaGkgKiBzaW4kMShsYW1iZGEpLCBzaW4kMShwaGkpKTsKfQoKZnVuY3Rpb24gY2VudHJvaWRQb2ludENhcnRlc2lhbih4LCB5LCB6KSB7CiAgKytXMDsKICBYMCArPSAoeCAtIFgwKSAvIFcwOwogIFkwICs9ICh5IC0gWTApIC8gVzA7CiAgWjAgKz0gKHogLSBaMCkgLyBXMDsKfQoKZnVuY3Rpb24gY2VudHJvaWRMaW5lU3RhcnQoKSB7CiAgY2VudHJvaWRTdHJlYW0ucG9pbnQgPSBjZW50cm9pZExpbmVQb2ludEZpcnN0Owp9CgpmdW5jdGlvbiBjZW50cm9pZExpbmVQb2ludEZpcnN0KGxhbWJkYSwgcGhpKSB7CiAgbGFtYmRhICo9IHJhZGlhbnMsIHBoaSAqPSByYWRpYW5zOwogIHZhciBjb3NQaGkgPSBjb3MkMShwaGkpOwogIHgwID0gY29zUGhpICogY29zJDEobGFtYmRhKTsKICB5MCA9IGNvc1BoaSAqIHNpbiQxKGxhbWJkYSk7CiAgejAgPSBzaW4kMShwaGkpOwogIGNlbnRyb2lkU3RyZWFtLnBvaW50ID0gY2VudHJvaWRMaW5lUG9pbnQ7CiAgY2VudHJvaWRQb2ludENhcnRlc2lhbih4MCwgeTAsIHowKTsKfQoKZnVuY3Rpb24gY2VudHJvaWRMaW5lUG9pbnQobGFtYmRhLCBwaGkpIHsKICBsYW1iZGEgKj0gcmFkaWFucywgcGhpICo9IHJhZGlhbnM7CiAgdmFyIGNvc1BoaSA9IGNvcyQxKHBoaSksCiAgICAgIHggPSBjb3NQaGkgKiBjb3MkMShsYW1iZGEpLAogICAgICB5ID0gY29zUGhpICogc2luJDEobGFtYmRhKSwKICAgICAgeiA9IHNpbiQxKHBoaSksCiAgICAgIHcgPSBhdGFuMihzcXJ0KCh3ID0geTAgKiB6IC0gejAgKiB5KSAqIHcgKyAodyA9IHowICogeCAtIHgwICogeikgKiB3ICsgKHcgPSB4MCAqIHkgLSB5MCAqIHgpICogdyksIHgwICogeCArIHkwICogeSArIHowICogeik7CiAgVzEgKz0gdzsKICBYMSArPSB3ICogKHgwICsgKHgwID0geCkpOwogIFkxICs9IHcgKiAoeTAgKyAoeTAgPSB5KSk7CiAgWjEgKz0gdyAqICh6MCArICh6MCA9IHopKTsKICBjZW50cm9pZFBvaW50Q2FydGVzaWFuKHgwLCB5MCwgejApOwp9CgpmdW5jdGlvbiBjZW50cm9pZExpbmVFbmQoKSB7CiAgY2VudHJvaWRTdHJlYW0ucG9pbnQgPSBjZW50cm9pZFBvaW50Owp9CgovLyBTZWUgSi4gRS4gQnJvY2ssIFRoZSBJbmVydGlhIFRlbnNvciBmb3IgYSBTcGhlcmljYWwgVHJpYW5nbGUsCi8vIEouIEFwcGxpZWQgTWVjaGFuaWNzIDQyLCAyMzkgKDE5NzUpLgpmdW5jdGlvbiBjZW50cm9pZFJpbmdTdGFydCgpIHsKICBjZW50cm9pZFN0cmVhbS5wb2ludCA9IGNlbnRyb2lkUmluZ1BvaW50Rmlyc3Q7Cn0KCmZ1bmN0aW9uIGNlbnRyb2lkUmluZ0VuZCgpIHsKICBjZW50cm9pZFJpbmdQb2ludChsYW1iZGEwMCQyLCBwaGkwMCQyKTsKICBjZW50cm9pZFN0cmVhbS5wb2ludCA9IGNlbnRyb2lkUG9pbnQ7Cn0KCmZ1bmN0aW9uIGNlbnRyb2lkUmluZ1BvaW50Rmlyc3QobGFtYmRhLCBwaGkpIHsKICBsYW1iZGEwMCQyID0gbGFtYmRhLCBwaGkwMCQyID0gcGhpOwogIGxhbWJkYSAqPSByYWRpYW5zLCBwaGkgKj0gcmFkaWFuczsKICBjZW50cm9pZFN0cmVhbS5wb2ludCA9IGNlbnRyb2lkUmluZ1BvaW50OwogIHZhciBjb3NQaGkgPSBjb3MkMShwaGkpOwogIHgwID0gY29zUGhpICogY29zJDEobGFtYmRhKTsKICB5MCA9IGNvc1BoaSAqIHNpbiQxKGxhbWJkYSk7CiAgejAgPSBzaW4kMShwaGkpOwogIGNlbnRyb2lkUG9pbnRDYXJ0ZXNpYW4oeDAsIHkwLCB6MCk7Cn0KCmZ1bmN0aW9uIGNlbnRyb2lkUmluZ1BvaW50KGxhbWJkYSwgcGhpKSB7CiAgbGFtYmRhICo9IHJhZGlhbnMsIHBoaSAqPSByYWRpYW5zOwogIHZhciBjb3NQaGkgPSBjb3MkMShwaGkpLAogICAgICB4ID0gY29zUGhpICogY29zJDEobGFtYmRhKSwKICAgICAgeSA9IGNvc1BoaSAqIHNpbiQxKGxhbWJkYSksCiAgICAgIHogPSBzaW4kMShwaGkpLAogICAgICBjeCA9IHkwICogeiAtIHowICogeSwKICAgICAgY3kgPSB6MCAqIHggLSB4MCAqIHosCiAgICAgIGN6ID0geDAgKiB5IC0geTAgKiB4LAogICAgICBtID0gc3FydChjeCAqIGN4ICsgY3kgKiBjeSArIGN6ICogY3opLAogICAgICB3ID0gYXNpbihtKSwgLy8gbGluZSB3ZWlnaHQgPSBhbmdsZQogICAgICB2ID0gbSAmJiAtdyAvIG07IC8vIGFyZWEgd2VpZ2h0IG11bHRpcGxpZXIKICBYMiArPSB2ICogY3g7CiAgWTIgKz0gdiAqIGN5OwogIFoyICs9IHYgKiBjejsKICBXMSArPSB3OwogIFgxICs9IHcgKiAoeDAgKyAoeDAgPSB4KSk7CiAgWTEgKz0gdyAqICh5MCArICh5MCA9IHkpKTsKICBaMSArPSB3ICogKHowICsgKHowID0geikpOwogIGNlbnRyb2lkUG9pbnRDYXJ0ZXNpYW4oeDAsIHkwLCB6MCk7Cn0KCmZ1bmN0aW9uIGNlbnRyb2lkKG9iamVjdCkgewogIFcwID0gVzEgPQogIFgwID0gWTAgPSBaMCA9CiAgWDEgPSBZMSA9IFoxID0KICBYMiA9IFkyID0gWjIgPSAwOwogIGdlb1N0cmVhbShvYmplY3QsIGNlbnRyb2lkU3RyZWFtKTsKCiAgdmFyIHggPSBYMiwKICAgICAgeSA9IFkyLAogICAgICB6ID0gWjIsCiAgICAgIG0gPSB4ICogeCArIHkgKiB5ICsgeiAqIHo7CgogIC8vIElmIHRoZSBhcmVhLXdlaWdodGVkIGNjZW50cm9pZCBpcyB1bmRlZmluZWQsIGZhbGwgYmFjayB0byBsZW5ndGgtd2VpZ2h0ZWQgY2NlbnRyb2lkLgogIGlmIChtIDwgZXBzaWxvbjIkMSkgewogICAgeCA9IFgxLCB5ID0gWTEsIHogPSBaMTsKICAgIC8vIElmIHRoZSBmZWF0dXJlIGhhcyB6ZXJvIGxlbmd0aCwgZmFsbCBiYWNrIHRvIGFyaXRobWV0aWMgbWVhbiBvZiBwb2ludCB2ZWN0b3JzLgogICAgaWYgKFcxIDwgZXBzaWxvbiQyKSB4ID0gWDAsIHkgPSBZMCwgeiA9IFowOwogICAgbSA9IHggKiB4ICsgeSAqIHkgKyB6ICogejsKICAgIC8vIElmIHRoZSBmZWF0dXJlIHN0aWxsIGhhcyBhbiB1bmRlZmluZWQgY2NlbnRyb2lkLCB0aGVuIHJldHVybi4KICAgIGlmIChtIDwgZXBzaWxvbjIkMSkgcmV0dXJuIFtOYU4sIE5hTl07CiAgfQoKICByZXR1cm4gW2F0YW4yKHksIHgpICogZGVncmVlcyQxLCBhc2luKHogLyBzcXJ0KG0pKSAqIGRlZ3JlZXMkMV07Cn0KCmZ1bmN0aW9uIGNvbnN0YW50JDgoeCkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB4OwogIH07Cn0KCmZ1bmN0aW9uIGNvbXBvc2UoYSwgYikgewoKICBmdW5jdGlvbiBjb21wb3NlKHgsIHkpIHsKICAgIHJldHVybiB4ID0gYSh4LCB5KSwgYih4WzBdLCB4WzFdKTsKICB9CgogIGlmIChhLmludmVydCAmJiBiLmludmVydCkgY29tcG9zZS5pbnZlcnQgPSBmdW5jdGlvbih4LCB5KSB7CiAgICByZXR1cm4geCA9IGIuaW52ZXJ0KHgsIHkpLCB4ICYmIGEuaW52ZXJ0KHhbMF0sIHhbMV0pOwogIH07CgogIHJldHVybiBjb21wb3NlOwp9CgpmdW5jdGlvbiByb3RhdGlvbklkZW50aXR5KGxhbWJkYSwgcGhpKSB7CiAgcmV0dXJuIFtsYW1iZGEgPiBwaSQzID8gbGFtYmRhIC0gdGF1JDMgOiBsYW1iZGEgPCAtcGkkMyA/IGxhbWJkYSArIHRhdSQzIDogbGFtYmRhLCBwaGldOwp9Cgpyb3RhdGlvbklkZW50aXR5LmludmVydCA9IHJvdGF0aW9uSWRlbnRpdHk7CgpmdW5jdGlvbiByb3RhdGVSYWRpYW5zKGRlbHRhTGFtYmRhLCBkZWx0YVBoaSwgZGVsdGFHYW1tYSkgewogIHJldHVybiAoZGVsdGFMYW1iZGEgJT0gdGF1JDMpID8gKGRlbHRhUGhpIHx8IGRlbHRhR2FtbWEgPyBjb21wb3NlKHJvdGF0aW9uTGFtYmRhKGRlbHRhTGFtYmRhKSwgcm90YXRpb25QaGlHYW1tYShkZWx0YVBoaSwgZGVsdGFHYW1tYSkpCiAgICA6IHJvdGF0aW9uTGFtYmRhKGRlbHRhTGFtYmRhKSkKICAgIDogKGRlbHRhUGhpIHx8IGRlbHRhR2FtbWEgPyByb3RhdGlvblBoaUdhbW1hKGRlbHRhUGhpLCBkZWx0YUdhbW1hKQogICAgOiByb3RhdGlvbklkZW50aXR5KTsKfQoKZnVuY3Rpb24gZm9yd2FyZFJvdGF0aW9uTGFtYmRhKGRlbHRhTGFtYmRhKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKGxhbWJkYSwgcGhpKSB7CiAgICByZXR1cm4gbGFtYmRhICs9IGRlbHRhTGFtYmRhLCBbbGFtYmRhID4gcGkkMyA/IGxhbWJkYSAtIHRhdSQzIDogbGFtYmRhIDwgLXBpJDMgPyBsYW1iZGEgKyB0YXUkMyA6IGxhbWJkYSwgcGhpXTsKICB9Owp9CgpmdW5jdGlvbiByb3RhdGlvbkxhbWJkYShkZWx0YUxhbWJkYSkgewogIHZhciByb3RhdGlvbiA9IGZvcndhcmRSb3RhdGlvbkxhbWJkYShkZWx0YUxhbWJkYSk7CiAgcm90YXRpb24uaW52ZXJ0ID0gZm9yd2FyZFJvdGF0aW9uTGFtYmRhKC1kZWx0YUxhbWJkYSk7CiAgcmV0dXJuIHJvdGF0aW9uOwp9CgpmdW5jdGlvbiByb3RhdGlvblBoaUdhbW1hKGRlbHRhUGhpLCBkZWx0YUdhbW1hKSB7CiAgdmFyIGNvc0RlbHRhUGhpID0gY29zJDEoZGVsdGFQaGkpLAogICAgICBzaW5EZWx0YVBoaSA9IHNpbiQxKGRlbHRhUGhpKSwKICAgICAgY29zRGVsdGFHYW1tYSA9IGNvcyQxKGRlbHRhR2FtbWEpLAogICAgICBzaW5EZWx0YUdhbW1hID0gc2luJDEoZGVsdGFHYW1tYSk7CgogIGZ1bmN0aW9uIHJvdGF0aW9uKGxhbWJkYSwgcGhpKSB7CiAgICB2YXIgY29zUGhpID0gY29zJDEocGhpKSwKICAgICAgICB4ID0gY29zJDEobGFtYmRhKSAqIGNvc1BoaSwKICAgICAgICB5ID0gc2luJDEobGFtYmRhKSAqIGNvc1BoaSwKICAgICAgICB6ID0gc2luJDEocGhpKSwKICAgICAgICBrID0geiAqIGNvc0RlbHRhUGhpICsgeCAqIHNpbkRlbHRhUGhpOwogICAgcmV0dXJuIFsKICAgICAgYXRhbjIoeSAqIGNvc0RlbHRhR2FtbWEgLSBrICogc2luRGVsdGFHYW1tYSwgeCAqIGNvc0RlbHRhUGhpIC0geiAqIHNpbkRlbHRhUGhpKSwKICAgICAgYXNpbihrICogY29zRGVsdGFHYW1tYSArIHkgKiBzaW5EZWx0YUdhbW1hKQogICAgXTsKICB9CgogIHJvdGF0aW9uLmludmVydCA9IGZ1bmN0aW9uKGxhbWJkYSwgcGhpKSB7CiAgICB2YXIgY29zUGhpID0gY29zJDEocGhpKSwKICAgICAgICB4ID0gY29zJDEobGFtYmRhKSAqIGNvc1BoaSwKICAgICAgICB5ID0gc2luJDEobGFtYmRhKSAqIGNvc1BoaSwKICAgICAgICB6ID0gc2luJDEocGhpKSwKICAgICAgICBrID0geiAqIGNvc0RlbHRhR2FtbWEgLSB5ICogc2luRGVsdGFHYW1tYTsKICAgIHJldHVybiBbCiAgICAgIGF0YW4yKHkgKiBjb3NEZWx0YUdhbW1hICsgeiAqIHNpbkRlbHRhR2FtbWEsIHggKiBjb3NEZWx0YVBoaSArIGsgKiBzaW5EZWx0YVBoaSksCiAgICAgIGFzaW4oayAqIGNvc0RlbHRhUGhpIC0geCAqIHNpbkRlbHRhUGhpKQogICAgXTsKICB9OwoKICByZXR1cm4gcm90YXRpb247Cn0KCmZ1bmN0aW9uIHJvdGF0aW9uKHJvdGF0ZSkgewogIHJvdGF0ZSA9IHJvdGF0ZVJhZGlhbnMocm90YXRlWzBdICogcmFkaWFucywgcm90YXRlWzFdICogcmFkaWFucywgcm90YXRlLmxlbmd0aCA+IDIgPyByb3RhdGVbMl0gKiByYWRpYW5zIDogMCk7CgogIGZ1bmN0aW9uIGZvcndhcmQoY29vcmRpbmF0ZXMpIHsKICAgIGNvb3JkaW5hdGVzID0gcm90YXRlKGNvb3JkaW5hdGVzWzBdICogcmFkaWFucywgY29vcmRpbmF0ZXNbMV0gKiByYWRpYW5zKTsKICAgIHJldHVybiBjb29yZGluYXRlc1swXSAqPSBkZWdyZWVzJDEsIGNvb3JkaW5hdGVzWzFdICo9IGRlZ3JlZXMkMSwgY29vcmRpbmF0ZXM7CiAgfQoKICBmb3J3YXJkLmludmVydCA9IGZ1bmN0aW9uKGNvb3JkaW5hdGVzKSB7CiAgICBjb29yZGluYXRlcyA9IHJvdGF0ZS5pbnZlcnQoY29vcmRpbmF0ZXNbMF0gKiByYWRpYW5zLCBjb29yZGluYXRlc1sxXSAqIHJhZGlhbnMpOwogICAgcmV0dXJuIGNvb3JkaW5hdGVzWzBdICo9IGRlZ3JlZXMkMSwgY29vcmRpbmF0ZXNbMV0gKj0gZGVncmVlcyQxLCBjb29yZGluYXRlczsKICB9OwoKICByZXR1cm4gZm9yd2FyZDsKfQoKLy8gR2VuZXJhdGVzIGEgY2lyY2xlIGNlbnRlcmVkIGF0IFswwrAsIDDCsF0sIHdpdGggYSBnaXZlbiByYWRpdXMgYW5kIHByZWNpc2lvbi4KZnVuY3Rpb24gY2lyY2xlU3RyZWFtKHN0cmVhbSwgcmFkaXVzLCBkZWx0YSwgZGlyZWN0aW9uLCB0MCwgdDEpIHsKICBpZiAoIWRlbHRhKSByZXR1cm47CiAgdmFyIGNvc1JhZGl1cyA9IGNvcyQxKHJhZGl1cyksCiAgICAgIHNpblJhZGl1cyA9IHNpbiQxKHJhZGl1cyksCiAgICAgIHN0ZXAgPSBkaXJlY3Rpb24gKiBkZWx0YTsKICBpZiAodDAgPT0gbnVsbCkgewogICAgdDAgPSByYWRpdXMgKyBkaXJlY3Rpb24gKiB0YXUkMzsKICAgIHQxID0gcmFkaXVzIC0gc3RlcCAvIDI7CiAgfSBlbHNlIHsKICAgIHQwID0gY2lyY2xlUmFkaXVzKGNvc1JhZGl1cywgdDApOwogICAgdDEgPSBjaXJjbGVSYWRpdXMoY29zUmFkaXVzLCB0MSk7CiAgICBpZiAoZGlyZWN0aW9uID4gMCA/IHQwIDwgdDEgOiB0MCA+IHQxKSB0MCArPSBkaXJlY3Rpb24gKiB0YXUkMzsKICB9CiAgZm9yICh2YXIgcG9pbnQsIHQgPSB0MDsgZGlyZWN0aW9uID4gMCA/IHQgPiB0MSA6IHQgPCB0MTsgdCAtPSBzdGVwKSB7CiAgICBwb2ludCA9IHNwaGVyaWNhbChbY29zUmFkaXVzLCAtc2luUmFkaXVzICogY29zJDEodCksIC1zaW5SYWRpdXMgKiBzaW4kMSh0KV0pOwogICAgc3RyZWFtLnBvaW50KHBvaW50WzBdLCBwb2ludFsxXSk7CiAgfQp9CgovLyBSZXR1cm5zIHRoZSBzaWduZWQgYW5nbGUgb2YgYSBjYXJ0ZXNpYW4gcG9pbnQgcmVsYXRpdmUgdG8gW2Nvc1JhZGl1cywgMCwgMF0uCmZ1bmN0aW9uIGNpcmNsZVJhZGl1cyhjb3NSYWRpdXMsIHBvaW50KSB7CiAgcG9pbnQgPSBjYXJ0ZXNpYW4ocG9pbnQpLCBwb2ludFswXSAtPSBjb3NSYWRpdXM7CiAgY2FydGVzaWFuTm9ybWFsaXplSW5QbGFjZShwb2ludCk7CiAgdmFyIHJhZGl1cyA9IGFjb3MoLXBvaW50WzFdKTsKICByZXR1cm4gKCgtcG9pbnRbMl0gPCAwID8gLXJhZGl1cyA6IHJhZGl1cykgKyB0YXUkMyAtIGVwc2lsb24kMikgJSB0YXUkMzsKfQoKZnVuY3Rpb24gY2lyY2xlKCkgewogIHZhciBjZW50ZXIgPSBjb25zdGFudCQ4KFswLCAwXSksCiAgICAgIHJhZGl1cyA9IGNvbnN0YW50JDgoOTApLAogICAgICBwcmVjaXNpb24gPSBjb25zdGFudCQ4KDYpLAogICAgICByaW5nLAogICAgICByb3RhdGUsCiAgICAgIHN0cmVhbSA9IHtwb2ludDogcG9pbnR9OwoKICBmdW5jdGlvbiBwb2ludCh4LCB5KSB7CiAgICByaW5nLnB1c2goeCA9IHJvdGF0ZSh4LCB5KSk7CiAgICB4WzBdICo9IGRlZ3JlZXMkMSwgeFsxXSAqPSBkZWdyZWVzJDE7CiAgfQoKICBmdW5jdGlvbiBjaXJjbGUoKSB7CiAgICB2YXIgYyA9IGNlbnRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpLAogICAgICAgIHIgPSByYWRpdXMuYXBwbHkodGhpcywgYXJndW1lbnRzKSAqIHJhZGlhbnMsCiAgICAgICAgcCA9IHByZWNpc2lvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpICogcmFkaWFuczsKICAgIHJpbmcgPSBbXTsKICAgIHJvdGF0ZSA9IHJvdGF0ZVJhZGlhbnMoLWNbMF0gKiByYWRpYW5zLCAtY1sxXSAqIHJhZGlhbnMsIDApLmludmVydDsKICAgIGNpcmNsZVN0cmVhbShzdHJlYW0sIHIsIHAsIDEpOwogICAgYyA9IHt0eXBlOiAiUG9seWdvbiIsIGNvb3JkaW5hdGVzOiBbcmluZ119OwogICAgcmluZyA9IHJvdGF0ZSA9IG51bGw7CiAgICByZXR1cm4gYzsKICB9CgogIGNpcmNsZS5jZW50ZXIgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChjZW50ZXIgPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQ4KFsrX1swXSwgK19bMV1dKSwgY2lyY2xlKSA6IGNlbnRlcjsKICB9OwoKICBjaXJjbGUucmFkaXVzID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocmFkaXVzID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkOCgrXyksIGNpcmNsZSkgOiByYWRpdXM7CiAgfTsKCiAgY2lyY2xlLnByZWNpc2lvbiA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHByZWNpc2lvbiA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IGNvbnN0YW50JDgoK18pLCBjaXJjbGUpIDogcHJlY2lzaW9uOwogIH07CgogIHJldHVybiBjaXJjbGU7Cn0KCmZ1bmN0aW9uIGNsaXBCdWZmZXIoKSB7CiAgdmFyIGxpbmVzID0gW10sCiAgICAgIGxpbmU7CiAgcmV0dXJuIHsKICAgIHBvaW50OiBmdW5jdGlvbih4LCB5KSB7CiAgICAgIGxpbmUucHVzaChbeCwgeV0pOwogICAgfSwKICAgIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgIGxpbmVzLnB1c2gobGluZSA9IFtdKTsKICAgIH0sCiAgICBsaW5lRW5kOiBub29wJDIsCiAgICByZWpvaW46IGZ1bmN0aW9uKCkgewogICAgICBpZiAobGluZXMubGVuZ3RoID4gMSkgbGluZXMucHVzaChsaW5lcy5wb3AoKS5jb25jYXQobGluZXMuc2hpZnQoKSkpOwogICAgfSwKICAgIHJlc3VsdDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciByZXN1bHQgPSBsaW5lczsKICAgICAgbGluZXMgPSBbXTsKICAgICAgbGluZSA9IG51bGw7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgfTsKfQoKZnVuY3Rpb24gcG9pbnRFcXVhbChhLCBiKSB7CiAgcmV0dXJuIGFicyhhWzBdIC0gYlswXSkgPCBlcHNpbG9uJDIgJiYgYWJzKGFbMV0gLSBiWzFdKSA8IGVwc2lsb24kMjsKfQoKZnVuY3Rpb24gSW50ZXJzZWN0aW9uKHBvaW50LCBwb2ludHMsIG90aGVyLCBlbnRyeSkgewogIHRoaXMueCA9IHBvaW50OwogIHRoaXMueiA9IHBvaW50czsKICB0aGlzLm8gPSBvdGhlcjsgLy8gYW5vdGhlciBpbnRlcnNlY3Rpb24KICB0aGlzLmUgPSBlbnRyeTsgLy8gaXMgYW4gZW50cnk/CiAgdGhpcy52ID0gZmFsc2U7IC8vIHZpc2l0ZWQKICB0aGlzLm4gPSB0aGlzLnAgPSBudWxsOyAvLyBuZXh0ICYgcHJldmlvdXMKfQoKLy8gQSBnZW5lcmFsaXplZCBwb2x5Z29uIGNsaXBwaW5nIGFsZ29yaXRobTogZ2l2ZW4gYSBwb2x5Z29uIHRoYXQgaGFzIGJlZW4gY3V0Ci8vIGludG8gaXRzIHZpc2libGUgbGluZSBzZWdtZW50cywgYW5kIHJlam9pbnMgdGhlIHNlZ21lbnRzIGJ5IGludGVycG9sYXRpbmcKLy8gYWxvbmcgdGhlIGNsaXAgZWRnZS4KZnVuY3Rpb24gY2xpcFJlam9pbihzZWdtZW50cywgY29tcGFyZUludGVyc2VjdGlvbiwgc3RhcnRJbnNpZGUsIGludGVycG9sYXRlLCBzdHJlYW0pIHsKICB2YXIgc3ViamVjdCA9IFtdLAogICAgICBjbGlwID0gW10sCiAgICAgIGksCiAgICAgIG47CgogIHNlZ21lbnRzLmZvckVhY2goZnVuY3Rpb24oc2VnbWVudCkgewogICAgaWYgKChuID0gc2VnbWVudC5sZW5ndGggLSAxKSA8PSAwKSByZXR1cm47CiAgICB2YXIgbiwgcDAgPSBzZWdtZW50WzBdLCBwMSA9IHNlZ21lbnRbbl0sIHg7CgogICAgLy8gSWYgdGhlIGZpcnN0IGFuZCBsYXN0IHBvaW50cyBvZiBhIHNlZ21lbnQgYXJlIGNvaW5jaWRlbnQsIHRoZW4gdHJlYXQgYXMgYQogICAgLy8gY2xvc2VkIHJpbmcuIFRPRE8gaWYgYWxsIHJpbmdzIGFyZSBjbG9zZWQsIHRoZW4gdGhlIHdpbmRpbmcgb3JkZXIgb2YgdGhlCiAgICAvLyBleHRlcmlvciByaW5nIHNob3VsZCBiZSBjaGVja2VkLgogICAgaWYgKHBvaW50RXF1YWwocDAsIHAxKSkgewogICAgICBzdHJlYW0ubGluZVN0YXJ0KCk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBuOyArK2kpIHN0cmVhbS5wb2ludCgocDAgPSBzZWdtZW50W2ldKVswXSwgcDBbMV0pOwogICAgICBzdHJlYW0ubGluZUVuZCgpOwogICAgICByZXR1cm47CiAgICB9CgogICAgc3ViamVjdC5wdXNoKHggPSBuZXcgSW50ZXJzZWN0aW9uKHAwLCBzZWdtZW50LCBudWxsLCB0cnVlKSk7CiAgICBjbGlwLnB1c2goeC5vID0gbmV3IEludGVyc2VjdGlvbihwMCwgbnVsbCwgeCwgZmFsc2UpKTsKICAgIHN1YmplY3QucHVzaCh4ID0gbmV3IEludGVyc2VjdGlvbihwMSwgc2VnbWVudCwgbnVsbCwgZmFsc2UpKTsKICAgIGNsaXAucHVzaCh4Lm8gPSBuZXcgSW50ZXJzZWN0aW9uKHAxLCBudWxsLCB4LCB0cnVlKSk7CiAgfSk7CgogIGlmICghc3ViamVjdC5sZW5ndGgpIHJldHVybjsKCiAgY2xpcC5zb3J0KGNvbXBhcmVJbnRlcnNlY3Rpb24pOwogIGxpbmskMShzdWJqZWN0KTsKICBsaW5rJDEoY2xpcCk7CgogIGZvciAoaSA9IDAsIG4gPSBjbGlwLmxlbmd0aDsgaSA8IG47ICsraSkgewogICAgY2xpcFtpXS5lID0gc3RhcnRJbnNpZGUgPSAhc3RhcnRJbnNpZGU7CiAgfQoKICB2YXIgc3RhcnQgPSBzdWJqZWN0WzBdLAogICAgICBwb2ludHMsCiAgICAgIHBvaW50OwoKICB3aGlsZSAoMSkgewogICAgLy8gRmluZCBmaXJzdCB1bnZpc2l0ZWQgaW50ZXJzZWN0aW9uLgogICAgdmFyIGN1cnJlbnQgPSBzdGFydCwKICAgICAgICBpc1N1YmplY3QgPSB0cnVlOwogICAgd2hpbGUgKGN1cnJlbnQudikgaWYgKChjdXJyZW50ID0gY3VycmVudC5uKSA9PT0gc3RhcnQpIHJldHVybjsKICAgIHBvaW50cyA9IGN1cnJlbnQuejsKICAgIHN0cmVhbS5saW5lU3RhcnQoKTsKICAgIGRvIHsKICAgICAgY3VycmVudC52ID0gY3VycmVudC5vLnYgPSB0cnVlOwogICAgICBpZiAoY3VycmVudC5lKSB7CiAgICAgICAgaWYgKGlzU3ViamVjdCkgewogICAgICAgICAgZm9yIChpID0gMCwgbiA9IHBvaW50cy5sZW5ndGg7IGkgPCBuOyArK2kpIHN0cmVhbS5wb2ludCgocG9pbnQgPSBwb2ludHNbaV0pWzBdLCBwb2ludFsxXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGludGVycG9sYXRlKGN1cnJlbnQueCwgY3VycmVudC5uLngsIDEsIHN0cmVhbSk7CiAgICAgICAgfQogICAgICAgIGN1cnJlbnQgPSBjdXJyZW50Lm47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGlzU3ViamVjdCkgewogICAgICAgICAgcG9pbnRzID0gY3VycmVudC5wLno7CiAgICAgICAgICBmb3IgKGkgPSBwb2ludHMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHN0cmVhbS5wb2ludCgocG9pbnQgPSBwb2ludHNbaV0pWzBdLCBwb2ludFsxXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGludGVycG9sYXRlKGN1cnJlbnQueCwgY3VycmVudC5wLngsIC0xLCBzdHJlYW0pOwogICAgICAgIH0KICAgICAgICBjdXJyZW50ID0gY3VycmVudC5wOwogICAgICB9CiAgICAgIGN1cnJlbnQgPSBjdXJyZW50Lm87CiAgICAgIHBvaW50cyA9IGN1cnJlbnQuejsKICAgICAgaXNTdWJqZWN0ID0gIWlzU3ViamVjdDsKICAgIH0gd2hpbGUgKCFjdXJyZW50LnYpOwogICAgc3RyZWFtLmxpbmVFbmQoKTsKICB9Cn0KCmZ1bmN0aW9uIGxpbmskMShhcnJheSkgewogIGlmICghKG4gPSBhcnJheS5sZW5ndGgpKSByZXR1cm47CiAgdmFyIG4sCiAgICAgIGkgPSAwLAogICAgICBhID0gYXJyYXlbMF0sCiAgICAgIGI7CiAgd2hpbGUgKCsraSA8IG4pIHsKICAgIGEubiA9IGIgPSBhcnJheVtpXTsKICAgIGIucCA9IGE7CiAgICBhID0gYjsKICB9CiAgYS5uID0gYiA9IGFycmF5WzBdOwogIGIucCA9IGE7Cn0KCnZhciBzdW0kMSA9IGFkZGVyKCk7CgpmdW5jdGlvbiBwb2x5Z29uQ29udGFpbnMocG9seWdvbiwgcG9pbnQpIHsKICB2YXIgbGFtYmRhID0gcG9pbnRbMF0sCiAgICAgIHBoaSA9IHBvaW50WzFdLAogICAgICBzaW5QaGkgPSBzaW4kMShwaGkpLAogICAgICBub3JtYWwgPSBbc2luJDEobGFtYmRhKSwgLWNvcyQxKGxhbWJkYSksIDBdLAogICAgICBhbmdsZSA9IDAsCiAgICAgIHdpbmRpbmcgPSAwOwoKICBzdW0kMS5yZXNldCgpOwoKICBpZiAoc2luUGhpID09PSAxKSBwaGkgPSBoYWxmUGkkMiArIGVwc2lsb24kMjsKICBlbHNlIGlmIChzaW5QaGkgPT09IC0xKSBwaGkgPSAtaGFsZlBpJDIgLSBlcHNpbG9uJDI7CgogIGZvciAodmFyIGkgPSAwLCBuID0gcG9seWdvbi5sZW5ndGg7IGkgPCBuOyArK2kpIHsKICAgIGlmICghKG0gPSAocmluZyA9IHBvbHlnb25baV0pLmxlbmd0aCkpIGNvbnRpbnVlOwogICAgdmFyIHJpbmcsCiAgICAgICAgbSwKICAgICAgICBwb2ludDAgPSByaW5nW20gLSAxXSwKICAgICAgICBsYW1iZGEwID0gcG9pbnQwWzBdLAogICAgICAgIHBoaTAgPSBwb2ludDBbMV0gLyAyICsgcXVhcnRlclBpLAogICAgICAgIHNpblBoaTAgPSBzaW4kMShwaGkwKSwKICAgICAgICBjb3NQaGkwID0gY29zJDEocGhpMCk7CgogICAgZm9yICh2YXIgaiA9IDA7IGogPCBtOyArK2osIGxhbWJkYTAgPSBsYW1iZGExLCBzaW5QaGkwID0gc2luUGhpMSwgY29zUGhpMCA9IGNvc1BoaTEsIHBvaW50MCA9IHBvaW50MSkgewogICAgICB2YXIgcG9pbnQxID0gcmluZ1tqXSwKICAgICAgICAgIGxhbWJkYTEgPSBwb2ludDFbMF0sCiAgICAgICAgICBwaGkxID0gcG9pbnQxWzFdIC8gMiArIHF1YXJ0ZXJQaSwKICAgICAgICAgIHNpblBoaTEgPSBzaW4kMShwaGkxKSwKICAgICAgICAgIGNvc1BoaTEgPSBjb3MkMShwaGkxKSwKICAgICAgICAgIGRlbHRhID0gbGFtYmRhMSAtIGxhbWJkYTAsCiAgICAgICAgICBzaWduJCQxID0gZGVsdGEgPj0gMCA/IDEgOiAtMSwKICAgICAgICAgIGFic0RlbHRhID0gc2lnbiQkMSAqIGRlbHRhLAogICAgICAgICAgYW50aW1lcmlkaWFuID0gYWJzRGVsdGEgPiBwaSQzLAogICAgICAgICAgayA9IHNpblBoaTAgKiBzaW5QaGkxOwoKICAgICAgc3VtJDEuYWRkKGF0YW4yKGsgKiBzaWduJCQxICogc2luJDEoYWJzRGVsdGEpLCBjb3NQaGkwICogY29zUGhpMSArIGsgKiBjb3MkMShhYnNEZWx0YSkpKTsKICAgICAgYW5nbGUgKz0gYW50aW1lcmlkaWFuID8gZGVsdGEgKyBzaWduJCQxICogdGF1JDMgOiBkZWx0YTsKCiAgICAgIC8vIEFyZSB0aGUgbG9uZ2l0dWRlcyBlaXRoZXIgc2lkZSBvZiB0aGUgcG9pbnTigJlzIG1lcmlkaWFuIChsYW1iZGEpLAogICAgICAvLyBhbmQgYXJlIHRoZSBsYXRpdHVkZXMgc21hbGxlciB0aGFuIHRoZSBwYXJhbGxlbCAocGhpKT8KICAgICAgaWYgKGFudGltZXJpZGlhbiBeIGxhbWJkYTAgPj0gbGFtYmRhIF4gbGFtYmRhMSA+PSBsYW1iZGEpIHsKICAgICAgICB2YXIgYXJjID0gY2FydGVzaWFuQ3Jvc3MoY2FydGVzaWFuKHBvaW50MCksIGNhcnRlc2lhbihwb2ludDEpKTsKICAgICAgICBjYXJ0ZXNpYW5Ob3JtYWxpemVJblBsYWNlKGFyYyk7CiAgICAgICAgdmFyIGludGVyc2VjdGlvbiA9IGNhcnRlc2lhbkNyb3NzKG5vcm1hbCwgYXJjKTsKICAgICAgICBjYXJ0ZXNpYW5Ob3JtYWxpemVJblBsYWNlKGludGVyc2VjdGlvbik7CiAgICAgICAgdmFyIHBoaUFyYyA9IChhbnRpbWVyaWRpYW4gXiBkZWx0YSA+PSAwID8gLTEgOiAxKSAqIGFzaW4oaW50ZXJzZWN0aW9uWzJdKTsKICAgICAgICBpZiAocGhpID4gcGhpQXJjIHx8IHBoaSA9PT0gcGhpQXJjICYmIChhcmNbMF0gfHwgYXJjWzFdKSkgewogICAgICAgICAgd2luZGluZyArPSBhbnRpbWVyaWRpYW4gXiBkZWx0YSA+PSAwID8gMSA6IC0xOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgLy8gRmlyc3QsIGRldGVybWluZSB3aGV0aGVyIHRoZSBTb3V0aCBwb2xlIGlzIGluc2lkZSBvciBvdXRzaWRlOgogIC8vCiAgLy8gSXQgaXMgaW5zaWRlIGlmOgogIC8vICogdGhlIHBvbHlnb24gd2luZHMgYXJvdW5kIGl0IGluIGEgY2xvY2t3aXNlIGRpcmVjdGlvbi4KICAvLyAqIHRoZSBwb2x5Z29uIGRvZXMgbm90IChjdW11bGF0aXZlbHkpIHdpbmQgYXJvdW5kIGl0LCBidXQgaGFzIGEgbmVnYXRpdmUKICAvLyAgIChjb3VudGVyLWNsb2Nrd2lzZSkgYXJlYS4KICAvLwogIC8vIFNlY29uZCwgY291bnQgdGhlIChzaWduZWQpIG51bWJlciBvZiB0aW1lcyBhIHNlZ21lbnQgY3Jvc3NlcyBhIGxhbWJkYQogIC8vIGZyb20gdGhlIHBvaW50IHRvIHRoZSBTb3V0aCBwb2xlLiAgSWYgaXQgaXMgemVybywgdGhlbiB0aGUgcG9pbnQgaXMgdGhlCiAgLy8gc2FtZSBzaWRlIGFzIHRoZSBTb3V0aCBwb2xlLgoKICByZXR1cm4gKGFuZ2xlIDwgLWVwc2lsb24kMiB8fCBhbmdsZSA8IGVwc2lsb24kMiAmJiBzdW0kMSA8IC1lcHNpbG9uJDIpIF4gKHdpbmRpbmcgJiAxKTsKfQoKZnVuY3Rpb24gY2xpcChwb2ludFZpc2libGUsIGNsaXBMaW5lLCBpbnRlcnBvbGF0ZSwgc3RhcnQpIHsKICByZXR1cm4gZnVuY3Rpb24oc2luaykgewogICAgdmFyIGxpbmUgPSBjbGlwTGluZShzaW5rKSwKICAgICAgICByaW5nQnVmZmVyID0gY2xpcEJ1ZmZlcigpLAogICAgICAgIHJpbmdTaW5rID0gY2xpcExpbmUocmluZ0J1ZmZlciksCiAgICAgICAgcG9seWdvblN0YXJ0ZWQgPSBmYWxzZSwKICAgICAgICBwb2x5Z29uLAogICAgICAgIHNlZ21lbnRzLAogICAgICAgIHJpbmc7CgogICAgdmFyIGNsaXAgPSB7CiAgICAgIHBvaW50OiBwb2ludCwKICAgICAgbGluZVN0YXJ0OiBsaW5lU3RhcnQsCiAgICAgIGxpbmVFbmQ6IGxpbmVFbmQsCiAgICAgIHBvbHlnb25TdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgY2xpcC5wb2ludCA9IHBvaW50UmluZzsKICAgICAgICBjbGlwLmxpbmVTdGFydCA9IHJpbmdTdGFydDsKICAgICAgICBjbGlwLmxpbmVFbmQgPSByaW5nRW5kOwogICAgICAgIHNlZ21lbnRzID0gW107CiAgICAgICAgcG9seWdvbiA9IFtdOwogICAgICB9LAogICAgICBwb2x5Z29uRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICBjbGlwLnBvaW50ID0gcG9pbnQ7CiAgICAgICAgY2xpcC5saW5lU3RhcnQgPSBsaW5lU3RhcnQ7CiAgICAgICAgY2xpcC5saW5lRW5kID0gbGluZUVuZDsKICAgICAgICBzZWdtZW50cyA9IG1lcmdlKHNlZ21lbnRzKTsKICAgICAgICB2YXIgc3RhcnRJbnNpZGUgPSBwb2x5Z29uQ29udGFpbnMocG9seWdvbiwgc3RhcnQpOwogICAgICAgIGlmIChzZWdtZW50cy5sZW5ndGgpIHsKICAgICAgICAgIGlmICghcG9seWdvblN0YXJ0ZWQpIHNpbmsucG9seWdvblN0YXJ0KCksIHBvbHlnb25TdGFydGVkID0gdHJ1ZTsKICAgICAgICAgIGNsaXBSZWpvaW4oc2VnbWVudHMsIGNvbXBhcmVJbnRlcnNlY3Rpb24sIHN0YXJ0SW5zaWRlLCBpbnRlcnBvbGF0ZSwgc2luayk7CiAgICAgICAgfSBlbHNlIGlmIChzdGFydEluc2lkZSkgewogICAgICAgICAgaWYgKCFwb2x5Z29uU3RhcnRlZCkgc2luay5wb2x5Z29uU3RhcnQoKSwgcG9seWdvblN0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgc2luay5saW5lU3RhcnQoKTsKICAgICAgICAgIGludGVycG9sYXRlKG51bGwsIG51bGwsIDEsIHNpbmspOwogICAgICAgICAgc2luay5saW5lRW5kKCk7CiAgICAgICAgfQogICAgICAgIGlmIChwb2x5Z29uU3RhcnRlZCkgc2luay5wb2x5Z29uRW5kKCksIHBvbHlnb25TdGFydGVkID0gZmFsc2U7CiAgICAgICAgc2VnbWVudHMgPSBwb2x5Z29uID0gbnVsbDsKICAgICAgfSwKICAgICAgc3BoZXJlOiBmdW5jdGlvbigpIHsKICAgICAgICBzaW5rLnBvbHlnb25TdGFydCgpOwogICAgICAgIHNpbmsubGluZVN0YXJ0KCk7CiAgICAgICAgaW50ZXJwb2xhdGUobnVsbCwgbnVsbCwgMSwgc2luayk7CiAgICAgICAgc2luay5saW5lRW5kKCk7CiAgICAgICAgc2luay5wb2x5Z29uRW5kKCk7CiAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gcG9pbnQobGFtYmRhLCBwaGkpIHsKICAgICAgaWYgKHBvaW50VmlzaWJsZShsYW1iZGEsIHBoaSkpIHNpbmsucG9pbnQobGFtYmRhLCBwaGkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHBvaW50TGluZShsYW1iZGEsIHBoaSkgewogICAgICBsaW5lLnBvaW50KGxhbWJkYSwgcGhpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBsaW5lU3RhcnQoKSB7CiAgICAgIGNsaXAucG9pbnQgPSBwb2ludExpbmU7CiAgICAgIGxpbmUubGluZVN0YXJ0KCk7CiAgICB9CgogICAgZnVuY3Rpb24gbGluZUVuZCgpIHsKICAgICAgY2xpcC5wb2ludCA9IHBvaW50OwogICAgICBsaW5lLmxpbmVFbmQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwb2ludFJpbmcobGFtYmRhLCBwaGkpIHsKICAgICAgcmluZy5wdXNoKFtsYW1iZGEsIHBoaV0pOwogICAgICByaW5nU2luay5wb2ludChsYW1iZGEsIHBoaSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmluZ1N0YXJ0KCkgewogICAgICByaW5nU2luay5saW5lU3RhcnQoKTsKICAgICAgcmluZyA9IFtdOwogICAgfQoKICAgIGZ1bmN0aW9uIHJpbmdFbmQoKSB7CiAgICAgIHBvaW50UmluZyhyaW5nWzBdWzBdLCByaW5nWzBdWzFdKTsKICAgICAgcmluZ1NpbmsubGluZUVuZCgpOwoKICAgICAgdmFyIGNsZWFuID0gcmluZ1NpbmsuY2xlYW4oKSwKICAgICAgICAgIHJpbmdTZWdtZW50cyA9IHJpbmdCdWZmZXIucmVzdWx0KCksCiAgICAgICAgICBpLCBuID0gcmluZ1NlZ21lbnRzLmxlbmd0aCwgbSwKICAgICAgICAgIHNlZ21lbnQsCiAgICAgICAgICBwb2ludDsKCiAgICAgIHJpbmcucG9wKCk7CiAgICAgIHBvbHlnb24ucHVzaChyaW5nKTsKICAgICAgcmluZyA9IG51bGw7CgogICAgICBpZiAoIW4pIHJldHVybjsKCiAgICAgIC8vIE5vIGludGVyc2VjdGlvbnMuCiAgICAgIGlmIChjbGVhbiAmIDEpIHsKICAgICAgICBzZWdtZW50ID0gcmluZ1NlZ21lbnRzWzBdOwogICAgICAgIGlmICgobSA9IHNlZ21lbnQubGVuZ3RoIC0gMSkgPiAwKSB7CiAgICAgICAgICBpZiAoIXBvbHlnb25TdGFydGVkKSBzaW5rLnBvbHlnb25TdGFydCgpLCBwb2x5Z29uU3RhcnRlZCA9IHRydWU7CiAgICAgICAgICBzaW5rLmxpbmVTdGFydCgpOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IG07ICsraSkgc2luay5wb2ludCgocG9pbnQgPSBzZWdtZW50W2ldKVswXSwgcG9pbnRbMV0pOwogICAgICAgICAgc2luay5saW5lRW5kKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8gUmVqb2luIGNvbm5lY3RlZCBzZWdtZW50cy4KICAgICAgLy8gVE9ETyByZXVzZSByaW5nQnVmZmVyLnJlam9pbigpPwogICAgICBpZiAobiA+IDEgJiYgY2xlYW4gJiAyKSByaW5nU2VnbWVudHMucHVzaChyaW5nU2VnbWVudHMucG9wKCkuY29uY2F0KHJpbmdTZWdtZW50cy5zaGlmdCgpKSk7CgogICAgICBzZWdtZW50cy5wdXNoKHJpbmdTZWdtZW50cy5maWx0ZXIodmFsaWRTZWdtZW50KSk7CiAgICB9CgogICAgcmV0dXJuIGNsaXA7CiAgfTsKfQoKZnVuY3Rpb24gdmFsaWRTZWdtZW50KHNlZ21lbnQpIHsKICByZXR1cm4gc2VnbWVudC5sZW5ndGggPiAxOwp9CgovLyBJbnRlcnNlY3Rpb25zIGFyZSBzb3J0ZWQgYWxvbmcgdGhlIGNsaXAgZWRnZS4gRm9yIGJvdGggYW50aW1lcmlkaWFuIGN1dHRpbmcKLy8gYW5kIGNpcmNsZSBjbGlwcGluZywgdGhlIHNhbWUgY29tcGFyaXNvbiBpcyB1c2VkLgpmdW5jdGlvbiBjb21wYXJlSW50ZXJzZWN0aW9uKGEsIGIpIHsKICByZXR1cm4gKChhID0gYS54KVswXSA8IDAgPyBhWzFdIC0gaGFsZlBpJDIgLSBlcHNpbG9uJDIgOiBoYWxmUGkkMiAtIGFbMV0pCiAgICAgICAtICgoYiA9IGIueClbMF0gPCAwID8gYlsxXSAtIGhhbGZQaSQyIC0gZXBzaWxvbiQyIDogaGFsZlBpJDIgLSBiWzFdKTsKfQoKdmFyIGNsaXBBbnRpbWVyaWRpYW4gPSBjbGlwKAogIGZ1bmN0aW9uKCkgeyByZXR1cm4gdHJ1ZTsgfSwKICBjbGlwQW50aW1lcmlkaWFuTGluZSwKICBjbGlwQW50aW1lcmlkaWFuSW50ZXJwb2xhdGUsCiAgWy1waSQzLCAtaGFsZlBpJDJdCik7CgovLyBUYWtlcyBhIGxpbmUgYW5kIGN1dHMgaW50byB2aXNpYmxlIHNlZ21lbnRzLiBSZXR1cm4gdmFsdWVzOiAwIC0gdGhlcmUgd2VyZQovLyBpbnRlcnNlY3Rpb25zIG9yIHRoZSBsaW5lIHdhcyBlbXB0eTsgMSAtIG5vIGludGVyc2VjdGlvbnM7IDIgLSB0aGVyZSB3ZXJlCi8vIGludGVyc2VjdGlvbnMsIGFuZCB0aGUgZmlyc3QgYW5kIGxhc3Qgc2VnbWVudHMgc2hvdWxkIGJlIHJlam9pbmVkLgpmdW5jdGlvbiBjbGlwQW50aW1lcmlkaWFuTGluZShzdHJlYW0pIHsKICB2YXIgbGFtYmRhMCA9IE5hTiwKICAgICAgcGhpMCA9IE5hTiwKICAgICAgc2lnbjAgPSBOYU4sCiAgICAgIGNsZWFuOyAvLyBubyBpbnRlcnNlY3Rpb25zCgogIHJldHVybiB7CiAgICBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICBzdHJlYW0ubGluZVN0YXJ0KCk7CiAgICAgIGNsZWFuID0gMTsKICAgIH0sCiAgICBwb2ludDogZnVuY3Rpb24obGFtYmRhMSwgcGhpMSkgewogICAgICB2YXIgc2lnbjEgPSBsYW1iZGExID4gMCA/IHBpJDMgOiAtcGkkMywKICAgICAgICAgIGRlbHRhID0gYWJzKGxhbWJkYTEgLSBsYW1iZGEwKTsKICAgICAgaWYgKGFicyhkZWx0YSAtIHBpJDMpIDwgZXBzaWxvbiQyKSB7IC8vIGxpbmUgY3Jvc3NlcyBhIHBvbGUKICAgICAgICBzdHJlYW0ucG9pbnQobGFtYmRhMCwgcGhpMCA9IChwaGkwICsgcGhpMSkgLyAyID4gMCA/IGhhbGZQaSQyIDogLWhhbGZQaSQyKTsKICAgICAgICBzdHJlYW0ucG9pbnQoc2lnbjAsIHBoaTApOwogICAgICAgIHN0cmVhbS5saW5lRW5kKCk7CiAgICAgICAgc3RyZWFtLmxpbmVTdGFydCgpOwogICAgICAgIHN0cmVhbS5wb2ludChzaWduMSwgcGhpMCk7CiAgICAgICAgc3RyZWFtLnBvaW50KGxhbWJkYTEsIHBoaTApOwogICAgICAgIGNsZWFuID0gMDsKICAgICAgfSBlbHNlIGlmIChzaWduMCAhPT0gc2lnbjEgJiYgZGVsdGEgPj0gcGkkMykgeyAvLyBsaW5lIGNyb3NzZXMgYW50aW1lcmlkaWFuCiAgICAgICAgaWYgKGFicyhsYW1iZGEwIC0gc2lnbjApIDwgZXBzaWxvbiQyKSBsYW1iZGEwIC09IHNpZ24wICogZXBzaWxvbiQyOyAvLyBoYW5kbGUgZGVnZW5lcmFjaWVzCiAgICAgICAgaWYgKGFicyhsYW1iZGExIC0gc2lnbjEpIDwgZXBzaWxvbiQyKSBsYW1iZGExIC09IHNpZ24xICogZXBzaWxvbiQyOwogICAgICAgIHBoaTAgPSBjbGlwQW50aW1lcmlkaWFuSW50ZXJzZWN0KGxhbWJkYTAsIHBoaTAsIGxhbWJkYTEsIHBoaTEpOwogICAgICAgIHN0cmVhbS5wb2ludChzaWduMCwgcGhpMCk7CiAgICAgICAgc3RyZWFtLmxpbmVFbmQoKTsKICAgICAgICBzdHJlYW0ubGluZVN0YXJ0KCk7CiAgICAgICAgc3RyZWFtLnBvaW50KHNpZ24xLCBwaGkwKTsKICAgICAgICBjbGVhbiA9IDA7CiAgICAgIH0KICAgICAgc3RyZWFtLnBvaW50KGxhbWJkYTAgPSBsYW1iZGExLCBwaGkwID0gcGhpMSk7CiAgICAgIHNpZ24wID0gc2lnbjE7CiAgICB9LAogICAgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICAgIHN0cmVhbS5saW5lRW5kKCk7CiAgICAgIGxhbWJkYTAgPSBwaGkwID0gTmFOOwogICAgfSwKICAgIGNsZWFuOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIDIgLSBjbGVhbjsgLy8gaWYgaW50ZXJzZWN0aW9ucywgcmVqb2luIGZpcnN0IGFuZCBsYXN0IHNlZ21lbnRzCiAgICB9CiAgfTsKfQoKZnVuY3Rpb24gY2xpcEFudGltZXJpZGlhbkludGVyc2VjdChsYW1iZGEwLCBwaGkwLCBsYW1iZGExLCBwaGkxKSB7CiAgdmFyIGNvc1BoaTAsCiAgICAgIGNvc1BoaTEsCiAgICAgIHNpbkxhbWJkYTBMYW1iZGExID0gc2luJDEobGFtYmRhMCAtIGxhbWJkYTEpOwogIHJldHVybiBhYnMoc2luTGFtYmRhMExhbWJkYTEpID4gZXBzaWxvbiQyCiAgICAgID8gYXRhbigoc2luJDEocGhpMCkgKiAoY29zUGhpMSA9IGNvcyQxKHBoaTEpKSAqIHNpbiQxKGxhbWJkYTEpCiAgICAgICAgICAtIHNpbiQxKHBoaTEpICogKGNvc1BoaTAgPSBjb3MkMShwaGkwKSkgKiBzaW4kMShsYW1iZGEwKSkKICAgICAgICAgIC8gKGNvc1BoaTAgKiBjb3NQaGkxICogc2luTGFtYmRhMExhbWJkYTEpKQogICAgICA6IChwaGkwICsgcGhpMSkgLyAyOwp9CgpmdW5jdGlvbiBjbGlwQW50aW1lcmlkaWFuSW50ZXJwb2xhdGUoZnJvbSwgdG8sIGRpcmVjdGlvbiwgc3RyZWFtKSB7CiAgdmFyIHBoaTsKICBpZiAoZnJvbSA9PSBudWxsKSB7CiAgICBwaGkgPSBkaXJlY3Rpb24gKiBoYWxmUGkkMjsKICAgIHN0cmVhbS5wb2ludCgtcGkkMywgcGhpKTsKICAgIHN0cmVhbS5wb2ludCgwLCBwaGkpOwogICAgc3RyZWFtLnBvaW50KHBpJDMsIHBoaSk7CiAgICBzdHJlYW0ucG9pbnQocGkkMywgMCk7CiAgICBzdHJlYW0ucG9pbnQocGkkMywgLXBoaSk7CiAgICBzdHJlYW0ucG9pbnQoMCwgLXBoaSk7CiAgICBzdHJlYW0ucG9pbnQoLXBpJDMsIC1waGkpOwogICAgc3RyZWFtLnBvaW50KC1waSQzLCAwKTsKICAgIHN0cmVhbS5wb2ludCgtcGkkMywgcGhpKTsKICB9IGVsc2UgaWYgKGFicyhmcm9tWzBdIC0gdG9bMF0pID4gZXBzaWxvbiQyKSB7CiAgICB2YXIgbGFtYmRhID0gZnJvbVswXSA8IHRvWzBdID8gcGkkMyA6IC1waSQzOwogICAgcGhpID0gZGlyZWN0aW9uICogbGFtYmRhIC8gMjsKICAgIHN0cmVhbS5wb2ludCgtbGFtYmRhLCBwaGkpOwogICAgc3RyZWFtLnBvaW50KDAsIHBoaSk7CiAgICBzdHJlYW0ucG9pbnQobGFtYmRhLCBwaGkpOwogIH0gZWxzZSB7CiAgICBzdHJlYW0ucG9pbnQodG9bMF0sIHRvWzFdKTsKICB9Cn0KCmZ1bmN0aW9uIGNsaXBDaXJjbGUocmFkaXVzKSB7CiAgdmFyIGNyID0gY29zJDEocmFkaXVzKSwKICAgICAgZGVsdGEgPSA2ICogcmFkaWFucywKICAgICAgc21hbGxSYWRpdXMgPSBjciA+IDAsCiAgICAgIG5vdEhlbWlzcGhlcmUgPSBhYnMoY3IpID4gZXBzaWxvbiQyOyAvLyBUT0RPIG9wdGltaXNlIGZvciB0aGlzIGNvbW1vbiBjYXNlCgogIGZ1bmN0aW9uIGludGVycG9sYXRlKGZyb20sIHRvLCBkaXJlY3Rpb24sIHN0cmVhbSkgewogICAgY2lyY2xlU3RyZWFtKHN0cmVhbSwgcmFkaXVzLCBkZWx0YSwgZGlyZWN0aW9uLCBmcm9tLCB0byk7CiAgfQoKICBmdW5jdGlvbiB2aXNpYmxlKGxhbWJkYSwgcGhpKSB7CiAgICByZXR1cm4gY29zJDEobGFtYmRhKSAqIGNvcyQxKHBoaSkgPiBjcjsKICB9CgogIC8vIFRha2VzIGEgbGluZSBhbmQgY3V0cyBpbnRvIHZpc2libGUgc2VnbWVudHMuIFJldHVybiB2YWx1ZXMgdXNlZCBmb3IgcG9seWdvbgogIC8vIGNsaXBwaW5nOiAwIC0gdGhlcmUgd2VyZSBpbnRlcnNlY3Rpb25zIG9yIHRoZSBsaW5lIHdhcyBlbXB0eTsgMSAtIG5vCiAgLy8gaW50ZXJzZWN0aW9ucyAyIC0gdGhlcmUgd2VyZSBpbnRlcnNlY3Rpb25zLCBhbmQgdGhlIGZpcnN0IGFuZCBsYXN0IHNlZ21lbnRzCiAgLy8gc2hvdWxkIGJlIHJlam9pbmVkLgogIGZ1bmN0aW9uIGNsaXBMaW5lKHN0cmVhbSkgewogICAgdmFyIHBvaW50MCwgLy8gcHJldmlvdXMgcG9pbnQKICAgICAgICBjMCwgLy8gY29kZSBmb3IgcHJldmlvdXMgcG9pbnQKICAgICAgICB2MCwgLy8gdmlzaWJpbGl0eSBvZiBwcmV2aW91cyBwb2ludAogICAgICAgIHYwMCwgLy8gdmlzaWJpbGl0eSBvZiBmaXJzdCBwb2ludAogICAgICAgIGNsZWFuOyAvLyBubyBpbnRlcnNlY3Rpb25zCiAgICByZXR1cm4gewogICAgICBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHYwMCA9IHYwID0gZmFsc2U7CiAgICAgICAgY2xlYW4gPSAxOwogICAgICB9LAogICAgICBwb2ludDogZnVuY3Rpb24obGFtYmRhLCBwaGkpIHsKICAgICAgICB2YXIgcG9pbnQxID0gW2xhbWJkYSwgcGhpXSwKICAgICAgICAgICAgcG9pbnQyLAogICAgICAgICAgICB2ID0gdmlzaWJsZShsYW1iZGEsIHBoaSksCiAgICAgICAgICAgIGMgPSBzbWFsbFJhZGl1cwogICAgICAgICAgICAgID8gdiA/IDAgOiBjb2RlKGxhbWJkYSwgcGhpKQogICAgICAgICAgICAgIDogdiA/IGNvZGUobGFtYmRhICsgKGxhbWJkYSA8IDAgPyBwaSQzIDogLXBpJDMpLCBwaGkpIDogMDsKICAgICAgICBpZiAoIXBvaW50MCAmJiAodjAwID0gdjAgPSB2KSkgc3RyZWFtLmxpbmVTdGFydCgpOwogICAgICAgIC8vIEhhbmRsZSBkZWdlbmVyYWNpZXMuCiAgICAgICAgLy8gVE9ETyBpZ25vcmUgaWYgbm90IGNsaXBwaW5nIHBvbHlnb25zLgogICAgICAgIGlmICh2ICE9PSB2MCkgewogICAgICAgICAgcG9pbnQyID0gaW50ZXJzZWN0KHBvaW50MCwgcG9pbnQxKTsKICAgICAgICAgIGlmICghcG9pbnQyIHx8IHBvaW50RXF1YWwocG9pbnQwLCBwb2ludDIpIHx8IHBvaW50RXF1YWwocG9pbnQxLCBwb2ludDIpKSB7CiAgICAgICAgICAgIHBvaW50MVswXSArPSBlcHNpbG9uJDI7CiAgICAgICAgICAgIHBvaW50MVsxXSArPSBlcHNpbG9uJDI7CiAgICAgICAgICAgIHYgPSB2aXNpYmxlKHBvaW50MVswXSwgcG9pbnQxWzFdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHYgIT09IHYwKSB7CiAgICAgICAgICBjbGVhbiA9IDA7CiAgICAgICAgICBpZiAodikgewogICAgICAgICAgICAvLyBvdXRzaWRlIGdvaW5nIGluCiAgICAgICAgICAgIHN0cmVhbS5saW5lU3RhcnQoKTsKICAgICAgICAgICAgcG9pbnQyID0gaW50ZXJzZWN0KHBvaW50MSwgcG9pbnQwKTsKICAgICAgICAgICAgc3RyZWFtLnBvaW50KHBvaW50MlswXSwgcG9pbnQyWzFdKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGluc2lkZSBnb2luZyBvdXQKICAgICAgICAgICAgcG9pbnQyID0gaW50ZXJzZWN0KHBvaW50MCwgcG9pbnQxKTsKICAgICAgICAgICAgc3RyZWFtLnBvaW50KHBvaW50MlswXSwgcG9pbnQyWzFdKTsKICAgICAgICAgICAgc3RyZWFtLmxpbmVFbmQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHBvaW50MCA9IHBvaW50MjsKICAgICAgICB9IGVsc2UgaWYgKG5vdEhlbWlzcGhlcmUgJiYgcG9pbnQwICYmIHNtYWxsUmFkaXVzIF4gdikgewogICAgICAgICAgdmFyIHQ7CiAgICAgICAgICAvLyBJZiB0aGUgY29kZXMgZm9yIHR3byBwb2ludHMgYXJlIGRpZmZlcmVudCwgb3IgYXJlIGJvdGggemVybywKICAgICAgICAgIC8vIGFuZCB0aGVyZSB0aGlzIHNlZ21lbnQgaW50ZXJzZWN0cyB3aXRoIHRoZSBzbWFsbCBjaXJjbGUuCiAgICAgICAgICBpZiAoIShjICYgYzApICYmICh0ID0gaW50ZXJzZWN0KHBvaW50MSwgcG9pbnQwLCB0cnVlKSkpIHsKICAgICAgICAgICAgY2xlYW4gPSAwOwogICAgICAgICAgICBpZiAoc21hbGxSYWRpdXMpIHsKICAgICAgICAgICAgICBzdHJlYW0ubGluZVN0YXJ0KCk7CiAgICAgICAgICAgICAgc3RyZWFtLnBvaW50KHRbMF1bMF0sIHRbMF1bMV0pOwogICAgICAgICAgICAgIHN0cmVhbS5wb2ludCh0WzFdWzBdLCB0WzFdWzFdKTsKICAgICAgICAgICAgICBzdHJlYW0ubGluZUVuZCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHN0cmVhbS5wb2ludCh0WzFdWzBdLCB0WzFdWzFdKTsKICAgICAgICAgICAgICBzdHJlYW0ubGluZUVuZCgpOwogICAgICAgICAgICAgIHN0cmVhbS5saW5lU3RhcnQoKTsKICAgICAgICAgICAgICBzdHJlYW0ucG9pbnQodFswXVswXSwgdFswXVsxXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHYgJiYgKCFwb2ludDAgfHwgIXBvaW50RXF1YWwocG9pbnQwLCBwb2ludDEpKSkgewogICAgICAgICAgc3RyZWFtLnBvaW50KHBvaW50MVswXSwgcG9pbnQxWzFdKTsKICAgICAgICB9CiAgICAgICAgcG9pbnQwID0gcG9pbnQxLCB2MCA9IHYsIGMwID0gYzsKICAgICAgfSwKICAgICAgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHYwKSBzdHJlYW0ubGluZUVuZCgpOwogICAgICAgIHBvaW50MCA9IG51bGw7CiAgICAgIH0sCiAgICAgIC8vIFJlam9pbiBmaXJzdCBhbmQgbGFzdCBzZWdtZW50cyBpZiB0aGVyZSB3ZXJlIGludGVyc2VjdGlvbnMgYW5kIHRoZSBmaXJzdAogICAgICAvLyBhbmQgbGFzdCBwb2ludHMgd2VyZSB2aXNpYmxlLgogICAgICBjbGVhbjogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGNsZWFuIHwgKCh2MDAgJiYgdjApIDw8IDEpOwogICAgICB9CiAgICB9OwogIH0KCiAgLy8gSW50ZXJzZWN0cyB0aGUgZ3JlYXQgY2lyY2xlIGJldHdlZW4gYSBhbmQgYiB3aXRoIHRoZSBjbGlwIGNpcmNsZS4KICBmdW5jdGlvbiBpbnRlcnNlY3QoYSwgYiwgdHdvKSB7CiAgICB2YXIgcGEgPSBjYXJ0ZXNpYW4oYSksCiAgICAgICAgcGIgPSBjYXJ0ZXNpYW4oYik7CgogICAgLy8gV2UgaGF2ZSB0d28gcGxhbmVzLCBuMS5wID0gZDEgYW5kIG4yLnAgPSBkMi4KICAgIC8vIEZpbmQgaW50ZXJzZWN0aW9uIGxpbmUgcCh0KSA9IGMxIG4xICsgYzIgbjIgKyB0IChuMSDiqK8gbjIpLgogICAgdmFyIG4xID0gWzEsIDAsIDBdLCAvLyBub3JtYWwKICAgICAgICBuMiA9IGNhcnRlc2lhbkNyb3NzKHBhLCBwYiksCiAgICAgICAgbjJuMiA9IGNhcnRlc2lhbkRvdChuMiwgbjIpLAogICAgICAgIG4xbjIgPSBuMlswXSwgLy8gY2FydGVzaWFuRG90KG4xLCBuMiksCiAgICAgICAgZGV0ZXJtaW5hbnQgPSBuMm4yIC0gbjFuMiAqIG4xbjI7CgogICAgLy8gVHdvIHBvbGFyIHBvaW50cy4KICAgIGlmICghZGV0ZXJtaW5hbnQpIHJldHVybiAhdHdvICYmIGE7CgogICAgdmFyIGMxID0gIGNyICogbjJuMiAvIGRldGVybWluYW50LAogICAgICAgIGMyID0gLWNyICogbjFuMiAvIGRldGVybWluYW50LAogICAgICAgIG4xeG4yID0gY2FydGVzaWFuQ3Jvc3MobjEsIG4yKSwKICAgICAgICBBID0gY2FydGVzaWFuU2NhbGUobjEsIGMxKSwKICAgICAgICBCID0gY2FydGVzaWFuU2NhbGUobjIsIGMyKTsKICAgIGNhcnRlc2lhbkFkZEluUGxhY2UoQSwgQik7CgogICAgLy8gU29sdmUgfHAodCl8XjIgPSAxLgogICAgdmFyIHUgPSBuMXhuMiwKICAgICAgICB3ID0gY2FydGVzaWFuRG90KEEsIHUpLAogICAgICAgIHV1ID0gY2FydGVzaWFuRG90KHUsIHUpLAogICAgICAgIHQyID0gdyAqIHcgLSB1dSAqIChjYXJ0ZXNpYW5Eb3QoQSwgQSkgLSAxKTsKCiAgICBpZiAodDIgPCAwKSByZXR1cm47CgogICAgdmFyIHQgPSBzcXJ0KHQyKSwKICAgICAgICBxID0gY2FydGVzaWFuU2NhbGUodSwgKC13IC0gdCkgLyB1dSk7CiAgICBjYXJ0ZXNpYW5BZGRJblBsYWNlKHEsIEEpOwogICAgcSA9IHNwaGVyaWNhbChxKTsKCiAgICBpZiAoIXR3bykgcmV0dXJuIHE7CgogICAgLy8gVHdvIGludGVyc2VjdGlvbiBwb2ludHMuCiAgICB2YXIgbGFtYmRhMCA9IGFbMF0sCiAgICAgICAgbGFtYmRhMSA9IGJbMF0sCiAgICAgICAgcGhpMCA9IGFbMV0sCiAgICAgICAgcGhpMSA9IGJbMV0sCiAgICAgICAgejsKCiAgICBpZiAobGFtYmRhMSA8IGxhbWJkYTApIHogPSBsYW1iZGEwLCBsYW1iZGEwID0gbGFtYmRhMSwgbGFtYmRhMSA9IHo7CgogICAgdmFyIGRlbHRhID0gbGFtYmRhMSAtIGxhbWJkYTAsCiAgICAgICAgcG9sYXIgPSBhYnMoZGVsdGEgLSBwaSQzKSA8IGVwc2lsb24kMiwKICAgICAgICBtZXJpZGlhbiA9IHBvbGFyIHx8IGRlbHRhIDwgZXBzaWxvbiQyOwoKICAgIGlmICghcG9sYXIgJiYgcGhpMSA8IHBoaTApIHogPSBwaGkwLCBwaGkwID0gcGhpMSwgcGhpMSA9IHo7CgogICAgLy8gQ2hlY2sgdGhhdCB0aGUgZmlyc3QgcG9pbnQgaXMgYmV0d2VlbiBhIGFuZCBiLgogICAgaWYgKG1lcmlkaWFuCiAgICAgICAgPyBwb2xhcgogICAgICAgICAgPyBwaGkwICsgcGhpMSA+IDAgXiBxWzFdIDwgKGFicyhxWzBdIC0gbGFtYmRhMCkgPCBlcHNpbG9uJDIgPyBwaGkwIDogcGhpMSkKICAgICAgICAgIDogcGhpMCA8PSBxWzFdICYmIHFbMV0gPD0gcGhpMQogICAgICAgIDogZGVsdGEgPiBwaSQzIF4gKGxhbWJkYTAgPD0gcVswXSAmJiBxWzBdIDw9IGxhbWJkYTEpKSB7CiAgICAgIHZhciBxMSA9IGNhcnRlc2lhblNjYWxlKHUsICgtdyArIHQpIC8gdXUpOwogICAgICBjYXJ0ZXNpYW5BZGRJblBsYWNlKHExLCBBKTsKICAgICAgcmV0dXJuIFtxLCBzcGhlcmljYWwocTEpXTsKICAgIH0KICB9CgogIC8vIEdlbmVyYXRlcyBhIDQtYml0IHZlY3RvciByZXByZXNlbnRpbmcgdGhlIGxvY2F0aW9uIG9mIGEgcG9pbnQgcmVsYXRpdmUgdG8KICAvLyB0aGUgc21hbGwgY2lyY2xlJ3MgYm91bmRpbmcgYm94LgogIGZ1bmN0aW9uIGNvZGUobGFtYmRhLCBwaGkpIHsKICAgIHZhciByID0gc21hbGxSYWRpdXMgPyByYWRpdXMgOiBwaSQzIC0gcmFkaXVzLAogICAgICAgIGNvZGUgPSAwOwogICAgaWYgKGxhbWJkYSA8IC1yKSBjb2RlIHw9IDE7IC8vIGxlZnQKICAgIGVsc2UgaWYgKGxhbWJkYSA+IHIpIGNvZGUgfD0gMjsgLy8gcmlnaHQKICAgIGlmIChwaGkgPCAtcikgY29kZSB8PSA0OyAvLyBiZWxvdwogICAgZWxzZSBpZiAocGhpID4gcikgY29kZSB8PSA4OyAvLyBhYm92ZQogICAgcmV0dXJuIGNvZGU7CiAgfQoKICByZXR1cm4gY2xpcCh2aXNpYmxlLCBjbGlwTGluZSwgaW50ZXJwb2xhdGUsIHNtYWxsUmFkaXVzID8gWzAsIC1yYWRpdXNdIDogWy1waSQzLCByYWRpdXMgLSBwaSQzXSk7Cn0KCmZ1bmN0aW9uIGNsaXBMaW5lKGEsIGIsIHgwLCB5MCwgeDEsIHkxKSB7CiAgdmFyIGF4ID0gYVswXSwKICAgICAgYXkgPSBhWzFdLAogICAgICBieCA9IGJbMF0sCiAgICAgIGJ5ID0gYlsxXSwKICAgICAgdDAgPSAwLAogICAgICB0MSA9IDEsCiAgICAgIGR4ID0gYnggLSBheCwKICAgICAgZHkgPSBieSAtIGF5LAogICAgICByOwoKICByID0geDAgLSBheDsKICBpZiAoIWR4ICYmIHIgPiAwKSByZXR1cm47CiAgciAvPSBkeDsKICBpZiAoZHggPCAwKSB7CiAgICBpZiAociA8IHQwKSByZXR1cm47CiAgICBpZiAociA8IHQxKSB0MSA9IHI7CiAgfSBlbHNlIGlmIChkeCA+IDApIHsKICAgIGlmIChyID4gdDEpIHJldHVybjsKICAgIGlmIChyID4gdDApIHQwID0gcjsKICB9CgogIHIgPSB4MSAtIGF4OwogIGlmICghZHggJiYgciA8IDApIHJldHVybjsKICByIC89IGR4OwogIGlmIChkeCA8IDApIHsKICAgIGlmIChyID4gdDEpIHJldHVybjsKICAgIGlmIChyID4gdDApIHQwID0gcjsKICB9IGVsc2UgaWYgKGR4ID4gMCkgewogICAgaWYgKHIgPCB0MCkgcmV0dXJuOwogICAgaWYgKHIgPCB0MSkgdDEgPSByOwogIH0KCiAgciA9IHkwIC0gYXk7CiAgaWYgKCFkeSAmJiByID4gMCkgcmV0dXJuOwogIHIgLz0gZHk7CiAgaWYgKGR5IDwgMCkgewogICAgaWYgKHIgPCB0MCkgcmV0dXJuOwogICAgaWYgKHIgPCB0MSkgdDEgPSByOwogIH0gZWxzZSBpZiAoZHkgPiAwKSB7CiAgICBpZiAociA+IHQxKSByZXR1cm47CiAgICBpZiAociA+IHQwKSB0MCA9IHI7CiAgfQoKICByID0geTEgLSBheTsKICBpZiAoIWR5ICYmIHIgPCAwKSByZXR1cm47CiAgciAvPSBkeTsKICBpZiAoZHkgPCAwKSB7CiAgICBpZiAociA+IHQxKSByZXR1cm47CiAgICBpZiAociA+IHQwKSB0MCA9IHI7CiAgfSBlbHNlIGlmIChkeSA+IDApIHsKICAgIGlmIChyIDwgdDApIHJldHVybjsKICAgIGlmIChyIDwgdDEpIHQxID0gcjsKICB9CgogIGlmICh0MCA+IDApIGFbMF0gPSBheCArIHQwICogZHgsIGFbMV0gPSBheSArIHQwICogZHk7CiAgaWYgKHQxIDwgMSkgYlswXSA9IGF4ICsgdDEgKiBkeCwgYlsxXSA9IGF5ICsgdDEgKiBkeTsKICByZXR1cm4gdHJ1ZTsKfQoKdmFyIGNsaXBNYXggPSAxZTksIGNsaXBNaW4gPSAtY2xpcE1heDsKCi8vIFRPRE8gVXNlIGQzLXBvbHlnb27igJlzIHBvbHlnb25Db250YWlucyBoZXJlIGZvciB0aGUgcmluZyBjaGVjaz8KLy8gVE9ETyBFbGltaW5hdGUgZHVwbGljYXRlIGJ1ZmZlcmluZyBpbiBjbGlwQnVmZmVyIGFuZCBwb2x5Z29uLnB1c2g/CgpmdW5jdGlvbiBjbGlwUmVjdGFuZ2xlKHgwLCB5MCwgeDEsIHkxKSB7CgogIGZ1bmN0aW9uIHZpc2libGUoeCwgeSkgewogICAgcmV0dXJuIHgwIDw9IHggJiYgeCA8PSB4MSAmJiB5MCA8PSB5ICYmIHkgPD0geTE7CiAgfQoKICBmdW5jdGlvbiBpbnRlcnBvbGF0ZShmcm9tLCB0bywgZGlyZWN0aW9uLCBzdHJlYW0pIHsKICAgIHZhciBhID0gMCwgYTEgPSAwOwogICAgaWYgKGZyb20gPT0gbnVsbAogICAgICAgIHx8IChhID0gY29ybmVyKGZyb20sIGRpcmVjdGlvbikpICE9PSAoYTEgPSBjb3JuZXIodG8sIGRpcmVjdGlvbikpCiAgICAgICAgfHwgY29tcGFyZVBvaW50KGZyb20sIHRvKSA8IDAgXiBkaXJlY3Rpb24gPiAwKSB7CiAgICAgIGRvIHN0cmVhbS5wb2ludChhID09PSAwIHx8IGEgPT09IDMgPyB4MCA6IHgxLCBhID4gMSA/IHkxIDogeTApOwogICAgICB3aGlsZSAoKGEgPSAoYSArIGRpcmVjdGlvbiArIDQpICUgNCkgIT09IGExKTsKICAgIH0gZWxzZSB7CiAgICAgIHN0cmVhbS5wb2ludCh0b1swXSwgdG9bMV0pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gY29ybmVyKHAsIGRpcmVjdGlvbikgewogICAgcmV0dXJuIGFicyhwWzBdIC0geDApIDwgZXBzaWxvbiQyID8gZGlyZWN0aW9uID4gMCA/IDAgOiAzCiAgICAgICAgOiBhYnMocFswXSAtIHgxKSA8IGVwc2lsb24kMiA/IGRpcmVjdGlvbiA+IDAgPyAyIDogMQogICAgICAgIDogYWJzKHBbMV0gLSB5MCkgPCBlcHNpbG9uJDIgPyBkaXJlY3Rpb24gPiAwID8gMSA6IDAKICAgICAgICA6IGRpcmVjdGlvbiA+IDAgPyAzIDogMjsgLy8gYWJzKHBbMV0gLSB5MSkgPCBlcHNpbG9uCiAgfQoKICBmdW5jdGlvbiBjb21wYXJlSW50ZXJzZWN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBjb21wYXJlUG9pbnQoYS54LCBiLngpOwogIH0KCiAgZnVuY3Rpb24gY29tcGFyZVBvaW50KGEsIGIpIHsKICAgIHZhciBjYSA9IGNvcm5lcihhLCAxKSwKICAgICAgICBjYiA9IGNvcm5lcihiLCAxKTsKICAgIHJldHVybiBjYSAhPT0gY2IgPyBjYSAtIGNiCiAgICAgICAgOiBjYSA9PT0gMCA/IGJbMV0gLSBhWzFdCiAgICAgICAgOiBjYSA9PT0gMSA/IGFbMF0gLSBiWzBdCiAgICAgICAgOiBjYSA9PT0gMiA/IGFbMV0gLSBiWzFdCiAgICAgICAgOiBiWzBdIC0gYVswXTsKICB9CgogIHJldHVybiBmdW5jdGlvbihzdHJlYW0pIHsKICAgIHZhciBhY3RpdmVTdHJlYW0gPSBzdHJlYW0sCiAgICAgICAgYnVmZmVyU3RyZWFtID0gY2xpcEJ1ZmZlcigpLAogICAgICAgIHNlZ21lbnRzLAogICAgICAgIHBvbHlnb24sCiAgICAgICAgcmluZywKICAgICAgICB4X18sIHlfXywgdl9fLCAvLyBmaXJzdCBwb2ludAogICAgICAgIHhfLCB5Xywgdl8sIC8vIHByZXZpb3VzIHBvaW50CiAgICAgICAgZmlyc3QsCiAgICAgICAgY2xlYW47CgogICAgdmFyIGNsaXBTdHJlYW0gPSB7CiAgICAgIHBvaW50OiBwb2ludCwKICAgICAgbGluZVN0YXJ0OiBsaW5lU3RhcnQsCiAgICAgIGxpbmVFbmQ6IGxpbmVFbmQsCiAgICAgIHBvbHlnb25TdGFydDogcG9seWdvblN0YXJ0LAogICAgICBwb2x5Z29uRW5kOiBwb2x5Z29uRW5kCiAgICB9OwoKICAgIGZ1bmN0aW9uIHBvaW50KHgsIHkpIHsKICAgICAgaWYgKHZpc2libGUoeCwgeSkpIGFjdGl2ZVN0cmVhbS5wb2ludCh4LCB5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBwb2x5Z29uSW5zaWRlKCkgewogICAgICB2YXIgd2luZGluZyA9IDA7CgogICAgICBmb3IgKHZhciBpID0gMCwgbiA9IHBvbHlnb24ubGVuZ3RoOyBpIDwgbjsgKytpKSB7CiAgICAgICAgZm9yICh2YXIgcmluZyA9IHBvbHlnb25baV0sIGogPSAxLCBtID0gcmluZy5sZW5ndGgsIHBvaW50ID0gcmluZ1swXSwgYTAsIGExLCBiMCA9IHBvaW50WzBdLCBiMSA9IHBvaW50WzFdOyBqIDwgbTsgKytqKSB7CiAgICAgICAgICBhMCA9IGIwLCBhMSA9IGIxLCBwb2ludCA9IHJpbmdbal0sIGIwID0gcG9pbnRbMF0sIGIxID0gcG9pbnRbMV07CiAgICAgICAgICBpZiAoYTEgPD0geTEpIHsgaWYgKGIxID4geTEgJiYgKGIwIC0gYTApICogKHkxIC0gYTEpID4gKGIxIC0gYTEpICogKHgwIC0gYTApKSArK3dpbmRpbmc7IH0KICAgICAgICAgIGVsc2UgeyBpZiAoYjEgPD0geTEgJiYgKGIwIC0gYTApICogKHkxIC0gYTEpIDwgKGIxIC0gYTEpICogKHgwIC0gYTApKSAtLXdpbmRpbmc7IH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB3aW5kaW5nOwogICAgfQoKICAgIC8vIEJ1ZmZlciBnZW9tZXRyeSB3aXRoaW4gYSBwb2x5Z29uIGFuZCB0aGVuIGNsaXAgaXQgZW4gbWFzc2UuCiAgICBmdW5jdGlvbiBwb2x5Z29uU3RhcnQoKSB7CiAgICAgIGFjdGl2ZVN0cmVhbSA9IGJ1ZmZlclN0cmVhbSwgc2VnbWVudHMgPSBbXSwgcG9seWdvbiA9IFtdLCBjbGVhbiA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gcG9seWdvbkVuZCgpIHsKICAgICAgdmFyIHN0YXJ0SW5zaWRlID0gcG9seWdvbkluc2lkZSgpLAogICAgICAgICAgY2xlYW5JbnNpZGUgPSBjbGVhbiAmJiBzdGFydEluc2lkZSwKICAgICAgICAgIHZpc2libGUgPSAoc2VnbWVudHMgPSBtZXJnZShzZWdtZW50cykpLmxlbmd0aDsKICAgICAgaWYgKGNsZWFuSW5zaWRlIHx8IHZpc2libGUpIHsKICAgICAgICBzdHJlYW0ucG9seWdvblN0YXJ0KCk7CiAgICAgICAgaWYgKGNsZWFuSW5zaWRlKSB7CiAgICAgICAgICBzdHJlYW0ubGluZVN0YXJ0KCk7CiAgICAgICAgICBpbnRlcnBvbGF0ZShudWxsLCBudWxsLCAxLCBzdHJlYW0pOwogICAgICAgICAgc3RyZWFtLmxpbmVFbmQoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHZpc2libGUpIHsKICAgICAgICAgIGNsaXBSZWpvaW4oc2VnbWVudHMsIGNvbXBhcmVJbnRlcnNlY3Rpb24sIHN0YXJ0SW5zaWRlLCBpbnRlcnBvbGF0ZSwgc3RyZWFtKTsKICAgICAgICB9CiAgICAgICAgc3RyZWFtLnBvbHlnb25FbmQoKTsKICAgICAgfQogICAgICBhY3RpdmVTdHJlYW0gPSBzdHJlYW0sIHNlZ21lbnRzID0gcG9seWdvbiA9IHJpbmcgPSBudWxsOwogICAgfQoKICAgIGZ1bmN0aW9uIGxpbmVTdGFydCgpIHsKICAgICAgY2xpcFN0cmVhbS5wb2ludCA9IGxpbmVQb2ludDsKICAgICAgaWYgKHBvbHlnb24pIHBvbHlnb24ucHVzaChyaW5nID0gW10pOwogICAgICBmaXJzdCA9IHRydWU7CiAgICAgIHZfID0gZmFsc2U7CiAgICAgIHhfID0geV8gPSBOYU47CiAgICB9CgogICAgLy8gVE9ETyByYXRoZXIgdGhhbiBzcGVjaWFsLWNhc2UgcG9seWdvbnMsIHNpbXBseSBoYW5kbGUgdGhlbSBzZXBhcmF0ZWx5LgogICAgLy8gSWRlYWxseSwgY29pbmNpZGVudCBpbnRlcnNlY3Rpb24gcG9pbnRzIHNob3VsZCBiZSBqaXR0ZXJlZCB0byBhdm9pZAogICAgLy8gY2xpcHBpbmcgaXNzdWVzLgogICAgZnVuY3Rpb24gbGluZUVuZCgpIHsKICAgICAgaWYgKHNlZ21lbnRzKSB7CiAgICAgICAgbGluZVBvaW50KHhfXywgeV9fKTsKICAgICAgICBpZiAodl9fICYmIHZfKSBidWZmZXJTdHJlYW0ucmVqb2luKCk7CiAgICAgICAgc2VnbWVudHMucHVzaChidWZmZXJTdHJlYW0ucmVzdWx0KCkpOwogICAgICB9CiAgICAgIGNsaXBTdHJlYW0ucG9pbnQgPSBwb2ludDsKICAgICAgaWYgKHZfKSBhY3RpdmVTdHJlYW0ubGluZUVuZCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGxpbmVQb2ludCh4LCB5KSB7CiAgICAgIHZhciB2ID0gdmlzaWJsZSh4LCB5KTsKICAgICAgaWYgKHBvbHlnb24pIHJpbmcucHVzaChbeCwgeV0pOwogICAgICBpZiAoZmlyc3QpIHsKICAgICAgICB4X18gPSB4LCB5X18gPSB5LCB2X18gPSB2OwogICAgICAgIGZpcnN0ID0gZmFsc2U7CiAgICAgICAgaWYgKHYpIHsKICAgICAgICAgIGFjdGl2ZVN0cmVhbS5saW5lU3RhcnQoKTsKICAgICAgICAgIGFjdGl2ZVN0cmVhbS5wb2ludCh4LCB5KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHYgJiYgdl8pIGFjdGl2ZVN0cmVhbS5wb2ludCh4LCB5KTsKICAgICAgICBlbHNlIHsKICAgICAgICAgIHZhciBhID0gW3hfID0gTWF0aC5tYXgoY2xpcE1pbiwgTWF0aC5taW4oY2xpcE1heCwgeF8pKSwgeV8gPSBNYXRoLm1heChjbGlwTWluLCBNYXRoLm1pbihjbGlwTWF4LCB5XykpXSwKICAgICAgICAgICAgICBiID0gW3ggPSBNYXRoLm1heChjbGlwTWluLCBNYXRoLm1pbihjbGlwTWF4LCB4KSksIHkgPSBNYXRoLm1heChjbGlwTWluLCBNYXRoLm1pbihjbGlwTWF4LCB5KSldOwogICAgICAgICAgaWYgKGNsaXBMaW5lKGEsIGIsIHgwLCB5MCwgeDEsIHkxKSkgewogICAgICAgICAgICBpZiAoIXZfKSB7CiAgICAgICAgICAgICAgYWN0aXZlU3RyZWFtLmxpbmVTdGFydCgpOwogICAgICAgICAgICAgIGFjdGl2ZVN0cmVhbS5wb2ludChhWzBdLCBhWzFdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhY3RpdmVTdHJlYW0ucG9pbnQoYlswXSwgYlsxXSk7CiAgICAgICAgICAgIGlmICghdikgYWN0aXZlU3RyZWFtLmxpbmVFbmQoKTsKICAgICAgICAgICAgY2xlYW4gPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSBpZiAodikgewogICAgICAgICAgICBhY3RpdmVTdHJlYW0ubGluZVN0YXJ0KCk7CiAgICAgICAgICAgIGFjdGl2ZVN0cmVhbS5wb2ludCh4LCB5KTsKICAgICAgICAgICAgY2xlYW4gPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgeF8gPSB4LCB5XyA9IHksIHZfID0gdjsKICAgIH0KCiAgICByZXR1cm4gY2xpcFN0cmVhbTsKICB9Owp9CgpmdW5jdGlvbiBleHRlbnQkMSgpIHsKICB2YXIgeDAgPSAwLAogICAgICB5MCA9IDAsCiAgICAgIHgxID0gOTYwLAogICAgICB5MSA9IDUwMCwKICAgICAgY2FjaGUsCiAgICAgIGNhY2hlU3RyZWFtLAogICAgICBjbGlwOwoKICByZXR1cm4gY2xpcCA9IHsKICAgIHN0cmVhbTogZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAgIHJldHVybiBjYWNoZSAmJiBjYWNoZVN0cmVhbSA9PT0gc3RyZWFtID8gY2FjaGUgOiBjYWNoZSA9IGNsaXBSZWN0YW5nbGUoeDAsIHkwLCB4MSwgeTEpKGNhY2hlU3RyZWFtID0gc3RyZWFtKTsKICAgIH0sCiAgICBleHRlbnQ6IGZ1bmN0aW9uKF8pIHsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoeDAgPSArX1swXVswXSwgeTAgPSArX1swXVsxXSwgeDEgPSArX1sxXVswXSwgeTEgPSArX1sxXVsxXSwgY2FjaGUgPSBjYWNoZVN0cmVhbSA9IG51bGwsIGNsaXApIDogW1t4MCwgeTBdLCBbeDEsIHkxXV07CiAgICB9CiAgfTsKfQoKdmFyIGxlbmd0aFN1bSA9IGFkZGVyKCksCiAgICBsYW1iZGEwJDIsCiAgICBzaW5QaGkwJDEsCiAgICBjb3NQaGkwJDE7Cgp2YXIgbGVuZ3RoU3RyZWFtID0gewogIHNwaGVyZTogbm9vcCQyLAogIHBvaW50OiBub29wJDIsCiAgbGluZVN0YXJ0OiBsZW5ndGhMaW5lU3RhcnQsCiAgbGluZUVuZDogbm9vcCQyLAogIHBvbHlnb25TdGFydDogbm9vcCQyLAogIHBvbHlnb25FbmQ6IG5vb3AkMgp9OwoKZnVuY3Rpb24gbGVuZ3RoTGluZVN0YXJ0KCkgewogIGxlbmd0aFN0cmVhbS5wb2ludCA9IGxlbmd0aFBvaW50Rmlyc3Q7CiAgbGVuZ3RoU3RyZWFtLmxpbmVFbmQgPSBsZW5ndGhMaW5lRW5kOwp9CgpmdW5jdGlvbiBsZW5ndGhMaW5lRW5kKCkgewogIGxlbmd0aFN0cmVhbS5wb2ludCA9IGxlbmd0aFN0cmVhbS5saW5lRW5kID0gbm9vcCQyOwp9CgpmdW5jdGlvbiBsZW5ndGhQb2ludEZpcnN0KGxhbWJkYSwgcGhpKSB7CiAgbGFtYmRhICo9IHJhZGlhbnMsIHBoaSAqPSByYWRpYW5zOwogIGxhbWJkYTAkMiA9IGxhbWJkYSwgc2luUGhpMCQxID0gc2luJDEocGhpKSwgY29zUGhpMCQxID0gY29zJDEocGhpKTsKICBsZW5ndGhTdHJlYW0ucG9pbnQgPSBsZW5ndGhQb2ludDsKfQoKZnVuY3Rpb24gbGVuZ3RoUG9pbnQobGFtYmRhLCBwaGkpIHsKICBsYW1iZGEgKj0gcmFkaWFucywgcGhpICo9IHJhZGlhbnM7CiAgdmFyIHNpblBoaSA9IHNpbiQxKHBoaSksCiAgICAgIGNvc1BoaSA9IGNvcyQxKHBoaSksCiAgICAgIGRlbHRhID0gYWJzKGxhbWJkYSAtIGxhbWJkYTAkMiksCiAgICAgIGNvc0RlbHRhID0gY29zJDEoZGVsdGEpLAogICAgICBzaW5EZWx0YSA9IHNpbiQxKGRlbHRhKSwKICAgICAgeCA9IGNvc1BoaSAqIHNpbkRlbHRhLAogICAgICB5ID0gY29zUGhpMCQxICogc2luUGhpIC0gc2luUGhpMCQxICogY29zUGhpICogY29zRGVsdGEsCiAgICAgIHogPSBzaW5QaGkwJDEgKiBzaW5QaGkgKyBjb3NQaGkwJDEgKiBjb3NQaGkgKiBjb3NEZWx0YTsKICBsZW5ndGhTdW0uYWRkKGF0YW4yKHNxcnQoeCAqIHggKyB5ICogeSksIHopKTsKICBsYW1iZGEwJDIgPSBsYW1iZGEsIHNpblBoaTAkMSA9IHNpblBoaSwgY29zUGhpMCQxID0gY29zUGhpOwp9CgpmdW5jdGlvbiBsZW5ndGgkMShvYmplY3QpIHsKICBsZW5ndGhTdW0ucmVzZXQoKTsKICBnZW9TdHJlYW0ob2JqZWN0LCBsZW5ndGhTdHJlYW0pOwogIHJldHVybiArbGVuZ3RoU3VtOwp9Cgp2YXIgY29vcmRpbmF0ZXMgPSBbbnVsbCwgbnVsbF0sCiAgICBvYmplY3QkMSA9IHt0eXBlOiAiTGluZVN0cmluZyIsIGNvb3JkaW5hdGVzOiBjb29yZGluYXRlc307CgpmdW5jdGlvbiBkaXN0YW5jZShhLCBiKSB7CiAgY29vcmRpbmF0ZXNbMF0gPSBhOwogIGNvb3JkaW5hdGVzWzFdID0gYjsKICByZXR1cm4gbGVuZ3RoJDEob2JqZWN0JDEpOwp9Cgp2YXIgY29udGFpbnNPYmplY3RUeXBlID0gewogIEZlYXR1cmU6IGZ1bmN0aW9uKG9iamVjdCwgcG9pbnQpIHsKICAgIHJldHVybiBjb250YWluc0dlb21ldHJ5KG9iamVjdC5nZW9tZXRyeSwgcG9pbnQpOwogIH0sCiAgRmVhdHVyZUNvbGxlY3Rpb246IGZ1bmN0aW9uKG9iamVjdCwgcG9pbnQpIHsKICAgIHZhciBmZWF0dXJlcyA9IG9iamVjdC5mZWF0dXJlcywgaSA9IC0xLCBuID0gZmVhdHVyZXMubGVuZ3RoOwogICAgd2hpbGUgKCsraSA8IG4pIGlmIChjb250YWluc0dlb21ldHJ5KGZlYXR1cmVzW2ldLmdlb21ldHJ5LCBwb2ludCkpIHJldHVybiB0cnVlOwogICAgcmV0dXJuIGZhbHNlOwogIH0KfTsKCnZhciBjb250YWluc0dlb21ldHJ5VHlwZSA9IHsKICBTcGhlcmU6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRydWU7CiAgfSwKICBQb2ludDogZnVuY3Rpb24ob2JqZWN0LCBwb2ludCkgewogICAgcmV0dXJuIGNvbnRhaW5zUG9pbnQob2JqZWN0LmNvb3JkaW5hdGVzLCBwb2ludCk7CiAgfSwKICBNdWx0aVBvaW50OiBmdW5jdGlvbihvYmplY3QsIHBvaW50KSB7CiAgICB2YXIgY29vcmRpbmF0ZXMgPSBvYmplY3QuY29vcmRpbmF0ZXMsIGkgPSAtMSwgbiA9IGNvb3JkaW5hdGVzLmxlbmd0aDsKICAgIHdoaWxlICgrK2kgPCBuKSBpZiAoY29udGFpbnNQb2ludChjb29yZGluYXRlc1tpXSwgcG9pbnQpKSByZXR1cm4gdHJ1ZTsKICAgIHJldHVybiBmYWxzZTsKICB9LAogIExpbmVTdHJpbmc6IGZ1bmN0aW9uKG9iamVjdCwgcG9pbnQpIHsKICAgIHJldHVybiBjb250YWluc0xpbmUob2JqZWN0LmNvb3JkaW5hdGVzLCBwb2ludCk7CiAgfSwKICBNdWx0aUxpbmVTdHJpbmc6IGZ1bmN0aW9uKG9iamVjdCwgcG9pbnQpIHsKICAgIHZhciBjb29yZGluYXRlcyA9IG9iamVjdC5jb29yZGluYXRlcywgaSA9IC0xLCBuID0gY29vcmRpbmF0ZXMubGVuZ3RoOwogICAgd2hpbGUgKCsraSA8IG4pIGlmIChjb250YWluc0xpbmUoY29vcmRpbmF0ZXNbaV0sIHBvaW50KSkgcmV0dXJuIHRydWU7CiAgICByZXR1cm4gZmFsc2U7CiAgfSwKICBQb2x5Z29uOiBmdW5jdGlvbihvYmplY3QsIHBvaW50KSB7CiAgICByZXR1cm4gY29udGFpbnNQb2x5Z29uKG9iamVjdC5jb29yZGluYXRlcywgcG9pbnQpOwogIH0sCiAgTXVsdGlQb2x5Z29uOiBmdW5jdGlvbihvYmplY3QsIHBvaW50KSB7CiAgICB2YXIgY29vcmRpbmF0ZXMgPSBvYmplY3QuY29vcmRpbmF0ZXMsIGkgPSAtMSwgbiA9IGNvb3JkaW5hdGVzLmxlbmd0aDsKICAgIHdoaWxlICgrK2kgPCBuKSBpZiAoY29udGFpbnNQb2x5Z29uKGNvb3JkaW5hdGVzW2ldLCBwb2ludCkpIHJldHVybiB0cnVlOwogICAgcmV0dXJuIGZhbHNlOwogIH0sCiAgR2VvbWV0cnlDb2xsZWN0aW9uOiBmdW5jdGlvbihvYmplY3QsIHBvaW50KSB7CiAgICB2YXIgZ2VvbWV0cmllcyA9IG9iamVjdC5nZW9tZXRyaWVzLCBpID0gLTEsIG4gPSBnZW9tZXRyaWVzLmxlbmd0aDsKICAgIHdoaWxlICgrK2kgPCBuKSBpZiAoY29udGFpbnNHZW9tZXRyeShnZW9tZXRyaWVzW2ldLCBwb2ludCkpIHJldHVybiB0cnVlOwogICAgcmV0dXJuIGZhbHNlOwogIH0KfTsKCmZ1bmN0aW9uIGNvbnRhaW5zR2VvbWV0cnkoZ2VvbWV0cnksIHBvaW50KSB7CiAgcmV0dXJuIGdlb21ldHJ5ICYmIGNvbnRhaW5zR2VvbWV0cnlUeXBlLmhhc093blByb3BlcnR5KGdlb21ldHJ5LnR5cGUpCiAgICAgID8gY29udGFpbnNHZW9tZXRyeVR5cGVbZ2VvbWV0cnkudHlwZV0oZ2VvbWV0cnksIHBvaW50KQogICAgICA6IGZhbHNlOwp9CgpmdW5jdGlvbiBjb250YWluc1BvaW50KGNvb3JkaW5hdGVzLCBwb2ludCkgewogIHJldHVybiBkaXN0YW5jZShjb29yZGluYXRlcywgcG9pbnQpID09PSAwOwp9CgpmdW5jdGlvbiBjb250YWluc0xpbmUoY29vcmRpbmF0ZXMsIHBvaW50KSB7CiAgdmFyIGFiID0gZGlzdGFuY2UoY29vcmRpbmF0ZXNbMF0sIGNvb3JkaW5hdGVzWzFdKSwKICAgICAgYW8gPSBkaXN0YW5jZShjb29yZGluYXRlc1swXSwgcG9pbnQpLAogICAgICBvYiA9IGRpc3RhbmNlKHBvaW50LCBjb29yZGluYXRlc1sxXSk7CiAgcmV0dXJuIGFvICsgb2IgPD0gYWIgKyBlcHNpbG9uJDI7Cn0KCmZ1bmN0aW9uIGNvbnRhaW5zUG9seWdvbihjb29yZGluYXRlcywgcG9pbnQpIHsKICByZXR1cm4gISFwb2x5Z29uQ29udGFpbnMoY29vcmRpbmF0ZXMubWFwKHJpbmdSYWRpYW5zKSwgcG9pbnRSYWRpYW5zKHBvaW50KSk7Cn0KCmZ1bmN0aW9uIHJpbmdSYWRpYW5zKHJpbmcpIHsKICByZXR1cm4gcmluZyA9IHJpbmcubWFwKHBvaW50UmFkaWFucyksIHJpbmcucG9wKCksIHJpbmc7Cn0KCmZ1bmN0aW9uIHBvaW50UmFkaWFucyhwb2ludCkgewogIHJldHVybiBbcG9pbnRbMF0gKiByYWRpYW5zLCBwb2ludFsxXSAqIHJhZGlhbnNdOwp9CgpmdW5jdGlvbiBjb250YWlucyQxKG9iamVjdCwgcG9pbnQpIHsKICByZXR1cm4gKG9iamVjdCAmJiBjb250YWluc09iamVjdFR5cGUuaGFzT3duUHJvcGVydHkob2JqZWN0LnR5cGUpCiAgICAgID8gY29udGFpbnNPYmplY3RUeXBlW29iamVjdC50eXBlXQogICAgICA6IGNvbnRhaW5zR2VvbWV0cnkpKG9iamVjdCwgcG9pbnQpOwp9CgpmdW5jdGlvbiBncmF0aWN1bGVYKHkwLCB5MSwgZHkpIHsKICB2YXIgeSA9IHNlcXVlbmNlKHkwLCB5MSAtIGVwc2lsb24kMiwgZHkpLmNvbmNhdCh5MSk7CiAgcmV0dXJuIGZ1bmN0aW9uKHgpIHsgcmV0dXJuIHkubWFwKGZ1bmN0aW9uKHkpIHsgcmV0dXJuIFt4LCB5XTsgfSk7IH07Cn0KCmZ1bmN0aW9uIGdyYXRpY3VsZVkoeDAsIHgxLCBkeCkgewogIHZhciB4ID0gc2VxdWVuY2UoeDAsIHgxIC0gZXBzaWxvbiQyLCBkeCkuY29uY2F0KHgxKTsKICByZXR1cm4gZnVuY3Rpb24oeSkgeyByZXR1cm4geC5tYXAoZnVuY3Rpb24oeCkgeyByZXR1cm4gW3gsIHldOyB9KTsgfTsKfQoKZnVuY3Rpb24gZ3JhdGljdWxlKCkgewogIHZhciB4MSwgeDAsIFgxLCBYMCwKICAgICAgeTEsIHkwLCBZMSwgWTAsCiAgICAgIGR4ID0gMTAsIGR5ID0gZHgsIERYID0gOTAsIERZID0gMzYwLAogICAgICB4LCB5LCBYLCBZLAogICAgICBwcmVjaXNpb24gPSAyLjU7CgogIGZ1bmN0aW9uIGdyYXRpY3VsZSgpIHsKICAgIHJldHVybiB7dHlwZTogIk11bHRpTGluZVN0cmluZyIsIGNvb3JkaW5hdGVzOiBsaW5lcygpfTsKICB9CgogIGZ1bmN0aW9uIGxpbmVzKCkgewogICAgcmV0dXJuIHNlcXVlbmNlKGNlaWwoWDAgLyBEWCkgKiBEWCwgWDEsIERYKS5tYXAoWCkKICAgICAgICAuY29uY2F0KHNlcXVlbmNlKGNlaWwoWTAgLyBEWSkgKiBEWSwgWTEsIERZKS5tYXAoWSkpCiAgICAgICAgLmNvbmNhdChzZXF1ZW5jZShjZWlsKHgwIC8gZHgpICogZHgsIHgxLCBkeCkuZmlsdGVyKGZ1bmN0aW9uKHgpIHsgcmV0dXJuIGFicyh4ICUgRFgpID4gZXBzaWxvbiQyOyB9KS5tYXAoeCkpCiAgICAgICAgLmNvbmNhdChzZXF1ZW5jZShjZWlsKHkwIC8gZHkpICogZHksIHkxLCBkeSkuZmlsdGVyKGZ1bmN0aW9uKHkpIHsgcmV0dXJuIGFicyh5ICUgRFkpID4gZXBzaWxvbiQyOyB9KS5tYXAoeSkpOwogIH0KCiAgZ3JhdGljdWxlLmxpbmVzID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gbGluZXMoKS5tYXAoZnVuY3Rpb24oY29vcmRpbmF0ZXMpIHsgcmV0dXJuIHt0eXBlOiAiTGluZVN0cmluZyIsIGNvb3JkaW5hdGVzOiBjb29yZGluYXRlc307IH0pOwogIH07CgogIGdyYXRpY3VsZS5vdXRsaW5lID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gewogICAgICB0eXBlOiAiUG9seWdvbiIsCiAgICAgIGNvb3JkaW5hdGVzOiBbCiAgICAgICAgWChYMCkuY29uY2F0KAogICAgICAgIFkoWTEpLnNsaWNlKDEpLAogICAgICAgIFgoWDEpLnJldmVyc2UoKS5zbGljZSgxKSwKICAgICAgICBZKFkwKS5yZXZlcnNlKCkuc2xpY2UoMSkpCiAgICAgIF0KICAgIH07CiAgfTsKCiAgZ3JhdGljdWxlLmV4dGVudCA9IGZ1bmN0aW9uKF8pIHsKICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGdyYXRpY3VsZS5leHRlbnRNaW5vcigpOwogICAgcmV0dXJuIGdyYXRpY3VsZS5leHRlbnRNYWpvcihfKS5leHRlbnRNaW5vcihfKTsKICB9OwoKICBncmF0aWN1bGUuZXh0ZW50TWFqb3IgPSBmdW5jdGlvbihfKSB7CiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBbW1gwLCBZMF0sIFtYMSwgWTFdXTsKICAgIFgwID0gK19bMF1bMF0sIFgxID0gK19bMV1bMF07CiAgICBZMCA9ICtfWzBdWzFdLCBZMSA9ICtfWzFdWzFdOwogICAgaWYgKFgwID4gWDEpIF8gPSBYMCwgWDAgPSBYMSwgWDEgPSBfOwogICAgaWYgKFkwID4gWTEpIF8gPSBZMCwgWTAgPSBZMSwgWTEgPSBfOwogICAgcmV0dXJuIGdyYXRpY3VsZS5wcmVjaXNpb24ocHJlY2lzaW9uKTsKICB9OwoKICBncmF0aWN1bGUuZXh0ZW50TWlub3IgPSBmdW5jdGlvbihfKSB7CiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBbW3gwLCB5MF0sIFt4MSwgeTFdXTsKICAgIHgwID0gK19bMF1bMF0sIHgxID0gK19bMV1bMF07CiAgICB5MCA9ICtfWzBdWzFdLCB5MSA9ICtfWzFdWzFdOwogICAgaWYgKHgwID4geDEpIF8gPSB4MCwgeDAgPSB4MSwgeDEgPSBfOwogICAgaWYgKHkwID4geTEpIF8gPSB5MCwgeTAgPSB5MSwgeTEgPSBfOwogICAgcmV0dXJuIGdyYXRpY3VsZS5wcmVjaXNpb24ocHJlY2lzaW9uKTsKICB9OwoKICBncmF0aWN1bGUuc3RlcCA9IGZ1bmN0aW9uKF8pIHsKICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGdyYXRpY3VsZS5zdGVwTWlub3IoKTsKICAgIHJldHVybiBncmF0aWN1bGUuc3RlcE1ham9yKF8pLnN0ZXBNaW5vcihfKTsKICB9OwoKICBncmF0aWN1bGUuc3RlcE1ham9yID0gZnVuY3Rpb24oXykgewogICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gW0RYLCBEWV07CiAgICBEWCA9ICtfWzBdLCBEWSA9ICtfWzFdOwogICAgcmV0dXJuIGdyYXRpY3VsZTsKICB9OwoKICBncmF0aWN1bGUuc3RlcE1pbm9yID0gZnVuY3Rpb24oXykgewogICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gW2R4LCBkeV07CiAgICBkeCA9ICtfWzBdLCBkeSA9ICtfWzFdOwogICAgcmV0dXJuIGdyYXRpY3VsZTsKICB9OwoKICBncmF0aWN1bGUucHJlY2lzaW9uID0gZnVuY3Rpb24oXykgewogICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gcHJlY2lzaW9uOwogICAgcHJlY2lzaW9uID0gK187CiAgICB4ID0gZ3JhdGljdWxlWCh5MCwgeTEsIDkwKTsKICAgIHkgPSBncmF0aWN1bGVZKHgwLCB4MSwgcHJlY2lzaW9uKTsKICAgIFggPSBncmF0aWN1bGVYKFkwLCBZMSwgOTApOwogICAgWSA9IGdyYXRpY3VsZVkoWDAsIFgxLCBwcmVjaXNpb24pOwogICAgcmV0dXJuIGdyYXRpY3VsZTsKICB9OwoKICByZXR1cm4gZ3JhdGljdWxlCiAgICAgIC5leHRlbnRNYWpvcihbWy0xODAsIC05MCArIGVwc2lsb24kMl0sIFsxODAsIDkwIC0gZXBzaWxvbiQyXV0pCiAgICAgIC5leHRlbnRNaW5vcihbWy0xODAsIC04MCAtIGVwc2lsb24kMl0sIFsxODAsIDgwICsgZXBzaWxvbiQyXV0pOwp9CgpmdW5jdGlvbiBncmF0aWN1bGUxMCgpIHsKICByZXR1cm4gZ3JhdGljdWxlKCkoKTsKfQoKZnVuY3Rpb24gaW50ZXJwb2xhdGUkMShhLCBiKSB7CiAgdmFyIHgwID0gYVswXSAqIHJhZGlhbnMsCiAgICAgIHkwID0gYVsxXSAqIHJhZGlhbnMsCiAgICAgIHgxID0gYlswXSAqIHJhZGlhbnMsCiAgICAgIHkxID0gYlsxXSAqIHJhZGlhbnMsCiAgICAgIGN5MCA9IGNvcyQxKHkwKSwKICAgICAgc3kwID0gc2luJDEoeTApLAogICAgICBjeTEgPSBjb3MkMSh5MSksCiAgICAgIHN5MSA9IHNpbiQxKHkxKSwKICAgICAga3gwID0gY3kwICogY29zJDEoeDApLAogICAgICBreTAgPSBjeTAgKiBzaW4kMSh4MCksCiAgICAgIGt4MSA9IGN5MSAqIGNvcyQxKHgxKSwKICAgICAga3kxID0gY3kxICogc2luJDEoeDEpLAogICAgICBkID0gMiAqIGFzaW4oc3FydChoYXZlcnNpbih5MSAtIHkwKSArIGN5MCAqIGN5MSAqIGhhdmVyc2luKHgxIC0geDApKSksCiAgICAgIGsgPSBzaW4kMShkKTsKCiAgdmFyIGludGVycG9sYXRlID0gZCA/IGZ1bmN0aW9uKHQpIHsKICAgIHZhciBCID0gc2luJDEodCAqPSBkKSAvIGssCiAgICAgICAgQSA9IHNpbiQxKGQgLSB0KSAvIGssCiAgICAgICAgeCA9IEEgKiBreDAgKyBCICoga3gxLAogICAgICAgIHkgPSBBICoga3kwICsgQiAqIGt5MSwKICAgICAgICB6ID0gQSAqIHN5MCArIEIgKiBzeTE7CiAgICByZXR1cm4gWwogICAgICBhdGFuMih5LCB4KSAqIGRlZ3JlZXMkMSwKICAgICAgYXRhbjIoeiwgc3FydCh4ICogeCArIHkgKiB5KSkgKiBkZWdyZWVzJDEKICAgIF07CiAgfSA6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIFt4MCAqIGRlZ3JlZXMkMSwgeTAgKiBkZWdyZWVzJDFdOwogIH07CgogIGludGVycG9sYXRlLmRpc3RhbmNlID0gZDsKCiAgcmV0dXJuIGludGVycG9sYXRlOwp9CgpmdW5jdGlvbiBpZGVudGl0eSQ0KHgpIHsKICByZXR1cm4geDsKfQoKdmFyIGFyZWFTdW0kMSA9IGFkZGVyKCksCiAgICBhcmVhUmluZ1N1bSQxID0gYWRkZXIoKSwKICAgIHgwMCwKICAgIHkwMCwKICAgIHgwJDEsCiAgICB5MCQxOwoKdmFyIGFyZWFTdHJlYW0kMSA9IHsKICBwb2ludDogbm9vcCQyLAogIGxpbmVTdGFydDogbm9vcCQyLAogIGxpbmVFbmQ6IG5vb3AkMiwKICBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgYXJlYVN0cmVhbSQxLmxpbmVTdGFydCA9IGFyZWFSaW5nU3RhcnQkMTsKICAgIGFyZWFTdHJlYW0kMS5saW5lRW5kID0gYXJlYVJpbmdFbmQkMTsKICB9LAogIHBvbHlnb25FbmQ6IGZ1bmN0aW9uKCkgewogICAgYXJlYVN0cmVhbSQxLmxpbmVTdGFydCA9IGFyZWFTdHJlYW0kMS5saW5lRW5kID0gYXJlYVN0cmVhbSQxLnBvaW50ID0gbm9vcCQyOwogICAgYXJlYVN1bSQxLmFkZChhYnMoYXJlYVJpbmdTdW0kMSkpOwogICAgYXJlYVJpbmdTdW0kMS5yZXNldCgpOwogIH0sCiAgcmVzdWx0OiBmdW5jdGlvbigpIHsKICAgIHZhciBhcmVhID0gYXJlYVN1bSQxIC8gMjsKICAgIGFyZWFTdW0kMS5yZXNldCgpOwogICAgcmV0dXJuIGFyZWE7CiAgfQp9OwoKZnVuY3Rpb24gYXJlYVJpbmdTdGFydCQxKCkgewogIGFyZWFTdHJlYW0kMS5wb2ludCA9IGFyZWFQb2ludEZpcnN0JDE7Cn0KCmZ1bmN0aW9uIGFyZWFQb2ludEZpcnN0JDEoeCwgeSkgewogIGFyZWFTdHJlYW0kMS5wb2ludCA9IGFyZWFQb2ludCQxOwogIHgwMCA9IHgwJDEgPSB4LCB5MDAgPSB5MCQxID0geTsKfQoKZnVuY3Rpb24gYXJlYVBvaW50JDEoeCwgeSkgewogIGFyZWFSaW5nU3VtJDEuYWRkKHkwJDEgKiB4IC0geDAkMSAqIHkpOwogIHgwJDEgPSB4LCB5MCQxID0geTsKfQoKZnVuY3Rpb24gYXJlYVJpbmdFbmQkMSgpIHsKICBhcmVhUG9pbnQkMSh4MDAsIHkwMCk7Cn0KCnZhciB4MCQyID0gSW5maW5pdHksCiAgICB5MCQyID0geDAkMiwKICAgIHgxID0gLXgwJDIsCiAgICB5MSA9IHgxOwoKdmFyIGJvdW5kc1N0cmVhbSQxID0gewogIHBvaW50OiBib3VuZHNQb2ludCQxLAogIGxpbmVTdGFydDogbm9vcCQyLAogIGxpbmVFbmQ6IG5vb3AkMiwKICBwb2x5Z29uU3RhcnQ6IG5vb3AkMiwKICBwb2x5Z29uRW5kOiBub29wJDIsCiAgcmVzdWx0OiBmdW5jdGlvbigpIHsKICAgIHZhciBib3VuZHMgPSBbW3gwJDIsIHkwJDJdLCBbeDEsIHkxXV07CiAgICB4MSA9IHkxID0gLSh5MCQyID0geDAkMiA9IEluZmluaXR5KTsKICAgIHJldHVybiBib3VuZHM7CiAgfQp9OwoKZnVuY3Rpb24gYm91bmRzUG9pbnQkMSh4LCB5KSB7CiAgaWYgKHggPCB4MCQyKSB4MCQyID0geDsKICBpZiAoeCA+IHgxKSB4MSA9IHg7CiAgaWYgKHkgPCB5MCQyKSB5MCQyID0geTsKICBpZiAoeSA+IHkxKSB5MSA9IHk7Cn0KCi8vIFRPRE8gRW5mb3JjZSBwb3NpdGl2ZSBhcmVhIGZvciBleHRlcmlvciwgbmVnYXRpdmUgYXJlYSBmb3IgaW50ZXJpb3I/Cgp2YXIgWDAkMSA9IDAsCiAgICBZMCQxID0gMCwKICAgIFowJDEgPSAwLAogICAgWDEkMSA9IDAsCiAgICBZMSQxID0gMCwKICAgIFoxJDEgPSAwLAogICAgWDIkMSA9IDAsCiAgICBZMiQxID0gMCwKICAgIFoyJDEgPSAwLAogICAgeDAwJDEsCiAgICB5MDAkMSwKICAgIHgwJDMsCiAgICB5MCQzOwoKdmFyIGNlbnRyb2lkU3RyZWFtJDEgPSB7CiAgcG9pbnQ6IGNlbnRyb2lkUG9pbnQkMSwKICBsaW5lU3RhcnQ6IGNlbnRyb2lkTGluZVN0YXJ0JDEsCiAgbGluZUVuZDogY2VudHJvaWRMaW5lRW5kJDEsCiAgcG9seWdvblN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIGNlbnRyb2lkU3RyZWFtJDEubGluZVN0YXJ0ID0gY2VudHJvaWRSaW5nU3RhcnQkMTsKICAgIGNlbnRyb2lkU3RyZWFtJDEubGluZUVuZCA9IGNlbnRyb2lkUmluZ0VuZCQxOwogIH0sCiAgcG9seWdvbkVuZDogZnVuY3Rpb24oKSB7CiAgICBjZW50cm9pZFN0cmVhbSQxLnBvaW50ID0gY2VudHJvaWRQb2ludCQxOwogICAgY2VudHJvaWRTdHJlYW0kMS5saW5lU3RhcnQgPSBjZW50cm9pZExpbmVTdGFydCQxOwogICAgY2VudHJvaWRTdHJlYW0kMS5saW5lRW5kID0gY2VudHJvaWRMaW5lRW5kJDE7CiAgfSwKICByZXN1bHQ6IGZ1bmN0aW9uKCkgewogICAgdmFyIGNlbnRyb2lkID0gWjIkMSA/IFtYMiQxIC8gWjIkMSwgWTIkMSAvIFoyJDFdCiAgICAgICAgOiBaMSQxID8gW1gxJDEgLyBaMSQxLCBZMSQxIC8gWjEkMV0KICAgICAgICA6IFowJDEgPyBbWDAkMSAvIFowJDEsIFkwJDEgLyBaMCQxXQogICAgICAgIDogW05hTiwgTmFOXTsKICAgIFgwJDEgPSBZMCQxID0gWjAkMSA9CiAgICBYMSQxID0gWTEkMSA9IFoxJDEgPQogICAgWDIkMSA9IFkyJDEgPSBaMiQxID0gMDsKICAgIHJldHVybiBjZW50cm9pZDsKICB9Cn07CgpmdW5jdGlvbiBjZW50cm9pZFBvaW50JDEoeCwgeSkgewogIFgwJDEgKz0geDsKICBZMCQxICs9IHk7CiAgKytaMCQxOwp9CgpmdW5jdGlvbiBjZW50cm9pZExpbmVTdGFydCQxKCkgewogIGNlbnRyb2lkU3RyZWFtJDEucG9pbnQgPSBjZW50cm9pZFBvaW50Rmlyc3RMaW5lOwp9CgpmdW5jdGlvbiBjZW50cm9pZFBvaW50Rmlyc3RMaW5lKHgsIHkpIHsKICBjZW50cm9pZFN0cmVhbSQxLnBvaW50ID0gY2VudHJvaWRQb2ludExpbmU7CiAgY2VudHJvaWRQb2ludCQxKHgwJDMgPSB4LCB5MCQzID0geSk7Cn0KCmZ1bmN0aW9uIGNlbnRyb2lkUG9pbnRMaW5lKHgsIHkpIHsKICB2YXIgZHggPSB4IC0geDAkMywgZHkgPSB5IC0geTAkMywgeiA9IHNxcnQoZHggKiBkeCArIGR5ICogZHkpOwogIFgxJDEgKz0geiAqICh4MCQzICsgeCkgLyAyOwogIFkxJDEgKz0geiAqICh5MCQzICsgeSkgLyAyOwogIFoxJDEgKz0gejsKICBjZW50cm9pZFBvaW50JDEoeDAkMyA9IHgsIHkwJDMgPSB5KTsKfQoKZnVuY3Rpb24gY2VudHJvaWRMaW5lRW5kJDEoKSB7CiAgY2VudHJvaWRTdHJlYW0kMS5wb2ludCA9IGNlbnRyb2lkUG9pbnQkMTsKfQoKZnVuY3Rpb24gY2VudHJvaWRSaW5nU3RhcnQkMSgpIHsKICBjZW50cm9pZFN0cmVhbSQxLnBvaW50ID0gY2VudHJvaWRQb2ludEZpcnN0UmluZzsKfQoKZnVuY3Rpb24gY2VudHJvaWRSaW5nRW5kJDEoKSB7CiAgY2VudHJvaWRQb2ludFJpbmcoeDAwJDEsIHkwMCQxKTsKfQoKZnVuY3Rpb24gY2VudHJvaWRQb2ludEZpcnN0UmluZyh4LCB5KSB7CiAgY2VudHJvaWRTdHJlYW0kMS5wb2ludCA9IGNlbnRyb2lkUG9pbnRSaW5nOwogIGNlbnRyb2lkUG9pbnQkMSh4MDAkMSA9IHgwJDMgPSB4LCB5MDAkMSA9IHkwJDMgPSB5KTsKfQoKZnVuY3Rpb24gY2VudHJvaWRQb2ludFJpbmcoeCwgeSkgewogIHZhciBkeCA9IHggLSB4MCQzLAogICAgICBkeSA9IHkgLSB5MCQzLAogICAgICB6ID0gc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7CgogIFgxJDEgKz0geiAqICh4MCQzICsgeCkgLyAyOwogIFkxJDEgKz0geiAqICh5MCQzICsgeSkgLyAyOwogIFoxJDEgKz0gejsKCiAgeiA9IHkwJDMgKiB4IC0geDAkMyAqIHk7CiAgWDIkMSArPSB6ICogKHgwJDMgKyB4KTsKICBZMiQxICs9IHogKiAoeTAkMyArIHkpOwogIFoyJDEgKz0geiAqIDM7CiAgY2VudHJvaWRQb2ludCQxKHgwJDMgPSB4LCB5MCQzID0geSk7Cn0KCmZ1bmN0aW9uIFBhdGhDb250ZXh0KGNvbnRleHQpIHsKICB0aGlzLl9jb250ZXh0ID0gY29udGV4dDsKfQoKUGF0aENvbnRleHQucHJvdG90eXBlID0gewogIF9yYWRpdXM6IDQuNSwKICBwb2ludFJhZGl1czogZnVuY3Rpb24oXykgewogICAgcmV0dXJuIHRoaXMuX3JhZGl1cyA9IF8sIHRoaXM7CiAgfSwKICBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fbGluZSA9IDA7CiAgfSwKICBwb2x5Z29uRW5kOiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX2xpbmUgPSBOYU47CiAgfSwKICBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fcG9pbnQgPSAwOwogIH0sCiAgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICBpZiAodGhpcy5fbGluZSA9PT0gMCkgdGhpcy5fY29udGV4dC5jbG9zZVBhdGgoKTsKICAgIHRoaXMuX3BvaW50ID0gTmFOOwogIH0sCiAgcG9pbnQ6IGZ1bmN0aW9uKHgsIHkpIHsKICAgIHN3aXRjaCAodGhpcy5fcG9pbnQpIHsKICAgICAgY2FzZSAwOiB7CiAgICAgICAgdGhpcy5fY29udGV4dC5tb3ZlVG8oeCwgeSk7CiAgICAgICAgdGhpcy5fcG9pbnQgPSAxOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNhc2UgMTogewogICAgICAgIHRoaXMuX2NvbnRleHQubGluZVRvKHgsIHkpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGRlZmF1bHQ6IHsKICAgICAgICB0aGlzLl9jb250ZXh0Lm1vdmVUbyh4ICsgdGhpcy5fcmFkaXVzLCB5KTsKICAgICAgICB0aGlzLl9jb250ZXh0LmFyYyh4LCB5LCB0aGlzLl9yYWRpdXMsIDAsIHRhdSQzKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogIH0sCiAgcmVzdWx0OiBub29wJDIKfTsKCnZhciBsZW5ndGhTdW0kMSA9IGFkZGVyKCksCiAgICBsZW5ndGhSaW5nLAogICAgeDAwJDIsCiAgICB5MDAkMiwKICAgIHgwJDQsCiAgICB5MCQ0OwoKdmFyIGxlbmd0aFN0cmVhbSQxID0gewogIHBvaW50OiBub29wJDIsCiAgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIGxlbmd0aFN0cmVhbSQxLnBvaW50ID0gbGVuZ3RoUG9pbnRGaXJzdCQxOwogIH0sCiAgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICBpZiAobGVuZ3RoUmluZykgbGVuZ3RoUG9pbnQkMSh4MDAkMiwgeTAwJDIpOwogICAgbGVuZ3RoU3RyZWFtJDEucG9pbnQgPSBub29wJDI7CiAgfSwKICBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgbGVuZ3RoUmluZyA9IHRydWU7CiAgfSwKICBwb2x5Z29uRW5kOiBmdW5jdGlvbigpIHsKICAgIGxlbmd0aFJpbmcgPSBudWxsOwogIH0sCiAgcmVzdWx0OiBmdW5jdGlvbigpIHsKICAgIHZhciBsZW5ndGggPSArbGVuZ3RoU3VtJDE7CiAgICBsZW5ndGhTdW0kMS5yZXNldCgpOwogICAgcmV0dXJuIGxlbmd0aDsKICB9Cn07CgpmdW5jdGlvbiBsZW5ndGhQb2ludEZpcnN0JDEoeCwgeSkgewogIGxlbmd0aFN0cmVhbSQxLnBvaW50ID0gbGVuZ3RoUG9pbnQkMTsKICB4MDAkMiA9IHgwJDQgPSB4LCB5MDAkMiA9IHkwJDQgPSB5Owp9CgpmdW5jdGlvbiBsZW5ndGhQb2ludCQxKHgsIHkpIHsKICB4MCQ0IC09IHgsIHkwJDQgLT0geTsKICBsZW5ndGhTdW0kMS5hZGQoc3FydCh4MCQ0ICogeDAkNCArIHkwJDQgKiB5MCQ0KSk7CiAgeDAkNCA9IHgsIHkwJDQgPSB5Owp9CgpmdW5jdGlvbiBQYXRoU3RyaW5nKCkgewogIHRoaXMuX3N0cmluZyA9IFtdOwp9CgpQYXRoU3RyaW5nLnByb3RvdHlwZSA9IHsKICBfcmFkaXVzOiA0LjUsCiAgX2NpcmNsZTogY2lyY2xlJDEoNC41KSwKICBwb2ludFJhZGl1czogZnVuY3Rpb24oXykgewogICAgaWYgKChfID0gK18pICE9PSB0aGlzLl9yYWRpdXMpIHRoaXMuX3JhZGl1cyA9IF8sIHRoaXMuX2NpcmNsZSA9IG51bGw7CiAgICByZXR1cm4gdGhpczsKICB9LAogIHBvbHlnb25TdGFydDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9saW5lID0gMDsKICB9LAogIHBvbHlnb25FbmQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fbGluZSA9IE5hTjsKICB9LAogIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9wb2ludCA9IDA7CiAgfSwKICBsaW5lRW5kOiBmdW5jdGlvbigpIHsKICAgIGlmICh0aGlzLl9saW5lID09PSAwKSB0aGlzLl9zdHJpbmcucHVzaCgiWiIpOwogICAgdGhpcy5fcG9pbnQgPSBOYU47CiAgfSwKICBwb2ludDogZnVuY3Rpb24oeCwgeSkgewogICAgc3dpdGNoICh0aGlzLl9wb2ludCkgewogICAgICBjYXNlIDA6IHsKICAgICAgICB0aGlzLl9zdHJpbmcucHVzaCgiTSIsIHgsICIsIiwgeSk7CiAgICAgICAgdGhpcy5fcG9pbnQgPSAxOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNhc2UgMTogewogICAgICAgIHRoaXMuX3N0cmluZy5wdXNoKCJMIiwgeCwgIiwiLCB5KTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBkZWZhdWx0OiB7CiAgICAgICAgaWYgKHRoaXMuX2NpcmNsZSA9PSBudWxsKSB0aGlzLl9jaXJjbGUgPSBjaXJjbGUkMSh0aGlzLl9yYWRpdXMpOwogICAgICAgIHRoaXMuX3N0cmluZy5wdXNoKCJNIiwgeCwgIiwiLCB5LCB0aGlzLl9jaXJjbGUpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfSwKICByZXN1bHQ6IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMuX3N0cmluZy5sZW5ndGgpIHsKICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuX3N0cmluZy5qb2luKCIiKTsKICAgICAgdGhpcy5fc3RyaW5nID0gW107CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9Cn07CgpmdW5jdGlvbiBjaXJjbGUkMShyYWRpdXMpIHsKICByZXR1cm4gIm0wLCIgKyByYWRpdXMKICAgICAgKyAiYSIgKyByYWRpdXMgKyAiLCIgKyByYWRpdXMgKyAiIDAgMSwxIDAsIiArIC0yICogcmFkaXVzCiAgICAgICsgImEiICsgcmFkaXVzICsgIiwiICsgcmFkaXVzICsgIiAwIDEsMSAwLCIgKyAyICogcmFkaXVzCiAgICAgICsgInoiOwp9CgpmdW5jdGlvbiBpbmRleCQxKHByb2plY3Rpb24sIGNvbnRleHQpIHsKICB2YXIgcG9pbnRSYWRpdXMgPSA0LjUsCiAgICAgIHByb2plY3Rpb25TdHJlYW0sCiAgICAgIGNvbnRleHRTdHJlYW07CgogIGZ1bmN0aW9uIHBhdGgob2JqZWN0KSB7CiAgICBpZiAob2JqZWN0KSB7CiAgICAgIGlmICh0eXBlb2YgcG9pbnRSYWRpdXMgPT09ICJmdW5jdGlvbiIpIGNvbnRleHRTdHJlYW0ucG9pbnRSYWRpdXMoK3BvaW50UmFkaXVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgICBnZW9TdHJlYW0ob2JqZWN0LCBwcm9qZWN0aW9uU3RyZWFtKGNvbnRleHRTdHJlYW0pKTsKICAgIH0KICAgIHJldHVybiBjb250ZXh0U3RyZWFtLnJlc3VsdCgpOwogIH0KCiAgcGF0aC5hcmVhID0gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICBnZW9TdHJlYW0ob2JqZWN0LCBwcm9qZWN0aW9uU3RyZWFtKGFyZWFTdHJlYW0kMSkpOwogICAgcmV0dXJuIGFyZWFTdHJlYW0kMS5yZXN1bHQoKTsKICB9OwoKICBwYXRoLm1lYXN1cmUgPSBmdW5jdGlvbihvYmplY3QpIHsKICAgIGdlb1N0cmVhbShvYmplY3QsIHByb2plY3Rpb25TdHJlYW0obGVuZ3RoU3RyZWFtJDEpKTsKICAgIHJldHVybiBsZW5ndGhTdHJlYW0kMS5yZXN1bHQoKTsKICB9OwoKICBwYXRoLmJvdW5kcyA9IGZ1bmN0aW9uKG9iamVjdCkgewogICAgZ2VvU3RyZWFtKG9iamVjdCwgcHJvamVjdGlvblN0cmVhbShib3VuZHNTdHJlYW0kMSkpOwogICAgcmV0dXJuIGJvdW5kc1N0cmVhbSQxLnJlc3VsdCgpOwogIH07CgogIHBhdGguY2VudHJvaWQgPSBmdW5jdGlvbihvYmplY3QpIHsKICAgIGdlb1N0cmVhbShvYmplY3QsIHByb2plY3Rpb25TdHJlYW0oY2VudHJvaWRTdHJlYW0kMSkpOwogICAgcmV0dXJuIGNlbnRyb2lkU3RyZWFtJDEucmVzdWx0KCk7CiAgfTsKCiAgcGF0aC5wcm9qZWN0aW9uID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocHJvamVjdGlvblN0cmVhbSA9IF8gPT0gbnVsbCA/IChwcm9qZWN0aW9uID0gbnVsbCwgaWRlbnRpdHkkNCkgOiAocHJvamVjdGlvbiA9IF8pLnN0cmVhbSwgcGF0aCkgOiBwcm9qZWN0aW9uOwogIH07CgogIHBhdGguY29udGV4dCA9IGZ1bmN0aW9uKF8pIHsKICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGNvbnRleHQ7CiAgICBjb250ZXh0U3RyZWFtID0gXyA9PSBudWxsID8gKGNvbnRleHQgPSBudWxsLCBuZXcgUGF0aFN0cmluZykgOiBuZXcgUGF0aENvbnRleHQoY29udGV4dCA9IF8pOwogICAgaWYgKHR5cGVvZiBwb2ludFJhZGl1cyAhPT0gImZ1bmN0aW9uIikgY29udGV4dFN0cmVhbS5wb2ludFJhZGl1cyhwb2ludFJhZGl1cyk7CiAgICByZXR1cm4gcGF0aDsKICB9OwoKICBwYXRoLnBvaW50UmFkaXVzID0gZnVuY3Rpb24oXykgewogICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gcG9pbnRSYWRpdXM7CiAgICBwb2ludFJhZGl1cyA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IChjb250ZXh0U3RyZWFtLnBvaW50UmFkaXVzKCtfKSwgK18pOwogICAgcmV0dXJuIHBhdGg7CiAgfTsKCiAgcmV0dXJuIHBhdGgucHJvamVjdGlvbihwcm9qZWN0aW9uKS5jb250ZXh0KGNvbnRleHQpOwp9CgpmdW5jdGlvbiB0cmFuc2Zvcm0obWV0aG9kcykgewogIHJldHVybiB7CiAgICBzdHJlYW06IHRyYW5zZm9ybWVyKG1ldGhvZHMpCiAgfTsKfQoKZnVuY3Rpb24gdHJhbnNmb3JtZXIobWV0aG9kcykgewogIHJldHVybiBmdW5jdGlvbihzdHJlYW0pIHsKICAgIHZhciBzID0gbmV3IFRyYW5zZm9ybVN0cmVhbTsKICAgIGZvciAodmFyIGtleSBpbiBtZXRob2RzKSBzW2tleV0gPSBtZXRob2RzW2tleV07CiAgICBzLnN0cmVhbSA9IHN0cmVhbTsKICAgIHJldHVybiBzOwogIH07Cn0KCmZ1bmN0aW9uIFRyYW5zZm9ybVN0cmVhbSgpIHt9CgpUcmFuc2Zvcm1TdHJlYW0ucHJvdG90eXBlID0gewogIGNvbnN0cnVjdG9yOiBUcmFuc2Zvcm1TdHJlYW0sCiAgcG9pbnQ6IGZ1bmN0aW9uKHgsIHkpIHsgdGhpcy5zdHJlYW0ucG9pbnQoeCwgeSk7IH0sCiAgc3BoZXJlOiBmdW5jdGlvbigpIHsgdGhpcy5zdHJlYW0uc3BoZXJlKCk7IH0sCiAgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsgdGhpcy5zdHJlYW0ubGluZVN0YXJ0KCk7IH0sCiAgbGluZUVuZDogZnVuY3Rpb24oKSB7IHRoaXMuc3RyZWFtLmxpbmVFbmQoKTsgfSwKICBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgeyB0aGlzLnN0cmVhbS5wb2x5Z29uU3RhcnQoKTsgfSwKICBwb2x5Z29uRW5kOiBmdW5jdGlvbigpIHsgdGhpcy5zdHJlYW0ucG9seWdvbkVuZCgpOyB9Cn07CgpmdW5jdGlvbiBmaXQocHJvamVjdGlvbiwgZml0Qm91bmRzLCBvYmplY3QpIHsKICB2YXIgY2xpcCA9IHByb2plY3Rpb24uY2xpcEV4dGVudCAmJiBwcm9qZWN0aW9uLmNsaXBFeHRlbnQoKTsKICBwcm9qZWN0aW9uLnNjYWxlKDE1MCkudHJhbnNsYXRlKFswLCAwXSk7CiAgaWYgKGNsaXAgIT0gbnVsbCkgcHJvamVjdGlvbi5jbGlwRXh0ZW50KG51bGwpOwogIGdlb1N0cmVhbShvYmplY3QsIHByb2plY3Rpb24uc3RyZWFtKGJvdW5kc1N0cmVhbSQxKSk7CiAgZml0Qm91bmRzKGJvdW5kc1N0cmVhbSQxLnJlc3VsdCgpKTsKICBpZiAoY2xpcCAhPSBudWxsKSBwcm9qZWN0aW9uLmNsaXBFeHRlbnQoY2xpcCk7CiAgcmV0dXJuIHByb2plY3Rpb247Cn0KCmZ1bmN0aW9uIGZpdEV4dGVudChwcm9qZWN0aW9uLCBleHRlbnQsIG9iamVjdCkgewogIHJldHVybiBmaXQocHJvamVjdGlvbiwgZnVuY3Rpb24oYikgewogICAgdmFyIHcgPSBleHRlbnRbMV1bMF0gLSBleHRlbnRbMF1bMF0sCiAgICAgICAgaCA9IGV4dGVudFsxXVsxXSAtIGV4dGVudFswXVsxXSwKICAgICAgICBrID0gTWF0aC5taW4odyAvIChiWzFdWzBdIC0gYlswXVswXSksIGggLyAoYlsxXVsxXSAtIGJbMF1bMV0pKSwKICAgICAgICB4ID0gK2V4dGVudFswXVswXSArICh3IC0gayAqIChiWzFdWzBdICsgYlswXVswXSkpIC8gMiwKICAgICAgICB5ID0gK2V4dGVudFswXVsxXSArIChoIC0gayAqIChiWzFdWzFdICsgYlswXVsxXSkpIC8gMjsKICAgIHByb2plY3Rpb24uc2NhbGUoMTUwICogaykudHJhbnNsYXRlKFt4LCB5XSk7CiAgfSwgb2JqZWN0KTsKfQoKZnVuY3Rpb24gZml0U2l6ZShwcm9qZWN0aW9uLCBzaXplLCBvYmplY3QpIHsKICByZXR1cm4gZml0RXh0ZW50KHByb2plY3Rpb24sIFtbMCwgMF0sIHNpemVdLCBvYmplY3QpOwp9CgpmdW5jdGlvbiBmaXRXaWR0aChwcm9qZWN0aW9uLCB3aWR0aCwgb2JqZWN0KSB7CiAgcmV0dXJuIGZpdChwcm9qZWN0aW9uLCBmdW5jdGlvbihiKSB7CiAgICB2YXIgdyA9ICt3aWR0aCwKICAgICAgICBrID0gdyAvIChiWzFdWzBdIC0gYlswXVswXSksCiAgICAgICAgeCA9ICh3IC0gayAqIChiWzFdWzBdICsgYlswXVswXSkpIC8gMiwKICAgICAgICB5ID0gLWsgKiBiWzBdWzFdOwogICAgcHJvamVjdGlvbi5zY2FsZSgxNTAgKiBrKS50cmFuc2xhdGUoW3gsIHldKTsKICB9LCBvYmplY3QpOwp9CgpmdW5jdGlvbiBmaXRIZWlnaHQocHJvamVjdGlvbiwgaGVpZ2h0LCBvYmplY3QpIHsKICByZXR1cm4gZml0KHByb2plY3Rpb24sIGZ1bmN0aW9uKGIpIHsKICAgIHZhciBoID0gK2hlaWdodCwKICAgICAgICBrID0gaCAvIChiWzFdWzFdIC0gYlswXVsxXSksCiAgICAgICAgeCA9IC1rICogYlswXVswXSwKICAgICAgICB5ID0gKGggLSBrICogKGJbMV1bMV0gKyBiWzBdWzFdKSkgLyAyOwogICAgcHJvamVjdGlvbi5zY2FsZSgxNTAgKiBrKS50cmFuc2xhdGUoW3gsIHldKTsKICB9LCBvYmplY3QpOwp9Cgp2YXIgbWF4RGVwdGggPSAxNiwgLy8gbWF4aW11bSBkZXB0aCBvZiBzdWJkaXZpc2lvbgogICAgY29zTWluRGlzdGFuY2UgPSBjb3MkMSgzMCAqIHJhZGlhbnMpOyAvLyBjb3MobWluaW11bSBhbmd1bGFyIGRpc3RhbmNlKQoKZnVuY3Rpb24gcmVzYW1wbGUocHJvamVjdCwgZGVsdGEyKSB7CiAgcmV0dXJuICtkZWx0YTIgPyByZXNhbXBsZSQxKHByb2plY3QsIGRlbHRhMikgOiByZXNhbXBsZU5vbmUocHJvamVjdCk7Cn0KCmZ1bmN0aW9uIHJlc2FtcGxlTm9uZShwcm9qZWN0KSB7CiAgcmV0dXJuIHRyYW5zZm9ybWVyKHsKICAgIHBvaW50OiBmdW5jdGlvbih4LCB5KSB7CiAgICAgIHggPSBwcm9qZWN0KHgsIHkpOwogICAgICB0aGlzLnN0cmVhbS5wb2ludCh4WzBdLCB4WzFdKTsKICAgIH0KICB9KTsKfQoKZnVuY3Rpb24gcmVzYW1wbGUkMShwcm9qZWN0LCBkZWx0YTIpIHsKCiAgZnVuY3Rpb24gcmVzYW1wbGVMaW5lVG8oeDAsIHkwLCBsYW1iZGEwLCBhMCwgYjAsIGMwLCB4MSwgeTEsIGxhbWJkYTEsIGExLCBiMSwgYzEsIGRlcHRoLCBzdHJlYW0pIHsKICAgIHZhciBkeCA9IHgxIC0geDAsCiAgICAgICAgZHkgPSB5MSAtIHkwLAogICAgICAgIGQyID0gZHggKiBkeCArIGR5ICogZHk7CiAgICBpZiAoZDIgPiA0ICogZGVsdGEyICYmIGRlcHRoLS0pIHsKICAgICAgdmFyIGEgPSBhMCArIGExLAogICAgICAgICAgYiA9IGIwICsgYjEsCiAgICAgICAgICBjID0gYzAgKyBjMSwKICAgICAgICAgIG0gPSBzcXJ0KGEgKiBhICsgYiAqIGIgKyBjICogYyksCiAgICAgICAgICBwaGkyID0gYXNpbihjIC89IG0pLAogICAgICAgICAgbGFtYmRhMiA9IGFicyhhYnMoYykgLSAxKSA8IGVwc2lsb24kMiB8fCBhYnMobGFtYmRhMCAtIGxhbWJkYTEpIDwgZXBzaWxvbiQyID8gKGxhbWJkYTAgKyBsYW1iZGExKSAvIDIgOiBhdGFuMihiLCBhKSwKICAgICAgICAgIHAgPSBwcm9qZWN0KGxhbWJkYTIsIHBoaTIpLAogICAgICAgICAgeDIgPSBwWzBdLAogICAgICAgICAgeTIgPSBwWzFdLAogICAgICAgICAgZHgyID0geDIgLSB4MCwKICAgICAgICAgIGR5MiA9IHkyIC0geTAsCiAgICAgICAgICBkeiA9IGR5ICogZHgyIC0gZHggKiBkeTI7CiAgICAgIGlmIChkeiAqIGR6IC8gZDIgPiBkZWx0YTIgLy8gcGVycGVuZGljdWxhciBwcm9qZWN0ZWQgZGlzdGFuY2UKICAgICAgICAgIHx8IGFicygoZHggKiBkeDIgKyBkeSAqIGR5MikgLyBkMiAtIDAuNSkgPiAwLjMgLy8gbWlkcG9pbnQgY2xvc2UgdG8gYW4gZW5kCiAgICAgICAgICB8fCBhMCAqIGExICsgYjAgKiBiMSArIGMwICogYzEgPCBjb3NNaW5EaXN0YW5jZSkgeyAvLyBhbmd1bGFyIGRpc3RhbmNlCiAgICAgICAgcmVzYW1wbGVMaW5lVG8oeDAsIHkwLCBsYW1iZGEwLCBhMCwgYjAsIGMwLCB4MiwgeTIsIGxhbWJkYTIsIGEgLz0gbSwgYiAvPSBtLCBjLCBkZXB0aCwgc3RyZWFtKTsKICAgICAgICBzdHJlYW0ucG9pbnQoeDIsIHkyKTsKICAgICAgICByZXNhbXBsZUxpbmVUbyh4MiwgeTIsIGxhbWJkYTIsIGEsIGIsIGMsIHgxLCB5MSwgbGFtYmRhMSwgYTEsIGIxLCBjMSwgZGVwdGgsIHN0cmVhbSk7CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJuIGZ1bmN0aW9uKHN0cmVhbSkgewogICAgdmFyIGxhbWJkYTAwLCB4MDAsIHkwMCwgYTAwLCBiMDAsIGMwMCwgLy8gZmlyc3QgcG9pbnQKICAgICAgICBsYW1iZGEwLCB4MCwgeTAsIGEwLCBiMCwgYzA7IC8vIHByZXZpb3VzIHBvaW50CgogICAgdmFyIHJlc2FtcGxlU3RyZWFtID0gewogICAgICBwb2ludDogcG9pbnQsCiAgICAgIGxpbmVTdGFydDogbGluZVN0YXJ0LAogICAgICBsaW5lRW5kOiBsaW5lRW5kLAogICAgICBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgeyBzdHJlYW0ucG9seWdvblN0YXJ0KCk7IHJlc2FtcGxlU3RyZWFtLmxpbmVTdGFydCA9IHJpbmdTdGFydDsgfSwKICAgICAgcG9seWdvbkVuZDogZnVuY3Rpb24oKSB7IHN0cmVhbS5wb2x5Z29uRW5kKCk7IHJlc2FtcGxlU3RyZWFtLmxpbmVTdGFydCA9IGxpbmVTdGFydDsgfQogICAgfTsKCiAgICBmdW5jdGlvbiBwb2ludCh4LCB5KSB7CiAgICAgIHggPSBwcm9qZWN0KHgsIHkpOwogICAgICBzdHJlYW0ucG9pbnQoeFswXSwgeFsxXSk7CiAgICB9CgogICAgZnVuY3Rpb24gbGluZVN0YXJ0KCkgewogICAgICB4MCA9IE5hTjsKICAgICAgcmVzYW1wbGVTdHJlYW0ucG9pbnQgPSBsaW5lUG9pbnQ7CiAgICAgIHN0cmVhbS5saW5lU3RhcnQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBsaW5lUG9pbnQobGFtYmRhLCBwaGkpIHsKICAgICAgdmFyIGMgPSBjYXJ0ZXNpYW4oW2xhbWJkYSwgcGhpXSksIHAgPSBwcm9qZWN0KGxhbWJkYSwgcGhpKTsKICAgICAgcmVzYW1wbGVMaW5lVG8oeDAsIHkwLCBsYW1iZGEwLCBhMCwgYjAsIGMwLCB4MCA9IHBbMF0sIHkwID0gcFsxXSwgbGFtYmRhMCA9IGxhbWJkYSwgYTAgPSBjWzBdLCBiMCA9IGNbMV0sIGMwID0gY1syXSwgbWF4RGVwdGgsIHN0cmVhbSk7CiAgICAgIHN0cmVhbS5wb2ludCh4MCwgeTApOwogICAgfQoKICAgIGZ1bmN0aW9uIGxpbmVFbmQoKSB7CiAgICAgIHJlc2FtcGxlU3RyZWFtLnBvaW50ID0gcG9pbnQ7CiAgICAgIHN0cmVhbS5saW5lRW5kKCk7CiAgICB9CgogICAgZnVuY3Rpb24gcmluZ1N0YXJ0KCkgewogICAgICBsaW5lU3RhcnQoKTsKICAgICAgcmVzYW1wbGVTdHJlYW0ucG9pbnQgPSByaW5nUG9pbnQ7CiAgICAgIHJlc2FtcGxlU3RyZWFtLmxpbmVFbmQgPSByaW5nRW5kOwogICAgfQoKICAgIGZ1bmN0aW9uIHJpbmdQb2ludChsYW1iZGEsIHBoaSkgewogICAgICBsaW5lUG9pbnQobGFtYmRhMDAgPSBsYW1iZGEsIHBoaSksIHgwMCA9IHgwLCB5MDAgPSB5MCwgYTAwID0gYTAsIGIwMCA9IGIwLCBjMDAgPSBjMDsKICAgICAgcmVzYW1wbGVTdHJlYW0ucG9pbnQgPSBsaW5lUG9pbnQ7CiAgICB9CgogICAgZnVuY3Rpb24gcmluZ0VuZCgpIHsKICAgICAgcmVzYW1wbGVMaW5lVG8oeDAsIHkwLCBsYW1iZGEwLCBhMCwgYjAsIGMwLCB4MDAsIHkwMCwgbGFtYmRhMDAsIGEwMCwgYjAwLCBjMDAsIG1heERlcHRoLCBzdHJlYW0pOwogICAgICByZXNhbXBsZVN0cmVhbS5saW5lRW5kID0gbGluZUVuZDsKICAgICAgbGluZUVuZCgpOwogICAgfQoKICAgIHJldHVybiByZXNhbXBsZVN0cmVhbTsKICB9Owp9Cgp2YXIgdHJhbnNmb3JtUmFkaWFucyA9IHRyYW5zZm9ybWVyKHsKICBwb2ludDogZnVuY3Rpb24oeCwgeSkgewogICAgdGhpcy5zdHJlYW0ucG9pbnQoeCAqIHJhZGlhbnMsIHkgKiByYWRpYW5zKTsKICB9Cn0pOwoKZnVuY3Rpb24gdHJhbnNmb3JtUm90YXRlKHJvdGF0ZSkgewogIHJldHVybiB0cmFuc2Zvcm1lcih7CiAgICBwb2ludDogZnVuY3Rpb24oeCwgeSkgewogICAgICB2YXIgciA9IHJvdGF0ZSh4LCB5KTsKICAgICAgcmV0dXJuIHRoaXMuc3RyZWFtLnBvaW50KHJbMF0sIHJbMV0pOwogICAgfQogIH0pOwp9CgpmdW5jdGlvbiBzY2FsZVRyYW5zbGF0ZShrLCBkeCwgZHkpIHsKICBmdW5jdGlvbiB0cmFuc2Zvcm0kJDEoeCwgeSkgewogICAgcmV0dXJuIFtkeCArIGsgKiB4LCBkeSAtIGsgKiB5XTsKICB9CiAgdHJhbnNmb3JtJCQxLmludmVydCA9IGZ1bmN0aW9uKHgsIHkpIHsKICAgIHJldHVybiBbKHggLSBkeCkgLyBrLCAoZHkgLSB5KSAvIGtdOwogIH07CiAgcmV0dXJuIHRyYW5zZm9ybSQkMTsKfQoKZnVuY3Rpb24gc2NhbGVUcmFuc2xhdGVSb3RhdGUoaywgZHgsIGR5LCBhbHBoYSkgewogIHZhciBjb3NBbHBoYSA9IGNvcyQxKGFscGhhKSwKICAgICAgc2luQWxwaGEgPSBzaW4kMShhbHBoYSksCiAgICAgIGEgPSBjb3NBbHBoYSAqIGssCiAgICAgIGIgPSBzaW5BbHBoYSAqIGssCiAgICAgIGFpID0gY29zQWxwaGEgLyBrLAogICAgICBiaSA9IHNpbkFscGhhIC8gaywKICAgICAgY2kgPSAoc2luQWxwaGEgKiBkeSAtIGNvc0FscGhhICogZHgpIC8gaywKICAgICAgZmkgPSAoc2luQWxwaGEgKiBkeCArIGNvc0FscGhhICogZHkpIC8gazsKICBmdW5jdGlvbiB0cmFuc2Zvcm0kJDEoeCwgeSkgewogICAgcmV0dXJuIFthICogeCAtIGIgKiB5ICsgZHgsIGR5IC0gYiAqIHggLSBhICogeV07CiAgfQogIHRyYW5zZm9ybSQkMS5pbnZlcnQgPSBmdW5jdGlvbih4LCB5KSB7CiAgICByZXR1cm4gW2FpICogeCAtIGJpICogeSArIGNpLCBmaSAtIGJpICogeCAtIGFpICogeV07CiAgfTsKICByZXR1cm4gdHJhbnNmb3JtJCQxOwp9CgpmdW5jdGlvbiBwcm9qZWN0aW9uKHByb2plY3QpIHsKICByZXR1cm4gcHJvamVjdGlvbk11dGF0b3IoZnVuY3Rpb24oKSB7IHJldHVybiBwcm9qZWN0OyB9KSgpOwp9CgpmdW5jdGlvbiBwcm9qZWN0aW9uTXV0YXRvcihwcm9qZWN0QXQpIHsKICB2YXIgcHJvamVjdCwKICAgICAgayA9IDE1MCwgLy8gc2NhbGUKICAgICAgeCA9IDQ4MCwgeSA9IDI1MCwgLy8gdHJhbnNsYXRlCiAgICAgIGxhbWJkYSA9IDAsIHBoaSA9IDAsIC8vIGNlbnRlcgogICAgICBkZWx0YUxhbWJkYSA9IDAsIGRlbHRhUGhpID0gMCwgZGVsdGFHYW1tYSA9IDAsIHJvdGF0ZSwgLy8gcHJlLXJvdGF0ZQogICAgICBhbHBoYSA9IDAsIC8vIHBvc3Qtcm90YXRlCiAgICAgIHRoZXRhID0gbnVsbCwgcHJlY2xpcCA9IGNsaXBBbnRpbWVyaWRpYW4sIC8vIHByZS1jbGlwIGFuZ2xlCiAgICAgIHgwID0gbnVsbCwgeTAsIHgxLCB5MSwgcG9zdGNsaXAgPSBpZGVudGl0eSQ0LCAvLyBwb3N0LWNsaXAgZXh0ZW50CiAgICAgIGRlbHRhMiA9IDAuNSwgLy8gcHJlY2lzaW9uCiAgICAgIHByb2plY3RSZXNhbXBsZSwKICAgICAgcHJvamVjdFRyYW5zZm9ybSwKICAgICAgcHJvamVjdFJvdGF0ZVRyYW5zZm9ybSwKICAgICAgY2FjaGUsCiAgICAgIGNhY2hlU3RyZWFtOwoKICBmdW5jdGlvbiBwcm9qZWN0aW9uKHBvaW50KSB7CiAgICByZXR1cm4gcHJvamVjdFJvdGF0ZVRyYW5zZm9ybShwb2ludFswXSAqIHJhZGlhbnMsIHBvaW50WzFdICogcmFkaWFucyk7CiAgfQoKICBmdW5jdGlvbiBpbnZlcnQocG9pbnQpIHsKICAgIHBvaW50ID0gcHJvamVjdFJvdGF0ZVRyYW5zZm9ybS5pbnZlcnQocG9pbnRbMF0sIHBvaW50WzFdKTsKICAgIHJldHVybiBwb2ludCAmJiBbcG9pbnRbMF0gKiBkZWdyZWVzJDEsIHBvaW50WzFdICogZGVncmVlcyQxXTsKICB9CgogIHByb2plY3Rpb24uc3RyZWFtID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICByZXR1cm4gY2FjaGUgJiYgY2FjaGVTdHJlYW0gPT09IHN0cmVhbSA/IGNhY2hlIDogY2FjaGUgPSB0cmFuc2Zvcm1SYWRpYW5zKHRyYW5zZm9ybVJvdGF0ZShyb3RhdGUpKHByZWNsaXAocHJvamVjdFJlc2FtcGxlKHBvc3RjbGlwKGNhY2hlU3RyZWFtID0gc3RyZWFtKSkpKSk7CiAgfTsKCiAgcHJvamVjdGlvbi5wcmVjbGlwID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocHJlY2xpcCA9IF8sIHRoZXRhID0gdW5kZWZpbmVkLCByZXNldCgpKSA6IHByZWNsaXA7CiAgfTsKCiAgcHJvamVjdGlvbi5wb3N0Y2xpcCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHBvc3RjbGlwID0gXywgeDAgPSB5MCA9IHgxID0geTEgPSBudWxsLCByZXNldCgpKSA6IHBvc3RjbGlwOwogIH07CgogIHByb2plY3Rpb24uY2xpcEFuZ2xlID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocHJlY2xpcCA9ICtfID8gY2xpcENpcmNsZSh0aGV0YSA9IF8gKiByYWRpYW5zKSA6ICh0aGV0YSA9IG51bGwsIGNsaXBBbnRpbWVyaWRpYW4pLCByZXNldCgpKSA6IHRoZXRhICogZGVncmVlcyQxOwogIH07CgogIHByb2plY3Rpb24uY2xpcEV4dGVudCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHBvc3RjbGlwID0gXyA9PSBudWxsID8gKHgwID0geTAgPSB4MSA9IHkxID0gbnVsbCwgaWRlbnRpdHkkNCkgOiBjbGlwUmVjdGFuZ2xlKHgwID0gK19bMF1bMF0sIHkwID0gK19bMF1bMV0sIHgxID0gK19bMV1bMF0sIHkxID0gK19bMV1bMV0pLCByZXNldCgpKSA6IHgwID09IG51bGwgPyBudWxsIDogW1t4MCwgeTBdLCBbeDEsIHkxXV07CiAgfTsKCiAgcHJvamVjdGlvbi5zY2FsZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGsgPSArXywgcmVjZW50ZXIoKSkgOiBrOwogIH07CgogIHByb2plY3Rpb24udHJhbnNsYXRlID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoeCA9ICtfWzBdLCB5ID0gK19bMV0sIHJlY2VudGVyKCkpIDogW3gsIHldOwogIH07CgogIHByb2plY3Rpb24uY2VudGVyID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobGFtYmRhID0gX1swXSAlIDM2MCAqIHJhZGlhbnMsIHBoaSA9IF9bMV0gJSAzNjAgKiByYWRpYW5zLCByZWNlbnRlcigpKSA6IFtsYW1iZGEgKiBkZWdyZWVzJDEsIHBoaSAqIGRlZ3JlZXMkMV07CiAgfTsKCiAgcHJvamVjdGlvbi5yb3RhdGUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChkZWx0YUxhbWJkYSA9IF9bMF0gJSAzNjAgKiByYWRpYW5zLCBkZWx0YVBoaSA9IF9bMV0gJSAzNjAgKiByYWRpYW5zLCBkZWx0YUdhbW1hID0gXy5sZW5ndGggPiAyID8gX1syXSAlIDM2MCAqIHJhZGlhbnMgOiAwLCByZWNlbnRlcigpKSA6IFtkZWx0YUxhbWJkYSAqIGRlZ3JlZXMkMSwgZGVsdGFQaGkgKiBkZWdyZWVzJDEsIGRlbHRhR2FtbWEgKiBkZWdyZWVzJDFdOwogIH07CgogIHByb2plY3Rpb24uYW5nbGUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChhbHBoYSA9IF8gJSAzNjAgKiByYWRpYW5zLCByZWNlbnRlcigpKSA6IGFscGhhICogZGVncmVlcyQxOwogIH07CgogIHByb2plY3Rpb24ucHJlY2lzaW9uID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocHJvamVjdFJlc2FtcGxlID0gcmVzYW1wbGUocHJvamVjdFRyYW5zZm9ybSwgZGVsdGEyID0gXyAqIF8pLCByZXNldCgpKSA6IHNxcnQoZGVsdGEyKTsKICB9OwoKICBwcm9qZWN0aW9uLmZpdEV4dGVudCA9IGZ1bmN0aW9uKGV4dGVudCwgb2JqZWN0KSB7CiAgICByZXR1cm4gZml0RXh0ZW50KHByb2plY3Rpb24sIGV4dGVudCwgb2JqZWN0KTsKICB9OwoKICBwcm9qZWN0aW9uLmZpdFNpemUgPSBmdW5jdGlvbihzaXplLCBvYmplY3QpIHsKICAgIHJldHVybiBmaXRTaXplKHByb2plY3Rpb24sIHNpemUsIG9iamVjdCk7CiAgfTsKCiAgcHJvamVjdGlvbi5maXRXaWR0aCA9IGZ1bmN0aW9uKHdpZHRoLCBvYmplY3QpIHsKICAgIHJldHVybiBmaXRXaWR0aChwcm9qZWN0aW9uLCB3aWR0aCwgb2JqZWN0KTsKICB9OwoKICBwcm9qZWN0aW9uLmZpdEhlaWdodCA9IGZ1bmN0aW9uKGhlaWdodCwgb2JqZWN0KSB7CiAgICByZXR1cm4gZml0SGVpZ2h0KHByb2plY3Rpb24sIGhlaWdodCwgb2JqZWN0KTsKICB9OwoKICBmdW5jdGlvbiByZWNlbnRlcigpIHsKICAgIHZhciBjZW50ZXIgPSBzY2FsZVRyYW5zbGF0ZVJvdGF0ZShrLCAwLCAwLCBhbHBoYSkuYXBwbHkobnVsbCwgcHJvamVjdChsYW1iZGEsIHBoaSkpLAogICAgICAgIHRyYW5zZm9ybSQkMSA9IChhbHBoYSA/IHNjYWxlVHJhbnNsYXRlUm90YXRlIDogc2NhbGVUcmFuc2xhdGUpKGssIHggLSBjZW50ZXJbMF0sIHkgLSBjZW50ZXJbMV0sIGFscGhhKTsKICAgIHJvdGF0ZSA9IHJvdGF0ZVJhZGlhbnMoZGVsdGFMYW1iZGEsIGRlbHRhUGhpLCBkZWx0YUdhbW1hKTsKICAgIHByb2plY3RUcmFuc2Zvcm0gPSBjb21wb3NlKHByb2plY3QsIHRyYW5zZm9ybSQkMSk7CiAgICBwcm9qZWN0Um90YXRlVHJhbnNmb3JtID0gY29tcG9zZShyb3RhdGUsIHByb2plY3RUcmFuc2Zvcm0pOwogICAgcHJvamVjdFJlc2FtcGxlID0gcmVzYW1wbGUocHJvamVjdFRyYW5zZm9ybSwgZGVsdGEyKTsKICAgIHJldHVybiByZXNldCgpOwogIH0KCiAgZnVuY3Rpb24gcmVzZXQoKSB7CiAgICBjYWNoZSA9IGNhY2hlU3RyZWFtID0gbnVsbDsKICAgIHJldHVybiBwcm9qZWN0aW9uOwogIH0KCiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgcHJvamVjdCA9IHByb2plY3RBdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgcHJvamVjdGlvbi5pbnZlcnQgPSBwcm9qZWN0LmludmVydCAmJiBpbnZlcnQ7CiAgICByZXR1cm4gcmVjZW50ZXIoKTsKICB9Owp9CgpmdW5jdGlvbiBjb25pY1Byb2plY3Rpb24ocHJvamVjdEF0KSB7CiAgdmFyIHBoaTAgPSAwLAogICAgICBwaGkxID0gcGkkMyAvIDMsCiAgICAgIG0gPSBwcm9qZWN0aW9uTXV0YXRvcihwcm9qZWN0QXQpLAogICAgICBwID0gbShwaGkwLCBwaGkxKTsKCiAgcC5wYXJhbGxlbHMgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IG0ocGhpMCA9IF9bMF0gKiByYWRpYW5zLCBwaGkxID0gX1sxXSAqIHJhZGlhbnMpIDogW3BoaTAgKiBkZWdyZWVzJDEsIHBoaTEgKiBkZWdyZWVzJDFdOwogIH07CgogIHJldHVybiBwOwp9CgpmdW5jdGlvbiBjeWxpbmRyaWNhbEVxdWFsQXJlYVJhdyhwaGkwKSB7CiAgdmFyIGNvc1BoaTAgPSBjb3MkMShwaGkwKTsKCiAgZnVuY3Rpb24gZm9yd2FyZChsYW1iZGEsIHBoaSkgewogICAgcmV0dXJuIFtsYW1iZGEgKiBjb3NQaGkwLCBzaW4kMShwaGkpIC8gY29zUGhpMF07CiAgfQoKICBmb3J3YXJkLmludmVydCA9IGZ1bmN0aW9uKHgsIHkpIHsKICAgIHJldHVybiBbeCAvIGNvc1BoaTAsIGFzaW4oeSAqIGNvc1BoaTApXTsKICB9OwoKICByZXR1cm4gZm9yd2FyZDsKfQoKZnVuY3Rpb24gY29uaWNFcXVhbEFyZWFSYXcoeTAsIHkxKSB7CiAgdmFyIHN5MCA9IHNpbiQxKHkwKSwgbiA9IChzeTAgKyBzaW4kMSh5MSkpIC8gMjsKCiAgLy8gQXJlIHRoZSBwYXJhbGxlbHMgc3ltbWV0cmljYWwgYXJvdW5kIHRoZSBFcXVhdG9yPwogIGlmIChhYnMobikgPCBlcHNpbG9uJDIpIHJldHVybiBjeWxpbmRyaWNhbEVxdWFsQXJlYVJhdyh5MCk7CgogIHZhciBjID0gMSArIHN5MCAqICgyICogbiAtIHN5MCksIHIwID0gc3FydChjKSAvIG47CgogIGZ1bmN0aW9uIHByb2plY3QoeCwgeSkgewogICAgdmFyIHIgPSBzcXJ0KGMgLSAyICogbiAqIHNpbiQxKHkpKSAvIG47CiAgICByZXR1cm4gW3IgKiBzaW4kMSh4ICo9IG4pLCByMCAtIHIgKiBjb3MkMSh4KV07CiAgfQoKICBwcm9qZWN0LmludmVydCA9IGZ1bmN0aW9uKHgsIHkpIHsKICAgIHZhciByMHkgPSByMCAtIHk7CiAgICByZXR1cm4gW2F0YW4yKHgsIGFicyhyMHkpKSAvIG4gKiBzaWduKHIweSksIGFzaW4oKGMgLSAoeCAqIHggKyByMHkgKiByMHkpICogbiAqIG4pIC8gKDIgKiBuKSldOwogIH07CgogIHJldHVybiBwcm9qZWN0Owp9CgpmdW5jdGlvbiBjb25pY0VxdWFsQXJlYSgpIHsKICByZXR1cm4gY29uaWNQcm9qZWN0aW9uKGNvbmljRXF1YWxBcmVhUmF3KQogICAgICAuc2NhbGUoMTU1LjQyNCkKICAgICAgLmNlbnRlcihbMCwgMzMuNjQ0Ml0pOwp9CgpmdW5jdGlvbiBhbGJlcnMoKSB7CiAgcmV0dXJuIGNvbmljRXF1YWxBcmVhKCkKICAgICAgLnBhcmFsbGVscyhbMjkuNSwgNDUuNV0pCiAgICAgIC5zY2FsZSgxMDcwKQogICAgICAudHJhbnNsYXRlKFs0ODAsIDI1MF0pCiAgICAgIC5yb3RhdGUoWzk2LCAwXSkKICAgICAgLmNlbnRlcihbLTAuNiwgMzguN10pOwp9CgovLyBUaGUgcHJvamVjdGlvbnMgbXVzdCBoYXZlIG11dHVhbGx5IGV4Y2x1c2l2ZSBjbGlwIHJlZ2lvbnMgb24gdGhlIHNwaGVyZSwKLy8gYXMgdGhpcyB3aWxsIGF2b2lkIGVtaXR0aW5nIGludGVybGVhdmluZyBsaW5lcyBhbmQgcG9seWdvbnMuCmZ1bmN0aW9uIG11bHRpcGxleChzdHJlYW1zKSB7CiAgdmFyIG4gPSBzdHJlYW1zLmxlbmd0aDsKICByZXR1cm4gewogICAgcG9pbnQ6IGZ1bmN0aW9uKHgsIHkpIHsgdmFyIGkgPSAtMTsgd2hpbGUgKCsraSA8IG4pIHN0cmVhbXNbaV0ucG9pbnQoeCwgeSk7IH0sCiAgICBzcGhlcmU6IGZ1bmN0aW9uKCkgeyB2YXIgaSA9IC0xOyB3aGlsZSAoKytpIDwgbikgc3RyZWFtc1tpXS5zcGhlcmUoKTsgfSwKICAgIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7IHZhciBpID0gLTE7IHdoaWxlICgrK2kgPCBuKSBzdHJlYW1zW2ldLmxpbmVTdGFydCgpOyB9LAogICAgbGluZUVuZDogZnVuY3Rpb24oKSB7IHZhciBpID0gLTE7IHdoaWxlICgrK2kgPCBuKSBzdHJlYW1zW2ldLmxpbmVFbmQoKTsgfSwKICAgIHBvbHlnb25TdGFydDogZnVuY3Rpb24oKSB7IHZhciBpID0gLTE7IHdoaWxlICgrK2kgPCBuKSBzdHJlYW1zW2ldLnBvbHlnb25TdGFydCgpOyB9LAogICAgcG9seWdvbkVuZDogZnVuY3Rpb24oKSB7IHZhciBpID0gLTE7IHdoaWxlICgrK2kgPCBuKSBzdHJlYW1zW2ldLnBvbHlnb25FbmQoKTsgfQogIH07Cn0KCi8vIEEgY29tcG9zaXRlIHByb2plY3Rpb24gZm9yIHRoZSBVbml0ZWQgU3RhdGVzLCBjb25maWd1cmVkIGJ5IGRlZmF1bHQgZm9yCi8vIDk2MMOXNTAwLiBUaGUgcHJvamVjdGlvbiBhbHNvIHdvcmtzIHF1aXRlIHdlbGwgYXQgOTYww5c2MDAgaWYgeW91IGNoYW5nZSB0aGUKLy8gc2NhbGUgdG8gMTI4NSBhbmQgYWRqdXN0IHRoZSB0cmFuc2xhdGUgYWNjb3JkaW5nbHkuIFRoZSBzZXQgb2Ygc3RhbmRhcmQKLy8gcGFyYWxsZWxzIGZvciBlYWNoIHJlZ2lvbiBjb21lcyBmcm9tIFVTR1MsIHdoaWNoIGlzIHB1Ymxpc2hlZCBoZXJlOgovLyBodHRwOi8vZWdzYy51c2dzLmdvdi9pc2IvcHVicy9NYXBQcm9qZWN0aW9ucy9wcm9qZWN0aW9ucy5odG1sI2FsYmVycwpmdW5jdGlvbiBhbGJlcnNVc2EoKSB7CiAgdmFyIGNhY2hlLAogICAgICBjYWNoZVN0cmVhbSwKICAgICAgbG93ZXI0OCA9IGFsYmVycygpLCBsb3dlcjQ4UG9pbnQsCiAgICAgIGFsYXNrYSA9IGNvbmljRXF1YWxBcmVhKCkucm90YXRlKFsxNTQsIDBdKS5jZW50ZXIoWy0yLCA1OC41XSkucGFyYWxsZWxzKFs1NSwgNjVdKSwgYWxhc2thUG9pbnQsIC8vIEVQU0c6MzMzOAogICAgICBoYXdhaWkgPSBjb25pY0VxdWFsQXJlYSgpLnJvdGF0ZShbMTU3LCAwXSkuY2VudGVyKFstMywgMTkuOV0pLnBhcmFsbGVscyhbOCwgMThdKSwgaGF3YWlpUG9pbnQsIC8vIEVTUkk6MTAyMDA3CiAgICAgIHBvaW50LCBwb2ludFN0cmVhbSA9IHtwb2ludDogZnVuY3Rpb24oeCwgeSkgeyBwb2ludCA9IFt4LCB5XTsgfX07CgogIGZ1bmN0aW9uIGFsYmVyc1VzYShjb29yZGluYXRlcykgewogICAgdmFyIHggPSBjb29yZGluYXRlc1swXSwgeSA9IGNvb3JkaW5hdGVzWzFdOwogICAgcmV0dXJuIHBvaW50ID0gbnVsbCwgKGxvd2VyNDhQb2ludC5wb2ludCh4LCB5KSwgcG9pbnQpCiAgICAgICAgfHwgKGFsYXNrYVBvaW50LnBvaW50KHgsIHkpLCBwb2ludCkKICAgICAgICB8fCAoaGF3YWlpUG9pbnQucG9pbnQoeCwgeSksIHBvaW50KTsKICB9CgogIGFsYmVyc1VzYS5pbnZlcnQgPSBmdW5jdGlvbihjb29yZGluYXRlcykgewogICAgdmFyIGsgPSBsb3dlcjQ4LnNjYWxlKCksCiAgICAgICAgdCA9IGxvd2VyNDgudHJhbnNsYXRlKCksCiAgICAgICAgeCA9IChjb29yZGluYXRlc1swXSAtIHRbMF0pIC8gaywKICAgICAgICB5ID0gKGNvb3JkaW5hdGVzWzFdIC0gdFsxXSkgLyBrOwogICAgcmV0dXJuICh5ID49IDAuMTIwICYmIHkgPCAwLjIzNCAmJiB4ID49IC0wLjQyNSAmJiB4IDwgLTAuMjE0ID8gYWxhc2thCiAgICAgICAgOiB5ID49IDAuMTY2ICYmIHkgPCAwLjIzNCAmJiB4ID49IC0wLjIxNCAmJiB4IDwgLTAuMTE1ID8gaGF3YWlpCiAgICAgICAgOiBsb3dlcjQ4KS5pbnZlcnQoY29vcmRpbmF0ZXMpOwogIH07CgogIGFsYmVyc1VzYS5zdHJlYW0gPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgIHJldHVybiBjYWNoZSAmJiBjYWNoZVN0cmVhbSA9PT0gc3RyZWFtID8gY2FjaGUgOiBjYWNoZSA9IG11bHRpcGxleChbbG93ZXI0OC5zdHJlYW0oY2FjaGVTdHJlYW0gPSBzdHJlYW0pLCBhbGFza2Euc3RyZWFtKHN0cmVhbSksIGhhd2FpaS5zdHJlYW0oc3RyZWFtKV0pOwogIH07CgogIGFsYmVyc1VzYS5wcmVjaXNpb24gPSBmdW5jdGlvbihfKSB7CiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBsb3dlcjQ4LnByZWNpc2lvbigpOwogICAgbG93ZXI0OC5wcmVjaXNpb24oXyksIGFsYXNrYS5wcmVjaXNpb24oXyksIGhhd2FpaS5wcmVjaXNpb24oXyk7CiAgICByZXR1cm4gcmVzZXQoKTsKICB9OwoKICBhbGJlcnNVc2Euc2NhbGUgPSBmdW5jdGlvbihfKSB7CiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBsb3dlcjQ4LnNjYWxlKCk7CiAgICBsb3dlcjQ4LnNjYWxlKF8pLCBhbGFza2Euc2NhbGUoXyAqIDAuMzUpLCBoYXdhaWkuc2NhbGUoXyk7CiAgICByZXR1cm4gYWxiZXJzVXNhLnRyYW5zbGF0ZShsb3dlcjQ4LnRyYW5zbGF0ZSgpKTsKICB9OwoKICBhbGJlcnNVc2EudHJhbnNsYXRlID0gZnVuY3Rpb24oXykgewogICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gbG93ZXI0OC50cmFuc2xhdGUoKTsKICAgIHZhciBrID0gbG93ZXI0OC5zY2FsZSgpLCB4ID0gK19bMF0sIHkgPSArX1sxXTsKCiAgICBsb3dlcjQ4UG9pbnQgPSBsb3dlcjQ4CiAgICAgICAgLnRyYW5zbGF0ZShfKQogICAgICAgIC5jbGlwRXh0ZW50KFtbeCAtIDAuNDU1ICogaywgeSAtIDAuMjM4ICoga10sIFt4ICsgMC40NTUgKiBrLCB5ICsgMC4yMzggKiBrXV0pCiAgICAgICAgLnN0cmVhbShwb2ludFN0cmVhbSk7CgogICAgYWxhc2thUG9pbnQgPSBhbGFza2EKICAgICAgICAudHJhbnNsYXRlKFt4IC0gMC4zMDcgKiBrLCB5ICsgMC4yMDEgKiBrXSkKICAgICAgICAuY2xpcEV4dGVudChbW3ggLSAwLjQyNSAqIGsgKyBlcHNpbG9uJDIsIHkgKyAwLjEyMCAqIGsgKyBlcHNpbG9uJDJdLCBbeCAtIDAuMjE0ICogayAtIGVwc2lsb24kMiwgeSArIDAuMjM0ICogayAtIGVwc2lsb24kMl1dKQogICAgICAgIC5zdHJlYW0ocG9pbnRTdHJlYW0pOwoKICAgIGhhd2FpaVBvaW50ID0gaGF3YWlpCiAgICAgICAgLnRyYW5zbGF0ZShbeCAtIDAuMjA1ICogaywgeSArIDAuMjEyICoga10pCiAgICAgICAgLmNsaXBFeHRlbnQoW1t4IC0gMC4yMTQgKiBrICsgZXBzaWxvbiQyLCB5ICsgMC4xNjYgKiBrICsgZXBzaWxvbiQyXSwgW3ggLSAwLjExNSAqIGsgLSBlcHNpbG9uJDIsIHkgKyAwLjIzNCAqIGsgLSBlcHNpbG9uJDJdXSkKICAgICAgICAuc3RyZWFtKHBvaW50U3RyZWFtKTsKCiAgICByZXR1cm4gcmVzZXQoKTsKICB9OwoKICBhbGJlcnNVc2EuZml0RXh0ZW50ID0gZnVuY3Rpb24oZXh0ZW50LCBvYmplY3QpIHsKICAgIHJldHVybiBmaXRFeHRlbnQoYWxiZXJzVXNhLCBleHRlbnQsIG9iamVjdCk7CiAgfTsKCiAgYWxiZXJzVXNhLmZpdFNpemUgPSBmdW5jdGlvbihzaXplLCBvYmplY3QpIHsKICAgIHJldHVybiBmaXRTaXplKGFsYmVyc1VzYSwgc2l6ZSwgb2JqZWN0KTsKICB9OwoKICBhbGJlcnNVc2EuZml0V2lkdGggPSBmdW5jdGlvbih3aWR0aCwgb2JqZWN0KSB7CiAgICByZXR1cm4gZml0V2lkdGgoYWxiZXJzVXNhLCB3aWR0aCwgb2JqZWN0KTsKICB9OwoKICBhbGJlcnNVc2EuZml0SGVpZ2h0ID0gZnVuY3Rpb24oaGVpZ2h0LCBvYmplY3QpIHsKICAgIHJldHVybiBmaXRIZWlnaHQoYWxiZXJzVXNhLCBoZWlnaHQsIG9iamVjdCk7CiAgfTsKCiAgZnVuY3Rpb24gcmVzZXQoKSB7CiAgICBjYWNoZSA9IGNhY2hlU3RyZWFtID0gbnVsbDsKICAgIHJldHVybiBhbGJlcnNVc2E7CiAgfQoKICByZXR1cm4gYWxiZXJzVXNhLnNjYWxlKDEwNzApOwp9CgpmdW5jdGlvbiBhemltdXRoYWxSYXcoc2NhbGUpIHsKICByZXR1cm4gZnVuY3Rpb24oeCwgeSkgewogICAgdmFyIGN4ID0gY29zJDEoeCksCiAgICAgICAgY3kgPSBjb3MkMSh5KSwKICAgICAgICBrID0gc2NhbGUoY3ggKiBjeSk7CiAgICByZXR1cm4gWwogICAgICBrICogY3kgKiBzaW4kMSh4KSwKICAgICAgayAqIHNpbiQxKHkpCiAgICBdOwogIH0KfQoKZnVuY3Rpb24gYXppbXV0aGFsSW52ZXJ0KGFuZ2xlKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKHgsIHkpIHsKICAgIHZhciB6ID0gc3FydCh4ICogeCArIHkgKiB5KSwKICAgICAgICBjID0gYW5nbGUoeiksCiAgICAgICAgc2MgPSBzaW4kMShjKSwKICAgICAgICBjYyA9IGNvcyQxKGMpOwogICAgcmV0dXJuIFsKICAgICAgYXRhbjIoeCAqIHNjLCB6ICogY2MpLAogICAgICBhc2luKHogJiYgeSAqIHNjIC8geikKICAgIF07CiAgfQp9Cgp2YXIgYXppbXV0aGFsRXF1YWxBcmVhUmF3ID0gYXppbXV0aGFsUmF3KGZ1bmN0aW9uKGN4Y3kpIHsKICByZXR1cm4gc3FydCgyIC8gKDEgKyBjeGN5KSk7Cn0pOwoKYXppbXV0aGFsRXF1YWxBcmVhUmF3LmludmVydCA9IGF6aW11dGhhbEludmVydChmdW5jdGlvbih6KSB7CiAgcmV0dXJuIDIgKiBhc2luKHogLyAyKTsKfSk7CgpmdW5jdGlvbiBhemltdXRoYWxFcXVhbEFyZWEoKSB7CiAgcmV0dXJuIHByb2plY3Rpb24oYXppbXV0aGFsRXF1YWxBcmVhUmF3KQogICAgICAuc2NhbGUoMTI0Ljc1KQogICAgICAuY2xpcEFuZ2xlKDE4MCAtIDFlLTMpOwp9Cgp2YXIgYXppbXV0aGFsRXF1aWRpc3RhbnRSYXcgPSBhemltdXRoYWxSYXcoZnVuY3Rpb24oYykgewogIHJldHVybiAoYyA9IGFjb3MoYykpICYmIGMgLyBzaW4kMShjKTsKfSk7CgphemltdXRoYWxFcXVpZGlzdGFudFJhdy5pbnZlcnQgPSBhemltdXRoYWxJbnZlcnQoZnVuY3Rpb24oeikgewogIHJldHVybiB6Owp9KTsKCmZ1bmN0aW9uIGF6aW11dGhhbEVxdWlkaXN0YW50KCkgewogIHJldHVybiBwcm9qZWN0aW9uKGF6aW11dGhhbEVxdWlkaXN0YW50UmF3KQogICAgICAuc2NhbGUoNzkuNDE4OCkKICAgICAgLmNsaXBBbmdsZSgxODAgLSAxZS0zKTsKfQoKZnVuY3Rpb24gbWVyY2F0b3JSYXcobGFtYmRhLCBwaGkpIHsKICByZXR1cm4gW2xhbWJkYSwgbG9nKHRhbigoaGFsZlBpJDIgKyBwaGkpIC8gMikpXTsKfQoKbWVyY2F0b3JSYXcuaW52ZXJ0ID0gZnVuY3Rpb24oeCwgeSkgewogIHJldHVybiBbeCwgMiAqIGF0YW4oZXhwKHkpKSAtIGhhbGZQaSQyXTsKfTsKCmZ1bmN0aW9uIG1lcmNhdG9yKCkgewogIHJldHVybiBtZXJjYXRvclByb2plY3Rpb24obWVyY2F0b3JSYXcpCiAgICAgIC5zY2FsZSg5NjEgLyB0YXUkMyk7Cn0KCmZ1bmN0aW9uIG1lcmNhdG9yUHJvamVjdGlvbihwcm9qZWN0KSB7CiAgdmFyIG0gPSBwcm9qZWN0aW9uKHByb2plY3QpLAogICAgICBjZW50ZXIgPSBtLmNlbnRlciwKICAgICAgc2NhbGUgPSBtLnNjYWxlLAogICAgICB0cmFuc2xhdGUgPSBtLnRyYW5zbGF0ZSwKICAgICAgY2xpcEV4dGVudCA9IG0uY2xpcEV4dGVudCwKICAgICAgeDAgPSBudWxsLCB5MCwgeDEsIHkxOyAvLyBjbGlwIGV4dGVudAoKICBtLnNjYWxlID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoc2NhbGUoXyksIHJlY2xpcCgpKSA6IHNjYWxlKCk7CiAgfTsKCiAgbS50cmFuc2xhdGUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0cmFuc2xhdGUoXyksIHJlY2xpcCgpKSA6IHRyYW5zbGF0ZSgpOwogIH07CgogIG0uY2VudGVyID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoY2VudGVyKF8pLCByZWNsaXAoKSkgOiBjZW50ZXIoKTsKICB9OwoKICBtLmNsaXBFeHRlbnQgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChfID09IG51bGwgPyB4MCA9IHkwID0geDEgPSB5MSA9IG51bGwgOiAoeDAgPSArX1swXVswXSwgeTAgPSArX1swXVsxXSwgeDEgPSArX1sxXVswXSwgeTEgPSArX1sxXVsxXSksIHJlY2xpcCgpKSA6IHgwID09IG51bGwgPyBudWxsIDogW1t4MCwgeTBdLCBbeDEsIHkxXV07CiAgfTsKCiAgZnVuY3Rpb24gcmVjbGlwKCkgewogICAgdmFyIGsgPSBwaSQzICogc2NhbGUoKSwKICAgICAgICB0ID0gbShyb3RhdGlvbihtLnJvdGF0ZSgpKS5pbnZlcnQoWzAsIDBdKSk7CiAgICByZXR1cm4gY2xpcEV4dGVudCh4MCA9PSBudWxsCiAgICAgICAgPyBbW3RbMF0gLSBrLCB0WzFdIC0ga10sIFt0WzBdICsgaywgdFsxXSArIGtdXSA6IHByb2plY3QgPT09IG1lcmNhdG9yUmF3CiAgICAgICAgPyBbW01hdGgubWF4KHRbMF0gLSBrLCB4MCksIHkwXSwgW01hdGgubWluKHRbMF0gKyBrLCB4MSksIHkxXV0KICAgICAgICA6IFtbeDAsIE1hdGgubWF4KHRbMV0gLSBrLCB5MCldLCBbeDEsIE1hdGgubWluKHRbMV0gKyBrLCB5MSldXSk7CiAgfQoKICByZXR1cm4gcmVjbGlwKCk7Cn0KCmZ1bmN0aW9uIHRhbnkoeSkgewogIHJldHVybiB0YW4oKGhhbGZQaSQyICsgeSkgLyAyKTsKfQoKZnVuY3Rpb24gY29uaWNDb25mb3JtYWxSYXcoeTAsIHkxKSB7CiAgdmFyIGN5MCA9IGNvcyQxKHkwKSwKICAgICAgbiA9IHkwID09PSB5MSA/IHNpbiQxKHkwKSA6IGxvZyhjeTAgLyBjb3MkMSh5MSkpIC8gbG9nKHRhbnkoeTEpIC8gdGFueSh5MCkpLAogICAgICBmID0gY3kwICogcG93KHRhbnkoeTApLCBuKSAvIG47CgogIGlmICghbikgcmV0dXJuIG1lcmNhdG9yUmF3OwoKICBmdW5jdGlvbiBwcm9qZWN0KHgsIHkpIHsKICAgIGlmIChmID4gMCkgeyBpZiAoeSA8IC1oYWxmUGkkMiArIGVwc2lsb24kMikgeSA9IC1oYWxmUGkkMiArIGVwc2lsb24kMjsgfQogICAgZWxzZSB7IGlmICh5ID4gaGFsZlBpJDIgLSBlcHNpbG9uJDIpIHkgPSBoYWxmUGkkMiAtIGVwc2lsb24kMjsgfQogICAgdmFyIHIgPSBmIC8gcG93KHRhbnkoeSksIG4pOwogICAgcmV0dXJuIFtyICogc2luJDEobiAqIHgpLCBmIC0gciAqIGNvcyQxKG4gKiB4KV07CiAgfQoKICBwcm9qZWN0LmludmVydCA9IGZ1bmN0aW9uKHgsIHkpIHsKICAgIHZhciBmeSA9IGYgLSB5LCByID0gc2lnbihuKSAqIHNxcnQoeCAqIHggKyBmeSAqIGZ5KTsKICAgIHJldHVybiBbYXRhbjIoeCwgYWJzKGZ5KSkgLyBuICogc2lnbihmeSksIDIgKiBhdGFuKHBvdyhmIC8gciwgMSAvIG4pKSAtIGhhbGZQaSQyXTsKICB9OwoKICByZXR1cm4gcHJvamVjdDsKfQoKZnVuY3Rpb24gY29uaWNDb25mb3JtYWwoKSB7CiAgcmV0dXJuIGNvbmljUHJvamVjdGlvbihjb25pY0NvbmZvcm1hbFJhdykKICAgICAgLnNjYWxlKDEwOS41KQogICAgICAucGFyYWxsZWxzKFszMCwgMzBdKTsKfQoKZnVuY3Rpb24gZXF1aXJlY3Rhbmd1bGFyUmF3KGxhbWJkYSwgcGhpKSB7CiAgcmV0dXJuIFtsYW1iZGEsIHBoaV07Cn0KCmVxdWlyZWN0YW5ndWxhclJhdy5pbnZlcnQgPSBlcXVpcmVjdGFuZ3VsYXJSYXc7CgpmdW5jdGlvbiBlcXVpcmVjdGFuZ3VsYXIoKSB7CiAgcmV0dXJuIHByb2plY3Rpb24oZXF1aXJlY3Rhbmd1bGFyUmF3KQogICAgICAuc2NhbGUoMTUyLjYzKTsKfQoKZnVuY3Rpb24gY29uaWNFcXVpZGlzdGFudFJhdyh5MCwgeTEpIHsKICB2YXIgY3kwID0gY29zJDEoeTApLAogICAgICBuID0geTAgPT09IHkxID8gc2luJDEoeTApIDogKGN5MCAtIGNvcyQxKHkxKSkgLyAoeTEgLSB5MCksCiAgICAgIGcgPSBjeTAgLyBuICsgeTA7CgogIGlmIChhYnMobikgPCBlcHNpbG9uJDIpIHJldHVybiBlcXVpcmVjdGFuZ3VsYXJSYXc7CgogIGZ1bmN0aW9uIHByb2plY3QoeCwgeSkgewogICAgdmFyIGd5ID0gZyAtIHksIG54ID0gbiAqIHg7CiAgICByZXR1cm4gW2d5ICogc2luJDEobngpLCBnIC0gZ3kgKiBjb3MkMShueCldOwogIH0KCiAgcHJvamVjdC5pbnZlcnQgPSBmdW5jdGlvbih4LCB5KSB7CiAgICB2YXIgZ3kgPSBnIC0geTsKICAgIHJldHVybiBbYXRhbjIoeCwgYWJzKGd5KSkgLyBuICogc2lnbihneSksIGcgLSBzaWduKG4pICogc3FydCh4ICogeCArIGd5ICogZ3kpXTsKICB9OwoKICByZXR1cm4gcHJvamVjdDsKfQoKZnVuY3Rpb24gY29uaWNFcXVpZGlzdGFudCgpIHsKICByZXR1cm4gY29uaWNQcm9qZWN0aW9uKGNvbmljRXF1aWRpc3RhbnRSYXcpCiAgICAgIC5zY2FsZSgxMzEuMTU0KQogICAgICAuY2VudGVyKFswLCAxMy45Mzg5XSk7Cn0KCmZ1bmN0aW9uIGdub21vbmljUmF3KHgsIHkpIHsKICB2YXIgY3kgPSBjb3MkMSh5KSwgayA9IGNvcyQxKHgpICogY3k7CiAgcmV0dXJuIFtjeSAqIHNpbiQxKHgpIC8gaywgc2luJDEoeSkgLyBrXTsKfQoKZ25vbW9uaWNSYXcuaW52ZXJ0ID0gYXppbXV0aGFsSW52ZXJ0KGF0YW4pOwoKZnVuY3Rpb24gZ25vbW9uaWMoKSB7CiAgcmV0dXJuIHByb2plY3Rpb24oZ25vbW9uaWNSYXcpCiAgICAgIC5zY2FsZSgxNDQuMDQ5KQogICAgICAuY2xpcEFuZ2xlKDYwKTsKfQoKZnVuY3Rpb24gc2NhbGVUcmFuc2xhdGUkMShreCwga3ksIHR4LCB0eSkgewogIHJldHVybiBreCA9PT0gMSAmJiBreSA9PT0gMSAmJiB0eCA9PT0gMCAmJiB0eSA9PT0gMCA/IGlkZW50aXR5JDQgOiB0cmFuc2Zvcm1lcih7CiAgICBwb2ludDogZnVuY3Rpb24oeCwgeSkgewogICAgICB0aGlzLnN0cmVhbS5wb2ludCh4ICoga3ggKyB0eCwgeSAqIGt5ICsgdHkpOwogICAgfQogIH0pOwp9CgpmdW5jdGlvbiBpZGVudGl0eSQ1KCkgewogIHZhciBrID0gMSwgdHggPSAwLCB0eSA9IDAsIHN4ID0gMSwgc3kgPSAxLCB0cmFuc2Zvcm0kJDEgPSBpZGVudGl0eSQ0LCAvLyBzY2FsZSwgdHJhbnNsYXRlIGFuZCByZWZsZWN0CiAgICAgIHgwID0gbnVsbCwgeTAsIHgxLCB5MSwgLy8gY2xpcCBleHRlbnQKICAgICAgcG9zdGNsaXAgPSBpZGVudGl0eSQ0LAogICAgICBjYWNoZSwKICAgICAgY2FjaGVTdHJlYW0sCiAgICAgIHByb2plY3Rpb247CgogIGZ1bmN0aW9uIHJlc2V0KCkgewogICAgY2FjaGUgPSBjYWNoZVN0cmVhbSA9IG51bGw7CiAgICByZXR1cm4gcHJvamVjdGlvbjsKICB9CgogIHJldHVybiBwcm9qZWN0aW9uID0gewogICAgc3RyZWFtOiBmdW5jdGlvbihzdHJlYW0pIHsKICAgICAgcmV0dXJuIGNhY2hlICYmIGNhY2hlU3RyZWFtID09PSBzdHJlYW0gPyBjYWNoZSA6IGNhY2hlID0gdHJhbnNmb3JtJCQxKHBvc3RjbGlwKGNhY2hlU3RyZWFtID0gc3RyZWFtKSk7CiAgICB9LAogICAgcG9zdGNsaXA6IGZ1bmN0aW9uKF8pIHsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocG9zdGNsaXAgPSBfLCB4MCA9IHkwID0geDEgPSB5MSA9IG51bGwsIHJlc2V0KCkpIDogcG9zdGNsaXA7CiAgICB9LAogICAgY2xpcEV4dGVudDogZnVuY3Rpb24oXykgewogICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChwb3N0Y2xpcCA9IF8gPT0gbnVsbCA/ICh4MCA9IHkwID0geDEgPSB5MSA9IG51bGwsIGlkZW50aXR5JDQpIDogY2xpcFJlY3RhbmdsZSh4MCA9ICtfWzBdWzBdLCB5MCA9ICtfWzBdWzFdLCB4MSA9ICtfWzFdWzBdLCB5MSA9ICtfWzFdWzFdKSwgcmVzZXQoKSkgOiB4MCA9PSBudWxsID8gbnVsbCA6IFtbeDAsIHkwXSwgW3gxLCB5MV1dOwogICAgfSwKICAgIHNjYWxlOiBmdW5jdGlvbihfKSB7CiAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHRyYW5zZm9ybSQkMSA9IHNjYWxlVHJhbnNsYXRlJDEoKGsgPSArXykgKiBzeCwgayAqIHN5LCB0eCwgdHkpLCByZXNldCgpKSA6IGs7CiAgICB9LAogICAgdHJhbnNsYXRlOiBmdW5jdGlvbihfKSB7CiAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHRyYW5zZm9ybSQkMSA9IHNjYWxlVHJhbnNsYXRlJDEoayAqIHN4LCBrICogc3ksIHR4ID0gK19bMF0sIHR5ID0gK19bMV0pLCByZXNldCgpKSA6IFt0eCwgdHldOwogICAgfSwKICAgIHJlZmxlY3RYOiBmdW5jdGlvbihfKSB7CiAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHRyYW5zZm9ybSQkMSA9IHNjYWxlVHJhbnNsYXRlJDEoayAqIChzeCA9IF8gPyAtMSA6IDEpLCBrICogc3ksIHR4LCB0eSksIHJlc2V0KCkpIDogc3ggPCAwOwogICAgfSwKICAgIHJlZmxlY3RZOiBmdW5jdGlvbihfKSB7CiAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHRyYW5zZm9ybSQkMSA9IHNjYWxlVHJhbnNsYXRlJDEoayAqIHN4LCBrICogKHN5ID0gXyA/IC0xIDogMSksIHR4LCB0eSksIHJlc2V0KCkpIDogc3kgPCAwOwogICAgfSwKICAgIGZpdEV4dGVudDogZnVuY3Rpb24oZXh0ZW50LCBvYmplY3QpIHsKICAgICAgcmV0dXJuIGZpdEV4dGVudChwcm9qZWN0aW9uLCBleHRlbnQsIG9iamVjdCk7CiAgICB9LAogICAgZml0U2l6ZTogZnVuY3Rpb24oc2l6ZSwgb2JqZWN0KSB7CiAgICAgIHJldHVybiBmaXRTaXplKHByb2plY3Rpb24sIHNpemUsIG9iamVjdCk7CiAgICB9LAogICAgZml0V2lkdGg6IGZ1bmN0aW9uKHdpZHRoLCBvYmplY3QpIHsKICAgICAgcmV0dXJuIGZpdFdpZHRoKHByb2plY3Rpb24sIHdpZHRoLCBvYmplY3QpOwogICAgfSwKICAgIGZpdEhlaWdodDogZnVuY3Rpb24oaGVpZ2h0LCBvYmplY3QpIHsKICAgICAgcmV0dXJuIGZpdEhlaWdodChwcm9qZWN0aW9uLCBoZWlnaHQsIG9iamVjdCk7CiAgICB9CiAgfTsKfQoKZnVuY3Rpb24gbmF0dXJhbEVhcnRoMVJhdyhsYW1iZGEsIHBoaSkgewogIHZhciBwaGkyID0gcGhpICogcGhpLCBwaGk0ID0gcGhpMiAqIHBoaTI7CiAgcmV0dXJuIFsKICAgIGxhbWJkYSAqICgwLjg3MDcgLSAwLjEzMTk3OSAqIHBoaTIgKyBwaGk0ICogKC0wLjAxMzc5MSArIHBoaTQgKiAoMC4wMDM5NzEgKiBwaGkyIC0gMC4wMDE1MjkgKiBwaGk0KSkpLAogICAgcGhpICogKDEuMDA3MjI2ICsgcGhpMiAqICgwLjAxNTA4NSArIHBoaTQgKiAoLTAuMDQ0NDc1ICsgMC4wMjg4NzQgKiBwaGkyIC0gMC4wMDU5MTYgKiBwaGk0KSkpCiAgXTsKfQoKbmF0dXJhbEVhcnRoMVJhdy5pbnZlcnQgPSBmdW5jdGlvbih4LCB5KSB7CiAgdmFyIHBoaSA9IHksIGkgPSAyNSwgZGVsdGE7CiAgZG8gewogICAgdmFyIHBoaTIgPSBwaGkgKiBwaGksIHBoaTQgPSBwaGkyICogcGhpMjsKICAgIHBoaSAtPSBkZWx0YSA9IChwaGkgKiAoMS4wMDcyMjYgKyBwaGkyICogKDAuMDE1MDg1ICsgcGhpNCAqICgtMC4wNDQ0NzUgKyAwLjAyODg3NCAqIHBoaTIgLSAwLjAwNTkxNiAqIHBoaTQpKSkgLSB5KSAvCiAgICAgICAgKDEuMDA3MjI2ICsgcGhpMiAqICgwLjAxNTA4NSAqIDMgKyBwaGk0ICogKC0wLjA0NDQ3NSAqIDcgKyAwLjAyODg3NCAqIDkgKiBwaGkyIC0gMC4wMDU5MTYgKiAxMSAqIHBoaTQpKSk7CiAgfSB3aGlsZSAoYWJzKGRlbHRhKSA+IGVwc2lsb24kMiAmJiAtLWkgPiAwKTsKICByZXR1cm4gWwogICAgeCAvICgwLjg3MDcgKyAocGhpMiA9IHBoaSAqIHBoaSkgKiAoLTAuMTMxOTc5ICsgcGhpMiAqICgtMC4wMTM3OTEgKyBwaGkyICogcGhpMiAqIHBoaTIgKiAoMC4wMDM5NzEgLSAwLjAwMTUyOSAqIHBoaTIpKSkpLAogICAgcGhpCiAgXTsKfTsKCmZ1bmN0aW9uIG5hdHVyYWxFYXJ0aDEoKSB7CiAgcmV0dXJuIHByb2plY3Rpb24obmF0dXJhbEVhcnRoMVJhdykKICAgICAgLnNjYWxlKDE3NS4yOTUpOwp9CgpmdW5jdGlvbiBvcnRob2dyYXBoaWNSYXcoeCwgeSkgewogIHJldHVybiBbY29zJDEoeSkgKiBzaW4kMSh4KSwgc2luJDEoeSldOwp9CgpvcnRob2dyYXBoaWNSYXcuaW52ZXJ0ID0gYXppbXV0aGFsSW52ZXJ0KGFzaW4pOwoKZnVuY3Rpb24gb3J0aG9ncmFwaGljKCkgewogIHJldHVybiBwcm9qZWN0aW9uKG9ydGhvZ3JhcGhpY1JhdykKICAgICAgLnNjYWxlKDI0OS41KQogICAgICAuY2xpcEFuZ2xlKDkwICsgZXBzaWxvbiQyKTsKfQoKZnVuY3Rpb24gc3RlcmVvZ3JhcGhpY1Jhdyh4LCB5KSB7CiAgdmFyIGN5ID0gY29zJDEoeSksIGsgPSAxICsgY29zJDEoeCkgKiBjeTsKICByZXR1cm4gW2N5ICogc2luJDEoeCkgLyBrLCBzaW4kMSh5KSAvIGtdOwp9CgpzdGVyZW9ncmFwaGljUmF3LmludmVydCA9IGF6aW11dGhhbEludmVydChmdW5jdGlvbih6KSB7CiAgcmV0dXJuIDIgKiBhdGFuKHopOwp9KTsKCmZ1bmN0aW9uIHN0ZXJlb2dyYXBoaWMoKSB7CiAgcmV0dXJuIHByb2plY3Rpb24oc3RlcmVvZ3JhcGhpY1JhdykKICAgICAgLnNjYWxlKDI1MCkKICAgICAgLmNsaXBBbmdsZSgxNDIpOwp9CgpmdW5jdGlvbiB0cmFuc3ZlcnNlTWVyY2F0b3JSYXcobGFtYmRhLCBwaGkpIHsKICByZXR1cm4gW2xvZyh0YW4oKGhhbGZQaSQyICsgcGhpKSAvIDIpKSwgLWxhbWJkYV07Cn0KCnRyYW5zdmVyc2VNZXJjYXRvclJhdy5pbnZlcnQgPSBmdW5jdGlvbih4LCB5KSB7CiAgcmV0dXJuIFsteSwgMiAqIGF0YW4oZXhwKHgpKSAtIGhhbGZQaSQyXTsKfTsKCmZ1bmN0aW9uIHRyYW5zdmVyc2VNZXJjYXRvcigpIHsKICB2YXIgbSA9IG1lcmNhdG9yUHJvamVjdGlvbih0cmFuc3ZlcnNlTWVyY2F0b3JSYXcpLAogICAgICBjZW50ZXIgPSBtLmNlbnRlciwKICAgICAgcm90YXRlID0gbS5yb3RhdGU7CgogIG0uY2VudGVyID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyBjZW50ZXIoWy1fWzFdLCBfWzBdXSkgOiAoXyA9IGNlbnRlcigpLCBbX1sxXSwgLV9bMF1dKTsKICB9OwoKICBtLnJvdGF0ZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gcm90YXRlKFtfWzBdLCBfWzFdLCBfLmxlbmd0aCA+IDIgPyBfWzJdICsgOTAgOiA5MF0pIDogKF8gPSByb3RhdGUoKSwgW19bMF0sIF9bMV0sIF9bMl0gLSA5MF0pOwogIH07CgogIHJldHVybiByb3RhdGUoWzAsIDAsIDkwXSkKICAgICAgLnNjYWxlKDE1OS4xNTUpOwp9CgpmdW5jdGlvbiBkZWZhdWx0U2VwYXJhdGlvbihhLCBiKSB7CiAgcmV0dXJuIGEucGFyZW50ID09PSBiLnBhcmVudCA/IDEgOiAyOwp9CgpmdW5jdGlvbiBtZWFuWChjaGlsZHJlbikgewogIHJldHVybiBjaGlsZHJlbi5yZWR1Y2UobWVhblhSZWR1Y2UsIDApIC8gY2hpbGRyZW4ubGVuZ3RoOwp9CgpmdW5jdGlvbiBtZWFuWFJlZHVjZSh4LCBjKSB7CiAgcmV0dXJuIHggKyBjLng7Cn0KCmZ1bmN0aW9uIG1heFkoY2hpbGRyZW4pIHsKICByZXR1cm4gMSArIGNoaWxkcmVuLnJlZHVjZShtYXhZUmVkdWNlLCAwKTsKfQoKZnVuY3Rpb24gbWF4WVJlZHVjZSh5LCBjKSB7CiAgcmV0dXJuIE1hdGgubWF4KHksIGMueSk7Cn0KCmZ1bmN0aW9uIGxlYWZMZWZ0KG5vZGUpIHsKICB2YXIgY2hpbGRyZW47CiAgd2hpbGUgKGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbikgbm9kZSA9IGNoaWxkcmVuWzBdOwogIHJldHVybiBub2RlOwp9CgpmdW5jdGlvbiBsZWFmUmlnaHQobm9kZSkgewogIHZhciBjaGlsZHJlbjsKICB3aGlsZSAoY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuKSBub2RlID0gY2hpbGRyZW5bY2hpbGRyZW4ubGVuZ3RoIC0gMV07CiAgcmV0dXJuIG5vZGU7Cn0KCmZ1bmN0aW9uIGNsdXN0ZXIoKSB7CiAgdmFyIHNlcGFyYXRpb24gPSBkZWZhdWx0U2VwYXJhdGlvbiwKICAgICAgZHggPSAxLAogICAgICBkeSA9IDEsCiAgICAgIG5vZGVTaXplID0gZmFsc2U7CgogIGZ1bmN0aW9uIGNsdXN0ZXIocm9vdCkgewogICAgdmFyIHByZXZpb3VzTm9kZSwKICAgICAgICB4ID0gMDsKCiAgICAvLyBGaXJzdCB3YWxrLCBjb21wdXRpbmcgdGhlIGluaXRpYWwgeCAmIHkgdmFsdWVzLgogICAgcm9vdC5lYWNoQWZ0ZXIoZnVuY3Rpb24obm9kZSkgewogICAgICB2YXIgY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuOwogICAgICBpZiAoY2hpbGRyZW4pIHsKICAgICAgICBub2RlLnggPSBtZWFuWChjaGlsZHJlbik7CiAgICAgICAgbm9kZS55ID0gbWF4WShjaGlsZHJlbik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbm9kZS54ID0gcHJldmlvdXNOb2RlID8geCArPSBzZXBhcmF0aW9uKG5vZGUsIHByZXZpb3VzTm9kZSkgOiAwOwogICAgICAgIG5vZGUueSA9IDA7CiAgICAgICAgcHJldmlvdXNOb2RlID0gbm9kZTsKICAgICAgfQogICAgfSk7CgogICAgdmFyIGxlZnQgPSBsZWFmTGVmdChyb290KSwKICAgICAgICByaWdodCA9IGxlYWZSaWdodChyb290KSwKICAgICAgICB4MCA9IGxlZnQueCAtIHNlcGFyYXRpb24obGVmdCwgcmlnaHQpIC8gMiwKICAgICAgICB4MSA9IHJpZ2h0LnggKyBzZXBhcmF0aW9uKHJpZ2h0LCBsZWZ0KSAvIDI7CgogICAgLy8gU2Vjb25kIHdhbGssIG5vcm1hbGl6aW5nIHggJiB5IHRvIHRoZSBkZXNpcmVkIHNpemUuCiAgICByZXR1cm4gcm9vdC5lYWNoQWZ0ZXIobm9kZVNpemUgPyBmdW5jdGlvbihub2RlKSB7CiAgICAgIG5vZGUueCA9IChub2RlLnggLSByb290LngpICogZHg7CiAgICAgIG5vZGUueSA9IChyb290LnkgLSBub2RlLnkpICogZHk7CiAgICB9IDogZnVuY3Rpb24obm9kZSkgewogICAgICBub2RlLnggPSAobm9kZS54IC0geDApIC8gKHgxIC0geDApICogZHg7CiAgICAgIG5vZGUueSA9ICgxIC0gKHJvb3QueSA/IG5vZGUueSAvIHJvb3QueSA6IDEpKSAqIGR5OwogICAgfSk7CiAgfQoKICBjbHVzdGVyLnNlcGFyYXRpb24gPSBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChzZXBhcmF0aW9uID0geCwgY2x1c3RlcikgOiBzZXBhcmF0aW9uOwogIH07CgogIGNsdXN0ZXIuc2l6ZSA9IGZ1bmN0aW9uKHgpIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG5vZGVTaXplID0gZmFsc2UsIGR4ID0gK3hbMF0sIGR5ID0gK3hbMV0sIGNsdXN0ZXIpIDogKG5vZGVTaXplID8gbnVsbCA6IFtkeCwgZHldKTsKICB9OwoKICBjbHVzdGVyLm5vZGVTaXplID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobm9kZVNpemUgPSB0cnVlLCBkeCA9ICt4WzBdLCBkeSA9ICt4WzFdLCBjbHVzdGVyKSA6IChub2RlU2l6ZSA/IFtkeCwgZHldIDogbnVsbCk7CiAgfTsKCiAgcmV0dXJuIGNsdXN0ZXI7Cn0KCmZ1bmN0aW9uIGNvdW50KG5vZGUpIHsKICB2YXIgc3VtID0gMCwKICAgICAgY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuLAogICAgICBpID0gY2hpbGRyZW4gJiYgY2hpbGRyZW4ubGVuZ3RoOwogIGlmICghaSkgc3VtID0gMTsKICBlbHNlIHdoaWxlICgtLWkgPj0gMCkgc3VtICs9IGNoaWxkcmVuW2ldLnZhbHVlOwogIG5vZGUudmFsdWUgPSBzdW07Cn0KCmZ1bmN0aW9uIG5vZGVfY291bnQoKSB7CiAgcmV0dXJuIHRoaXMuZWFjaEFmdGVyKGNvdW50KTsKfQoKZnVuY3Rpb24gbm9kZV9lYWNoKGNhbGxiYWNrKSB7CiAgdmFyIG5vZGUgPSB0aGlzLCBjdXJyZW50LCBuZXh0ID0gW25vZGVdLCBjaGlsZHJlbiwgaSwgbjsKICBkbyB7CiAgICBjdXJyZW50ID0gbmV4dC5yZXZlcnNlKCksIG5leHQgPSBbXTsKICAgIHdoaWxlIChub2RlID0gY3VycmVudC5wb3AoKSkgewogICAgICBjYWxsYmFjayhub2RlKSwgY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuOwogICAgICBpZiAoY2hpbGRyZW4pIGZvciAoaSA9IDAsIG4gPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBuOyArK2kpIHsKICAgICAgICBuZXh0LnB1c2goY2hpbGRyZW5baV0pOwogICAgICB9CiAgICB9CiAgfSB3aGlsZSAobmV4dC5sZW5ndGgpOwogIHJldHVybiB0aGlzOwp9CgpmdW5jdGlvbiBub2RlX2VhY2hCZWZvcmUoY2FsbGJhY2spIHsKICB2YXIgbm9kZSA9IHRoaXMsIG5vZGVzID0gW25vZGVdLCBjaGlsZHJlbiwgaTsKICB3aGlsZSAobm9kZSA9IG5vZGVzLnBvcCgpKSB7CiAgICBjYWxsYmFjayhub2RlKSwgY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuOwogICAgaWYgKGNoaWxkcmVuKSBmb3IgKGkgPSBjaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICBub2Rlcy5wdXNoKGNoaWxkcmVuW2ldKTsKICAgIH0KICB9CiAgcmV0dXJuIHRoaXM7Cn0KCmZ1bmN0aW9uIG5vZGVfZWFjaEFmdGVyKGNhbGxiYWNrKSB7CiAgdmFyIG5vZGUgPSB0aGlzLCBub2RlcyA9IFtub2RlXSwgbmV4dCA9IFtdLCBjaGlsZHJlbiwgaSwgbjsKICB3aGlsZSAobm9kZSA9IG5vZGVzLnBvcCgpKSB7CiAgICBuZXh0LnB1c2gobm9kZSksIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjsKICAgIGlmIChjaGlsZHJlbikgZm9yIChpID0gMCwgbiA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IG47ICsraSkgewogICAgICBub2Rlcy5wdXNoKGNoaWxkcmVuW2ldKTsKICAgIH0KICB9CiAgd2hpbGUgKG5vZGUgPSBuZXh0LnBvcCgpKSB7CiAgICBjYWxsYmFjayhub2RlKTsKICB9CiAgcmV0dXJuIHRoaXM7Cn0KCmZ1bmN0aW9uIG5vZGVfc3VtKHZhbHVlKSB7CiAgcmV0dXJuIHRoaXMuZWFjaEFmdGVyKGZ1bmN0aW9uKG5vZGUpIHsKICAgIHZhciBzdW0gPSArdmFsdWUobm9kZS5kYXRhKSB8fCAwLAogICAgICAgIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbiwKICAgICAgICBpID0gY2hpbGRyZW4gJiYgY2hpbGRyZW4ubGVuZ3RoOwogICAgd2hpbGUgKC0taSA+PSAwKSBzdW0gKz0gY2hpbGRyZW5baV0udmFsdWU7CiAgICBub2RlLnZhbHVlID0gc3VtOwogIH0pOwp9CgpmdW5jdGlvbiBub2RlX3NvcnQoY29tcGFyZSkgewogIHJldHVybiB0aGlzLmVhY2hCZWZvcmUoZnVuY3Rpb24obm9kZSkgewogICAgaWYgKG5vZGUuY2hpbGRyZW4pIHsKICAgICAgbm9kZS5jaGlsZHJlbi5zb3J0KGNvbXBhcmUpOwogICAgfQogIH0pOwp9CgpmdW5jdGlvbiBub2RlX3BhdGgoZW5kKSB7CiAgdmFyIHN0YXJ0ID0gdGhpcywKICAgICAgYW5jZXN0b3IgPSBsZWFzdENvbW1vbkFuY2VzdG9yKHN0YXJ0LCBlbmQpLAogICAgICBub2RlcyA9IFtzdGFydF07CiAgd2hpbGUgKHN0YXJ0ICE9PSBhbmNlc3RvcikgewogICAgc3RhcnQgPSBzdGFydC5wYXJlbnQ7CiAgICBub2Rlcy5wdXNoKHN0YXJ0KTsKICB9CiAgdmFyIGsgPSBub2Rlcy5sZW5ndGg7CiAgd2hpbGUgKGVuZCAhPT0gYW5jZXN0b3IpIHsKICAgIG5vZGVzLnNwbGljZShrLCAwLCBlbmQpOwogICAgZW5kID0gZW5kLnBhcmVudDsKICB9CiAgcmV0dXJuIG5vZGVzOwp9CgpmdW5jdGlvbiBsZWFzdENvbW1vbkFuY2VzdG9yKGEsIGIpIHsKICBpZiAoYSA9PT0gYikgcmV0dXJuIGE7CiAgdmFyIGFOb2RlcyA9IGEuYW5jZXN0b3JzKCksCiAgICAgIGJOb2RlcyA9IGIuYW5jZXN0b3JzKCksCiAgICAgIGMgPSBudWxsOwogIGEgPSBhTm9kZXMucG9wKCk7CiAgYiA9IGJOb2Rlcy5wb3AoKTsKICB3aGlsZSAoYSA9PT0gYikgewogICAgYyA9IGE7CiAgICBhID0gYU5vZGVzLnBvcCgpOwogICAgYiA9IGJOb2Rlcy5wb3AoKTsKICB9CiAgcmV0dXJuIGM7Cn0KCmZ1bmN0aW9uIG5vZGVfYW5jZXN0b3JzKCkgewogIHZhciBub2RlID0gdGhpcywgbm9kZXMgPSBbbm9kZV07CiAgd2hpbGUgKG5vZGUgPSBub2RlLnBhcmVudCkgewogICAgbm9kZXMucHVzaChub2RlKTsKICB9CiAgcmV0dXJuIG5vZGVzOwp9CgpmdW5jdGlvbiBub2RlX2Rlc2NlbmRhbnRzKCkgewogIHZhciBub2RlcyA9IFtdOwogIHRoaXMuZWFjaChmdW5jdGlvbihub2RlKSB7CiAgICBub2Rlcy5wdXNoKG5vZGUpOwogIH0pOwogIHJldHVybiBub2RlczsKfQoKZnVuY3Rpb24gbm9kZV9sZWF2ZXMoKSB7CiAgdmFyIGxlYXZlcyA9IFtdOwogIHRoaXMuZWFjaEJlZm9yZShmdW5jdGlvbihub2RlKSB7CiAgICBpZiAoIW5vZGUuY2hpbGRyZW4pIHsKICAgICAgbGVhdmVzLnB1c2gobm9kZSk7CiAgICB9CiAgfSk7CiAgcmV0dXJuIGxlYXZlczsKfQoKZnVuY3Rpb24gbm9kZV9saW5rcygpIHsKICB2YXIgcm9vdCA9IHRoaXMsIGxpbmtzID0gW107CiAgcm9vdC5lYWNoKGZ1bmN0aW9uKG5vZGUpIHsKICAgIGlmIChub2RlICE9PSByb290KSB7IC8vIERvbuKAmXQgaW5jbHVkZSB0aGUgcm9vdOKAmXMgcGFyZW50LCBpZiBhbnkuCiAgICAgIGxpbmtzLnB1c2goe3NvdXJjZTogbm9kZS5wYXJlbnQsIHRhcmdldDogbm9kZX0pOwogICAgfQogIH0pOwogIHJldHVybiBsaW5rczsKfQoKZnVuY3Rpb24gaGllcmFyY2h5KGRhdGEsIGNoaWxkcmVuKSB7CiAgdmFyIHJvb3QgPSBuZXcgTm9kZShkYXRhKSwKICAgICAgdmFsdWVkID0gK2RhdGEudmFsdWUgJiYgKHJvb3QudmFsdWUgPSBkYXRhLnZhbHVlKSwKICAgICAgbm9kZSwKICAgICAgbm9kZXMgPSBbcm9vdF0sCiAgICAgIGNoaWxkLAogICAgICBjaGlsZHMsCiAgICAgIGksCiAgICAgIG47CgogIGlmIChjaGlsZHJlbiA9PSBudWxsKSBjaGlsZHJlbiA9IGRlZmF1bHRDaGlsZHJlbjsKCiAgd2hpbGUgKG5vZGUgPSBub2Rlcy5wb3AoKSkgewogICAgaWYgKHZhbHVlZCkgbm9kZS52YWx1ZSA9ICtub2RlLmRhdGEudmFsdWU7CiAgICBpZiAoKGNoaWxkcyA9IGNoaWxkcmVuKG5vZGUuZGF0YSkpICYmIChuID0gY2hpbGRzLmxlbmd0aCkpIHsKICAgICAgbm9kZS5jaGlsZHJlbiA9IG5ldyBBcnJheShuKTsKICAgICAgZm9yIChpID0gbiAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgbm9kZXMucHVzaChjaGlsZCA9IG5vZGUuY2hpbGRyZW5baV0gPSBuZXcgTm9kZShjaGlsZHNbaV0pKTsKICAgICAgICBjaGlsZC5wYXJlbnQgPSBub2RlOwogICAgICAgIGNoaWxkLmRlcHRoID0gbm9kZS5kZXB0aCArIDE7CiAgICAgIH0KICAgIH0KICB9CgogIHJldHVybiByb290LmVhY2hCZWZvcmUoY29tcHV0ZUhlaWdodCk7Cn0KCmZ1bmN0aW9uIG5vZGVfY29weSgpIHsKICByZXR1cm4gaGllcmFyY2h5KHRoaXMpLmVhY2hCZWZvcmUoY29weURhdGEpOwp9CgpmdW5jdGlvbiBkZWZhdWx0Q2hpbGRyZW4oZCkgewogIHJldHVybiBkLmNoaWxkcmVuOwp9CgpmdW5jdGlvbiBjb3B5RGF0YShub2RlKSB7CiAgbm9kZS5kYXRhID0gbm9kZS5kYXRhLmRhdGE7Cn0KCmZ1bmN0aW9uIGNvbXB1dGVIZWlnaHQobm9kZSkgewogIHZhciBoZWlnaHQgPSAwOwogIGRvIG5vZGUuaGVpZ2h0ID0gaGVpZ2h0OwogIHdoaWxlICgobm9kZSA9IG5vZGUucGFyZW50KSAmJiAobm9kZS5oZWlnaHQgPCArK2hlaWdodCkpOwp9CgpmdW5jdGlvbiBOb2RlKGRhdGEpIHsKICB0aGlzLmRhdGEgPSBkYXRhOwogIHRoaXMuZGVwdGggPQogIHRoaXMuaGVpZ2h0ID0gMDsKICB0aGlzLnBhcmVudCA9IG51bGw7Cn0KCk5vZGUucHJvdG90eXBlID0gaGllcmFyY2h5LnByb3RvdHlwZSA9IHsKICBjb25zdHJ1Y3RvcjogTm9kZSwKICBjb3VudDogbm9kZV9jb3VudCwKICBlYWNoOiBub2RlX2VhY2gsCiAgZWFjaEFmdGVyOiBub2RlX2VhY2hBZnRlciwKICBlYWNoQmVmb3JlOiBub2RlX2VhY2hCZWZvcmUsCiAgc3VtOiBub2RlX3N1bSwKICBzb3J0OiBub2RlX3NvcnQsCiAgcGF0aDogbm9kZV9wYXRoLAogIGFuY2VzdG9yczogbm9kZV9hbmNlc3RvcnMsCiAgZGVzY2VuZGFudHM6IG5vZGVfZGVzY2VuZGFudHMsCiAgbGVhdmVzOiBub2RlX2xlYXZlcywKICBsaW5rczogbm9kZV9saW5rcywKICBjb3B5OiBub2RlX2NvcHkKfTsKCnZhciBzbGljZSQ0ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlOwoKZnVuY3Rpb24gc2h1ZmZsZSQxKGFycmF5KSB7CiAgdmFyIG0gPSBhcnJheS5sZW5ndGgsCiAgICAgIHQsCiAgICAgIGk7CgogIHdoaWxlIChtKSB7CiAgICBpID0gTWF0aC5yYW5kb20oKSAqIG0tLSB8IDA7CiAgICB0ID0gYXJyYXlbbV07CiAgICBhcnJheVttXSA9IGFycmF5W2ldOwogICAgYXJyYXlbaV0gPSB0OwogIH0KCiAgcmV0dXJuIGFycmF5Owp9CgpmdW5jdGlvbiBlbmNsb3NlKGNpcmNsZXMpIHsKICB2YXIgaSA9IDAsIG4gPSAoY2lyY2xlcyA9IHNodWZmbGUkMShzbGljZSQ0LmNhbGwoY2lyY2xlcykpKS5sZW5ndGgsIEIgPSBbXSwgcCwgZTsKCiAgd2hpbGUgKGkgPCBuKSB7CiAgICBwID0gY2lyY2xlc1tpXTsKICAgIGlmIChlICYmIGVuY2xvc2VzV2VhayhlLCBwKSkgKytpOwogICAgZWxzZSBlID0gZW5jbG9zZUJhc2lzKEIgPSBleHRlbmRCYXNpcyhCLCBwKSksIGkgPSAwOwogIH0KCiAgcmV0dXJuIGU7Cn0KCmZ1bmN0aW9uIGV4dGVuZEJhc2lzKEIsIHApIHsKICB2YXIgaSwgajsKCiAgaWYgKGVuY2xvc2VzV2Vha0FsbChwLCBCKSkgcmV0dXJuIFtwXTsKCiAgLy8gSWYgd2UgZ2V0IGhlcmUgdGhlbiBCIG11c3QgaGF2ZSBhdCBsZWFzdCBvbmUgZWxlbWVudC4KICBmb3IgKGkgPSAwOyBpIDwgQi5sZW5ndGg7ICsraSkgewogICAgaWYgKGVuY2xvc2VzTm90KHAsIEJbaV0pCiAgICAgICAgJiYgZW5jbG9zZXNXZWFrQWxsKGVuY2xvc2VCYXNpczIoQltpXSwgcCksIEIpKSB7CiAgICAgIHJldHVybiBbQltpXSwgcF07CiAgICB9CiAgfQoKICAvLyBJZiB3ZSBnZXQgaGVyZSB0aGVuIEIgbXVzdCBoYXZlIGF0IGxlYXN0IHR3byBlbGVtZW50cy4KICBmb3IgKGkgPSAwOyBpIDwgQi5sZW5ndGggLSAxOyArK2kpIHsKICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgQi5sZW5ndGg7ICsraikgewogICAgICBpZiAoZW5jbG9zZXNOb3QoZW5jbG9zZUJhc2lzMihCW2ldLCBCW2pdKSwgcCkKICAgICAgICAgICYmIGVuY2xvc2VzTm90KGVuY2xvc2VCYXNpczIoQltpXSwgcCksIEJbal0pCiAgICAgICAgICAmJiBlbmNsb3Nlc05vdChlbmNsb3NlQmFzaXMyKEJbal0sIHApLCBCW2ldKQogICAgICAgICAgJiYgZW5jbG9zZXNXZWFrQWxsKGVuY2xvc2VCYXNpczMoQltpXSwgQltqXSwgcCksIEIpKSB7CiAgICAgICAgcmV0dXJuIFtCW2ldLCBCW2pdLCBwXTsKICAgICAgfQogICAgfQogIH0KCiAgLy8gSWYgd2UgZ2V0IGhlcmUgdGhlbiBzb21ldGhpbmcgaXMgdmVyeSB3cm9uZy4KICB0aHJvdyBuZXcgRXJyb3I7Cn0KCmZ1bmN0aW9uIGVuY2xvc2VzTm90KGEsIGIpIHsKICB2YXIgZHIgPSBhLnIgLSBiLnIsIGR4ID0gYi54IC0gYS54LCBkeSA9IGIueSAtIGEueTsKICByZXR1cm4gZHIgPCAwIHx8IGRyICogZHIgPCBkeCAqIGR4ICsgZHkgKiBkeTsKfQoKZnVuY3Rpb24gZW5jbG9zZXNXZWFrKGEsIGIpIHsKICB2YXIgZHIgPSBhLnIgLSBiLnIgKyAxZS02LCBkeCA9IGIueCAtIGEueCwgZHkgPSBiLnkgLSBhLnk7CiAgcmV0dXJuIGRyID4gMCAmJiBkciAqIGRyID4gZHggKiBkeCArIGR5ICogZHk7Cn0KCmZ1bmN0aW9uIGVuY2xvc2VzV2Vha0FsbChhLCBCKSB7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBCLmxlbmd0aDsgKytpKSB7CiAgICBpZiAoIWVuY2xvc2VzV2VhayhhLCBCW2ldKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQogIHJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiBlbmNsb3NlQmFzaXMoQikgewogIHN3aXRjaCAoQi5sZW5ndGgpIHsKICAgIGNhc2UgMTogcmV0dXJuIGVuY2xvc2VCYXNpczEoQlswXSk7CiAgICBjYXNlIDI6IHJldHVybiBlbmNsb3NlQmFzaXMyKEJbMF0sIEJbMV0pOwogICAgY2FzZSAzOiByZXR1cm4gZW5jbG9zZUJhc2lzMyhCWzBdLCBCWzFdLCBCWzJdKTsKICB9Cn0KCmZ1bmN0aW9uIGVuY2xvc2VCYXNpczEoYSkgewogIHJldHVybiB7CiAgICB4OiBhLngsCiAgICB5OiBhLnksCiAgICByOiBhLnIKICB9Owp9CgpmdW5jdGlvbiBlbmNsb3NlQmFzaXMyKGEsIGIpIHsKICB2YXIgeDEgPSBhLngsIHkxID0gYS55LCByMSA9IGEuciwKICAgICAgeDIgPSBiLngsIHkyID0gYi55LCByMiA9IGIuciwKICAgICAgeDIxID0geDIgLSB4MSwgeTIxID0geTIgLSB5MSwgcjIxID0gcjIgLSByMSwKICAgICAgbCA9IE1hdGguc3FydCh4MjEgKiB4MjEgKyB5MjEgKiB5MjEpOwogIHJldHVybiB7CiAgICB4OiAoeDEgKyB4MiArIHgyMSAvIGwgKiByMjEpIC8gMiwKICAgIHk6ICh5MSArIHkyICsgeTIxIC8gbCAqIHIyMSkgLyAyLAogICAgcjogKGwgKyByMSArIHIyKSAvIDIKICB9Owp9CgpmdW5jdGlvbiBlbmNsb3NlQmFzaXMzKGEsIGIsIGMpIHsKICB2YXIgeDEgPSBhLngsIHkxID0gYS55LCByMSA9IGEuciwKICAgICAgeDIgPSBiLngsIHkyID0gYi55LCByMiA9IGIuciwKICAgICAgeDMgPSBjLngsIHkzID0gYy55LCByMyA9IGMuciwKICAgICAgYTIgPSB4MSAtIHgyLAogICAgICBhMyA9IHgxIC0geDMsCiAgICAgIGIyID0geTEgLSB5MiwKICAgICAgYjMgPSB5MSAtIHkzLAogICAgICBjMiA9IHIyIC0gcjEsCiAgICAgIGMzID0gcjMgLSByMSwKICAgICAgZDEgPSB4MSAqIHgxICsgeTEgKiB5MSAtIHIxICogcjEsCiAgICAgIGQyID0gZDEgLSB4MiAqIHgyIC0geTIgKiB5MiArIHIyICogcjIsCiAgICAgIGQzID0gZDEgLSB4MyAqIHgzIC0geTMgKiB5MyArIHIzICogcjMsCiAgICAgIGFiID0gYTMgKiBiMiAtIGEyICogYjMsCiAgICAgIHhhID0gKGIyICogZDMgLSBiMyAqIGQyKSAvIChhYiAqIDIpIC0geDEsCiAgICAgIHhiID0gKGIzICogYzIgLSBiMiAqIGMzKSAvIGFiLAogICAgICB5YSA9IChhMyAqIGQyIC0gYTIgKiBkMykgLyAoYWIgKiAyKSAtIHkxLAogICAgICB5YiA9IChhMiAqIGMzIC0gYTMgKiBjMikgLyBhYiwKICAgICAgQSA9IHhiICogeGIgKyB5YiAqIHliIC0gMSwKICAgICAgQiA9IDIgKiAocjEgKyB4YSAqIHhiICsgeWEgKiB5YiksCiAgICAgIEMgPSB4YSAqIHhhICsgeWEgKiB5YSAtIHIxICogcjEsCiAgICAgIHIgPSAtKEEgPyAoQiArIE1hdGguc3FydChCICogQiAtIDQgKiBBICogQykpIC8gKDIgKiBBKSA6IEMgLyBCKTsKICByZXR1cm4gewogICAgeDogeDEgKyB4YSArIHhiICogciwKICAgIHk6IHkxICsgeWEgKyB5YiAqIHIsCiAgICByOiByCiAgfTsKfQoKZnVuY3Rpb24gcGxhY2UoYiwgYSwgYykgewogIHZhciBkeCA9IGIueCAtIGEueCwgeCwgYTIsCiAgICAgIGR5ID0gYi55IC0gYS55LCB5LCBiMiwKICAgICAgZDIgPSBkeCAqIGR4ICsgZHkgKiBkeTsKICBpZiAoZDIpIHsKICAgIGEyID0gYS5yICsgYy5yLCBhMiAqPSBhMjsKICAgIGIyID0gYi5yICsgYy5yLCBiMiAqPSBiMjsKICAgIGlmIChhMiA+IGIyKSB7CiAgICAgIHggPSAoZDIgKyBiMiAtIGEyKSAvICgyICogZDIpOwogICAgICB5ID0gTWF0aC5zcXJ0KE1hdGgubWF4KDAsIGIyIC8gZDIgLSB4ICogeCkpOwogICAgICBjLnggPSBiLnggLSB4ICogZHggLSB5ICogZHk7CiAgICAgIGMueSA9IGIueSAtIHggKiBkeSArIHkgKiBkeDsKICAgIH0gZWxzZSB7CiAgICAgIHggPSAoZDIgKyBhMiAtIGIyKSAvICgyICogZDIpOwogICAgICB5ID0gTWF0aC5zcXJ0KE1hdGgubWF4KDAsIGEyIC8gZDIgLSB4ICogeCkpOwogICAgICBjLnggPSBhLnggKyB4ICogZHggLSB5ICogZHk7CiAgICAgIGMueSA9IGEueSArIHggKiBkeSArIHkgKiBkeDsKICAgIH0KICB9IGVsc2UgewogICAgYy54ID0gYS54ICsgYy5yOwogICAgYy55ID0gYS55OwogIH0KfQoKZnVuY3Rpb24gaW50ZXJzZWN0cyhhLCBiKSB7CiAgdmFyIGRyID0gYS5yICsgYi5yIC0gMWUtNiwgZHggPSBiLnggLSBhLngsIGR5ID0gYi55IC0gYS55OwogIHJldHVybiBkciA+IDAgJiYgZHIgKiBkciA+IGR4ICogZHggKyBkeSAqIGR5Owp9CgpmdW5jdGlvbiBzY29yZShub2RlKSB7CiAgdmFyIGEgPSBub2RlLl8sCiAgICAgIGIgPSBub2RlLm5leHQuXywKICAgICAgYWIgPSBhLnIgKyBiLnIsCiAgICAgIGR4ID0gKGEueCAqIGIuciArIGIueCAqIGEucikgLyBhYiwKICAgICAgZHkgPSAoYS55ICogYi5yICsgYi55ICogYS5yKSAvIGFiOwogIHJldHVybiBkeCAqIGR4ICsgZHkgKiBkeTsKfQoKZnVuY3Rpb24gTm9kZSQxKGNpcmNsZSkgewogIHRoaXMuXyA9IGNpcmNsZTsKICB0aGlzLm5leHQgPSBudWxsOwogIHRoaXMucHJldmlvdXMgPSBudWxsOwp9CgpmdW5jdGlvbiBwYWNrRW5jbG9zZShjaXJjbGVzKSB7CiAgaWYgKCEobiA9IGNpcmNsZXMubGVuZ3RoKSkgcmV0dXJuIDA7CgogIHZhciBhLCBiLCBjLCBuLCBhYSwgY2EsIGksIGosIGssIHNqLCBzazsKCiAgLy8gUGxhY2UgdGhlIGZpcnN0IGNpcmNsZS4KICBhID0gY2lyY2xlc1swXSwgYS54ID0gMCwgYS55ID0gMDsKICBpZiAoIShuID4gMSkpIHJldHVybiBhLnI7CgogIC8vIFBsYWNlIHRoZSBzZWNvbmQgY2lyY2xlLgogIGIgPSBjaXJjbGVzWzFdLCBhLnggPSAtYi5yLCBiLnggPSBhLnIsIGIueSA9IDA7CiAgaWYgKCEobiA+IDIpKSByZXR1cm4gYS5yICsgYi5yOwoKICAvLyBQbGFjZSB0aGUgdGhpcmQgY2lyY2xlLgogIHBsYWNlKGIsIGEsIGMgPSBjaXJjbGVzWzJdKTsKCiAgLy8gSW5pdGlhbGl6ZSB0aGUgZnJvbnQtY2hhaW4gdXNpbmcgdGhlIGZpcnN0IHRocmVlIGNpcmNsZXMgYSwgYiBhbmQgYy4KICBhID0gbmV3IE5vZGUkMShhKSwgYiA9IG5ldyBOb2RlJDEoYiksIGMgPSBuZXcgTm9kZSQxKGMpOwogIGEubmV4dCA9IGMucHJldmlvdXMgPSBiOwogIGIubmV4dCA9IGEucHJldmlvdXMgPSBjOwogIGMubmV4dCA9IGIucHJldmlvdXMgPSBhOwoKICAvLyBBdHRlbXB0IHRvIHBsYWNlIGVhY2ggcmVtYWluaW5nIGNpcmNsZeKApgogIHBhY2s6IGZvciAoaSA9IDM7IGkgPCBuOyArK2kpIHsKICAgIHBsYWNlKGEuXywgYi5fLCBjID0gY2lyY2xlc1tpXSksIGMgPSBuZXcgTm9kZSQxKGMpOwoKICAgIC8vIEZpbmQgdGhlIGNsb3Nlc3QgaW50ZXJzZWN0aW5nIGNpcmNsZSBvbiB0aGUgZnJvbnQtY2hhaW4sIGlmIGFueS4KICAgIC8vIOKAnENsb3NlbmVzc+KAnSBpcyBkZXRlcm1pbmVkIGJ5IGxpbmVhciBkaXN0YW5jZSBhbG9uZyB0aGUgZnJvbnQtY2hhaW4uCiAgICAvLyDigJxBaGVhZOKAnSBvciDigJxiZWhpbmTigJ0gaXMgbGlrZXdpc2UgZGV0ZXJtaW5lZCBieSBsaW5lYXIgZGlzdGFuY2UuCiAgICBqID0gYi5uZXh0LCBrID0gYS5wcmV2aW91cywgc2ogPSBiLl8uciwgc2sgPSBhLl8ucjsKICAgIGRvIHsKICAgICAgaWYgKHNqIDw9IHNrKSB7CiAgICAgICAgaWYgKGludGVyc2VjdHMoai5fLCBjLl8pKSB7CiAgICAgICAgICBiID0gaiwgYS5uZXh0ID0gYiwgYi5wcmV2aW91cyA9IGEsIC0taTsKICAgICAgICAgIGNvbnRpbnVlIHBhY2s7CiAgICAgICAgfQogICAgICAgIHNqICs9IGouXy5yLCBqID0gai5uZXh0OwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChpbnRlcnNlY3RzKGsuXywgYy5fKSkgewogICAgICAgICAgYSA9IGssIGEubmV4dCA9IGIsIGIucHJldmlvdXMgPSBhLCAtLWk7CiAgICAgICAgICBjb250aW51ZSBwYWNrOwogICAgICAgIH0KICAgICAgICBzayArPSBrLl8uciwgayA9IGsucHJldmlvdXM7CiAgICAgIH0KICAgIH0gd2hpbGUgKGogIT09IGsubmV4dCk7CgogICAgLy8gU3VjY2VzcyEgSW5zZXJ0IHRoZSBuZXcgY2lyY2xlIGMgYmV0d2VlbiBhIGFuZCBiLgogICAgYy5wcmV2aW91cyA9IGEsIGMubmV4dCA9IGIsIGEubmV4dCA9IGIucHJldmlvdXMgPSBiID0gYzsKCiAgICAvLyBDb21wdXRlIHRoZSBuZXcgY2xvc2VzdCBjaXJjbGUgcGFpciB0byB0aGUgY2VudHJvaWQuCiAgICBhYSA9IHNjb3JlKGEpOwogICAgd2hpbGUgKChjID0gYy5uZXh0KSAhPT0gYikgewogICAgICBpZiAoKGNhID0gc2NvcmUoYykpIDwgYWEpIHsKICAgICAgICBhID0gYywgYWEgPSBjYTsKICAgICAgfQogICAgfQogICAgYiA9IGEubmV4dDsKICB9CgogIC8vIENvbXB1dGUgdGhlIGVuY2xvc2luZyBjaXJjbGUgb2YgdGhlIGZyb250IGNoYWluLgogIGEgPSBbYi5fXSwgYyA9IGI7IHdoaWxlICgoYyA9IGMubmV4dCkgIT09IGIpIGEucHVzaChjLl8pOyBjID0gZW5jbG9zZShhKTsKCiAgLy8gVHJhbnNsYXRlIHRoZSBjaXJjbGVzIHRvIHB1dCB0aGUgZW5jbG9zaW5nIGNpcmNsZSBhcm91bmQgdGhlIG9yaWdpbi4KICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSBhID0gY2lyY2xlc1tpXSwgYS54IC09IGMueCwgYS55IC09IGMueTsKCiAgcmV0dXJuIGMucjsKfQoKZnVuY3Rpb24gc2libGluZ3MoY2lyY2xlcykgewogIHBhY2tFbmNsb3NlKGNpcmNsZXMpOwogIHJldHVybiBjaXJjbGVzOwp9CgpmdW5jdGlvbiBvcHRpb25hbChmKSB7CiAgcmV0dXJuIGYgPT0gbnVsbCA/IG51bGwgOiByZXF1aXJlZChmKTsKfQoKZnVuY3Rpb24gcmVxdWlyZWQoZikgewogIGlmICh0eXBlb2YgZiAhPT0gImZ1bmN0aW9uIikgdGhyb3cgbmV3IEVycm9yOwogIHJldHVybiBmOwp9CgpmdW5jdGlvbiBjb25zdGFudFplcm8oKSB7CiAgcmV0dXJuIDA7Cn0KCmZ1bmN0aW9uIGNvbnN0YW50JDkoeCkgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB4OwogIH07Cn0KCmZ1bmN0aW9uIGRlZmF1bHRSYWRpdXMkMShkKSB7CiAgcmV0dXJuIE1hdGguc3FydChkLnZhbHVlKTsKfQoKZnVuY3Rpb24gaW5kZXgkMigpIHsKICB2YXIgcmFkaXVzID0gbnVsbCwKICAgICAgZHggPSAxLAogICAgICBkeSA9IDEsCiAgICAgIHBhZGRpbmcgPSBjb25zdGFudFplcm87CgogIGZ1bmN0aW9uIHBhY2socm9vdCkgewogICAgcm9vdC54ID0gZHggLyAyLCByb290LnkgPSBkeSAvIDI7CiAgICBpZiAocmFkaXVzKSB7CiAgICAgIHJvb3QuZWFjaEJlZm9yZShyYWRpdXNMZWFmKHJhZGl1cykpCiAgICAgICAgICAuZWFjaEFmdGVyKHBhY2tDaGlsZHJlbihwYWRkaW5nLCAwLjUpKQogICAgICAgICAgLmVhY2hCZWZvcmUodHJhbnNsYXRlQ2hpbGQoMSkpOwogICAgfSBlbHNlIHsKICAgICAgcm9vdC5lYWNoQmVmb3JlKHJhZGl1c0xlYWYoZGVmYXVsdFJhZGl1cyQxKSkKICAgICAgICAgIC5lYWNoQWZ0ZXIocGFja0NoaWxkcmVuKGNvbnN0YW50WmVybywgMSkpCiAgICAgICAgICAuZWFjaEFmdGVyKHBhY2tDaGlsZHJlbihwYWRkaW5nLCByb290LnIgLyBNYXRoLm1pbihkeCwgZHkpKSkKICAgICAgICAgIC5lYWNoQmVmb3JlKHRyYW5zbGF0ZUNoaWxkKE1hdGgubWluKGR4LCBkeSkgLyAoMiAqIHJvb3QucikpKTsKICAgIH0KICAgIHJldHVybiByb290OwogIH0KCiAgcGFjay5yYWRpdXMgPSBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChyYWRpdXMgPSBvcHRpb25hbCh4KSwgcGFjaykgOiByYWRpdXM7CiAgfTsKCiAgcGFjay5zaXplID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZHggPSAreFswXSwgZHkgPSAreFsxXSwgcGFjaykgOiBbZHgsIGR5XTsKICB9OwoKICBwYWNrLnBhZGRpbmcgPSBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChwYWRkaW5nID0gdHlwZW9mIHggPT09ICJmdW5jdGlvbiIgPyB4IDogY29uc3RhbnQkOSgreCksIHBhY2spIDogcGFkZGluZzsKICB9OwoKICByZXR1cm4gcGFjazsKfQoKZnVuY3Rpb24gcmFkaXVzTGVhZihyYWRpdXMpIHsKICByZXR1cm4gZnVuY3Rpb24obm9kZSkgewogICAgaWYgKCFub2RlLmNoaWxkcmVuKSB7CiAgICAgIG5vZGUuciA9IE1hdGgubWF4KDAsICtyYWRpdXMobm9kZSkgfHwgMCk7CiAgICB9CiAgfTsKfQoKZnVuY3Rpb24gcGFja0NoaWxkcmVuKHBhZGRpbmcsIGspIHsKICByZXR1cm4gZnVuY3Rpb24obm9kZSkgewogICAgaWYgKGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbikgewogICAgICB2YXIgY2hpbGRyZW4sCiAgICAgICAgICBpLAogICAgICAgICAgbiA9IGNoaWxkcmVuLmxlbmd0aCwKICAgICAgICAgIHIgPSBwYWRkaW5nKG5vZGUpICogayB8fCAwLAogICAgICAgICAgZTsKCiAgICAgIGlmIChyKSBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSBjaGlsZHJlbltpXS5yICs9IHI7CiAgICAgIGUgPSBwYWNrRW5jbG9zZShjaGlsZHJlbik7CiAgICAgIGlmIChyKSBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSBjaGlsZHJlbltpXS5yIC09IHI7CiAgICAgIG5vZGUuciA9IGUgKyByOwogICAgfQogIH07Cn0KCmZ1bmN0aW9uIHRyYW5zbGF0ZUNoaWxkKGspIHsKICByZXR1cm4gZnVuY3Rpb24obm9kZSkgewogICAgdmFyIHBhcmVudCA9IG5vZGUucGFyZW50OwogICAgbm9kZS5yICo9IGs7CiAgICBpZiAocGFyZW50KSB7CiAgICAgIG5vZGUueCA9IHBhcmVudC54ICsgayAqIG5vZGUueDsKICAgICAgbm9kZS55ID0gcGFyZW50LnkgKyBrICogbm9kZS55OwogICAgfQogIH07Cn0KCmZ1bmN0aW9uIHJvdW5kTm9kZShub2RlKSB7CiAgbm9kZS54MCA9IE1hdGgucm91bmQobm9kZS54MCk7CiAgbm9kZS55MCA9IE1hdGgucm91bmQobm9kZS55MCk7CiAgbm9kZS54MSA9IE1hdGgucm91bmQobm9kZS54MSk7CiAgbm9kZS55MSA9IE1hdGgucm91bmQobm9kZS55MSk7Cn0KCmZ1bmN0aW9uIHRyZWVtYXBEaWNlKHBhcmVudCwgeDAsIHkwLCB4MSwgeTEpIHsKICB2YXIgbm9kZXMgPSBwYXJlbnQuY2hpbGRyZW4sCiAgICAgIG5vZGUsCiAgICAgIGkgPSAtMSwKICAgICAgbiA9IG5vZGVzLmxlbmd0aCwKICAgICAgayA9IHBhcmVudC52YWx1ZSAmJiAoeDEgLSB4MCkgLyBwYXJlbnQudmFsdWU7CgogIHdoaWxlICgrK2kgPCBuKSB7CiAgICBub2RlID0gbm9kZXNbaV0sIG5vZGUueTAgPSB5MCwgbm9kZS55MSA9IHkxOwogICAgbm9kZS54MCA9IHgwLCBub2RlLngxID0geDAgKz0gbm9kZS52YWx1ZSAqIGs7CiAgfQp9CgpmdW5jdGlvbiBwYXJ0aXRpb24oKSB7CiAgdmFyIGR4ID0gMSwKICAgICAgZHkgPSAxLAogICAgICBwYWRkaW5nID0gMCwKICAgICAgcm91bmQgPSBmYWxzZTsKCiAgZnVuY3Rpb24gcGFydGl0aW9uKHJvb3QpIHsKICAgIHZhciBuID0gcm9vdC5oZWlnaHQgKyAxOwogICAgcm9vdC54MCA9CiAgICByb290LnkwID0gcGFkZGluZzsKICAgIHJvb3QueDEgPSBkeDsKICAgIHJvb3QueTEgPSBkeSAvIG47CiAgICByb290LmVhY2hCZWZvcmUocG9zaXRpb25Ob2RlKGR5LCBuKSk7CiAgICBpZiAocm91bmQpIHJvb3QuZWFjaEJlZm9yZShyb3VuZE5vZGUpOwogICAgcmV0dXJuIHJvb3Q7CiAgfQoKICBmdW5jdGlvbiBwb3NpdGlvbk5vZGUoZHksIG4pIHsKICAgIHJldHVybiBmdW5jdGlvbihub2RlKSB7CiAgICAgIGlmIChub2RlLmNoaWxkcmVuKSB7CiAgICAgICAgdHJlZW1hcERpY2Uobm9kZSwgbm9kZS54MCwgZHkgKiAobm9kZS5kZXB0aCArIDEpIC8gbiwgbm9kZS54MSwgZHkgKiAobm9kZS5kZXB0aCArIDIpIC8gbik7CiAgICAgIH0KICAgICAgdmFyIHgwID0gbm9kZS54MCwKICAgICAgICAgIHkwID0gbm9kZS55MCwKICAgICAgICAgIHgxID0gbm9kZS54MSAtIHBhZGRpbmcsCiAgICAgICAgICB5MSA9IG5vZGUueTEgLSBwYWRkaW5nOwogICAgICBpZiAoeDEgPCB4MCkgeDAgPSB4MSA9ICh4MCArIHgxKSAvIDI7CiAgICAgIGlmICh5MSA8IHkwKSB5MCA9IHkxID0gKHkwICsgeTEpIC8gMjsKICAgICAgbm9kZS54MCA9IHgwOwogICAgICBub2RlLnkwID0geTA7CiAgICAgIG5vZGUueDEgPSB4MTsKICAgICAgbm9kZS55MSA9IHkxOwogICAgfTsKICB9CgogIHBhcnRpdGlvbi5yb3VuZCA9IGZ1bmN0aW9uKHgpIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHJvdW5kID0gISF4LCBwYXJ0aXRpb24pIDogcm91bmQ7CiAgfTsKCiAgcGFydGl0aW9uLnNpemUgPSBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChkeCA9ICt4WzBdLCBkeSA9ICt4WzFdLCBwYXJ0aXRpb24pIDogW2R4LCBkeV07CiAgfTsKCiAgcGFydGl0aW9uLnBhZGRpbmcgPSBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChwYWRkaW5nID0gK3gsIHBhcnRpdGlvbikgOiBwYWRkaW5nOwogIH07CgogIHJldHVybiBwYXJ0aXRpb247Cn0KCnZhciBrZXlQcmVmaXgkMSA9ICIkIiwgLy8gUHJvdGVjdCBhZ2FpbnN0IGtleXMgbGlrZSDigJxfX3Byb3RvX1/igJ0uCiAgICBwcmVyb290ID0ge2RlcHRoOiAtMX0sCiAgICBhbWJpZ3VvdXMgPSB7fTsKCmZ1bmN0aW9uIGRlZmF1bHRJZChkKSB7CiAgcmV0dXJuIGQuaWQ7Cn0KCmZ1bmN0aW9uIGRlZmF1bHRQYXJlbnRJZChkKSB7CiAgcmV0dXJuIGQucGFyZW50SWQ7Cn0KCmZ1bmN0aW9uIHN0cmF0aWZ5KCkgewogIHZhciBpZCA9IGRlZmF1bHRJZCwKICAgICAgcGFyZW50SWQgPSBkZWZhdWx0UGFyZW50SWQ7CgogIGZ1bmN0aW9uIHN0cmF0aWZ5KGRhdGEpIHsKICAgIHZhciBkLAogICAgICAgIGksCiAgICAgICAgbiA9IGRhdGEubGVuZ3RoLAogICAgICAgIHJvb3QsCiAgICAgICAgcGFyZW50LAogICAgICAgIG5vZGUsCiAgICAgICAgbm9kZXMgPSBuZXcgQXJyYXkobiksCiAgICAgICAgbm9kZUlkLAogICAgICAgIG5vZGVLZXksCiAgICAgICAgbm9kZUJ5S2V5ID0ge307CgogICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICBkID0gZGF0YVtpXSwgbm9kZSA9IG5vZGVzW2ldID0gbmV3IE5vZGUoZCk7CiAgICAgIGlmICgobm9kZUlkID0gaWQoZCwgaSwgZGF0YSkpICE9IG51bGwgJiYgKG5vZGVJZCArPSAiIikpIHsKICAgICAgICBub2RlS2V5ID0ga2V5UHJlZml4JDEgKyAobm9kZS5pZCA9IG5vZGVJZCk7CiAgICAgICAgbm9kZUJ5S2V5W25vZGVLZXldID0gbm9kZUtleSBpbiBub2RlQnlLZXkgPyBhbWJpZ3VvdXMgOiBub2RlOwogICAgICB9CiAgICB9CgogICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICBub2RlID0gbm9kZXNbaV0sIG5vZGVJZCA9IHBhcmVudElkKGRhdGFbaV0sIGksIGRhdGEpOwogICAgICBpZiAobm9kZUlkID09IG51bGwgfHwgIShub2RlSWQgKz0gIiIpKSB7CiAgICAgICAgaWYgKHJvb3QpIHRocm93IG5ldyBFcnJvcigibXVsdGlwbGUgcm9vdHMiKTsKICAgICAgICByb290ID0gbm9kZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwYXJlbnQgPSBub2RlQnlLZXlba2V5UHJlZml4JDEgKyBub2RlSWRdOwogICAgICAgIGlmICghcGFyZW50KSB0aHJvdyBuZXcgRXJyb3IoIm1pc3Npbmc6ICIgKyBub2RlSWQpOwogICAgICAgIGlmIChwYXJlbnQgPT09IGFtYmlndW91cykgdGhyb3cgbmV3IEVycm9yKCJhbWJpZ3VvdXM6ICIgKyBub2RlSWQpOwogICAgICAgIGlmIChwYXJlbnQuY2hpbGRyZW4pIHBhcmVudC5jaGlsZHJlbi5wdXNoKG5vZGUpOwogICAgICAgIGVsc2UgcGFyZW50LmNoaWxkcmVuID0gW25vZGVdOwogICAgICAgIG5vZGUucGFyZW50ID0gcGFyZW50OwogICAgICB9CiAgICB9CgogICAgaWYgKCFyb290KSB0aHJvdyBuZXcgRXJyb3IoIm5vIHJvb3QiKTsKICAgIHJvb3QucGFyZW50ID0gcHJlcm9vdDsKICAgIHJvb3QuZWFjaEJlZm9yZShmdW5jdGlvbihub2RlKSB7IG5vZGUuZGVwdGggPSBub2RlLnBhcmVudC5kZXB0aCArIDE7IC0tbjsgfSkuZWFjaEJlZm9yZShjb21wdXRlSGVpZ2h0KTsKICAgIHJvb3QucGFyZW50ID0gbnVsbDsKICAgIGlmIChuID4gMCkgdGhyb3cgbmV3IEVycm9yKCJjeWNsZSIpOwoKICAgIHJldHVybiByb290OwogIH0KCiAgc3RyYXRpZnkuaWQgPSBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpZCA9IHJlcXVpcmVkKHgpLCBzdHJhdGlmeSkgOiBpZDsKICB9OwoKICBzdHJhdGlmeS5wYXJlbnRJZCA9IGZ1bmN0aW9uKHgpIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHBhcmVudElkID0gcmVxdWlyZWQoeCksIHN0cmF0aWZ5KSA6IHBhcmVudElkOwogIH07CgogIHJldHVybiBzdHJhdGlmeTsKfQoKZnVuY3Rpb24gZGVmYXVsdFNlcGFyYXRpb24kMShhLCBiKSB7CiAgcmV0dXJuIGEucGFyZW50ID09PSBiLnBhcmVudCA/IDEgOiAyOwp9CgovLyBmdW5jdGlvbiByYWRpYWxTZXBhcmF0aW9uKGEsIGIpIHsKLy8gICByZXR1cm4gKGEucGFyZW50ID09PSBiLnBhcmVudCA/IDEgOiAyKSAvIGEuZGVwdGg7Ci8vIH0KCi8vIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byB0cmF2ZXJzZSB0aGUgbGVmdCBjb250b3VyIG9mIGEgc3VidHJlZSAob3IKLy8gc3ViZm9yZXN0KS4gSXQgcmV0dXJucyB0aGUgc3VjY2Vzc29yIG9mIHYgb24gdGhpcyBjb250b3VyLiBUaGlzIHN1Y2Nlc3NvciBpcwovLyBlaXRoZXIgZ2l2ZW4gYnkgdGhlIGxlZnRtb3N0IGNoaWxkIG9mIHYgb3IgYnkgdGhlIHRocmVhZCBvZiB2LiBUaGUgZnVuY3Rpb24KLy8gcmV0dXJucyBudWxsIGlmIGFuZCBvbmx5IGlmIHYgaXMgb24gdGhlIGhpZ2hlc3QgbGV2ZWwgb2YgaXRzIHN1YnRyZWUuCmZ1bmN0aW9uIG5leHRMZWZ0KHYpIHsKICB2YXIgY2hpbGRyZW4gPSB2LmNoaWxkcmVuOwogIHJldHVybiBjaGlsZHJlbiA/IGNoaWxkcmVuWzBdIDogdi50Owp9CgovLyBUaGlzIGZ1bmN0aW9uIHdvcmtzIGFuYWxvZ291c2x5IHRvIG5leHRMZWZ0LgpmdW5jdGlvbiBuZXh0UmlnaHQodikgewogIHZhciBjaGlsZHJlbiA9IHYuY2hpbGRyZW47CiAgcmV0dXJuIGNoaWxkcmVuID8gY2hpbGRyZW5bY2hpbGRyZW4ubGVuZ3RoIC0gMV0gOiB2LnQ7Cn0KCi8vIFNoaWZ0cyB0aGUgY3VycmVudCBzdWJ0cmVlIHJvb3RlZCBhdCB3Ky4gVGhpcyBpcyBkb25lIGJ5IGluY3JlYXNpbmcKLy8gcHJlbGltKHcrKSBhbmQgbW9kKHcrKSBieSBzaGlmdC4KZnVuY3Rpb24gbW92ZVN1YnRyZWUod20sIHdwLCBzaGlmdCkgewogIHZhciBjaGFuZ2UgPSBzaGlmdCAvICh3cC5pIC0gd20uaSk7CiAgd3AuYyAtPSBjaGFuZ2U7CiAgd3AucyArPSBzaGlmdDsKICB3bS5jICs9IGNoYW5nZTsKICB3cC56ICs9IHNoaWZ0OwogIHdwLm0gKz0gc2hpZnQ7Cn0KCi8vIEFsbCBvdGhlciBzaGlmdHMsIGFwcGxpZWQgdG8gdGhlIHNtYWxsZXIgc3VidHJlZXMgYmV0d2VlbiB3LSBhbmQgdyssIGFyZQovLyBwZXJmb3JtZWQgYnkgdGhpcyBmdW5jdGlvbi4gVG8gcHJlcGFyZSB0aGUgc2hpZnRzLCB3ZSBoYXZlIHRvIGFkanVzdAovLyBjaGFuZ2UodyspLCBzaGlmdCh3KyksIGFuZCBjaGFuZ2Uody0pLgpmdW5jdGlvbiBleGVjdXRlU2hpZnRzKHYpIHsKICB2YXIgc2hpZnQgPSAwLAogICAgICBjaGFuZ2UgPSAwLAogICAgICBjaGlsZHJlbiA9IHYuY2hpbGRyZW4sCiAgICAgIGkgPSBjaGlsZHJlbi5sZW5ndGgsCiAgICAgIHc7CiAgd2hpbGUgKC0taSA+PSAwKSB7CiAgICB3ID0gY2hpbGRyZW5baV07CiAgICB3LnogKz0gc2hpZnQ7CiAgICB3Lm0gKz0gc2hpZnQ7CiAgICBzaGlmdCArPSB3LnMgKyAoY2hhbmdlICs9IHcuYyk7CiAgfQp9CgovLyBJZiB2aS3igJlzIGFuY2VzdG9yIGlzIGEgc2libGluZyBvZiB2LCByZXR1cm5zIHZpLeKAmXMgYW5jZXN0b3IuIE90aGVyd2lzZSwKLy8gcmV0dXJucyB0aGUgc3BlY2lmaWVkIChkZWZhdWx0KSBhbmNlc3Rvci4KZnVuY3Rpb24gbmV4dEFuY2VzdG9yKHZpbSwgdiwgYW5jZXN0b3IpIHsKICByZXR1cm4gdmltLmEucGFyZW50ID09PSB2LnBhcmVudCA/IHZpbS5hIDogYW5jZXN0b3I7Cn0KCmZ1bmN0aW9uIFRyZWVOb2RlKG5vZGUsIGkpIHsKICB0aGlzLl8gPSBub2RlOwogIHRoaXMucGFyZW50ID0gbnVsbDsKICB0aGlzLmNoaWxkcmVuID0gbnVsbDsKICB0aGlzLkEgPSBudWxsOyAvLyBkZWZhdWx0IGFuY2VzdG9yCiAgdGhpcy5hID0gdGhpczsgLy8gYW5jZXN0b3IKICB0aGlzLnogPSAwOyAvLyBwcmVsaW0KICB0aGlzLm0gPSAwOyAvLyBtb2QKICB0aGlzLmMgPSAwOyAvLyBjaGFuZ2UKICB0aGlzLnMgPSAwOyAvLyBzaGlmdAogIHRoaXMudCA9IG51bGw7IC8vIHRocmVhZAogIHRoaXMuaSA9IGk7IC8vIG51bWJlcgp9CgpUcmVlTm9kZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKE5vZGUucHJvdG90eXBlKTsKCmZ1bmN0aW9uIHRyZWVSb290KHJvb3QpIHsKICB2YXIgdHJlZSA9IG5ldyBUcmVlTm9kZShyb290LCAwKSwKICAgICAgbm9kZSwKICAgICAgbm9kZXMgPSBbdHJlZV0sCiAgICAgIGNoaWxkLAogICAgICBjaGlsZHJlbiwKICAgICAgaSwKICAgICAgbjsKCiAgd2hpbGUgKG5vZGUgPSBub2Rlcy5wb3AoKSkgewogICAgaWYgKGNoaWxkcmVuID0gbm9kZS5fLmNoaWxkcmVuKSB7CiAgICAgIG5vZGUuY2hpbGRyZW4gPSBuZXcgQXJyYXkobiA9IGNoaWxkcmVuLmxlbmd0aCk7CiAgICAgIGZvciAoaSA9IG4gLSAxOyBpID49IDA7IC0taSkgewogICAgICAgIG5vZGVzLnB1c2goY2hpbGQgPSBub2RlLmNoaWxkcmVuW2ldID0gbmV3IFRyZWVOb2RlKGNoaWxkcmVuW2ldLCBpKSk7CiAgICAgICAgY2hpbGQucGFyZW50ID0gbm9kZTsKICAgICAgfQogICAgfQogIH0KCiAgKHRyZWUucGFyZW50ID0gbmV3IFRyZWVOb2RlKG51bGwsIDApKS5jaGlsZHJlbiA9IFt0cmVlXTsKICByZXR1cm4gdHJlZTsKfQoKLy8gTm9kZS1saW5rIHRyZWUgZGlhZ3JhbSB1c2luZyB0aGUgUmVpbmdvbGQtVGlsZm9yZCAidGlkeSIgYWxnb3JpdGhtCmZ1bmN0aW9uIHRyZWUoKSB7CiAgdmFyIHNlcGFyYXRpb24gPSBkZWZhdWx0U2VwYXJhdGlvbiQxLAogICAgICBkeCA9IDEsCiAgICAgIGR5ID0gMSwKICAgICAgbm9kZVNpemUgPSBudWxsOwoKICBmdW5jdGlvbiB0cmVlKHJvb3QpIHsKICAgIHZhciB0ID0gdHJlZVJvb3Qocm9vdCk7CgogICAgLy8gQ29tcHV0ZSB0aGUgbGF5b3V0IHVzaW5nIEJ1Y2hoZWltIGV0IGFsLuKAmXMgYWxnb3JpdGhtLgogICAgdC5lYWNoQWZ0ZXIoZmlyc3RXYWxrKSwgdC5wYXJlbnQubSA9IC10Lno7CiAgICB0LmVhY2hCZWZvcmUoc2Vjb25kV2Fsayk7CgogICAgLy8gSWYgYSBmaXhlZCBub2RlIHNpemUgaXMgc3BlY2lmaWVkLCBzY2FsZSB4IGFuZCB5LgogICAgaWYgKG5vZGVTaXplKSByb290LmVhY2hCZWZvcmUoc2l6ZU5vZGUpOwoKICAgIC8vIElmIGEgZml4ZWQgdHJlZSBzaXplIGlzIHNwZWNpZmllZCwgc2NhbGUgeCBhbmQgeSBiYXNlZCBvbiB0aGUgZXh0ZW50LgogICAgLy8gQ29tcHV0ZSB0aGUgbGVmdC1tb3N0LCByaWdodC1tb3N0LCBhbmQgZGVwdGgtbW9zdCBub2RlcyBmb3IgZXh0ZW50cy4KICAgIGVsc2UgewogICAgICB2YXIgbGVmdCA9IHJvb3QsCiAgICAgICAgICByaWdodCA9IHJvb3QsCiAgICAgICAgICBib3R0b20gPSByb290OwogICAgICByb290LmVhY2hCZWZvcmUoZnVuY3Rpb24obm9kZSkgewogICAgICAgIGlmIChub2RlLnggPCBsZWZ0LngpIGxlZnQgPSBub2RlOwogICAgICAgIGlmIChub2RlLnggPiByaWdodC54KSByaWdodCA9IG5vZGU7CiAgICAgICAgaWYgKG5vZGUuZGVwdGggPiBib3R0b20uZGVwdGgpIGJvdHRvbSA9IG5vZGU7CiAgICAgIH0pOwogICAgICB2YXIgcyA9IGxlZnQgPT09IHJpZ2h0ID8gMSA6IHNlcGFyYXRpb24obGVmdCwgcmlnaHQpIC8gMiwKICAgICAgICAgIHR4ID0gcyAtIGxlZnQueCwKICAgICAgICAgIGt4ID0gZHggLyAocmlnaHQueCArIHMgKyB0eCksCiAgICAgICAgICBreSA9IGR5IC8gKGJvdHRvbS5kZXB0aCB8fCAxKTsKICAgICAgcm9vdC5lYWNoQmVmb3JlKGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICBub2RlLnggPSAobm9kZS54ICsgdHgpICoga3g7CiAgICAgICAgbm9kZS55ID0gbm9kZS5kZXB0aCAqIGt5OwogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gcm9vdDsKICB9CgogIC8vIENvbXB1dGVzIGEgcHJlbGltaW5hcnkgeC1jb29yZGluYXRlIGZvciB2LiBCZWZvcmUgdGhhdCwgRklSU1QgV0FMSyBpcwogIC8vIGFwcGxpZWQgcmVjdXJzaXZlbHkgdG8gdGhlIGNoaWxkcmVuIG9mIHYsIGFzIHdlbGwgYXMgdGhlIGZ1bmN0aW9uCiAgLy8gQVBQT1JUSU9OLiBBZnRlciBzcGFjaW5nIG91dCB0aGUgY2hpbGRyZW4gYnkgY2FsbGluZyBFWEVDVVRFIFNISUZUUywgdGhlCiAgLy8gbm9kZSB2IGlzIHBsYWNlZCB0byB0aGUgbWlkcG9pbnQgb2YgaXRzIG91dGVybW9zdCBjaGlsZHJlbi4KICBmdW5jdGlvbiBmaXJzdFdhbGsodikgewogICAgdmFyIGNoaWxkcmVuID0gdi5jaGlsZHJlbiwKICAgICAgICBzaWJsaW5ncyA9IHYucGFyZW50LmNoaWxkcmVuLAogICAgICAgIHcgPSB2LmkgPyBzaWJsaW5nc1t2LmkgLSAxXSA6IG51bGw7CiAgICBpZiAoY2hpbGRyZW4pIHsKICAgICAgZXhlY3V0ZVNoaWZ0cyh2KTsKICAgICAgdmFyIG1pZHBvaW50ID0gKGNoaWxkcmVuWzBdLnogKyBjaGlsZHJlbltjaGlsZHJlbi5sZW5ndGggLSAxXS56KSAvIDI7CiAgICAgIGlmICh3KSB7CiAgICAgICAgdi56ID0gdy56ICsgc2VwYXJhdGlvbih2Ll8sIHcuXyk7CiAgICAgICAgdi5tID0gdi56IC0gbWlkcG9pbnQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdi56ID0gbWlkcG9pbnQ7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAodykgewogICAgICB2LnogPSB3LnogKyBzZXBhcmF0aW9uKHYuXywgdy5fKTsKICAgIH0KICAgIHYucGFyZW50LkEgPSBhcHBvcnRpb24odiwgdywgdi5wYXJlbnQuQSB8fCBzaWJsaW5nc1swXSk7CiAgfQoKICAvLyBDb21wdXRlcyBhbGwgcmVhbCB4LWNvb3JkaW5hdGVzIGJ5IHN1bW1pbmcgdXAgdGhlIG1vZGlmaWVycyByZWN1cnNpdmVseS4KICBmdW5jdGlvbiBzZWNvbmRXYWxrKHYpIHsKICAgIHYuXy54ID0gdi56ICsgdi5wYXJlbnQubTsKICAgIHYubSArPSB2LnBhcmVudC5tOwogIH0KCiAgLy8gVGhlIGNvcmUgb2YgdGhlIGFsZ29yaXRobS4gSGVyZSwgYSBuZXcgc3VidHJlZSBpcyBjb21iaW5lZCB3aXRoIHRoZQogIC8vIHByZXZpb3VzIHN1YnRyZWVzLiBUaHJlYWRzIGFyZSB1c2VkIHRvIHRyYXZlcnNlIHRoZSBpbnNpZGUgYW5kIG91dHNpZGUKICAvLyBjb250b3VycyBvZiB0aGUgbGVmdCBhbmQgcmlnaHQgc3VidHJlZSB1cCB0byB0aGUgaGlnaGVzdCBjb21tb24gbGV2ZWwuIFRoZQogIC8vIHZlcnRpY2VzIHVzZWQgZm9yIHRoZSB0cmF2ZXJzYWxzIGFyZSB2aSssIHZpLSwgdm8tLCBhbmQgdm8rLCB3aGVyZSB0aGUKICAvLyBzdXBlcnNjcmlwdCBvIG1lYW5zIG91dHNpZGUgYW5kIGkgbWVhbnMgaW5zaWRlLCB0aGUgc3Vic2NyaXB0IC0gbWVhbnMgbGVmdAogIC8vIHN1YnRyZWUgYW5kICsgbWVhbnMgcmlnaHQgc3VidHJlZS4gRm9yIHN1bW1pbmcgdXAgdGhlIG1vZGlmaWVycyBhbG9uZyB0aGUKICAvLyBjb250b3VyLCB3ZSB1c2UgcmVzcGVjdGl2ZSB2YXJpYWJsZXMgc2krLCBzaS0sIHNvLSwgYW5kIHNvKy4gV2hlbmV2ZXIgdHdvCiAgLy8gbm9kZXMgb2YgdGhlIGluc2lkZSBjb250b3VycyBjb25mbGljdCwgd2UgY29tcHV0ZSB0aGUgbGVmdCBvbmUgb2YgdGhlCiAgLy8gZ3JlYXRlc3QgdW5jb21tb24gYW5jZXN0b3JzIHVzaW5nIHRoZSBmdW5jdGlvbiBBTkNFU1RPUiBhbmQgY2FsbCBNT1ZFCiAgLy8gU1VCVFJFRSB0byBzaGlmdCB0aGUgc3VidHJlZSBhbmQgcHJlcGFyZSB0aGUgc2hpZnRzIG9mIHNtYWxsZXIgc3VidHJlZXMuCiAgLy8gRmluYWxseSwgd2UgYWRkIGEgbmV3IHRocmVhZCAoaWYgbmVjZXNzYXJ5KS4KICBmdW5jdGlvbiBhcHBvcnRpb24odiwgdywgYW5jZXN0b3IpIHsKICAgIGlmICh3KSB7CiAgICAgIHZhciB2aXAgPSB2LAogICAgICAgICAgdm9wID0gdiwKICAgICAgICAgIHZpbSA9IHcsCiAgICAgICAgICB2b20gPSB2aXAucGFyZW50LmNoaWxkcmVuWzBdLAogICAgICAgICAgc2lwID0gdmlwLm0sCiAgICAgICAgICBzb3AgPSB2b3AubSwKICAgICAgICAgIHNpbSA9IHZpbS5tLAogICAgICAgICAgc29tID0gdm9tLm0sCiAgICAgICAgICBzaGlmdDsKICAgICAgd2hpbGUgKHZpbSA9IG5leHRSaWdodCh2aW0pLCB2aXAgPSBuZXh0TGVmdCh2aXApLCB2aW0gJiYgdmlwKSB7CiAgICAgICAgdm9tID0gbmV4dExlZnQodm9tKTsKICAgICAgICB2b3AgPSBuZXh0UmlnaHQodm9wKTsKICAgICAgICB2b3AuYSA9IHY7CiAgICAgICAgc2hpZnQgPSB2aW0ueiArIHNpbSAtIHZpcC56IC0gc2lwICsgc2VwYXJhdGlvbih2aW0uXywgdmlwLl8pOwogICAgICAgIGlmIChzaGlmdCA+IDApIHsKICAgICAgICAgIG1vdmVTdWJ0cmVlKG5leHRBbmNlc3Rvcih2aW0sIHYsIGFuY2VzdG9yKSwgdiwgc2hpZnQpOwogICAgICAgICAgc2lwICs9IHNoaWZ0OwogICAgICAgICAgc29wICs9IHNoaWZ0OwogICAgICAgIH0KICAgICAgICBzaW0gKz0gdmltLm07CiAgICAgICAgc2lwICs9IHZpcC5tOwogICAgICAgIHNvbSArPSB2b20ubTsKICAgICAgICBzb3AgKz0gdm9wLm07CiAgICAgIH0KICAgICAgaWYgKHZpbSAmJiAhbmV4dFJpZ2h0KHZvcCkpIHsKICAgICAgICB2b3AudCA9IHZpbTsKICAgICAgICB2b3AubSArPSBzaW0gLSBzb3A7CiAgICAgIH0KICAgICAgaWYgKHZpcCAmJiAhbmV4dExlZnQodm9tKSkgewogICAgICAgIHZvbS50ID0gdmlwOwogICAgICAgIHZvbS5tICs9IHNpcCAtIHNvbTsKICAgICAgICBhbmNlc3RvciA9IHY7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhbmNlc3RvcjsKICB9CgogIGZ1bmN0aW9uIHNpemVOb2RlKG5vZGUpIHsKICAgIG5vZGUueCAqPSBkeDsKICAgIG5vZGUueSA9IG5vZGUuZGVwdGggKiBkeTsKICB9CgogIHRyZWUuc2VwYXJhdGlvbiA9IGZ1bmN0aW9uKHgpIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHNlcGFyYXRpb24gPSB4LCB0cmVlKSA6IHNlcGFyYXRpb247CiAgfTsKCiAgdHJlZS5zaXplID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobm9kZVNpemUgPSBmYWxzZSwgZHggPSAreFswXSwgZHkgPSAreFsxXSwgdHJlZSkgOiAobm9kZVNpemUgPyBudWxsIDogW2R4LCBkeV0pOwogIH07CgogIHRyZWUubm9kZVNpemUgPSBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChub2RlU2l6ZSA9IHRydWUsIGR4ID0gK3hbMF0sIGR5ID0gK3hbMV0sIHRyZWUpIDogKG5vZGVTaXplID8gW2R4LCBkeV0gOiBudWxsKTsKICB9OwoKICByZXR1cm4gdHJlZTsKfQoKZnVuY3Rpb24gdHJlZW1hcFNsaWNlKHBhcmVudCwgeDAsIHkwLCB4MSwgeTEpIHsKICB2YXIgbm9kZXMgPSBwYXJlbnQuY2hpbGRyZW4sCiAgICAgIG5vZGUsCiAgICAgIGkgPSAtMSwKICAgICAgbiA9IG5vZGVzLmxlbmd0aCwKICAgICAgayA9IHBhcmVudC52YWx1ZSAmJiAoeTEgLSB5MCkgLyBwYXJlbnQudmFsdWU7CgogIHdoaWxlICgrK2kgPCBuKSB7CiAgICBub2RlID0gbm9kZXNbaV0sIG5vZGUueDAgPSB4MCwgbm9kZS54MSA9IHgxOwogICAgbm9kZS55MCA9IHkwLCBub2RlLnkxID0geTAgKz0gbm9kZS52YWx1ZSAqIGs7CiAgfQp9Cgp2YXIgcGhpID0gKDEgKyBNYXRoLnNxcnQoNSkpIC8gMjsKCmZ1bmN0aW9uIHNxdWFyaWZ5UmF0aW8ocmF0aW8sIHBhcmVudCwgeDAsIHkwLCB4MSwgeTEpIHsKICB2YXIgcm93cyA9IFtdLAogICAgICBub2RlcyA9IHBhcmVudC5jaGlsZHJlbiwKICAgICAgcm93LAogICAgICBub2RlVmFsdWUsCiAgICAgIGkwID0gMCwKICAgICAgaTEgPSAwLAogICAgICBuID0gbm9kZXMubGVuZ3RoLAogICAgICBkeCwgZHksCiAgICAgIHZhbHVlID0gcGFyZW50LnZhbHVlLAogICAgICBzdW1WYWx1ZSwKICAgICAgbWluVmFsdWUsCiAgICAgIG1heFZhbHVlLAogICAgICBuZXdSYXRpbywKICAgICAgbWluUmF0aW8sCiAgICAgIGFscGhhLAogICAgICBiZXRhOwoKICB3aGlsZSAoaTAgPCBuKSB7CiAgICBkeCA9IHgxIC0geDAsIGR5ID0geTEgLSB5MDsKCiAgICAvLyBGaW5kIHRoZSBuZXh0IG5vbi1lbXB0eSBub2RlLgogICAgZG8gc3VtVmFsdWUgPSBub2Rlc1tpMSsrXS52YWx1ZTsgd2hpbGUgKCFzdW1WYWx1ZSAmJiBpMSA8IG4pOwogICAgbWluVmFsdWUgPSBtYXhWYWx1ZSA9IHN1bVZhbHVlOwogICAgYWxwaGEgPSBNYXRoLm1heChkeSAvIGR4LCBkeCAvIGR5KSAvICh2YWx1ZSAqIHJhdGlvKTsKICAgIGJldGEgPSBzdW1WYWx1ZSAqIHN1bVZhbHVlICogYWxwaGE7CiAgICBtaW5SYXRpbyA9IE1hdGgubWF4KG1heFZhbHVlIC8gYmV0YSwgYmV0YSAvIG1pblZhbHVlKTsKCiAgICAvLyBLZWVwIGFkZGluZyBub2RlcyB3aGlsZSB0aGUgYXNwZWN0IHJhdGlvIG1haW50YWlucyBvciBpbXByb3Zlcy4KICAgIGZvciAoOyBpMSA8IG47ICsraTEpIHsKICAgICAgc3VtVmFsdWUgKz0gbm9kZVZhbHVlID0gbm9kZXNbaTFdLnZhbHVlOwogICAgICBpZiAobm9kZVZhbHVlIDwgbWluVmFsdWUpIG1pblZhbHVlID0gbm9kZVZhbHVlOwogICAgICBpZiAobm9kZVZhbHVlID4gbWF4VmFsdWUpIG1heFZhbHVlID0gbm9kZVZhbHVlOwogICAgICBiZXRhID0gc3VtVmFsdWUgKiBzdW1WYWx1ZSAqIGFscGhhOwogICAgICBuZXdSYXRpbyA9IE1hdGgubWF4KG1heFZhbHVlIC8gYmV0YSwgYmV0YSAvIG1pblZhbHVlKTsKICAgICAgaWYgKG5ld1JhdGlvID4gbWluUmF0aW8pIHsgc3VtVmFsdWUgLT0gbm9kZVZhbHVlOyBicmVhazsgfQogICAgICBtaW5SYXRpbyA9IG5ld1JhdGlvOwogICAgfQoKICAgIC8vIFBvc2l0aW9uIGFuZCByZWNvcmQgdGhlIHJvdyBvcmllbnRhdGlvbi4KICAgIHJvd3MucHVzaChyb3cgPSB7dmFsdWU6IHN1bVZhbHVlLCBkaWNlOiBkeCA8IGR5LCBjaGlsZHJlbjogbm9kZXMuc2xpY2UoaTAsIGkxKX0pOwogICAgaWYgKHJvdy5kaWNlKSB0cmVlbWFwRGljZShyb3csIHgwLCB5MCwgeDEsIHZhbHVlID8geTAgKz0gZHkgKiBzdW1WYWx1ZSAvIHZhbHVlIDogeTEpOwogICAgZWxzZSB0cmVlbWFwU2xpY2Uocm93LCB4MCwgeTAsIHZhbHVlID8geDAgKz0gZHggKiBzdW1WYWx1ZSAvIHZhbHVlIDogeDEsIHkxKTsKICAgIHZhbHVlIC09IHN1bVZhbHVlLCBpMCA9IGkxOwogIH0KCiAgcmV0dXJuIHJvd3M7Cn0KCnZhciBzcXVhcmlmeSA9IChmdW5jdGlvbiBjdXN0b20ocmF0aW8pIHsKCiAgZnVuY3Rpb24gc3F1YXJpZnkocGFyZW50LCB4MCwgeTAsIHgxLCB5MSkgewogICAgc3F1YXJpZnlSYXRpbyhyYXRpbywgcGFyZW50LCB4MCwgeTAsIHgxLCB5MSk7CiAgfQoKICBzcXVhcmlmeS5yYXRpbyA9IGZ1bmN0aW9uKHgpIHsKICAgIHJldHVybiBjdXN0b20oKHggPSAreCkgPiAxID8geCA6IDEpOwogIH07CgogIHJldHVybiBzcXVhcmlmeTsKfSkocGhpKTsKCmZ1bmN0aW9uIGluZGV4JDMoKSB7CiAgdmFyIHRpbGUgPSBzcXVhcmlmeSwKICAgICAgcm91bmQgPSBmYWxzZSwKICAgICAgZHggPSAxLAogICAgICBkeSA9IDEsCiAgICAgIHBhZGRpbmdTdGFjayA9IFswXSwKICAgICAgcGFkZGluZ0lubmVyID0gY29uc3RhbnRaZXJvLAogICAgICBwYWRkaW5nVG9wID0gY29uc3RhbnRaZXJvLAogICAgICBwYWRkaW5nUmlnaHQgPSBjb25zdGFudFplcm8sCiAgICAgIHBhZGRpbmdCb3R0b20gPSBjb25zdGFudFplcm8sCiAgICAgIHBhZGRpbmdMZWZ0ID0gY29uc3RhbnRaZXJvOwoKICBmdW5jdGlvbiB0cmVlbWFwKHJvb3QpIHsKICAgIHJvb3QueDAgPQogICAgcm9vdC55MCA9IDA7CiAgICByb290LngxID0gZHg7CiAgICByb290LnkxID0gZHk7CiAgICByb290LmVhY2hCZWZvcmUocG9zaXRpb25Ob2RlKTsKICAgIHBhZGRpbmdTdGFjayA9IFswXTsKICAgIGlmIChyb3VuZCkgcm9vdC5lYWNoQmVmb3JlKHJvdW5kTm9kZSk7CiAgICByZXR1cm4gcm9vdDsKICB9CgogIGZ1bmN0aW9uIHBvc2l0aW9uTm9kZShub2RlKSB7CiAgICB2YXIgcCA9IHBhZGRpbmdTdGFja1tub2RlLmRlcHRoXSwKICAgICAgICB4MCA9IG5vZGUueDAgKyBwLAogICAgICAgIHkwID0gbm9kZS55MCArIHAsCiAgICAgICAgeDEgPSBub2RlLngxIC0gcCwKICAgICAgICB5MSA9IG5vZGUueTEgLSBwOwogICAgaWYgKHgxIDwgeDApIHgwID0geDEgPSAoeDAgKyB4MSkgLyAyOwogICAgaWYgKHkxIDwgeTApIHkwID0geTEgPSAoeTAgKyB5MSkgLyAyOwogICAgbm9kZS54MCA9IHgwOwogICAgbm9kZS55MCA9IHkwOwogICAgbm9kZS54MSA9IHgxOwogICAgbm9kZS55MSA9IHkxOwogICAgaWYgKG5vZGUuY2hpbGRyZW4pIHsKICAgICAgcCA9IHBhZGRpbmdTdGFja1tub2RlLmRlcHRoICsgMV0gPSBwYWRkaW5nSW5uZXIobm9kZSkgLyAyOwogICAgICB4MCArPSBwYWRkaW5nTGVmdChub2RlKSAtIHA7CiAgICAgIHkwICs9IHBhZGRpbmdUb3Aobm9kZSkgLSBwOwogICAgICB4MSAtPSBwYWRkaW5nUmlnaHQobm9kZSkgLSBwOwogICAgICB5MSAtPSBwYWRkaW5nQm90dG9tKG5vZGUpIC0gcDsKICAgICAgaWYgKHgxIDwgeDApIHgwID0geDEgPSAoeDAgKyB4MSkgLyAyOwogICAgICBpZiAoeTEgPCB5MCkgeTAgPSB5MSA9ICh5MCArIHkxKSAvIDI7CiAgICAgIHRpbGUobm9kZSwgeDAsIHkwLCB4MSwgeTEpOwogICAgfQogIH0KCiAgdHJlZW1hcC5yb3VuZCA9IGZ1bmN0aW9uKHgpIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHJvdW5kID0gISF4LCB0cmVlbWFwKSA6IHJvdW5kOwogIH07CgogIHRyZWVtYXAuc2l6ZSA9IGZ1bmN0aW9uKHgpIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGR4ID0gK3hbMF0sIGR5ID0gK3hbMV0sIHRyZWVtYXApIDogW2R4LCBkeV07CiAgfTsKCiAgdHJlZW1hcC50aWxlID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodGlsZSA9IHJlcXVpcmVkKHgpLCB0cmVlbWFwKSA6IHRpbGU7CiAgfTsKCiAgdHJlZW1hcC5wYWRkaW5nID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyB0cmVlbWFwLnBhZGRpbmdJbm5lcih4KS5wYWRkaW5nT3V0ZXIoeCkgOiB0cmVlbWFwLnBhZGRpbmdJbm5lcigpOwogIH07CgogIHRyZWVtYXAucGFkZGluZ0lubmVyID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocGFkZGluZ0lubmVyID0gdHlwZW9mIHggPT09ICJmdW5jdGlvbiIgPyB4IDogY29uc3RhbnQkOSgreCksIHRyZWVtYXApIDogcGFkZGluZ0lubmVyOwogIH07CgogIHRyZWVtYXAucGFkZGluZ091dGVyID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyB0cmVlbWFwLnBhZGRpbmdUb3AoeCkucGFkZGluZ1JpZ2h0KHgpLnBhZGRpbmdCb3R0b20oeCkucGFkZGluZ0xlZnQoeCkgOiB0cmVlbWFwLnBhZGRpbmdUb3AoKTsKICB9OwoKICB0cmVlbWFwLnBhZGRpbmdUb3AgPSBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChwYWRkaW5nVG9wID0gdHlwZW9mIHggPT09ICJmdW5jdGlvbiIgPyB4IDogY29uc3RhbnQkOSgreCksIHRyZWVtYXApIDogcGFkZGluZ1RvcDsKICB9OwoKICB0cmVlbWFwLnBhZGRpbmdSaWdodCA9IGZ1bmN0aW9uKHgpIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHBhZGRpbmdSaWdodCA9IHR5cGVvZiB4ID09PSAiZnVuY3Rpb24iID8geCA6IGNvbnN0YW50JDkoK3gpLCB0cmVlbWFwKSA6IHBhZGRpbmdSaWdodDsKICB9OwoKICB0cmVlbWFwLnBhZGRpbmdCb3R0b20gPSBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChwYWRkaW5nQm90dG9tID0gdHlwZW9mIHggPT09ICJmdW5jdGlvbiIgPyB4IDogY29uc3RhbnQkOSgreCksIHRyZWVtYXApIDogcGFkZGluZ0JvdHRvbTsKICB9OwoKICB0cmVlbWFwLnBhZGRpbmdMZWZ0ID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocGFkZGluZ0xlZnQgPSB0eXBlb2YgeCA9PT0gImZ1bmN0aW9uIiA/IHggOiBjb25zdGFudCQ5KCt4KSwgdHJlZW1hcCkgOiBwYWRkaW5nTGVmdDsKICB9OwoKICByZXR1cm4gdHJlZW1hcDsKfQoKZnVuY3Rpb24gYmluYXJ5KHBhcmVudCwgeDAsIHkwLCB4MSwgeTEpIHsKICB2YXIgbm9kZXMgPSBwYXJlbnQuY2hpbGRyZW4sCiAgICAgIGksIG4gPSBub2Rlcy5sZW5ndGgsCiAgICAgIHN1bSwgc3VtcyA9IG5ldyBBcnJheShuICsgMSk7CgogIGZvciAoc3Vtc1swXSA9IHN1bSA9IGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICBzdW1zW2kgKyAxXSA9IHN1bSArPSBub2Rlc1tpXS52YWx1ZTsKICB9CgogIHBhcnRpdGlvbigwLCBuLCBwYXJlbnQudmFsdWUsIHgwLCB5MCwgeDEsIHkxKTsKCiAgZnVuY3Rpb24gcGFydGl0aW9uKGksIGosIHZhbHVlLCB4MCwgeTAsIHgxLCB5MSkgewogICAgaWYgKGkgPj0gaiAtIDEpIHsKICAgICAgdmFyIG5vZGUgPSBub2Rlc1tpXTsKICAgICAgbm9kZS54MCA9IHgwLCBub2RlLnkwID0geTA7CiAgICAgIG5vZGUueDEgPSB4MSwgbm9kZS55MSA9IHkxOwogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIHZhbHVlT2Zmc2V0ID0gc3Vtc1tpXSwKICAgICAgICB2YWx1ZVRhcmdldCA9ICh2YWx1ZSAvIDIpICsgdmFsdWVPZmZzZXQsCiAgICAgICAgayA9IGkgKyAxLAogICAgICAgIGhpID0gaiAtIDE7CgogICAgd2hpbGUgKGsgPCBoaSkgewogICAgICB2YXIgbWlkID0gayArIGhpID4+PiAxOwogICAgICBpZiAoc3Vtc1ttaWRdIDwgdmFsdWVUYXJnZXQpIGsgPSBtaWQgKyAxOwogICAgICBlbHNlIGhpID0gbWlkOwogICAgfQoKICAgIGlmICgodmFsdWVUYXJnZXQgLSBzdW1zW2sgLSAxXSkgPCAoc3Vtc1trXSAtIHZhbHVlVGFyZ2V0KSAmJiBpICsgMSA8IGspIC0tazsKCiAgICB2YXIgdmFsdWVMZWZ0ID0gc3Vtc1trXSAtIHZhbHVlT2Zmc2V0LAogICAgICAgIHZhbHVlUmlnaHQgPSB2YWx1ZSAtIHZhbHVlTGVmdDsKCiAgICBpZiAoKHgxIC0geDApID4gKHkxIC0geTApKSB7CiAgICAgIHZhciB4ayA9ICh4MCAqIHZhbHVlUmlnaHQgKyB4MSAqIHZhbHVlTGVmdCkgLyB2YWx1ZTsKICAgICAgcGFydGl0aW9uKGksIGssIHZhbHVlTGVmdCwgeDAsIHkwLCB4aywgeTEpOwogICAgICBwYXJ0aXRpb24oaywgaiwgdmFsdWVSaWdodCwgeGssIHkwLCB4MSwgeTEpOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHlrID0gKHkwICogdmFsdWVSaWdodCArIHkxICogdmFsdWVMZWZ0KSAvIHZhbHVlOwogICAgICBwYXJ0aXRpb24oaSwgaywgdmFsdWVMZWZ0LCB4MCwgeTAsIHgxLCB5ayk7CiAgICAgIHBhcnRpdGlvbihrLCBqLCB2YWx1ZVJpZ2h0LCB4MCwgeWssIHgxLCB5MSk7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBzbGljZURpY2UocGFyZW50LCB4MCwgeTAsIHgxLCB5MSkgewogIChwYXJlbnQuZGVwdGggJiAxID8gdHJlZW1hcFNsaWNlIDogdHJlZW1hcERpY2UpKHBhcmVudCwgeDAsIHkwLCB4MSwgeTEpOwp9Cgp2YXIgcmVzcXVhcmlmeSA9IChmdW5jdGlvbiBjdXN0b20ocmF0aW8pIHsKCiAgZnVuY3Rpb24gcmVzcXVhcmlmeShwYXJlbnQsIHgwLCB5MCwgeDEsIHkxKSB7CiAgICBpZiAoKHJvd3MgPSBwYXJlbnQuX3NxdWFyaWZ5KSAmJiAocm93cy5yYXRpbyA9PT0gcmF0aW8pKSB7CiAgICAgIHZhciByb3dzLAogICAgICAgICAgcm93LAogICAgICAgICAgbm9kZXMsCiAgICAgICAgICBpLAogICAgICAgICAgaiA9IC0xLAogICAgICAgICAgbiwKICAgICAgICAgIG0gPSByb3dzLmxlbmd0aCwKICAgICAgICAgIHZhbHVlID0gcGFyZW50LnZhbHVlOwoKICAgICAgd2hpbGUgKCsraiA8IG0pIHsKICAgICAgICByb3cgPSByb3dzW2pdLCBub2RlcyA9IHJvdy5jaGlsZHJlbjsKICAgICAgICBmb3IgKGkgPSByb3cudmFsdWUgPSAwLCBuID0gbm9kZXMubGVuZ3RoOyBpIDwgbjsgKytpKSByb3cudmFsdWUgKz0gbm9kZXNbaV0udmFsdWU7CiAgICAgICAgaWYgKHJvdy5kaWNlKSB0cmVlbWFwRGljZShyb3csIHgwLCB5MCwgeDEsIHkwICs9ICh5MSAtIHkwKSAqIHJvdy52YWx1ZSAvIHZhbHVlKTsKICAgICAgICBlbHNlIHRyZWVtYXBTbGljZShyb3csIHgwLCB5MCwgeDAgKz0gKHgxIC0geDApICogcm93LnZhbHVlIC8gdmFsdWUsIHkxKTsKICAgICAgICB2YWx1ZSAtPSByb3cudmFsdWU7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHBhcmVudC5fc3F1YXJpZnkgPSByb3dzID0gc3F1YXJpZnlSYXRpbyhyYXRpbywgcGFyZW50LCB4MCwgeTAsIHgxLCB5MSk7CiAgICAgIHJvd3MucmF0aW8gPSByYXRpbzsKICAgIH0KICB9CgogIHJlc3F1YXJpZnkucmF0aW8gPSBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4gY3VzdG9tKCh4ID0gK3gpID4gMSA/IHggOiAxKTsKICB9OwoKICByZXR1cm4gcmVzcXVhcmlmeTsKfSkocGhpKTsKCmZ1bmN0aW9uIGFyZWEkMihwb2x5Z29uKSB7CiAgdmFyIGkgPSAtMSwKICAgICAgbiA9IHBvbHlnb24ubGVuZ3RoLAogICAgICBhLAogICAgICBiID0gcG9seWdvbltuIC0gMV0sCiAgICAgIGFyZWEgPSAwOwoKICB3aGlsZSAoKytpIDwgbikgewogICAgYSA9IGI7CiAgICBiID0gcG9seWdvbltpXTsKICAgIGFyZWEgKz0gYVsxXSAqIGJbMF0gLSBhWzBdICogYlsxXTsKICB9CgogIHJldHVybiBhcmVhIC8gMjsKfQoKZnVuY3Rpb24gY2VudHJvaWQkMShwb2x5Z29uKSB7CiAgdmFyIGkgPSAtMSwKICAgICAgbiA9IHBvbHlnb24ubGVuZ3RoLAogICAgICB4ID0gMCwKICAgICAgeSA9IDAsCiAgICAgIGEsCiAgICAgIGIgPSBwb2x5Z29uW24gLSAxXSwKICAgICAgYywKICAgICAgayA9IDA7CgogIHdoaWxlICgrK2kgPCBuKSB7CiAgICBhID0gYjsKICAgIGIgPSBwb2x5Z29uW2ldOwogICAgayArPSBjID0gYVswXSAqIGJbMV0gLSBiWzBdICogYVsxXTsKICAgIHggKz0gKGFbMF0gKyBiWzBdKSAqIGM7CiAgICB5ICs9IChhWzFdICsgYlsxXSkgKiBjOwogIH0KCiAgcmV0dXJuIGsgKj0gMywgW3ggLyBrLCB5IC8ga107Cn0KCi8vIFJldHVybnMgdGhlIDJEIGNyb3NzIHByb2R1Y3Qgb2YgQUIgYW5kIEFDIHZlY3RvcnMsIGkuZS4sIHRoZSB6LWNvbXBvbmVudCBvZgovLyB0aGUgM0QgY3Jvc3MgcHJvZHVjdCBpbiBhIHF1YWRyYW50IEkgQ2FydGVzaWFuIGNvb3JkaW5hdGUgc3lzdGVtICgreCBpcwovLyByaWdodCwgK3kgaXMgdXApLiBSZXR1cm5zIGEgcG9zaXRpdmUgdmFsdWUgaWYgQUJDIGlzIGNvdW50ZXItY2xvY2t3aXNlLAovLyBuZWdhdGl2ZSBpZiBjbG9ja3dpc2UsIGFuZCB6ZXJvIGlmIHRoZSBwb2ludHMgYXJlIGNvbGxpbmVhci4KZnVuY3Rpb24gY3Jvc3MkMShhLCBiLCBjKSB7CiAgcmV0dXJuIChiWzBdIC0gYVswXSkgKiAoY1sxXSAtIGFbMV0pIC0gKGJbMV0gLSBhWzFdKSAqIChjWzBdIC0gYVswXSk7Cn0KCmZ1bmN0aW9uIGxleGljb2dyYXBoaWNPcmRlcihhLCBiKSB7CiAgcmV0dXJuIGFbMF0gLSBiWzBdIHx8IGFbMV0gLSBiWzFdOwp9CgovLyBDb21wdXRlcyB0aGUgdXBwZXIgY29udmV4IGh1bGwgcGVyIHRoZSBtb25vdG9uZSBjaGFpbiBhbGdvcml0aG0uCi8vIEFzc3VtZXMgcG9pbnRzLmxlbmd0aCA+PSAzLCBpcyBzb3J0ZWQgYnkgeCwgdW5pcXVlIGluIHkuCi8vIFJldHVybnMgYW4gYXJyYXkgb2YgaW5kaWNlcyBpbnRvIHBvaW50cyBpbiBsZWZ0LXRvLXJpZ2h0IG9yZGVyLgpmdW5jdGlvbiBjb21wdXRlVXBwZXJIdWxsSW5kZXhlcyhwb2ludHMpIHsKICB2YXIgbiA9IHBvaW50cy5sZW5ndGgsCiAgICAgIGluZGV4ZXMgPSBbMCwgMV0sCiAgICAgIHNpemUgPSAyOwoKICBmb3IgKHZhciBpID0gMjsgaSA8IG47ICsraSkgewogICAgd2hpbGUgKHNpemUgPiAxICYmIGNyb3NzJDEocG9pbnRzW2luZGV4ZXNbc2l6ZSAtIDJdXSwgcG9pbnRzW2luZGV4ZXNbc2l6ZSAtIDFdXSwgcG9pbnRzW2ldKSA8PSAwKSAtLXNpemU7CiAgICBpbmRleGVzW3NpemUrK10gPSBpOwogIH0KCiAgcmV0dXJuIGluZGV4ZXMuc2xpY2UoMCwgc2l6ZSk7IC8vIHJlbW92ZSBwb3BwZWQgcG9pbnRzCn0KCmZ1bmN0aW9uIGh1bGwocG9pbnRzKSB7CiAgaWYgKChuID0gcG9pbnRzLmxlbmd0aCkgPCAzKSByZXR1cm4gbnVsbDsKCiAgdmFyIGksCiAgICAgIG4sCiAgICAgIHNvcnRlZFBvaW50cyA9IG5ldyBBcnJheShuKSwKICAgICAgZmxpcHBlZFBvaW50cyA9IG5ldyBBcnJheShuKTsKCiAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgc29ydGVkUG9pbnRzW2ldID0gWytwb2ludHNbaV1bMF0sICtwb2ludHNbaV1bMV0sIGldOwogIHNvcnRlZFBvaW50cy5zb3J0KGxleGljb2dyYXBoaWNPcmRlcik7CiAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgZmxpcHBlZFBvaW50c1tpXSA9IFtzb3J0ZWRQb2ludHNbaV1bMF0sIC1zb3J0ZWRQb2ludHNbaV1bMV1dOwoKICB2YXIgdXBwZXJJbmRleGVzID0gY29tcHV0ZVVwcGVySHVsbEluZGV4ZXMoc29ydGVkUG9pbnRzKSwKICAgICAgbG93ZXJJbmRleGVzID0gY29tcHV0ZVVwcGVySHVsbEluZGV4ZXMoZmxpcHBlZFBvaW50cyk7CgogIC8vIENvbnN0cnVjdCB0aGUgaHVsbCBwb2x5Z29uLCByZW1vdmluZyBwb3NzaWJsZSBkdXBsaWNhdGUgZW5kcG9pbnRzLgogIHZhciBza2lwTGVmdCA9IGxvd2VySW5kZXhlc1swXSA9PT0gdXBwZXJJbmRleGVzWzBdLAogICAgICBza2lwUmlnaHQgPSBsb3dlckluZGV4ZXNbbG93ZXJJbmRleGVzLmxlbmd0aCAtIDFdID09PSB1cHBlckluZGV4ZXNbdXBwZXJJbmRleGVzLmxlbmd0aCAtIDFdLAogICAgICBodWxsID0gW107CgogIC8vIEFkZCB1cHBlciBodWxsIGluIHJpZ2h0LXRvLWwgb3JkZXIuCiAgLy8gVGhlbiBhZGQgbG93ZXIgaHVsbCBpbiBsZWZ0LXRvLXJpZ2h0IG9yZGVyLgogIGZvciAoaSA9IHVwcGVySW5kZXhlcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgaHVsbC5wdXNoKHBvaW50c1tzb3J0ZWRQb2ludHNbdXBwZXJJbmRleGVzW2ldXVsyXV0pOwogIGZvciAoaSA9ICtza2lwTGVmdDsgaSA8IGxvd2VySW5kZXhlcy5sZW5ndGggLSBza2lwUmlnaHQ7ICsraSkgaHVsbC5wdXNoKHBvaW50c1tzb3J0ZWRQb2ludHNbbG93ZXJJbmRleGVzW2ldXVsyXV0pOwoKICByZXR1cm4gaHVsbDsKfQoKZnVuY3Rpb24gY29udGFpbnMkMihwb2x5Z29uLCBwb2ludCkgewogIHZhciBuID0gcG9seWdvbi5sZW5ndGgsCiAgICAgIHAgPSBwb2x5Z29uW24gLSAxXSwKICAgICAgeCA9IHBvaW50WzBdLCB5ID0gcG9pbnRbMV0sCiAgICAgIHgwID0gcFswXSwgeTAgPSBwWzFdLAogICAgICB4MSwgeTEsCiAgICAgIGluc2lkZSA9IGZhbHNlOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IG47ICsraSkgewogICAgcCA9IHBvbHlnb25baV0sIHgxID0gcFswXSwgeTEgPSBwWzFdOwogICAgaWYgKCgoeTEgPiB5KSAhPT0gKHkwID4geSkpICYmICh4IDwgKHgwIC0geDEpICogKHkgLSB5MSkgLyAoeTAgLSB5MSkgKyB4MSkpIGluc2lkZSA9ICFpbnNpZGU7CiAgICB4MCA9IHgxLCB5MCA9IHkxOwogIH0KCiAgcmV0dXJuIGluc2lkZTsKfQoKZnVuY3Rpb24gbGVuZ3RoJDIocG9seWdvbikgewogIHZhciBpID0gLTEsCiAgICAgIG4gPSBwb2x5Z29uLmxlbmd0aCwKICAgICAgYiA9IHBvbHlnb25bbiAtIDFdLAogICAgICB4YSwKICAgICAgeWEsCiAgICAgIHhiID0gYlswXSwKICAgICAgeWIgPSBiWzFdLAogICAgICBwZXJpbWV0ZXIgPSAwOwoKICB3aGlsZSAoKytpIDwgbikgewogICAgeGEgPSB4YjsKICAgIHlhID0geWI7CiAgICBiID0gcG9seWdvbltpXTsKICAgIHhiID0gYlswXTsKICAgIHliID0gYlsxXTsKICAgIHhhIC09IHhiOwogICAgeWEgLT0geWI7CiAgICBwZXJpbWV0ZXIgKz0gTWF0aC5zcXJ0KHhhICogeGEgKyB5YSAqIHlhKTsKICB9CgogIHJldHVybiBwZXJpbWV0ZXI7Cn0KCmZ1bmN0aW9uIGRlZmF1bHRTb3VyY2UkMSgpIHsKICByZXR1cm4gTWF0aC5yYW5kb20oKTsKfQoKdmFyIHVuaWZvcm0gPSAoZnVuY3Rpb24gc291cmNlUmFuZG9tVW5pZm9ybShzb3VyY2UpIHsKICBmdW5jdGlvbiByYW5kb21Vbmlmb3JtKG1pbiwgbWF4KSB7CiAgICBtaW4gPSBtaW4gPT0gbnVsbCA/IDAgOiArbWluOwogICAgbWF4ID0gbWF4ID09IG51bGwgPyAxIDogK21heDsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSBtYXggPSBtaW4sIG1pbiA9IDA7CiAgICBlbHNlIG1heCAtPSBtaW47CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBzb3VyY2UoKSAqIG1heCArIG1pbjsKICAgIH07CiAgfQoKICByYW5kb21Vbmlmb3JtLnNvdXJjZSA9IHNvdXJjZVJhbmRvbVVuaWZvcm07CgogIHJldHVybiByYW5kb21Vbmlmb3JtOwp9KShkZWZhdWx0U291cmNlJDEpOwoKdmFyIG5vcm1hbCA9IChmdW5jdGlvbiBzb3VyY2VSYW5kb21Ob3JtYWwoc291cmNlKSB7CiAgZnVuY3Rpb24gcmFuZG9tTm9ybWFsKG11LCBzaWdtYSkgewogICAgdmFyIHgsIHI7CiAgICBtdSA9IG11ID09IG51bGwgPyAwIDogK211OwogICAgc2lnbWEgPSBzaWdtYSA9PSBudWxsID8gMSA6ICtzaWdtYTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHk7CgogICAgICAvLyBJZiBhdmFpbGFibGUsIHVzZSB0aGUgc2Vjb25kIHByZXZpb3VzbHktZ2VuZXJhdGVkIHVuaWZvcm0gcmFuZG9tLgogICAgICBpZiAoeCAhPSBudWxsKSB5ID0geCwgeCA9IG51bGw7CgogICAgICAvLyBPdGhlcndpc2UsIGdlbmVyYXRlIGEgbmV3IHggYW5kIHkuCiAgICAgIGVsc2UgZG8gewogICAgICAgIHggPSBzb3VyY2UoKSAqIDIgLSAxOwogICAgICAgIHkgPSBzb3VyY2UoKSAqIDIgLSAxOwogICAgICAgIHIgPSB4ICogeCArIHkgKiB5OwogICAgICB9IHdoaWxlICghciB8fCByID4gMSk7CgogICAgICByZXR1cm4gbXUgKyBzaWdtYSAqIHkgKiBNYXRoLnNxcnQoLTIgKiBNYXRoLmxvZyhyKSAvIHIpOwogICAgfTsKICB9CgogIHJhbmRvbU5vcm1hbC5zb3VyY2UgPSBzb3VyY2VSYW5kb21Ob3JtYWw7CgogIHJldHVybiByYW5kb21Ob3JtYWw7Cn0pKGRlZmF1bHRTb3VyY2UkMSk7Cgp2YXIgbG9nTm9ybWFsID0gKGZ1bmN0aW9uIHNvdXJjZVJhbmRvbUxvZ05vcm1hbChzb3VyY2UpIHsKICBmdW5jdGlvbiByYW5kb21Mb2dOb3JtYWwoKSB7CiAgICB2YXIgcmFuZG9tTm9ybWFsID0gbm9ybWFsLnNvdXJjZShzb3VyY2UpLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBNYXRoLmV4cChyYW5kb21Ob3JtYWwoKSk7CiAgICB9OwogIH0KCiAgcmFuZG9tTG9nTm9ybWFsLnNvdXJjZSA9IHNvdXJjZVJhbmRvbUxvZ05vcm1hbDsKCiAgcmV0dXJuIHJhbmRvbUxvZ05vcm1hbDsKfSkoZGVmYXVsdFNvdXJjZSQxKTsKCnZhciBpcndpbkhhbGwgPSAoZnVuY3Rpb24gc291cmNlUmFuZG9tSXJ3aW5IYWxsKHNvdXJjZSkgewogIGZ1bmN0aW9uIHJhbmRvbUlyd2luSGFsbChuKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGZvciAodmFyIHN1bSA9IDAsIGkgPSAwOyBpIDwgbjsgKytpKSBzdW0gKz0gc291cmNlKCk7CiAgICAgIHJldHVybiBzdW07CiAgICB9OwogIH0KCiAgcmFuZG9tSXJ3aW5IYWxsLnNvdXJjZSA9IHNvdXJjZVJhbmRvbUlyd2luSGFsbDsKCiAgcmV0dXJuIHJhbmRvbUlyd2luSGFsbDsKfSkoZGVmYXVsdFNvdXJjZSQxKTsKCnZhciBiYXRlcyA9IChmdW5jdGlvbiBzb3VyY2VSYW5kb21CYXRlcyhzb3VyY2UpIHsKICBmdW5jdGlvbiByYW5kb21CYXRlcyhuKSB7CiAgICB2YXIgcmFuZG9tSXJ3aW5IYWxsID0gaXJ3aW5IYWxsLnNvdXJjZShzb3VyY2UpKG4pOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gcmFuZG9tSXJ3aW5IYWxsKCkgLyBuOwogICAgfTsKICB9CgogIHJhbmRvbUJhdGVzLnNvdXJjZSA9IHNvdXJjZVJhbmRvbUJhdGVzOwoKICByZXR1cm4gcmFuZG9tQmF0ZXM7Cn0pKGRlZmF1bHRTb3VyY2UkMSk7Cgp2YXIgZXhwb25lbnRpYWwkMSA9IChmdW5jdGlvbiBzb3VyY2VSYW5kb21FeHBvbmVudGlhbChzb3VyY2UpIHsKICBmdW5jdGlvbiByYW5kb21FeHBvbmVudGlhbChsYW1iZGEpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIC1NYXRoLmxvZygxIC0gc291cmNlKCkpIC8gbGFtYmRhOwogICAgfTsKICB9CgogIHJhbmRvbUV4cG9uZW50aWFsLnNvdXJjZSA9IHNvdXJjZVJhbmRvbUV4cG9uZW50aWFsOwoKICByZXR1cm4gcmFuZG9tRXhwb25lbnRpYWw7Cn0pKGRlZmF1bHRTb3VyY2UkMSk7Cgp2YXIgYXJyYXkkMyA9IEFycmF5LnByb3RvdHlwZTsKCnZhciBtYXAkMiA9IGFycmF5JDMubWFwOwp2YXIgc2xpY2UkNSA9IGFycmF5JDMuc2xpY2U7Cgp2YXIgaW1wbGljaXQgPSB7bmFtZTogImltcGxpY2l0In07CgpmdW5jdGlvbiBvcmRpbmFsKHJhbmdlKSB7CiAgdmFyIGluZGV4ID0gbWFwJDEoKSwKICAgICAgZG9tYWluID0gW10sCiAgICAgIHVua25vd24gPSBpbXBsaWNpdDsKCiAgcmFuZ2UgPSByYW5nZSA9PSBudWxsID8gW10gOiBzbGljZSQ1LmNhbGwocmFuZ2UpOwoKICBmdW5jdGlvbiBzY2FsZShkKSB7CiAgICB2YXIga2V5ID0gZCArICIiLCBpID0gaW5kZXguZ2V0KGtleSk7CiAgICBpZiAoIWkpIHsKICAgICAgaWYgKHVua25vd24gIT09IGltcGxpY2l0KSByZXR1cm4gdW5rbm93bjsKICAgICAgaW5kZXguc2V0KGtleSwgaSA9IGRvbWFpbi5wdXNoKGQpKTsKICAgIH0KICAgIHJldHVybiByYW5nZVsoaSAtIDEpICUgcmFuZ2UubGVuZ3RoXTsKICB9CgogIHNjYWxlLmRvbWFpbiA9IGZ1bmN0aW9uKF8pIHsKICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRvbWFpbi5zbGljZSgpOwogICAgZG9tYWluID0gW10sIGluZGV4ID0gbWFwJDEoKTsKICAgIHZhciBpID0gLTEsIG4gPSBfLmxlbmd0aCwgZCwga2V5OwogICAgd2hpbGUgKCsraSA8IG4pIGlmICghaW5kZXguaGFzKGtleSA9IChkID0gX1tpXSkgKyAiIikpIGluZGV4LnNldChrZXksIGRvbWFpbi5wdXNoKGQpKTsKICAgIHJldHVybiBzY2FsZTsKICB9OwoKICBzY2FsZS5yYW5nZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHJhbmdlID0gc2xpY2UkNS5jYWxsKF8pLCBzY2FsZSkgOiByYW5nZS5zbGljZSgpOwogIH07CgogIHNjYWxlLnVua25vd24gPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh1bmtub3duID0gXywgc2NhbGUpIDogdW5rbm93bjsKICB9OwoKICBzY2FsZS5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gb3JkaW5hbCgpCiAgICAgICAgLmRvbWFpbihkb21haW4pCiAgICAgICAgLnJhbmdlKHJhbmdlKQogICAgICAgIC51bmtub3duKHVua25vd24pOwogIH07CgogIHJldHVybiBzY2FsZTsKfQoKZnVuY3Rpb24gYmFuZCgpIHsKICB2YXIgc2NhbGUgPSBvcmRpbmFsKCkudW5rbm93bih1bmRlZmluZWQpLAogICAgICBkb21haW4gPSBzY2FsZS5kb21haW4sCiAgICAgIG9yZGluYWxSYW5nZSA9IHNjYWxlLnJhbmdlLAogICAgICByYW5nZSQkMSA9IFswLCAxXSwKICAgICAgc3RlcCwKICAgICAgYmFuZHdpZHRoLAogICAgICByb3VuZCA9IGZhbHNlLAogICAgICBwYWRkaW5nSW5uZXIgPSAwLAogICAgICBwYWRkaW5nT3V0ZXIgPSAwLAogICAgICBhbGlnbiA9IDAuNTsKCiAgZGVsZXRlIHNjYWxlLnVua25vd247CgogIGZ1bmN0aW9uIHJlc2NhbGUoKSB7CiAgICB2YXIgbiA9IGRvbWFpbigpLmxlbmd0aCwKICAgICAgICByZXZlcnNlID0gcmFuZ2UkJDFbMV0gPCByYW5nZSQkMVswXSwKICAgICAgICBzdGFydCA9IHJhbmdlJCQxW3JldmVyc2UgLSAwXSwKICAgICAgICBzdG9wID0gcmFuZ2UkJDFbMSAtIHJldmVyc2VdOwogICAgc3RlcCA9IChzdG9wIC0gc3RhcnQpIC8gTWF0aC5tYXgoMSwgbiAtIHBhZGRpbmdJbm5lciArIHBhZGRpbmdPdXRlciAqIDIpOwogICAgaWYgKHJvdW5kKSBzdGVwID0gTWF0aC5mbG9vcihzdGVwKTsKICAgIHN0YXJ0ICs9IChzdG9wIC0gc3RhcnQgLSBzdGVwICogKG4gLSBwYWRkaW5nSW5uZXIpKSAqIGFsaWduOwogICAgYmFuZHdpZHRoID0gc3RlcCAqICgxIC0gcGFkZGluZ0lubmVyKTsKICAgIGlmIChyb3VuZCkgc3RhcnQgPSBNYXRoLnJvdW5kKHN0YXJ0KSwgYmFuZHdpZHRoID0gTWF0aC5yb3VuZChiYW5kd2lkdGgpOwogICAgdmFyIHZhbHVlcyA9IHNlcXVlbmNlKG4pLm1hcChmdW5jdGlvbihpKSB7IHJldHVybiBzdGFydCArIHN0ZXAgKiBpOyB9KTsKICAgIHJldHVybiBvcmRpbmFsUmFuZ2UocmV2ZXJzZSA/IHZhbHVlcy5yZXZlcnNlKCkgOiB2YWx1ZXMpOwogIH0KCiAgc2NhbGUuZG9tYWluID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZG9tYWluKF8pLCByZXNjYWxlKCkpIDogZG9tYWluKCk7CiAgfTsKCiAgc2NhbGUucmFuZ2UgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChyYW5nZSQkMSA9IFsrX1swXSwgK19bMV1dLCByZXNjYWxlKCkpIDogcmFuZ2UkJDEuc2xpY2UoKTsKICB9OwoKICBzY2FsZS5yYW5nZVJvdW5kID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIHJhbmdlJCQxID0gWytfWzBdLCArX1sxXV0sIHJvdW5kID0gdHJ1ZSwgcmVzY2FsZSgpOwogIH07CgogIHNjYWxlLmJhbmR3aWR0aCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGJhbmR3aWR0aDsKICB9OwoKICBzY2FsZS5zdGVwID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gc3RlcDsKICB9OwoKICBzY2FsZS5yb3VuZCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHJvdW5kID0gISFfLCByZXNjYWxlKCkpIDogcm91bmQ7CiAgfTsKCiAgc2NhbGUucGFkZGluZyA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHBhZGRpbmdJbm5lciA9IHBhZGRpbmdPdXRlciA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIF8pKSwgcmVzY2FsZSgpKSA6IHBhZGRpbmdJbm5lcjsKICB9OwoKICBzY2FsZS5wYWRkaW5nSW5uZXIgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChwYWRkaW5nSW5uZXIgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCBfKSksIHJlc2NhbGUoKSkgOiBwYWRkaW5nSW5uZXI7CiAgfTsKCiAgc2NhbGUucGFkZGluZ091dGVyID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocGFkZGluZ091dGVyID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgXykpLCByZXNjYWxlKCkpIDogcGFkZGluZ091dGVyOwogIH07CgogIHNjYWxlLmFsaWduID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoYWxpZ24gPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCBfKSksIHJlc2NhbGUoKSkgOiBhbGlnbjsKICB9OwoKICBzY2FsZS5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gYmFuZCgpCiAgICAgICAgLmRvbWFpbihkb21haW4oKSkKICAgICAgICAucmFuZ2UocmFuZ2UkJDEpCiAgICAgICAgLnJvdW5kKHJvdW5kKQogICAgICAgIC5wYWRkaW5nSW5uZXIocGFkZGluZ0lubmVyKQogICAgICAgIC5wYWRkaW5nT3V0ZXIocGFkZGluZ091dGVyKQogICAgICAgIC5hbGlnbihhbGlnbik7CiAgfTsKCiAgcmV0dXJuIHJlc2NhbGUoKTsKfQoKZnVuY3Rpb24gcG9pbnRpc2goc2NhbGUpIHsKICB2YXIgY29weSA9IHNjYWxlLmNvcHk7CgogIHNjYWxlLnBhZGRpbmcgPSBzY2FsZS5wYWRkaW5nT3V0ZXI7CiAgZGVsZXRlIHNjYWxlLnBhZGRpbmdJbm5lcjsKICBkZWxldGUgc2NhbGUucGFkZGluZ091dGVyOwoKICBzY2FsZS5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gcG9pbnRpc2goY29weSgpKTsKICB9OwoKICByZXR1cm4gc2NhbGU7Cn0KCmZ1bmN0aW9uIHBvaW50JDEoKSB7CiAgcmV0dXJuIHBvaW50aXNoKGJhbmQoKS5wYWRkaW5nSW5uZXIoMSkpOwp9CgpmdW5jdGlvbiBjb25zdGFudCQxMCh4KSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHg7CiAgfTsKfQoKZnVuY3Rpb24gbnVtYmVyJDIoeCkgewogIHJldHVybiAreDsKfQoKdmFyIHVuaXQgPSBbMCwgMV07CgpmdW5jdGlvbiBkZWludGVycG9sYXRlTGluZWFyKGEsIGIpIHsKICByZXR1cm4gKGIgLT0gKGEgPSArYSkpCiAgICAgID8gZnVuY3Rpb24oeCkgeyByZXR1cm4gKHggLSBhKSAvIGI7IH0KICAgICAgOiBjb25zdGFudCQxMChiKTsKfQoKZnVuY3Rpb24gZGVpbnRlcnBvbGF0ZUNsYW1wKGRlaW50ZXJwb2xhdGUpIHsKICByZXR1cm4gZnVuY3Rpb24oYSwgYikgewogICAgdmFyIGQgPSBkZWludGVycG9sYXRlKGEgPSArYSwgYiA9ICtiKTsKICAgIHJldHVybiBmdW5jdGlvbih4KSB7IHJldHVybiB4IDw9IGEgPyAwIDogeCA+PSBiID8gMSA6IGQoeCk7IH07CiAgfTsKfQoKZnVuY3Rpb24gcmVpbnRlcnBvbGF0ZUNsYW1wKHJlaW50ZXJwb2xhdGUkJDEpIHsKICByZXR1cm4gZnVuY3Rpb24oYSwgYikgewogICAgdmFyIHIgPSByZWludGVycG9sYXRlJCQxKGEgPSArYSwgYiA9ICtiKTsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7IHJldHVybiB0IDw9IDAgPyBhIDogdCA+PSAxID8gYiA6IHIodCk7IH07CiAgfTsKfQoKZnVuY3Rpb24gYmltYXAoZG9tYWluLCByYW5nZSwgZGVpbnRlcnBvbGF0ZSwgcmVpbnRlcnBvbGF0ZSQkMSkgewogIHZhciBkMCA9IGRvbWFpblswXSwgZDEgPSBkb21haW5bMV0sIHIwID0gcmFuZ2VbMF0sIHIxID0gcmFuZ2VbMV07CiAgaWYgKGQxIDwgZDApIGQwID0gZGVpbnRlcnBvbGF0ZShkMSwgZDApLCByMCA9IHJlaW50ZXJwb2xhdGUkJDEocjEsIHIwKTsKICBlbHNlIGQwID0gZGVpbnRlcnBvbGF0ZShkMCwgZDEpLCByMCA9IHJlaW50ZXJwb2xhdGUkJDEocjAsIHIxKTsKICByZXR1cm4gZnVuY3Rpb24oeCkgeyByZXR1cm4gcjAoZDAoeCkpOyB9Owp9CgpmdW5jdGlvbiBwb2x5bWFwKGRvbWFpbiwgcmFuZ2UsIGRlaW50ZXJwb2xhdGUsIHJlaW50ZXJwb2xhdGUkJDEpIHsKICB2YXIgaiA9IE1hdGgubWluKGRvbWFpbi5sZW5ndGgsIHJhbmdlLmxlbmd0aCkgLSAxLAogICAgICBkID0gbmV3IEFycmF5KGopLAogICAgICByID0gbmV3IEFycmF5KGopLAogICAgICBpID0gLTE7CgogIC8vIFJldmVyc2UgZGVzY2VuZGluZyBkb21haW5zLgogIGlmIChkb21haW5bal0gPCBkb21haW5bMF0pIHsKICAgIGRvbWFpbiA9IGRvbWFpbi5zbGljZSgpLnJldmVyc2UoKTsKICAgIHJhbmdlID0gcmFuZ2Uuc2xpY2UoKS5yZXZlcnNlKCk7CiAgfQoKICB3aGlsZSAoKytpIDwgaikgewogICAgZFtpXSA9IGRlaW50ZXJwb2xhdGUoZG9tYWluW2ldLCBkb21haW5baSArIDFdKTsKICAgIHJbaV0gPSByZWludGVycG9sYXRlJCQxKHJhbmdlW2ldLCByYW5nZVtpICsgMV0pOwogIH0KCiAgcmV0dXJuIGZ1bmN0aW9uKHgpIHsKICAgIHZhciBpID0gYmlzZWN0UmlnaHQoZG9tYWluLCB4LCAxLCBqKSAtIDE7CiAgICByZXR1cm4gcltpXShkW2ldKHgpKTsKICB9Owp9CgpmdW5jdGlvbiBjb3B5KHNvdXJjZSwgdGFyZ2V0KSB7CiAgcmV0dXJuIHRhcmdldAogICAgICAuZG9tYWluKHNvdXJjZS5kb21haW4oKSkKICAgICAgLnJhbmdlKHNvdXJjZS5yYW5nZSgpKQogICAgICAuaW50ZXJwb2xhdGUoc291cmNlLmludGVycG9sYXRlKCkpCiAgICAgIC5jbGFtcChzb3VyY2UuY2xhbXAoKSk7Cn0KCi8vIGRlaW50ZXJwb2xhdGUoYSwgYikoeCkgdGFrZXMgYSBkb21haW4gdmFsdWUgeCBpbiBbYSxiXSBhbmQgcmV0dXJucyB0aGUgY29ycmVzcG9uZGluZyBwYXJhbWV0ZXIgdCBpbiBbMCwxXS4KLy8gcmVpbnRlcnBvbGF0ZShhLCBiKSh0KSB0YWtlcyBhIHBhcmFtZXRlciB0IGluIFswLDFdIGFuZCByZXR1cm5zIHRoZSBjb3JyZXNwb25kaW5nIGRvbWFpbiB2YWx1ZSB4IGluIFthLGJdLgpmdW5jdGlvbiBjb250aW51b3VzKGRlaW50ZXJwb2xhdGUsIHJlaW50ZXJwb2xhdGUkJDEpIHsKICB2YXIgZG9tYWluID0gdW5pdCwKICAgICAgcmFuZ2UgPSB1bml0LAogICAgICBpbnRlcnBvbGF0ZSQkMSA9IGludGVycG9sYXRlVmFsdWUsCiAgICAgIGNsYW1wID0gZmFsc2UsCiAgICAgIHBpZWNld2lzZSwKICAgICAgb3V0cHV0LAogICAgICBpbnB1dDsKCiAgZnVuY3Rpb24gcmVzY2FsZSgpIHsKICAgIHBpZWNld2lzZSA9IE1hdGgubWluKGRvbWFpbi5sZW5ndGgsIHJhbmdlLmxlbmd0aCkgPiAyID8gcG9seW1hcCA6IGJpbWFwOwogICAgb3V0cHV0ID0gaW5wdXQgPSBudWxsOwogICAgcmV0dXJuIHNjYWxlOwogIH0KCiAgZnVuY3Rpb24gc2NhbGUoeCkgewogICAgcmV0dXJuIChvdXRwdXQgfHwgKG91dHB1dCA9IHBpZWNld2lzZShkb21haW4sIHJhbmdlLCBjbGFtcCA/IGRlaW50ZXJwb2xhdGVDbGFtcChkZWludGVycG9sYXRlKSA6IGRlaW50ZXJwb2xhdGUsIGludGVycG9sYXRlJCQxKSkpKCt4KTsKICB9CgogIHNjYWxlLmludmVydCA9IGZ1bmN0aW9uKHkpIHsKICAgIHJldHVybiAoaW5wdXQgfHwgKGlucHV0ID0gcGllY2V3aXNlKHJhbmdlLCBkb21haW4sIGRlaW50ZXJwb2xhdGVMaW5lYXIsIGNsYW1wID8gcmVpbnRlcnBvbGF0ZUNsYW1wKHJlaW50ZXJwb2xhdGUkJDEpIDogcmVpbnRlcnBvbGF0ZSQkMSkpKSgreSk7CiAgfTsKCiAgc2NhbGUuZG9tYWluID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZG9tYWluID0gbWFwJDIuY2FsbChfLCBudW1iZXIkMiksIHJlc2NhbGUoKSkgOiBkb21haW4uc2xpY2UoKTsKICB9OwoKICBzY2FsZS5yYW5nZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHJhbmdlID0gc2xpY2UkNS5jYWxsKF8pLCByZXNjYWxlKCkpIDogcmFuZ2Uuc2xpY2UoKTsKICB9OwoKICBzY2FsZS5yYW5nZVJvdW5kID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIHJhbmdlID0gc2xpY2UkNS5jYWxsKF8pLCBpbnRlcnBvbGF0ZSQkMSA9IGludGVycG9sYXRlUm91bmQsIHJlc2NhbGUoKTsKICB9OwoKICBzY2FsZS5jbGFtcCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGNsYW1wID0gISFfLCByZXNjYWxlKCkpIDogY2xhbXA7CiAgfTsKCiAgc2NhbGUuaW50ZXJwb2xhdGUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpbnRlcnBvbGF0ZSQkMSA9IF8sIHJlc2NhbGUoKSkgOiBpbnRlcnBvbGF0ZSQkMTsKICB9OwoKICByZXR1cm4gcmVzY2FsZSgpOwp9CgpmdW5jdGlvbiB0aWNrRm9ybWF0KGRvbWFpbiwgY291bnQsIHNwZWNpZmllcikgewogIHZhciBzdGFydCA9IGRvbWFpblswXSwKICAgICAgc3RvcCA9IGRvbWFpbltkb21haW4ubGVuZ3RoIC0gMV0sCiAgICAgIHN0ZXAgPSB0aWNrU3RlcChzdGFydCwgc3RvcCwgY291bnQgPT0gbnVsbCA/IDEwIDogY291bnQpLAogICAgICBwcmVjaXNpb247CiAgc3BlY2lmaWVyID0gZm9ybWF0U3BlY2lmaWVyKHNwZWNpZmllciA9PSBudWxsID8gIixmIiA6IHNwZWNpZmllcik7CiAgc3dpdGNoIChzcGVjaWZpZXIudHlwZSkgewogICAgY2FzZSAicyI6IHsKICAgICAgdmFyIHZhbHVlID0gTWF0aC5tYXgoTWF0aC5hYnMoc3RhcnQpLCBNYXRoLmFicyhzdG9wKSk7CiAgICAgIGlmIChzcGVjaWZpZXIucHJlY2lzaW9uID09IG51bGwgJiYgIWlzTmFOKHByZWNpc2lvbiA9IHByZWNpc2lvblByZWZpeChzdGVwLCB2YWx1ZSkpKSBzcGVjaWZpZXIucHJlY2lzaW9uID0gcHJlY2lzaW9uOwogICAgICByZXR1cm4gZXhwb3J0cy5mb3JtYXRQcmVmaXgoc3BlY2lmaWVyLCB2YWx1ZSk7CiAgICB9CiAgICBjYXNlICIiOgogICAgY2FzZSAiZSI6CiAgICBjYXNlICJnIjoKICAgIGNhc2UgInAiOgogICAgY2FzZSAiciI6IHsKICAgICAgaWYgKHNwZWNpZmllci5wcmVjaXNpb24gPT0gbnVsbCAmJiAhaXNOYU4ocHJlY2lzaW9uID0gcHJlY2lzaW9uUm91bmQoc3RlcCwgTWF0aC5tYXgoTWF0aC5hYnMoc3RhcnQpLCBNYXRoLmFicyhzdG9wKSkpKSkgc3BlY2lmaWVyLnByZWNpc2lvbiA9IHByZWNpc2lvbiAtIChzcGVjaWZpZXIudHlwZSA9PT0gImUiKTsKICAgICAgYnJlYWs7CiAgICB9CiAgICBjYXNlICJmIjoKICAgIGNhc2UgIiUiOiB7CiAgICAgIGlmIChzcGVjaWZpZXIucHJlY2lzaW9uID09IG51bGwgJiYgIWlzTmFOKHByZWNpc2lvbiA9IHByZWNpc2lvbkZpeGVkKHN0ZXApKSkgc3BlY2lmaWVyLnByZWNpc2lvbiA9IHByZWNpc2lvbiAtIChzcGVjaWZpZXIudHlwZSA9PT0gIiUiKSAqIDI7CiAgICAgIGJyZWFrOwogICAgfQogIH0KICByZXR1cm4gZXhwb3J0cy5mb3JtYXQoc3BlY2lmaWVyKTsKfQoKZnVuY3Rpb24gbGluZWFyaXNoKHNjYWxlKSB7CiAgdmFyIGRvbWFpbiA9IHNjYWxlLmRvbWFpbjsKCiAgc2NhbGUudGlja3MgPSBmdW5jdGlvbihjb3VudCkgewogICAgdmFyIGQgPSBkb21haW4oKTsKICAgIHJldHVybiB0aWNrcyhkWzBdLCBkW2QubGVuZ3RoIC0gMV0sIGNvdW50ID09IG51bGwgPyAxMCA6IGNvdW50KTsKICB9OwoKICBzY2FsZS50aWNrRm9ybWF0ID0gZnVuY3Rpb24oY291bnQsIHNwZWNpZmllcikgewogICAgcmV0dXJuIHRpY2tGb3JtYXQoZG9tYWluKCksIGNvdW50LCBzcGVjaWZpZXIpOwogIH07CgogIHNjYWxlLm5pY2UgPSBmdW5jdGlvbihjb3VudCkgewogICAgaWYgKGNvdW50ID09IG51bGwpIGNvdW50ID0gMTA7CgogICAgdmFyIGQgPSBkb21haW4oKSwKICAgICAgICBpMCA9IDAsCiAgICAgICAgaTEgPSBkLmxlbmd0aCAtIDEsCiAgICAgICAgc3RhcnQgPSBkW2kwXSwKICAgICAgICBzdG9wID0gZFtpMV0sCiAgICAgICAgc3RlcDsKCiAgICBpZiAoc3RvcCA8IHN0YXJ0KSB7CiAgICAgIHN0ZXAgPSBzdGFydCwgc3RhcnQgPSBzdG9wLCBzdG9wID0gc3RlcDsKICAgICAgc3RlcCA9IGkwLCBpMCA9IGkxLCBpMSA9IHN0ZXA7CiAgICB9CgogICAgc3RlcCA9IHRpY2tJbmNyZW1lbnQoc3RhcnQsIHN0b3AsIGNvdW50KTsKCiAgICBpZiAoc3RlcCA+IDApIHsKICAgICAgc3RhcnQgPSBNYXRoLmZsb29yKHN0YXJ0IC8gc3RlcCkgKiBzdGVwOwogICAgICBzdG9wID0gTWF0aC5jZWlsKHN0b3AgLyBzdGVwKSAqIHN0ZXA7CiAgICAgIHN0ZXAgPSB0aWNrSW5jcmVtZW50KHN0YXJ0LCBzdG9wLCBjb3VudCk7CiAgICB9IGVsc2UgaWYgKHN0ZXAgPCAwKSB7CiAgICAgIHN0YXJ0ID0gTWF0aC5jZWlsKHN0YXJ0ICogc3RlcCkgLyBzdGVwOwogICAgICBzdG9wID0gTWF0aC5mbG9vcihzdG9wICogc3RlcCkgLyBzdGVwOwogICAgICBzdGVwID0gdGlja0luY3JlbWVudChzdGFydCwgc3RvcCwgY291bnQpOwogICAgfQoKICAgIGlmIChzdGVwID4gMCkgewogICAgICBkW2kwXSA9IE1hdGguZmxvb3Ioc3RhcnQgLyBzdGVwKSAqIHN0ZXA7CiAgICAgIGRbaTFdID0gTWF0aC5jZWlsKHN0b3AgLyBzdGVwKSAqIHN0ZXA7CiAgICAgIGRvbWFpbihkKTsKICAgIH0gZWxzZSBpZiAoc3RlcCA8IDApIHsKICAgICAgZFtpMF0gPSBNYXRoLmNlaWwoc3RhcnQgKiBzdGVwKSAvIHN0ZXA7CiAgICAgIGRbaTFdID0gTWF0aC5mbG9vcihzdG9wICogc3RlcCkgLyBzdGVwOwogICAgICBkb21haW4oZCk7CiAgICB9CgogICAgcmV0dXJuIHNjYWxlOwogIH07CgogIHJldHVybiBzY2FsZTsKfQoKZnVuY3Rpb24gbGluZWFyJDIoKSB7CiAgdmFyIHNjYWxlID0gY29udGludW91cyhkZWludGVycG9sYXRlTGluZWFyLCByZWludGVycG9sYXRlKTsKCiAgc2NhbGUuY29weSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGNvcHkoc2NhbGUsIGxpbmVhciQyKCkpOwogIH07CgogIHJldHVybiBsaW5lYXJpc2goc2NhbGUpOwp9CgpmdW5jdGlvbiBpZGVudGl0eSQ2KCkgewogIHZhciBkb21haW4gPSBbMCwgMV07CgogIGZ1bmN0aW9uIHNjYWxlKHgpIHsKICAgIHJldHVybiAreDsKICB9CgogIHNjYWxlLmludmVydCA9IHNjYWxlOwoKICBzY2FsZS5kb21haW4gPSBzY2FsZS5yYW5nZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGRvbWFpbiA9IG1hcCQyLmNhbGwoXywgbnVtYmVyJDIpLCBzY2FsZSkgOiBkb21haW4uc2xpY2UoKTsKICB9OwoKICBzY2FsZS5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gaWRlbnRpdHkkNigpLmRvbWFpbihkb21haW4pOwogIH07CgogIHJldHVybiBsaW5lYXJpc2goc2NhbGUpOwp9CgpmdW5jdGlvbiBuaWNlKGRvbWFpbiwgaW50ZXJ2YWwpIHsKICBkb21haW4gPSBkb21haW4uc2xpY2UoKTsKCiAgdmFyIGkwID0gMCwKICAgICAgaTEgPSBkb21haW4ubGVuZ3RoIC0gMSwKICAgICAgeDAgPSBkb21haW5baTBdLAogICAgICB4MSA9IGRvbWFpbltpMV0sCiAgICAgIHQ7CgogIGlmICh4MSA8IHgwKSB7CiAgICB0ID0gaTAsIGkwID0gaTEsIGkxID0gdDsKICAgIHQgPSB4MCwgeDAgPSB4MSwgeDEgPSB0OwogIH0KCiAgZG9tYWluW2kwXSA9IGludGVydmFsLmZsb29yKHgwKTsKICBkb21haW5baTFdID0gaW50ZXJ2YWwuY2VpbCh4MSk7CiAgcmV0dXJuIGRvbWFpbjsKfQoKZnVuY3Rpb24gZGVpbnRlcnBvbGF0ZShhLCBiKSB7CiAgcmV0dXJuIChiID0gTWF0aC5sb2coYiAvIGEpKQogICAgICA/IGZ1bmN0aW9uKHgpIHsgcmV0dXJuIE1hdGgubG9nKHggLyBhKSAvIGI7IH0KICAgICAgOiBjb25zdGFudCQxMChiKTsKfQoKZnVuY3Rpb24gcmVpbnRlcnBvbGF0ZSQxKGEsIGIpIHsKICByZXR1cm4gYSA8IDAKICAgICAgPyBmdW5jdGlvbih0KSB7IHJldHVybiAtTWF0aC5wb3coLWIsIHQpICogTWF0aC5wb3coLWEsIDEgLSB0KTsgfQogICAgICA6IGZ1bmN0aW9uKHQpIHsgcmV0dXJuIE1hdGgucG93KGIsIHQpICogTWF0aC5wb3coYSwgMSAtIHQpOyB9Owp9CgpmdW5jdGlvbiBwb3cxMCh4KSB7CiAgcmV0dXJuIGlzRmluaXRlKHgpID8gKygiMWUiICsgeCkgOiB4IDwgMCA/IDAgOiB4Owp9CgpmdW5jdGlvbiBwb3dwKGJhc2UpIHsKICByZXR1cm4gYmFzZSA9PT0gMTAgPyBwb3cxMAogICAgICA6IGJhc2UgPT09IE1hdGguRSA/IE1hdGguZXhwCiAgICAgIDogZnVuY3Rpb24oeCkgeyByZXR1cm4gTWF0aC5wb3coYmFzZSwgeCk7IH07Cn0KCmZ1bmN0aW9uIGxvZ3AoYmFzZSkgewogIHJldHVybiBiYXNlID09PSBNYXRoLkUgPyBNYXRoLmxvZwogICAgICA6IGJhc2UgPT09IDEwICYmIE1hdGgubG9nMTAKICAgICAgfHwgYmFzZSA9PT0gMiAmJiBNYXRoLmxvZzIKICAgICAgfHwgKGJhc2UgPSBNYXRoLmxvZyhiYXNlKSwgZnVuY3Rpb24oeCkgeyByZXR1cm4gTWF0aC5sb2coeCkgLyBiYXNlOyB9KTsKfQoKZnVuY3Rpb24gcmVmbGVjdChmKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKHgpIHsKICAgIHJldHVybiAtZigteCk7CiAgfTsKfQoKZnVuY3Rpb24gbG9nJDEoKSB7CiAgdmFyIHNjYWxlID0gY29udGludW91cyhkZWludGVycG9sYXRlLCByZWludGVycG9sYXRlJDEpLmRvbWFpbihbMSwgMTBdKSwKICAgICAgZG9tYWluID0gc2NhbGUuZG9tYWluLAogICAgICBiYXNlID0gMTAsCiAgICAgIGxvZ3MgPSBsb2dwKDEwKSwKICAgICAgcG93cyA9IHBvd3AoMTApOwoKICBmdW5jdGlvbiByZXNjYWxlKCkgewogICAgbG9ncyA9IGxvZ3AoYmFzZSksIHBvd3MgPSBwb3dwKGJhc2UpOwogICAgaWYgKGRvbWFpbigpWzBdIDwgMCkgbG9ncyA9IHJlZmxlY3QobG9ncyksIHBvd3MgPSByZWZsZWN0KHBvd3MpOwogICAgcmV0dXJuIHNjYWxlOwogIH0KCiAgc2NhbGUuYmFzZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGJhc2UgPSArXywgcmVzY2FsZSgpKSA6IGJhc2U7CiAgfTsKCiAgc2NhbGUuZG9tYWluID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZG9tYWluKF8pLCByZXNjYWxlKCkpIDogZG9tYWluKCk7CiAgfTsKCiAgc2NhbGUudGlja3MgPSBmdW5jdGlvbihjb3VudCkgewogICAgdmFyIGQgPSBkb21haW4oKSwKICAgICAgICB1ID0gZFswXSwKICAgICAgICB2ID0gZFtkLmxlbmd0aCAtIDFdLAogICAgICAgIHI7CgogICAgaWYgKHIgPSB2IDwgdSkgaSA9IHUsIHUgPSB2LCB2ID0gaTsKCiAgICB2YXIgaSA9IGxvZ3ModSksCiAgICAgICAgaiA9IGxvZ3ModiksCiAgICAgICAgcCwKICAgICAgICBrLAogICAgICAgIHQsCiAgICAgICAgbiA9IGNvdW50ID09IG51bGwgPyAxMCA6ICtjb3VudCwKICAgICAgICB6ID0gW107CgogICAgaWYgKCEoYmFzZSAlIDEpICYmIGogLSBpIDwgbikgewogICAgICBpID0gTWF0aC5yb3VuZChpKSAtIDEsIGogPSBNYXRoLnJvdW5kKGopICsgMTsKICAgICAgaWYgKHUgPiAwKSBmb3IgKDsgaSA8IGo7ICsraSkgewogICAgICAgIGZvciAoayA9IDEsIHAgPSBwb3dzKGkpOyBrIDwgYmFzZTsgKytrKSB7CiAgICAgICAgICB0ID0gcCAqIGs7CiAgICAgICAgICBpZiAodCA8IHUpIGNvbnRpbnVlOwogICAgICAgICAgaWYgKHQgPiB2KSBicmVhazsKICAgICAgICAgIHoucHVzaCh0KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBmb3IgKDsgaSA8IGo7ICsraSkgewogICAgICAgIGZvciAoayA9IGJhc2UgLSAxLCBwID0gcG93cyhpKTsgayA+PSAxOyAtLWspIHsKICAgICAgICAgIHQgPSBwICogazsKICAgICAgICAgIGlmICh0IDwgdSkgY29udGludWU7CiAgICAgICAgICBpZiAodCA+IHYpIGJyZWFrOwogICAgICAgICAgei5wdXNoKHQpOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgeiA9IHRpY2tzKGksIGosIE1hdGgubWluKGogLSBpLCBuKSkubWFwKHBvd3MpOwogICAgfQoKICAgIHJldHVybiByID8gei5yZXZlcnNlKCkgOiB6OwogIH07CgogIHNjYWxlLnRpY2tGb3JtYXQgPSBmdW5jdGlvbihjb3VudCwgc3BlY2lmaWVyKSB7CiAgICBpZiAoc3BlY2lmaWVyID09IG51bGwpIHNwZWNpZmllciA9IGJhc2UgPT09IDEwID8gIi4wZSIgOiAiLCI7CiAgICBpZiAodHlwZW9mIHNwZWNpZmllciAhPT0gImZ1bmN0aW9uIikgc3BlY2lmaWVyID0gZXhwb3J0cy5mb3JtYXQoc3BlY2lmaWVyKTsKICAgIGlmIChjb3VudCA9PT0gSW5maW5pdHkpIHJldHVybiBzcGVjaWZpZXI7CiAgICBpZiAoY291bnQgPT0gbnVsbCkgY291bnQgPSAxMDsKICAgIHZhciBrID0gTWF0aC5tYXgoMSwgYmFzZSAqIGNvdW50IC8gc2NhbGUudGlja3MoKS5sZW5ndGgpOyAvLyBUT0RPIGZhc3QgZXN0aW1hdGU/CiAgICByZXR1cm4gZnVuY3Rpb24oZCkgewogICAgICB2YXIgaSA9IGQgLyBwb3dzKE1hdGgucm91bmQobG9ncyhkKSkpOwogICAgICBpZiAoaSAqIGJhc2UgPCBiYXNlIC0gMC41KSBpICo9IGJhc2U7CiAgICAgIHJldHVybiBpIDw9IGsgPyBzcGVjaWZpZXIoZCkgOiAiIjsKICAgIH07CiAgfTsKCiAgc2NhbGUubmljZSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGRvbWFpbihuaWNlKGRvbWFpbigpLCB7CiAgICAgIGZsb29yOiBmdW5jdGlvbih4KSB7IHJldHVybiBwb3dzKE1hdGguZmxvb3IobG9ncyh4KSkpOyB9LAogICAgICBjZWlsOiBmdW5jdGlvbih4KSB7IHJldHVybiBwb3dzKE1hdGguY2VpbChsb2dzKHgpKSk7IH0KICAgIH0pKTsKICB9OwoKICBzY2FsZS5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gY29weShzY2FsZSwgbG9nJDEoKS5iYXNlKGJhc2UpKTsKICB9OwoKICByZXR1cm4gc2NhbGU7Cn0KCmZ1bmN0aW9uIHJhaXNlJDEoeCwgZXhwb25lbnQpIHsKICByZXR1cm4geCA8IDAgPyAtTWF0aC5wb3coLXgsIGV4cG9uZW50KSA6IE1hdGgucG93KHgsIGV4cG9uZW50KTsKfQoKZnVuY3Rpb24gcG93JDEoKSB7CiAgdmFyIGV4cG9uZW50ID0gMSwKICAgICAgc2NhbGUgPSBjb250aW51b3VzKGRlaW50ZXJwb2xhdGUsIHJlaW50ZXJwb2xhdGUpLAogICAgICBkb21haW4gPSBzY2FsZS5kb21haW47CgogIGZ1bmN0aW9uIGRlaW50ZXJwb2xhdGUoYSwgYikgewogICAgcmV0dXJuIChiID0gcmFpc2UkMShiLCBleHBvbmVudCkgLSAoYSA9IHJhaXNlJDEoYSwgZXhwb25lbnQpKSkKICAgICAgICA/IGZ1bmN0aW9uKHgpIHsgcmV0dXJuIChyYWlzZSQxKHgsIGV4cG9uZW50KSAtIGEpIC8gYjsgfQogICAgICAgIDogY29uc3RhbnQkMTAoYik7CiAgfQoKICBmdW5jdGlvbiByZWludGVycG9sYXRlKGEsIGIpIHsKICAgIGIgPSByYWlzZSQxKGIsIGV4cG9uZW50KSAtIChhID0gcmFpc2UkMShhLCBleHBvbmVudCkpOwogICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsgcmV0dXJuIHJhaXNlJDEoYSArIGIgKiB0LCAxIC8gZXhwb25lbnQpOyB9OwogIH0KCiAgc2NhbGUuZXhwb25lbnQgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChleHBvbmVudCA9ICtfLCBkb21haW4oZG9tYWluKCkpKSA6IGV4cG9uZW50OwogIH07CgogIHNjYWxlLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBjb3B5KHNjYWxlLCBwb3ckMSgpLmV4cG9uZW50KGV4cG9uZW50KSk7CiAgfTsKCiAgcmV0dXJuIGxpbmVhcmlzaChzY2FsZSk7Cn0KCmZ1bmN0aW9uIHNxcnQkMSgpIHsKICByZXR1cm4gcG93JDEoKS5leHBvbmVudCgwLjUpOwp9CgpmdW5jdGlvbiBxdWFudGlsZSQkMSgpIHsKICB2YXIgZG9tYWluID0gW10sCiAgICAgIHJhbmdlID0gW10sCiAgICAgIHRocmVzaG9sZHMgPSBbXTsKCiAgZnVuY3Rpb24gcmVzY2FsZSgpIHsKICAgIHZhciBpID0gMCwgbiA9IE1hdGgubWF4KDEsIHJhbmdlLmxlbmd0aCk7CiAgICB0aHJlc2hvbGRzID0gbmV3IEFycmF5KG4gLSAxKTsKICAgIHdoaWxlICgrK2kgPCBuKSB0aHJlc2hvbGRzW2kgLSAxXSA9IHRocmVzaG9sZChkb21haW4sIGkgLyBuKTsKICAgIHJldHVybiBzY2FsZTsKICB9CgogIGZ1bmN0aW9uIHNjYWxlKHgpIHsKICAgIGlmICghaXNOYU4oeCA9ICt4KSkgcmV0dXJuIHJhbmdlW2Jpc2VjdFJpZ2h0KHRocmVzaG9sZHMsIHgpXTsKICB9CgogIHNjYWxlLmludmVydEV4dGVudCA9IGZ1bmN0aW9uKHkpIHsKICAgIHZhciBpID0gcmFuZ2UuaW5kZXhPZih5KTsKICAgIHJldHVybiBpIDwgMCA/IFtOYU4sIE5hTl0gOiBbCiAgICAgIGkgPiAwID8gdGhyZXNob2xkc1tpIC0gMV0gOiBkb21haW5bMF0sCiAgICAgIGkgPCB0aHJlc2hvbGRzLmxlbmd0aCA/IHRocmVzaG9sZHNbaV0gOiBkb21haW5bZG9tYWluLmxlbmd0aCAtIDFdCiAgICBdOwogIH07CgogIHNjYWxlLmRvbWFpbiA9IGZ1bmN0aW9uKF8pIHsKICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRvbWFpbi5zbGljZSgpOwogICAgZG9tYWluID0gW107CiAgICBmb3IgKHZhciBpID0gMCwgbiA9IF8ubGVuZ3RoLCBkOyBpIDwgbjsgKytpKSBpZiAoZCA9IF9baV0sIGQgIT0gbnVsbCAmJiAhaXNOYU4oZCA9ICtkKSkgZG9tYWluLnB1c2goZCk7CiAgICBkb21haW4uc29ydChhc2NlbmRpbmcpOwogICAgcmV0dXJuIHJlc2NhbGUoKTsKICB9OwoKICBzY2FsZS5yYW5nZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHJhbmdlID0gc2xpY2UkNS5jYWxsKF8pLCByZXNjYWxlKCkpIDogcmFuZ2Uuc2xpY2UoKTsKICB9OwoKICBzY2FsZS5xdWFudGlsZXMgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aHJlc2hvbGRzLnNsaWNlKCk7CiAgfTsKCiAgc2NhbGUuY29weSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHF1YW50aWxlJCQxKCkKICAgICAgICAuZG9tYWluKGRvbWFpbikKICAgICAgICAucmFuZ2UocmFuZ2UpOwogIH07CgogIHJldHVybiBzY2FsZTsKfQoKZnVuY3Rpb24gcXVhbnRpemUkMSgpIHsKICB2YXIgeDAgPSAwLAogICAgICB4MSA9IDEsCiAgICAgIG4gPSAxLAogICAgICBkb21haW4gPSBbMC41XSwKICAgICAgcmFuZ2UgPSBbMCwgMV07CgogIGZ1bmN0aW9uIHNjYWxlKHgpIHsKICAgIGlmICh4IDw9IHgpIHJldHVybiByYW5nZVtiaXNlY3RSaWdodChkb21haW4sIHgsIDAsIG4pXTsKICB9CgogIGZ1bmN0aW9uIHJlc2NhbGUoKSB7CiAgICB2YXIgaSA9IC0xOwogICAgZG9tYWluID0gbmV3IEFycmF5KG4pOwogICAgd2hpbGUgKCsraSA8IG4pIGRvbWFpbltpXSA9ICgoaSArIDEpICogeDEgLSAoaSAtIG4pICogeDApIC8gKG4gKyAxKTsKICAgIHJldHVybiBzY2FsZTsKICB9CgogIHNjYWxlLmRvbWFpbiA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHgwID0gK19bMF0sIHgxID0gK19bMV0sIHJlc2NhbGUoKSkgOiBbeDAsIHgxXTsKICB9OwoKICBzY2FsZS5yYW5nZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG4gPSAocmFuZ2UgPSBzbGljZSQ1LmNhbGwoXykpLmxlbmd0aCAtIDEsIHJlc2NhbGUoKSkgOiByYW5nZS5zbGljZSgpOwogIH07CgogIHNjYWxlLmludmVydEV4dGVudCA9IGZ1bmN0aW9uKHkpIHsKICAgIHZhciBpID0gcmFuZ2UuaW5kZXhPZih5KTsKICAgIHJldHVybiBpIDwgMCA/IFtOYU4sIE5hTl0KICAgICAgICA6IGkgPCAxID8gW3gwLCBkb21haW5bMF1dCiAgICAgICAgOiBpID49IG4gPyBbZG9tYWluW24gLSAxXSwgeDFdCiAgICAgICAgOiBbZG9tYWluW2kgLSAxXSwgZG9tYWluW2ldXTsKICB9OwoKICBzY2FsZS5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gcXVhbnRpemUkMSgpCiAgICAgICAgLmRvbWFpbihbeDAsIHgxXSkKICAgICAgICAucmFuZ2UocmFuZ2UpOwogIH07CgogIHJldHVybiBsaW5lYXJpc2goc2NhbGUpOwp9CgpmdW5jdGlvbiB0aHJlc2hvbGQkMSgpIHsKICB2YXIgZG9tYWluID0gWzAuNV0sCiAgICAgIHJhbmdlID0gWzAsIDFdLAogICAgICBuID0gMTsKCiAgZnVuY3Rpb24gc2NhbGUoeCkgewogICAgaWYgKHggPD0geCkgcmV0dXJuIHJhbmdlW2Jpc2VjdFJpZ2h0KGRvbWFpbiwgeCwgMCwgbildOwogIH0KCiAgc2NhbGUuZG9tYWluID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZG9tYWluID0gc2xpY2UkNS5jYWxsKF8pLCBuID0gTWF0aC5taW4oZG9tYWluLmxlbmd0aCwgcmFuZ2UubGVuZ3RoIC0gMSksIHNjYWxlKSA6IGRvbWFpbi5zbGljZSgpOwogIH07CgogIHNjYWxlLnJhbmdlID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocmFuZ2UgPSBzbGljZSQ1LmNhbGwoXyksIG4gPSBNYXRoLm1pbihkb21haW4ubGVuZ3RoLCByYW5nZS5sZW5ndGggLSAxKSwgc2NhbGUpIDogcmFuZ2Uuc2xpY2UoKTsKICB9OwoKICBzY2FsZS5pbnZlcnRFeHRlbnQgPSBmdW5jdGlvbih5KSB7CiAgICB2YXIgaSA9IHJhbmdlLmluZGV4T2YoeSk7CiAgICByZXR1cm4gW2RvbWFpbltpIC0gMV0sIGRvbWFpbltpXV07CiAgfTsKCiAgc2NhbGUuY29weSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRocmVzaG9sZCQxKCkKICAgICAgICAuZG9tYWluKGRvbWFpbikKICAgICAgICAucmFuZ2UocmFuZ2UpOwogIH07CgogIHJldHVybiBzY2FsZTsKfQoKdmFyIHQwJDEgPSBuZXcgRGF0ZSwKICAgIHQxJDEgPSBuZXcgRGF0ZTsKCmZ1bmN0aW9uIG5ld0ludGVydmFsKGZsb29yaSwgb2Zmc2V0aSwgY291bnQsIGZpZWxkKSB7CgogIGZ1bmN0aW9uIGludGVydmFsKGRhdGUpIHsKICAgIHJldHVybiBmbG9vcmkoZGF0ZSA9IG5ldyBEYXRlKCtkYXRlKSksIGRhdGU7CiAgfQoKICBpbnRlcnZhbC5mbG9vciA9IGludGVydmFsOwoKICBpbnRlcnZhbC5jZWlsID0gZnVuY3Rpb24oZGF0ZSkgewogICAgcmV0dXJuIGZsb29yaShkYXRlID0gbmV3IERhdGUoZGF0ZSAtIDEpKSwgb2Zmc2V0aShkYXRlLCAxKSwgZmxvb3JpKGRhdGUpLCBkYXRlOwogIH07CgogIGludGVydmFsLnJvdW5kID0gZnVuY3Rpb24oZGF0ZSkgewogICAgdmFyIGQwID0gaW50ZXJ2YWwoZGF0ZSksCiAgICAgICAgZDEgPSBpbnRlcnZhbC5jZWlsKGRhdGUpOwogICAgcmV0dXJuIGRhdGUgLSBkMCA8IGQxIC0gZGF0ZSA/IGQwIDogZDE7CiAgfTsKCiAgaW50ZXJ2YWwub2Zmc2V0ID0gZnVuY3Rpb24oZGF0ZSwgc3RlcCkgewogICAgcmV0dXJuIG9mZnNldGkoZGF0ZSA9IG5ldyBEYXRlKCtkYXRlKSwgc3RlcCA9PSBudWxsID8gMSA6IE1hdGguZmxvb3Ioc3RlcCkpLCBkYXRlOwogIH07CgogIGludGVydmFsLnJhbmdlID0gZnVuY3Rpb24oc3RhcnQsIHN0b3AsIHN0ZXApIHsKICAgIHZhciByYW5nZSA9IFtdLCBwcmV2aW91czsKICAgIHN0YXJ0ID0gaW50ZXJ2YWwuY2VpbChzdGFydCk7CiAgICBzdGVwID0gc3RlcCA9PSBudWxsID8gMSA6IE1hdGguZmxvb3Ioc3RlcCk7CiAgICBpZiAoIShzdGFydCA8IHN0b3ApIHx8ICEoc3RlcCA+IDApKSByZXR1cm4gcmFuZ2U7IC8vIGFsc28gaGFuZGxlcyBJbnZhbGlkIERhdGUKICAgIGRvIHJhbmdlLnB1c2gocHJldmlvdXMgPSBuZXcgRGF0ZSgrc3RhcnQpKSwgb2Zmc2V0aShzdGFydCwgc3RlcCksIGZsb29yaShzdGFydCk7CiAgICB3aGlsZSAocHJldmlvdXMgPCBzdGFydCAmJiBzdGFydCA8IHN0b3ApOwogICAgcmV0dXJuIHJhbmdlOwogIH07CgogIGludGVydmFsLmZpbHRlciA9IGZ1bmN0aW9uKHRlc3QpIHsKICAgIHJldHVybiBuZXdJbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgICAgIGlmIChkYXRlID49IGRhdGUpIHdoaWxlIChmbG9vcmkoZGF0ZSksICF0ZXN0KGRhdGUpKSBkYXRlLnNldFRpbWUoZGF0ZSAtIDEpOwogICAgfSwgZnVuY3Rpb24oZGF0ZSwgc3RlcCkgewogICAgICBpZiAoZGF0ZSA+PSBkYXRlKSB7CiAgICAgICAgaWYgKHN0ZXAgPCAwKSB3aGlsZSAoKytzdGVwIDw9IDApIHsKICAgICAgICAgIHdoaWxlIChvZmZzZXRpKGRhdGUsIC0xKSwgIXRlc3QoZGF0ZSkpIHt9IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tZW1wdHkKICAgICAgICB9IGVsc2Ugd2hpbGUgKC0tc3RlcCA+PSAwKSB7CiAgICAgICAgICB3aGlsZSAob2Zmc2V0aShkYXRlLCArMSksICF0ZXN0KGRhdGUpKSB7fSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWVtcHR5CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9OwoKICBpZiAoY291bnQpIHsKICAgIGludGVydmFsLmNvdW50ID0gZnVuY3Rpb24oc3RhcnQsIGVuZCkgewogICAgICB0MCQxLnNldFRpbWUoK3N0YXJ0KSwgdDEkMS5zZXRUaW1lKCtlbmQpOwogICAgICBmbG9vcmkodDAkMSksIGZsb29yaSh0MSQxKTsKICAgICAgcmV0dXJuIE1hdGguZmxvb3IoY291bnQodDAkMSwgdDEkMSkpOwogICAgfTsKCiAgICBpbnRlcnZhbC5ldmVyeSA9IGZ1bmN0aW9uKHN0ZXApIHsKICAgICAgc3RlcCA9IE1hdGguZmxvb3Ioc3RlcCk7CiAgICAgIHJldHVybiAhaXNGaW5pdGUoc3RlcCkgfHwgIShzdGVwID4gMCkgPyBudWxsCiAgICAgICAgICA6ICEoc3RlcCA+IDEpID8gaW50ZXJ2YWwKICAgICAgICAgIDogaW50ZXJ2YWwuZmlsdGVyKGZpZWxkCiAgICAgICAgICAgICAgPyBmdW5jdGlvbihkKSB7IHJldHVybiBmaWVsZChkKSAlIHN0ZXAgPT09IDA7IH0KICAgICAgICAgICAgICA6IGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGludGVydmFsLmNvdW50KDAsIGQpICUgc3RlcCA9PT0gMDsgfSk7CiAgICB9OwogIH0KCiAgcmV0dXJuIGludGVydmFsOwp9Cgp2YXIgbWlsbGlzZWNvbmQgPSBuZXdJbnRlcnZhbChmdW5jdGlvbigpIHsKICAvLyBub29wCn0sIGZ1bmN0aW9uKGRhdGUsIHN0ZXApIHsKICBkYXRlLnNldFRpbWUoK2RhdGUgKyBzdGVwKTsKfSwgZnVuY3Rpb24oc3RhcnQsIGVuZCkgewogIHJldHVybiBlbmQgLSBzdGFydDsKfSk7CgovLyBBbiBvcHRpbWl6ZWQgaW1wbGVtZW50YXRpb24gZm9yIHRoaXMgc2ltcGxlIGNhc2UuCm1pbGxpc2Vjb25kLmV2ZXJ5ID0gZnVuY3Rpb24oaykgewogIGsgPSBNYXRoLmZsb29yKGspOwogIGlmICghaXNGaW5pdGUoaykgfHwgIShrID4gMCkpIHJldHVybiBudWxsOwogIGlmICghKGsgPiAxKSkgcmV0dXJuIG1pbGxpc2Vjb25kOwogIHJldHVybiBuZXdJbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgICBkYXRlLnNldFRpbWUoTWF0aC5mbG9vcihkYXRlIC8gaykgKiBrKTsKICB9LCBmdW5jdGlvbihkYXRlLCBzdGVwKSB7CiAgICBkYXRlLnNldFRpbWUoK2RhdGUgKyBzdGVwICogayk7CiAgfSwgZnVuY3Rpb24oc3RhcnQsIGVuZCkgewogICAgcmV0dXJuIChlbmQgLSBzdGFydCkgLyBrOwogIH0pOwp9Owp2YXIgbWlsbGlzZWNvbmRzID0gbWlsbGlzZWNvbmQucmFuZ2U7Cgp2YXIgZHVyYXRpb25TZWNvbmQgPSAxZTM7CnZhciBkdXJhdGlvbk1pbnV0ZSA9IDZlNDsKdmFyIGR1cmF0aW9uSG91ciA9IDM2ZTU7CnZhciBkdXJhdGlvbkRheSA9IDg2NGU1Owp2YXIgZHVyYXRpb25XZWVrID0gNjA0OGU1OwoKdmFyIHNlY29uZCA9IG5ld0ludGVydmFsKGZ1bmN0aW9uKGRhdGUpIHsKICBkYXRlLnNldFRpbWUoTWF0aC5mbG9vcihkYXRlIC8gZHVyYXRpb25TZWNvbmQpICogZHVyYXRpb25TZWNvbmQpOwp9LCBmdW5jdGlvbihkYXRlLCBzdGVwKSB7CiAgZGF0ZS5zZXRUaW1lKCtkYXRlICsgc3RlcCAqIGR1cmF0aW9uU2Vjb25kKTsKfSwgZnVuY3Rpb24oc3RhcnQsIGVuZCkgewogIHJldHVybiAoZW5kIC0gc3RhcnQpIC8gZHVyYXRpb25TZWNvbmQ7Cn0sIGZ1bmN0aW9uKGRhdGUpIHsKICByZXR1cm4gZGF0ZS5nZXRVVENTZWNvbmRzKCk7Cn0pOwp2YXIgc2Vjb25kcyA9IHNlY29uZC5yYW5nZTsKCnZhciBtaW51dGUgPSBuZXdJbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgZGF0ZS5zZXRUaW1lKE1hdGguZmxvb3IoZGF0ZSAvIGR1cmF0aW9uTWludXRlKSAqIGR1cmF0aW9uTWludXRlKTsKfSwgZnVuY3Rpb24oZGF0ZSwgc3RlcCkgewogIGRhdGUuc2V0VGltZSgrZGF0ZSArIHN0ZXAgKiBkdXJhdGlvbk1pbnV0ZSk7Cn0sIGZ1bmN0aW9uKHN0YXJ0LCBlbmQpIHsKICByZXR1cm4gKGVuZCAtIHN0YXJ0KSAvIGR1cmF0aW9uTWludXRlOwp9LCBmdW5jdGlvbihkYXRlKSB7CiAgcmV0dXJuIGRhdGUuZ2V0TWludXRlcygpOwp9KTsKdmFyIG1pbnV0ZXMgPSBtaW51dGUucmFuZ2U7Cgp2YXIgaG91ciA9IG5ld0ludGVydmFsKGZ1bmN0aW9uKGRhdGUpIHsKICB2YXIgb2Zmc2V0ID0gZGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpICogZHVyYXRpb25NaW51dGUgJSBkdXJhdGlvbkhvdXI7CiAgaWYgKG9mZnNldCA8IDApIG9mZnNldCArPSBkdXJhdGlvbkhvdXI7CiAgZGF0ZS5zZXRUaW1lKE1hdGguZmxvb3IoKCtkYXRlIC0gb2Zmc2V0KSAvIGR1cmF0aW9uSG91cikgKiBkdXJhdGlvbkhvdXIgKyBvZmZzZXQpOwp9LCBmdW5jdGlvbihkYXRlLCBzdGVwKSB7CiAgZGF0ZS5zZXRUaW1lKCtkYXRlICsgc3RlcCAqIGR1cmF0aW9uSG91cik7Cn0sIGZ1bmN0aW9uKHN0YXJ0LCBlbmQpIHsKICByZXR1cm4gKGVuZCAtIHN0YXJ0KSAvIGR1cmF0aW9uSG91cjsKfSwgZnVuY3Rpb24oZGF0ZSkgewogIHJldHVybiBkYXRlLmdldEhvdXJzKCk7Cn0pOwp2YXIgaG91cnMgPSBob3VyLnJhbmdlOwoKdmFyIGRheSA9IG5ld0ludGVydmFsKGZ1bmN0aW9uKGRhdGUpIHsKICBkYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApOwp9LCBmdW5jdGlvbihkYXRlLCBzdGVwKSB7CiAgZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpICsgc3RlcCk7Cn0sIGZ1bmN0aW9uKHN0YXJ0LCBlbmQpIHsKICByZXR1cm4gKGVuZCAtIHN0YXJ0IC0gKGVuZC5nZXRUaW1lem9uZU9mZnNldCgpIC0gc3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSkgKiBkdXJhdGlvbk1pbnV0ZSkgLyBkdXJhdGlvbkRheTsKfSwgZnVuY3Rpb24oZGF0ZSkgewogIHJldHVybiBkYXRlLmdldERhdGUoKSAtIDE7Cn0pOwp2YXIgZGF5cyA9IGRheS5yYW5nZTsKCmZ1bmN0aW9uIHdlZWtkYXkoaSkgewogIHJldHVybiBuZXdJbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgLSAoZGF0ZS5nZXREYXkoKSArIDcgLSBpKSAlIDcpOwogICAgZGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKTsKICB9LCBmdW5jdGlvbihkYXRlLCBzdGVwKSB7CiAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyBzdGVwICogNyk7CiAgfSwgZnVuY3Rpb24oc3RhcnQsIGVuZCkgewogICAgcmV0dXJuIChlbmQgLSBzdGFydCAtIChlbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAtIHN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkpICogZHVyYXRpb25NaW51dGUpIC8gZHVyYXRpb25XZWVrOwogIH0pOwp9Cgp2YXIgc3VuZGF5ID0gd2Vla2RheSgwKTsKdmFyIG1vbmRheSA9IHdlZWtkYXkoMSk7CnZhciB0dWVzZGF5ID0gd2Vla2RheSgyKTsKdmFyIHdlZG5lc2RheSA9IHdlZWtkYXkoMyk7CnZhciB0aHVyc2RheSA9IHdlZWtkYXkoNCk7CnZhciBmcmlkYXkgPSB3ZWVrZGF5KDUpOwp2YXIgc2F0dXJkYXkgPSB3ZWVrZGF5KDYpOwoKdmFyIHN1bmRheXMgPSBzdW5kYXkucmFuZ2U7CnZhciBtb25kYXlzID0gbW9uZGF5LnJhbmdlOwp2YXIgdHVlc2RheXMgPSB0dWVzZGF5LnJhbmdlOwp2YXIgd2VkbmVzZGF5cyA9IHdlZG5lc2RheS5yYW5nZTsKdmFyIHRodXJzZGF5cyA9IHRodXJzZGF5LnJhbmdlOwp2YXIgZnJpZGF5cyA9IGZyaWRheS5yYW5nZTsKdmFyIHNhdHVyZGF5cyA9IHNhdHVyZGF5LnJhbmdlOwoKdmFyIG1vbnRoID0gbmV3SW50ZXJ2YWwoZnVuY3Rpb24oZGF0ZSkgewogIGRhdGUuc2V0RGF0ZSgxKTsKICBkYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApOwp9LCBmdW5jdGlvbihkYXRlLCBzdGVwKSB7CiAgZGF0ZS5zZXRNb250aChkYXRlLmdldE1vbnRoKCkgKyBzdGVwKTsKfSwgZnVuY3Rpb24oc3RhcnQsIGVuZCkgewogIHJldHVybiBlbmQuZ2V0TW9udGgoKSAtIHN0YXJ0LmdldE1vbnRoKCkgKyAoZW5kLmdldEZ1bGxZZWFyKCkgLSBzdGFydC5nZXRGdWxsWWVhcigpKSAqIDEyOwp9LCBmdW5jdGlvbihkYXRlKSB7CiAgcmV0dXJuIGRhdGUuZ2V0TW9udGgoKTsKfSk7CnZhciBtb250aHMgPSBtb250aC5yYW5nZTsKCnZhciB5ZWFyID0gbmV3SW50ZXJ2YWwoZnVuY3Rpb24oZGF0ZSkgewogIGRhdGUuc2V0TW9udGgoMCwgMSk7CiAgZGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKTsKfSwgZnVuY3Rpb24oZGF0ZSwgc3RlcCkgewogIGRhdGUuc2V0RnVsbFllYXIoZGF0ZS5nZXRGdWxsWWVhcigpICsgc3RlcCk7Cn0sIGZ1bmN0aW9uKHN0YXJ0LCBlbmQpIHsKICByZXR1cm4gZW5kLmdldEZ1bGxZZWFyKCkgLSBzdGFydC5nZXRGdWxsWWVhcigpOwp9LCBmdW5jdGlvbihkYXRlKSB7CiAgcmV0dXJuIGRhdGUuZ2V0RnVsbFllYXIoKTsKfSk7CgovLyBBbiBvcHRpbWl6ZWQgaW1wbGVtZW50YXRpb24gZm9yIHRoaXMgc2ltcGxlIGNhc2UuCnllYXIuZXZlcnkgPSBmdW5jdGlvbihrKSB7CiAgcmV0dXJuICFpc0Zpbml0ZShrID0gTWF0aC5mbG9vcihrKSkgfHwgIShrID4gMCkgPyBudWxsIDogbmV3SW50ZXJ2YWwoZnVuY3Rpb24oZGF0ZSkgewogICAgZGF0ZS5zZXRGdWxsWWVhcihNYXRoLmZsb29yKGRhdGUuZ2V0RnVsbFllYXIoKSAvIGspICogayk7CiAgICBkYXRlLnNldE1vbnRoKDAsIDEpOwogICAgZGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKTsKICB9LCBmdW5jdGlvbihkYXRlLCBzdGVwKSB7CiAgICBkYXRlLnNldEZ1bGxZZWFyKGRhdGUuZ2V0RnVsbFllYXIoKSArIHN0ZXAgKiBrKTsKICB9KTsKfTsKdmFyIHllYXJzID0geWVhci5yYW5nZTsKCnZhciB1dGNNaW51dGUgPSBuZXdJbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgZGF0ZS5zZXRVVENTZWNvbmRzKDAsIDApOwp9LCBmdW5jdGlvbihkYXRlLCBzdGVwKSB7CiAgZGF0ZS5zZXRUaW1lKCtkYXRlICsgc3RlcCAqIGR1cmF0aW9uTWludXRlKTsKfSwgZnVuY3Rpb24oc3RhcnQsIGVuZCkgewogIHJldHVybiAoZW5kIC0gc3RhcnQpIC8gZHVyYXRpb25NaW51dGU7Cn0sIGZ1bmN0aW9uKGRhdGUpIHsKICByZXR1cm4gZGF0ZS5nZXRVVENNaW51dGVzKCk7Cn0pOwp2YXIgdXRjTWludXRlcyA9IHV0Y01pbnV0ZS5yYW5nZTsKCnZhciB1dGNIb3VyID0gbmV3SW50ZXJ2YWwoZnVuY3Rpb24oZGF0ZSkgewogIGRhdGUuc2V0VVRDTWludXRlcygwLCAwLCAwKTsKfSwgZnVuY3Rpb24oZGF0ZSwgc3RlcCkgewogIGRhdGUuc2V0VGltZSgrZGF0ZSArIHN0ZXAgKiBkdXJhdGlvbkhvdXIpOwp9LCBmdW5jdGlvbihzdGFydCwgZW5kKSB7CiAgcmV0dXJuIChlbmQgLSBzdGFydCkgLyBkdXJhdGlvbkhvdXI7Cn0sIGZ1bmN0aW9uKGRhdGUpIHsKICByZXR1cm4gZGF0ZS5nZXRVVENIb3VycygpOwp9KTsKdmFyIHV0Y0hvdXJzID0gdXRjSG91ci5yYW5nZTsKCnZhciB1dGNEYXkgPSBuZXdJbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgZGF0ZS5zZXRVVENIb3VycygwLCAwLCAwLCAwKTsKfSwgZnVuY3Rpb24oZGF0ZSwgc3RlcCkgewogIGRhdGUuc2V0VVRDRGF0ZShkYXRlLmdldFVUQ0RhdGUoKSArIHN0ZXApOwp9LCBmdW5jdGlvbihzdGFydCwgZW5kKSB7CiAgcmV0dXJuIChlbmQgLSBzdGFydCkgLyBkdXJhdGlvbkRheTsKfSwgZnVuY3Rpb24oZGF0ZSkgewogIHJldHVybiBkYXRlLmdldFVUQ0RhdGUoKSAtIDE7Cn0pOwp2YXIgdXRjRGF5cyA9IHV0Y0RheS5yYW5nZTsKCmZ1bmN0aW9uIHV0Y1dlZWtkYXkoaSkgewogIHJldHVybiBuZXdJbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgICBkYXRlLnNldFVUQ0RhdGUoZGF0ZS5nZXRVVENEYXRlKCkgLSAoZGF0ZS5nZXRVVENEYXkoKSArIDcgLSBpKSAlIDcpOwogICAgZGF0ZS5zZXRVVENIb3VycygwLCAwLCAwLCAwKTsKICB9LCBmdW5jdGlvbihkYXRlLCBzdGVwKSB7CiAgICBkYXRlLnNldFVUQ0RhdGUoZGF0ZS5nZXRVVENEYXRlKCkgKyBzdGVwICogNyk7CiAgfSwgZnVuY3Rpb24oc3RhcnQsIGVuZCkgewogICAgcmV0dXJuIChlbmQgLSBzdGFydCkgLyBkdXJhdGlvbldlZWs7CiAgfSk7Cn0KCnZhciB1dGNTdW5kYXkgPSB1dGNXZWVrZGF5KDApOwp2YXIgdXRjTW9uZGF5ID0gdXRjV2Vla2RheSgxKTsKdmFyIHV0Y1R1ZXNkYXkgPSB1dGNXZWVrZGF5KDIpOwp2YXIgdXRjV2VkbmVzZGF5ID0gdXRjV2Vla2RheSgzKTsKdmFyIHV0Y1RodXJzZGF5ID0gdXRjV2Vla2RheSg0KTsKdmFyIHV0Y0ZyaWRheSA9IHV0Y1dlZWtkYXkoNSk7CnZhciB1dGNTYXR1cmRheSA9IHV0Y1dlZWtkYXkoNik7Cgp2YXIgdXRjU3VuZGF5cyA9IHV0Y1N1bmRheS5yYW5nZTsKdmFyIHV0Y01vbmRheXMgPSB1dGNNb25kYXkucmFuZ2U7CnZhciB1dGNUdWVzZGF5cyA9IHV0Y1R1ZXNkYXkucmFuZ2U7CnZhciB1dGNXZWRuZXNkYXlzID0gdXRjV2VkbmVzZGF5LnJhbmdlOwp2YXIgdXRjVGh1cnNkYXlzID0gdXRjVGh1cnNkYXkucmFuZ2U7CnZhciB1dGNGcmlkYXlzID0gdXRjRnJpZGF5LnJhbmdlOwp2YXIgdXRjU2F0dXJkYXlzID0gdXRjU2F0dXJkYXkucmFuZ2U7Cgp2YXIgdXRjTW9udGggPSBuZXdJbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgZGF0ZS5zZXRVVENEYXRlKDEpOwogIGRhdGUuc2V0VVRDSG91cnMoMCwgMCwgMCwgMCk7Cn0sIGZ1bmN0aW9uKGRhdGUsIHN0ZXApIHsKICBkYXRlLnNldFVUQ01vbnRoKGRhdGUuZ2V0VVRDTW9udGgoKSArIHN0ZXApOwp9LCBmdW5jdGlvbihzdGFydCwgZW5kKSB7CiAgcmV0dXJuIGVuZC5nZXRVVENNb250aCgpIC0gc3RhcnQuZ2V0VVRDTW9udGgoKSArIChlbmQuZ2V0VVRDRnVsbFllYXIoKSAtIHN0YXJ0LmdldFVUQ0Z1bGxZZWFyKCkpICogMTI7Cn0sIGZ1bmN0aW9uKGRhdGUpIHsKICByZXR1cm4gZGF0ZS5nZXRVVENNb250aCgpOwp9KTsKdmFyIHV0Y01vbnRocyA9IHV0Y01vbnRoLnJhbmdlOwoKdmFyIHV0Y1llYXIgPSBuZXdJbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgZGF0ZS5zZXRVVENNb250aCgwLCAxKTsKICBkYXRlLnNldFVUQ0hvdXJzKDAsIDAsIDAsIDApOwp9LCBmdW5jdGlvbihkYXRlLCBzdGVwKSB7CiAgZGF0ZS5zZXRVVENGdWxsWWVhcihkYXRlLmdldFVUQ0Z1bGxZZWFyKCkgKyBzdGVwKTsKfSwgZnVuY3Rpb24oc3RhcnQsIGVuZCkgewogIHJldHVybiBlbmQuZ2V0VVRDRnVsbFllYXIoKSAtIHN0YXJ0LmdldFVUQ0Z1bGxZZWFyKCk7Cn0sIGZ1bmN0aW9uKGRhdGUpIHsKICByZXR1cm4gZGF0ZS5nZXRVVENGdWxsWWVhcigpOwp9KTsKCi8vIEFuIG9wdGltaXplZCBpbXBsZW1lbnRhdGlvbiBmb3IgdGhpcyBzaW1wbGUgY2FzZS4KdXRjWWVhci5ldmVyeSA9IGZ1bmN0aW9uKGspIHsKICByZXR1cm4gIWlzRmluaXRlKGsgPSBNYXRoLmZsb29yKGspKSB8fCAhKGsgPiAwKSA/IG51bGwgOiBuZXdJbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgICBkYXRlLnNldFVUQ0Z1bGxZZWFyKE1hdGguZmxvb3IoZGF0ZS5nZXRVVENGdWxsWWVhcigpIC8gaykgKiBrKTsKICAgIGRhdGUuc2V0VVRDTW9udGgoMCwgMSk7CiAgICBkYXRlLnNldFVUQ0hvdXJzKDAsIDAsIDAsIDApOwogIH0sIGZ1bmN0aW9uKGRhdGUsIHN0ZXApIHsKICAgIGRhdGUuc2V0VVRDRnVsbFllYXIoZGF0ZS5nZXRVVENGdWxsWWVhcigpICsgc3RlcCAqIGspOwogIH0pOwp9Owp2YXIgdXRjWWVhcnMgPSB1dGNZZWFyLnJhbmdlOwoKZnVuY3Rpb24gbG9jYWxEYXRlKGQpIHsKICBpZiAoMCA8PSBkLnkgJiYgZC55IDwgMTAwKSB7CiAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKC0xLCBkLm0sIGQuZCwgZC5ILCBkLk0sIGQuUywgZC5MKTsKICAgIGRhdGUuc2V0RnVsbFllYXIoZC55KTsKICAgIHJldHVybiBkYXRlOwogIH0KICByZXR1cm4gbmV3IERhdGUoZC55LCBkLm0sIGQuZCwgZC5ILCBkLk0sIGQuUywgZC5MKTsKfQoKZnVuY3Rpb24gdXRjRGF0ZShkKSB7CiAgaWYgKDAgPD0gZC55ICYmIGQueSA8IDEwMCkgewogICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShEYXRlLlVUQygtMSwgZC5tLCBkLmQsIGQuSCwgZC5NLCBkLlMsIGQuTCkpOwogICAgZGF0ZS5zZXRVVENGdWxsWWVhcihkLnkpOwogICAgcmV0dXJuIGRhdGU7CiAgfQogIHJldHVybiBuZXcgRGF0ZShEYXRlLlVUQyhkLnksIGQubSwgZC5kLCBkLkgsIGQuTSwgZC5TLCBkLkwpKTsKfQoKZnVuY3Rpb24gbmV3WWVhcih5KSB7CiAgcmV0dXJuIHt5OiB5LCBtOiAwLCBkOiAxLCBIOiAwLCBNOiAwLCBTOiAwLCBMOiAwfTsKfQoKZnVuY3Rpb24gZm9ybWF0TG9jYWxlJDEobG9jYWxlKSB7CiAgdmFyIGxvY2FsZV9kYXRlVGltZSA9IGxvY2FsZS5kYXRlVGltZSwKICAgICAgbG9jYWxlX2RhdGUgPSBsb2NhbGUuZGF0ZSwKICAgICAgbG9jYWxlX3RpbWUgPSBsb2NhbGUudGltZSwKICAgICAgbG9jYWxlX3BlcmlvZHMgPSBsb2NhbGUucGVyaW9kcywKICAgICAgbG9jYWxlX3dlZWtkYXlzID0gbG9jYWxlLmRheXMsCiAgICAgIGxvY2FsZV9zaG9ydFdlZWtkYXlzID0gbG9jYWxlLnNob3J0RGF5cywKICAgICAgbG9jYWxlX21vbnRocyA9IGxvY2FsZS5tb250aHMsCiAgICAgIGxvY2FsZV9zaG9ydE1vbnRocyA9IGxvY2FsZS5zaG9ydE1vbnRoczsKCiAgdmFyIHBlcmlvZFJlID0gZm9ybWF0UmUobG9jYWxlX3BlcmlvZHMpLAogICAgICBwZXJpb2RMb29rdXAgPSBmb3JtYXRMb29rdXAobG9jYWxlX3BlcmlvZHMpLAogICAgICB3ZWVrZGF5UmUgPSBmb3JtYXRSZShsb2NhbGVfd2Vla2RheXMpLAogICAgICB3ZWVrZGF5TG9va3VwID0gZm9ybWF0TG9va3VwKGxvY2FsZV93ZWVrZGF5cyksCiAgICAgIHNob3J0V2Vla2RheVJlID0gZm9ybWF0UmUobG9jYWxlX3Nob3J0V2Vla2RheXMpLAogICAgICBzaG9ydFdlZWtkYXlMb29rdXAgPSBmb3JtYXRMb29rdXAobG9jYWxlX3Nob3J0V2Vla2RheXMpLAogICAgICBtb250aFJlID0gZm9ybWF0UmUobG9jYWxlX21vbnRocyksCiAgICAgIG1vbnRoTG9va3VwID0gZm9ybWF0TG9va3VwKGxvY2FsZV9tb250aHMpLAogICAgICBzaG9ydE1vbnRoUmUgPSBmb3JtYXRSZShsb2NhbGVfc2hvcnRNb250aHMpLAogICAgICBzaG9ydE1vbnRoTG9va3VwID0gZm9ybWF0TG9va3VwKGxvY2FsZV9zaG9ydE1vbnRocyk7CgogIHZhciBmb3JtYXRzID0gewogICAgImEiOiBmb3JtYXRTaG9ydFdlZWtkYXksCiAgICAiQSI6IGZvcm1hdFdlZWtkYXksCiAgICAiYiI6IGZvcm1hdFNob3J0TW9udGgsCiAgICAiQiI6IGZvcm1hdE1vbnRoLAogICAgImMiOiBudWxsLAogICAgImQiOiBmb3JtYXREYXlPZk1vbnRoLAogICAgImUiOiBmb3JtYXREYXlPZk1vbnRoLAogICAgImYiOiBmb3JtYXRNaWNyb3NlY29uZHMsCiAgICAiSCI6IGZvcm1hdEhvdXIyNCwKICAgICJJIjogZm9ybWF0SG91cjEyLAogICAgImoiOiBmb3JtYXREYXlPZlllYXIsCiAgICAiTCI6IGZvcm1hdE1pbGxpc2Vjb25kcywKICAgICJtIjogZm9ybWF0TW9udGhOdW1iZXIsCiAgICAiTSI6IGZvcm1hdE1pbnV0ZXMsCiAgICAicCI6IGZvcm1hdFBlcmlvZCwKICAgICJRIjogZm9ybWF0VW5peFRpbWVzdGFtcCwKICAgICJzIjogZm9ybWF0VW5peFRpbWVzdGFtcFNlY29uZHMsCiAgICAiUyI6IGZvcm1hdFNlY29uZHMsCiAgICAidSI6IGZvcm1hdFdlZWtkYXlOdW1iZXJNb25kYXksCiAgICAiVSI6IGZvcm1hdFdlZWtOdW1iZXJTdW5kYXksCiAgICAiViI6IGZvcm1hdFdlZWtOdW1iZXJJU08sCiAgICAidyI6IGZvcm1hdFdlZWtkYXlOdW1iZXJTdW5kYXksCiAgICAiVyI6IGZvcm1hdFdlZWtOdW1iZXJNb25kYXksCiAgICAieCI6IG51bGwsCiAgICAiWCI6IG51bGwsCiAgICAieSI6IGZvcm1hdFllYXIsCiAgICAiWSI6IGZvcm1hdEZ1bGxZZWFyLAogICAgIloiOiBmb3JtYXRab25lLAogICAgIiUiOiBmb3JtYXRMaXRlcmFsUGVyY2VudAogIH07CgogIHZhciB1dGNGb3JtYXRzID0gewogICAgImEiOiBmb3JtYXRVVENTaG9ydFdlZWtkYXksCiAgICAiQSI6IGZvcm1hdFVUQ1dlZWtkYXksCiAgICAiYiI6IGZvcm1hdFVUQ1Nob3J0TW9udGgsCiAgICAiQiI6IGZvcm1hdFVUQ01vbnRoLAogICAgImMiOiBudWxsLAogICAgImQiOiBmb3JtYXRVVENEYXlPZk1vbnRoLAogICAgImUiOiBmb3JtYXRVVENEYXlPZk1vbnRoLAogICAgImYiOiBmb3JtYXRVVENNaWNyb3NlY29uZHMsCiAgICAiSCI6IGZvcm1hdFVUQ0hvdXIyNCwKICAgICJJIjogZm9ybWF0VVRDSG91cjEyLAogICAgImoiOiBmb3JtYXRVVENEYXlPZlllYXIsCiAgICAiTCI6IGZvcm1hdFVUQ01pbGxpc2Vjb25kcywKICAgICJtIjogZm9ybWF0VVRDTW9udGhOdW1iZXIsCiAgICAiTSI6IGZvcm1hdFVUQ01pbnV0ZXMsCiAgICAicCI6IGZvcm1hdFVUQ1BlcmlvZCwKICAgICJRIjogZm9ybWF0VW5peFRpbWVzdGFtcCwKICAgICJzIjogZm9ybWF0VW5peFRpbWVzdGFtcFNlY29uZHMsCiAgICAiUyI6IGZvcm1hdFVUQ1NlY29uZHMsCiAgICAidSI6IGZvcm1hdFVUQ1dlZWtkYXlOdW1iZXJNb25kYXksCiAgICAiVSI6IGZvcm1hdFVUQ1dlZWtOdW1iZXJTdW5kYXksCiAgICAiViI6IGZvcm1hdFVUQ1dlZWtOdW1iZXJJU08sCiAgICAidyI6IGZvcm1hdFVUQ1dlZWtkYXlOdW1iZXJTdW5kYXksCiAgICAiVyI6IGZvcm1hdFVUQ1dlZWtOdW1iZXJNb25kYXksCiAgICAieCI6IG51bGwsCiAgICAiWCI6IG51bGwsCiAgICAieSI6IGZvcm1hdFVUQ1llYXIsCiAgICAiWSI6IGZvcm1hdFVUQ0Z1bGxZZWFyLAogICAgIloiOiBmb3JtYXRVVENab25lLAogICAgIiUiOiBmb3JtYXRMaXRlcmFsUGVyY2VudAogIH07CgogIHZhciBwYXJzZXMgPSB7CiAgICAiYSI6IHBhcnNlU2hvcnRXZWVrZGF5LAogICAgIkEiOiBwYXJzZVdlZWtkYXksCiAgICAiYiI6IHBhcnNlU2hvcnRNb250aCwKICAgICJCIjogcGFyc2VNb250aCwKICAgICJjIjogcGFyc2VMb2NhbGVEYXRlVGltZSwKICAgICJkIjogcGFyc2VEYXlPZk1vbnRoLAogICAgImUiOiBwYXJzZURheU9mTW9udGgsCiAgICAiZiI6IHBhcnNlTWljcm9zZWNvbmRzLAogICAgIkgiOiBwYXJzZUhvdXIyNCwKICAgICJJIjogcGFyc2VIb3VyMjQsCiAgICAiaiI6IHBhcnNlRGF5T2ZZZWFyLAogICAgIkwiOiBwYXJzZU1pbGxpc2Vjb25kcywKICAgICJtIjogcGFyc2VNb250aE51bWJlciwKICAgICJNIjogcGFyc2VNaW51dGVzLAogICAgInAiOiBwYXJzZVBlcmlvZCwKICAgICJRIjogcGFyc2VVbml4VGltZXN0YW1wLAogICAgInMiOiBwYXJzZVVuaXhUaW1lc3RhbXBTZWNvbmRzLAogICAgIlMiOiBwYXJzZVNlY29uZHMsCiAgICAidSI6IHBhcnNlV2Vla2RheU51bWJlck1vbmRheSwKICAgICJVIjogcGFyc2VXZWVrTnVtYmVyU3VuZGF5LAogICAgIlYiOiBwYXJzZVdlZWtOdW1iZXJJU08sCiAgICAidyI6IHBhcnNlV2Vla2RheU51bWJlclN1bmRheSwKICAgICJXIjogcGFyc2VXZWVrTnVtYmVyTW9uZGF5LAogICAgIngiOiBwYXJzZUxvY2FsZURhdGUsCiAgICAiWCI6IHBhcnNlTG9jYWxlVGltZSwKICAgICJ5IjogcGFyc2VZZWFyLAogICAgIlkiOiBwYXJzZUZ1bGxZZWFyLAogICAgIloiOiBwYXJzZVpvbmUsCiAgICAiJSI6IHBhcnNlTGl0ZXJhbFBlcmNlbnQKICB9OwoKICAvLyBUaGVzZSByZWN1cnNpdmUgZGlyZWN0aXZlIGRlZmluaXRpb25zIG11c3QgYmUgZGVmZXJyZWQuCiAgZm9ybWF0cy54ID0gbmV3Rm9ybWF0KGxvY2FsZV9kYXRlLCBmb3JtYXRzKTsKICBmb3JtYXRzLlggPSBuZXdGb3JtYXQobG9jYWxlX3RpbWUsIGZvcm1hdHMpOwogIGZvcm1hdHMuYyA9IG5ld0Zvcm1hdChsb2NhbGVfZGF0ZVRpbWUsIGZvcm1hdHMpOwogIHV0Y0Zvcm1hdHMueCA9IG5ld0Zvcm1hdChsb2NhbGVfZGF0ZSwgdXRjRm9ybWF0cyk7CiAgdXRjRm9ybWF0cy5YID0gbmV3Rm9ybWF0KGxvY2FsZV90aW1lLCB1dGNGb3JtYXRzKTsKICB1dGNGb3JtYXRzLmMgPSBuZXdGb3JtYXQobG9jYWxlX2RhdGVUaW1lLCB1dGNGb3JtYXRzKTsKCiAgZnVuY3Rpb24gbmV3Rm9ybWF0KHNwZWNpZmllciwgZm9ybWF0cykgewogICAgcmV0dXJuIGZ1bmN0aW9uKGRhdGUpIHsKICAgICAgdmFyIHN0cmluZyA9IFtdLAogICAgICAgICAgaSA9IC0xLAogICAgICAgICAgaiA9IDAsCiAgICAgICAgICBuID0gc3BlY2lmaWVyLmxlbmd0aCwKICAgICAgICAgIGMsCiAgICAgICAgICBwYWQsCiAgICAgICAgICBmb3JtYXQ7CgogICAgICBpZiAoIShkYXRlIGluc3RhbmNlb2YgRGF0ZSkpIGRhdGUgPSBuZXcgRGF0ZSgrZGF0ZSk7CgogICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgIGlmIChzcGVjaWZpZXIuY2hhckNvZGVBdChpKSA9PT0gMzcpIHsKICAgICAgICAgIHN0cmluZy5wdXNoKHNwZWNpZmllci5zbGljZShqLCBpKSk7CiAgICAgICAgICBpZiAoKHBhZCA9IHBhZHNbYyA9IHNwZWNpZmllci5jaGFyQXQoKytpKV0pICE9IG51bGwpIGMgPSBzcGVjaWZpZXIuY2hhckF0KCsraSk7CiAgICAgICAgICBlbHNlIHBhZCA9IGMgPT09ICJlIiA/ICIgIiA6ICIwIjsKICAgICAgICAgIGlmIChmb3JtYXQgPSBmb3JtYXRzW2NdKSBjID0gZm9ybWF0KGRhdGUsIHBhZCk7CiAgICAgICAgICBzdHJpbmcucHVzaChjKTsKICAgICAgICAgIGogPSBpICsgMTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHN0cmluZy5wdXNoKHNwZWNpZmllci5zbGljZShqLCBpKSk7CiAgICAgIHJldHVybiBzdHJpbmcuam9pbigiIik7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gbmV3UGFyc2Uoc3BlY2lmaWVyLCBuZXdEYXRlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICAgIHZhciBkID0gbmV3WWVhcigxOTAwKSwKICAgICAgICAgIGkgPSBwYXJzZVNwZWNpZmllcihkLCBzcGVjaWZpZXIsIHN0cmluZyArPSAiIiwgMCksCiAgICAgICAgICB3ZWVrLCBkYXkkJDE7CiAgICAgIGlmIChpICE9IHN0cmluZy5sZW5ndGgpIHJldHVybiBudWxsOwoKICAgICAgLy8gSWYgYSBVTklYIHRpbWVzdGFtcCBpcyBzcGVjaWZpZWQsIHJldHVybiBpdC4KICAgICAgaWYgKCJRIiBpbiBkKSByZXR1cm4gbmV3IERhdGUoZC5RKTsKCiAgICAgIC8vIFRoZSBhbS1wbSBmbGFnIGlzIDAgZm9yIEFNLCBhbmQgMSBmb3IgUE0uCiAgICAgIGlmICgicCIgaW4gZCkgZC5IID0gZC5IICUgMTIgKyBkLnAgKiAxMjsKCiAgICAgIC8vIENvbnZlcnQgZGF5LW9mLXdlZWsgYW5kIHdlZWstb2YteWVhciB0byBkYXktb2YteWVhci4KICAgICAgaWYgKCJWIiBpbiBkKSB7CiAgICAgICAgaWYgKGQuViA8IDEgfHwgZC5WID4gNTMpIHJldHVybiBudWxsOwogICAgICAgIGlmICghKCJ3IiBpbiBkKSkgZC53ID0gMTsKICAgICAgICBpZiAoIloiIGluIGQpIHsKICAgICAgICAgIHdlZWsgPSB1dGNEYXRlKG5ld1llYXIoZC55KSksIGRheSQkMSA9IHdlZWsuZ2V0VVRDRGF5KCk7CiAgICAgICAgICB3ZWVrID0gZGF5JCQxID4gNCB8fCBkYXkkJDEgPT09IDAgPyB1dGNNb25kYXkuY2VpbCh3ZWVrKSA6IHV0Y01vbmRheSh3ZWVrKTsKICAgICAgICAgIHdlZWsgPSB1dGNEYXkub2Zmc2V0KHdlZWssIChkLlYgLSAxKSAqIDcpOwogICAgICAgICAgZC55ID0gd2Vlay5nZXRVVENGdWxsWWVhcigpOwogICAgICAgICAgZC5tID0gd2Vlay5nZXRVVENNb250aCgpOwogICAgICAgICAgZC5kID0gd2Vlay5nZXRVVENEYXRlKCkgKyAoZC53ICsgNikgJSA3OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3ZWVrID0gbmV3RGF0ZShuZXdZZWFyKGQueSkpLCBkYXkkJDEgPSB3ZWVrLmdldERheSgpOwogICAgICAgICAgd2VlayA9IGRheSQkMSA+IDQgfHwgZGF5JCQxID09PSAwID8gbW9uZGF5LmNlaWwod2VlaykgOiBtb25kYXkod2Vlayk7CiAgICAgICAgICB3ZWVrID0gZGF5Lm9mZnNldCh3ZWVrLCAoZC5WIC0gMSkgKiA3KTsKICAgICAgICAgIGQueSA9IHdlZWsuZ2V0RnVsbFllYXIoKTsKICAgICAgICAgIGQubSA9IHdlZWsuZ2V0TW9udGgoKTsKICAgICAgICAgIGQuZCA9IHdlZWsuZ2V0RGF0ZSgpICsgKGQudyArIDYpICUgNzsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoIlciIGluIGQgfHwgIlUiIGluIGQpIHsKICAgICAgICBpZiAoISgidyIgaW4gZCkpIGQudyA9ICJ1IiBpbiBkID8gZC51ICUgNyA6ICJXIiBpbiBkID8gMSA6IDA7CiAgICAgICAgZGF5JCQxID0gIloiIGluIGQgPyB1dGNEYXRlKG5ld1llYXIoZC55KSkuZ2V0VVRDRGF5KCkgOiBuZXdEYXRlKG5ld1llYXIoZC55KSkuZ2V0RGF5KCk7CiAgICAgICAgZC5tID0gMDsKICAgICAgICBkLmQgPSAiVyIgaW4gZCA/IChkLncgKyA2KSAlIDcgKyBkLlcgKiA3IC0gKGRheSQkMSArIDUpICUgNyA6IGQudyArIGQuVSAqIDcgLSAoZGF5JCQxICsgNikgJSA3OwogICAgICB9CgogICAgICAvLyBJZiBhIHRpbWUgem9uZSBpcyBzcGVjaWZpZWQsIGFsbCBmaWVsZHMgYXJlIGludGVycHJldGVkIGFzIFVUQyBhbmQgdGhlbgogICAgICAvLyBvZmZzZXQgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpZWQgdGltZSB6b25lLgogICAgICBpZiAoIloiIGluIGQpIHsKICAgICAgICBkLkggKz0gZC5aIC8gMTAwIHwgMDsKICAgICAgICBkLk0gKz0gZC5aICUgMTAwOwogICAgICAgIHJldHVybiB1dGNEYXRlKGQpOwogICAgICB9CgogICAgICAvLyBPdGhlcndpc2UsIGFsbCBmaWVsZHMgYXJlIGluIGxvY2FsIHRpbWUuCiAgICAgIHJldHVybiBuZXdEYXRlKGQpOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIHBhcnNlU3BlY2lmaWVyKGQsIHNwZWNpZmllciwgc3RyaW5nLCBqKSB7CiAgICB2YXIgaSA9IDAsCiAgICAgICAgbiA9IHNwZWNpZmllci5sZW5ndGgsCiAgICAgICAgbSA9IHN0cmluZy5sZW5ndGgsCiAgICAgICAgYywKICAgICAgICBwYXJzZTsKCiAgICB3aGlsZSAoaSA8IG4pIHsKICAgICAgaWYgKGogPj0gbSkgcmV0dXJuIC0xOwogICAgICBjID0gc3BlY2lmaWVyLmNoYXJDb2RlQXQoaSsrKTsKICAgICAgaWYgKGMgPT09IDM3KSB7CiAgICAgICAgYyA9IHNwZWNpZmllci5jaGFyQXQoaSsrKTsKICAgICAgICBwYXJzZSA9IHBhcnNlc1tjIGluIHBhZHMgPyBzcGVjaWZpZXIuY2hhckF0KGkrKykgOiBjXTsKICAgICAgICBpZiAoIXBhcnNlIHx8ICgoaiA9IHBhcnNlKGQsIHN0cmluZywgaikpIDwgMCkpIHJldHVybiAtMTsKICAgICAgfSBlbHNlIGlmIChjICE9IHN0cmluZy5jaGFyQ29kZUF0KGorKykpIHsKICAgICAgICByZXR1cm4gLTE7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gajsKICB9CgogIGZ1bmN0aW9uIHBhcnNlUGVyaW9kKGQsIHN0cmluZywgaSkgewogICAgdmFyIG4gPSBwZXJpb2RSZS5leGVjKHN0cmluZy5zbGljZShpKSk7CiAgICByZXR1cm4gbiA/IChkLnAgPSBwZXJpb2RMb29rdXBbblswXS50b0xvd2VyQ2FzZSgpXSwgaSArIG5bMF0ubGVuZ3RoKSA6IC0xOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VTaG9ydFdlZWtkYXkoZCwgc3RyaW5nLCBpKSB7CiAgICB2YXIgbiA9IHNob3J0V2Vla2RheVJlLmV4ZWMoc3RyaW5nLnNsaWNlKGkpKTsKICAgIHJldHVybiBuID8gKGQudyA9IHNob3J0V2Vla2RheUxvb2t1cFtuWzBdLnRvTG93ZXJDYXNlKCldLCBpICsgblswXS5sZW5ndGgpIDogLTE7CiAgfQoKICBmdW5jdGlvbiBwYXJzZVdlZWtkYXkoZCwgc3RyaW5nLCBpKSB7CiAgICB2YXIgbiA9IHdlZWtkYXlSZS5leGVjKHN0cmluZy5zbGljZShpKSk7CiAgICByZXR1cm4gbiA/IChkLncgPSB3ZWVrZGF5TG9va3VwW25bMF0udG9Mb3dlckNhc2UoKV0sIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKICB9CgogIGZ1bmN0aW9uIHBhcnNlU2hvcnRNb250aChkLCBzdHJpbmcsIGkpIHsKICAgIHZhciBuID0gc2hvcnRNb250aFJlLmV4ZWMoc3RyaW5nLnNsaWNlKGkpKTsKICAgIHJldHVybiBuID8gKGQubSA9IHNob3J0TW9udGhMb29rdXBbblswXS50b0xvd2VyQ2FzZSgpXSwgaSArIG5bMF0ubGVuZ3RoKSA6IC0xOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VNb250aChkLCBzdHJpbmcsIGkpIHsKICAgIHZhciBuID0gbW9udGhSZS5leGVjKHN0cmluZy5zbGljZShpKSk7CiAgICByZXR1cm4gbiA/IChkLm0gPSBtb250aExvb2t1cFtuWzBdLnRvTG93ZXJDYXNlKCldLCBpICsgblswXS5sZW5ndGgpIDogLTE7CiAgfQoKICBmdW5jdGlvbiBwYXJzZUxvY2FsZURhdGVUaW1lKGQsIHN0cmluZywgaSkgewogICAgcmV0dXJuIHBhcnNlU3BlY2lmaWVyKGQsIGxvY2FsZV9kYXRlVGltZSwgc3RyaW5nLCBpKTsKICB9CgogIGZ1bmN0aW9uIHBhcnNlTG9jYWxlRGF0ZShkLCBzdHJpbmcsIGkpIHsKICAgIHJldHVybiBwYXJzZVNwZWNpZmllcihkLCBsb2NhbGVfZGF0ZSwgc3RyaW5nLCBpKTsKICB9CgogIGZ1bmN0aW9uIHBhcnNlTG9jYWxlVGltZShkLCBzdHJpbmcsIGkpIHsKICAgIHJldHVybiBwYXJzZVNwZWNpZmllcihkLCBsb2NhbGVfdGltZSwgc3RyaW5nLCBpKTsKICB9CgogIGZ1bmN0aW9uIGZvcm1hdFNob3J0V2Vla2RheShkKSB7CiAgICByZXR1cm4gbG9jYWxlX3Nob3J0V2Vla2RheXNbZC5nZXREYXkoKV07CiAgfQoKICBmdW5jdGlvbiBmb3JtYXRXZWVrZGF5KGQpIHsKICAgIHJldHVybiBsb2NhbGVfd2Vla2RheXNbZC5nZXREYXkoKV07CiAgfQoKICBmdW5jdGlvbiBmb3JtYXRTaG9ydE1vbnRoKGQpIHsKICAgIHJldHVybiBsb2NhbGVfc2hvcnRNb250aHNbZC5nZXRNb250aCgpXTsKICB9CgogIGZ1bmN0aW9uIGZvcm1hdE1vbnRoKGQpIHsKICAgIHJldHVybiBsb2NhbGVfbW9udGhzW2QuZ2V0TW9udGgoKV07CiAgfQoKICBmdW5jdGlvbiBmb3JtYXRQZXJpb2QoZCkgewogICAgcmV0dXJuIGxvY2FsZV9wZXJpb2RzWysoZC5nZXRIb3VycygpID49IDEyKV07CiAgfQoKICBmdW5jdGlvbiBmb3JtYXRVVENTaG9ydFdlZWtkYXkoZCkgewogICAgcmV0dXJuIGxvY2FsZV9zaG9ydFdlZWtkYXlzW2QuZ2V0VVRDRGF5KCldOwogIH0KCiAgZnVuY3Rpb24gZm9ybWF0VVRDV2Vla2RheShkKSB7CiAgICByZXR1cm4gbG9jYWxlX3dlZWtkYXlzW2QuZ2V0VVRDRGF5KCldOwogIH0KCiAgZnVuY3Rpb24gZm9ybWF0VVRDU2hvcnRNb250aChkKSB7CiAgICByZXR1cm4gbG9jYWxlX3Nob3J0TW9udGhzW2QuZ2V0VVRDTW9udGgoKV07CiAgfQoKICBmdW5jdGlvbiBmb3JtYXRVVENNb250aChkKSB7CiAgICByZXR1cm4gbG9jYWxlX21vbnRoc1tkLmdldFVUQ01vbnRoKCldOwogIH0KCiAgZnVuY3Rpb24gZm9ybWF0VVRDUGVyaW9kKGQpIHsKICAgIHJldHVybiBsb2NhbGVfcGVyaW9kc1srKGQuZ2V0VVRDSG91cnMoKSA+PSAxMildOwogIH0KCiAgcmV0dXJuIHsKICAgIGZvcm1hdDogZnVuY3Rpb24oc3BlY2lmaWVyKSB7CiAgICAgIHZhciBmID0gbmV3Rm9ybWF0KHNwZWNpZmllciArPSAiIiwgZm9ybWF0cyk7CiAgICAgIGYudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHNwZWNpZmllcjsgfTsKICAgICAgcmV0dXJuIGY7CiAgICB9LAogICAgcGFyc2U6IGZ1bmN0aW9uKHNwZWNpZmllcikgewogICAgICB2YXIgcCA9IG5ld1BhcnNlKHNwZWNpZmllciArPSAiIiwgbG9jYWxEYXRlKTsKICAgICAgcC50b1N0cmluZyA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gc3BlY2lmaWVyOyB9OwogICAgICByZXR1cm4gcDsKICAgIH0sCiAgICB1dGNGb3JtYXQ6IGZ1bmN0aW9uKHNwZWNpZmllcikgewogICAgICB2YXIgZiA9IG5ld0Zvcm1hdChzcGVjaWZpZXIgKz0gIiIsIHV0Y0Zvcm1hdHMpOwogICAgICBmLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7IHJldHVybiBzcGVjaWZpZXI7IH07CiAgICAgIHJldHVybiBmOwogICAgfSwKICAgIHV0Y1BhcnNlOiBmdW5jdGlvbihzcGVjaWZpZXIpIHsKICAgICAgdmFyIHAgPSBuZXdQYXJzZShzcGVjaWZpZXIsIHV0Y0RhdGUpOwogICAgICBwLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7IHJldHVybiBzcGVjaWZpZXI7IH07CiAgICAgIHJldHVybiBwOwogICAgfQogIH07Cn0KCnZhciBwYWRzID0geyItIjogIiIsICJfIjogIiAiLCAiMCI6ICIwIn0sCiAgICBudW1iZXJSZSA9IC9eXHMqXGQrLywgLy8gbm90ZTogaWdub3JlcyBuZXh0IGRpcmVjdGl2ZQogICAgcGVyY2VudFJlID0gL14lLywKICAgIHJlcXVvdGVSZSA9IC9bXFxeJCorP3xbXF0oKS57fV0vZzsKCmZ1bmN0aW9uIHBhZCh2YWx1ZSwgZmlsbCwgd2lkdGgpIHsKICB2YXIgc2lnbiA9IHZhbHVlIDwgMCA/ICItIiA6ICIiLAogICAgICBzdHJpbmcgPSAoc2lnbiA/IC12YWx1ZSA6IHZhbHVlKSArICIiLAogICAgICBsZW5ndGggPSBzdHJpbmcubGVuZ3RoOwogIHJldHVybiBzaWduICsgKGxlbmd0aCA8IHdpZHRoID8gbmV3IEFycmF5KHdpZHRoIC0gbGVuZ3RoICsgMSkuam9pbihmaWxsKSArIHN0cmluZyA6IHN0cmluZyk7Cn0KCmZ1bmN0aW9uIHJlcXVvdGUocykgewogIHJldHVybiBzLnJlcGxhY2UocmVxdW90ZVJlLCAiXFwkJiIpOwp9CgpmdW5jdGlvbiBmb3JtYXRSZShuYW1lcykgewogIHJldHVybiBuZXcgUmVnRXhwKCJeKD86IiArIG5hbWVzLm1hcChyZXF1b3RlKS5qb2luKCJ8IikgKyAiKSIsICJpIik7Cn0KCmZ1bmN0aW9uIGZvcm1hdExvb2t1cChuYW1lcykgewogIHZhciBtYXAgPSB7fSwgaSA9IC0xLCBuID0gbmFtZXMubGVuZ3RoOwogIHdoaWxlICgrK2kgPCBuKSBtYXBbbmFtZXNbaV0udG9Mb3dlckNhc2UoKV0gPSBpOwogIHJldHVybiBtYXA7Cn0KCmZ1bmN0aW9uIHBhcnNlV2Vla2RheU51bWJlclN1bmRheShkLCBzdHJpbmcsIGkpIHsKICB2YXIgbiA9IG51bWJlclJlLmV4ZWMoc3RyaW5nLnNsaWNlKGksIGkgKyAxKSk7CiAgcmV0dXJuIG4gPyAoZC53ID0gK25bMF0sIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKfQoKZnVuY3Rpb24gcGFyc2VXZWVrZGF5TnVtYmVyTW9uZGF5KGQsIHN0cmluZywgaSkgewogIHZhciBuID0gbnVtYmVyUmUuZXhlYyhzdHJpbmcuc2xpY2UoaSwgaSArIDEpKTsKICByZXR1cm4gbiA/IChkLnUgPSArblswXSwgaSArIG5bMF0ubGVuZ3RoKSA6IC0xOwp9CgpmdW5jdGlvbiBwYXJzZVdlZWtOdW1iZXJTdW5kYXkoZCwgc3RyaW5nLCBpKSB7CiAgdmFyIG4gPSBudW1iZXJSZS5leGVjKHN0cmluZy5zbGljZShpLCBpICsgMikpOwogIHJldHVybiBuID8gKGQuVSA9ICtuWzBdLCBpICsgblswXS5sZW5ndGgpIDogLTE7Cn0KCmZ1bmN0aW9uIHBhcnNlV2Vla051bWJlcklTTyhkLCBzdHJpbmcsIGkpIHsKICB2YXIgbiA9IG51bWJlclJlLmV4ZWMoc3RyaW5nLnNsaWNlKGksIGkgKyAyKSk7CiAgcmV0dXJuIG4gPyAoZC5WID0gK25bMF0sIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKfQoKZnVuY3Rpb24gcGFyc2VXZWVrTnVtYmVyTW9uZGF5KGQsIHN0cmluZywgaSkgewogIHZhciBuID0gbnVtYmVyUmUuZXhlYyhzdHJpbmcuc2xpY2UoaSwgaSArIDIpKTsKICByZXR1cm4gbiA/IChkLlcgPSArblswXSwgaSArIG5bMF0ubGVuZ3RoKSA6IC0xOwp9CgpmdW5jdGlvbiBwYXJzZUZ1bGxZZWFyKGQsIHN0cmluZywgaSkgewogIHZhciBuID0gbnVtYmVyUmUuZXhlYyhzdHJpbmcuc2xpY2UoaSwgaSArIDQpKTsKICByZXR1cm4gbiA/IChkLnkgPSArblswXSwgaSArIG5bMF0ubGVuZ3RoKSA6IC0xOwp9CgpmdW5jdGlvbiBwYXJzZVllYXIoZCwgc3RyaW5nLCBpKSB7CiAgdmFyIG4gPSBudW1iZXJSZS5leGVjKHN0cmluZy5zbGljZShpLCBpICsgMikpOwogIHJldHVybiBuID8gKGQueSA9ICtuWzBdICsgKCtuWzBdID4gNjggPyAxOTAwIDogMjAwMCksIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKfQoKZnVuY3Rpb24gcGFyc2Vab25lKGQsIHN0cmluZywgaSkgewogIHZhciBuID0gL14oWil8KFsrLV1cZFxkKSg/Ojo/KFxkXGQpKT8vLmV4ZWMoc3RyaW5nLnNsaWNlKGksIGkgKyA2KSk7CiAgcmV0dXJuIG4gPyAoZC5aID0gblsxXSA/IDAgOiAtKG5bMl0gKyAoblszXSB8fCAiMDAiKSksIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKfQoKZnVuY3Rpb24gcGFyc2VNb250aE51bWJlcihkLCBzdHJpbmcsIGkpIHsKICB2YXIgbiA9IG51bWJlclJlLmV4ZWMoc3RyaW5nLnNsaWNlKGksIGkgKyAyKSk7CiAgcmV0dXJuIG4gPyAoZC5tID0gblswXSAtIDEsIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKfQoKZnVuY3Rpb24gcGFyc2VEYXlPZk1vbnRoKGQsIHN0cmluZywgaSkgewogIHZhciBuID0gbnVtYmVyUmUuZXhlYyhzdHJpbmcuc2xpY2UoaSwgaSArIDIpKTsKICByZXR1cm4gbiA/IChkLmQgPSArblswXSwgaSArIG5bMF0ubGVuZ3RoKSA6IC0xOwp9CgpmdW5jdGlvbiBwYXJzZURheU9mWWVhcihkLCBzdHJpbmcsIGkpIHsKICB2YXIgbiA9IG51bWJlclJlLmV4ZWMoc3RyaW5nLnNsaWNlKGksIGkgKyAzKSk7CiAgcmV0dXJuIG4gPyAoZC5tID0gMCwgZC5kID0gK25bMF0sIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKfQoKZnVuY3Rpb24gcGFyc2VIb3VyMjQoZCwgc3RyaW5nLCBpKSB7CiAgdmFyIG4gPSBudW1iZXJSZS5leGVjKHN0cmluZy5zbGljZShpLCBpICsgMikpOwogIHJldHVybiBuID8gKGQuSCA9ICtuWzBdLCBpICsgblswXS5sZW5ndGgpIDogLTE7Cn0KCmZ1bmN0aW9uIHBhcnNlTWludXRlcyhkLCBzdHJpbmcsIGkpIHsKICB2YXIgbiA9IG51bWJlclJlLmV4ZWMoc3RyaW5nLnNsaWNlKGksIGkgKyAyKSk7CiAgcmV0dXJuIG4gPyAoZC5NID0gK25bMF0sIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKfQoKZnVuY3Rpb24gcGFyc2VTZWNvbmRzKGQsIHN0cmluZywgaSkgewogIHZhciBuID0gbnVtYmVyUmUuZXhlYyhzdHJpbmcuc2xpY2UoaSwgaSArIDIpKTsKICByZXR1cm4gbiA/IChkLlMgPSArblswXSwgaSArIG5bMF0ubGVuZ3RoKSA6IC0xOwp9CgpmdW5jdGlvbiBwYXJzZU1pbGxpc2Vjb25kcyhkLCBzdHJpbmcsIGkpIHsKICB2YXIgbiA9IG51bWJlclJlLmV4ZWMoc3RyaW5nLnNsaWNlKGksIGkgKyAzKSk7CiAgcmV0dXJuIG4gPyAoZC5MID0gK25bMF0sIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKfQoKZnVuY3Rpb24gcGFyc2VNaWNyb3NlY29uZHMoZCwgc3RyaW5nLCBpKSB7CiAgdmFyIG4gPSBudW1iZXJSZS5leGVjKHN0cmluZy5zbGljZShpLCBpICsgNikpOwogIHJldHVybiBuID8gKGQuTCA9IE1hdGguZmxvb3IoblswXSAvIDEwMDApLCBpICsgblswXS5sZW5ndGgpIDogLTE7Cn0KCmZ1bmN0aW9uIHBhcnNlTGl0ZXJhbFBlcmNlbnQoZCwgc3RyaW5nLCBpKSB7CiAgdmFyIG4gPSBwZXJjZW50UmUuZXhlYyhzdHJpbmcuc2xpY2UoaSwgaSArIDEpKTsKICByZXR1cm4gbiA/IGkgKyBuWzBdLmxlbmd0aCA6IC0xOwp9CgpmdW5jdGlvbiBwYXJzZVVuaXhUaW1lc3RhbXAoZCwgc3RyaW5nLCBpKSB7CiAgdmFyIG4gPSBudW1iZXJSZS5leGVjKHN0cmluZy5zbGljZShpKSk7CiAgcmV0dXJuIG4gPyAoZC5RID0gK25bMF0sIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKfQoKZnVuY3Rpb24gcGFyc2VVbml4VGltZXN0YW1wU2Vjb25kcyhkLCBzdHJpbmcsIGkpIHsKICB2YXIgbiA9IG51bWJlclJlLmV4ZWMoc3RyaW5nLnNsaWNlKGkpKTsKICByZXR1cm4gbiA/IChkLlEgPSAoK25bMF0pICogMTAwMCwgaSArIG5bMF0ubGVuZ3RoKSA6IC0xOwp9CgpmdW5jdGlvbiBmb3JtYXREYXlPZk1vbnRoKGQsIHApIHsKICByZXR1cm4gcGFkKGQuZ2V0RGF0ZSgpLCBwLCAyKTsKfQoKZnVuY3Rpb24gZm9ybWF0SG91cjI0KGQsIHApIHsKICByZXR1cm4gcGFkKGQuZ2V0SG91cnMoKSwgcCwgMik7Cn0KCmZ1bmN0aW9uIGZvcm1hdEhvdXIxMihkLCBwKSB7CiAgcmV0dXJuIHBhZChkLmdldEhvdXJzKCkgJSAxMiB8fCAxMiwgcCwgMik7Cn0KCmZ1bmN0aW9uIGZvcm1hdERheU9mWWVhcihkLCBwKSB7CiAgcmV0dXJuIHBhZCgxICsgZGF5LmNvdW50KHllYXIoZCksIGQpLCBwLCAzKTsKfQoKZnVuY3Rpb24gZm9ybWF0TWlsbGlzZWNvbmRzKGQsIHApIHsKICByZXR1cm4gcGFkKGQuZ2V0TWlsbGlzZWNvbmRzKCksIHAsIDMpOwp9CgpmdW5jdGlvbiBmb3JtYXRNaWNyb3NlY29uZHMoZCwgcCkgewogIHJldHVybiBmb3JtYXRNaWxsaXNlY29uZHMoZCwgcCkgKyAiMDAwIjsKfQoKZnVuY3Rpb24gZm9ybWF0TW9udGhOdW1iZXIoZCwgcCkgewogIHJldHVybiBwYWQoZC5nZXRNb250aCgpICsgMSwgcCwgMik7Cn0KCmZ1bmN0aW9uIGZvcm1hdE1pbnV0ZXMoZCwgcCkgewogIHJldHVybiBwYWQoZC5nZXRNaW51dGVzKCksIHAsIDIpOwp9CgpmdW5jdGlvbiBmb3JtYXRTZWNvbmRzKGQsIHApIHsKICByZXR1cm4gcGFkKGQuZ2V0U2Vjb25kcygpLCBwLCAyKTsKfQoKZnVuY3Rpb24gZm9ybWF0V2Vla2RheU51bWJlck1vbmRheShkKSB7CiAgdmFyIGRheSQkMSA9IGQuZ2V0RGF5KCk7CiAgcmV0dXJuIGRheSQkMSA9PT0gMCA/IDcgOiBkYXkkJDE7Cn0KCmZ1bmN0aW9uIGZvcm1hdFdlZWtOdW1iZXJTdW5kYXkoZCwgcCkgewogIHJldHVybiBwYWQoc3VuZGF5LmNvdW50KHllYXIoZCksIGQpLCBwLCAyKTsKfQoKZnVuY3Rpb24gZm9ybWF0V2Vla051bWJlcklTTyhkLCBwKSB7CiAgdmFyIGRheSQkMSA9IGQuZ2V0RGF5KCk7CiAgZCA9IChkYXkkJDEgPj0gNCB8fCBkYXkkJDEgPT09IDApID8gdGh1cnNkYXkoZCkgOiB0aHVyc2RheS5jZWlsKGQpOwogIHJldHVybiBwYWQodGh1cnNkYXkuY291bnQoeWVhcihkKSwgZCkgKyAoeWVhcihkKS5nZXREYXkoKSA9PT0gNCksIHAsIDIpOwp9CgpmdW5jdGlvbiBmb3JtYXRXZWVrZGF5TnVtYmVyU3VuZGF5KGQpIHsKICByZXR1cm4gZC5nZXREYXkoKTsKfQoKZnVuY3Rpb24gZm9ybWF0V2Vla051bWJlck1vbmRheShkLCBwKSB7CiAgcmV0dXJuIHBhZChtb25kYXkuY291bnQoeWVhcihkKSwgZCksIHAsIDIpOwp9CgpmdW5jdGlvbiBmb3JtYXRZZWFyKGQsIHApIHsKICByZXR1cm4gcGFkKGQuZ2V0RnVsbFllYXIoKSAlIDEwMCwgcCwgMik7Cn0KCmZ1bmN0aW9uIGZvcm1hdEZ1bGxZZWFyKGQsIHApIHsKICByZXR1cm4gcGFkKGQuZ2V0RnVsbFllYXIoKSAlIDEwMDAwLCBwLCA0KTsKfQoKZnVuY3Rpb24gZm9ybWF0Wm9uZShkKSB7CiAgdmFyIHogPSBkLmdldFRpbWV6b25lT2Zmc2V0KCk7CiAgcmV0dXJuICh6ID4gMCA/ICItIiA6ICh6ICo9IC0xLCAiKyIpKQogICAgICArIHBhZCh6IC8gNjAgfCAwLCAiMCIsIDIpCiAgICAgICsgcGFkKHogJSA2MCwgIjAiLCAyKTsKfQoKZnVuY3Rpb24gZm9ybWF0VVRDRGF5T2ZNb250aChkLCBwKSB7CiAgcmV0dXJuIHBhZChkLmdldFVUQ0RhdGUoKSwgcCwgMik7Cn0KCmZ1bmN0aW9uIGZvcm1hdFVUQ0hvdXIyNChkLCBwKSB7CiAgcmV0dXJuIHBhZChkLmdldFVUQ0hvdXJzKCksIHAsIDIpOwp9CgpmdW5jdGlvbiBmb3JtYXRVVENIb3VyMTIoZCwgcCkgewogIHJldHVybiBwYWQoZC5nZXRVVENIb3VycygpICUgMTIgfHwgMTIsIHAsIDIpOwp9CgpmdW5jdGlvbiBmb3JtYXRVVENEYXlPZlllYXIoZCwgcCkgewogIHJldHVybiBwYWQoMSArIHV0Y0RheS5jb3VudCh1dGNZZWFyKGQpLCBkKSwgcCwgMyk7Cn0KCmZ1bmN0aW9uIGZvcm1hdFVUQ01pbGxpc2Vjb25kcyhkLCBwKSB7CiAgcmV0dXJuIHBhZChkLmdldFVUQ01pbGxpc2Vjb25kcygpLCBwLCAzKTsKfQoKZnVuY3Rpb24gZm9ybWF0VVRDTWljcm9zZWNvbmRzKGQsIHApIHsKICByZXR1cm4gZm9ybWF0VVRDTWlsbGlzZWNvbmRzKGQsIHApICsgIjAwMCI7Cn0KCmZ1bmN0aW9uIGZvcm1hdFVUQ01vbnRoTnVtYmVyKGQsIHApIHsKICByZXR1cm4gcGFkKGQuZ2V0VVRDTW9udGgoKSArIDEsIHAsIDIpOwp9CgpmdW5jdGlvbiBmb3JtYXRVVENNaW51dGVzKGQsIHApIHsKICByZXR1cm4gcGFkKGQuZ2V0VVRDTWludXRlcygpLCBwLCAyKTsKfQoKZnVuY3Rpb24gZm9ybWF0VVRDU2Vjb25kcyhkLCBwKSB7CiAgcmV0dXJuIHBhZChkLmdldFVUQ1NlY29uZHMoKSwgcCwgMik7Cn0KCmZ1bmN0aW9uIGZvcm1hdFVUQ1dlZWtkYXlOdW1iZXJNb25kYXkoZCkgewogIHZhciBkb3cgPSBkLmdldFVUQ0RheSgpOwogIHJldHVybiBkb3cgPT09IDAgPyA3IDogZG93Owp9CgpmdW5jdGlvbiBmb3JtYXRVVENXZWVrTnVtYmVyU3VuZGF5KGQsIHApIHsKICByZXR1cm4gcGFkKHV0Y1N1bmRheS5jb3VudCh1dGNZZWFyKGQpLCBkKSwgcCwgMik7Cn0KCmZ1bmN0aW9uIGZvcm1hdFVUQ1dlZWtOdW1iZXJJU08oZCwgcCkgewogIHZhciBkYXkkJDEgPSBkLmdldFVUQ0RheSgpOwogIGQgPSAoZGF5JCQxID49IDQgfHwgZGF5JCQxID09PSAwKSA/IHV0Y1RodXJzZGF5KGQpIDogdXRjVGh1cnNkYXkuY2VpbChkKTsKICByZXR1cm4gcGFkKHV0Y1RodXJzZGF5LmNvdW50KHV0Y1llYXIoZCksIGQpICsgKHV0Y1llYXIoZCkuZ2V0VVRDRGF5KCkgPT09IDQpLCBwLCAyKTsKfQoKZnVuY3Rpb24gZm9ybWF0VVRDV2Vla2RheU51bWJlclN1bmRheShkKSB7CiAgcmV0dXJuIGQuZ2V0VVRDRGF5KCk7Cn0KCmZ1bmN0aW9uIGZvcm1hdFVUQ1dlZWtOdW1iZXJNb25kYXkoZCwgcCkgewogIHJldHVybiBwYWQodXRjTW9uZGF5LmNvdW50KHV0Y1llYXIoZCksIGQpLCBwLCAyKTsKfQoKZnVuY3Rpb24gZm9ybWF0VVRDWWVhcihkLCBwKSB7CiAgcmV0dXJuIHBhZChkLmdldFVUQ0Z1bGxZZWFyKCkgJSAxMDAsIHAsIDIpOwp9CgpmdW5jdGlvbiBmb3JtYXRVVENGdWxsWWVhcihkLCBwKSB7CiAgcmV0dXJuIHBhZChkLmdldFVUQ0Z1bGxZZWFyKCkgJSAxMDAwMCwgcCwgNCk7Cn0KCmZ1bmN0aW9uIGZvcm1hdFVUQ1pvbmUoKSB7CiAgcmV0dXJuICIrMDAwMCI7Cn0KCmZ1bmN0aW9uIGZvcm1hdExpdGVyYWxQZXJjZW50KCkgewogIHJldHVybiAiJSI7Cn0KCmZ1bmN0aW9uIGZvcm1hdFVuaXhUaW1lc3RhbXAoZCkgewogIHJldHVybiArZDsKfQoKZnVuY3Rpb24gZm9ybWF0VW5peFRpbWVzdGFtcFNlY29uZHMoZCkgewogIHJldHVybiBNYXRoLmZsb29yKCtkIC8gMTAwMCk7Cn0KCnZhciBsb2NhbGUkMTsKCmRlZmF1bHRMb2NhbGUkMSh7CiAgZGF0ZVRpbWU6ICIleCwgJVgiLAogIGRhdGU6ICIlLW0vJS1kLyVZIiwKICB0aW1lOiAiJS1JOiVNOiVTICVwIiwKICBwZXJpb2RzOiBbIkFNIiwgIlBNIl0sCiAgZGF5czogWyJTdW5kYXkiLCAiTW9uZGF5IiwgIlR1ZXNkYXkiLCAiV2VkbmVzZGF5IiwgIlRodXJzZGF5IiwgIkZyaWRheSIsICJTYXR1cmRheSJdLAogIHNob3J0RGF5czogWyJTdW4iLCAiTW9uIiwgIlR1ZSIsICJXZWQiLCAiVGh1IiwgIkZyaSIsICJTYXQiXSwKICBtb250aHM6IFsiSmFudWFyeSIsICJGZWJydWFyeSIsICJNYXJjaCIsICJBcHJpbCIsICJNYXkiLCAiSnVuZSIsICJKdWx5IiwgIkF1Z3VzdCIsICJTZXB0ZW1iZXIiLCAiT2N0b2JlciIsICJOb3ZlbWJlciIsICJEZWNlbWJlciJdLAogIHNob3J0TW9udGhzOiBbIkphbiIsICJGZWIiLCAiTWFyIiwgIkFwciIsICJNYXkiLCAiSnVuIiwgIkp1bCIsICJBdWciLCAiU2VwIiwgIk9jdCIsICJOb3YiLCAiRGVjIl0KfSk7CgpmdW5jdGlvbiBkZWZhdWx0TG9jYWxlJDEoZGVmaW5pdGlvbikgewogIGxvY2FsZSQxID0gZm9ybWF0TG9jYWxlJDEoZGVmaW5pdGlvbik7CiAgZXhwb3J0cy50aW1lRm9ybWF0ID0gbG9jYWxlJDEuZm9ybWF0OwogIGV4cG9ydHMudGltZVBhcnNlID0gbG9jYWxlJDEucGFyc2U7CiAgZXhwb3J0cy51dGNGb3JtYXQgPSBsb2NhbGUkMS51dGNGb3JtYXQ7CiAgZXhwb3J0cy51dGNQYXJzZSA9IGxvY2FsZSQxLnV0Y1BhcnNlOwogIHJldHVybiBsb2NhbGUkMTsKfQoKdmFyIGlzb1NwZWNpZmllciA9ICIlWS0lbS0lZFQlSDolTTolUy4lTFoiOwoKZnVuY3Rpb24gZm9ybWF0SXNvTmF0aXZlKGRhdGUpIHsKICByZXR1cm4gZGF0ZS50b0lTT1N0cmluZygpOwp9Cgp2YXIgZm9ybWF0SXNvID0gRGF0ZS5wcm90b3R5cGUudG9JU09TdHJpbmcKICAgID8gZm9ybWF0SXNvTmF0aXZlCiAgICA6IGV4cG9ydHMudXRjRm9ybWF0KGlzb1NwZWNpZmllcik7CgpmdW5jdGlvbiBwYXJzZUlzb05hdGl2ZShzdHJpbmcpIHsKICB2YXIgZGF0ZSA9IG5ldyBEYXRlKHN0cmluZyk7CiAgcmV0dXJuIGlzTmFOKGRhdGUpID8gbnVsbCA6IGRhdGU7Cn0KCnZhciBwYXJzZUlzbyA9ICtuZXcgRGF0ZSgiMjAwMC0wMS0wMVQwMDowMDowMC4wMDBaIikKICAgID8gcGFyc2VJc29OYXRpdmUKICAgIDogZXhwb3J0cy51dGNQYXJzZShpc29TcGVjaWZpZXIpOwoKdmFyIGR1cmF0aW9uU2Vjb25kJDEgPSAxMDAwLAogICAgZHVyYXRpb25NaW51dGUkMSA9IGR1cmF0aW9uU2Vjb25kJDEgKiA2MCwKICAgIGR1cmF0aW9uSG91ciQxID0gZHVyYXRpb25NaW51dGUkMSAqIDYwLAogICAgZHVyYXRpb25EYXkkMSA9IGR1cmF0aW9uSG91ciQxICogMjQsCiAgICBkdXJhdGlvbldlZWskMSA9IGR1cmF0aW9uRGF5JDEgKiA3LAogICAgZHVyYXRpb25Nb250aCA9IGR1cmF0aW9uRGF5JDEgKiAzMCwKICAgIGR1cmF0aW9uWWVhciA9IGR1cmF0aW9uRGF5JDEgKiAzNjU7CgpmdW5jdGlvbiBkYXRlJDEodCkgewogIHJldHVybiBuZXcgRGF0ZSh0KTsKfQoKZnVuY3Rpb24gbnVtYmVyJDModCkgewogIHJldHVybiB0IGluc3RhbmNlb2YgRGF0ZSA/ICt0IDogK25ldyBEYXRlKCt0KTsKfQoKZnVuY3Rpb24gY2FsZW5kYXIoeWVhciQkMSwgbW9udGgkJDEsIHdlZWssIGRheSQkMSwgaG91ciQkMSwgbWludXRlJCQxLCBzZWNvbmQkJDEsIG1pbGxpc2Vjb25kJCQxLCBmb3JtYXQpIHsKICB2YXIgc2NhbGUgPSBjb250aW51b3VzKGRlaW50ZXJwb2xhdGVMaW5lYXIsIHJlaW50ZXJwb2xhdGUpLAogICAgICBpbnZlcnQgPSBzY2FsZS5pbnZlcnQsCiAgICAgIGRvbWFpbiA9IHNjYWxlLmRvbWFpbjsKCiAgdmFyIGZvcm1hdE1pbGxpc2Vjb25kID0gZm9ybWF0KCIuJUwiKSwKICAgICAgZm9ybWF0U2Vjb25kID0gZm9ybWF0KCI6JVMiKSwKICAgICAgZm9ybWF0TWludXRlID0gZm9ybWF0KCIlSTolTSIpLAogICAgICBmb3JtYXRIb3VyID0gZm9ybWF0KCIlSSAlcCIpLAogICAgICBmb3JtYXREYXkgPSBmb3JtYXQoIiVhICVkIiksCiAgICAgIGZvcm1hdFdlZWsgPSBmb3JtYXQoIiViICVkIiksCiAgICAgIGZvcm1hdE1vbnRoID0gZm9ybWF0KCIlQiIpLAogICAgICBmb3JtYXRZZWFyID0gZm9ybWF0KCIlWSIpOwoKICB2YXIgdGlja0ludGVydmFscyA9IFsKICAgIFtzZWNvbmQkJDEsICAxLCAgICAgIGR1cmF0aW9uU2Vjb25kJDFdLAogICAgW3NlY29uZCQkMSwgIDUsICA1ICogZHVyYXRpb25TZWNvbmQkMV0sCiAgICBbc2Vjb25kJCQxLCAxNSwgMTUgKiBkdXJhdGlvblNlY29uZCQxXSwKICAgIFtzZWNvbmQkJDEsIDMwLCAzMCAqIGR1cmF0aW9uU2Vjb25kJDFdLAogICAgW21pbnV0ZSQkMSwgIDEsICAgICAgZHVyYXRpb25NaW51dGUkMV0sCiAgICBbbWludXRlJCQxLCAgNSwgIDUgKiBkdXJhdGlvbk1pbnV0ZSQxXSwKICAgIFttaW51dGUkJDEsIDE1LCAxNSAqIGR1cmF0aW9uTWludXRlJDFdLAogICAgW21pbnV0ZSQkMSwgMzAsIDMwICogZHVyYXRpb25NaW51dGUkMV0sCiAgICBbICBob3VyJCQxLCAgMSwgICAgICBkdXJhdGlvbkhvdXIkMSAgXSwKICAgIFsgIGhvdXIkJDEsICAzLCAgMyAqIGR1cmF0aW9uSG91ciQxICBdLAogICAgWyAgaG91ciQkMSwgIDYsICA2ICogZHVyYXRpb25Ib3VyJDEgIF0sCiAgICBbICBob3VyJCQxLCAxMiwgMTIgKiBkdXJhdGlvbkhvdXIkMSAgXSwKICAgIFsgICBkYXkkJDEsICAxLCAgICAgIGR1cmF0aW9uRGF5JDEgICBdLAogICAgWyAgIGRheSQkMSwgIDIsICAyICogZHVyYXRpb25EYXkkMSAgIF0sCiAgICBbICB3ZWVrLCAgMSwgICAgICBkdXJhdGlvbldlZWskMSAgXSwKICAgIFsgbW9udGgkJDEsICAxLCAgICAgIGR1cmF0aW9uTW9udGggXSwKICAgIFsgbW9udGgkJDEsICAzLCAgMyAqIGR1cmF0aW9uTW9udGggXSwKICAgIFsgIHllYXIkJDEsICAxLCAgICAgIGR1cmF0aW9uWWVhciAgXQogIF07CgogIGZ1bmN0aW9uIHRpY2tGb3JtYXQoZGF0ZSQkMSkgewogICAgcmV0dXJuIChzZWNvbmQkJDEoZGF0ZSQkMSkgPCBkYXRlJCQxID8gZm9ybWF0TWlsbGlzZWNvbmQKICAgICAgICA6IG1pbnV0ZSQkMShkYXRlJCQxKSA8IGRhdGUkJDEgPyBmb3JtYXRTZWNvbmQKICAgICAgICA6IGhvdXIkJDEoZGF0ZSQkMSkgPCBkYXRlJCQxID8gZm9ybWF0TWludXRlCiAgICAgICAgOiBkYXkkJDEoZGF0ZSQkMSkgPCBkYXRlJCQxID8gZm9ybWF0SG91cgogICAgICAgIDogbW9udGgkJDEoZGF0ZSQkMSkgPCBkYXRlJCQxID8gKHdlZWsoZGF0ZSQkMSkgPCBkYXRlJCQxID8gZm9ybWF0RGF5IDogZm9ybWF0V2VlaykKICAgICAgICA6IHllYXIkJDEoZGF0ZSQkMSkgPCBkYXRlJCQxID8gZm9ybWF0TW9udGgKICAgICAgICA6IGZvcm1hdFllYXIpKGRhdGUkJDEpOwogIH0KCiAgZnVuY3Rpb24gdGlja0ludGVydmFsKGludGVydmFsLCBzdGFydCwgc3RvcCwgc3RlcCkgewogICAgaWYgKGludGVydmFsID09IG51bGwpIGludGVydmFsID0gMTA7CgogICAgLy8gSWYgYSBkZXNpcmVkIHRpY2sgY291bnQgaXMgc3BlY2lmaWVkLCBwaWNrIGEgcmVhc29uYWJsZSB0aWNrIGludGVydmFsCiAgICAvLyBiYXNlZCBvbiB0aGUgZXh0ZW50IG9mIHRoZSBkb21haW4gYW5kIGEgcm91Z2ggZXN0aW1hdGUgb2YgdGljayBzaXplLgogICAgLy8gT3RoZXJ3aXNlLCBhc3N1bWUgaW50ZXJ2YWwgaXMgYWxyZWFkeSBhIHRpbWUgaW50ZXJ2YWwgYW5kIHVzZSBpdC4KICAgIGlmICh0eXBlb2YgaW50ZXJ2YWwgPT09ICJudW1iZXIiKSB7CiAgICAgIHZhciB0YXJnZXQgPSBNYXRoLmFicyhzdG9wIC0gc3RhcnQpIC8gaW50ZXJ2YWwsCiAgICAgICAgICBpID0gYmlzZWN0b3IoZnVuY3Rpb24oaSkgeyByZXR1cm4gaVsyXTsgfSkucmlnaHQodGlja0ludGVydmFscywgdGFyZ2V0KTsKICAgICAgaWYgKGkgPT09IHRpY2tJbnRlcnZhbHMubGVuZ3RoKSB7CiAgICAgICAgc3RlcCA9IHRpY2tTdGVwKHN0YXJ0IC8gZHVyYXRpb25ZZWFyLCBzdG9wIC8gZHVyYXRpb25ZZWFyLCBpbnRlcnZhbCk7CiAgICAgICAgaW50ZXJ2YWwgPSB5ZWFyJCQxOwogICAgICB9IGVsc2UgaWYgKGkpIHsKICAgICAgICBpID0gdGlja0ludGVydmFsc1t0YXJnZXQgLyB0aWNrSW50ZXJ2YWxzW2kgLSAxXVsyXSA8IHRpY2tJbnRlcnZhbHNbaV1bMl0gLyB0YXJnZXQgPyBpIC0gMSA6IGldOwogICAgICAgIHN0ZXAgPSBpWzFdOwogICAgICAgIGludGVydmFsID0gaVswXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdGVwID0gTWF0aC5tYXgodGlja1N0ZXAoc3RhcnQsIHN0b3AsIGludGVydmFsKSwgMSk7CiAgICAgICAgaW50ZXJ2YWwgPSBtaWxsaXNlY29uZCQkMTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBzdGVwID09IG51bGwgPyBpbnRlcnZhbCA6IGludGVydmFsLmV2ZXJ5KHN0ZXApOwogIH0KCiAgc2NhbGUuaW52ZXJ0ID0gZnVuY3Rpb24oeSkgewogICAgcmV0dXJuIG5ldyBEYXRlKGludmVydCh5KSk7CiAgfTsKCiAgc2NhbGUuZG9tYWluID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyBkb21haW4obWFwJDIuY2FsbChfLCBudW1iZXIkMykpIDogZG9tYWluKCkubWFwKGRhdGUkMSk7CiAgfTsKCiAgc2NhbGUudGlja3MgPSBmdW5jdGlvbihpbnRlcnZhbCwgc3RlcCkgewogICAgdmFyIGQgPSBkb21haW4oKSwKICAgICAgICB0MCA9IGRbMF0sCiAgICAgICAgdDEgPSBkW2QubGVuZ3RoIC0gMV0sCiAgICAgICAgciA9IHQxIDwgdDAsCiAgICAgICAgdDsKICAgIGlmIChyKSB0ID0gdDAsIHQwID0gdDEsIHQxID0gdDsKICAgIHQgPSB0aWNrSW50ZXJ2YWwoaW50ZXJ2YWwsIHQwLCB0MSwgc3RlcCk7CiAgICB0ID0gdCA/IHQucmFuZ2UodDAsIHQxICsgMSkgOiBbXTsgLy8gaW5jbHVzaXZlIHN0b3AKICAgIHJldHVybiByID8gdC5yZXZlcnNlKCkgOiB0OwogIH07CgogIHNjYWxlLnRpY2tGb3JtYXQgPSBmdW5jdGlvbihjb3VudCwgc3BlY2lmaWVyKSB7CiAgICByZXR1cm4gc3BlY2lmaWVyID09IG51bGwgPyB0aWNrRm9ybWF0IDogZm9ybWF0KHNwZWNpZmllcik7CiAgfTsKCiAgc2NhbGUubmljZSA9IGZ1bmN0aW9uKGludGVydmFsLCBzdGVwKSB7CiAgICB2YXIgZCA9IGRvbWFpbigpOwogICAgcmV0dXJuIChpbnRlcnZhbCA9IHRpY2tJbnRlcnZhbChpbnRlcnZhbCwgZFswXSwgZFtkLmxlbmd0aCAtIDFdLCBzdGVwKSkKICAgICAgICA/IGRvbWFpbihuaWNlKGQsIGludGVydmFsKSkKICAgICAgICA6IHNjYWxlOwogIH07CgogIHNjYWxlLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBjb3B5KHNjYWxlLCBjYWxlbmRhcih5ZWFyJCQxLCBtb250aCQkMSwgd2VlaywgZGF5JCQxLCBob3VyJCQxLCBtaW51dGUkJDEsIHNlY29uZCQkMSwgbWlsbGlzZWNvbmQkJDEsIGZvcm1hdCkpOwogIH07CgogIHJldHVybiBzY2FsZTsKfQoKZnVuY3Rpb24gdGltZSgpIHsKICByZXR1cm4gY2FsZW5kYXIoeWVhciwgbW9udGgsIHN1bmRheSwgZGF5LCBob3VyLCBtaW51dGUsIHNlY29uZCwgbWlsbGlzZWNvbmQsIGV4cG9ydHMudGltZUZvcm1hdCkuZG9tYWluKFtuZXcgRGF0ZSgyMDAwLCAwLCAxKSwgbmV3IERhdGUoMjAwMCwgMCwgMildKTsKfQoKZnVuY3Rpb24gdXRjVGltZSgpIHsKICByZXR1cm4gY2FsZW5kYXIodXRjWWVhciwgdXRjTW9udGgsIHV0Y1N1bmRheSwgdXRjRGF5LCB1dGNIb3VyLCB1dGNNaW51dGUsIHNlY29uZCwgbWlsbGlzZWNvbmQsIGV4cG9ydHMudXRjRm9ybWF0KS5kb21haW4oW0RhdGUuVVRDKDIwMDAsIDAsIDEpLCBEYXRlLlVUQygyMDAwLCAwLCAyKV0pOwp9CgpmdW5jdGlvbiBzZXF1ZW50aWFsKGludGVycG9sYXRvcikgewogIHZhciB4MCA9IDAsCiAgICAgIHgxID0gMSwKICAgICAgY2xhbXAgPSBmYWxzZTsKCiAgZnVuY3Rpb24gc2NhbGUoeCkgewogICAgdmFyIHQgPSAoeCAtIHgwKSAvICh4MSAtIHgwKTsKICAgIHJldHVybiBpbnRlcnBvbGF0b3IoY2xhbXAgPyBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCB0KSkgOiB0KTsKICB9CgogIHNjYWxlLmRvbWFpbiA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHgwID0gK19bMF0sIHgxID0gK19bMV0sIHNjYWxlKSA6IFt4MCwgeDFdOwogIH07CgogIHNjYWxlLmNsYW1wID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoY2xhbXAgPSAhIV8sIHNjYWxlKSA6IGNsYW1wOwogIH07CgogIHNjYWxlLmludGVycG9sYXRvciA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGludGVycG9sYXRvciA9IF8sIHNjYWxlKSA6IGludGVycG9sYXRvcjsKICB9OwoKICBzY2FsZS5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gc2VxdWVudGlhbChpbnRlcnBvbGF0b3IpLmRvbWFpbihbeDAsIHgxXSkuY2xhbXAoY2xhbXApOwogIH07CgogIHJldHVybiBsaW5lYXJpc2goc2NhbGUpOwp9CgpmdW5jdGlvbiBjb2xvcnMoc3BlY2lmaWVyKSB7CiAgdmFyIG4gPSBzcGVjaWZpZXIubGVuZ3RoIC8gNiB8IDAsIGNvbG9ycyA9IG5ldyBBcnJheShuKSwgaSA9IDA7CiAgd2hpbGUgKGkgPCBuKSBjb2xvcnNbaV0gPSAiIyIgKyBzcGVjaWZpZXIuc2xpY2UoaSAqIDYsICsraSAqIDYpOwogIHJldHVybiBjb2xvcnM7Cn0KCnZhciBjYXRlZ29yeTEwID0gY29sb3JzKCIxZjc3YjRmZjdmMGUyY2EwMmNkNjI3Mjg5NDY3YmQ4YzU2NGJlMzc3YzI3ZjdmN2ZiY2JkMjIxN2JlY2YiKTsKCnZhciBBY2NlbnQgPSBjb2xvcnMoIjdmYzk3ZmJlYWVkNGZkYzA4NmZmZmY5OTM4NmNiMGYwMDI3ZmJmNWIxNzY2NjY2NiIpOwoKdmFyIERhcmsyID0gY29sb3JzKCIxYjllNzdkOTVmMDI3NTcwYjNlNzI5OGE2NmE2MWVlNmFiMDJhNjc2MWQ2NjY2NjYiKTsKCnZhciBQYWlyZWQgPSBjb2xvcnMoImE2Y2VlMzFmNzhiNGIyZGY4YTMzYTAyY2ZiOWE5OWUzMWExY2ZkYmY2ZmZmN2YwMGNhYjJkNjZhM2Q5YWZmZmY5OWIxNTkyOCIpOwoKdmFyIFBhc3RlbDEgPSBjb2xvcnMoImZiYjRhZWIzY2RlM2NjZWJjNWRlY2JlNGZlZDlhNmZmZmZjY2U1ZDhiZGZkZGFlY2YyZjJmMiIpOwoKdmFyIFBhc3RlbDIgPSBjb2xvcnMoImIzZTJjZGZkY2RhY2NiZDVlOGY0Y2FlNGU2ZjVjOWZmZjJhZWYxZTJjY2NjY2NjYyIpOwoKdmFyIFNldDEgPSBjb2xvcnMoImU0MWExYzM3N2ViODRkYWY0YTk4NGVhM2ZmN2YwMGZmZmYzM2E2NTYyOGY3ODFiZjk5OTk5OSIpOwoKdmFyIFNldDIgPSBjb2xvcnMoIjY2YzJhNWZjOGQ2MjhkYTBjYmU3OGFjM2E2ZDg1NGZmZDkyZmU1YzQ5NGIzYjNiMyIpOwoKdmFyIFNldDMgPSBjb2xvcnMoIjhkZDNjN2ZmZmZiM2JlYmFkYWZiODA3MjgwYjFkM2ZkYjQ2MmIzZGU2OWZjY2RlNWQ5ZDlkOWJjODBiZGNjZWJjNWZmZWQ2ZiIpOwoKZnVuY3Rpb24gcmFtcChzY2hlbWUpIHsKICByZXR1cm4gcmdiQmFzaXMoc2NoZW1lW3NjaGVtZS5sZW5ndGggLSAxXSk7Cn0KCnZhciBzY2hlbWUgPSBuZXcgQXJyYXkoMykuY29uY2F0KAogICJkOGIzNjVmNWY1ZjU1YWI0YWMiLAogICJhNjYxMWFkZmMyN2Q4MGNkYzEwMTg1NzEiLAogICJhNjYxMWFkZmMyN2RmNWY1ZjU4MGNkYzEwMTg1NzEiLAogICI4YzUxMGFkOGIzNjVmNmU4YzNjN2VhZTU1YWI0YWMwMTY2NWUiLAogICI4YzUxMGFkOGIzNjVmNmU4YzNmNWY1ZjVjN2VhZTU1YWI0YWMwMTY2NWUiLAogICI4YzUxMGFiZjgxMmRkZmMyN2RmNmU4YzNjN2VhZTU4MGNkYzEzNTk3OGYwMTY2NWUiLAogICI4YzUxMGFiZjgxMmRkZmMyN2RmNmU4YzNmNWY1ZjVjN2VhZTU4MGNkYzEzNTk3OGYwMTY2NWUiLAogICI1NDMwMDU4YzUxMGFiZjgxMmRkZmMyN2RmNmU4YzNjN2VhZTU4MGNkYzEzNTk3OGYwMTY2NWUwMDNjMzAiLAogICI1NDMwMDU4YzUxMGFiZjgxMmRkZmMyN2RmNmU4YzNmNWY1ZjVjN2VhZTU4MGNkYzEzNTk3OGYwMTY2NWUwMDNjMzAiCikubWFwKGNvbG9ycyk7Cgp2YXIgQnJCRyA9IHJhbXAoc2NoZW1lKTsKCnZhciBzY2hlbWUkMSA9IG5ldyBBcnJheSgzKS5jb25jYXQoCiAgImFmOGRjM2Y3ZjdmNzdmYmY3YiIsCiAgIjdiMzI5NGMyYTVjZmE2ZGJhMDAwODgzNyIsCiAgIjdiMzI5NGMyYTVjZmY3ZjdmN2E2ZGJhMDAwODgzNyIsCiAgIjc2MmE4M2FmOGRjM2U3ZDRlOGQ5ZjBkMzdmYmY3YjFiNzgzNyIsCiAgIjc2MmE4M2FmOGRjM2U3ZDRlOGY3ZjdmN2Q5ZjBkMzdmYmY3YjFiNzgzNyIsCiAgIjc2MmE4Mzk5NzBhYmMyYTVjZmU3ZDRlOGQ5ZjBkM2E2ZGJhMDVhYWU2MTFiNzgzNyIsCiAgIjc2MmE4Mzk5NzBhYmMyYTVjZmU3ZDRlOGY3ZjdmN2Q5ZjBkM2E2ZGJhMDVhYWU2MTFiNzgzNyIsCiAgIjQwMDA0Yjc2MmE4Mzk5NzBhYmMyYTVjZmU3ZDRlOGQ5ZjBkM2E2ZGJhMDVhYWU2MTFiNzgzNzAwNDQxYiIsCiAgIjQwMDA0Yjc2MmE4Mzk5NzBhYmMyYTVjZmU3ZDRlOGY3ZjdmN2Q5ZjBkM2E2ZGJhMDVhYWU2MTFiNzgzNzAwNDQxYiIKKS5tYXAoY29sb3JzKTsKCnZhciBQUkduID0gcmFtcChzY2hlbWUkMSk7Cgp2YXIgc2NoZW1lJDIgPSBuZXcgQXJyYXkoMykuY29uY2F0KAogICJlOWEzYzlmN2Y3ZjdhMWQ3NmEiLAogICJkMDFjOGJmMWI2ZGFiOGUxODY0ZGFjMjYiLAogICJkMDFjOGJmMWI2ZGFmN2Y3ZjdiOGUxODY0ZGFjMjYiLAogICJjNTFiN2RlOWEzYzlmZGUwZWZlNmY1ZDBhMWQ3NmE0ZDkyMjEiLAogICJjNTFiN2RlOWEzYzlmZGUwZWZmN2Y3ZjdlNmY1ZDBhMWQ3NmE0ZDkyMjEiLAogICJjNTFiN2RkZTc3YWVmMWI2ZGFmZGUwZWZlNmY1ZDBiOGUxODY3ZmJjNDE0ZDkyMjEiLAogICJjNTFiN2RkZTc3YWVmMWI2ZGFmZGUwZWZmN2Y3ZjdlNmY1ZDBiOGUxODY3ZmJjNDE0ZDkyMjEiLAogICI4ZTAxNTJjNTFiN2RkZTc3YWVmMWI2ZGFmZGUwZWZlNmY1ZDBiOGUxODY3ZmJjNDE0ZDkyMjEyNzY0MTkiLAogICI4ZTAxNTJjNTFiN2RkZTc3YWVmMWI2ZGFmZGUwZWZmN2Y3ZjdlNmY1ZDBiOGUxODY3ZmJjNDE0ZDkyMjEyNzY0MTkiCikubWFwKGNvbG9ycyk7Cgp2YXIgUGlZRyA9IHJhbXAoc2NoZW1lJDIpOwoKdmFyIHNjaGVtZSQzID0gbmV3IEFycmF5KDMpLmNvbmNhdCgKICAiOTk4ZWMzZjdmN2Y3ZjFhMzQwIiwKICAiNWUzYzk5YjJhYmQyZmRiODYzZTY2MTAxIiwKICAiNWUzYzk5YjJhYmQyZjdmN2Y3ZmRiODYzZTY2MTAxIiwKICAiNTQyNzg4OTk4ZWMzZDhkYWViZmVlMGI2ZjFhMzQwYjM1ODA2IiwKICAiNTQyNzg4OTk4ZWMzZDhkYWViZjdmN2Y3ZmVlMGI2ZjFhMzQwYjM1ODA2IiwKICAiNTQyNzg4ODA3M2FjYjJhYmQyZDhkYWViZmVlMGI2ZmRiODYzZTA4MjE0YjM1ODA2IiwKICAiNTQyNzg4ODA3M2FjYjJhYmQyZDhkYWViZjdmN2Y3ZmVlMGI2ZmRiODYzZTA4MjE0YjM1ODA2IiwKICAiMmQwMDRiNTQyNzg4ODA3M2FjYjJhYmQyZDhkYWViZmVlMGI2ZmRiODYzZTA4MjE0YjM1ODA2N2YzYjA4IiwKICAiMmQwMDRiNTQyNzg4ODA3M2FjYjJhYmQyZDhkYWViZjdmN2Y3ZmVlMGI2ZmRiODYzZTA4MjE0YjM1ODA2N2YzYjA4IgopLm1hcChjb2xvcnMpOwoKdmFyIFB1T3IgPSByYW1wKHNjaGVtZSQzKTsKCnZhciBzY2hlbWUkNCA9IG5ldyBBcnJheSgzKS5jb25jYXQoCiAgImVmOGE2MmY3ZjdmNzY3YTljZiIsCiAgImNhMDAyMGY0YTU4MjkyYzVkZTA1NzFiMCIsCiAgImNhMDAyMGY0YTU4MmY3ZjdmNzkyYzVkZTA1NzFiMCIsCiAgImIyMTgyYmVmOGE2MmZkZGJjN2QxZTVmMDY3YTljZjIxNjZhYyIsCiAgImIyMTgyYmVmOGE2MmZkZGJjN2Y3ZjdmN2QxZTVmMDY3YTljZjIxNjZhYyIsCiAgImIyMTgyYmQ2NjA0ZGY0YTU4MmZkZGJjN2QxZTVmMDkyYzVkZTQzOTNjMzIxNjZhYyIsCiAgImIyMTgyYmQ2NjA0ZGY0YTU4MmZkZGJjN2Y3ZjdmN2QxZTVmMDkyYzVkZTQzOTNjMzIxNjZhYyIsCiAgIjY3MDAxZmIyMTgyYmQ2NjA0ZGY0YTU4MmZkZGJjN2QxZTVmMDkyYzVkZTQzOTNjMzIxNjZhYzA1MzA2MSIsCiAgIjY3MDAxZmIyMTgyYmQ2NjA0ZGY0YTU4MmZkZGJjN2Y3ZjdmN2QxZTVmMDkyYzVkZTQzOTNjMzIxNjZhYzA1MzA2MSIKKS5tYXAoY29sb3JzKTsKCnZhciBSZEJ1ID0gcmFtcChzY2hlbWUkNCk7Cgp2YXIgc2NoZW1lJDUgPSBuZXcgQXJyYXkoMykuY29uY2F0KAogICJlZjhhNjJmZmZmZmY5OTk5OTkiLAogICJjYTAwMjBmNGE1ODJiYWJhYmE0MDQwNDAiLAogICJjYTAwMjBmNGE1ODJmZmZmZmZiYWJhYmE0MDQwNDAiLAogICJiMjE4MmJlZjhhNjJmZGRiYzdlMGUwZTA5OTk5OTk0ZDRkNGQiLAogICJiMjE4MmJlZjhhNjJmZGRiYzdmZmZmZmZlMGUwZTA5OTk5OTk0ZDRkNGQiLAogICJiMjE4MmJkNjYwNGRmNGE1ODJmZGRiYzdlMGUwZTBiYWJhYmE4Nzg3ODc0ZDRkNGQiLAogICJiMjE4MmJkNjYwNGRmNGE1ODJmZGRiYzdmZmZmZmZlMGUwZTBiYWJhYmE4Nzg3ODc0ZDRkNGQiLAogICI2NzAwMWZiMjE4MmJkNjYwNGRmNGE1ODJmZGRiYzdlMGUwZTBiYWJhYmE4Nzg3ODc0ZDRkNGQxYTFhMWEiLAogICI2NzAwMWZiMjE4MmJkNjYwNGRmNGE1ODJmZGRiYzdmZmZmZmZlMGUwZTBiYWJhYmE4Nzg3ODc0ZDRkNGQxYTFhMWEiCikubWFwKGNvbG9ycyk7Cgp2YXIgUmRHeSA9IHJhbXAoc2NoZW1lJDUpOwoKdmFyIHNjaGVtZSQ2ID0gbmV3IEFycmF5KDMpLmNvbmNhdCgKICAiZmM4ZDU5ZmZmZmJmOTFiZmRiIiwKICAiZDcxOTFjZmRhZTYxYWJkOWU5MmM3YmI2IiwKICAiZDcxOTFjZmRhZTYxZmZmZmJmYWJkOWU5MmM3YmI2IiwKICAiZDczMDI3ZmM4ZDU5ZmVlMDkwZTBmM2Y4OTFiZmRiNDU3NWI0IiwKICAiZDczMDI3ZmM4ZDU5ZmVlMDkwZmZmZmJmZTBmM2Y4OTFiZmRiNDU3NWI0IiwKICAiZDczMDI3ZjQ2ZDQzZmRhZTYxZmVlMDkwZTBmM2Y4YWJkOWU5NzRhZGQxNDU3NWI0IiwKICAiZDczMDI3ZjQ2ZDQzZmRhZTYxZmVlMDkwZmZmZmJmZTBmM2Y4YWJkOWU5NzRhZGQxNDU3NWI0IiwKICAiYTUwMDI2ZDczMDI3ZjQ2ZDQzZmRhZTYxZmVlMDkwZTBmM2Y4YWJkOWU5NzRhZGQxNDU3NWI0MzEzNjk1IiwKICAiYTUwMDI2ZDczMDI3ZjQ2ZDQzZmRhZTYxZmVlMDkwZmZmZmJmZTBmM2Y4YWJkOWU5NzRhZGQxNDU3NWI0MzEzNjk1IgopLm1hcChjb2xvcnMpOwoKdmFyIFJkWWxCdSA9IHJhbXAoc2NoZW1lJDYpOwoKdmFyIHNjaGVtZSQ3ID0gbmV3IEFycmF5KDMpLmNvbmNhdCgKICAiZmM4ZDU5ZmZmZmJmOTFjZjYwIiwKICAiZDcxOTFjZmRhZTYxYTZkOTZhMWE5NjQxIiwKICAiZDcxOTFjZmRhZTYxZmZmZmJmYTZkOTZhMWE5NjQxIiwKICAiZDczMDI3ZmM4ZDU5ZmVlMDhiZDllZjhiOTFjZjYwMWE5ODUwIiwKICAiZDczMDI3ZmM4ZDU5ZmVlMDhiZmZmZmJmZDllZjhiOTFjZjYwMWE5ODUwIiwKICAiZDczMDI3ZjQ2ZDQzZmRhZTYxZmVlMDhiZDllZjhiYTZkOTZhNjZiZDYzMWE5ODUwIiwKICAiZDczMDI3ZjQ2ZDQzZmRhZTYxZmVlMDhiZmZmZmJmZDllZjhiYTZkOTZhNjZiZDYzMWE5ODUwIiwKICAiYTUwMDI2ZDczMDI3ZjQ2ZDQzZmRhZTYxZmVlMDhiZDllZjhiYTZkOTZhNjZiZDYzMWE5ODUwMDA2ODM3IiwKICAiYTUwMDI2ZDczMDI3ZjQ2ZDQzZmRhZTYxZmVlMDhiZmZmZmJmZDllZjhiYTZkOTZhNjZiZDYzMWE5ODUwMDA2ODM3IgopLm1hcChjb2xvcnMpOwoKdmFyIFJkWWxHbiA9IHJhbXAoc2NoZW1lJDcpOwoKdmFyIHNjaGVtZSQ4ID0gbmV3IEFycmF5KDMpLmNvbmNhdCgKICAiZmM4ZDU5ZmZmZmJmOTlkNTk0IiwKICAiZDcxOTFjZmRhZTYxYWJkZGE0MmI4M2JhIiwKICAiZDcxOTFjZmRhZTYxZmZmZmJmYWJkZGE0MmI4M2JhIiwKICAiZDUzZTRmZmM4ZDU5ZmVlMDhiZTZmNTk4OTlkNTk0MzI4OGJkIiwKICAiZDUzZTRmZmM4ZDU5ZmVlMDhiZmZmZmJmZTZmNTk4OTlkNTk0MzI4OGJkIiwKICAiZDUzZTRmZjQ2ZDQzZmRhZTYxZmVlMDhiZTZmNTk4YWJkZGE0NjZjMmE1MzI4OGJkIiwKICAiZDUzZTRmZjQ2ZDQzZmRhZTYxZmVlMDhiZmZmZmJmZTZmNTk4YWJkZGE0NjZjMmE1MzI4OGJkIiwKICAiOWUwMTQyZDUzZTRmZjQ2ZDQzZmRhZTYxZmVlMDhiZTZmNTk4YWJkZGE0NjZjMmE1MzI4OGJkNWU0ZmEyIiwKICAiOWUwMTQyZDUzZTRmZjQ2ZDQzZmRhZTYxZmVlMDhiZmZmZmJmZTZmNTk4YWJkZGE0NjZjMmE1MzI4OGJkNWU0ZmEyIgopLm1hcChjb2xvcnMpOwoKdmFyIFNwZWN0cmFsID0gcmFtcChzY2hlbWUkOCk7Cgp2YXIgc2NoZW1lJDkgPSBuZXcgQXJyYXkoMykuY29uY2F0KAogICJlNWY1Zjk5OWQ4YzkyY2EyNWYiLAogICJlZGY4ZmJiMmUyZTI2NmMyYTQyMzhiNDUiLAogICJlZGY4ZmJiMmUyZTI2NmMyYTQyY2EyNWYwMDZkMmMiLAogICJlZGY4ZmJjY2VjZTY5OWQ4Yzk2NmMyYTQyY2EyNWYwMDZkMmMiLAogICJlZGY4ZmJjY2VjZTY5OWQ4Yzk2NmMyYTQ0MWFlNzYyMzhiNDUwMDU4MjQiLAogICJmN2ZjZmRlNWY1ZjljY2VjZTY5OWQ4Yzk2NmMyYTQ0MWFlNzYyMzhiNDUwMDU4MjQiLAogICJmN2ZjZmRlNWY1ZjljY2VjZTY5OWQ4Yzk2NmMyYTQ0MWFlNzYyMzhiNDUwMDZkMmMwMDQ0MWIiCikubWFwKGNvbG9ycyk7Cgp2YXIgQnVHbiA9IHJhbXAoc2NoZW1lJDkpOwoKdmFyIHNjaGVtZSQxMCA9IG5ldyBBcnJheSgzKS5jb25jYXQoCiAgImUwZWNmNDllYmNkYTg4NTZhNyIsCiAgImVkZjhmYmIzY2RlMzhjOTZjNjg4NDE5ZCIsCiAgImVkZjhmYmIzY2RlMzhjOTZjNjg4NTZhNzgxMGY3YyIsCiAgImVkZjhmYmJmZDNlNjllYmNkYThjOTZjNjg4NTZhNzgxMGY3YyIsCiAgImVkZjhmYmJmZDNlNjllYmNkYThjOTZjNjhjNmJiMTg4NDE5ZDZlMDE2YiIsCiAgImY3ZmNmZGUwZWNmNGJmZDNlNjllYmNkYThjOTZjNjhjNmJiMTg4NDE5ZDZlMDE2YiIsCiAgImY3ZmNmZGUwZWNmNGJmZDNlNjllYmNkYThjOTZjNjhjNmJiMTg4NDE5ZDgxMGY3YzRkMDA0YiIKKS5tYXAoY29sb3JzKTsKCnZhciBCdVB1ID0gcmFtcChzY2hlbWUkMTApOwoKdmFyIHNjaGVtZSQxMSA9IG5ldyBBcnJheSgzKS5jb25jYXQoCiAgImUwZjNkYmE4ZGRiNTQzYTJjYSIsCiAgImYwZjllOGJhZTRiYzdiY2NjNDJiOGNiZSIsCiAgImYwZjllOGJhZTRiYzdiY2NjNDQzYTJjYTA4NjhhYyIsCiAgImYwZjllOGNjZWJjNWE4ZGRiNTdiY2NjNDQzYTJjYTA4NjhhYyIsCiAgImYwZjllOGNjZWJjNWE4ZGRiNTdiY2NjNDRlYjNkMzJiOGNiZTA4NTg5ZSIsCiAgImY3ZmNmMGUwZjNkYmNjZWJjNWE4ZGRiNTdiY2NjNDRlYjNkMzJiOGNiZTA4NTg5ZSIsCiAgImY3ZmNmMGUwZjNkYmNjZWJjNWE4ZGRiNTdiY2NjNDRlYjNkMzJiOGNiZTA4NjhhYzA4NDA4MSIKKS5tYXAoY29sb3JzKTsKCnZhciBHbkJ1ID0gcmFtcChzY2hlbWUkMTEpOwoKdmFyIHNjaGVtZSQxMiA9IG5ldyBBcnJheSgzKS5jb25jYXQoCiAgImZlZThjOGZkYmI4NGUzNGEzMyIsCiAgImZlZjBkOWZkY2M4YWZjOGQ1OWQ3MzAxZiIsCiAgImZlZjBkOWZkY2M4YWZjOGQ1OWUzNGEzM2IzMDAwMCIsCiAgImZlZjBkOWZkZDQ5ZWZkYmI4NGZjOGQ1OWUzNGEzM2IzMDAwMCIsCiAgImZlZjBkOWZkZDQ5ZWZkYmI4NGZjOGQ1OWVmNjU0OGQ3MzAxZjk5MDAwMCIsCiAgImZmZjdlY2ZlZThjOGZkZDQ5ZWZkYmI4NGZjOGQ1OWVmNjU0OGQ3MzAxZjk5MDAwMCIsCiAgImZmZjdlY2ZlZThjOGZkZDQ5ZWZkYmI4NGZjOGQ1OWVmNjU0OGQ3MzAxZmIzMDAwMDdmMDAwMCIKKS5tYXAoY29sb3JzKTsKCnZhciBPclJkID0gcmFtcChzY2hlbWUkMTIpOwoKdmFyIHNjaGVtZSQxMyA9IG5ldyBBcnJheSgzKS5jb25jYXQoCiAgImVjZTJmMGE2YmRkYjFjOTA5OSIsCiAgImY2ZWZmN2JkYzllMTY3YTljZjAyODE4YSIsCiAgImY2ZWZmN2JkYzllMTY3YTljZjFjOTA5OTAxNmM1OSIsCiAgImY2ZWZmN2QwZDFlNmE2YmRkYjY3YTljZjFjOTA5OTAxNmM1OSIsCiAgImY2ZWZmN2QwZDFlNmE2YmRkYjY3YTljZjM2OTBjMDAyODE4YTAxNjQ1MCIsCiAgImZmZjdmYmVjZTJmMGQwZDFlNmE2YmRkYjY3YTljZjM2OTBjMDAyODE4YTAxNjQ1MCIsCiAgImZmZjdmYmVjZTJmMGQwZDFlNmE2YmRkYjY3YTljZjM2OTBjMDAyODE4YTAxNmM1OTAxNDYzNiIKKS5tYXAoY29sb3JzKTsKCnZhciBQdUJ1R24gPSByYW1wKHNjaGVtZSQxMyk7Cgp2YXIgc2NoZW1lJDE0ID0gbmV3IEFycmF5KDMpLmNvbmNhdCgKICAiZWNlN2YyYTZiZGRiMmI4Y2JlIiwKICAiZjFlZWY2YmRjOWUxNzRhOWNmMDU3MGIwIiwKICAiZjFlZWY2YmRjOWUxNzRhOWNmMmI4Y2JlMDQ1YThkIiwKICAiZjFlZWY2ZDBkMWU2YTZiZGRiNzRhOWNmMmI4Y2JlMDQ1YThkIiwKICAiZjFlZWY2ZDBkMWU2YTZiZGRiNzRhOWNmMzY5MGMwMDU3MGIwMDM0ZTdiIiwKICAiZmZmN2ZiZWNlN2YyZDBkMWU2YTZiZGRiNzRhOWNmMzY5MGMwMDU3MGIwMDM0ZTdiIiwKICAiZmZmN2ZiZWNlN2YyZDBkMWU2YTZiZGRiNzRhOWNmMzY5MGMwMDU3MGIwMDQ1YThkMDIzODU4IgopLm1hcChjb2xvcnMpOwoKdmFyIFB1QnUgPSByYW1wKHNjaGVtZSQxNCk7Cgp2YXIgc2NoZW1lJDE1ID0gbmV3IEFycmF5KDMpLmNvbmNhdCgKICAiZTdlMWVmYzk5NGM3ZGQxYzc3IiwKICAiZjFlZWY2ZDdiNWQ4ZGY2NWIwY2UxMjU2IiwKICAiZjFlZWY2ZDdiNWQ4ZGY2NWIwZGQxYzc3OTgwMDQzIiwKICAiZjFlZWY2ZDRiOWRhYzk5NGM3ZGY2NWIwZGQxYzc3OTgwMDQzIiwKICAiZjFlZWY2ZDRiOWRhYzk5NGM3ZGY2NWIwZTcyOThhY2UxMjU2OTEwMDNmIiwKICAiZjdmNGY5ZTdlMWVmZDRiOWRhYzk5NGM3ZGY2NWIwZTcyOThhY2UxMjU2OTEwMDNmIiwKICAiZjdmNGY5ZTdlMWVmZDRiOWRhYzk5NGM3ZGY2NWIwZTcyOThhY2UxMjU2OTgwMDQzNjcwMDFmIgopLm1hcChjb2xvcnMpOwoKdmFyIFB1UmQgPSByYW1wKHNjaGVtZSQxNSk7Cgp2YXIgc2NoZW1lJDE2ID0gbmV3IEFycmF5KDMpLmNvbmNhdCgKICAiZmRlMGRkZmE5ZmI1YzUxYjhhIiwKICAiZmVlYmUyZmJiNGI5Zjc2OGExYWUwMTdlIiwKICAiZmVlYmUyZmJiNGI5Zjc2OGExYzUxYjhhN2EwMTc3IiwKICAiZmVlYmUyZmNjNWMwZmE5ZmI1Zjc2OGExYzUxYjhhN2EwMTc3IiwKICAiZmVlYmUyZmNjNWMwZmE5ZmI1Zjc2OGExZGQzNDk3YWUwMTdlN2EwMTc3IiwKICAiZmZmN2YzZmRlMGRkZmNjNWMwZmE5ZmI1Zjc2OGExZGQzNDk3YWUwMTdlN2EwMTc3IiwKICAiZmZmN2YzZmRlMGRkZmNjNWMwZmE5ZmI1Zjc2OGExZGQzNDk3YWUwMTdlN2EwMTc3NDkwMDZhIgopLm1hcChjb2xvcnMpOwoKdmFyIFJkUHUgPSByYW1wKHNjaGVtZSQxNik7Cgp2YXIgc2NoZW1lJDE3ID0gbmV3IEFycmF5KDMpLmNvbmNhdCgKICAiZWRmOGIxN2ZjZGJiMmM3ZmI4IiwKICAiZmZmZmNjYTFkYWI0NDFiNmM0MjI1ZWE4IiwKICAiZmZmZmNjYTFkYWI0NDFiNmM0MmM3ZmI4MjUzNDk0IiwKICAiZmZmZmNjYzdlOWI0N2ZjZGJiNDFiNmM0MmM3ZmI4MjUzNDk0IiwKICAiZmZmZmNjYzdlOWI0N2ZjZGJiNDFiNmM0MWQ5MWMwMjI1ZWE4MGMyYzg0IiwKICAiZmZmZmQ5ZWRmOGIxYzdlOWI0N2ZjZGJiNDFiNmM0MWQ5MWMwMjI1ZWE4MGMyYzg0IiwKICAiZmZmZmQ5ZWRmOGIxYzdlOWI0N2ZjZGJiNDFiNmM0MWQ5MWMwMjI1ZWE4MjUzNDk0MDgxZDU4IgopLm1hcChjb2xvcnMpOwoKdmFyIFlsR25CdSA9IHJhbXAoc2NoZW1lJDE3KTsKCnZhciBzY2hlbWUkMTggPSBuZXcgQXJyYXkoMykuY29uY2F0KAogICJmN2ZjYjlhZGRkOGUzMWEzNTQiLAogICJmZmZmY2NjMmU2OTk3OGM2NzkyMzg0NDMiLAogICJmZmZmY2NjMmU2OTk3OGM2NzkzMWEzNTQwMDY4MzciLAogICJmZmZmY2NkOWYwYTNhZGRkOGU3OGM2NzkzMWEzNTQwMDY4MzciLAogICJmZmZmY2NkOWYwYTNhZGRkOGU3OGM2Nzk0MWFiNWQyMzg0NDMwMDVhMzIiLAogICJmZmZmZTVmN2ZjYjlkOWYwYTNhZGRkOGU3OGM2Nzk0MWFiNWQyMzg0NDMwMDVhMzIiLAogICJmZmZmZTVmN2ZjYjlkOWYwYTNhZGRkOGU3OGM2Nzk0MWFiNWQyMzg0NDMwMDY4MzcwMDQ1MjkiCikubWFwKGNvbG9ycyk7Cgp2YXIgWWxHbiA9IHJhbXAoc2NoZW1lJDE4KTsKCnZhciBzY2hlbWUkMTkgPSBuZXcgQXJyYXkoMykuY29uY2F0KAogICJmZmY3YmNmZWM0NGZkOTVmMGUiLAogICJmZmZmZDRmZWQ5OGVmZTk5MjljYzRjMDIiLAogICJmZmZmZDRmZWQ5OGVmZTk5MjlkOTVmMGU5OTM0MDQiLAogICJmZmZmZDRmZWUzOTFmZWM0NGZmZTk5MjlkOTVmMGU5OTM0MDQiLAogICJmZmZmZDRmZWUzOTFmZWM0NGZmZTk5MjllYzcwMTRjYzRjMDI4YzJkMDQiLAogICJmZmZmZTVmZmY3YmNmZWUzOTFmZWM0NGZmZTk5MjllYzcwMTRjYzRjMDI4YzJkMDQiLAogICJmZmZmZTVmZmY3YmNmZWUzOTFmZWM0NGZmZTk5MjllYzcwMTRjYzRjMDI5OTM0MDQ2NjI1MDYiCikubWFwKGNvbG9ycyk7Cgp2YXIgWWxPckJyID0gcmFtcChzY2hlbWUkMTkpOwoKdmFyIHNjaGVtZSQyMCA9IG5ldyBBcnJheSgzKS5jb25jYXQoCiAgImZmZWRhMGZlYjI0Y2YwM2IyMCIsCiAgImZmZmZiMmZlY2M1Y2ZkOGQzY2UzMWExYyIsCiAgImZmZmZiMmZlY2M1Y2ZkOGQzY2YwM2IyMGJkMDAyNiIsCiAgImZmZmZiMmZlZDk3NmZlYjI0Y2ZkOGQzY2YwM2IyMGJkMDAyNiIsCiAgImZmZmZiMmZlZDk3NmZlYjI0Y2ZkOGQzY2ZjNGUyYWUzMWExY2IxMDAyNiIsCiAgImZmZmZjY2ZmZWRhMGZlZDk3NmZlYjI0Y2ZkOGQzY2ZjNGUyYWUzMWExY2IxMDAyNiIsCiAgImZmZmZjY2ZmZWRhMGZlZDk3NmZlYjI0Y2ZkOGQzY2ZjNGUyYWUzMWExY2JkMDAyNjgwMDAyNiIKKS5tYXAoY29sb3JzKTsKCnZhciBZbE9yUmQgPSByYW1wKHNjaGVtZSQyMCk7Cgp2YXIgc2NoZW1lJDIxID0gbmV3IEFycmF5KDMpLmNvbmNhdCgKICAiZGVlYmY3OWVjYWUxMzE4MmJkIiwKICAiZWZmM2ZmYmRkN2U3NmJhZWQ2MjE3MWI1IiwKICAiZWZmM2ZmYmRkN2U3NmJhZWQ2MzE4MmJkMDg1MTljIiwKICAiZWZmM2ZmYzZkYmVmOWVjYWUxNmJhZWQ2MzE4MmJkMDg1MTljIiwKICAiZWZmM2ZmYzZkYmVmOWVjYWUxNmJhZWQ2NDI5MmM2MjE3MWI1MDg0NTk0IiwKICAiZjdmYmZmZGVlYmY3YzZkYmVmOWVjYWUxNmJhZWQ2NDI5MmM2MjE3MWI1MDg0NTk0IiwKICAiZjdmYmZmZGVlYmY3YzZkYmVmOWVjYWUxNmJhZWQ2NDI5MmM2MjE3MWI1MDg1MTljMDgzMDZiIgopLm1hcChjb2xvcnMpOwoKdmFyIEJsdWVzID0gcmFtcChzY2hlbWUkMjEpOwoKdmFyIHNjaGVtZSQyMiA9IG5ldyBBcnJheSgzKS5jb25jYXQoCiAgImU1ZjVlMGExZDk5YjMxYTM1NCIsCiAgImVkZjhlOWJhZTRiMzc0YzQ3NjIzOGI0NSIsCiAgImVkZjhlOWJhZTRiMzc0YzQ3NjMxYTM1NDAwNmQyYyIsCiAgImVkZjhlOWM3ZTljMGExZDk5Yjc0YzQ3NjMxYTM1NDAwNmQyYyIsCiAgImVkZjhlOWM3ZTljMGExZDk5Yjc0YzQ3NjQxYWI1ZDIzOGI0NTAwNWEzMiIsCiAgImY3ZmNmNWU1ZjVlMGM3ZTljMGExZDk5Yjc0YzQ3NjQxYWI1ZDIzOGI0NTAwNWEzMiIsCiAgImY3ZmNmNWU1ZjVlMGM3ZTljMGExZDk5Yjc0YzQ3NjQxYWI1ZDIzOGI0NTAwNmQyYzAwNDQxYiIKKS5tYXAoY29sb3JzKTsKCnZhciBHcmVlbnMgPSByYW1wKHNjaGVtZSQyMik7Cgp2YXIgc2NoZW1lJDIzID0gbmV3IEFycmF5KDMpLmNvbmNhdCgKICAiZjBmMGYwYmRiZGJkNjM2MzYzIiwKICAiZjdmN2Y3Y2NjY2NjOTY5Njk2NTI1MjUyIiwKICAiZjdmN2Y3Y2NjY2NjOTY5Njk2NjM2MzYzMjUyNTI1IiwKICAiZjdmN2Y3ZDlkOWQ5YmRiZGJkOTY5Njk2NjM2MzYzMjUyNTI1IiwKICAiZjdmN2Y3ZDlkOWQ5YmRiZGJkOTY5Njk2NzM3MzczNTI1MjUyMjUyNTI1IiwKICAiZmZmZmZmZjBmMGYwZDlkOWQ5YmRiZGJkOTY5Njk2NzM3MzczNTI1MjUyMjUyNTI1IiwKICAiZmZmZmZmZjBmMGYwZDlkOWQ5YmRiZGJkOTY5Njk2NzM3MzczNTI1MjUyMjUyNTI1MDAwMDAwIgopLm1hcChjb2xvcnMpOwoKdmFyIEdyZXlzID0gcmFtcChzY2hlbWUkMjMpOwoKdmFyIHNjaGVtZSQyNCA9IG5ldyBBcnJheSgzKS5jb25jYXQoCiAgImVmZWRmNWJjYmRkYzc1NmJiMSIsCiAgImYyZjBmN2NiYzllMjllOWFjODZhNTFhMyIsCiAgImYyZjBmN2NiYzllMjllOWFjODc1NmJiMTU0Mjc4ZiIsCiAgImYyZjBmN2RhZGFlYmJjYmRkYzllOWFjODc1NmJiMTU0Mjc4ZiIsCiAgImYyZjBmN2RhZGFlYmJjYmRkYzllOWFjODgwN2RiYTZhNTFhMzRhMTQ4NiIsCiAgImZjZmJmZGVmZWRmNWRhZGFlYmJjYmRkYzllOWFjODgwN2RiYTZhNTFhMzRhMTQ4NiIsCiAgImZjZmJmZGVmZWRmNWRhZGFlYmJjYmRkYzllOWFjODgwN2RiYTZhNTFhMzU0Mjc4ZjNmMDA3ZCIKKS5tYXAoY29sb3JzKTsKCnZhciBQdXJwbGVzID0gcmFtcChzY2hlbWUkMjQpOwoKdmFyIHNjaGVtZSQyNSA9IG5ldyBBcnJheSgzKS5jb25jYXQoCiAgImZlZTBkMmZjOTI3MmRlMmQyNiIsCiAgImZlZTVkOWZjYWU5MWZiNmE0YWNiMTgxZCIsCiAgImZlZTVkOWZjYWU5MWZiNmE0YWRlMmQyNmE1MGYxNSIsCiAgImZlZTVkOWZjYmJhMWZjOTI3MmZiNmE0YWRlMmQyNmE1MGYxNSIsCiAgImZlZTVkOWZjYmJhMWZjOTI3MmZiNmE0YWVmM2IyY2NiMTgxZDk5MDAwZCIsCiAgImZmZjVmMGZlZTBkMmZjYmJhMWZjOTI3MmZiNmE0YWVmM2IyY2NiMTgxZDk5MDAwZCIsCiAgImZmZjVmMGZlZTBkMmZjYmJhMWZjOTI3MmZiNmE0YWVmM2IyY2NiMTgxZGE1MGYxNTY3MDAwZCIKKS5tYXAoY29sb3JzKTsKCnZhciBSZWRzID0gcmFtcChzY2hlbWUkMjUpOwoKdmFyIHNjaGVtZSQyNiA9IG5ldyBBcnJheSgzKS5jb25jYXQoCiAgImZlZTZjZWZkYWU2YmU2NTUwZCIsCiAgImZlZWRkZWZkYmU4NWZkOGQzY2Q5NDcwMSIsCiAgImZlZWRkZWZkYmU4NWZkOGQzY2U2NTUwZGE2MzYwMyIsCiAgImZlZWRkZWZkZDBhMmZkYWU2YmZkOGQzY2U2NTUwZGE2MzYwMyIsCiAgImZlZWRkZWZkZDBhMmZkYWU2YmZkOGQzY2YxNjkxM2Q5NDgwMThjMmQwNCIsCiAgImZmZjVlYmZlZTZjZWZkZDBhMmZkYWU2YmZkOGQzY2YxNjkxM2Q5NDgwMThjMmQwNCIsCiAgImZmZjVlYmZlZTZjZWZkZDBhMmZkYWU2YmZkOGQzY2YxNjkxM2Q5NDgwMWE2MzYwMzdmMjcwNCIKKS5tYXAoY29sb3JzKTsKCnZhciBPcmFuZ2VzID0gcmFtcChzY2hlbWUkMjYpOwoKdmFyIGN1YmVoZWxpeCQzID0gY3ViZWhlbGl4TG9uZyhjdWJlaGVsaXgoMzAwLCAwLjUsIDAuMCksIGN1YmVoZWxpeCgtMjQwLCAwLjUsIDEuMCkpOwoKdmFyIHdhcm0gPSBjdWJlaGVsaXhMb25nKGN1YmVoZWxpeCgtMTAwLCAwLjc1LCAwLjM1KSwgY3ViZWhlbGl4KDgwLCAxLjUwLCAwLjgpKTsKCnZhciBjb29sID0gY3ViZWhlbGl4TG9uZyhjdWJlaGVsaXgoMjYwLCAwLjc1LCAwLjM1KSwgY3ViZWhlbGl4KDgwLCAxLjUwLCAwLjgpKTsKCnZhciByYWluYm93ID0gY3ViZWhlbGl4KCk7CgpmdW5jdGlvbiByYWluYm93JDEodCkgewogIGlmICh0IDwgMCB8fCB0ID4gMSkgdCAtPSBNYXRoLmZsb29yKHQpOwogIHZhciB0cyA9IE1hdGguYWJzKHQgLSAwLjUpOwogIHJhaW5ib3cuaCA9IDM2MCAqIHQgLSAxMDA7CiAgcmFpbmJvdy5zID0gMS41IC0gMS41ICogdHM7CiAgcmFpbmJvdy5sID0gMC44IC0gMC45ICogdHM7CiAgcmV0dXJuIHJhaW5ib3cgKyAiIjsKfQoKZnVuY3Rpb24gcmFtcCQxKHJhbmdlKSB7CiAgdmFyIG4gPSByYW5nZS5sZW5ndGg7CiAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgIHJldHVybiByYW5nZVtNYXRoLm1heCgwLCBNYXRoLm1pbihuIC0gMSwgTWF0aC5mbG9vcih0ICogbikpKV07CiAgfTsKfQoKdmFyIHZpcmlkaXMgPSByYW1wJDEoY29sb3JzKCI0NDAxNTQ0NDAyNTY0NTA0NTc0NTA1NTk0NjA3NWE0NjA4NWM0NjBhNWQ0NjBiNWU0NzBkNjA0NzBlNjE0NzEwNjM0NzExNjQ0NzEzNjU0ODE0Njc0ODE2Njg0ODE3Njk0ODE4NmE0ODFhNmM0ODFiNmQ0ODFjNmU0ODFkNmY0ODFmNzA0ODIwNzE0ODIxNzM0ODIzNzQ0ODI0NzU0ODI1NzY0ODI2Nzc0ODI4Nzg0ODI5Nzk0NzJhN2E0NzJjN2E0NzJkN2I0NzJlN2M0NzJmN2Q0NjMwN2U0NjMyN2U0NjMzN2Y0NjM0ODA0NTM1ODE0NTM3ODE0NTM4ODI0NDM5ODM0NDNhODM0NDNiODQ0MzNkODQ0MzNlODU0MjNmODU0MjQwODY0MjQxODY0MTQyODc0MTQ0ODc0MDQ1ODg0MDQ2ODgzZjQ3ODgzZjQ4ODkzZTQ5ODkzZTRhODkzZTRjOGEzZDRkOGEzZDRlOGEzYzRmOGEzYzUwOGIzYjUxOGIzYjUyOGIzYTUzOGIzYTU0OGMzOTU1OGMzOTU2OGMzODU4OGMzODU5OGMzNzVhOGMzNzViOGQzNjVjOGQzNjVkOGQzNTVlOGQzNTVmOGQzNDYwOGQzNDYxOGQzMzYyOGQzMzYzOGQzMjY0OGUzMjY1OGUzMTY2OGUzMTY3OGUzMTY4OGUzMDY5OGUzMDZhOGUyZjZiOGUyZjZjOGUyZTZkOGUyZTZlOGUyZTZmOGUyZDcwOGUyZDcxOGUyYzcxOGUyYzcyOGUyYzczOGUyYjc0OGUyYjc1OGUyYTc2OGUyYTc3OGUyYTc4OGUyOTc5OGUyOTdhOGUyOTdiOGUyODdjOGUyODdkOGUyNzdlOGUyNzdmOGUyNzgwOGUyNjgxOGUyNjgyOGUyNjgyOGUyNTgzOGUyNTg0OGUyNTg1OGUyNDg2OGUyNDg3OGUyMzg4OGUyMzg5OGUyMzhhOGQyMjhiOGQyMjhjOGQyMjhkOGQyMThlOGQyMThmOGQyMTkwOGQyMTkxOGMyMDkyOGMyMDkyOGMyMDkzOGMxZjk0OGMxZjk1OGIxZjk2OGIxZjk3OGIxZjk4OGIxZjk5OGExZjlhOGExZTliOGExZTljODkxZTlkODkxZjllODkxZjlmODgxZmEwODgxZmExODgxZmExODcxZmEyODcyMGEzODYyMGE0ODYyMWE1ODUyMWE2ODUyMmE3ODUyMmE4ODQyM2E5ODMyNGFhODMyNWFiODIyNWFjODIyNmFkODEyN2FkODEyOGFlODAyOWFmN2YyYWIwN2YyY2IxN2UyZGIyN2QyZWIzN2MyZmI0N2MzMWI1N2IzMmI2N2EzNGI2NzkzNWI3NzkzN2I4NzgzOGI5NzczYWJhNzYzYmJiNzUzZGJjNzQzZmJjNzM0MGJkNzI0MmJlNzE0NGJmNzA0NmMwNmY0OGMxNmU0YWMxNmQ0Y2MyNmM0ZWMzNmI1MGM0NmE1MmM1Njk1NGM1Njg1NmM2Njc1OGM3NjU1YWM4NjQ1Y2M4NjM1ZWM5NjI2MGNhNjA2M2NiNWY2NWNiNWU2N2NjNWM2OWNkNWI2Y2NkNWE2ZWNlNTg3MGNmNTc3M2QwNTY3NWQwNTQ3N2QxNTM3YWQxNTE3Y2QyNTA3ZmQzNGU4MWQzNGQ4NGQ0NGI4NmQ1NDk4OWQ1NDg4YmQ2NDY4ZWQ2NDU5MGQ3NDM5M2Q3NDE5NWQ4NDA5OGQ4M2U5YmQ5M2M5ZGQ5M2JhMGRhMzlhMmRhMzdhNWRiMzZhOGRiMzRhYWRjMzJhZGRjMzBiMGRkMmZiMmRkMmRiNWRlMmJiOGRlMjliYWRlMjhiZGRmMjZjMGRmMjVjMmRmMjNjNWUwMjFjOGUwMjBjYWUxMWZjZGUxMWRkMGUxMWNkMmUyMWJkNWUyMWFkOGUyMTlkYWUzMTlkZGUzMThkZmUzMThlMmU0MThlNWU0MTllN2U0MTllYWU1MWFlY2U1MWJlZmU1MWNmMWU1MWRmNGU2MWVmNmU2MjBmOGU2MjFmYmU3MjNmZGU3MjUiKSk7Cgp2YXIgbWFnbWEgPSByYW1wJDEoY29sb3JzKCIwMDAwMDQwMTAwMDUwMTAxMDYwMTAxMDgwMjAxMDkwMjAyMGIwMjAyMGQwMzAzMGYwMzAzMTIwNDA0MTQwNTA0MTYwNjA1MTgwNjA1MWEwNzA2MWMwODA3MWUwOTA3MjAwYTA4MjIwYjA5MjQwYzA5MjYwZDBhMjkwZTBiMmIxMDBiMmQxMTBjMmYxMjBkMzExMzBkMzQxNDBlMzYxNTBlMzgxNjBmM2IxODBmM2QxOTEwM2YxYTEwNDIxYzEwNDQxZDExNDcxZTExNDkyMDExNGIyMTExNGUyMjExNTAyNDEyNTMyNTEyNTUyNzEyNTgyOTExNWEyYTExNWMyYzExNWYyZDExNjEyZjExNjMzMTExNjUzMzEwNjczNDEwNjkzNjEwNmIzODEwNmMzOTBmNmUzYjBmNzAzZDBmNzEzZjBmNzI0MDBmNzQ0MjBmNzU0NDBmNzY0NTEwNzc0NzEwNzg0OTEwNzg0YTEwNzk0YzExN2E0ZTExN2I0ZjEyN2I1MTEyN2M1MjEzN2M1NDEzN2Q1NjE0N2Q1NzE1N2U1OTE1N2U1YTE2N2U1YzE2N2Y1ZDE3N2Y1ZjE4N2Y2MDE4ODA2MjE5ODA2NDFhODA2NTFhODA2NzFiODA2ODFjODE2YTFjODE2YjFkODE2ZDFkODE2ZTFlODE3MDFmODE3MjFmODE3MzIwODE3NTIxODE3NjIxODE3ODIyODE3OTIyODI3YjIzODI3YzIzODI3ZTI0ODI4MDI1ODI4MTI1ODE4MzI2ODE4NDI2ODE4NjI3ODE4ODI3ODE4OTI4ODE4YjI5ODE4YzI5ODE4ZTJhODE5MDJhODE5MTJiODE5MzJiODA5NDJjODA5NjJjODA5ODJkODA5OTJkODA5YjJlN2Y5YzJlN2Y5ZTJmN2ZhMDJmN2ZhMTMwN2VhMzMwN2VhNTMxN2VhNjMxN2RhODMyN2RhYTMzN2RhYjMzN2NhZDM0N2NhZTM0N2JiMDM1N2JiMjM1N2JiMzM2N2FiNTM2N2FiNzM3NzliODM3NzliYTM4NzhiYzM5NzhiZDM5NzdiZjNhNzdjMDNhNzZjMjNiNzVjNDNjNzVjNTNjNzRjNzNkNzNjODNlNzNjYTNlNzJjYzNmNzFjZDQwNzFjZjQwNzBkMDQxNmZkMjQyNmZkMzQzNmVkNTQ0NmRkNjQ1NmNkODQ1NmNkOTQ2NmJkYjQ3NmFkYzQ4NjlkZTQ5NjhkZjRhNjhlMDRjNjdlMjRkNjZlMzRlNjVlNDRmNjRlNTUwNjRlNzUyNjNlODUzNjJlOTU0NjJlYTU2NjFlYjU3NjBlYzU4NjBlZDVhNWZlZTViNWVlZjVkNWVmMDVmNWVmMTYwNWRmMjYyNWRmMjY0NWNmMzY1NWNmNDY3NWNmNDY5NWNmNTZiNWNmNjZjNWNmNjZlNWNmNzcwNWNmNzcyNWNmODc0NWNmODc2NWNmOTc4NWRmOTc5NWRmOTdiNWRmYTdkNWVmYTdmNWVmYTgxNWZmYjgzNWZmYjg1NjBmYjg3NjFmYzg5NjFmYzhhNjJmYzhjNjNmYzhlNjRmYzkwNjVmZDkyNjZmZDk0NjdmZDk2NjhmZDk4NjlmZDlhNmFmZDliNmJmZTlkNmNmZTlmNmRmZWExNmVmZWEzNmZmZWE1NzFmZWE3NzJmZWE5NzNmZWFhNzRmZWFjNzZmZWFlNzdmZWIwNzhmZWIyN2FmZWI0N2JmZWI2N2NmZWI3N2VmZWI5N2ZmZWJiODFmZWJkODJmZWJmODRmZWMxODVmZWMyODdmZWM0ODhmZWM2OGFmZWM4OGNmZWNhOGRmZWNjOGZmZWNkOTBmZWNmOTJmZWQxOTRmZWQzOTVmZWQ1OTdmZWQ3OTlmZWQ4OWFmZGRhOWNmZGRjOWVmZGRlYTBmZGUwYTFmZGUyYTNmZGUzYTVmZGU1YTdmZGU3YTlmZGU5YWFmZGViYWNmY2VjYWVmY2VlYjBmY2YwYjJmY2YyYjRmY2Y0YjZmY2Y2YjhmY2Y3YjlmY2Y5YmJmY2ZiYmRmY2ZkYmYiKSk7Cgp2YXIgaW5mZXJubyA9IHJhbXAkMShjb2xvcnMoIjAwMDAwNDAxMDAwNTAxMDEwNjAxMDEwODAyMDEwYTAyMDIwYzAyMDIwZTAzMDIxMDA0MDMxMjA0MDMxNDA1MDQxNzA2MDQxOTA3MDUxYjA4MDUxZDA5MDYxZjBhMDcyMjBiMDcyNDBjMDgyNjBkMDgyOTBlMDkyYjEwMDkyZDExMGEzMDEyMGEzMjE0MGIzNDE1MGIzNzE2MGIzOTE4MGMzYzE5MGMzZTFiMGM0MTFjMGM0MzFlMGM0NTFmMGM0ODIxMGM0YTIzMGM0YzI0MGM0ZjI2MGM1MTI4MGI1MzI5MGI1NTJiMGI1NzJkMGI1OTJmMGE1YjMxMGE1YzMyMGE1ZTM0MGE1ZjM2MDk2MTM4MDk2MjM5MDk2MzNiMDk2NDNkMDk2NTNlMDk2NjQwMGE2NzQyMGE2ODQ0MGE2ODQ1MGE2OTQ3MGI2YTQ5MGI2YTRhMGM2YjRjMGM2YjRkMGQ2YzRmMGQ2YzUxMGU2YzUyMGU2ZDU0MGY2ZDU1MGY2ZDU3MTA2ZTU5MTA2ZTVhMTE2ZTVjMTI2ZTVkMTI2ZTVmMTM2ZTYxMTM2ZTYyMTQ2ZTY0MTU2ZTY1MTU2ZTY3MTY2ZTY5MTY2ZTZhMTc2ZTZjMTg2ZTZkMTg2ZTZmMTk2ZTcxMTk2ZTcyMWE2ZTc0MWE2ZTc1MWI2ZTc3MWM2ZDc4MWM2ZDdhMWQ2ZDdjMWQ2ZDdkMWU2ZDdmMWU2YzgwMWY2YzgyMjA2Yzg0MjA2Yjg1MjE2Yjg3MjE2Yjg4MjI2YThhMjI2YThjMjM2OThkMjM2OThmMjQ2OTkwMjU2ODkyMjU2ODkzMjY2Nzk1MjY2Nzk3Mjc2Njk4Mjc2NjlhMjg2NTliMjk2NDlkMjk2NDlmMmE2M2EwMmE2M2EyMmI2MmEzMmM2MWE1MmM2MGE2MmQ2MGE4MmU1ZmE5MmU1ZWFiMmY1ZWFkMzA1ZGFlMzA1Y2IwMzE1YmIxMzI1YWIzMzI1YWI0MzM1OWI2MzQ1OGI3MzU1N2I5MzU1NmJhMzY1NWJjMzc1NGJkMzg1M2JmMzk1MmMwM2E1MWMxM2E1MGMzM2I0ZmM0M2M0ZWM2M2Q0ZGM3M2U0Y2M4M2Y0YmNhNDA0YWNiNDE0OWNjNDI0OGNlNDM0N2NmNDQ0NmQwNDU0NWQyNDY0NGQzNDc0M2Q0NDg0MmQ1NGE0MWQ3NGIzZmQ4NGMzZWQ5NGQzZGRhNGUzY2RiNTAzYmRkNTEzYWRlNTIzOGRmNTMzN2UwNTUzNmUxNTYzNWUyNTczNGUzNTkzM2U0NWEzMWU1NWMzMGU2NWQyZmU3NWUyZWU4NjAyZGU5NjEyYmVhNjMyYWViNjQyOWViNjYyOGVjNjcyNmVkNjkyNWVlNmEyNGVmNmMyM2VmNmUyMWYwNmYyMGYxNzExZmYxNzMxZGYyNzQxY2YzNzYxYmYzNzgxOWY0NzkxOGY1N2IxN2Y1N2QxNWY2N2UxNGY2ODAxM2Y3ODIxMmY3ODQxMGY4ODUwZmY4ODcwZWY4ODkwY2Y5OGIwYmY5OGMwYWY5OGUwOWZhOTAwOGZhOTIwN2ZhOTQwN2ZiOTYwNmZiOTcwNmZiOTkwNmZiOWIwNmZiOWQwN2ZjOWYwN2ZjYTEwOGZjYTMwOWZjYTUwYWZjYTYwY2ZjYTgwZGZjYWEwZmZjYWMxMWZjYWUxMmZjYjAxNGZjYjIxNmZjYjQxOGZiYjYxYWZiYjgxZGZiYmExZmZiYmMyMWZiYmUyM2ZhYzAyNmZhYzIyOGZhYzQyYWZhYzYyZGY5YzcyZmY5YzkzMmY5Y2IzNWY4Y2QzN2Y4Y2YzYWY3ZDEzZGY3ZDM0MGY2ZDU0M2Y2ZDc0NmY1ZDk0OWY1ZGI0Y2Y0ZGQ0ZmY0ZGY1M2Y0ZTE1NmYzZTM1YWYzZTU1ZGYyZTY2MWYyZTg2NWYyZWE2OWYxZWM2ZGYxZWQ3MWYxZWY3NWYxZjE3OWYyZjI3ZGYyZjQ4MmYzZjU4NmYzZjY4YWY0Zjg4ZWY1Zjk5MmY2ZmE5NmY4ZmI5YWY5ZmM5ZGZhZmRhMWZjZmZhNCIpKTsKCnZhciBwbGFzbWEgPSByYW1wJDEoY29sb3JzKCIwZDA4ODcxMDA3ODgxMzA3ODkxNjA3OGExOTA2OGMxYjA2OGQxZDA2OGUyMDA2OGYyMjA2OTAyNDA2OTEyNjA1OTEyODA1OTIyYTA1OTMyYzA1OTQyZTA1OTUyZjA1OTYzMTA1OTczMzA1OTczNTA0OTgzNzA0OTkzODA0OWEzYTA0OWEzYzA0OWIzZTA0OWMzZjA0OWM0MTA0OWQ0MzAzOWU0NDAzOWU0NjAzOWY0ODAzOWY0OTAzYTA0YjAzYTE0YzAyYTE0ZTAyYTI1MDAyYTI1MTAyYTM1MzAyYTM1NTAyYTQ1NjAxYTQ1ODAxYTQ1OTAxYTU1YjAxYTU1YzAxYTY1ZTAxYTY2MDAxYTY2MTAwYTc2MzAwYTc2NDAwYTc2NjAwYTc2NzAwYTg2OTAwYTg2YTAwYTg2YzAwYTg2ZTAwYTg2ZjAwYTg3MTAwYTg3MjAxYTg3NDAxYTg3NTAxYTg3NzAxYTg3ODAxYTg3YTAyYTg3YjAyYTg3ZDAzYTg3ZTAzYTg4MDA0YTg4MTA0YTc4MzA1YTc4NDA1YTc4NjA2YTY4NzA3YTY4ODA4YTY4YTA5YTU4YjBhYTU4ZDBiYTU4ZTBjYTQ4ZjBkYTQ5MTBlYTM5MjBmYTM5NDEwYTI5NTExYTE5NjEzYTE5ODE0YTA5OTE1OWY5YTE2OWY5YzE3OWU5ZDE4OWQ5ZTE5OWRhMDFhOWNhMTFiOWJhMjFkOWFhMzFlOWFhNTFmOTlhNjIwOThhNzIxOTdhODIyOTZhYTIzOTVhYjI0OTRhYzI2OTRhZDI3OTNhZTI4OTJiMDI5OTFiMTJhOTBiMjJiOGZiMzJjOGViNDJlOGRiNTJmOGNiNjMwOGJiNzMxOGFiODMyODliYTMzODhiYjM0ODhiYzM1ODdiZDM3ODZiZTM4ODViZjM5ODRjMDNhODNjMTNiODJjMjNjODFjMzNkODBjNDNlN2ZjNTQwN2VjNjQxN2RjNzQyN2NjODQzN2JjOTQ0N2FjYTQ1N2FjYjQ2NzljYzQ3NzhjYzQ5NzdjZDRhNzZjZTRiNzVjZjRjNzRkMDRkNzNkMTRlNzJkMjRmNzFkMzUxNzFkNDUyNzBkNTUzNmZkNTU0NmVkNjU1NmRkNzU2NmNkODU3NmJkOTU4NmFkYTVhNmFkYTViNjlkYjVjNjhkYzVkNjdkZDVlNjZkZTVmNjVkZTYxNjRkZjYyNjNlMDYzNjNlMTY0NjJlMjY1NjFlMjY2NjBlMzY4NWZlNDY5NWVlNTZhNWRlNTZiNWRlNjZjNWNlNzZlNWJlNzZmNWFlODcwNTllOTcxNThlOTcyNTdlYTc0NTdlYjc1NTZlYjc2NTVlYzc3NTRlZDc5NTNlZDdhNTJlZTdiNTFlZjdjNTFlZjdlNTBmMDdmNGZmMDgwNGVmMTgxNGRmMTgzNGNmMjg0NGJmMzg1NGJmMzg3NGFmNDg4NDlmNDg5NDhmNThiNDdmNThjNDZmNjhkNDVmNjhmNDRmNzkwNDRmNzkxNDNmNzkzNDJmODk0NDFmODk1NDBmOTk3M2ZmOTk4M2VmOTlhM2VmYTliM2RmYTljM2NmYTllM2JmYjlmM2FmYmExMzlmYmEyMzhmY2EzMzhmY2E1MzdmY2E2MzZmY2E4MzVmY2E5MzRmZGFiMzNmZGFjMzNmZGFlMzJmZGFmMzFmZGIxMzBmZGIyMmZmZGI0MmZmZGI1MmVmZWI3MmRmZWI4MmNmZWJhMmNmZWJiMmJmZWJkMmFmZWJlMmFmZWMwMjlmZGMyMjlmZGMzMjhmZGM1MjdmZGM2MjdmZGM4MjdmZGNhMjZmZGNiMjZmY2NkMjVmY2NlMjVmY2QwMjVmY2QyMjVmYmQzMjRmYmQ1MjRmYmQ3MjRmYWQ4MjRmYWRhMjRmOWRjMjRmOWRkMjVmOGRmMjVmOGUxMjVmN2UyMjVmN2U0MjVmNmU2MjZmNmU4MjZmNWU5MjZmNWViMjdmNGVkMjdmM2VlMjdmM2YwMjdmMmYyMjdmMWY0MjZmMWY1MjVmMGY3MjRmMGY5MjEiKSk7CgpmdW5jdGlvbiBjb25zdGFudCQxMSh4KSB7CiAgcmV0dXJuIGZ1bmN0aW9uIGNvbnN0YW50KCkgewogICAgcmV0dXJuIHg7CiAgfTsKfQoKdmFyIGFicyQxID0gTWF0aC5hYnM7CnZhciBhdGFuMiQxID0gTWF0aC5hdGFuMjsKdmFyIGNvcyQyID0gTWF0aC5jb3M7CnZhciBtYXgkMiA9IE1hdGgubWF4Owp2YXIgbWluJDEgPSBNYXRoLm1pbjsKdmFyIHNpbiQyID0gTWF0aC5zaW47CnZhciBzcXJ0JDIgPSBNYXRoLnNxcnQ7Cgp2YXIgZXBzaWxvbiQzID0gMWUtMTI7CnZhciBwaSQ0ID0gTWF0aC5QSTsKdmFyIGhhbGZQaSQzID0gcGkkNCAvIDI7CnZhciB0YXUkNCA9IDIgKiBwaSQ0OwoKZnVuY3Rpb24gYWNvcyQxKHgpIHsKICByZXR1cm4geCA+IDEgPyAwIDogeCA8IC0xID8gcGkkNCA6IE1hdGguYWNvcyh4KTsKfQoKZnVuY3Rpb24gYXNpbiQxKHgpIHsKICByZXR1cm4geCA+PSAxID8gaGFsZlBpJDMgOiB4IDw9IC0xID8gLWhhbGZQaSQzIDogTWF0aC5hc2luKHgpOwp9CgpmdW5jdGlvbiBhcmNJbm5lclJhZGl1cyhkKSB7CiAgcmV0dXJuIGQuaW5uZXJSYWRpdXM7Cn0KCmZ1bmN0aW9uIGFyY091dGVyUmFkaXVzKGQpIHsKICByZXR1cm4gZC5vdXRlclJhZGl1czsKfQoKZnVuY3Rpb24gYXJjU3RhcnRBbmdsZShkKSB7CiAgcmV0dXJuIGQuc3RhcnRBbmdsZTsKfQoKZnVuY3Rpb24gYXJjRW5kQW5nbGUoZCkgewogIHJldHVybiBkLmVuZEFuZ2xlOwp9CgpmdW5jdGlvbiBhcmNQYWRBbmdsZShkKSB7CiAgcmV0dXJuIGQgJiYgZC5wYWRBbmdsZTsgLy8gTm90ZTogb3B0aW9uYWwhCn0KCmZ1bmN0aW9uIGludGVyc2VjdCh4MCwgeTAsIHgxLCB5MSwgeDIsIHkyLCB4MywgeTMpIHsKICB2YXIgeDEwID0geDEgLSB4MCwgeTEwID0geTEgLSB5MCwKICAgICAgeDMyID0geDMgLSB4MiwgeTMyID0geTMgLSB5MiwKICAgICAgdCA9ICh4MzIgKiAoeTAgLSB5MikgLSB5MzIgKiAoeDAgLSB4MikpIC8gKHkzMiAqIHgxMCAtIHgzMiAqIHkxMCk7CiAgcmV0dXJuIFt4MCArIHQgKiB4MTAsIHkwICsgdCAqIHkxMF07Cn0KCi8vIENvbXB1dGUgcGVycGVuZGljdWxhciBvZmZzZXQgbGluZSBvZiBsZW5ndGggcmMuCi8vIGh0dHA6Ly9tYXRod29ybGQud29sZnJhbS5jb20vQ2lyY2xlLUxpbmVJbnRlcnNlY3Rpb24uaHRtbApmdW5jdGlvbiBjb3JuZXJUYW5nZW50cyh4MCwgeTAsIHgxLCB5MSwgcjEsIHJjLCBjdykgewogIHZhciB4MDEgPSB4MCAtIHgxLAogICAgICB5MDEgPSB5MCAtIHkxLAogICAgICBsbyA9IChjdyA/IHJjIDogLXJjKSAvIHNxcnQkMih4MDEgKiB4MDEgKyB5MDEgKiB5MDEpLAogICAgICBveCA9IGxvICogeTAxLAogICAgICBveSA9IC1sbyAqIHgwMSwKICAgICAgeDExID0geDAgKyBveCwKICAgICAgeTExID0geTAgKyBveSwKICAgICAgeDEwID0geDEgKyBveCwKICAgICAgeTEwID0geTEgKyBveSwKICAgICAgeDAwID0gKHgxMSArIHgxMCkgLyAyLAogICAgICB5MDAgPSAoeTExICsgeTEwKSAvIDIsCiAgICAgIGR4ID0geDEwIC0geDExLAogICAgICBkeSA9IHkxMCAtIHkxMSwKICAgICAgZDIgPSBkeCAqIGR4ICsgZHkgKiBkeSwKICAgICAgciA9IHIxIC0gcmMsCiAgICAgIEQgPSB4MTEgKiB5MTAgLSB4MTAgKiB5MTEsCiAgICAgIGQgPSAoZHkgPCAwID8gLTEgOiAxKSAqIHNxcnQkMihtYXgkMigwLCByICogciAqIGQyIC0gRCAqIEQpKSwKICAgICAgY3gwID0gKEQgKiBkeSAtIGR4ICogZCkgLyBkMiwKICAgICAgY3kwID0gKC1EICogZHggLSBkeSAqIGQpIC8gZDIsCiAgICAgIGN4MSA9IChEICogZHkgKyBkeCAqIGQpIC8gZDIsCiAgICAgIGN5MSA9ICgtRCAqIGR4ICsgZHkgKiBkKSAvIGQyLAogICAgICBkeDAgPSBjeDAgLSB4MDAsCiAgICAgIGR5MCA9IGN5MCAtIHkwMCwKICAgICAgZHgxID0gY3gxIC0geDAwLAogICAgICBkeTEgPSBjeTEgLSB5MDA7CgogIC8vIFBpY2sgdGhlIGNsb3NlciBvZiB0aGUgdHdvIGludGVyc2VjdGlvbiBwb2ludHMuCiAgLy8gVE9ETyBJcyB0aGVyZSBhIGZhc3RlciB3YXkgdG8gZGV0ZXJtaW5lIHdoaWNoIGludGVyc2VjdGlvbiB0byB1c2U/CiAgaWYgKGR4MCAqIGR4MCArIGR5MCAqIGR5MCA+IGR4MSAqIGR4MSArIGR5MSAqIGR5MSkgY3gwID0gY3gxLCBjeTAgPSBjeTE7CgogIHJldHVybiB7CiAgICBjeDogY3gwLAogICAgY3k6IGN5MCwKICAgIHgwMTogLW94LAogICAgeTAxOiAtb3ksCiAgICB4MTE6IGN4MCAqIChyMSAvIHIgLSAxKSwKICAgIHkxMTogY3kwICogKHIxIC8gciAtIDEpCiAgfTsKfQoKZnVuY3Rpb24gYXJjKCkgewogIHZhciBpbm5lclJhZGl1cyA9IGFyY0lubmVyUmFkaXVzLAogICAgICBvdXRlclJhZGl1cyA9IGFyY091dGVyUmFkaXVzLAogICAgICBjb3JuZXJSYWRpdXMgPSBjb25zdGFudCQxMSgwKSwKICAgICAgcGFkUmFkaXVzID0gbnVsbCwKICAgICAgc3RhcnRBbmdsZSA9IGFyY1N0YXJ0QW5nbGUsCiAgICAgIGVuZEFuZ2xlID0gYXJjRW5kQW5nbGUsCiAgICAgIHBhZEFuZ2xlID0gYXJjUGFkQW5nbGUsCiAgICAgIGNvbnRleHQgPSBudWxsOwoKICBmdW5jdGlvbiBhcmMoKSB7CiAgICB2YXIgYnVmZmVyLAogICAgICAgIHIsCiAgICAgICAgcjAgPSAraW5uZXJSYWRpdXMuYXBwbHkodGhpcywgYXJndW1lbnRzKSwKICAgICAgICByMSA9ICtvdXRlclJhZGl1cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpLAogICAgICAgIGEwID0gc3RhcnRBbmdsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIC0gaGFsZlBpJDMsCiAgICAgICAgYTEgPSBlbmRBbmdsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIC0gaGFsZlBpJDMsCiAgICAgICAgZGEgPSBhYnMkMShhMSAtIGEwKSwKICAgICAgICBjdyA9IGExID4gYTA7CgogICAgaWYgKCFjb250ZXh0KSBjb250ZXh0ID0gYnVmZmVyID0gcGF0aCgpOwoKICAgIC8vIEVuc3VyZSB0aGF0IHRoZSBvdXRlciByYWRpdXMgaXMgYWx3YXlzIGxhcmdlciB0aGFuIHRoZSBpbm5lciByYWRpdXMuCiAgICBpZiAocjEgPCByMCkgciA9IHIxLCByMSA9IHIwLCByMCA9IHI7CgogICAgLy8gSXMgaXQgYSBwb2ludD8KICAgIGlmICghKHIxID4gZXBzaWxvbiQzKSkgY29udGV4dC5tb3ZlVG8oMCwgMCk7CgogICAgLy8gT3IgaXMgaXQgYSBjaXJjbGUgb3IgYW5udWx1cz8KICAgIGVsc2UgaWYgKGRhID4gdGF1JDQgLSBlcHNpbG9uJDMpIHsKICAgICAgY29udGV4dC5tb3ZlVG8ocjEgKiBjb3MkMihhMCksIHIxICogc2luJDIoYTApKTsKICAgICAgY29udGV4dC5hcmMoMCwgMCwgcjEsIGEwLCBhMSwgIWN3KTsKICAgICAgaWYgKHIwID4gZXBzaWxvbiQzKSB7CiAgICAgICAgY29udGV4dC5tb3ZlVG8ocjAgKiBjb3MkMihhMSksIHIwICogc2luJDIoYTEpKTsKICAgICAgICBjb250ZXh0LmFyYygwLCAwLCByMCwgYTEsIGEwLCBjdyk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBPciBpcyBpdCBhIGNpcmN1bGFyIG9yIGFubnVsYXIgc2VjdG9yPwogICAgZWxzZSB7CiAgICAgIHZhciBhMDEgPSBhMCwKICAgICAgICAgIGExMSA9IGExLAogICAgICAgICAgYTAwID0gYTAsCiAgICAgICAgICBhMTAgPSBhMSwKICAgICAgICAgIGRhMCA9IGRhLAogICAgICAgICAgZGExID0gZGEsCiAgICAgICAgICBhcCA9IHBhZEFuZ2xlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgLyAyLAogICAgICAgICAgcnAgPSAoYXAgPiBlcHNpbG9uJDMpICYmIChwYWRSYWRpdXMgPyArcGFkUmFkaXVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBzcXJ0JDIocjAgKiByMCArIHIxICogcjEpKSwKICAgICAgICAgIHJjID0gbWluJDEoYWJzJDEocjEgLSByMCkgLyAyLCArY29ybmVyUmFkaXVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpLAogICAgICAgICAgcmMwID0gcmMsCiAgICAgICAgICByYzEgPSByYywKICAgICAgICAgIHQwLAogICAgICAgICAgdDE7CgogICAgICAvLyBBcHBseSBwYWRkaW5nPyBOb3RlIHRoYXQgc2luY2UgcjEg4omlIHIwLCBkYTEg4omlIGRhMC4KICAgICAgaWYgKHJwID4gZXBzaWxvbiQzKSB7CiAgICAgICAgdmFyIHAwID0gYXNpbiQxKHJwIC8gcjAgKiBzaW4kMihhcCkpLAogICAgICAgICAgICBwMSA9IGFzaW4kMShycCAvIHIxICogc2luJDIoYXApKTsKICAgICAgICBpZiAoKGRhMCAtPSBwMCAqIDIpID4gZXBzaWxvbiQzKSBwMCAqPSAoY3cgPyAxIDogLTEpLCBhMDAgKz0gcDAsIGExMCAtPSBwMDsKICAgICAgICBlbHNlIGRhMCA9IDAsIGEwMCA9IGExMCA9IChhMCArIGExKSAvIDI7CiAgICAgICAgaWYgKChkYTEgLT0gcDEgKiAyKSA+IGVwc2lsb24kMykgcDEgKj0gKGN3ID8gMSA6IC0xKSwgYTAxICs9IHAxLCBhMTEgLT0gcDE7CiAgICAgICAgZWxzZSBkYTEgPSAwLCBhMDEgPSBhMTEgPSAoYTAgKyBhMSkgLyAyOwogICAgICB9CgogICAgICB2YXIgeDAxID0gcjEgKiBjb3MkMihhMDEpLAogICAgICAgICAgeTAxID0gcjEgKiBzaW4kMihhMDEpLAogICAgICAgICAgeDEwID0gcjAgKiBjb3MkMihhMTApLAogICAgICAgICAgeTEwID0gcjAgKiBzaW4kMihhMTApOwoKICAgICAgLy8gQXBwbHkgcm91bmRlZCBjb3JuZXJzPwogICAgICBpZiAocmMgPiBlcHNpbG9uJDMpIHsKICAgICAgICB2YXIgeDExID0gcjEgKiBjb3MkMihhMTEpLAogICAgICAgICAgICB5MTEgPSByMSAqIHNpbiQyKGExMSksCiAgICAgICAgICAgIHgwMCA9IHIwICogY29zJDIoYTAwKSwKICAgICAgICAgICAgeTAwID0gcjAgKiBzaW4kMihhMDApOwoKICAgICAgICAvLyBSZXN0cmljdCB0aGUgY29ybmVyIHJhZGl1cyBhY2NvcmRpbmcgdG8gdGhlIHNlY3RvciBhbmdsZS4KICAgICAgICBpZiAoZGEgPCBwaSQ0KSB7CiAgICAgICAgICB2YXIgb2MgPSBkYTAgPiBlcHNpbG9uJDMgPyBpbnRlcnNlY3QoeDAxLCB5MDEsIHgwMCwgeTAwLCB4MTEsIHkxMSwgeDEwLCB5MTApIDogW3gxMCwgeTEwXSwKICAgICAgICAgICAgICBheCA9IHgwMSAtIG9jWzBdLAogICAgICAgICAgICAgIGF5ID0geTAxIC0gb2NbMV0sCiAgICAgICAgICAgICAgYnggPSB4MTEgLSBvY1swXSwKICAgICAgICAgICAgICBieSA9IHkxMSAtIG9jWzFdLAogICAgICAgICAgICAgIGtjID0gMSAvIHNpbiQyKGFjb3MkMSgoYXggKiBieCArIGF5ICogYnkpIC8gKHNxcnQkMihheCAqIGF4ICsgYXkgKiBheSkgKiBzcXJ0JDIoYnggKiBieCArIGJ5ICogYnkpKSkgLyAyKSwKICAgICAgICAgICAgICBsYyA9IHNxcnQkMihvY1swXSAqIG9jWzBdICsgb2NbMV0gKiBvY1sxXSk7CiAgICAgICAgICByYzAgPSBtaW4kMShyYywgKHIwIC0gbGMpIC8gKGtjIC0gMSkpOwogICAgICAgICAgcmMxID0gbWluJDEocmMsIChyMSAtIGxjKSAvIChrYyArIDEpKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIElzIHRoZSBzZWN0b3IgY29sbGFwc2VkIHRvIGEgbGluZT8KICAgICAgaWYgKCEoZGExID4gZXBzaWxvbiQzKSkgY29udGV4dC5tb3ZlVG8oeDAxLCB5MDEpOwoKICAgICAgLy8gRG9lcyB0aGUgc2VjdG9y4oCZcyBvdXRlciByaW5nIGhhdmUgcm91bmRlZCBjb3JuZXJzPwogICAgICBlbHNlIGlmIChyYzEgPiBlcHNpbG9uJDMpIHsKICAgICAgICB0MCA9IGNvcm5lclRhbmdlbnRzKHgwMCwgeTAwLCB4MDEsIHkwMSwgcjEsIHJjMSwgY3cpOwogICAgICAgIHQxID0gY29ybmVyVGFuZ2VudHMoeDExLCB5MTEsIHgxMCwgeTEwLCByMSwgcmMxLCBjdyk7CgogICAgICAgIGNvbnRleHQubW92ZVRvKHQwLmN4ICsgdDAueDAxLCB0MC5jeSArIHQwLnkwMSk7CgogICAgICAgIC8vIEhhdmUgdGhlIGNvcm5lcnMgbWVyZ2VkPwogICAgICAgIGlmIChyYzEgPCByYykgY29udGV4dC5hcmModDAuY3gsIHQwLmN5LCByYzEsIGF0YW4yJDEodDAueTAxLCB0MC54MDEpLCBhdGFuMiQxKHQxLnkwMSwgdDEueDAxKSwgIWN3KTsKCiAgICAgICAgLy8gT3RoZXJ3aXNlLCBkcmF3IHRoZSB0d28gY29ybmVycyBhbmQgdGhlIHJpbmcuCiAgICAgICAgZWxzZSB7CiAgICAgICAgICBjb250ZXh0LmFyYyh0MC5jeCwgdDAuY3ksIHJjMSwgYXRhbjIkMSh0MC55MDEsIHQwLngwMSksIGF0YW4yJDEodDAueTExLCB0MC54MTEpLCAhY3cpOwogICAgICAgICAgY29udGV4dC5hcmMoMCwgMCwgcjEsIGF0YW4yJDEodDAuY3kgKyB0MC55MTEsIHQwLmN4ICsgdDAueDExKSwgYXRhbjIkMSh0MS5jeSArIHQxLnkxMSwgdDEuY3ggKyB0MS54MTEpLCAhY3cpOwogICAgICAgICAgY29udGV4dC5hcmModDEuY3gsIHQxLmN5LCByYzEsIGF0YW4yJDEodDEueTExLCB0MS54MTEpLCBhdGFuMiQxKHQxLnkwMSwgdDEueDAxKSwgIWN3KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIE9yIGlzIHRoZSBvdXRlciByaW5nIGp1c3QgYSBjaXJjdWxhciBhcmM/CiAgICAgIGVsc2UgY29udGV4dC5tb3ZlVG8oeDAxLCB5MDEpLCBjb250ZXh0LmFyYygwLCAwLCByMSwgYTAxLCBhMTEsICFjdyk7CgogICAgICAvLyBJcyB0aGVyZSBubyBpbm5lciByaW5nLCBhbmQgaXTigJlzIGEgY2lyY3VsYXIgc2VjdG9yPwogICAgICAvLyBPciBwZXJoYXBzIGl04oCZcyBhbiBhbm51bGFyIHNlY3RvciBjb2xsYXBzZWQgZHVlIHRvIHBhZGRpbmc/CiAgICAgIGlmICghKHIwID4gZXBzaWxvbiQzKSB8fCAhKGRhMCA+IGVwc2lsb24kMykpIGNvbnRleHQubGluZVRvKHgxMCwgeTEwKTsKCiAgICAgIC8vIERvZXMgdGhlIHNlY3RvcuKAmXMgaW5uZXIgcmluZyAob3IgcG9pbnQpIGhhdmUgcm91bmRlZCBjb3JuZXJzPwogICAgICBlbHNlIGlmIChyYzAgPiBlcHNpbG9uJDMpIHsKICAgICAgICB0MCA9IGNvcm5lclRhbmdlbnRzKHgxMCwgeTEwLCB4MTEsIHkxMSwgcjAsIC1yYzAsIGN3KTsKICAgICAgICB0MSA9IGNvcm5lclRhbmdlbnRzKHgwMSwgeTAxLCB4MDAsIHkwMCwgcjAsIC1yYzAsIGN3KTsKCiAgICAgICAgY29udGV4dC5saW5lVG8odDAuY3ggKyB0MC54MDEsIHQwLmN5ICsgdDAueTAxKTsKCiAgICAgICAgLy8gSGF2ZSB0aGUgY29ybmVycyBtZXJnZWQ/CiAgICAgICAgaWYgKHJjMCA8IHJjKSBjb250ZXh0LmFyYyh0MC5jeCwgdDAuY3ksIHJjMCwgYXRhbjIkMSh0MC55MDEsIHQwLngwMSksIGF0YW4yJDEodDEueTAxLCB0MS54MDEpLCAhY3cpOwoKICAgICAgICAvLyBPdGhlcndpc2UsIGRyYXcgdGhlIHR3byBjb3JuZXJzIGFuZCB0aGUgcmluZy4KICAgICAgICBlbHNlIHsKICAgICAgICAgIGNvbnRleHQuYXJjKHQwLmN4LCB0MC5jeSwgcmMwLCBhdGFuMiQxKHQwLnkwMSwgdDAueDAxKSwgYXRhbjIkMSh0MC55MTEsIHQwLngxMSksICFjdyk7CiAgICAgICAgICBjb250ZXh0LmFyYygwLCAwLCByMCwgYXRhbjIkMSh0MC5jeSArIHQwLnkxMSwgdDAuY3ggKyB0MC54MTEpLCBhdGFuMiQxKHQxLmN5ICsgdDEueTExLCB0MS5jeCArIHQxLngxMSksIGN3KTsKICAgICAgICAgIGNvbnRleHQuYXJjKHQxLmN4LCB0MS5jeSwgcmMwLCBhdGFuMiQxKHQxLnkxMSwgdDEueDExKSwgYXRhbjIkMSh0MS55MDEsIHQxLngwMSksICFjdyk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBPciBpcyB0aGUgaW5uZXIgcmluZyBqdXN0IGEgY2lyY3VsYXIgYXJjPwogICAgICBlbHNlIGNvbnRleHQuYXJjKDAsIDAsIHIwLCBhMTAsIGEwMCwgY3cpOwogICAgfQoKICAgIGNvbnRleHQuY2xvc2VQYXRoKCk7CgogICAgaWYgKGJ1ZmZlcikgcmV0dXJuIGNvbnRleHQgPSBudWxsLCBidWZmZXIgKyAiIiB8fCBudWxsOwogIH0KCiAgYXJjLmNlbnRyb2lkID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgciA9ICgraW5uZXJSYWRpdXMuYXBwbHkodGhpcywgYXJndW1lbnRzKSArICtvdXRlclJhZGl1cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSAvIDIsCiAgICAgICAgYSA9ICgrc3RhcnRBbmdsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpICsgK2VuZEFuZ2xlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIC8gMiAtIHBpJDQgLyAyOwogICAgcmV0dXJuIFtjb3MkMihhKSAqIHIsIHNpbiQyKGEpICogcl07CiAgfTsKCiAgYXJjLmlubmVyUmFkaXVzID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoaW5uZXJSYWRpdXMgPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQxMSgrXyksIGFyYykgOiBpbm5lclJhZGl1czsKICB9OwoKICBhcmMub3V0ZXJSYWRpdXMgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChvdXRlclJhZGl1cyA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IGNvbnN0YW50JDExKCtfKSwgYXJjKSA6IG91dGVyUmFkaXVzOwogIH07CgogIGFyYy5jb3JuZXJSYWRpdXMgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChjb3JuZXJSYWRpdXMgPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQxMSgrXyksIGFyYykgOiBjb3JuZXJSYWRpdXM7CiAgfTsKCiAgYXJjLnBhZFJhZGl1cyA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHBhZFJhZGl1cyA9IF8gPT0gbnVsbCA/IG51bGwgOiB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQxMSgrXyksIGFyYykgOiBwYWRSYWRpdXM7CiAgfTsKCiAgYXJjLnN0YXJ0QW5nbGUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChzdGFydEFuZ2xlID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMTEoK18pLCBhcmMpIDogc3RhcnRBbmdsZTsKICB9OwoKICBhcmMuZW5kQW5nbGUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlbmRBbmdsZSA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IGNvbnN0YW50JDExKCtfKSwgYXJjKSA6IGVuZEFuZ2xlOwogIH07CgogIGFyYy5wYWRBbmdsZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHBhZEFuZ2xlID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMTEoK18pLCBhcmMpIDogcGFkQW5nbGU7CiAgfTsKCiAgYXJjLmNvbnRleHQgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChjb250ZXh0ID0gXyA9PSBudWxsID8gbnVsbCA6IF8sIGFyYykgOiBjb250ZXh0OwogIH07CgogIHJldHVybiBhcmM7Cn0KCmZ1bmN0aW9uIExpbmVhcihjb250ZXh0KSB7CiAgdGhpcy5fY29udGV4dCA9IGNvbnRleHQ7Cn0KCkxpbmVhci5wcm90b3R5cGUgPSB7CiAgYXJlYVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX2xpbmUgPSAwOwogIH0sCiAgYXJlYUVuZDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9saW5lID0gTmFOOwogIH0sCiAgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX3BvaW50ID0gMDsKICB9LAogIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMuX2xpbmUgfHwgKHRoaXMuX2xpbmUgIT09IDAgJiYgdGhpcy5fcG9pbnQgPT09IDEpKSB0aGlzLl9jb250ZXh0LmNsb3NlUGF0aCgpOwogICAgdGhpcy5fbGluZSA9IDEgLSB0aGlzLl9saW5lOwogIH0sCiAgcG9pbnQ6IGZ1bmN0aW9uKHgsIHkpIHsKICAgIHggPSAreCwgeSA9ICt5OwogICAgc3dpdGNoICh0aGlzLl9wb2ludCkgewogICAgICBjYXNlIDA6IHRoaXMuX3BvaW50ID0gMTsgdGhpcy5fbGluZSA/IHRoaXMuX2NvbnRleHQubGluZVRvKHgsIHkpIDogdGhpcy5fY29udGV4dC5tb3ZlVG8oeCwgeSk7IGJyZWFrOwogICAgICBjYXNlIDE6IHRoaXMuX3BvaW50ID0gMjsgLy8gcHJvY2VlZAogICAgICBkZWZhdWx0OiB0aGlzLl9jb250ZXh0LmxpbmVUbyh4LCB5KTsgYnJlYWs7CiAgICB9CiAgfQp9OwoKZnVuY3Rpb24gY3VydmVMaW5lYXIoY29udGV4dCkgewogIHJldHVybiBuZXcgTGluZWFyKGNvbnRleHQpOwp9CgpmdW5jdGlvbiB4JDMocCkgewogIHJldHVybiBwWzBdOwp9CgpmdW5jdGlvbiB5JDMocCkgewogIHJldHVybiBwWzFdOwp9CgpmdW5jdGlvbiBsaW5lKCkgewogIHZhciB4JCQxID0geCQzLAogICAgICB5JCQxID0geSQzLAogICAgICBkZWZpbmVkID0gY29uc3RhbnQkMTEodHJ1ZSksCiAgICAgIGNvbnRleHQgPSBudWxsLAogICAgICBjdXJ2ZSA9IGN1cnZlTGluZWFyLAogICAgICBvdXRwdXQgPSBudWxsOwoKICBmdW5jdGlvbiBsaW5lKGRhdGEpIHsKICAgIHZhciBpLAogICAgICAgIG4gPSBkYXRhLmxlbmd0aCwKICAgICAgICBkLAogICAgICAgIGRlZmluZWQwID0gZmFsc2UsCiAgICAgICAgYnVmZmVyOwoKICAgIGlmIChjb250ZXh0ID09IG51bGwpIG91dHB1dCA9IGN1cnZlKGJ1ZmZlciA9IHBhdGgoKSk7CgogICAgZm9yIChpID0gMDsgaSA8PSBuOyArK2kpIHsKICAgICAgaWYgKCEoaSA8IG4gJiYgZGVmaW5lZChkID0gZGF0YVtpXSwgaSwgZGF0YSkpID09PSBkZWZpbmVkMCkgewogICAgICAgIGlmIChkZWZpbmVkMCA9ICFkZWZpbmVkMCkgb3V0cHV0LmxpbmVTdGFydCgpOwogICAgICAgIGVsc2Ugb3V0cHV0LmxpbmVFbmQoKTsKICAgICAgfQogICAgICBpZiAoZGVmaW5lZDApIG91dHB1dC5wb2ludCgreCQkMShkLCBpLCBkYXRhKSwgK3kkJDEoZCwgaSwgZGF0YSkpOwogICAgfQoKICAgIGlmIChidWZmZXIpIHJldHVybiBvdXRwdXQgPSBudWxsLCBidWZmZXIgKyAiIiB8fCBudWxsOwogIH0KCiAgbGluZS54ID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoeCQkMSA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IGNvbnN0YW50JDExKCtfKSwgbGluZSkgOiB4JCQxOwogIH07CgogIGxpbmUueSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHkkJDEgPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQxMSgrXyksIGxpbmUpIDogeSQkMTsKICB9OwoKICBsaW5lLmRlZmluZWQgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChkZWZpbmVkID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMTEoISFfKSwgbGluZSkgOiBkZWZpbmVkOwogIH07CgogIGxpbmUuY3VydmUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChjdXJ2ZSA9IF8sIGNvbnRleHQgIT0gbnVsbCAmJiAob3V0cHV0ID0gY3VydmUoY29udGV4dCkpLCBsaW5lKSA6IGN1cnZlOwogIH07CgogIGxpbmUuY29udGV4dCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKF8gPT0gbnVsbCA/IGNvbnRleHQgPSBvdXRwdXQgPSBudWxsIDogb3V0cHV0ID0gY3VydmUoY29udGV4dCA9IF8pLCBsaW5lKSA6IGNvbnRleHQ7CiAgfTsKCiAgcmV0dXJuIGxpbmU7Cn0KCmZ1bmN0aW9uIGFyZWEkMygpIHsKICB2YXIgeDAgPSB4JDMsCiAgICAgIHgxID0gbnVsbCwKICAgICAgeTAgPSBjb25zdGFudCQxMSgwKSwKICAgICAgeTEgPSB5JDMsCiAgICAgIGRlZmluZWQgPSBjb25zdGFudCQxMSh0cnVlKSwKICAgICAgY29udGV4dCA9IG51bGwsCiAgICAgIGN1cnZlID0gY3VydmVMaW5lYXIsCiAgICAgIG91dHB1dCA9IG51bGw7CgogIGZ1bmN0aW9uIGFyZWEoZGF0YSkgewogICAgdmFyIGksCiAgICAgICAgaiwKICAgICAgICBrLAogICAgICAgIG4gPSBkYXRhLmxlbmd0aCwKICAgICAgICBkLAogICAgICAgIGRlZmluZWQwID0gZmFsc2UsCiAgICAgICAgYnVmZmVyLAogICAgICAgIHgweiA9IG5ldyBBcnJheShuKSwKICAgICAgICB5MHogPSBuZXcgQXJyYXkobik7CgogICAgaWYgKGNvbnRleHQgPT0gbnVsbCkgb3V0cHV0ID0gY3VydmUoYnVmZmVyID0gcGF0aCgpKTsKCiAgICBmb3IgKGkgPSAwOyBpIDw9IG47ICsraSkgewogICAgICBpZiAoIShpIDwgbiAmJiBkZWZpbmVkKGQgPSBkYXRhW2ldLCBpLCBkYXRhKSkgPT09IGRlZmluZWQwKSB7CiAgICAgICAgaWYgKGRlZmluZWQwID0gIWRlZmluZWQwKSB7CiAgICAgICAgICBqID0gaTsKICAgICAgICAgIG91dHB1dC5hcmVhU3RhcnQoKTsKICAgICAgICAgIG91dHB1dC5saW5lU3RhcnQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb3V0cHV0LmxpbmVFbmQoKTsKICAgICAgICAgIG91dHB1dC5saW5lU3RhcnQoKTsKICAgICAgICAgIGZvciAoayA9IGkgLSAxOyBrID49IGo7IC0taykgewogICAgICAgICAgICBvdXRwdXQucG9pbnQoeDB6W2tdLCB5MHpba10pOwogICAgICAgICAgfQogICAgICAgICAgb3V0cHV0LmxpbmVFbmQoKTsKICAgICAgICAgIG91dHB1dC5hcmVhRW5kKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChkZWZpbmVkMCkgewogICAgICAgIHgweltpXSA9ICt4MChkLCBpLCBkYXRhKSwgeTB6W2ldID0gK3kwKGQsIGksIGRhdGEpOwogICAgICAgIG91dHB1dC5wb2ludCh4MSA/ICt4MShkLCBpLCBkYXRhKSA6IHgweltpXSwgeTEgPyAreTEoZCwgaSwgZGF0YSkgOiB5MHpbaV0pOwogICAgICB9CiAgICB9CgogICAgaWYgKGJ1ZmZlcikgcmV0dXJuIG91dHB1dCA9IG51bGwsIGJ1ZmZlciArICIiIHx8IG51bGw7CiAgfQoKICBmdW5jdGlvbiBhcmVhbGluZSgpIHsKICAgIHJldHVybiBsaW5lKCkuZGVmaW5lZChkZWZpbmVkKS5jdXJ2ZShjdXJ2ZSkuY29udGV4dChjb250ZXh0KTsKICB9CgogIGFyZWEueCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHgwID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMTEoK18pLCB4MSA9IG51bGwsIGFyZWEpIDogeDA7CiAgfTsKCiAgYXJlYS54MCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHgwID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMTEoK18pLCBhcmVhKSA6IHgwOwogIH07CgogIGFyZWEueDEgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh4MSA9IF8gPT0gbnVsbCA/IG51bGwgOiB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQxMSgrXyksIGFyZWEpIDogeDE7CiAgfTsKCiAgYXJlYS55ID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoeTAgPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQxMSgrXyksIHkxID0gbnVsbCwgYXJlYSkgOiB5MDsKICB9OwoKICBhcmVhLnkwID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoeTAgPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQxMSgrXyksIGFyZWEpIDogeTA7CiAgfTsKCiAgYXJlYS55MSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHkxID0gXyA9PSBudWxsID8gbnVsbCA6IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IGNvbnN0YW50JDExKCtfKSwgYXJlYSkgOiB5MTsKICB9OwoKICBhcmVhLmxpbmVYMCA9CiAgYXJlYS5saW5lWTAgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBhcmVhbGluZSgpLngoeDApLnkoeTApOwogIH07CgogIGFyZWEubGluZVkxID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gYXJlYWxpbmUoKS54KHgwKS55KHkxKTsKICB9OwoKICBhcmVhLmxpbmVYMSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGFyZWFsaW5lKCkueCh4MSkueSh5MCk7CiAgfTsKCiAgYXJlYS5kZWZpbmVkID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZGVmaW5lZCA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IGNvbnN0YW50JDExKCEhXyksIGFyZWEpIDogZGVmaW5lZDsKICB9OwoKICBhcmVhLmN1cnZlID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoY3VydmUgPSBfLCBjb250ZXh0ICE9IG51bGwgJiYgKG91dHB1dCA9IGN1cnZlKGNvbnRleHQpKSwgYXJlYSkgOiBjdXJ2ZTsKICB9OwoKICBhcmVhLmNvbnRleHQgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChfID09IG51bGwgPyBjb250ZXh0ID0gb3V0cHV0ID0gbnVsbCA6IG91dHB1dCA9IGN1cnZlKGNvbnRleHQgPSBfKSwgYXJlYSkgOiBjb250ZXh0OwogIH07CgogIHJldHVybiBhcmVhOwp9CgpmdW5jdGlvbiBkZXNjZW5kaW5nJDEoYSwgYikgewogIHJldHVybiBiIDwgYSA/IC0xIDogYiA+IGEgPyAxIDogYiA+PSBhID8gMCA6IE5hTjsKfQoKZnVuY3Rpb24gaWRlbnRpdHkkNyhkKSB7CiAgcmV0dXJuIGQ7Cn0KCmZ1bmN0aW9uIHBpZSgpIHsKICB2YXIgdmFsdWUgPSBpZGVudGl0eSQ3LAogICAgICBzb3J0VmFsdWVzID0gZGVzY2VuZGluZyQxLAogICAgICBzb3J0ID0gbnVsbCwKICAgICAgc3RhcnRBbmdsZSA9IGNvbnN0YW50JDExKDApLAogICAgICBlbmRBbmdsZSA9IGNvbnN0YW50JDExKHRhdSQ0KSwKICAgICAgcGFkQW5nbGUgPSBjb25zdGFudCQxMSgwKTsKCiAgZnVuY3Rpb24gcGllKGRhdGEpIHsKICAgIHZhciBpLAogICAgICAgIG4gPSBkYXRhLmxlbmd0aCwKICAgICAgICBqLAogICAgICAgIGssCiAgICAgICAgc3VtID0gMCwKICAgICAgICBpbmRleCA9IG5ldyBBcnJheShuKSwKICAgICAgICBhcmNzID0gbmV3IEFycmF5KG4pLAogICAgICAgIGEwID0gK3N0YXJ0QW5nbGUuYXBwbHkodGhpcywgYXJndW1lbnRzKSwKICAgICAgICBkYSA9IE1hdGgubWluKHRhdSQ0LCBNYXRoLm1heCgtdGF1JDQsIGVuZEFuZ2xlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgLSBhMCkpLAogICAgICAgIGExLAogICAgICAgIHAgPSBNYXRoLm1pbihNYXRoLmFicyhkYSkgLyBuLCBwYWRBbmdsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSwKICAgICAgICBwYSA9IHAgKiAoZGEgPCAwID8gLTEgOiAxKSwKICAgICAgICB2OwoKICAgIGZvciAoaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgaWYgKCh2ID0gYXJjc1tpbmRleFtpXSA9IGldID0gK3ZhbHVlKGRhdGFbaV0sIGksIGRhdGEpKSA+IDApIHsKICAgICAgICBzdW0gKz0gdjsKICAgICAgfQogICAgfQoKICAgIC8vIE9wdGlvbmFsbHkgc29ydCB0aGUgYXJjcyBieSBwcmV2aW91c2x5LWNvbXB1dGVkIHZhbHVlcyBvciBieSBkYXRhLgogICAgaWYgKHNvcnRWYWx1ZXMgIT0gbnVsbCkgaW5kZXguc29ydChmdW5jdGlvbihpLCBqKSB7IHJldHVybiBzb3J0VmFsdWVzKGFyY3NbaV0sIGFyY3Nbal0pOyB9KTsKICAgIGVsc2UgaWYgKHNvcnQgIT0gbnVsbCkgaW5kZXguc29ydChmdW5jdGlvbihpLCBqKSB7IHJldHVybiBzb3J0KGRhdGFbaV0sIGRhdGFbal0pOyB9KTsKCiAgICAvLyBDb21wdXRlIHRoZSBhcmNzISBUaGV5IGFyZSBzdG9yZWQgaW4gdGhlIG9yaWdpbmFsIGRhdGEncyBvcmRlci4KICAgIGZvciAoaSA9IDAsIGsgPSBzdW0gPyAoZGEgLSBuICogcGEpIC8gc3VtIDogMDsgaSA8IG47ICsraSwgYTAgPSBhMSkgewogICAgICBqID0gaW5kZXhbaV0sIHYgPSBhcmNzW2pdLCBhMSA9IGEwICsgKHYgPiAwID8gdiAqIGsgOiAwKSArIHBhLCBhcmNzW2pdID0gewogICAgICAgIGRhdGE6IGRhdGFbal0sCiAgICAgICAgaW5kZXg6IGksCiAgICAgICAgdmFsdWU6IHYsCiAgICAgICAgc3RhcnRBbmdsZTogYTAsCiAgICAgICAgZW5kQW5nbGU6IGExLAogICAgICAgIHBhZEFuZ2xlOiBwCiAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIGFyY3M7CiAgfQoKICBwaWUudmFsdWUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh2YWx1ZSA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IGNvbnN0YW50JDExKCtfKSwgcGllKSA6IHZhbHVlOwogIH07CgogIHBpZS5zb3J0VmFsdWVzID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoc29ydFZhbHVlcyA9IF8sIHNvcnQgPSBudWxsLCBwaWUpIDogc29ydFZhbHVlczsKICB9OwoKICBwaWUuc29ydCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHNvcnQgPSBfLCBzb3J0VmFsdWVzID0gbnVsbCwgcGllKSA6IHNvcnQ7CiAgfTsKCiAgcGllLnN0YXJ0QW5nbGUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChzdGFydEFuZ2xlID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMTEoK18pLCBwaWUpIDogc3RhcnRBbmdsZTsKICB9OwoKICBwaWUuZW5kQW5nbGUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlbmRBbmdsZSA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IGNvbnN0YW50JDExKCtfKSwgcGllKSA6IGVuZEFuZ2xlOwogIH07CgogIHBpZS5wYWRBbmdsZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHBhZEFuZ2xlID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMTEoK18pLCBwaWUpIDogcGFkQW5nbGU7CiAgfTsKCiAgcmV0dXJuIHBpZTsKfQoKdmFyIGN1cnZlUmFkaWFsTGluZWFyID0gY3VydmVSYWRpYWwoY3VydmVMaW5lYXIpOwoKZnVuY3Rpb24gUmFkaWFsKGN1cnZlKSB7CiAgdGhpcy5fY3VydmUgPSBjdXJ2ZTsKfQoKUmFkaWFsLnByb3RvdHlwZSA9IHsKICBhcmVhU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fY3VydmUuYXJlYVN0YXJ0KCk7CiAgfSwKICBhcmVhRW5kOiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX2N1cnZlLmFyZWFFbmQoKTsKICB9LAogIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9jdXJ2ZS5saW5lU3RhcnQoKTsKICB9LAogIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fY3VydmUubGluZUVuZCgpOwogIH0sCiAgcG9pbnQ6IGZ1bmN0aW9uKGEsIHIpIHsKICAgIHRoaXMuX2N1cnZlLnBvaW50KHIgKiBNYXRoLnNpbihhKSwgciAqIC1NYXRoLmNvcyhhKSk7CiAgfQp9OwoKZnVuY3Rpb24gY3VydmVSYWRpYWwoY3VydmUpIHsKCiAgZnVuY3Rpb24gcmFkaWFsKGNvbnRleHQpIHsKICAgIHJldHVybiBuZXcgUmFkaWFsKGN1cnZlKGNvbnRleHQpKTsKICB9CgogIHJhZGlhbC5fY3VydmUgPSBjdXJ2ZTsKCiAgcmV0dXJuIHJhZGlhbDsKfQoKZnVuY3Rpb24gbGluZVJhZGlhbChsKSB7CiAgdmFyIGMgPSBsLmN1cnZlOwoKICBsLmFuZ2xlID0gbC54LCBkZWxldGUgbC54OwogIGwucmFkaXVzID0gbC55LCBkZWxldGUgbC55OwoKICBsLmN1cnZlID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyBjKGN1cnZlUmFkaWFsKF8pKSA6IGMoKS5fY3VydmU7CiAgfTsKCiAgcmV0dXJuIGw7Cn0KCmZ1bmN0aW9uIGxpbmVSYWRpYWwkMSgpIHsKICByZXR1cm4gbGluZVJhZGlhbChsaW5lKCkuY3VydmUoY3VydmVSYWRpYWxMaW5lYXIpKTsKfQoKZnVuY3Rpb24gYXJlYVJhZGlhbCgpIHsKICB2YXIgYSA9IGFyZWEkMygpLmN1cnZlKGN1cnZlUmFkaWFsTGluZWFyKSwKICAgICAgYyA9IGEuY3VydmUsCiAgICAgIHgwID0gYS5saW5lWDAsCiAgICAgIHgxID0gYS5saW5lWDEsCiAgICAgIHkwID0gYS5saW5lWTAsCiAgICAgIHkxID0gYS5saW5lWTE7CgogIGEuYW5nbGUgPSBhLngsIGRlbGV0ZSBhLng7CiAgYS5zdGFydEFuZ2xlID0gYS54MCwgZGVsZXRlIGEueDA7CiAgYS5lbmRBbmdsZSA9IGEueDEsIGRlbGV0ZSBhLngxOwogIGEucmFkaXVzID0gYS55LCBkZWxldGUgYS55OwogIGEuaW5uZXJSYWRpdXMgPSBhLnkwLCBkZWxldGUgYS55MDsKICBhLm91dGVyUmFkaXVzID0gYS55MSwgZGVsZXRlIGEueTE7CiAgYS5saW5lU3RhcnRBbmdsZSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gbGluZVJhZGlhbCh4MCgpKTsgfSwgZGVsZXRlIGEubGluZVgwOwogIGEubGluZUVuZEFuZ2xlID0gZnVuY3Rpb24oKSB7IHJldHVybiBsaW5lUmFkaWFsKHgxKCkpOyB9LCBkZWxldGUgYS5saW5lWDE7CiAgYS5saW5lSW5uZXJSYWRpdXMgPSBmdW5jdGlvbigpIHsgcmV0dXJuIGxpbmVSYWRpYWwoeTAoKSk7IH0sIGRlbGV0ZSBhLmxpbmVZMDsKICBhLmxpbmVPdXRlclJhZGl1cyA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gbGluZVJhZGlhbCh5MSgpKTsgfSwgZGVsZXRlIGEubGluZVkxOwoKICBhLmN1cnZlID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyBjKGN1cnZlUmFkaWFsKF8pKSA6IGMoKS5fY3VydmU7CiAgfTsKCiAgcmV0dXJuIGE7Cn0KCmZ1bmN0aW9uIHBvaW50UmFkaWFsKHgsIHkpIHsKICByZXR1cm4gWyh5ID0gK3kpICogTWF0aC5jb3MoeCAtPSBNYXRoLlBJIC8gMiksIHkgKiBNYXRoLnNpbih4KV07Cn0KCnZhciBzbGljZSQ2ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlOwoKZnVuY3Rpb24gbGlua1NvdXJjZShkKSB7CiAgcmV0dXJuIGQuc291cmNlOwp9CgpmdW5jdGlvbiBsaW5rVGFyZ2V0KGQpIHsKICByZXR1cm4gZC50YXJnZXQ7Cn0KCmZ1bmN0aW9uIGxpbmskMihjdXJ2ZSkgewogIHZhciBzb3VyY2UgPSBsaW5rU291cmNlLAogICAgICB0YXJnZXQgPSBsaW5rVGFyZ2V0LAogICAgICB4JCQxID0geCQzLAogICAgICB5JCQxID0geSQzLAogICAgICBjb250ZXh0ID0gbnVsbDsKCiAgZnVuY3Rpb24gbGluaygpIHsKICAgIHZhciBidWZmZXIsIGFyZ3YgPSBzbGljZSQ2LmNhbGwoYXJndW1lbnRzKSwgcyA9IHNvdXJjZS5hcHBseSh0aGlzLCBhcmd2KSwgdCA9IHRhcmdldC5hcHBseSh0aGlzLCBhcmd2KTsKICAgIGlmICghY29udGV4dCkgY29udGV4dCA9IGJ1ZmZlciA9IHBhdGgoKTsKICAgIGN1cnZlKGNvbnRleHQsICt4JCQxLmFwcGx5KHRoaXMsIChhcmd2WzBdID0gcywgYXJndikpLCAreSQkMS5hcHBseSh0aGlzLCBhcmd2KSwgK3gkJDEuYXBwbHkodGhpcywgKGFyZ3ZbMF0gPSB0LCBhcmd2KSksICt5JCQxLmFwcGx5KHRoaXMsIGFyZ3YpKTsKICAgIGlmIChidWZmZXIpIHJldHVybiBjb250ZXh0ID0gbnVsbCwgYnVmZmVyICsgIiIgfHwgbnVsbDsKICB9CgogIGxpbmsuc291cmNlID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoc291cmNlID0gXywgbGluaykgOiBzb3VyY2U7CiAgfTsKCiAgbGluay50YXJnZXQgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0YXJnZXQgPSBfLCBsaW5rKSA6IHRhcmdldDsKICB9OwoKICBsaW5rLnggPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh4JCQxID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMTEoK18pLCBsaW5rKSA6IHgkJDE7CiAgfTsKCiAgbGluay55ID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoeSQkMSA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IGNvbnN0YW50JDExKCtfKSwgbGluaykgOiB5JCQxOwogIH07CgogIGxpbmsuY29udGV4dCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGNvbnRleHQgPSBfID09IG51bGwgPyBudWxsIDogXywgbGluaykgOiBjb250ZXh0OwogIH07CgogIHJldHVybiBsaW5rOwp9CgpmdW5jdGlvbiBjdXJ2ZUhvcml6b250YWwoY29udGV4dCwgeDAsIHkwLCB4MSwgeTEpIHsKICBjb250ZXh0Lm1vdmVUbyh4MCwgeTApOwogIGNvbnRleHQuYmV6aWVyQ3VydmVUbyh4MCA9ICh4MCArIHgxKSAvIDIsIHkwLCB4MCwgeTEsIHgxLCB5MSk7Cn0KCmZ1bmN0aW9uIGN1cnZlVmVydGljYWwoY29udGV4dCwgeDAsIHkwLCB4MSwgeTEpIHsKICBjb250ZXh0Lm1vdmVUbyh4MCwgeTApOwogIGNvbnRleHQuYmV6aWVyQ3VydmVUbyh4MCwgeTAgPSAoeTAgKyB5MSkgLyAyLCB4MSwgeTAsIHgxLCB5MSk7Cn0KCmZ1bmN0aW9uIGN1cnZlUmFkaWFsJDEoY29udGV4dCwgeDAsIHkwLCB4MSwgeTEpIHsKICB2YXIgcDAgPSBwb2ludFJhZGlhbCh4MCwgeTApLAogICAgICBwMSA9IHBvaW50UmFkaWFsKHgwLCB5MCA9ICh5MCArIHkxKSAvIDIpLAogICAgICBwMiA9IHBvaW50UmFkaWFsKHgxLCB5MCksCiAgICAgIHAzID0gcG9pbnRSYWRpYWwoeDEsIHkxKTsKICBjb250ZXh0Lm1vdmVUbyhwMFswXSwgcDBbMV0pOwogIGNvbnRleHQuYmV6aWVyQ3VydmVUbyhwMVswXSwgcDFbMV0sIHAyWzBdLCBwMlsxXSwgcDNbMF0sIHAzWzFdKTsKfQoKZnVuY3Rpb24gbGlua0hvcml6b250YWwoKSB7CiAgcmV0dXJuIGxpbmskMihjdXJ2ZUhvcml6b250YWwpOwp9CgpmdW5jdGlvbiBsaW5rVmVydGljYWwoKSB7CiAgcmV0dXJuIGxpbmskMihjdXJ2ZVZlcnRpY2FsKTsKfQoKZnVuY3Rpb24gbGlua1JhZGlhbCgpIHsKICB2YXIgbCA9IGxpbmskMihjdXJ2ZVJhZGlhbCQxKTsKICBsLmFuZ2xlID0gbC54LCBkZWxldGUgbC54OwogIGwucmFkaXVzID0gbC55LCBkZWxldGUgbC55OwogIHJldHVybiBsOwp9Cgp2YXIgY2lyY2xlJDIgPSB7CiAgZHJhdzogZnVuY3Rpb24oY29udGV4dCwgc2l6ZSkgewogICAgdmFyIHIgPSBNYXRoLnNxcnQoc2l6ZSAvIHBpJDQpOwogICAgY29udGV4dC5tb3ZlVG8ociwgMCk7CiAgICBjb250ZXh0LmFyYygwLCAwLCByLCAwLCB0YXUkNCk7CiAgfQp9OwoKdmFyIGNyb3NzJDIgPSB7CiAgZHJhdzogZnVuY3Rpb24oY29udGV4dCwgc2l6ZSkgewogICAgdmFyIHIgPSBNYXRoLnNxcnQoc2l6ZSAvIDUpIC8gMjsKICAgIGNvbnRleHQubW92ZVRvKC0zICogciwgLXIpOwogICAgY29udGV4dC5saW5lVG8oLXIsIC1yKTsKICAgIGNvbnRleHQubGluZVRvKC1yLCAtMyAqIHIpOwogICAgY29udGV4dC5saW5lVG8ociwgLTMgKiByKTsKICAgIGNvbnRleHQubGluZVRvKHIsIC1yKTsKICAgIGNvbnRleHQubGluZVRvKDMgKiByLCAtcik7CiAgICBjb250ZXh0LmxpbmVUbygzICogciwgcik7CiAgICBjb250ZXh0LmxpbmVUbyhyLCByKTsKICAgIGNvbnRleHQubGluZVRvKHIsIDMgKiByKTsKICAgIGNvbnRleHQubGluZVRvKC1yLCAzICogcik7CiAgICBjb250ZXh0LmxpbmVUbygtciwgcik7CiAgICBjb250ZXh0LmxpbmVUbygtMyAqIHIsIHIpOwogICAgY29udGV4dC5jbG9zZVBhdGgoKTsKICB9Cn07Cgp2YXIgdGFuMzAgPSBNYXRoLnNxcnQoMSAvIDMpLAogICAgdGFuMzBfMiA9IHRhbjMwICogMjsKCnZhciBkaWFtb25kID0gewogIGRyYXc6IGZ1bmN0aW9uKGNvbnRleHQsIHNpemUpIHsKICAgIHZhciB5ID0gTWF0aC5zcXJ0KHNpemUgLyB0YW4zMF8yKSwKICAgICAgICB4ID0geSAqIHRhbjMwOwogICAgY29udGV4dC5tb3ZlVG8oMCwgLXkpOwogICAgY29udGV4dC5saW5lVG8oeCwgMCk7CiAgICBjb250ZXh0LmxpbmVUbygwLCB5KTsKICAgIGNvbnRleHQubGluZVRvKC14LCAwKTsKICAgIGNvbnRleHQuY2xvc2VQYXRoKCk7CiAgfQp9OwoKdmFyIGthID0gMC44OTA4MTMwOTE1MjkyODUyMjgxMCwKICAgIGtyID0gTWF0aC5zaW4ocGkkNCAvIDEwKSAvIE1hdGguc2luKDcgKiBwaSQ0IC8gMTApLAogICAga3ggPSBNYXRoLnNpbih0YXUkNCAvIDEwKSAqIGtyLAogICAga3kgPSAtTWF0aC5jb3ModGF1JDQgLyAxMCkgKiBrcjsKCnZhciBzdGFyID0gewogIGRyYXc6IGZ1bmN0aW9uKGNvbnRleHQsIHNpemUpIHsKICAgIHZhciByID0gTWF0aC5zcXJ0KHNpemUgKiBrYSksCiAgICAgICAgeCA9IGt4ICogciwKICAgICAgICB5ID0ga3kgKiByOwogICAgY29udGV4dC5tb3ZlVG8oMCwgLXIpOwogICAgY29udGV4dC5saW5lVG8oeCwgeSk7CiAgICBmb3IgKHZhciBpID0gMTsgaSA8IDU7ICsraSkgewogICAgICB2YXIgYSA9IHRhdSQ0ICogaSAvIDUsCiAgICAgICAgICBjID0gTWF0aC5jb3MoYSksCiAgICAgICAgICBzID0gTWF0aC5zaW4oYSk7CiAgICAgIGNvbnRleHQubGluZVRvKHMgKiByLCAtYyAqIHIpOwogICAgICBjb250ZXh0LmxpbmVUbyhjICogeCAtIHMgKiB5LCBzICogeCArIGMgKiB5KTsKICAgIH0KICAgIGNvbnRleHQuY2xvc2VQYXRoKCk7CiAgfQp9OwoKdmFyIHNxdWFyZSA9IHsKICBkcmF3OiBmdW5jdGlvbihjb250ZXh0LCBzaXplKSB7CiAgICB2YXIgdyA9IE1hdGguc3FydChzaXplKSwKICAgICAgICB4ID0gLXcgLyAyOwogICAgY29udGV4dC5yZWN0KHgsIHgsIHcsIHcpOwogIH0KfTsKCnZhciBzcXJ0MyA9IE1hdGguc3FydCgzKTsKCnZhciB0cmlhbmdsZSA9IHsKICBkcmF3OiBmdW5jdGlvbihjb250ZXh0LCBzaXplKSB7CiAgICB2YXIgeSA9IC1NYXRoLnNxcnQoc2l6ZSAvIChzcXJ0MyAqIDMpKTsKICAgIGNvbnRleHQubW92ZVRvKDAsIHkgKiAyKTsKICAgIGNvbnRleHQubGluZVRvKC1zcXJ0MyAqIHksIC15KTsKICAgIGNvbnRleHQubGluZVRvKHNxcnQzICogeSwgLXkpOwogICAgY29udGV4dC5jbG9zZVBhdGgoKTsKICB9Cn07Cgp2YXIgYyA9IC0wLjUsCiAgICBzID0gTWF0aC5zcXJ0KDMpIC8gMiwKICAgIGsgPSAxIC8gTWF0aC5zcXJ0KDEyKSwKICAgIGEgPSAoayAvIDIgKyAxKSAqIDM7Cgp2YXIgd3llID0gewogIGRyYXc6IGZ1bmN0aW9uKGNvbnRleHQsIHNpemUpIHsKICAgIHZhciByID0gTWF0aC5zcXJ0KHNpemUgLyBhKSwKICAgICAgICB4MCA9IHIgLyAyLAogICAgICAgIHkwID0gciAqIGssCiAgICAgICAgeDEgPSB4MCwKICAgICAgICB5MSA9IHIgKiBrICsgciwKICAgICAgICB4MiA9IC14MSwKICAgICAgICB5MiA9IHkxOwogICAgY29udGV4dC5tb3ZlVG8oeDAsIHkwKTsKICAgIGNvbnRleHQubGluZVRvKHgxLCB5MSk7CiAgICBjb250ZXh0LmxpbmVUbyh4MiwgeTIpOwogICAgY29udGV4dC5saW5lVG8oYyAqIHgwIC0gcyAqIHkwLCBzICogeDAgKyBjICogeTApOwogICAgY29udGV4dC5saW5lVG8oYyAqIHgxIC0gcyAqIHkxLCBzICogeDEgKyBjICogeTEpOwogICAgY29udGV4dC5saW5lVG8oYyAqIHgyIC0gcyAqIHkyLCBzICogeDIgKyBjICogeTIpOwogICAgY29udGV4dC5saW5lVG8oYyAqIHgwICsgcyAqIHkwLCBjICogeTAgLSBzICogeDApOwogICAgY29udGV4dC5saW5lVG8oYyAqIHgxICsgcyAqIHkxLCBjICogeTEgLSBzICogeDEpOwogICAgY29udGV4dC5saW5lVG8oYyAqIHgyICsgcyAqIHkyLCBjICogeTIgLSBzICogeDIpOwogICAgY29udGV4dC5jbG9zZVBhdGgoKTsKICB9Cn07Cgp2YXIgc3ltYm9scyA9IFsKICBjaXJjbGUkMiwKICBjcm9zcyQyLAogIGRpYW1vbmQsCiAgc3F1YXJlLAogIHN0YXIsCiAgdHJpYW5nbGUsCiAgd3llCl07CgpmdW5jdGlvbiBzeW1ib2woKSB7CiAgdmFyIHR5cGUgPSBjb25zdGFudCQxMShjaXJjbGUkMiksCiAgICAgIHNpemUgPSBjb25zdGFudCQxMSg2NCksCiAgICAgIGNvbnRleHQgPSBudWxsOwoKICBmdW5jdGlvbiBzeW1ib2woKSB7CiAgICB2YXIgYnVmZmVyOwogICAgaWYgKCFjb250ZXh0KSBjb250ZXh0ID0gYnVmZmVyID0gcGF0aCgpOwogICAgdHlwZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpLmRyYXcoY29udGV4dCwgK3NpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICBpZiAoYnVmZmVyKSByZXR1cm4gY29udGV4dCA9IG51bGwsIGJ1ZmZlciArICIiIHx8IG51bGw7CiAgfQoKICBzeW1ib2wudHlwZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHR5cGUgPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQxMShfKSwgc3ltYm9sKSA6IHR5cGU7CiAgfTsKCiAgc3ltYm9sLnNpemUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChzaXplID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMTEoK18pLCBzeW1ib2wpIDogc2l6ZTsKICB9OwoKICBzeW1ib2wuY29udGV4dCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGNvbnRleHQgPSBfID09IG51bGwgPyBudWxsIDogXywgc3ltYm9sKSA6IGNvbnRleHQ7CiAgfTsKCiAgcmV0dXJuIHN5bWJvbDsKfQoKZnVuY3Rpb24gbm9vcCQzKCkge30KCmZ1bmN0aW9uIHBvaW50JDIodGhhdCwgeCwgeSkgewogIHRoYXQuX2NvbnRleHQuYmV6aWVyQ3VydmVUbygKICAgICgyICogdGhhdC5feDAgKyB0aGF0Ll94MSkgLyAzLAogICAgKDIgKiB0aGF0Ll95MCArIHRoYXQuX3kxKSAvIDMsCiAgICAodGhhdC5feDAgKyAyICogdGhhdC5feDEpIC8gMywKICAgICh0aGF0Ll95MCArIDIgKiB0aGF0Ll95MSkgLyAzLAogICAgKHRoYXQuX3gwICsgNCAqIHRoYXQuX3gxICsgeCkgLyA2LAogICAgKHRoYXQuX3kwICsgNCAqIHRoYXQuX3kxICsgeSkgLyA2CiAgKTsKfQoKZnVuY3Rpb24gQmFzaXMoY29udGV4dCkgewogIHRoaXMuX2NvbnRleHQgPSBjb250ZXh0Owp9CgpCYXNpcy5wcm90b3R5cGUgPSB7CiAgYXJlYVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX2xpbmUgPSAwOwogIH0sCiAgYXJlYUVuZDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9saW5lID0gTmFOOwogIH0sCiAgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX3gwID0gdGhpcy5feDEgPQogICAgdGhpcy5feTAgPSB0aGlzLl95MSA9IE5hTjsKICAgIHRoaXMuX3BvaW50ID0gMDsKICB9LAogIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgc3dpdGNoICh0aGlzLl9wb2ludCkgewogICAgICBjYXNlIDM6IHBvaW50JDIodGhpcywgdGhpcy5feDEsIHRoaXMuX3kxKTsgLy8gcHJvY2VlZAogICAgICBjYXNlIDI6IHRoaXMuX2NvbnRleHQubGluZVRvKHRoaXMuX3gxLCB0aGlzLl95MSk7IGJyZWFrOwogICAgfQogICAgaWYgKHRoaXMuX2xpbmUgfHwgKHRoaXMuX2xpbmUgIT09IDAgJiYgdGhpcy5fcG9pbnQgPT09IDEpKSB0aGlzLl9jb250ZXh0LmNsb3NlUGF0aCgpOwogICAgdGhpcy5fbGluZSA9IDEgLSB0aGlzLl9saW5lOwogIH0sCiAgcG9pbnQ6IGZ1bmN0aW9uKHgsIHkpIHsKICAgIHggPSAreCwgeSA9ICt5OwogICAgc3dpdGNoICh0aGlzLl9wb2ludCkgewogICAgICBjYXNlIDA6IHRoaXMuX3BvaW50ID0gMTsgdGhpcy5fbGluZSA/IHRoaXMuX2NvbnRleHQubGluZVRvKHgsIHkpIDogdGhpcy5fY29udGV4dC5tb3ZlVG8oeCwgeSk7IGJyZWFrOwogICAgICBjYXNlIDE6IHRoaXMuX3BvaW50ID0gMjsgYnJlYWs7CiAgICAgIGNhc2UgMjogdGhpcy5fcG9pbnQgPSAzOyB0aGlzLl9jb250ZXh0LmxpbmVUbygoNSAqIHRoaXMuX3gwICsgdGhpcy5feDEpIC8gNiwgKDUgKiB0aGlzLl95MCArIHRoaXMuX3kxKSAvIDYpOyAvLyBwcm9jZWVkCiAgICAgIGRlZmF1bHQ6IHBvaW50JDIodGhpcywgeCwgeSk7IGJyZWFrOwogICAgfQogICAgdGhpcy5feDAgPSB0aGlzLl94MSwgdGhpcy5feDEgPSB4OwogICAgdGhpcy5feTAgPSB0aGlzLl95MSwgdGhpcy5feTEgPSB5OwogIH0KfTsKCmZ1bmN0aW9uIGJhc2lzJDIoY29udGV4dCkgewogIHJldHVybiBuZXcgQmFzaXMoY29udGV4dCk7Cn0KCmZ1bmN0aW9uIEJhc2lzQ2xvc2VkKGNvbnRleHQpIHsKICB0aGlzLl9jb250ZXh0ID0gY29udGV4dDsKfQoKQmFzaXNDbG9zZWQucHJvdG90eXBlID0gewogIGFyZWFTdGFydDogbm9vcCQzLAogIGFyZWFFbmQ6IG5vb3AkMywKICBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5feDAgPSB0aGlzLl94MSA9IHRoaXMuX3gyID0gdGhpcy5feDMgPSB0aGlzLl94NCA9CiAgICB0aGlzLl95MCA9IHRoaXMuX3kxID0gdGhpcy5feTIgPSB0aGlzLl95MyA9IHRoaXMuX3k0ID0gTmFOOwogICAgdGhpcy5fcG9pbnQgPSAwOwogIH0sCiAgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICBzd2l0Y2ggKHRoaXMuX3BvaW50KSB7CiAgICAgIGNhc2UgMTogewogICAgICAgIHRoaXMuX2NvbnRleHQubW92ZVRvKHRoaXMuX3gyLCB0aGlzLl95Mik7CiAgICAgICAgdGhpcy5fY29udGV4dC5jbG9zZVBhdGgoKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjYXNlIDI6IHsKICAgICAgICB0aGlzLl9jb250ZXh0Lm1vdmVUbygodGhpcy5feDIgKyAyICogdGhpcy5feDMpIC8gMywgKHRoaXMuX3kyICsgMiAqIHRoaXMuX3kzKSAvIDMpOwogICAgICAgIHRoaXMuX2NvbnRleHQubGluZVRvKCh0aGlzLl94MyArIDIgKiB0aGlzLl94MikgLyAzLCAodGhpcy5feTMgKyAyICogdGhpcy5feTIpIC8gMyk7CiAgICAgICAgdGhpcy5fY29udGV4dC5jbG9zZVBhdGgoKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjYXNlIDM6IHsKICAgICAgICB0aGlzLnBvaW50KHRoaXMuX3gyLCB0aGlzLl95Mik7CiAgICAgICAgdGhpcy5wb2ludCh0aGlzLl94MywgdGhpcy5feTMpOwogICAgICAgIHRoaXMucG9pbnQodGhpcy5feDQsIHRoaXMuX3k0KTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogIH0sCiAgcG9pbnQ6IGZ1bmN0aW9uKHgsIHkpIHsKICAgIHggPSAreCwgeSA9ICt5OwogICAgc3dpdGNoICh0aGlzLl9wb2ludCkgewogICAgICBjYXNlIDA6IHRoaXMuX3BvaW50ID0gMTsgdGhpcy5feDIgPSB4LCB0aGlzLl95MiA9IHk7IGJyZWFrOwogICAgICBjYXNlIDE6IHRoaXMuX3BvaW50ID0gMjsgdGhpcy5feDMgPSB4LCB0aGlzLl95MyA9IHk7IGJyZWFrOwogICAgICBjYXNlIDI6IHRoaXMuX3BvaW50ID0gMzsgdGhpcy5feDQgPSB4LCB0aGlzLl95NCA9IHk7IHRoaXMuX2NvbnRleHQubW92ZVRvKCh0aGlzLl94MCArIDQgKiB0aGlzLl94MSArIHgpIC8gNiwgKHRoaXMuX3kwICsgNCAqIHRoaXMuX3kxICsgeSkgLyA2KTsgYnJlYWs7CiAgICAgIGRlZmF1bHQ6IHBvaW50JDIodGhpcywgeCwgeSk7IGJyZWFrOwogICAgfQogICAgdGhpcy5feDAgPSB0aGlzLl94MSwgdGhpcy5feDEgPSB4OwogICAgdGhpcy5feTAgPSB0aGlzLl95MSwgdGhpcy5feTEgPSB5OwogIH0KfTsKCmZ1bmN0aW9uIGJhc2lzQ2xvc2VkJDEoY29udGV4dCkgewogIHJldHVybiBuZXcgQmFzaXNDbG9zZWQoY29udGV4dCk7Cn0KCmZ1bmN0aW9uIEJhc2lzT3Blbihjb250ZXh0KSB7CiAgdGhpcy5fY29udGV4dCA9IGNvbnRleHQ7Cn0KCkJhc2lzT3Blbi5wcm90b3R5cGUgPSB7CiAgYXJlYVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX2xpbmUgPSAwOwogIH0sCiAgYXJlYUVuZDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9saW5lID0gTmFOOwogIH0sCiAgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX3gwID0gdGhpcy5feDEgPQogICAgdGhpcy5feTAgPSB0aGlzLl95MSA9IE5hTjsKICAgIHRoaXMuX3BvaW50ID0gMDsKICB9LAogIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMuX2xpbmUgfHwgKHRoaXMuX2xpbmUgIT09IDAgJiYgdGhpcy5fcG9pbnQgPT09IDMpKSB0aGlzLl9jb250ZXh0LmNsb3NlUGF0aCgpOwogICAgdGhpcy5fbGluZSA9IDEgLSB0aGlzLl9saW5lOwogIH0sCiAgcG9pbnQ6IGZ1bmN0aW9uKHgsIHkpIHsKICAgIHggPSAreCwgeSA9ICt5OwogICAgc3dpdGNoICh0aGlzLl9wb2ludCkgewogICAgICBjYXNlIDA6IHRoaXMuX3BvaW50ID0gMTsgYnJlYWs7CiAgICAgIGNhc2UgMTogdGhpcy5fcG9pbnQgPSAyOyBicmVhazsKICAgICAgY2FzZSAyOiB0aGlzLl9wb2ludCA9IDM7IHZhciB4MCA9ICh0aGlzLl94MCArIDQgKiB0aGlzLl94MSArIHgpIC8gNiwgeTAgPSAodGhpcy5feTAgKyA0ICogdGhpcy5feTEgKyB5KSAvIDY7IHRoaXMuX2xpbmUgPyB0aGlzLl9jb250ZXh0LmxpbmVUbyh4MCwgeTApIDogdGhpcy5fY29udGV4dC5tb3ZlVG8oeDAsIHkwKTsgYnJlYWs7CiAgICAgIGNhc2UgMzogdGhpcy5fcG9pbnQgPSA0OyAvLyBwcm9jZWVkCiAgICAgIGRlZmF1bHQ6IHBvaW50JDIodGhpcywgeCwgeSk7IGJyZWFrOwogICAgfQogICAgdGhpcy5feDAgPSB0aGlzLl94MSwgdGhpcy5feDEgPSB4OwogICAgdGhpcy5feTAgPSB0aGlzLl95MSwgdGhpcy5feTEgPSB5OwogIH0KfTsKCmZ1bmN0aW9uIGJhc2lzT3Blbihjb250ZXh0KSB7CiAgcmV0dXJuIG5ldyBCYXNpc09wZW4oY29udGV4dCk7Cn0KCmZ1bmN0aW9uIEJ1bmRsZShjb250ZXh0LCBiZXRhKSB7CiAgdGhpcy5fYmFzaXMgPSBuZXcgQmFzaXMoY29udGV4dCk7CiAgdGhpcy5fYmV0YSA9IGJldGE7Cn0KCkJ1bmRsZS5wcm90b3R5cGUgPSB7CiAgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX3ggPSBbXTsKICAgIHRoaXMuX3kgPSBbXTsKICAgIHRoaXMuX2Jhc2lzLmxpbmVTdGFydCgpOwogIH0sCiAgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICB2YXIgeCA9IHRoaXMuX3gsCiAgICAgICAgeSA9IHRoaXMuX3ksCiAgICAgICAgaiA9IHgubGVuZ3RoIC0gMTsKCiAgICBpZiAoaiA+IDApIHsKICAgICAgdmFyIHgwID0geFswXSwKICAgICAgICAgIHkwID0geVswXSwKICAgICAgICAgIGR4ID0geFtqXSAtIHgwLAogICAgICAgICAgZHkgPSB5W2pdIC0geTAsCiAgICAgICAgICBpID0gLTEsCiAgICAgICAgICB0OwoKICAgICAgd2hpbGUgKCsraSA8PSBqKSB7CiAgICAgICAgdCA9IGkgLyBqOwogICAgICAgIHRoaXMuX2Jhc2lzLnBvaW50KAogICAgICAgICAgdGhpcy5fYmV0YSAqIHhbaV0gKyAoMSAtIHRoaXMuX2JldGEpICogKHgwICsgdCAqIGR4KSwKICAgICAgICAgIHRoaXMuX2JldGEgKiB5W2ldICsgKDEgLSB0aGlzLl9iZXRhKSAqICh5MCArIHQgKiBkeSkKICAgICAgICApOwogICAgICB9CiAgICB9CgogICAgdGhpcy5feCA9IHRoaXMuX3kgPSBudWxsOwogICAgdGhpcy5fYmFzaXMubGluZUVuZCgpOwogIH0sCiAgcG9pbnQ6IGZ1bmN0aW9uKHgsIHkpIHsKICAgIHRoaXMuX3gucHVzaCgreCk7CiAgICB0aGlzLl95LnB1c2goK3kpOwogIH0KfTsKCnZhciBidW5kbGUgPSAoZnVuY3Rpb24gY3VzdG9tKGJldGEpIHsKCiAgZnVuY3Rpb24gYnVuZGxlKGNvbnRleHQpIHsKICAgIHJldHVybiBiZXRhID09PSAxID8gbmV3IEJhc2lzKGNvbnRleHQpIDogbmV3IEJ1bmRsZShjb250ZXh0LCBiZXRhKTsKICB9CgogIGJ1bmRsZS5iZXRhID0gZnVuY3Rpb24oYmV0YSkgewogICAgcmV0dXJuIGN1c3RvbSgrYmV0YSk7CiAgfTsKCiAgcmV0dXJuIGJ1bmRsZTsKfSkoMC44NSk7CgpmdW5jdGlvbiBwb2ludCQzKHRoYXQsIHgsIHkpIHsKICB0aGF0Ll9jb250ZXh0LmJlemllckN1cnZlVG8oCiAgICB0aGF0Ll94MSArIHRoYXQuX2sgKiAodGhhdC5feDIgLSB0aGF0Ll94MCksCiAgICB0aGF0Ll95MSArIHRoYXQuX2sgKiAodGhhdC5feTIgLSB0aGF0Ll95MCksCiAgICB0aGF0Ll94MiArIHRoYXQuX2sgKiAodGhhdC5feDEgLSB4KSwKICAgIHRoYXQuX3kyICsgdGhhdC5fayAqICh0aGF0Ll95MSAtIHkpLAogICAgdGhhdC5feDIsCiAgICB0aGF0Ll95MgogICk7Cn0KCmZ1bmN0aW9uIENhcmRpbmFsKGNvbnRleHQsIHRlbnNpb24pIHsKICB0aGlzLl9jb250ZXh0ID0gY29udGV4dDsKICB0aGlzLl9rID0gKDEgLSB0ZW5zaW9uKSAvIDY7Cn0KCkNhcmRpbmFsLnByb3RvdHlwZSA9IHsKICBhcmVhU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fbGluZSA9IDA7CiAgfSwKICBhcmVhRW5kOiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX2xpbmUgPSBOYU47CiAgfSwKICBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5feDAgPSB0aGlzLl94MSA9IHRoaXMuX3gyID0KICAgIHRoaXMuX3kwID0gdGhpcy5feTEgPSB0aGlzLl95MiA9IE5hTjsKICAgIHRoaXMuX3BvaW50ID0gMDsKICB9LAogIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgc3dpdGNoICh0aGlzLl9wb2ludCkgewogICAgICBjYXNlIDI6IHRoaXMuX2NvbnRleHQubGluZVRvKHRoaXMuX3gyLCB0aGlzLl95Mik7IGJyZWFrOwogICAgICBjYXNlIDM6IHBvaW50JDModGhpcywgdGhpcy5feDEsIHRoaXMuX3kxKTsgYnJlYWs7CiAgICB9CiAgICBpZiAodGhpcy5fbGluZSB8fCAodGhpcy5fbGluZSAhPT0gMCAmJiB0aGlzLl9wb2ludCA9PT0gMSkpIHRoaXMuX2NvbnRleHQuY2xvc2VQYXRoKCk7CiAgICB0aGlzLl9saW5lID0gMSAtIHRoaXMuX2xpbmU7CiAgfSwKICBwb2ludDogZnVuY3Rpb24oeCwgeSkgewogICAgeCA9ICt4LCB5ID0gK3k7CiAgICBzd2l0Y2ggKHRoaXMuX3BvaW50KSB7CiAgICAgIGNhc2UgMDogdGhpcy5fcG9pbnQgPSAxOyB0aGlzLl9saW5lID8gdGhpcy5fY29udGV4dC5saW5lVG8oeCwgeSkgOiB0aGlzLl9jb250ZXh0Lm1vdmVUbyh4LCB5KTsgYnJlYWs7CiAgICAgIGNhc2UgMTogdGhpcy5fcG9pbnQgPSAyOyB0aGlzLl94MSA9IHgsIHRoaXMuX3kxID0geTsgYnJlYWs7CiAgICAgIGNhc2UgMjogdGhpcy5fcG9pbnQgPSAzOyAvLyBwcm9jZWVkCiAgICAgIGRlZmF1bHQ6IHBvaW50JDModGhpcywgeCwgeSk7IGJyZWFrOwogICAgfQogICAgdGhpcy5feDAgPSB0aGlzLl94MSwgdGhpcy5feDEgPSB0aGlzLl94MiwgdGhpcy5feDIgPSB4OwogICAgdGhpcy5feTAgPSB0aGlzLl95MSwgdGhpcy5feTEgPSB0aGlzLl95MiwgdGhpcy5feTIgPSB5OwogIH0KfTsKCnZhciBjYXJkaW5hbCA9IChmdW5jdGlvbiBjdXN0b20odGVuc2lvbikgewoKICBmdW5jdGlvbiBjYXJkaW5hbChjb250ZXh0KSB7CiAgICByZXR1cm4gbmV3IENhcmRpbmFsKGNvbnRleHQsIHRlbnNpb24pOwogIH0KCiAgY2FyZGluYWwudGVuc2lvbiA9IGZ1bmN0aW9uKHRlbnNpb24pIHsKICAgIHJldHVybiBjdXN0b20oK3RlbnNpb24pOwogIH07CgogIHJldHVybiBjYXJkaW5hbDsKfSkoMCk7CgpmdW5jdGlvbiBDYXJkaW5hbENsb3NlZChjb250ZXh0LCB0ZW5zaW9uKSB7CiAgdGhpcy5fY29udGV4dCA9IGNvbnRleHQ7CiAgdGhpcy5fayA9ICgxIC0gdGVuc2lvbikgLyA2Owp9CgpDYXJkaW5hbENsb3NlZC5wcm90b3R5cGUgPSB7CiAgYXJlYVN0YXJ0OiBub29wJDMsCiAgYXJlYUVuZDogbm9vcCQzLAogIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl94MCA9IHRoaXMuX3gxID0gdGhpcy5feDIgPSB0aGlzLl94MyA9IHRoaXMuX3g0ID0gdGhpcy5feDUgPQogICAgdGhpcy5feTAgPSB0aGlzLl95MSA9IHRoaXMuX3kyID0gdGhpcy5feTMgPSB0aGlzLl95NCA9IHRoaXMuX3k1ID0gTmFOOwogICAgdGhpcy5fcG9pbnQgPSAwOwogIH0sCiAgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICBzd2l0Y2ggKHRoaXMuX3BvaW50KSB7CiAgICAgIGNhc2UgMTogewogICAgICAgIHRoaXMuX2NvbnRleHQubW92ZVRvKHRoaXMuX3gzLCB0aGlzLl95Myk7CiAgICAgICAgdGhpcy5fY29udGV4dC5jbG9zZVBhdGgoKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjYXNlIDI6IHsKICAgICAgICB0aGlzLl9jb250ZXh0LmxpbmVUbyh0aGlzLl94MywgdGhpcy5feTMpOwogICAgICAgIHRoaXMuX2NvbnRleHQuY2xvc2VQYXRoKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY2FzZSAzOiB7CiAgICAgICAgdGhpcy5wb2ludCh0aGlzLl94MywgdGhpcy5feTMpOwogICAgICAgIHRoaXMucG9pbnQodGhpcy5feDQsIHRoaXMuX3k0KTsKICAgICAgICB0aGlzLnBvaW50KHRoaXMuX3g1LCB0aGlzLl95NSk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9LAogIHBvaW50OiBmdW5jdGlvbih4LCB5KSB7CiAgICB4ID0gK3gsIHkgPSAreTsKICAgIHN3aXRjaCAodGhpcy5fcG9pbnQpIHsKICAgICAgY2FzZSAwOiB0aGlzLl9wb2ludCA9IDE7IHRoaXMuX3gzID0geCwgdGhpcy5feTMgPSB5OyBicmVhazsKICAgICAgY2FzZSAxOiB0aGlzLl9wb2ludCA9IDI7IHRoaXMuX2NvbnRleHQubW92ZVRvKHRoaXMuX3g0ID0geCwgdGhpcy5feTQgPSB5KTsgYnJlYWs7CiAgICAgIGNhc2UgMjogdGhpcy5fcG9pbnQgPSAzOyB0aGlzLl94NSA9IHgsIHRoaXMuX3k1ID0geTsgYnJlYWs7CiAgICAgIGRlZmF1bHQ6IHBvaW50JDModGhpcywgeCwgeSk7IGJyZWFrOwogICAgfQogICAgdGhpcy5feDAgPSB0aGlzLl94MSwgdGhpcy5feDEgPSB0aGlzLl94MiwgdGhpcy5feDIgPSB4OwogICAgdGhpcy5feTAgPSB0aGlzLl95MSwgdGhpcy5feTEgPSB0aGlzLl95MiwgdGhpcy5feTIgPSB5OwogIH0KfTsKCnZhciBjYXJkaW5hbENsb3NlZCA9IChmdW5jdGlvbiBjdXN0b20odGVuc2lvbikgewoKICBmdW5jdGlvbiBjYXJkaW5hbCQkMShjb250ZXh0KSB7CiAgICByZXR1cm4gbmV3IENhcmRpbmFsQ2xvc2VkKGNvbnRleHQsIHRlbnNpb24pOwogIH0KCiAgY2FyZGluYWwkJDEudGVuc2lvbiA9IGZ1bmN0aW9uKHRlbnNpb24pIHsKICAgIHJldHVybiBjdXN0b20oK3RlbnNpb24pOwogIH07CgogIHJldHVybiBjYXJkaW5hbCQkMTsKfSkoMCk7CgpmdW5jdGlvbiBDYXJkaW5hbE9wZW4oY29udGV4dCwgdGVuc2lvbikgewogIHRoaXMuX2NvbnRleHQgPSBjb250ZXh0OwogIHRoaXMuX2sgPSAoMSAtIHRlbnNpb24pIC8gNjsKfQoKQ2FyZGluYWxPcGVuLnByb3RvdHlwZSA9IHsKICBhcmVhU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fbGluZSA9IDA7CiAgfSwKICBhcmVhRW5kOiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX2xpbmUgPSBOYU47CiAgfSwKICBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5feDAgPSB0aGlzLl94MSA9IHRoaXMuX3gyID0KICAgIHRoaXMuX3kwID0gdGhpcy5feTEgPSB0aGlzLl95MiA9IE5hTjsKICAgIHRoaXMuX3BvaW50ID0gMDsKICB9LAogIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMuX2xpbmUgfHwgKHRoaXMuX2xpbmUgIT09IDAgJiYgdGhpcy5fcG9pbnQgPT09IDMpKSB0aGlzLl9jb250ZXh0LmNsb3NlUGF0aCgpOwogICAgdGhpcy5fbGluZSA9IDEgLSB0aGlzLl9saW5lOwogIH0sCiAgcG9pbnQ6IGZ1bmN0aW9uKHgsIHkpIHsKICAgIHggPSAreCwgeSA9ICt5OwogICAgc3dpdGNoICh0aGlzLl9wb2ludCkgewogICAgICBjYXNlIDA6IHRoaXMuX3BvaW50ID0gMTsgYnJlYWs7CiAgICAgIGNhc2UgMTogdGhpcy5fcG9pbnQgPSAyOyBicmVhazsKICAgICAgY2FzZSAyOiB0aGlzLl9wb2ludCA9IDM7IHRoaXMuX2xpbmUgPyB0aGlzLl9jb250ZXh0LmxpbmVUbyh0aGlzLl94MiwgdGhpcy5feTIpIDogdGhpcy5fY29udGV4dC5tb3ZlVG8odGhpcy5feDIsIHRoaXMuX3kyKTsgYnJlYWs7CiAgICAgIGNhc2UgMzogdGhpcy5fcG9pbnQgPSA0OyAvLyBwcm9jZWVkCiAgICAgIGRlZmF1bHQ6IHBvaW50JDModGhpcywgeCwgeSk7IGJyZWFrOwogICAgfQogICAgdGhpcy5feDAgPSB0aGlzLl94MSwgdGhpcy5feDEgPSB0aGlzLl94MiwgdGhpcy5feDIgPSB4OwogICAgdGhpcy5feTAgPSB0aGlzLl95MSwgdGhpcy5feTEgPSB0aGlzLl95MiwgdGhpcy5feTIgPSB5OwogIH0KfTsKCnZhciBjYXJkaW5hbE9wZW4gPSAoZnVuY3Rpb24gY3VzdG9tKHRlbnNpb24pIHsKCiAgZnVuY3Rpb24gY2FyZGluYWwkJDEoY29udGV4dCkgewogICAgcmV0dXJuIG5ldyBDYXJkaW5hbE9wZW4oY29udGV4dCwgdGVuc2lvbik7CiAgfQoKICBjYXJkaW5hbCQkMS50ZW5zaW9uID0gZnVuY3Rpb24odGVuc2lvbikgewogICAgcmV0dXJuIGN1c3RvbSgrdGVuc2lvbik7CiAgfTsKCiAgcmV0dXJuIGNhcmRpbmFsJCQxOwp9KSgwKTsKCmZ1bmN0aW9uIHBvaW50JDQodGhhdCwgeCwgeSkgewogIHZhciB4MSA9IHRoYXQuX3gxLAogICAgICB5MSA9IHRoYXQuX3kxLAogICAgICB4MiA9IHRoYXQuX3gyLAogICAgICB5MiA9IHRoYXQuX3kyOwoKICBpZiAodGhhdC5fbDAxX2EgPiBlcHNpbG9uJDMpIHsKICAgIHZhciBhID0gMiAqIHRoYXQuX2wwMV8yYSArIDMgKiB0aGF0Ll9sMDFfYSAqIHRoYXQuX2wxMl9hICsgdGhhdC5fbDEyXzJhLAogICAgICAgIG4gPSAzICogdGhhdC5fbDAxX2EgKiAodGhhdC5fbDAxX2EgKyB0aGF0Ll9sMTJfYSk7CiAgICB4MSA9ICh4MSAqIGEgLSB0aGF0Ll94MCAqIHRoYXQuX2wxMl8yYSArIHRoYXQuX3gyICogdGhhdC5fbDAxXzJhKSAvIG47CiAgICB5MSA9ICh5MSAqIGEgLSB0aGF0Ll95MCAqIHRoYXQuX2wxMl8yYSArIHRoYXQuX3kyICogdGhhdC5fbDAxXzJhKSAvIG47CiAgfQoKICBpZiAodGhhdC5fbDIzX2EgPiBlcHNpbG9uJDMpIHsKICAgIHZhciBiID0gMiAqIHRoYXQuX2wyM18yYSArIDMgKiB0aGF0Ll9sMjNfYSAqIHRoYXQuX2wxMl9hICsgdGhhdC5fbDEyXzJhLAogICAgICAgIG0gPSAzICogdGhhdC5fbDIzX2EgKiAodGhhdC5fbDIzX2EgKyB0aGF0Ll9sMTJfYSk7CiAgICB4MiA9ICh4MiAqIGIgKyB0aGF0Ll94MSAqIHRoYXQuX2wyM18yYSAtIHggKiB0aGF0Ll9sMTJfMmEpIC8gbTsKICAgIHkyID0gKHkyICogYiArIHRoYXQuX3kxICogdGhhdC5fbDIzXzJhIC0geSAqIHRoYXQuX2wxMl8yYSkgLyBtOwogIH0KCiAgdGhhdC5fY29udGV4dC5iZXppZXJDdXJ2ZVRvKHgxLCB5MSwgeDIsIHkyLCB0aGF0Ll94MiwgdGhhdC5feTIpOwp9CgpmdW5jdGlvbiBDYXRtdWxsUm9tKGNvbnRleHQsIGFscGhhKSB7CiAgdGhpcy5fY29udGV4dCA9IGNvbnRleHQ7CiAgdGhpcy5fYWxwaGEgPSBhbHBoYTsKfQoKQ2F0bXVsbFJvbS5wcm90b3R5cGUgPSB7CiAgYXJlYVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX2xpbmUgPSAwOwogIH0sCiAgYXJlYUVuZDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9saW5lID0gTmFOOwogIH0sCiAgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX3gwID0gdGhpcy5feDEgPSB0aGlzLl94MiA9CiAgICB0aGlzLl95MCA9IHRoaXMuX3kxID0gdGhpcy5feTIgPSBOYU47CiAgICB0aGlzLl9sMDFfYSA9IHRoaXMuX2wxMl9hID0gdGhpcy5fbDIzX2EgPQogICAgdGhpcy5fbDAxXzJhID0gdGhpcy5fbDEyXzJhID0gdGhpcy5fbDIzXzJhID0KICAgIHRoaXMuX3BvaW50ID0gMDsKICB9LAogIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgc3dpdGNoICh0aGlzLl9wb2ludCkgewogICAgICBjYXNlIDI6IHRoaXMuX2NvbnRleHQubGluZVRvKHRoaXMuX3gyLCB0aGlzLl95Mik7IGJyZWFrOwogICAgICBjYXNlIDM6IHRoaXMucG9pbnQodGhpcy5feDIsIHRoaXMuX3kyKTsgYnJlYWs7CiAgICB9CiAgICBpZiAodGhpcy5fbGluZSB8fCAodGhpcy5fbGluZSAhPT0gMCAmJiB0aGlzLl9wb2ludCA9PT0gMSkpIHRoaXMuX2NvbnRleHQuY2xvc2VQYXRoKCk7CiAgICB0aGlzLl9saW5lID0gMSAtIHRoaXMuX2xpbmU7CiAgfSwKICBwb2ludDogZnVuY3Rpb24oeCwgeSkgewogICAgeCA9ICt4LCB5ID0gK3k7CgogICAgaWYgKHRoaXMuX3BvaW50KSB7CiAgICAgIHZhciB4MjMgPSB0aGlzLl94MiAtIHgsCiAgICAgICAgICB5MjMgPSB0aGlzLl95MiAtIHk7CiAgICAgIHRoaXMuX2wyM19hID0gTWF0aC5zcXJ0KHRoaXMuX2wyM18yYSA9IE1hdGgucG93KHgyMyAqIHgyMyArIHkyMyAqIHkyMywgdGhpcy5fYWxwaGEpKTsKICAgIH0KCiAgICBzd2l0Y2ggKHRoaXMuX3BvaW50KSB7CiAgICAgIGNhc2UgMDogdGhpcy5fcG9pbnQgPSAxOyB0aGlzLl9saW5lID8gdGhpcy5fY29udGV4dC5saW5lVG8oeCwgeSkgOiB0aGlzLl9jb250ZXh0Lm1vdmVUbyh4LCB5KTsgYnJlYWs7CiAgICAgIGNhc2UgMTogdGhpcy5fcG9pbnQgPSAyOyBicmVhazsKICAgICAgY2FzZSAyOiB0aGlzLl9wb2ludCA9IDM7IC8vIHByb2NlZWQKICAgICAgZGVmYXVsdDogcG9pbnQkNCh0aGlzLCB4LCB5KTsgYnJlYWs7CiAgICB9CgogICAgdGhpcy5fbDAxX2EgPSB0aGlzLl9sMTJfYSwgdGhpcy5fbDEyX2EgPSB0aGlzLl9sMjNfYTsKICAgIHRoaXMuX2wwMV8yYSA9IHRoaXMuX2wxMl8yYSwgdGhpcy5fbDEyXzJhID0gdGhpcy5fbDIzXzJhOwogICAgdGhpcy5feDAgPSB0aGlzLl94MSwgdGhpcy5feDEgPSB0aGlzLl94MiwgdGhpcy5feDIgPSB4OwogICAgdGhpcy5feTAgPSB0aGlzLl95MSwgdGhpcy5feTEgPSB0aGlzLl95MiwgdGhpcy5feTIgPSB5OwogIH0KfTsKCnZhciBjYXRtdWxsUm9tID0gKGZ1bmN0aW9uIGN1c3RvbShhbHBoYSkgewoKICBmdW5jdGlvbiBjYXRtdWxsUm9tKGNvbnRleHQpIHsKICAgIHJldHVybiBhbHBoYSA/IG5ldyBDYXRtdWxsUm9tKGNvbnRleHQsIGFscGhhKSA6IG5ldyBDYXJkaW5hbChjb250ZXh0LCAwKTsKICB9CgogIGNhdG11bGxSb20uYWxwaGEgPSBmdW5jdGlvbihhbHBoYSkgewogICAgcmV0dXJuIGN1c3RvbSgrYWxwaGEpOwogIH07CgogIHJldHVybiBjYXRtdWxsUm9tOwp9KSgwLjUpOwoKZnVuY3Rpb24gQ2F0bXVsbFJvbUNsb3NlZChjb250ZXh0LCBhbHBoYSkgewogIHRoaXMuX2NvbnRleHQgPSBjb250ZXh0OwogIHRoaXMuX2FscGhhID0gYWxwaGE7Cn0KCkNhdG11bGxSb21DbG9zZWQucHJvdG90eXBlID0gewogIGFyZWFTdGFydDogbm9vcCQzLAogIGFyZWFFbmQ6IG5vb3AkMywKICBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5feDAgPSB0aGlzLl94MSA9IHRoaXMuX3gyID0gdGhpcy5feDMgPSB0aGlzLl94NCA9IHRoaXMuX3g1ID0KICAgIHRoaXMuX3kwID0gdGhpcy5feTEgPSB0aGlzLl95MiA9IHRoaXMuX3kzID0gdGhpcy5feTQgPSB0aGlzLl95NSA9IE5hTjsKICAgIHRoaXMuX2wwMV9hID0gdGhpcy5fbDEyX2EgPSB0aGlzLl9sMjNfYSA9CiAgICB0aGlzLl9sMDFfMmEgPSB0aGlzLl9sMTJfMmEgPSB0aGlzLl9sMjNfMmEgPQogICAgdGhpcy5fcG9pbnQgPSAwOwogIH0sCiAgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICBzd2l0Y2ggKHRoaXMuX3BvaW50KSB7CiAgICAgIGNhc2UgMTogewogICAgICAgIHRoaXMuX2NvbnRleHQubW92ZVRvKHRoaXMuX3gzLCB0aGlzLl95Myk7CiAgICAgICAgdGhpcy5fY29udGV4dC5jbG9zZVBhdGgoKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjYXNlIDI6IHsKICAgICAgICB0aGlzLl9jb250ZXh0LmxpbmVUbyh0aGlzLl94MywgdGhpcy5feTMpOwogICAgICAgIHRoaXMuX2NvbnRleHQuY2xvc2VQYXRoKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY2FzZSAzOiB7CiAgICAgICAgdGhpcy5wb2ludCh0aGlzLl94MywgdGhpcy5feTMpOwogICAgICAgIHRoaXMucG9pbnQodGhpcy5feDQsIHRoaXMuX3k0KTsKICAgICAgICB0aGlzLnBvaW50KHRoaXMuX3g1LCB0aGlzLl95NSk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9LAogIHBvaW50OiBmdW5jdGlvbih4LCB5KSB7CiAgICB4ID0gK3gsIHkgPSAreTsKCiAgICBpZiAodGhpcy5fcG9pbnQpIHsKICAgICAgdmFyIHgyMyA9IHRoaXMuX3gyIC0geCwKICAgICAgICAgIHkyMyA9IHRoaXMuX3kyIC0geTsKICAgICAgdGhpcy5fbDIzX2EgPSBNYXRoLnNxcnQodGhpcy5fbDIzXzJhID0gTWF0aC5wb3coeDIzICogeDIzICsgeTIzICogeTIzLCB0aGlzLl9hbHBoYSkpOwogICAgfQoKICAgIHN3aXRjaCAodGhpcy5fcG9pbnQpIHsKICAgICAgY2FzZSAwOiB0aGlzLl9wb2ludCA9IDE7IHRoaXMuX3gzID0geCwgdGhpcy5feTMgPSB5OyBicmVhazsKICAgICAgY2FzZSAxOiB0aGlzLl9wb2ludCA9IDI7IHRoaXMuX2NvbnRleHQubW92ZVRvKHRoaXMuX3g0ID0geCwgdGhpcy5feTQgPSB5KTsgYnJlYWs7CiAgICAgIGNhc2UgMjogdGhpcy5fcG9pbnQgPSAzOyB0aGlzLl94NSA9IHgsIHRoaXMuX3k1ID0geTsgYnJlYWs7CiAgICAgIGRlZmF1bHQ6IHBvaW50JDQodGhpcywgeCwgeSk7IGJyZWFrOwogICAgfQoKICAgIHRoaXMuX2wwMV9hID0gdGhpcy5fbDEyX2EsIHRoaXMuX2wxMl9hID0gdGhpcy5fbDIzX2E7CiAgICB0aGlzLl9sMDFfMmEgPSB0aGlzLl9sMTJfMmEsIHRoaXMuX2wxMl8yYSA9IHRoaXMuX2wyM18yYTsKICAgIHRoaXMuX3gwID0gdGhpcy5feDEsIHRoaXMuX3gxID0gdGhpcy5feDIsIHRoaXMuX3gyID0geDsKICAgIHRoaXMuX3kwID0gdGhpcy5feTEsIHRoaXMuX3kxID0gdGhpcy5feTIsIHRoaXMuX3kyID0geTsKICB9Cn07Cgp2YXIgY2F0bXVsbFJvbUNsb3NlZCA9IChmdW5jdGlvbiBjdXN0b20oYWxwaGEpIHsKCiAgZnVuY3Rpb24gY2F0bXVsbFJvbSQkMShjb250ZXh0KSB7CiAgICByZXR1cm4gYWxwaGEgPyBuZXcgQ2F0bXVsbFJvbUNsb3NlZChjb250ZXh0LCBhbHBoYSkgOiBuZXcgQ2FyZGluYWxDbG9zZWQoY29udGV4dCwgMCk7CiAgfQoKICBjYXRtdWxsUm9tJCQxLmFscGhhID0gZnVuY3Rpb24oYWxwaGEpIHsKICAgIHJldHVybiBjdXN0b20oK2FscGhhKTsKICB9OwoKICByZXR1cm4gY2F0bXVsbFJvbSQkMTsKfSkoMC41KTsKCmZ1bmN0aW9uIENhdG11bGxSb21PcGVuKGNvbnRleHQsIGFscGhhKSB7CiAgdGhpcy5fY29udGV4dCA9IGNvbnRleHQ7CiAgdGhpcy5fYWxwaGEgPSBhbHBoYTsKfQoKQ2F0bXVsbFJvbU9wZW4ucHJvdG90eXBlID0gewogIGFyZWFTdGFydDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9saW5lID0gMDsKICB9LAogIGFyZWFFbmQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fbGluZSA9IE5hTjsKICB9LAogIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl94MCA9IHRoaXMuX3gxID0gdGhpcy5feDIgPQogICAgdGhpcy5feTAgPSB0aGlzLl95MSA9IHRoaXMuX3kyID0gTmFOOwogICAgdGhpcy5fbDAxX2EgPSB0aGlzLl9sMTJfYSA9IHRoaXMuX2wyM19hID0KICAgIHRoaXMuX2wwMV8yYSA9IHRoaXMuX2wxMl8yYSA9IHRoaXMuX2wyM18yYSA9CiAgICB0aGlzLl9wb2ludCA9IDA7CiAgfSwKICBsaW5lRW5kOiBmdW5jdGlvbigpIHsKICAgIGlmICh0aGlzLl9saW5lIHx8ICh0aGlzLl9saW5lICE9PSAwICYmIHRoaXMuX3BvaW50ID09PSAzKSkgdGhpcy5fY29udGV4dC5jbG9zZVBhdGgoKTsKICAgIHRoaXMuX2xpbmUgPSAxIC0gdGhpcy5fbGluZTsKICB9LAogIHBvaW50OiBmdW5jdGlvbih4LCB5KSB7CiAgICB4ID0gK3gsIHkgPSAreTsKCiAgICBpZiAodGhpcy5fcG9pbnQpIHsKICAgICAgdmFyIHgyMyA9IHRoaXMuX3gyIC0geCwKICAgICAgICAgIHkyMyA9IHRoaXMuX3kyIC0geTsKICAgICAgdGhpcy5fbDIzX2EgPSBNYXRoLnNxcnQodGhpcy5fbDIzXzJhID0gTWF0aC5wb3coeDIzICogeDIzICsgeTIzICogeTIzLCB0aGlzLl9hbHBoYSkpOwogICAgfQoKICAgIHN3aXRjaCAodGhpcy5fcG9pbnQpIHsKICAgICAgY2FzZSAwOiB0aGlzLl9wb2ludCA9IDE7IGJyZWFrOwogICAgICBjYXNlIDE6IHRoaXMuX3BvaW50ID0gMjsgYnJlYWs7CiAgICAgIGNhc2UgMjogdGhpcy5fcG9pbnQgPSAzOyB0aGlzLl9saW5lID8gdGhpcy5fY29udGV4dC5saW5lVG8odGhpcy5feDIsIHRoaXMuX3kyKSA6IHRoaXMuX2NvbnRleHQubW92ZVRvKHRoaXMuX3gyLCB0aGlzLl95Mik7IGJyZWFrOwogICAgICBjYXNlIDM6IHRoaXMuX3BvaW50ID0gNDsgLy8gcHJvY2VlZAogICAgICBkZWZhdWx0OiBwb2ludCQ0KHRoaXMsIHgsIHkpOyBicmVhazsKICAgIH0KCiAgICB0aGlzLl9sMDFfYSA9IHRoaXMuX2wxMl9hLCB0aGlzLl9sMTJfYSA9IHRoaXMuX2wyM19hOwogICAgdGhpcy5fbDAxXzJhID0gdGhpcy5fbDEyXzJhLCB0aGlzLl9sMTJfMmEgPSB0aGlzLl9sMjNfMmE7CiAgICB0aGlzLl94MCA9IHRoaXMuX3gxLCB0aGlzLl94MSA9IHRoaXMuX3gyLCB0aGlzLl94MiA9IHg7CiAgICB0aGlzLl95MCA9IHRoaXMuX3kxLCB0aGlzLl95MSA9IHRoaXMuX3kyLCB0aGlzLl95MiA9IHk7CiAgfQp9OwoKdmFyIGNhdG11bGxSb21PcGVuID0gKGZ1bmN0aW9uIGN1c3RvbShhbHBoYSkgewoKICBmdW5jdGlvbiBjYXRtdWxsUm9tJCQxKGNvbnRleHQpIHsKICAgIHJldHVybiBhbHBoYSA/IG5ldyBDYXRtdWxsUm9tT3Blbihjb250ZXh0LCBhbHBoYSkgOiBuZXcgQ2FyZGluYWxPcGVuKGNvbnRleHQsIDApOwogIH0KCiAgY2F0bXVsbFJvbSQkMS5hbHBoYSA9IGZ1bmN0aW9uKGFscGhhKSB7CiAgICByZXR1cm4gY3VzdG9tKCthbHBoYSk7CiAgfTsKCiAgcmV0dXJuIGNhdG11bGxSb20kJDE7Cn0pKDAuNSk7CgpmdW5jdGlvbiBMaW5lYXJDbG9zZWQoY29udGV4dCkgewogIHRoaXMuX2NvbnRleHQgPSBjb250ZXh0Owp9CgpMaW5lYXJDbG9zZWQucHJvdG90eXBlID0gewogIGFyZWFTdGFydDogbm9vcCQzLAogIGFyZWFFbmQ6IG5vb3AkMywKICBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fcG9pbnQgPSAwOwogIH0sCiAgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICBpZiAodGhpcy5fcG9pbnQpIHRoaXMuX2NvbnRleHQuY2xvc2VQYXRoKCk7CiAgfSwKICBwb2ludDogZnVuY3Rpb24oeCwgeSkgewogICAgeCA9ICt4LCB5ID0gK3k7CiAgICBpZiAodGhpcy5fcG9pbnQpIHRoaXMuX2NvbnRleHQubGluZVRvKHgsIHkpOwogICAgZWxzZSB0aGlzLl9wb2ludCA9IDEsIHRoaXMuX2NvbnRleHQubW92ZVRvKHgsIHkpOwogIH0KfTsKCmZ1bmN0aW9uIGxpbmVhckNsb3NlZChjb250ZXh0KSB7CiAgcmV0dXJuIG5ldyBMaW5lYXJDbG9zZWQoY29udGV4dCk7Cn0KCmZ1bmN0aW9uIHNpZ24kMSh4KSB7CiAgcmV0dXJuIHggPCAwID8gLTEgOiAxOwp9CgovLyBDYWxjdWxhdGUgdGhlIHNsb3BlcyBvZiB0aGUgdGFuZ2VudHMgKEhlcm1pdGUtdHlwZSBpbnRlcnBvbGF0aW9uKSBiYXNlZCBvbgovLyB0aGUgZm9sbG93aW5nIHBhcGVyOiBTdGVmZmVuLCBNLiAxOTkwLiBBIFNpbXBsZSBNZXRob2QgZm9yIE1vbm90b25pYwovLyBJbnRlcnBvbGF0aW9uIGluIE9uZSBEaW1lbnNpb24uIEFzdHJvbm9teSBhbmQgQXN0cm9waHlzaWNzLCBWb2wuIDIzOSwgTk8uCi8vIE5PVihJSSksIFAuIDQ0MywgMTk5MC4KZnVuY3Rpb24gc2xvcGUzKHRoYXQsIHgyLCB5MikgewogIHZhciBoMCA9IHRoYXQuX3gxIC0gdGhhdC5feDAsCiAgICAgIGgxID0geDIgLSB0aGF0Ll94MSwKICAgICAgczAgPSAodGhhdC5feTEgLSB0aGF0Ll95MCkgLyAoaDAgfHwgaDEgPCAwICYmIC0wKSwKICAgICAgczEgPSAoeTIgLSB0aGF0Ll95MSkgLyAoaDEgfHwgaDAgPCAwICYmIC0wKSwKICAgICAgcCA9IChzMCAqIGgxICsgczEgKiBoMCkgLyAoaDAgKyBoMSk7CiAgcmV0dXJuIChzaWduJDEoczApICsgc2lnbiQxKHMxKSkgKiBNYXRoLm1pbihNYXRoLmFicyhzMCksIE1hdGguYWJzKHMxKSwgMC41ICogTWF0aC5hYnMocCkpIHx8IDA7Cn0KCi8vIENhbGN1bGF0ZSBhIG9uZS1zaWRlZCBzbG9wZS4KZnVuY3Rpb24gc2xvcGUyKHRoYXQsIHQpIHsKICB2YXIgaCA9IHRoYXQuX3gxIC0gdGhhdC5feDA7CiAgcmV0dXJuIGggPyAoMyAqICh0aGF0Ll95MSAtIHRoYXQuX3kwKSAvIGggLSB0KSAvIDIgOiB0Owp9CgovLyBBY2NvcmRpbmcgdG8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ3ViaWNfSGVybWl0ZV9zcGxpbmUjUmVwcmVzZW50YXRpb25zCi8vICJ5b3UgY2FuIGV4cHJlc3MgY3ViaWMgSGVybWl0ZSBpbnRlcnBvbGF0aW9uIGluIHRlcm1zIG9mIGN1YmljIELDqXppZXIgY3VydmVzCi8vIHdpdGggcmVzcGVjdCB0byB0aGUgZm91ciB2YWx1ZXMgcDAsIHAwICsgbTAgLyAzLCBwMSAtIG0xIC8gMywgcDEiLgpmdW5jdGlvbiBwb2ludCQ1KHRoYXQsIHQwLCB0MSkgewogIHZhciB4MCA9IHRoYXQuX3gwLAogICAgICB5MCA9IHRoYXQuX3kwLAogICAgICB4MSA9IHRoYXQuX3gxLAogICAgICB5MSA9IHRoYXQuX3kxLAogICAgICBkeCA9ICh4MSAtIHgwKSAvIDM7CiAgdGhhdC5fY29udGV4dC5iZXppZXJDdXJ2ZVRvKHgwICsgZHgsIHkwICsgZHggKiB0MCwgeDEgLSBkeCwgeTEgLSBkeCAqIHQxLCB4MSwgeTEpOwp9CgpmdW5jdGlvbiBNb25vdG9uZVgoY29udGV4dCkgewogIHRoaXMuX2NvbnRleHQgPSBjb250ZXh0Owp9CgpNb25vdG9uZVgucHJvdG90eXBlID0gewogIGFyZWFTdGFydDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9saW5lID0gMDsKICB9LAogIGFyZWFFbmQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fbGluZSA9IE5hTjsKICB9LAogIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl94MCA9IHRoaXMuX3gxID0KICAgIHRoaXMuX3kwID0gdGhpcy5feTEgPQogICAgdGhpcy5fdDAgPSBOYU47CiAgICB0aGlzLl9wb2ludCA9IDA7CiAgfSwKICBsaW5lRW5kOiBmdW5jdGlvbigpIHsKICAgIHN3aXRjaCAodGhpcy5fcG9pbnQpIHsKICAgICAgY2FzZSAyOiB0aGlzLl9jb250ZXh0LmxpbmVUbyh0aGlzLl94MSwgdGhpcy5feTEpOyBicmVhazsKICAgICAgY2FzZSAzOiBwb2ludCQ1KHRoaXMsIHRoaXMuX3QwLCBzbG9wZTIodGhpcywgdGhpcy5fdDApKTsgYnJlYWs7CiAgICB9CiAgICBpZiAodGhpcy5fbGluZSB8fCAodGhpcy5fbGluZSAhPT0gMCAmJiB0aGlzLl9wb2ludCA9PT0gMSkpIHRoaXMuX2NvbnRleHQuY2xvc2VQYXRoKCk7CiAgICB0aGlzLl9saW5lID0gMSAtIHRoaXMuX2xpbmU7CiAgfSwKICBwb2ludDogZnVuY3Rpb24oeCwgeSkgewogICAgdmFyIHQxID0gTmFOOwoKICAgIHggPSAreCwgeSA9ICt5OwogICAgaWYgKHggPT09IHRoaXMuX3gxICYmIHkgPT09IHRoaXMuX3kxKSByZXR1cm47IC8vIElnbm9yZSBjb2luY2lkZW50IHBvaW50cy4KICAgIHN3aXRjaCAodGhpcy5fcG9pbnQpIHsKICAgICAgY2FzZSAwOiB0aGlzLl9wb2ludCA9IDE7IHRoaXMuX2xpbmUgPyB0aGlzLl9jb250ZXh0LmxpbmVUbyh4LCB5KSA6IHRoaXMuX2NvbnRleHQubW92ZVRvKHgsIHkpOyBicmVhazsKICAgICAgY2FzZSAxOiB0aGlzLl9wb2ludCA9IDI7IGJyZWFrOwogICAgICBjYXNlIDI6IHRoaXMuX3BvaW50ID0gMzsgcG9pbnQkNSh0aGlzLCBzbG9wZTIodGhpcywgdDEgPSBzbG9wZTModGhpcywgeCwgeSkpLCB0MSk7IGJyZWFrOwogICAgICBkZWZhdWx0OiBwb2ludCQ1KHRoaXMsIHRoaXMuX3QwLCB0MSA9IHNsb3BlMyh0aGlzLCB4LCB5KSk7IGJyZWFrOwogICAgfQoKICAgIHRoaXMuX3gwID0gdGhpcy5feDEsIHRoaXMuX3gxID0geDsKICAgIHRoaXMuX3kwID0gdGhpcy5feTEsIHRoaXMuX3kxID0geTsKICAgIHRoaXMuX3QwID0gdDE7CiAgfQp9OwoKZnVuY3Rpb24gTW9ub3RvbmVZKGNvbnRleHQpIHsKICB0aGlzLl9jb250ZXh0ID0gbmV3IFJlZmxlY3RDb250ZXh0KGNvbnRleHQpOwp9CgooTW9ub3RvbmVZLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoTW9ub3RvbmVYLnByb3RvdHlwZSkpLnBvaW50ID0gZnVuY3Rpb24oeCwgeSkgewogIE1vbm90b25lWC5wcm90b3R5cGUucG9pbnQuY2FsbCh0aGlzLCB5LCB4KTsKfTsKCmZ1bmN0aW9uIFJlZmxlY3RDb250ZXh0KGNvbnRleHQpIHsKICB0aGlzLl9jb250ZXh0ID0gY29udGV4dDsKfQoKUmVmbGVjdENvbnRleHQucHJvdG90eXBlID0gewogIG1vdmVUbzogZnVuY3Rpb24oeCwgeSkgeyB0aGlzLl9jb250ZXh0Lm1vdmVUbyh5LCB4KTsgfSwKICBjbG9zZVBhdGg6IGZ1bmN0aW9uKCkgeyB0aGlzLl9jb250ZXh0LmNsb3NlUGF0aCgpOyB9LAogIGxpbmVUbzogZnVuY3Rpb24oeCwgeSkgeyB0aGlzLl9jb250ZXh0LmxpbmVUbyh5LCB4KTsgfSwKICBiZXppZXJDdXJ2ZVRvOiBmdW5jdGlvbih4MSwgeTEsIHgyLCB5MiwgeCwgeSkgeyB0aGlzLl9jb250ZXh0LmJlemllckN1cnZlVG8oeTEsIHgxLCB5MiwgeDIsIHksIHgpOyB9Cn07CgpmdW5jdGlvbiBtb25vdG9uZVgoY29udGV4dCkgewogIHJldHVybiBuZXcgTW9ub3RvbmVYKGNvbnRleHQpOwp9CgpmdW5jdGlvbiBtb25vdG9uZVkoY29udGV4dCkgewogIHJldHVybiBuZXcgTW9ub3RvbmVZKGNvbnRleHQpOwp9CgpmdW5jdGlvbiBOYXR1cmFsKGNvbnRleHQpIHsKICB0aGlzLl9jb250ZXh0ID0gY29udGV4dDsKfQoKTmF0dXJhbC5wcm90b3R5cGUgPSB7CiAgYXJlYVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX2xpbmUgPSAwOwogIH0sCiAgYXJlYUVuZDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9saW5lID0gTmFOOwogIH0sCiAgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX3ggPSBbXTsKICAgIHRoaXMuX3kgPSBbXTsKICB9LAogIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgdmFyIHggPSB0aGlzLl94LAogICAgICAgIHkgPSB0aGlzLl95LAogICAgICAgIG4gPSB4Lmxlbmd0aDsKCiAgICBpZiAobikgewogICAgICB0aGlzLl9saW5lID8gdGhpcy5fY29udGV4dC5saW5lVG8oeFswXSwgeVswXSkgOiB0aGlzLl9jb250ZXh0Lm1vdmVUbyh4WzBdLCB5WzBdKTsKICAgICAgaWYgKG4gPT09IDIpIHsKICAgICAgICB0aGlzLl9jb250ZXh0LmxpbmVUbyh4WzFdLCB5WzFdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgcHggPSBjb250cm9sUG9pbnRzKHgpLAogICAgICAgICAgICBweSA9IGNvbnRyb2xQb2ludHMoeSk7CiAgICAgICAgZm9yICh2YXIgaTAgPSAwLCBpMSA9IDE7IGkxIDwgbjsgKytpMCwgKytpMSkgewogICAgICAgICAgdGhpcy5fY29udGV4dC5iZXppZXJDdXJ2ZVRvKHB4WzBdW2kwXSwgcHlbMF1baTBdLCBweFsxXVtpMF0sIHB5WzFdW2kwXSwgeFtpMV0sIHlbaTFdKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZiAodGhpcy5fbGluZSB8fCAodGhpcy5fbGluZSAhPT0gMCAmJiBuID09PSAxKSkgdGhpcy5fY29udGV4dC5jbG9zZVBhdGgoKTsKICAgIHRoaXMuX2xpbmUgPSAxIC0gdGhpcy5fbGluZTsKICAgIHRoaXMuX3ggPSB0aGlzLl95ID0gbnVsbDsKICB9LAogIHBvaW50OiBmdW5jdGlvbih4LCB5KSB7CiAgICB0aGlzLl94LnB1c2goK3gpOwogICAgdGhpcy5feS5wdXNoKCt5KTsKICB9Cn07CgovLyBTZWUgaHR0cHM6Ly93d3cucGFydGljbGVpbmNlbGwuY29tLzIwMTIvYmV6aWVyLXNwbGluZXMvIGZvciBkZXJpdmF0aW9uLgpmdW5jdGlvbiBjb250cm9sUG9pbnRzKHgpIHsKICB2YXIgaSwKICAgICAgbiA9IHgubGVuZ3RoIC0gMSwKICAgICAgbSwKICAgICAgYSA9IG5ldyBBcnJheShuKSwKICAgICAgYiA9IG5ldyBBcnJheShuKSwKICAgICAgciA9IG5ldyBBcnJheShuKTsKICBhWzBdID0gMCwgYlswXSA9IDIsIHJbMF0gPSB4WzBdICsgMiAqIHhbMV07CiAgZm9yIChpID0gMTsgaSA8IG4gLSAxOyArK2kpIGFbaV0gPSAxLCBiW2ldID0gNCwgcltpXSA9IDQgKiB4W2ldICsgMiAqIHhbaSArIDFdOwogIGFbbiAtIDFdID0gMiwgYltuIC0gMV0gPSA3LCByW24gLSAxXSA9IDggKiB4W24gLSAxXSArIHhbbl07CiAgZm9yIChpID0gMTsgaSA8IG47ICsraSkgbSA9IGFbaV0gLyBiW2kgLSAxXSwgYltpXSAtPSBtLCByW2ldIC09IG0gKiByW2kgLSAxXTsKICBhW24gLSAxXSA9IHJbbiAtIDFdIC8gYltuIC0gMV07CiAgZm9yIChpID0gbiAtIDI7IGkgPj0gMDsgLS1pKSBhW2ldID0gKHJbaV0gLSBhW2kgKyAxXSkgLyBiW2ldOwogIGJbbiAtIDFdID0gKHhbbl0gKyBhW24gLSAxXSkgLyAyOwogIGZvciAoaSA9IDA7IGkgPCBuIC0gMTsgKytpKSBiW2ldID0gMiAqIHhbaSArIDFdIC0gYVtpICsgMV07CiAgcmV0dXJuIFthLCBiXTsKfQoKZnVuY3Rpb24gbmF0dXJhbChjb250ZXh0KSB7CiAgcmV0dXJuIG5ldyBOYXR1cmFsKGNvbnRleHQpOwp9CgpmdW5jdGlvbiBTdGVwKGNvbnRleHQsIHQpIHsKICB0aGlzLl9jb250ZXh0ID0gY29udGV4dDsKICB0aGlzLl90ID0gdDsKfQoKU3RlcC5wcm90b3R5cGUgPSB7CiAgYXJlYVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX2xpbmUgPSAwOwogIH0sCiAgYXJlYUVuZDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9saW5lID0gTmFOOwogIH0sCiAgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMuX3ggPSB0aGlzLl95ID0gTmFOOwogICAgdGhpcy5fcG9pbnQgPSAwOwogIH0sCiAgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICBpZiAoMCA8IHRoaXMuX3QgJiYgdGhpcy5fdCA8IDEgJiYgdGhpcy5fcG9pbnQgPT09IDIpIHRoaXMuX2NvbnRleHQubGluZVRvKHRoaXMuX3gsIHRoaXMuX3kpOwogICAgaWYgKHRoaXMuX2xpbmUgfHwgKHRoaXMuX2xpbmUgIT09IDAgJiYgdGhpcy5fcG9pbnQgPT09IDEpKSB0aGlzLl9jb250ZXh0LmNsb3NlUGF0aCgpOwogICAgaWYgKHRoaXMuX2xpbmUgPj0gMCkgdGhpcy5fdCA9IDEgLSB0aGlzLl90LCB0aGlzLl9saW5lID0gMSAtIHRoaXMuX2xpbmU7CiAgfSwKICBwb2ludDogZnVuY3Rpb24oeCwgeSkgewogICAgeCA9ICt4LCB5ID0gK3k7CiAgICBzd2l0Y2ggKHRoaXMuX3BvaW50KSB7CiAgICAgIGNhc2UgMDogdGhpcy5fcG9pbnQgPSAxOyB0aGlzLl9saW5lID8gdGhpcy5fY29udGV4dC5saW5lVG8oeCwgeSkgOiB0aGlzLl9jb250ZXh0Lm1vdmVUbyh4LCB5KTsgYnJlYWs7CiAgICAgIGNhc2UgMTogdGhpcy5fcG9pbnQgPSAyOyAvLyBwcm9jZWVkCiAgICAgIGRlZmF1bHQ6IHsKICAgICAgICBpZiAodGhpcy5fdCA8PSAwKSB7CiAgICAgICAgICB0aGlzLl9jb250ZXh0LmxpbmVUbyh0aGlzLl94LCB5KTsKICAgICAgICAgIHRoaXMuX2NvbnRleHQubGluZVRvKHgsIHkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgeDEgPSB0aGlzLl94ICogKDEgLSB0aGlzLl90KSArIHggKiB0aGlzLl90OwogICAgICAgICAgdGhpcy5fY29udGV4dC5saW5lVG8oeDEsIHRoaXMuX3kpOwogICAgICAgICAgdGhpcy5fY29udGV4dC5saW5lVG8oeDEsIHkpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgdGhpcy5feCA9IHgsIHRoaXMuX3kgPSB5OwogIH0KfTsKCmZ1bmN0aW9uIHN0ZXAoY29udGV4dCkgewogIHJldHVybiBuZXcgU3RlcChjb250ZXh0LCAwLjUpOwp9CgpmdW5jdGlvbiBzdGVwQmVmb3JlKGNvbnRleHQpIHsKICByZXR1cm4gbmV3IFN0ZXAoY29udGV4dCwgMCk7Cn0KCmZ1bmN0aW9uIHN0ZXBBZnRlcihjb250ZXh0KSB7CiAgcmV0dXJuIG5ldyBTdGVwKGNvbnRleHQsIDEpOwp9CgpmdW5jdGlvbiBub25lJDEoc2VyaWVzLCBvcmRlcikgewogIGlmICghKChuID0gc2VyaWVzLmxlbmd0aCkgPiAxKSkgcmV0dXJuOwogIGZvciAodmFyIGkgPSAxLCBqLCBzMCwgczEgPSBzZXJpZXNbb3JkZXJbMF1dLCBuLCBtID0gczEubGVuZ3RoOyBpIDwgbjsgKytpKSB7CiAgICBzMCA9IHMxLCBzMSA9IHNlcmllc1tvcmRlcltpXV07CiAgICBmb3IgKGogPSAwOyBqIDwgbTsgKytqKSB7CiAgICAgIHMxW2pdWzFdICs9IHMxW2pdWzBdID0gaXNOYU4oczBbal1bMV0pID8gczBbal1bMF0gOiBzMFtqXVsxXTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIG5vbmUkMihzZXJpZXMpIHsKICB2YXIgbiA9IHNlcmllcy5sZW5ndGgsIG8gPSBuZXcgQXJyYXkobik7CiAgd2hpbGUgKC0tbiA+PSAwKSBvW25dID0gbjsKICByZXR1cm4gbzsKfQoKZnVuY3Rpb24gc3RhY2tWYWx1ZShkLCBrZXkpIHsKICByZXR1cm4gZFtrZXldOwp9CgpmdW5jdGlvbiBzdGFjaygpIHsKICB2YXIga2V5cyA9IGNvbnN0YW50JDExKFtdKSwKICAgICAgb3JkZXIgPSBub25lJDIsCiAgICAgIG9mZnNldCA9IG5vbmUkMSwKICAgICAgdmFsdWUgPSBzdGFja1ZhbHVlOwoKICBmdW5jdGlvbiBzdGFjayhkYXRhKSB7CiAgICB2YXIga3ogPSBrZXlzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksCiAgICAgICAgaSwKICAgICAgICBtID0gZGF0YS5sZW5ndGgsCiAgICAgICAgbiA9IGt6Lmxlbmd0aCwKICAgICAgICBzeiA9IG5ldyBBcnJheShuKSwKICAgICAgICBvejsKCiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgIGZvciAodmFyIGtpID0ga3pbaV0sIHNpID0gc3pbaV0gPSBuZXcgQXJyYXkobSksIGogPSAwLCBzaWo7IGogPCBtOyArK2opIHsKICAgICAgICBzaVtqXSA9IHNpaiA9IFswLCArdmFsdWUoZGF0YVtqXSwga2ksIGosIGRhdGEpXTsKICAgICAgICBzaWouZGF0YSA9IGRhdGFbal07CiAgICAgIH0KICAgICAgc2kua2V5ID0ga2k7CiAgICB9CgogICAgZm9yIChpID0gMCwgb3ogPSBvcmRlcihzeik7IGkgPCBuOyArK2kpIHsKICAgICAgc3pbb3pbaV1dLmluZGV4ID0gaTsKICAgIH0KCiAgICBvZmZzZXQoc3osIG96KTsKICAgIHJldHVybiBzejsKICB9CgogIHN0YWNrLmtleXMgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChrZXlzID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMTEoc2xpY2UkNi5jYWxsKF8pKSwgc3RhY2spIDoga2V5czsKICB9OwoKICBzdGFjay52YWx1ZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHZhbHVlID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMTEoK18pLCBzdGFjaykgOiB2YWx1ZTsKICB9OwoKICBzdGFjay5vcmRlciA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG9yZGVyID0gXyA9PSBudWxsID8gbm9uZSQyIDogdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMTEoc2xpY2UkNi5jYWxsKF8pKSwgc3RhY2spIDogb3JkZXI7CiAgfTsKCiAgc3RhY2sub2Zmc2V0ID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAob2Zmc2V0ID0gXyA9PSBudWxsID8gbm9uZSQxIDogXywgc3RhY2spIDogb2Zmc2V0OwogIH07CgogIHJldHVybiBzdGFjazsKfQoKZnVuY3Rpb24gZXhwYW5kKHNlcmllcywgb3JkZXIpIHsKICBpZiAoISgobiA9IHNlcmllcy5sZW5ndGgpID4gMCkpIHJldHVybjsKICBmb3IgKHZhciBpLCBuLCBqID0gMCwgbSA9IHNlcmllc1swXS5sZW5ndGgsIHk7IGogPCBtOyArK2opIHsKICAgIGZvciAoeSA9IGkgPSAwOyBpIDwgbjsgKytpKSB5ICs9IHNlcmllc1tpXVtqXVsxXSB8fCAwOwogICAgaWYgKHkpIGZvciAoaSA9IDA7IGkgPCBuOyArK2kpIHNlcmllc1tpXVtqXVsxXSAvPSB5OwogIH0KICBub25lJDEoc2VyaWVzLCBvcmRlcik7Cn0KCmZ1bmN0aW9uIGRpdmVyZ2luZyhzZXJpZXMsIG9yZGVyKSB7CiAgaWYgKCEoKG4gPSBzZXJpZXMubGVuZ3RoKSA+IDEpKSByZXR1cm47CiAgZm9yICh2YXIgaSwgaiA9IDAsIGQsIGR5LCB5cCwgeW4sIG4sIG0gPSBzZXJpZXNbb3JkZXJbMF1dLmxlbmd0aDsgaiA8IG07ICsraikgewogICAgZm9yICh5cCA9IHluID0gMCwgaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgaWYgKChkeSA9IChkID0gc2VyaWVzW29yZGVyW2ldXVtqXSlbMV0gLSBkWzBdKSA+PSAwKSB7CiAgICAgICAgZFswXSA9IHlwLCBkWzFdID0geXAgKz0gZHk7CiAgICAgIH0gZWxzZSBpZiAoZHkgPCAwKSB7CiAgICAgICAgZFsxXSA9IHluLCBkWzBdID0geW4gKz0gZHk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZFswXSA9IHlwOwogICAgICB9CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBzaWxob3VldHRlKHNlcmllcywgb3JkZXIpIHsKICBpZiAoISgobiA9IHNlcmllcy5sZW5ndGgpID4gMCkpIHJldHVybjsKICBmb3IgKHZhciBqID0gMCwgczAgPSBzZXJpZXNbb3JkZXJbMF1dLCBuLCBtID0gczAubGVuZ3RoOyBqIDwgbTsgKytqKSB7CiAgICBmb3IgKHZhciBpID0gMCwgeSA9IDA7IGkgPCBuOyArK2kpIHkgKz0gc2VyaWVzW2ldW2pdWzFdIHx8IDA7CiAgICBzMFtqXVsxXSArPSBzMFtqXVswXSA9IC15IC8gMjsKICB9CiAgbm9uZSQxKHNlcmllcywgb3JkZXIpOwp9CgpmdW5jdGlvbiB3aWdnbGUoc2VyaWVzLCBvcmRlcikgewogIGlmICghKChuID0gc2VyaWVzLmxlbmd0aCkgPiAwKSB8fCAhKChtID0gKHMwID0gc2VyaWVzW29yZGVyWzBdXSkubGVuZ3RoKSA+IDApKSByZXR1cm47CiAgZm9yICh2YXIgeSA9IDAsIGogPSAxLCBzMCwgbSwgbjsgaiA8IG07ICsraikgewogICAgZm9yICh2YXIgaSA9IDAsIHMxID0gMCwgczIgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgIHZhciBzaSA9IHNlcmllc1tvcmRlcltpXV0sCiAgICAgICAgICBzaWowID0gc2lbal1bMV0gfHwgMCwKICAgICAgICAgIHNpajEgPSBzaVtqIC0gMV1bMV0gfHwgMCwKICAgICAgICAgIHMzID0gKHNpajAgLSBzaWoxKSAvIDI7CiAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgaTsgKytrKSB7CiAgICAgICAgdmFyIHNrID0gc2VyaWVzW29yZGVyW2tdXSwKICAgICAgICAgICAgc2tqMCA9IHNrW2pdWzFdIHx8IDAsCiAgICAgICAgICAgIHNrajEgPSBza1tqIC0gMV1bMV0gfHwgMDsKICAgICAgICBzMyArPSBza2owIC0gc2tqMTsKICAgICAgfQogICAgICBzMSArPSBzaWowLCBzMiArPSBzMyAqIHNpajA7CiAgICB9CiAgICBzMFtqIC0gMV1bMV0gKz0gczBbaiAtIDFdWzBdID0geTsKICAgIGlmIChzMSkgeSAtPSBzMiAvIHMxOwogIH0KICBzMFtqIC0gMV1bMV0gKz0gczBbaiAtIDFdWzBdID0geTsKICBub25lJDEoc2VyaWVzLCBvcmRlcik7Cn0KCmZ1bmN0aW9uIGFzY2VuZGluZyQzKHNlcmllcykgewogIHZhciBzdW1zID0gc2VyaWVzLm1hcChzdW0kMik7CiAgcmV0dXJuIG5vbmUkMihzZXJpZXMpLnNvcnQoZnVuY3Rpb24oYSwgYikgeyByZXR1cm4gc3Vtc1thXSAtIHN1bXNbYl07IH0pOwp9CgpmdW5jdGlvbiBzdW0kMihzZXJpZXMpIHsKICB2YXIgcyA9IDAsIGkgPSAtMSwgbiA9IHNlcmllcy5sZW5ndGgsIHY7CiAgd2hpbGUgKCsraSA8IG4pIGlmICh2ID0gK3Nlcmllc1tpXVsxXSkgcyArPSB2OwogIHJldHVybiBzOwp9CgpmdW5jdGlvbiBkZXNjZW5kaW5nJDIoc2VyaWVzKSB7CiAgcmV0dXJuIGFzY2VuZGluZyQzKHNlcmllcykucmV2ZXJzZSgpOwp9CgpmdW5jdGlvbiBpbnNpZGVPdXQoc2VyaWVzKSB7CiAgdmFyIG4gPSBzZXJpZXMubGVuZ3RoLAogICAgICBpLAogICAgICBqLAogICAgICBzdW1zID0gc2VyaWVzLm1hcChzdW0kMiksCiAgICAgIG9yZGVyID0gbm9uZSQyKHNlcmllcykuc29ydChmdW5jdGlvbihhLCBiKSB7IHJldHVybiBzdW1zW2JdIC0gc3Vtc1thXTsgfSksCiAgICAgIHRvcCA9IDAsCiAgICAgIGJvdHRvbSA9IDAsCiAgICAgIHRvcHMgPSBbXSwKICAgICAgYm90dG9tcyA9IFtdOwoKICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICBqID0gb3JkZXJbaV07CiAgICBpZiAodG9wIDwgYm90dG9tKSB7CiAgICAgIHRvcCArPSBzdW1zW2pdOwogICAgICB0b3BzLnB1c2goaik7CiAgICB9IGVsc2UgewogICAgICBib3R0b20gKz0gc3Vtc1tqXTsKICAgICAgYm90dG9tcy5wdXNoKGopOwogICAgfQogIH0KCiAgcmV0dXJuIGJvdHRvbXMucmV2ZXJzZSgpLmNvbmNhdCh0b3BzKTsKfQoKZnVuY3Rpb24gcmV2ZXJzZShzZXJpZXMpIHsKICByZXR1cm4gbm9uZSQyKHNlcmllcykucmV2ZXJzZSgpOwp9CgpmdW5jdGlvbiBjb25zdGFudCQxMih4KSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHg7CiAgfTsKfQoKZnVuY3Rpb24geCQ0KGQpIHsKICByZXR1cm4gZFswXTsKfQoKZnVuY3Rpb24geSQ0KGQpIHsKICByZXR1cm4gZFsxXTsKfQoKZnVuY3Rpb24gUmVkQmxhY2tUcmVlKCkgewogIHRoaXMuXyA9IG51bGw7IC8vIHJvb3Qgbm9kZQp9CgpmdW5jdGlvbiBSZWRCbGFja05vZGUobm9kZSkgewogIG5vZGUuVSA9IC8vIHBhcmVudCBub2RlCiAgbm9kZS5DID0gLy8gY29sb3IgLSB0cnVlIGZvciByZWQsIGZhbHNlIGZvciBibGFjawogIG5vZGUuTCA9IC8vIGxlZnQgbm9kZQogIG5vZGUuUiA9IC8vIHJpZ2h0IG5vZGUKICBub2RlLlAgPSAvLyBwcmV2aW91cyBub2RlCiAgbm9kZS5OID0gbnVsbDsgLy8gbmV4dCBub2RlCn0KClJlZEJsYWNrVHJlZS5wcm90b3R5cGUgPSB7CiAgY29uc3RydWN0b3I6IFJlZEJsYWNrVHJlZSwKCiAgaW5zZXJ0OiBmdW5jdGlvbihhZnRlciwgbm9kZSkgewogICAgdmFyIHBhcmVudCwgZ3JhbmRwYSwgdW5jbGU7CgogICAgaWYgKGFmdGVyKSB7CiAgICAgIG5vZGUuUCA9IGFmdGVyOwogICAgICBub2RlLk4gPSBhZnRlci5OOwogICAgICBpZiAoYWZ0ZXIuTikgYWZ0ZXIuTi5QID0gbm9kZTsKICAgICAgYWZ0ZXIuTiA9IG5vZGU7CiAgICAgIGlmIChhZnRlci5SKSB7CiAgICAgICAgYWZ0ZXIgPSBhZnRlci5SOwogICAgICAgIHdoaWxlIChhZnRlci5MKSBhZnRlciA9IGFmdGVyLkw7CiAgICAgICAgYWZ0ZXIuTCA9IG5vZGU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYWZ0ZXIuUiA9IG5vZGU7CiAgICAgIH0KICAgICAgcGFyZW50ID0gYWZ0ZXI7CiAgICB9IGVsc2UgaWYgKHRoaXMuXykgewogICAgICBhZnRlciA9IFJlZEJsYWNrRmlyc3QodGhpcy5fKTsKICAgICAgbm9kZS5QID0gbnVsbDsKICAgICAgbm9kZS5OID0gYWZ0ZXI7CiAgICAgIGFmdGVyLlAgPSBhZnRlci5MID0gbm9kZTsKICAgICAgcGFyZW50ID0gYWZ0ZXI7CiAgICB9IGVsc2UgewogICAgICBub2RlLlAgPSBub2RlLk4gPSBudWxsOwogICAgICB0aGlzLl8gPSBub2RlOwogICAgICBwYXJlbnQgPSBudWxsOwogICAgfQogICAgbm9kZS5MID0gbm9kZS5SID0gbnVsbDsKICAgIG5vZGUuVSA9IHBhcmVudDsKICAgIG5vZGUuQyA9IHRydWU7CgogICAgYWZ0ZXIgPSBub2RlOwogICAgd2hpbGUgKHBhcmVudCAmJiBwYXJlbnQuQykgewogICAgICBncmFuZHBhID0gcGFyZW50LlU7CiAgICAgIGlmIChwYXJlbnQgPT09IGdyYW5kcGEuTCkgewogICAgICAgIHVuY2xlID0gZ3JhbmRwYS5SOwogICAgICAgIGlmICh1bmNsZSAmJiB1bmNsZS5DKSB7CiAgICAgICAgICBwYXJlbnQuQyA9IHVuY2xlLkMgPSBmYWxzZTsKICAgICAgICAgIGdyYW5kcGEuQyA9IHRydWU7CiAgICAgICAgICBhZnRlciA9IGdyYW5kcGE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChhZnRlciA9PT0gcGFyZW50LlIpIHsKICAgICAgICAgICAgUmVkQmxhY2tSb3RhdGVMZWZ0KHRoaXMsIHBhcmVudCk7CiAgICAgICAgICAgIGFmdGVyID0gcGFyZW50OwogICAgICAgICAgICBwYXJlbnQgPSBhZnRlci5VOwogICAgICAgICAgfQogICAgICAgICAgcGFyZW50LkMgPSBmYWxzZTsKICAgICAgICAgIGdyYW5kcGEuQyA9IHRydWU7CiAgICAgICAgICBSZWRCbGFja1JvdGF0ZVJpZ2h0KHRoaXMsIGdyYW5kcGEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB1bmNsZSA9IGdyYW5kcGEuTDsKICAgICAgICBpZiAodW5jbGUgJiYgdW5jbGUuQykgewogICAgICAgICAgcGFyZW50LkMgPSB1bmNsZS5DID0gZmFsc2U7CiAgICAgICAgICBncmFuZHBhLkMgPSB0cnVlOwogICAgICAgICAgYWZ0ZXIgPSBncmFuZHBhOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoYWZ0ZXIgPT09IHBhcmVudC5MKSB7CiAgICAgICAgICAgIFJlZEJsYWNrUm90YXRlUmlnaHQodGhpcywgcGFyZW50KTsKICAgICAgICAgICAgYWZ0ZXIgPSBwYXJlbnQ7CiAgICAgICAgICAgIHBhcmVudCA9IGFmdGVyLlU7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJlbnQuQyA9IGZhbHNlOwogICAgICAgICAgZ3JhbmRwYS5DID0gdHJ1ZTsKICAgICAgICAgIFJlZEJsYWNrUm90YXRlTGVmdCh0aGlzLCBncmFuZHBhKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcGFyZW50ID0gYWZ0ZXIuVTsKICAgIH0KICAgIHRoaXMuXy5DID0gZmFsc2U7CiAgfSwKCiAgcmVtb3ZlOiBmdW5jdGlvbihub2RlKSB7CiAgICBpZiAobm9kZS5OKSBub2RlLk4uUCA9IG5vZGUuUDsKICAgIGlmIChub2RlLlApIG5vZGUuUC5OID0gbm9kZS5OOwogICAgbm9kZS5OID0gbm9kZS5QID0gbnVsbDsKCiAgICB2YXIgcGFyZW50ID0gbm9kZS5VLAogICAgICAgIHNpYmxpbmcsCiAgICAgICAgbGVmdCA9IG5vZGUuTCwKICAgICAgICByaWdodCA9IG5vZGUuUiwKICAgICAgICBuZXh0LAogICAgICAgIHJlZDsKCiAgICBpZiAoIWxlZnQpIG5leHQgPSByaWdodDsKICAgIGVsc2UgaWYgKCFyaWdodCkgbmV4dCA9IGxlZnQ7CiAgICBlbHNlIG5leHQgPSBSZWRCbGFja0ZpcnN0KHJpZ2h0KTsKCiAgICBpZiAocGFyZW50KSB7CiAgICAgIGlmIChwYXJlbnQuTCA9PT0gbm9kZSkgcGFyZW50LkwgPSBuZXh0OwogICAgICBlbHNlIHBhcmVudC5SID0gbmV4dDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuXyA9IG5leHQ7CiAgICB9CgogICAgaWYgKGxlZnQgJiYgcmlnaHQpIHsKICAgICAgcmVkID0gbmV4dC5DOwogICAgICBuZXh0LkMgPSBub2RlLkM7CiAgICAgIG5leHQuTCA9IGxlZnQ7CiAgICAgIGxlZnQuVSA9IG5leHQ7CiAgICAgIGlmIChuZXh0ICE9PSByaWdodCkgewogICAgICAgIHBhcmVudCA9IG5leHQuVTsKICAgICAgICBuZXh0LlUgPSBub2RlLlU7CiAgICAgICAgbm9kZSA9IG5leHQuUjsKICAgICAgICBwYXJlbnQuTCA9IG5vZGU7CiAgICAgICAgbmV4dC5SID0gcmlnaHQ7CiAgICAgICAgcmlnaHQuVSA9IG5leHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmV4dC5VID0gcGFyZW50OwogICAgICAgIHBhcmVudCA9IG5leHQ7CiAgICAgICAgbm9kZSA9IG5leHQuUjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgcmVkID0gbm9kZS5DOwogICAgICBub2RlID0gbmV4dDsKICAgIH0KCiAgICBpZiAobm9kZSkgbm9kZS5VID0gcGFyZW50OwogICAgaWYgKHJlZCkgcmV0dXJuOwogICAgaWYgKG5vZGUgJiYgbm9kZS5DKSB7IG5vZGUuQyA9IGZhbHNlOyByZXR1cm47IH0KCiAgICBkbyB7CiAgICAgIGlmIChub2RlID09PSB0aGlzLl8pIGJyZWFrOwogICAgICBpZiAobm9kZSA9PT0gcGFyZW50LkwpIHsKICAgICAgICBzaWJsaW5nID0gcGFyZW50LlI7CiAgICAgICAgaWYgKHNpYmxpbmcuQykgewogICAgICAgICAgc2libGluZy5DID0gZmFsc2U7CiAgICAgICAgICBwYXJlbnQuQyA9IHRydWU7CiAgICAgICAgICBSZWRCbGFja1JvdGF0ZUxlZnQodGhpcywgcGFyZW50KTsKICAgICAgICAgIHNpYmxpbmcgPSBwYXJlbnQuUjsKICAgICAgICB9CiAgICAgICAgaWYgKChzaWJsaW5nLkwgJiYgc2libGluZy5MLkMpCiAgICAgICAgICAgIHx8IChzaWJsaW5nLlIgJiYgc2libGluZy5SLkMpKSB7CiAgICAgICAgICBpZiAoIXNpYmxpbmcuUiB8fCAhc2libGluZy5SLkMpIHsKICAgICAgICAgICAgc2libGluZy5MLkMgPSBmYWxzZTsKICAgICAgICAgICAgc2libGluZy5DID0gdHJ1ZTsKICAgICAgICAgICAgUmVkQmxhY2tSb3RhdGVSaWdodCh0aGlzLCBzaWJsaW5nKTsKICAgICAgICAgICAgc2libGluZyA9IHBhcmVudC5SOwogICAgICAgICAgfQogICAgICAgICAgc2libGluZy5DID0gcGFyZW50LkM7CiAgICAgICAgICBwYXJlbnQuQyA9IHNpYmxpbmcuUi5DID0gZmFsc2U7CiAgICAgICAgICBSZWRCbGFja1JvdGF0ZUxlZnQodGhpcywgcGFyZW50KTsKICAgICAgICAgIG5vZGUgPSB0aGlzLl87CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2libGluZyA9IHBhcmVudC5MOwogICAgICAgIGlmIChzaWJsaW5nLkMpIHsKICAgICAgICAgIHNpYmxpbmcuQyA9IGZhbHNlOwogICAgICAgICAgcGFyZW50LkMgPSB0cnVlOwogICAgICAgICAgUmVkQmxhY2tSb3RhdGVSaWdodCh0aGlzLCBwYXJlbnQpOwogICAgICAgICAgc2libGluZyA9IHBhcmVudC5MOwogICAgICAgIH0KICAgICAgICBpZiAoKHNpYmxpbmcuTCAmJiBzaWJsaW5nLkwuQykKICAgICAgICAgIHx8IChzaWJsaW5nLlIgJiYgc2libGluZy5SLkMpKSB7CiAgICAgICAgICBpZiAoIXNpYmxpbmcuTCB8fCAhc2libGluZy5MLkMpIHsKICAgICAgICAgICAgc2libGluZy5SLkMgPSBmYWxzZTsKICAgICAgICAgICAgc2libGluZy5DID0gdHJ1ZTsKICAgICAgICAgICAgUmVkQmxhY2tSb3RhdGVMZWZ0KHRoaXMsIHNpYmxpbmcpOwogICAgICAgICAgICBzaWJsaW5nID0gcGFyZW50Lkw7CiAgICAgICAgICB9CiAgICAgICAgICBzaWJsaW5nLkMgPSBwYXJlbnQuQzsKICAgICAgICAgIHBhcmVudC5DID0gc2libGluZy5MLkMgPSBmYWxzZTsKICAgICAgICAgIFJlZEJsYWNrUm90YXRlUmlnaHQodGhpcywgcGFyZW50KTsKICAgICAgICAgIG5vZGUgPSB0aGlzLl87CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgc2libGluZy5DID0gdHJ1ZTsKICAgICAgbm9kZSA9IHBhcmVudDsKICAgICAgcGFyZW50ID0gcGFyZW50LlU7CiAgICB9IHdoaWxlICghbm9kZS5DKTsKCiAgICBpZiAobm9kZSkgbm9kZS5DID0gZmFsc2U7CiAgfQp9OwoKZnVuY3Rpb24gUmVkQmxhY2tSb3RhdGVMZWZ0KHRyZWUsIG5vZGUpIHsKICB2YXIgcCA9IG5vZGUsCiAgICAgIHEgPSBub2RlLlIsCiAgICAgIHBhcmVudCA9IHAuVTsKCiAgaWYgKHBhcmVudCkgewogICAgaWYgKHBhcmVudC5MID09PSBwKSBwYXJlbnQuTCA9IHE7CiAgICBlbHNlIHBhcmVudC5SID0gcTsKICB9IGVsc2UgewogICAgdHJlZS5fID0gcTsKICB9CgogIHEuVSA9IHBhcmVudDsKICBwLlUgPSBxOwogIHAuUiA9IHEuTDsKICBpZiAocC5SKSBwLlIuVSA9IHA7CiAgcS5MID0gcDsKfQoKZnVuY3Rpb24gUmVkQmxhY2tSb3RhdGVSaWdodCh0cmVlLCBub2RlKSB7CiAgdmFyIHAgPSBub2RlLAogICAgICBxID0gbm9kZS5MLAogICAgICBwYXJlbnQgPSBwLlU7CgogIGlmIChwYXJlbnQpIHsKICAgIGlmIChwYXJlbnQuTCA9PT0gcCkgcGFyZW50LkwgPSBxOwogICAgZWxzZSBwYXJlbnQuUiA9IHE7CiAgfSBlbHNlIHsKICAgIHRyZWUuXyA9IHE7CiAgfQoKICBxLlUgPSBwYXJlbnQ7CiAgcC5VID0gcTsKICBwLkwgPSBxLlI7CiAgaWYgKHAuTCkgcC5MLlUgPSBwOwogIHEuUiA9IHA7Cn0KCmZ1bmN0aW9uIFJlZEJsYWNrRmlyc3Qobm9kZSkgewogIHdoaWxlIChub2RlLkwpIG5vZGUgPSBub2RlLkw7CiAgcmV0dXJuIG5vZGU7Cn0KCmZ1bmN0aW9uIGNyZWF0ZUVkZ2UobGVmdCwgcmlnaHQsIHYwLCB2MSkgewogIHZhciBlZGdlID0gW251bGwsIG51bGxdLAogICAgICBpbmRleCA9IGVkZ2VzLnB1c2goZWRnZSkgLSAxOwogIGVkZ2UubGVmdCA9IGxlZnQ7CiAgZWRnZS5yaWdodCA9IHJpZ2h0OwogIGlmICh2MCkgc2V0RWRnZUVuZChlZGdlLCBsZWZ0LCByaWdodCwgdjApOwogIGlmICh2MSkgc2V0RWRnZUVuZChlZGdlLCByaWdodCwgbGVmdCwgdjEpOwogIGNlbGxzW2xlZnQuaW5kZXhdLmhhbGZlZGdlcy5wdXNoKGluZGV4KTsKICBjZWxsc1tyaWdodC5pbmRleF0uaGFsZmVkZ2VzLnB1c2goaW5kZXgpOwogIHJldHVybiBlZGdlOwp9CgpmdW5jdGlvbiBjcmVhdGVCb3JkZXJFZGdlKGxlZnQsIHYwLCB2MSkgewogIHZhciBlZGdlID0gW3YwLCB2MV07CiAgZWRnZS5sZWZ0ID0gbGVmdDsKICByZXR1cm4gZWRnZTsKfQoKZnVuY3Rpb24gc2V0RWRnZUVuZChlZGdlLCBsZWZ0LCByaWdodCwgdmVydGV4KSB7CiAgaWYgKCFlZGdlWzBdICYmICFlZGdlWzFdKSB7CiAgICBlZGdlWzBdID0gdmVydGV4OwogICAgZWRnZS5sZWZ0ID0gbGVmdDsKICAgIGVkZ2UucmlnaHQgPSByaWdodDsKICB9IGVsc2UgaWYgKGVkZ2UubGVmdCA9PT0gcmlnaHQpIHsKICAgIGVkZ2VbMV0gPSB2ZXJ0ZXg7CiAgfSBlbHNlIHsKICAgIGVkZ2VbMF0gPSB2ZXJ0ZXg7CiAgfQp9CgovLyBMaWFuZ+KAk0JhcnNreSBsaW5lIGNsaXBwaW5nLgpmdW5jdGlvbiBjbGlwRWRnZShlZGdlLCB4MCwgeTAsIHgxLCB5MSkgewogIHZhciBhID0gZWRnZVswXSwKICAgICAgYiA9IGVkZ2VbMV0sCiAgICAgIGF4ID0gYVswXSwKICAgICAgYXkgPSBhWzFdLAogICAgICBieCA9IGJbMF0sCiAgICAgIGJ5ID0gYlsxXSwKICAgICAgdDAgPSAwLAogICAgICB0MSA9IDEsCiAgICAgIGR4ID0gYnggLSBheCwKICAgICAgZHkgPSBieSAtIGF5LAogICAgICByOwoKICByID0geDAgLSBheDsKICBpZiAoIWR4ICYmIHIgPiAwKSByZXR1cm47CiAgciAvPSBkeDsKICBpZiAoZHggPCAwKSB7CiAgICBpZiAociA8IHQwKSByZXR1cm47CiAgICBpZiAociA8IHQxKSB0MSA9IHI7CiAgfSBlbHNlIGlmIChkeCA+IDApIHsKICAgIGlmIChyID4gdDEpIHJldHVybjsKICAgIGlmIChyID4gdDApIHQwID0gcjsKICB9CgogIHIgPSB4MSAtIGF4OwogIGlmICghZHggJiYgciA8IDApIHJldHVybjsKICByIC89IGR4OwogIGlmIChkeCA8IDApIHsKICAgIGlmIChyID4gdDEpIHJldHVybjsKICAgIGlmIChyID4gdDApIHQwID0gcjsKICB9IGVsc2UgaWYgKGR4ID4gMCkgewogICAgaWYgKHIgPCB0MCkgcmV0dXJuOwogICAgaWYgKHIgPCB0MSkgdDEgPSByOwogIH0KCiAgciA9IHkwIC0gYXk7CiAgaWYgKCFkeSAmJiByID4gMCkgcmV0dXJuOwogIHIgLz0gZHk7CiAgaWYgKGR5IDwgMCkgewogICAgaWYgKHIgPCB0MCkgcmV0dXJuOwogICAgaWYgKHIgPCB0MSkgdDEgPSByOwogIH0gZWxzZSBpZiAoZHkgPiAwKSB7CiAgICBpZiAociA+IHQxKSByZXR1cm47CiAgICBpZiAociA+IHQwKSB0MCA9IHI7CiAgfQoKICByID0geTEgLSBheTsKICBpZiAoIWR5ICYmIHIgPCAwKSByZXR1cm47CiAgciAvPSBkeTsKICBpZiAoZHkgPCAwKSB7CiAgICBpZiAociA+IHQxKSByZXR1cm47CiAgICBpZiAociA+IHQwKSB0MCA9IHI7CiAgfSBlbHNlIGlmIChkeSA+IDApIHsKICAgIGlmIChyIDwgdDApIHJldHVybjsKICAgIGlmIChyIDwgdDEpIHQxID0gcjsKICB9CgogIGlmICghKHQwID4gMCkgJiYgISh0MSA8IDEpKSByZXR1cm4gdHJ1ZTsgLy8gVE9ETyBCZXR0ZXIgY2hlY2s/CgogIGlmICh0MCA+IDApIGVkZ2VbMF0gPSBbYXggKyB0MCAqIGR4LCBheSArIHQwICogZHldOwogIGlmICh0MSA8IDEpIGVkZ2VbMV0gPSBbYXggKyB0MSAqIGR4LCBheSArIHQxICogZHldOwogIHJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiBjb25uZWN0RWRnZShlZGdlLCB4MCwgeTAsIHgxLCB5MSkgewogIHZhciB2MSA9IGVkZ2VbMV07CiAgaWYgKHYxKSByZXR1cm4gdHJ1ZTsKCiAgdmFyIHYwID0gZWRnZVswXSwKICAgICAgbGVmdCA9IGVkZ2UubGVmdCwKICAgICAgcmlnaHQgPSBlZGdlLnJpZ2h0LAogICAgICBseCA9IGxlZnRbMF0sCiAgICAgIGx5ID0gbGVmdFsxXSwKICAgICAgcnggPSByaWdodFswXSwKICAgICAgcnkgPSByaWdodFsxXSwKICAgICAgZnggPSAobHggKyByeCkgLyAyLAogICAgICBmeSA9IChseSArIHJ5KSAvIDIsCiAgICAgIGZtLAogICAgICBmYjsKCiAgaWYgKHJ5ID09PSBseSkgewogICAgaWYgKGZ4IDwgeDAgfHwgZnggPj0geDEpIHJldHVybjsKICAgIGlmIChseCA+IHJ4KSB7CiAgICAgIGlmICghdjApIHYwID0gW2Z4LCB5MF07CiAgICAgIGVsc2UgaWYgKHYwWzFdID49IHkxKSByZXR1cm47CiAgICAgIHYxID0gW2Z4LCB5MV07CiAgICB9IGVsc2UgewogICAgICBpZiAoIXYwKSB2MCA9IFtmeCwgeTFdOwogICAgICBlbHNlIGlmICh2MFsxXSA8IHkwKSByZXR1cm47CiAgICAgIHYxID0gW2Z4LCB5MF07CiAgICB9CiAgfSBlbHNlIHsKICAgIGZtID0gKGx4IC0gcngpIC8gKHJ5IC0gbHkpOwogICAgZmIgPSBmeSAtIGZtICogZng7CiAgICBpZiAoZm0gPCAtMSB8fCBmbSA+IDEpIHsKICAgICAgaWYgKGx4ID4gcngpIHsKICAgICAgICBpZiAoIXYwKSB2MCA9IFsoeTAgLSBmYikgLyBmbSwgeTBdOwogICAgICAgIGVsc2UgaWYgKHYwWzFdID49IHkxKSByZXR1cm47CiAgICAgICAgdjEgPSBbKHkxIC0gZmIpIC8gZm0sIHkxXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXYwKSB2MCA9IFsoeTEgLSBmYikgLyBmbSwgeTFdOwogICAgICAgIGVsc2UgaWYgKHYwWzFdIDwgeTApIHJldHVybjsKICAgICAgICB2MSA9IFsoeTAgLSBmYikgLyBmbSwgeTBdOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZiAobHkgPCByeSkgewogICAgICAgIGlmICghdjApIHYwID0gW3gwLCBmbSAqIHgwICsgZmJdOwogICAgICAgIGVsc2UgaWYgKHYwWzBdID49IHgxKSByZXR1cm47CiAgICAgICAgdjEgPSBbeDEsIGZtICogeDEgKyBmYl07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF2MCkgdjAgPSBbeDEsIGZtICogeDEgKyBmYl07CiAgICAgICAgZWxzZSBpZiAodjBbMF0gPCB4MCkgcmV0dXJuOwogICAgICAgIHYxID0gW3gwLCBmbSAqIHgwICsgZmJdOwogICAgICB9CiAgICB9CiAgfQoKICBlZGdlWzBdID0gdjA7CiAgZWRnZVsxXSA9IHYxOwogIHJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiBjbGlwRWRnZXMoeDAsIHkwLCB4MSwgeTEpIHsKICB2YXIgaSA9IGVkZ2VzLmxlbmd0aCwKICAgICAgZWRnZTsKCiAgd2hpbGUgKGktLSkgewogICAgaWYgKCFjb25uZWN0RWRnZShlZGdlID0gZWRnZXNbaV0sIHgwLCB5MCwgeDEsIHkxKQogICAgICAgIHx8ICFjbGlwRWRnZShlZGdlLCB4MCwgeTAsIHgxLCB5MSkKICAgICAgICB8fCAhKE1hdGguYWJzKGVkZ2VbMF1bMF0gLSBlZGdlWzFdWzBdKSA+IGVwc2lsb24kNAogICAgICAgICAgICB8fCBNYXRoLmFicyhlZGdlWzBdWzFdIC0gZWRnZVsxXVsxXSkgPiBlcHNpbG9uJDQpKSB7CiAgICAgIGRlbGV0ZSBlZGdlc1tpXTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIGNyZWF0ZUNlbGwoc2l0ZSkgewogIHJldHVybiBjZWxsc1tzaXRlLmluZGV4XSA9IHsKICAgIHNpdGU6IHNpdGUsCiAgICBoYWxmZWRnZXM6IFtdCiAgfTsKfQoKZnVuY3Rpb24gY2VsbEhhbGZlZGdlQW5nbGUoY2VsbCwgZWRnZSkgewogIHZhciBzaXRlID0gY2VsbC5zaXRlLAogICAgICB2YSA9IGVkZ2UubGVmdCwKICAgICAgdmIgPSBlZGdlLnJpZ2h0OwogIGlmIChzaXRlID09PSB2YikgdmIgPSB2YSwgdmEgPSBzaXRlOwogIGlmICh2YikgcmV0dXJuIE1hdGguYXRhbjIodmJbMV0gLSB2YVsxXSwgdmJbMF0gLSB2YVswXSk7CiAgaWYgKHNpdGUgPT09IHZhKSB2YSA9IGVkZ2VbMV0sIHZiID0gZWRnZVswXTsKICBlbHNlIHZhID0gZWRnZVswXSwgdmIgPSBlZGdlWzFdOwogIHJldHVybiBNYXRoLmF0YW4yKHZhWzBdIC0gdmJbMF0sIHZiWzFdIC0gdmFbMV0pOwp9CgpmdW5jdGlvbiBjZWxsSGFsZmVkZ2VTdGFydChjZWxsLCBlZGdlKSB7CiAgcmV0dXJuIGVkZ2VbKyhlZGdlLmxlZnQgIT09IGNlbGwuc2l0ZSldOwp9CgpmdW5jdGlvbiBjZWxsSGFsZmVkZ2VFbmQoY2VsbCwgZWRnZSkgewogIHJldHVybiBlZGdlWysoZWRnZS5sZWZ0ID09PSBjZWxsLnNpdGUpXTsKfQoKZnVuY3Rpb24gc29ydENlbGxIYWxmZWRnZXMoKSB7CiAgZm9yICh2YXIgaSA9IDAsIG4gPSBjZWxscy5sZW5ndGgsIGNlbGwsIGhhbGZlZGdlcywgaiwgbTsgaSA8IG47ICsraSkgewogICAgaWYgKChjZWxsID0gY2VsbHNbaV0pICYmIChtID0gKGhhbGZlZGdlcyA9IGNlbGwuaGFsZmVkZ2VzKS5sZW5ndGgpKSB7CiAgICAgIHZhciBpbmRleCA9IG5ldyBBcnJheShtKSwKICAgICAgICAgIGFycmF5ID0gbmV3IEFycmF5KG0pOwogICAgICBmb3IgKGogPSAwOyBqIDwgbTsgKytqKSBpbmRleFtqXSA9IGosIGFycmF5W2pdID0gY2VsbEhhbGZlZGdlQW5nbGUoY2VsbCwgZWRnZXNbaGFsZmVkZ2VzW2pdXSk7CiAgICAgIGluZGV4LnNvcnQoZnVuY3Rpb24oaSwgaikgeyByZXR1cm4gYXJyYXlbal0gLSBhcnJheVtpXTsgfSk7CiAgICAgIGZvciAoaiA9IDA7IGogPCBtOyArK2opIGFycmF5W2pdID0gaGFsZmVkZ2VzW2luZGV4W2pdXTsKICAgICAgZm9yIChqID0gMDsgaiA8IG07ICsraikgaGFsZmVkZ2VzW2pdID0gYXJyYXlbal07CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBjbGlwQ2VsbHMoeDAsIHkwLCB4MSwgeTEpIHsKICB2YXIgbkNlbGxzID0gY2VsbHMubGVuZ3RoLAogICAgICBpQ2VsbCwKICAgICAgY2VsbCwKICAgICAgc2l0ZSwKICAgICAgaUhhbGZlZGdlLAogICAgICBoYWxmZWRnZXMsCiAgICAgIG5IYWxmZWRnZXMsCiAgICAgIHN0YXJ0LAogICAgICBzdGFydFgsCiAgICAgIHN0YXJ0WSwKICAgICAgZW5kLAogICAgICBlbmRYLAogICAgICBlbmRZLAogICAgICBjb3ZlciA9IHRydWU7CgogIGZvciAoaUNlbGwgPSAwOyBpQ2VsbCA8IG5DZWxsczsgKytpQ2VsbCkgewogICAgaWYgKGNlbGwgPSBjZWxsc1tpQ2VsbF0pIHsKICAgICAgc2l0ZSA9IGNlbGwuc2l0ZTsKICAgICAgaGFsZmVkZ2VzID0gY2VsbC5oYWxmZWRnZXM7CiAgICAgIGlIYWxmZWRnZSA9IGhhbGZlZGdlcy5sZW5ndGg7CgogICAgICAvLyBSZW1vdmUgYW55IGRhbmdsaW5nIGNsaXBwZWQgZWRnZXMuCiAgICAgIHdoaWxlIChpSGFsZmVkZ2UtLSkgewogICAgICAgIGlmICghZWRnZXNbaGFsZmVkZ2VzW2lIYWxmZWRnZV1dKSB7CiAgICAgICAgICBoYWxmZWRnZXMuc3BsaWNlKGlIYWxmZWRnZSwgMSk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBJbnNlcnQgYW55IGJvcmRlciBlZGdlcyBhcyBuZWNlc3NhcnkuCiAgICAgIGlIYWxmZWRnZSA9IDAsIG5IYWxmZWRnZXMgPSBoYWxmZWRnZXMubGVuZ3RoOwogICAgICB3aGlsZSAoaUhhbGZlZGdlIDwgbkhhbGZlZGdlcykgewogICAgICAgIGVuZCA9IGNlbGxIYWxmZWRnZUVuZChjZWxsLCBlZGdlc1toYWxmZWRnZXNbaUhhbGZlZGdlXV0pLCBlbmRYID0gZW5kWzBdLCBlbmRZID0gZW5kWzFdOwogICAgICAgIHN0YXJ0ID0gY2VsbEhhbGZlZGdlU3RhcnQoY2VsbCwgZWRnZXNbaGFsZmVkZ2VzWysraUhhbGZlZGdlICUgbkhhbGZlZGdlc11dKSwgc3RhcnRYID0gc3RhcnRbMF0sIHN0YXJ0WSA9IHN0YXJ0WzFdOwogICAgICAgIGlmIChNYXRoLmFicyhlbmRYIC0gc3RhcnRYKSA+IGVwc2lsb24kNCB8fCBNYXRoLmFicyhlbmRZIC0gc3RhcnRZKSA+IGVwc2lsb24kNCkgewogICAgICAgICAgaGFsZmVkZ2VzLnNwbGljZShpSGFsZmVkZ2UsIDAsIGVkZ2VzLnB1c2goY3JlYXRlQm9yZGVyRWRnZShzaXRlLCBlbmQsCiAgICAgICAgICAgICAgTWF0aC5hYnMoZW5kWCAtIHgwKSA8IGVwc2lsb24kNCAmJiB5MSAtIGVuZFkgPiBlcHNpbG9uJDQgPyBbeDAsIE1hdGguYWJzKHN0YXJ0WCAtIHgwKSA8IGVwc2lsb24kNCA/IHN0YXJ0WSA6IHkxXQogICAgICAgICAgICAgIDogTWF0aC5hYnMoZW5kWSAtIHkxKSA8IGVwc2lsb24kNCAmJiB4MSAtIGVuZFggPiBlcHNpbG9uJDQgPyBbTWF0aC5hYnMoc3RhcnRZIC0geTEpIDwgZXBzaWxvbiQ0ID8gc3RhcnRYIDogeDEsIHkxXQogICAgICAgICAgICAgIDogTWF0aC5hYnMoZW5kWCAtIHgxKSA8IGVwc2lsb24kNCAmJiBlbmRZIC0geTAgPiBlcHNpbG9uJDQgPyBbeDEsIE1hdGguYWJzKHN0YXJ0WCAtIHgxKSA8IGVwc2lsb24kNCA/IHN0YXJ0WSA6IHkwXQogICAgICAgICAgICAgIDogTWF0aC5hYnMoZW5kWSAtIHkwKSA8IGVwc2lsb24kNCAmJiBlbmRYIC0geDAgPiBlcHNpbG9uJDQgPyBbTWF0aC5hYnMoc3RhcnRZIC0geTApIDwgZXBzaWxvbiQ0ID8gc3RhcnRYIDogeDAsIHkwXQogICAgICAgICAgICAgIDogbnVsbCkpIC0gMSk7CiAgICAgICAgICArK25IYWxmZWRnZXM7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAobkhhbGZlZGdlcykgY292ZXIgPSBmYWxzZTsKICAgIH0KICB9CgogIC8vIElmIHRoZXJlIHdlcmVu4oCZdCBhbnkgZWRnZXMsIGhhdmUgdGhlIGNsb3Nlc3Qgc2l0ZSBjb3ZlciB0aGUgZXh0ZW50LgogIC8vIEl0IGRvZXNu4oCZdCBtYXR0ZXIgd2hpY2ggY29ybmVyIG9mIHRoZSBleHRlbnQgd2UgbWVhc3VyZSEKICBpZiAoY292ZXIpIHsKICAgIHZhciBkeCwgZHksIGQyLCBkYyA9IEluZmluaXR5OwoKICAgIGZvciAoaUNlbGwgPSAwLCBjb3ZlciA9IG51bGw7IGlDZWxsIDwgbkNlbGxzOyArK2lDZWxsKSB7CiAgICAgIGlmIChjZWxsID0gY2VsbHNbaUNlbGxdKSB7CiAgICAgICAgc2l0ZSA9IGNlbGwuc2l0ZTsKICAgICAgICBkeCA9IHNpdGVbMF0gLSB4MDsKICAgICAgICBkeSA9IHNpdGVbMV0gLSB5MDsKICAgICAgICBkMiA9IGR4ICogZHggKyBkeSAqIGR5OwogICAgICAgIGlmIChkMiA8IGRjKSBkYyA9IGQyLCBjb3ZlciA9IGNlbGw7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoY292ZXIpIHsKICAgICAgdmFyIHYwMCA9IFt4MCwgeTBdLCB2MDEgPSBbeDAsIHkxXSwgdjExID0gW3gxLCB5MV0sIHYxMCA9IFt4MSwgeTBdOwogICAgICBjb3Zlci5oYWxmZWRnZXMucHVzaCgKICAgICAgICBlZGdlcy5wdXNoKGNyZWF0ZUJvcmRlckVkZ2Uoc2l0ZSA9IGNvdmVyLnNpdGUsIHYwMCwgdjAxKSkgLSAxLAogICAgICAgIGVkZ2VzLnB1c2goY3JlYXRlQm9yZGVyRWRnZShzaXRlLCB2MDEsIHYxMSkpIC0gMSwKICAgICAgICBlZGdlcy5wdXNoKGNyZWF0ZUJvcmRlckVkZ2Uoc2l0ZSwgdjExLCB2MTApKSAtIDEsCiAgICAgICAgZWRnZXMucHVzaChjcmVhdGVCb3JkZXJFZGdlKHNpdGUsIHYxMCwgdjAwKSkgLSAxCiAgICAgICk7CiAgICB9CiAgfQoKICAvLyBMYXN0bHkgZGVsZXRlIGFueSBjZWxscyB3aXRoIG5vIGVkZ2VzOyB0aGVzZSB3ZXJlIGVudGlyZWx5IGNsaXBwZWQuCiAgZm9yIChpQ2VsbCA9IDA7IGlDZWxsIDwgbkNlbGxzOyArK2lDZWxsKSB7CiAgICBpZiAoY2VsbCA9IGNlbGxzW2lDZWxsXSkgewogICAgICBpZiAoIWNlbGwuaGFsZmVkZ2VzLmxlbmd0aCkgewogICAgICAgIGRlbGV0ZSBjZWxsc1tpQ2VsbF07CiAgICAgIH0KICAgIH0KICB9Cn0KCnZhciBjaXJjbGVQb29sID0gW107Cgp2YXIgZmlyc3RDaXJjbGU7CgpmdW5jdGlvbiBDaXJjbGUoKSB7CiAgUmVkQmxhY2tOb2RlKHRoaXMpOwogIHRoaXMueCA9CiAgdGhpcy55ID0KICB0aGlzLmFyYyA9CiAgdGhpcy5zaXRlID0KICB0aGlzLmN5ID0gbnVsbDsKfQoKZnVuY3Rpb24gYXR0YWNoQ2lyY2xlKGFyYykgewogIHZhciBsQXJjID0gYXJjLlAsCiAgICAgIHJBcmMgPSBhcmMuTjsKCiAgaWYgKCFsQXJjIHx8ICFyQXJjKSByZXR1cm47CgogIHZhciBsU2l0ZSA9IGxBcmMuc2l0ZSwKICAgICAgY1NpdGUgPSBhcmMuc2l0ZSwKICAgICAgclNpdGUgPSByQXJjLnNpdGU7CgogIGlmIChsU2l0ZSA9PT0gclNpdGUpIHJldHVybjsKCiAgdmFyIGJ4ID0gY1NpdGVbMF0sCiAgICAgIGJ5ID0gY1NpdGVbMV0sCiAgICAgIGF4ID0gbFNpdGVbMF0gLSBieCwKICAgICAgYXkgPSBsU2l0ZVsxXSAtIGJ5LAogICAgICBjeCA9IHJTaXRlWzBdIC0gYngsCiAgICAgIGN5ID0gclNpdGVbMV0gLSBieTsKCiAgdmFyIGQgPSAyICogKGF4ICogY3kgLSBheSAqIGN4KTsKICBpZiAoZCA+PSAtZXBzaWxvbjIkMikgcmV0dXJuOwoKICB2YXIgaGEgPSBheCAqIGF4ICsgYXkgKiBheSwKICAgICAgaGMgPSBjeCAqIGN4ICsgY3kgKiBjeSwKICAgICAgeCA9IChjeSAqIGhhIC0gYXkgKiBoYykgLyBkLAogICAgICB5ID0gKGF4ICogaGMgLSBjeCAqIGhhKSAvIGQ7CgogIHZhciBjaXJjbGUgPSBjaXJjbGVQb29sLnBvcCgpIHx8IG5ldyBDaXJjbGU7CiAgY2lyY2xlLmFyYyA9IGFyYzsKICBjaXJjbGUuc2l0ZSA9IGNTaXRlOwogIGNpcmNsZS54ID0geCArIGJ4OwogIGNpcmNsZS55ID0gKGNpcmNsZS5jeSA9IHkgKyBieSkgKyBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSk7IC8vIHkgYm90dG9tCgogIGFyYy5jaXJjbGUgPSBjaXJjbGU7CgogIHZhciBiZWZvcmUgPSBudWxsLAogICAgICBub2RlID0gY2lyY2xlcy5fOwoKICB3aGlsZSAobm9kZSkgewogICAgaWYgKGNpcmNsZS55IDwgbm9kZS55IHx8IChjaXJjbGUueSA9PT0gbm9kZS55ICYmIGNpcmNsZS54IDw9IG5vZGUueCkpIHsKICAgICAgaWYgKG5vZGUuTCkgbm9kZSA9IG5vZGUuTDsKICAgICAgZWxzZSB7IGJlZm9yZSA9IG5vZGUuUDsgYnJlYWs7IH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChub2RlLlIpIG5vZGUgPSBub2RlLlI7CiAgICAgIGVsc2UgeyBiZWZvcmUgPSBub2RlOyBicmVhazsgfQogICAgfQogIH0KCiAgY2lyY2xlcy5pbnNlcnQoYmVmb3JlLCBjaXJjbGUpOwogIGlmICghYmVmb3JlKSBmaXJzdENpcmNsZSA9IGNpcmNsZTsKfQoKZnVuY3Rpb24gZGV0YWNoQ2lyY2xlKGFyYykgewogIHZhciBjaXJjbGUgPSBhcmMuY2lyY2xlOwogIGlmIChjaXJjbGUpIHsKICAgIGlmICghY2lyY2xlLlApIGZpcnN0Q2lyY2xlID0gY2lyY2xlLk47CiAgICBjaXJjbGVzLnJlbW92ZShjaXJjbGUpOwogICAgY2lyY2xlUG9vbC5wdXNoKGNpcmNsZSk7CiAgICBSZWRCbGFja05vZGUoY2lyY2xlKTsKICAgIGFyYy5jaXJjbGUgPSBudWxsOwogIH0KfQoKdmFyIGJlYWNoUG9vbCA9IFtdOwoKZnVuY3Rpb24gQmVhY2goKSB7CiAgUmVkQmxhY2tOb2RlKHRoaXMpOwogIHRoaXMuZWRnZSA9CiAgdGhpcy5zaXRlID0KICB0aGlzLmNpcmNsZSA9IG51bGw7Cn0KCmZ1bmN0aW9uIGNyZWF0ZUJlYWNoKHNpdGUpIHsKICB2YXIgYmVhY2ggPSBiZWFjaFBvb2wucG9wKCkgfHwgbmV3IEJlYWNoOwogIGJlYWNoLnNpdGUgPSBzaXRlOwogIHJldHVybiBiZWFjaDsKfQoKZnVuY3Rpb24gZGV0YWNoQmVhY2goYmVhY2gpIHsKICBkZXRhY2hDaXJjbGUoYmVhY2gpOwogIGJlYWNoZXMucmVtb3ZlKGJlYWNoKTsKICBiZWFjaFBvb2wucHVzaChiZWFjaCk7CiAgUmVkQmxhY2tOb2RlKGJlYWNoKTsKfQoKZnVuY3Rpb24gcmVtb3ZlQmVhY2goYmVhY2gpIHsKICB2YXIgY2lyY2xlID0gYmVhY2guY2lyY2xlLAogICAgICB4ID0gY2lyY2xlLngsCiAgICAgIHkgPSBjaXJjbGUuY3ksCiAgICAgIHZlcnRleCA9IFt4LCB5XSwKICAgICAgcHJldmlvdXMgPSBiZWFjaC5QLAogICAgICBuZXh0ID0gYmVhY2guTiwKICAgICAgZGlzYXBwZWFyaW5nID0gW2JlYWNoXTsKCiAgZGV0YWNoQmVhY2goYmVhY2gpOwoKICB2YXIgbEFyYyA9IHByZXZpb3VzOwogIHdoaWxlIChsQXJjLmNpcmNsZQogICAgICAmJiBNYXRoLmFicyh4IC0gbEFyYy5jaXJjbGUueCkgPCBlcHNpbG9uJDQKICAgICAgJiYgTWF0aC5hYnMoeSAtIGxBcmMuY2lyY2xlLmN5KSA8IGVwc2lsb24kNCkgewogICAgcHJldmlvdXMgPSBsQXJjLlA7CiAgICBkaXNhcHBlYXJpbmcudW5zaGlmdChsQXJjKTsKICAgIGRldGFjaEJlYWNoKGxBcmMpOwogICAgbEFyYyA9IHByZXZpb3VzOwogIH0KCiAgZGlzYXBwZWFyaW5nLnVuc2hpZnQobEFyYyk7CiAgZGV0YWNoQ2lyY2xlKGxBcmMpOwoKICB2YXIgckFyYyA9IG5leHQ7CiAgd2hpbGUgKHJBcmMuY2lyY2xlCiAgICAgICYmIE1hdGguYWJzKHggLSByQXJjLmNpcmNsZS54KSA8IGVwc2lsb24kNAogICAgICAmJiBNYXRoLmFicyh5IC0gckFyYy5jaXJjbGUuY3kpIDwgZXBzaWxvbiQ0KSB7CiAgICBuZXh0ID0gckFyYy5OOwogICAgZGlzYXBwZWFyaW5nLnB1c2gockFyYyk7CiAgICBkZXRhY2hCZWFjaChyQXJjKTsKICAgIHJBcmMgPSBuZXh0OwogIH0KCiAgZGlzYXBwZWFyaW5nLnB1c2gockFyYyk7CiAgZGV0YWNoQ2lyY2xlKHJBcmMpOwoKICB2YXIgbkFyY3MgPSBkaXNhcHBlYXJpbmcubGVuZ3RoLAogICAgICBpQXJjOwogIGZvciAoaUFyYyA9IDE7IGlBcmMgPCBuQXJjczsgKytpQXJjKSB7CiAgICByQXJjID0gZGlzYXBwZWFyaW5nW2lBcmNdOwogICAgbEFyYyA9IGRpc2FwcGVhcmluZ1tpQXJjIC0gMV07CiAgICBzZXRFZGdlRW5kKHJBcmMuZWRnZSwgbEFyYy5zaXRlLCByQXJjLnNpdGUsIHZlcnRleCk7CiAgfQoKICBsQXJjID0gZGlzYXBwZWFyaW5nWzBdOwogIHJBcmMgPSBkaXNhcHBlYXJpbmdbbkFyY3MgLSAxXTsKICByQXJjLmVkZ2UgPSBjcmVhdGVFZGdlKGxBcmMuc2l0ZSwgckFyYy5zaXRlLCBudWxsLCB2ZXJ0ZXgpOwoKICBhdHRhY2hDaXJjbGUobEFyYyk7CiAgYXR0YWNoQ2lyY2xlKHJBcmMpOwp9CgpmdW5jdGlvbiBhZGRCZWFjaChzaXRlKSB7CiAgdmFyIHggPSBzaXRlWzBdLAogICAgICBkaXJlY3RyaXggPSBzaXRlWzFdLAogICAgICBsQXJjLAogICAgICByQXJjLAogICAgICBkeGwsCiAgICAgIGR4ciwKICAgICAgbm9kZSA9IGJlYWNoZXMuXzsKCiAgd2hpbGUgKG5vZGUpIHsKICAgIGR4bCA9IGxlZnRCcmVha1BvaW50KG5vZGUsIGRpcmVjdHJpeCkgLSB4OwogICAgaWYgKGR4bCA+IGVwc2lsb24kNCkgbm9kZSA9IG5vZGUuTDsgZWxzZSB7CiAgICAgIGR4ciA9IHggLSByaWdodEJyZWFrUG9pbnQobm9kZSwgZGlyZWN0cml4KTsKICAgICAgaWYgKGR4ciA+IGVwc2lsb24kNCkgewogICAgICAgIGlmICghbm9kZS5SKSB7CiAgICAgICAgICBsQXJjID0gbm9kZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBub2RlID0gbm9kZS5SOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChkeGwgPiAtZXBzaWxvbiQ0KSB7CiAgICAgICAgICBsQXJjID0gbm9kZS5QOwogICAgICAgICAgckFyYyA9IG5vZGU7CiAgICAgICAgfSBlbHNlIGlmIChkeHIgPiAtZXBzaWxvbiQ0KSB7CiAgICAgICAgICBsQXJjID0gbm9kZTsKICAgICAgICAgIHJBcmMgPSBub2RlLk47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxBcmMgPSByQXJjID0gbm9kZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9CgogIGNyZWF0ZUNlbGwoc2l0ZSk7CiAgdmFyIG5ld0FyYyA9IGNyZWF0ZUJlYWNoKHNpdGUpOwogIGJlYWNoZXMuaW5zZXJ0KGxBcmMsIG5ld0FyYyk7CgogIGlmICghbEFyYyAmJiAhckFyYykgcmV0dXJuOwoKICBpZiAobEFyYyA9PT0gckFyYykgewogICAgZGV0YWNoQ2lyY2xlKGxBcmMpOwogICAgckFyYyA9IGNyZWF0ZUJlYWNoKGxBcmMuc2l0ZSk7CiAgICBiZWFjaGVzLmluc2VydChuZXdBcmMsIHJBcmMpOwogICAgbmV3QXJjLmVkZ2UgPSByQXJjLmVkZ2UgPSBjcmVhdGVFZGdlKGxBcmMuc2l0ZSwgbmV3QXJjLnNpdGUpOwogICAgYXR0YWNoQ2lyY2xlKGxBcmMpOwogICAgYXR0YWNoQ2lyY2xlKHJBcmMpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKCFyQXJjKSB7IC8vICYmIGxBcmMKICAgIG5ld0FyYy5lZGdlID0gY3JlYXRlRWRnZShsQXJjLnNpdGUsIG5ld0FyYy5zaXRlKTsKICAgIHJldHVybjsKICB9CgogIC8vIGVsc2UgbEFyYyAhPT0gckFyYwogIGRldGFjaENpcmNsZShsQXJjKTsKICBkZXRhY2hDaXJjbGUockFyYyk7CgogIHZhciBsU2l0ZSA9IGxBcmMuc2l0ZSwKICAgICAgYXggPSBsU2l0ZVswXSwKICAgICAgYXkgPSBsU2l0ZVsxXSwKICAgICAgYnggPSBzaXRlWzBdIC0gYXgsCiAgICAgIGJ5ID0gc2l0ZVsxXSAtIGF5LAogICAgICByU2l0ZSA9IHJBcmMuc2l0ZSwKICAgICAgY3ggPSByU2l0ZVswXSAtIGF4LAogICAgICBjeSA9IHJTaXRlWzFdIC0gYXksCiAgICAgIGQgPSAyICogKGJ4ICogY3kgLSBieSAqIGN4KSwKICAgICAgaGIgPSBieCAqIGJ4ICsgYnkgKiBieSwKICAgICAgaGMgPSBjeCAqIGN4ICsgY3kgKiBjeSwKICAgICAgdmVydGV4ID0gWyhjeSAqIGhiIC0gYnkgKiBoYykgLyBkICsgYXgsIChieCAqIGhjIC0gY3ggKiBoYikgLyBkICsgYXldOwoKICBzZXRFZGdlRW5kKHJBcmMuZWRnZSwgbFNpdGUsIHJTaXRlLCB2ZXJ0ZXgpOwogIG5ld0FyYy5lZGdlID0gY3JlYXRlRWRnZShsU2l0ZSwgc2l0ZSwgbnVsbCwgdmVydGV4KTsKICByQXJjLmVkZ2UgPSBjcmVhdGVFZGdlKHNpdGUsIHJTaXRlLCBudWxsLCB2ZXJ0ZXgpOwogIGF0dGFjaENpcmNsZShsQXJjKTsKICBhdHRhY2hDaXJjbGUockFyYyk7Cn0KCmZ1bmN0aW9uIGxlZnRCcmVha1BvaW50KGFyYywgZGlyZWN0cml4KSB7CiAgdmFyIHNpdGUgPSBhcmMuc2l0ZSwKICAgICAgcmZvY3ggPSBzaXRlWzBdLAogICAgICByZm9jeSA9IHNpdGVbMV0sCiAgICAgIHBieTIgPSByZm9jeSAtIGRpcmVjdHJpeDsKCiAgaWYgKCFwYnkyKSByZXR1cm4gcmZvY3g7CgogIHZhciBsQXJjID0gYXJjLlA7CiAgaWYgKCFsQXJjKSByZXR1cm4gLUluZmluaXR5OwoKICBzaXRlID0gbEFyYy5zaXRlOwogIHZhciBsZm9jeCA9IHNpdGVbMF0sCiAgICAgIGxmb2N5ID0gc2l0ZVsxXSwKICAgICAgcGxieTIgPSBsZm9jeSAtIGRpcmVjdHJpeDsKCiAgaWYgKCFwbGJ5MikgcmV0dXJuIGxmb2N4OwoKICB2YXIgaGwgPSBsZm9jeCAtIHJmb2N4LAogICAgICBhYnkyID0gMSAvIHBieTIgLSAxIC8gcGxieTIsCiAgICAgIGIgPSBobCAvIHBsYnkyOwoKICBpZiAoYWJ5MikgcmV0dXJuICgtYiArIE1hdGguc3FydChiICogYiAtIDIgKiBhYnkyICogKGhsICogaGwgLyAoLTIgKiBwbGJ5MikgLSBsZm9jeSArIHBsYnkyIC8gMiArIHJmb2N5IC0gcGJ5MiAvIDIpKSkgLyBhYnkyICsgcmZvY3g7CgogIHJldHVybiAocmZvY3ggKyBsZm9jeCkgLyAyOwp9CgpmdW5jdGlvbiByaWdodEJyZWFrUG9pbnQoYXJjLCBkaXJlY3RyaXgpIHsKICB2YXIgckFyYyA9IGFyYy5OOwogIGlmIChyQXJjKSByZXR1cm4gbGVmdEJyZWFrUG9pbnQockFyYywgZGlyZWN0cml4KTsKICB2YXIgc2l0ZSA9IGFyYy5zaXRlOwogIHJldHVybiBzaXRlWzFdID09PSBkaXJlY3RyaXggPyBzaXRlWzBdIDogSW5maW5pdHk7Cn0KCnZhciBlcHNpbG9uJDQgPSAxZS02Owp2YXIgZXBzaWxvbjIkMiA9IDFlLTEyOwp2YXIgYmVhY2hlczsKdmFyIGNlbGxzOwp2YXIgY2lyY2xlczsKdmFyIGVkZ2VzOwoKZnVuY3Rpb24gdHJpYW5nbGVBcmVhKGEsIGIsIGMpIHsKICByZXR1cm4gKGFbMF0gLSBjWzBdKSAqIChiWzFdIC0gYVsxXSkgLSAoYVswXSAtIGJbMF0pICogKGNbMV0gLSBhWzFdKTsKfQoKZnVuY3Rpb24gbGV4aWNvZ3JhcGhpYyhhLCBiKSB7CiAgcmV0dXJuIGJbMV0gLSBhWzFdCiAgICAgIHx8IGJbMF0gLSBhWzBdOwp9CgpmdW5jdGlvbiBEaWFncmFtKHNpdGVzLCBleHRlbnQpIHsKICB2YXIgc2l0ZSA9IHNpdGVzLnNvcnQobGV4aWNvZ3JhcGhpYykucG9wKCksCiAgICAgIHgsCiAgICAgIHksCiAgICAgIGNpcmNsZTsKCiAgZWRnZXMgPSBbXTsKICBjZWxscyA9IG5ldyBBcnJheShzaXRlcy5sZW5ndGgpOwogIGJlYWNoZXMgPSBuZXcgUmVkQmxhY2tUcmVlOwogIGNpcmNsZXMgPSBuZXcgUmVkQmxhY2tUcmVlOwoKICB3aGlsZSAodHJ1ZSkgewogICAgY2lyY2xlID0gZmlyc3RDaXJjbGU7CiAgICBpZiAoc2l0ZSAmJiAoIWNpcmNsZSB8fCBzaXRlWzFdIDwgY2lyY2xlLnkgfHwgKHNpdGVbMV0gPT09IGNpcmNsZS55ICYmIHNpdGVbMF0gPCBjaXJjbGUueCkpKSB7CiAgICAgIGlmIChzaXRlWzBdICE9PSB4IHx8IHNpdGVbMV0gIT09IHkpIHsKICAgICAgICBhZGRCZWFjaChzaXRlKTsKICAgICAgICB4ID0gc2l0ZVswXSwgeSA9IHNpdGVbMV07CiAgICAgIH0KICAgICAgc2l0ZSA9IHNpdGVzLnBvcCgpOwogICAgfSBlbHNlIGlmIChjaXJjbGUpIHsKICAgICAgcmVtb3ZlQmVhY2goY2lyY2xlLmFyYyk7CiAgICB9IGVsc2UgewogICAgICBicmVhazsKICAgIH0KICB9CgogIHNvcnRDZWxsSGFsZmVkZ2VzKCk7CgogIGlmIChleHRlbnQpIHsKICAgIHZhciB4MCA9ICtleHRlbnRbMF1bMF0sCiAgICAgICAgeTAgPSArZXh0ZW50WzBdWzFdLAogICAgICAgIHgxID0gK2V4dGVudFsxXVswXSwKICAgICAgICB5MSA9ICtleHRlbnRbMV1bMV07CiAgICBjbGlwRWRnZXMoeDAsIHkwLCB4MSwgeTEpOwogICAgY2xpcENlbGxzKHgwLCB5MCwgeDEsIHkxKTsKICB9CgogIHRoaXMuZWRnZXMgPSBlZGdlczsKICB0aGlzLmNlbGxzID0gY2VsbHM7CgogIGJlYWNoZXMgPQogIGNpcmNsZXMgPQogIGVkZ2VzID0KICBjZWxscyA9IG51bGw7Cn0KCkRpYWdyYW0ucHJvdG90eXBlID0gewogIGNvbnN0cnVjdG9yOiBEaWFncmFtLAoKICBwb2x5Z29uczogZnVuY3Rpb24oKSB7CiAgICB2YXIgZWRnZXMgPSB0aGlzLmVkZ2VzOwoKICAgIHJldHVybiB0aGlzLmNlbGxzLm1hcChmdW5jdGlvbihjZWxsKSB7CiAgICAgIHZhciBwb2x5Z29uID0gY2VsbC5oYWxmZWRnZXMubWFwKGZ1bmN0aW9uKGkpIHsgcmV0dXJuIGNlbGxIYWxmZWRnZVN0YXJ0KGNlbGwsIGVkZ2VzW2ldKTsgfSk7CiAgICAgIHBvbHlnb24uZGF0YSA9IGNlbGwuc2l0ZS5kYXRhOwogICAgICByZXR1cm4gcG9seWdvbjsKICAgIH0pOwogIH0sCgogIHRyaWFuZ2xlczogZnVuY3Rpb24oKSB7CiAgICB2YXIgdHJpYW5nbGVzID0gW10sCiAgICAgICAgZWRnZXMgPSB0aGlzLmVkZ2VzOwoKICAgIHRoaXMuY2VsbHMuZm9yRWFjaChmdW5jdGlvbihjZWxsLCBpKSB7CiAgICAgIGlmICghKG0gPSAoaGFsZmVkZ2VzID0gY2VsbC5oYWxmZWRnZXMpLmxlbmd0aCkpIHJldHVybjsKICAgICAgdmFyIHNpdGUgPSBjZWxsLnNpdGUsCiAgICAgICAgICBoYWxmZWRnZXMsCiAgICAgICAgICBqID0gLTEsCiAgICAgICAgICBtLAogICAgICAgICAgczAsCiAgICAgICAgICBlMSA9IGVkZ2VzW2hhbGZlZGdlc1ttIC0gMV1dLAogICAgICAgICAgczEgPSBlMS5sZWZ0ID09PSBzaXRlID8gZTEucmlnaHQgOiBlMS5sZWZ0OwoKICAgICAgd2hpbGUgKCsraiA8IG0pIHsKICAgICAgICBzMCA9IHMxOwogICAgICAgIGUxID0gZWRnZXNbaGFsZmVkZ2VzW2pdXTsKICAgICAgICBzMSA9IGUxLmxlZnQgPT09IHNpdGUgPyBlMS5yaWdodCA6IGUxLmxlZnQ7CiAgICAgICAgaWYgKHMwICYmIHMxICYmIGkgPCBzMC5pbmRleCAmJiBpIDwgczEuaW5kZXggJiYgdHJpYW5nbGVBcmVhKHNpdGUsIHMwLCBzMSkgPCAwKSB7CiAgICAgICAgICB0cmlhbmdsZXMucHVzaChbc2l0ZS5kYXRhLCBzMC5kYXRhLCBzMS5kYXRhXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gdHJpYW5nbGVzOwogIH0sCgogIGxpbmtzOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLmVkZ2VzLmZpbHRlcihmdW5jdGlvbihlZGdlKSB7CiAgICAgIHJldHVybiBlZGdlLnJpZ2h0OwogICAgfSkubWFwKGZ1bmN0aW9uKGVkZ2UpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBzb3VyY2U6IGVkZ2UubGVmdC5kYXRhLAogICAgICAgIHRhcmdldDogZWRnZS5yaWdodC5kYXRhCiAgICAgIH07CiAgICB9KTsKICB9LAoKICBmaW5kOiBmdW5jdGlvbih4LCB5LCByYWRpdXMpIHsKICAgIHZhciB0aGF0ID0gdGhpcywgaTAsIGkxID0gdGhhdC5fZm91bmQgfHwgMCwgbiA9IHRoYXQuY2VsbHMubGVuZ3RoLCBjZWxsOwoKICAgIC8vIFVzZSB0aGUgcHJldmlvdXNseS1mb3VuZCBjZWxsLCBvciBzdGFydCB3aXRoIGFuIGFyYml0cmFyeSBvbmUuCiAgICB3aGlsZSAoIShjZWxsID0gdGhhdC5jZWxsc1tpMV0pKSBpZiAoKytpMSA+PSBuKSByZXR1cm4gbnVsbDsKICAgIHZhciBkeCA9IHggLSBjZWxsLnNpdGVbMF0sIGR5ID0geSAtIGNlbGwuc2l0ZVsxXSwgZDIgPSBkeCAqIGR4ICsgZHkgKiBkeTsKCiAgICAvLyBUcmF2ZXJzZSB0aGUgaGFsZi1lZGdlcyB0byBmaW5kIGEgY2xvc2VyIGNlbGwsIGlmIGFueS4KICAgIGRvIHsKICAgICAgY2VsbCA9IHRoYXQuY2VsbHNbaTAgPSBpMV0sIGkxID0gbnVsbDsKICAgICAgY2VsbC5oYWxmZWRnZXMuZm9yRWFjaChmdW5jdGlvbihlKSB7CiAgICAgICAgdmFyIGVkZ2UgPSB0aGF0LmVkZ2VzW2VdLCB2ID0gZWRnZS5sZWZ0OwogICAgICAgIGlmICgodiA9PT0gY2VsbC5zaXRlIHx8ICF2KSAmJiAhKHYgPSBlZGdlLnJpZ2h0KSkgcmV0dXJuOwogICAgICAgIHZhciB2eCA9IHggLSB2WzBdLCB2eSA9IHkgLSB2WzFdLCB2MiA9IHZ4ICogdnggKyB2eSAqIHZ5OwogICAgICAgIGlmICh2MiA8IGQyKSBkMiA9IHYyLCBpMSA9IHYuaW5kZXg7CiAgICAgIH0pOwogICAgfSB3aGlsZSAoaTEgIT09IG51bGwpOwoKICAgIHRoYXQuX2ZvdW5kID0gaTA7CgogICAgcmV0dXJuIHJhZGl1cyA9PSBudWxsIHx8IGQyIDw9IHJhZGl1cyAqIHJhZGl1cyA/IGNlbGwuc2l0ZSA6IG51bGw7CiAgfQp9OwoKZnVuY3Rpb24gdm9yb25vaSgpIHsKICB2YXIgeCQkMSA9IHgkNCwKICAgICAgeSQkMSA9IHkkNCwKICAgICAgZXh0ZW50ID0gbnVsbDsKCiAgZnVuY3Rpb24gdm9yb25vaShkYXRhKSB7CiAgICByZXR1cm4gbmV3IERpYWdyYW0oZGF0YS5tYXAoZnVuY3Rpb24oZCwgaSkgewogICAgICB2YXIgcyA9IFtNYXRoLnJvdW5kKHgkJDEoZCwgaSwgZGF0YSkgLyBlcHNpbG9uJDQpICogZXBzaWxvbiQ0LCBNYXRoLnJvdW5kKHkkJDEoZCwgaSwgZGF0YSkgLyBlcHNpbG9uJDQpICogZXBzaWxvbiQ0XTsKICAgICAgcy5pbmRleCA9IGk7CiAgICAgIHMuZGF0YSA9IGQ7CiAgICAgIHJldHVybiBzOwogICAgfSksIGV4dGVudCk7CiAgfQoKICB2b3Jvbm9pLnBvbHlnb25zID0gZnVuY3Rpb24oZGF0YSkgewogICAgcmV0dXJuIHZvcm9ub2koZGF0YSkucG9seWdvbnMoKTsKICB9OwoKICB2b3Jvbm9pLmxpbmtzID0gZnVuY3Rpb24oZGF0YSkgewogICAgcmV0dXJuIHZvcm9ub2koZGF0YSkubGlua3MoKTsKICB9OwoKICB2b3Jvbm9pLnRyaWFuZ2xlcyA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgIHJldHVybiB2b3Jvbm9pKGRhdGEpLnRyaWFuZ2xlcygpOwogIH07CgogIHZvcm9ub2kueCA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHgkJDEgPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQxMigrXyksIHZvcm9ub2kpIDogeCQkMTsKICB9OwoKICB2b3Jvbm9pLnkgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh5JCQxID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMTIoK18pLCB2b3Jvbm9pKSA6IHkkJDE7CiAgfTsKCiAgdm9yb25vaS5leHRlbnQgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChleHRlbnQgPSBfID09IG51bGwgPyBudWxsIDogW1srX1swXVswXSwgK19bMF1bMV1dLCBbK19bMV1bMF0sICtfWzFdWzFdXV0sIHZvcm9ub2kpIDogZXh0ZW50ICYmIFtbZXh0ZW50WzBdWzBdLCBleHRlbnRbMF1bMV1dLCBbZXh0ZW50WzFdWzBdLCBleHRlbnRbMV1bMV1dXTsKICB9OwoKICB2b3Jvbm9pLnNpemUgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChleHRlbnQgPSBfID09IG51bGwgPyBudWxsIDogW1swLCAwXSwgWytfWzBdLCArX1sxXV1dLCB2b3Jvbm9pKSA6IGV4dGVudCAmJiBbZXh0ZW50WzFdWzBdIC0gZXh0ZW50WzBdWzBdLCBleHRlbnRbMV1bMV0gLSBleHRlbnRbMF1bMV1dOwogIH07CgogIHJldHVybiB2b3Jvbm9pOwp9CgpmdW5jdGlvbiBjb25zdGFudCQxMyh4KSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHg7CiAgfTsKfQoKZnVuY3Rpb24gWm9vbUV2ZW50KHRhcmdldCwgdHlwZSwgdHJhbnNmb3JtKSB7CiAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7CiAgdGhpcy50eXBlID0gdHlwZTsKICB0aGlzLnRyYW5zZm9ybSA9IHRyYW5zZm9ybTsKfQoKZnVuY3Rpb24gVHJhbnNmb3JtKGssIHgsIHkpIHsKICB0aGlzLmsgPSBrOwogIHRoaXMueCA9IHg7CiAgdGhpcy55ID0geTsKfQoKVHJhbnNmb3JtLnByb3RvdHlwZSA9IHsKICBjb25zdHJ1Y3RvcjogVHJhbnNmb3JtLAogIHNjYWxlOiBmdW5jdGlvbihrKSB7CiAgICByZXR1cm4gayA9PT0gMSA/IHRoaXMgOiBuZXcgVHJhbnNmb3JtKHRoaXMuayAqIGssIHRoaXMueCwgdGhpcy55KTsKICB9LAogIHRyYW5zbGF0ZTogZnVuY3Rpb24oeCwgeSkgewogICAgcmV0dXJuIHggPT09IDAgJiB5ID09PSAwID8gdGhpcyA6IG5ldyBUcmFuc2Zvcm0odGhpcy5rLCB0aGlzLnggKyB0aGlzLmsgKiB4LCB0aGlzLnkgKyB0aGlzLmsgKiB5KTsKICB9LAogIGFwcGx5OiBmdW5jdGlvbihwb2ludCkgewogICAgcmV0dXJuIFtwb2ludFswXSAqIHRoaXMuayArIHRoaXMueCwgcG9pbnRbMV0gKiB0aGlzLmsgKyB0aGlzLnldOwogIH0sCiAgYXBwbHlYOiBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4geCAqIHRoaXMuayArIHRoaXMueDsKICB9LAogIGFwcGx5WTogZnVuY3Rpb24oeSkgewogICAgcmV0dXJuIHkgKiB0aGlzLmsgKyB0aGlzLnk7CiAgfSwKICBpbnZlcnQ6IGZ1bmN0aW9uKGxvY2F0aW9uKSB7CiAgICByZXR1cm4gWyhsb2NhdGlvblswXSAtIHRoaXMueCkgLyB0aGlzLmssIChsb2NhdGlvblsxXSAtIHRoaXMueSkgLyB0aGlzLmtdOwogIH0sCiAgaW52ZXJ0WDogZnVuY3Rpb24oeCkgewogICAgcmV0dXJuICh4IC0gdGhpcy54KSAvIHRoaXMuazsKICB9LAogIGludmVydFk6IGZ1bmN0aW9uKHkpIHsKICAgIHJldHVybiAoeSAtIHRoaXMueSkgLyB0aGlzLms7CiAgfSwKICByZXNjYWxlWDogZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIHguY29weSgpLmRvbWFpbih4LnJhbmdlKCkubWFwKHRoaXMuaW52ZXJ0WCwgdGhpcykubWFwKHguaW52ZXJ0LCB4KSk7CiAgfSwKICByZXNjYWxlWTogZnVuY3Rpb24oeSkgewogICAgcmV0dXJuIHkuY29weSgpLmRvbWFpbih5LnJhbmdlKCkubWFwKHRoaXMuaW52ZXJ0WSwgdGhpcykubWFwKHkuaW52ZXJ0LCB5KSk7CiAgfSwKICB0b1N0cmluZzogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gInRyYW5zbGF0ZSgiICsgdGhpcy54ICsgIiwiICsgdGhpcy55ICsgIikgc2NhbGUoIiArIHRoaXMuayArICIpIjsKICB9Cn07Cgp2YXIgaWRlbnRpdHkkOCA9IG5ldyBUcmFuc2Zvcm0oMSwgMCwgMCk7Cgp0cmFuc2Zvcm0kMS5wcm90b3R5cGUgPSBUcmFuc2Zvcm0ucHJvdG90eXBlOwoKZnVuY3Rpb24gdHJhbnNmb3JtJDEobm9kZSkgewogIHJldHVybiBub2RlLl9fem9vbSB8fCBpZGVudGl0eSQ4Owp9CgpmdW5jdGlvbiBub3Byb3BhZ2F0aW9uJDIoKSB7CiAgZXhwb3J0cy5ldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKfQoKZnVuY3Rpb24gbm9ldmVudCQyKCkgewogIGV4cG9ydHMuZXZlbnQucHJldmVudERlZmF1bHQoKTsKICBleHBvcnRzLmV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwp9CgovLyBJZ25vcmUgcmlnaHQtY2xpY2ssIHNpbmNlIHRoYXQgc2hvdWxkIG9wZW4gdGhlIGNvbnRleHQgbWVudS4KZnVuY3Rpb24gZGVmYXVsdEZpbHRlciQyKCkgewogIHJldHVybiAhZXhwb3J0cy5ldmVudC5idXR0b247Cn0KCmZ1bmN0aW9uIGRlZmF1bHRFeHRlbnQkMSgpIHsKICB2YXIgZSA9IHRoaXMsIHcsIGg7CiAgaWYgKGUgaW5zdGFuY2VvZiBTVkdFbGVtZW50KSB7CiAgICBlID0gZS5vd25lclNWR0VsZW1lbnQgfHwgZTsKICAgIHcgPSBlLndpZHRoLmJhc2VWYWwudmFsdWU7CiAgICBoID0gZS5oZWlnaHQuYmFzZVZhbC52YWx1ZTsKICB9IGVsc2UgewogICAgdyA9IGUuY2xpZW50V2lkdGg7CiAgICBoID0gZS5jbGllbnRIZWlnaHQ7CiAgfQogIHJldHVybiBbWzAsIDBdLCBbdywgaF1dOwp9CgpmdW5jdGlvbiBkZWZhdWx0VHJhbnNmb3JtKCkgewogIHJldHVybiB0aGlzLl9fem9vbSB8fCBpZGVudGl0eSQ4Owp9CgpmdW5jdGlvbiBkZWZhdWx0V2hlZWxEZWx0YSgpIHsKICByZXR1cm4gLWV4cG9ydHMuZXZlbnQuZGVsdGFZICogKGV4cG9ydHMuZXZlbnQuZGVsdGFNb2RlID8gMTIwIDogMSkgLyA1MDA7Cn0KCmZ1bmN0aW9uIGRlZmF1bHRUb3VjaGFibGUkMSgpIHsKICByZXR1cm4gIm9udG91Y2hzdGFydCIgaW4gdGhpczsKfQoKZnVuY3Rpb24gZGVmYXVsdENvbnN0cmFpbih0cmFuc2Zvcm0sIGV4dGVudCwgdHJhbnNsYXRlRXh0ZW50KSB7CiAgdmFyIGR4MCA9IHRyYW5zZm9ybS5pbnZlcnRYKGV4dGVudFswXVswXSkgLSB0cmFuc2xhdGVFeHRlbnRbMF1bMF0sCiAgICAgIGR4MSA9IHRyYW5zZm9ybS5pbnZlcnRYKGV4dGVudFsxXVswXSkgLSB0cmFuc2xhdGVFeHRlbnRbMV1bMF0sCiAgICAgIGR5MCA9IHRyYW5zZm9ybS5pbnZlcnRZKGV4dGVudFswXVsxXSkgLSB0cmFuc2xhdGVFeHRlbnRbMF1bMV0sCiAgICAgIGR5MSA9IHRyYW5zZm9ybS5pbnZlcnRZKGV4dGVudFsxXVsxXSkgLSB0cmFuc2xhdGVFeHRlbnRbMV1bMV07CiAgcmV0dXJuIHRyYW5zZm9ybS50cmFuc2xhdGUoCiAgICBkeDEgPiBkeDAgPyAoZHgwICsgZHgxKSAvIDIgOiBNYXRoLm1pbigwLCBkeDApIHx8IE1hdGgubWF4KDAsIGR4MSksCiAgICBkeTEgPiBkeTAgPyAoZHkwICsgZHkxKSAvIDIgOiBNYXRoLm1pbigwLCBkeTApIHx8IE1hdGgubWF4KDAsIGR5MSkKICApOwp9CgpmdW5jdGlvbiB6b29tKCkgewogIHZhciBmaWx0ZXIgPSBkZWZhdWx0RmlsdGVyJDIsCiAgICAgIGV4dGVudCA9IGRlZmF1bHRFeHRlbnQkMSwKICAgICAgY29uc3RyYWluID0gZGVmYXVsdENvbnN0cmFpbiwKICAgICAgd2hlZWxEZWx0YSA9IGRlZmF1bHRXaGVlbERlbHRhLAogICAgICB0b3VjaGFibGUgPSBkZWZhdWx0VG91Y2hhYmxlJDEsCiAgICAgIHNjYWxlRXh0ZW50ID0gWzAsIEluZmluaXR5XSwKICAgICAgdHJhbnNsYXRlRXh0ZW50ID0gW1stSW5maW5pdHksIC1JbmZpbml0eV0sIFtJbmZpbml0eSwgSW5maW5pdHldXSwKICAgICAgZHVyYXRpb24gPSAyNTAsCiAgICAgIGludGVycG9sYXRlID0gaW50ZXJwb2xhdGVab29tLAogICAgICBnZXN0dXJlcyA9IFtdLAogICAgICBsaXN0ZW5lcnMgPSBkaXNwYXRjaCgic3RhcnQiLCAiem9vbSIsICJlbmQiKSwKICAgICAgdG91Y2hzdGFydGluZywKICAgICAgdG91Y2hlbmRpbmcsCiAgICAgIHRvdWNoRGVsYXkgPSA1MDAsCiAgICAgIHdoZWVsRGVsYXkgPSAxNTAsCiAgICAgIGNsaWNrRGlzdGFuY2UyID0gMDsKCiAgZnVuY3Rpb24gem9vbShzZWxlY3Rpb24kJDEpIHsKICAgIHNlbGVjdGlvbiQkMQogICAgICAgIC5wcm9wZXJ0eSgiX196b29tIiwgZGVmYXVsdFRyYW5zZm9ybSkKICAgICAgICAub24oIndoZWVsLnpvb20iLCB3aGVlbGVkKQogICAgICAgIC5vbigibW91c2Vkb3duLnpvb20iLCBtb3VzZWRvd25lZCkKICAgICAgICAub24oImRibGNsaWNrLnpvb20iLCBkYmxjbGlja2VkKQogICAgICAuZmlsdGVyKHRvdWNoYWJsZSkKICAgICAgICAub24oInRvdWNoc3RhcnQuem9vbSIsIHRvdWNoc3RhcnRlZCkKICAgICAgICAub24oInRvdWNobW92ZS56b29tIiwgdG91Y2htb3ZlZCkKICAgICAgICAub24oInRvdWNoZW5kLnpvb20gdG91Y2hjYW5jZWwuem9vbSIsIHRvdWNoZW5kZWQpCiAgICAgICAgLnN0eWxlKCJ0b3VjaC1hY3Rpb24iLCAibm9uZSIpCiAgICAgICAgLnN0eWxlKCItd2Via2l0LXRhcC1oaWdobGlnaHQtY29sb3IiLCAicmdiYSgwLDAsMCwwKSIpOwogIH0KCiAgem9vbS50cmFuc2Zvcm0gPSBmdW5jdGlvbihjb2xsZWN0aW9uLCB0cmFuc2Zvcm0pIHsKICAgIHZhciBzZWxlY3Rpb24kJDEgPSBjb2xsZWN0aW9uLnNlbGVjdGlvbiA/IGNvbGxlY3Rpb24uc2VsZWN0aW9uKCkgOiBjb2xsZWN0aW9uOwogICAgc2VsZWN0aW9uJCQxLnByb3BlcnR5KCJfX3pvb20iLCBkZWZhdWx0VHJhbnNmb3JtKTsKICAgIGlmIChjb2xsZWN0aW9uICE9PSBzZWxlY3Rpb24kJDEpIHsKICAgICAgc2NoZWR1bGUoY29sbGVjdGlvbiwgdHJhbnNmb3JtKTsKICAgIH0gZWxzZSB7CiAgICAgIHNlbGVjdGlvbiQkMS5pbnRlcnJ1cHQoKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgIGdlc3R1cmUodGhpcywgYXJndW1lbnRzKQogICAgICAgICAgICAuc3RhcnQoKQogICAgICAgICAgICAuem9vbShudWxsLCB0eXBlb2YgdHJhbnNmb3JtID09PSAiZnVuY3Rpb24iID8gdHJhbnNmb3JtLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiB0cmFuc2Zvcm0pCiAgICAgICAgICAgIC5lbmQoKTsKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgem9vbS5zY2FsZUJ5ID0gZnVuY3Rpb24oc2VsZWN0aW9uJCQxLCBrKSB7CiAgICB6b29tLnNjYWxlVG8oc2VsZWN0aW9uJCQxLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGswID0gdGhpcy5fX3pvb20uaywKICAgICAgICAgIGsxID0gdHlwZW9mIGsgPT09ICJmdW5jdGlvbiIgPyBrLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBrOwogICAgICByZXR1cm4gazAgKiBrMTsKICAgIH0pOwogIH07CgogIHpvb20uc2NhbGVUbyA9IGZ1bmN0aW9uKHNlbGVjdGlvbiQkMSwgaykgewogICAgem9vbS50cmFuc2Zvcm0oc2VsZWN0aW9uJCQxLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGUgPSBleHRlbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKSwKICAgICAgICAgIHQwID0gdGhpcy5fX3pvb20sCiAgICAgICAgICBwMCA9IGNlbnRyb2lkKGUpLAogICAgICAgICAgcDEgPSB0MC5pbnZlcnQocDApLAogICAgICAgICAgazEgPSB0eXBlb2YgayA9PT0gImZ1bmN0aW9uIiA/IGsuYXBwbHkodGhpcywgYXJndW1lbnRzKSA6IGs7CiAgICAgIHJldHVybiBjb25zdHJhaW4odHJhbnNsYXRlKHNjYWxlKHQwLCBrMSksIHAwLCBwMSksIGUsIHRyYW5zbGF0ZUV4dGVudCk7CiAgICB9KTsKICB9OwoKICB6b29tLnRyYW5zbGF0ZUJ5ID0gZnVuY3Rpb24oc2VsZWN0aW9uJCQxLCB4LCB5KSB7CiAgICB6b29tLnRyYW5zZm9ybShzZWxlY3Rpb24kJDEsIGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gY29uc3RyYWluKHRoaXMuX196b29tLnRyYW5zbGF0ZSgKICAgICAgICB0eXBlb2YgeCA9PT0gImZ1bmN0aW9uIiA/IHguYXBwbHkodGhpcywgYXJndW1lbnRzKSA6IHgsCiAgICAgICAgdHlwZW9mIHkgPT09ICJmdW5jdGlvbiIgPyB5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiB5CiAgICAgICksIGV4dGVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCB0cmFuc2xhdGVFeHRlbnQpOwogICAgfSk7CiAgfTsKCiAgem9vbS50cmFuc2xhdGVUbyA9IGZ1bmN0aW9uKHNlbGVjdGlvbiQkMSwgeCwgeSkgewogICAgem9vbS50cmFuc2Zvcm0oc2VsZWN0aW9uJCQxLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGUgPSBleHRlbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKSwKICAgICAgICAgIHQgPSB0aGlzLl9fem9vbSwKICAgICAgICAgIHAgPSBjZW50cm9pZChlKTsKICAgICAgcmV0dXJuIGNvbnN0cmFpbihpZGVudGl0eSQ4LnRyYW5zbGF0ZShwWzBdLCBwWzFdKS5zY2FsZSh0LmspLnRyYW5zbGF0ZSgKICAgICAgICB0eXBlb2YgeCA9PT0gImZ1bmN0aW9uIiA/IC14LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiAteCwKICAgICAgICB0eXBlb2YgeSA9PT0gImZ1bmN0aW9uIiA/IC15LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiAteQogICAgICApLCBlLCB0cmFuc2xhdGVFeHRlbnQpOwogICAgfSk7CiAgfTsKCiAgZnVuY3Rpb24gc2NhbGUodHJhbnNmb3JtLCBrKSB7CiAgICBrID0gTWF0aC5tYXgoc2NhbGVFeHRlbnRbMF0sIE1hdGgubWluKHNjYWxlRXh0ZW50WzFdLCBrKSk7CiAgICByZXR1cm4gayA9PT0gdHJhbnNmb3JtLmsgPyB0cmFuc2Zvcm0gOiBuZXcgVHJhbnNmb3JtKGssIHRyYW5zZm9ybS54LCB0cmFuc2Zvcm0ueSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2xhdGUodHJhbnNmb3JtLCBwMCwgcDEpIHsKICAgIHZhciB4ID0gcDBbMF0gLSBwMVswXSAqIHRyYW5zZm9ybS5rLCB5ID0gcDBbMV0gLSBwMVsxXSAqIHRyYW5zZm9ybS5rOwogICAgcmV0dXJuIHggPT09IHRyYW5zZm9ybS54ICYmIHkgPT09IHRyYW5zZm9ybS55ID8gdHJhbnNmb3JtIDogbmV3IFRyYW5zZm9ybSh0cmFuc2Zvcm0uaywgeCwgeSk7CiAgfQoKICBmdW5jdGlvbiBjZW50cm9pZChleHRlbnQpIHsKICAgIHJldHVybiBbKCtleHRlbnRbMF1bMF0gKyArZXh0ZW50WzFdWzBdKSAvIDIsICgrZXh0ZW50WzBdWzFdICsgK2V4dGVudFsxXVsxXSkgLyAyXTsKICB9CgogIGZ1bmN0aW9uIHNjaGVkdWxlKHRyYW5zaXRpb24kJDEsIHRyYW5zZm9ybSwgY2VudGVyKSB7CiAgICB0cmFuc2l0aW9uJCQxCiAgICAgICAgLm9uKCJzdGFydC56b29tIiwgZnVuY3Rpb24oKSB7IGdlc3R1cmUodGhpcywgYXJndW1lbnRzKS5zdGFydCgpOyB9KQogICAgICAgIC5vbigiaW50ZXJydXB0Lnpvb20gZW5kLnpvb20iLCBmdW5jdGlvbigpIHsgZ2VzdHVyZSh0aGlzLCBhcmd1bWVudHMpLmVuZCgpOyB9KQogICAgICAgIC50d2Vlbigiem9vbSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLAogICAgICAgICAgICAgIGFyZ3MgPSBhcmd1bWVudHMsCiAgICAgICAgICAgICAgZyA9IGdlc3R1cmUodGhhdCwgYXJncyksCiAgICAgICAgICAgICAgZSA9IGV4dGVudC5hcHBseSh0aGF0LCBhcmdzKSwKICAgICAgICAgICAgICBwID0gY2VudGVyIHx8IGNlbnRyb2lkKGUpLAogICAgICAgICAgICAgIHcgPSBNYXRoLm1heChlWzFdWzBdIC0gZVswXVswXSwgZVsxXVsxXSAtIGVbMF1bMV0pLAogICAgICAgICAgICAgIGEgPSB0aGF0Ll9fem9vbSwKICAgICAgICAgICAgICBiID0gdHlwZW9mIHRyYW5zZm9ybSA9PT0gImZ1bmN0aW9uIiA/IHRyYW5zZm9ybS5hcHBseSh0aGF0LCBhcmdzKSA6IHRyYW5zZm9ybSwKICAgICAgICAgICAgICBpID0gaW50ZXJwb2xhdGUoYS5pbnZlcnQocCkuY29uY2F0KHcgLyBhLmspLCBiLmludmVydChwKS5jb25jYXQodyAvIGIuaykpOwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgaWYgKHQgPT09IDEpIHQgPSBiOyAvLyBBdm9pZCByb3VuZGluZyBlcnJvciBvbiBlbmQuCiAgICAgICAgICAgIGVsc2UgeyB2YXIgbCA9IGkodCksIGsgPSB3IC8gbFsyXTsgdCA9IG5ldyBUcmFuc2Zvcm0oaywgcFswXSAtIGxbMF0gKiBrLCBwWzFdIC0gbFsxXSAqIGspOyB9CiAgICAgICAgICAgIGcuem9vbShudWxsLCB0KTsKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgfQoKICBmdW5jdGlvbiBnZXN0dXJlKHRoYXQsIGFyZ3MpIHsKICAgIGZvciAodmFyIGkgPSAwLCBuID0gZ2VzdHVyZXMubGVuZ3RoLCBnOyBpIDwgbjsgKytpKSB7CiAgICAgIGlmICgoZyA9IGdlc3R1cmVzW2ldKS50aGF0ID09PSB0aGF0KSB7CiAgICAgICAgcmV0dXJuIGc7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBuZXcgR2VzdHVyZSh0aGF0LCBhcmdzKTsKICB9CgogIGZ1bmN0aW9uIEdlc3R1cmUodGhhdCwgYXJncykgewogICAgdGhpcy50aGF0ID0gdGhhdDsKICAgIHRoaXMuYXJncyA9IGFyZ3M7CiAgICB0aGlzLmluZGV4ID0gLTE7CiAgICB0aGlzLmFjdGl2ZSA9IDA7CiAgICB0aGlzLmV4dGVudCA9IGV4dGVudC5hcHBseSh0aGF0LCBhcmdzKTsKICB9CgogIEdlc3R1cmUucHJvdG90eXBlID0gewogICAgc3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICBpZiAoKyt0aGlzLmFjdGl2ZSA9PT0gMSkgewogICAgICAgIHRoaXMuaW5kZXggPSBnZXN0dXJlcy5wdXNoKHRoaXMpIC0gMTsKICAgICAgICB0aGlzLmVtaXQoInN0YXJ0Iik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAogICAgem9vbTogZnVuY3Rpb24oa2V5LCB0cmFuc2Zvcm0pIHsKICAgICAgaWYgKHRoaXMubW91c2UgJiYga2V5ICE9PSAibW91c2UiKSB0aGlzLm1vdXNlWzFdID0gdHJhbnNmb3JtLmludmVydCh0aGlzLm1vdXNlWzBdKTsKICAgICAgaWYgKHRoaXMudG91Y2gwICYmIGtleSAhPT0gInRvdWNoIikgdGhpcy50b3VjaDBbMV0gPSB0cmFuc2Zvcm0uaW52ZXJ0KHRoaXMudG91Y2gwWzBdKTsKICAgICAgaWYgKHRoaXMudG91Y2gxICYmIGtleSAhPT0gInRvdWNoIikgdGhpcy50b3VjaDFbMV0gPSB0cmFuc2Zvcm0uaW52ZXJ0KHRoaXMudG91Y2gxWzBdKTsKICAgICAgdGhpcy50aGF0Ll9fem9vbSA9IHRyYW5zZm9ybTsKICAgICAgdGhpcy5lbWl0KCJ6b29tIik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIGVuZDogZnVuY3Rpb24oKSB7CiAgICAgIGlmICgtLXRoaXMuYWN0aXZlID09PSAwKSB7CiAgICAgICAgZ2VzdHVyZXMuc3BsaWNlKHRoaXMuaW5kZXgsIDEpOwogICAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgICB0aGlzLmVtaXQoImVuZCIpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIGVtaXQ6IGZ1bmN0aW9uKHR5cGUpIHsKICAgICAgY3VzdG9tRXZlbnQobmV3IFpvb21FdmVudCh6b29tLCB0eXBlLCB0aGlzLnRoYXQuX196b29tKSwgbGlzdGVuZXJzLmFwcGx5LCBsaXN0ZW5lcnMsIFt0eXBlLCB0aGlzLnRoYXQsIHRoaXMuYXJnc10pOwogICAgfQogIH07CgogIGZ1bmN0aW9uIHdoZWVsZWQoKSB7CiAgICBpZiAoIWZpbHRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSByZXR1cm47CiAgICB2YXIgZyA9IGdlc3R1cmUodGhpcywgYXJndW1lbnRzKSwKICAgICAgICB0ID0gdGhpcy5fX3pvb20sCiAgICAgICAgayA9IE1hdGgubWF4KHNjYWxlRXh0ZW50WzBdLCBNYXRoLm1pbihzY2FsZUV4dGVudFsxXSwgdC5rICogTWF0aC5wb3coMiwgd2hlZWxEZWx0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSkpLAogICAgICAgIHAgPSBtb3VzZSh0aGlzKTsKCiAgICAvLyBJZiB0aGUgbW91c2UgaXMgaW4gdGhlIHNhbWUgbG9jYXRpb24gYXMgYmVmb3JlLCByZXVzZSBpdC4KICAgIC8vIElmIHRoZXJlIHdlcmUgcmVjZW50IHdoZWVsIGV2ZW50cywgcmVzZXQgdGhlIHdoZWVsIGlkbGUgdGltZW91dC4KICAgIGlmIChnLndoZWVsKSB7CiAgICAgIGlmIChnLm1vdXNlWzBdWzBdICE9PSBwWzBdIHx8IGcubW91c2VbMF1bMV0gIT09IHBbMV0pIHsKICAgICAgICBnLm1vdXNlWzFdID0gdC5pbnZlcnQoZy5tb3VzZVswXSA9IHApOwogICAgICB9CiAgICAgIGNsZWFyVGltZW91dChnLndoZWVsKTsKICAgIH0KCiAgICAvLyBJZiB0aGlzIHdoZWVsIGV2ZW50IHdvbuKAmXQgdHJpZ2dlciBhIHRyYW5zZm9ybSBjaGFuZ2UsIGlnbm9yZSBpdC4KICAgIGVsc2UgaWYgKHQuayA9PT0gaykgcmV0dXJuOwoKICAgIC8vIE90aGVyd2lzZSwgY2FwdHVyZSB0aGUgbW91c2UgcG9pbnQgYW5kIGxvY2F0aW9uIGF0IHRoZSBzdGFydC4KICAgIGVsc2UgewogICAgICBnLm1vdXNlID0gW3AsIHQuaW52ZXJ0KHApXTsKICAgICAgaW50ZXJydXB0KHRoaXMpOwogICAgICBnLnN0YXJ0KCk7CiAgICB9CgogICAgbm9ldmVudCQyKCk7CiAgICBnLndoZWVsID0gc2V0VGltZW91dCh3aGVlbGlkbGVkLCB3aGVlbERlbGF5KTsKICAgIGcuem9vbSgibW91c2UiLCBjb25zdHJhaW4odHJhbnNsYXRlKHNjYWxlKHQsIGspLCBnLm1vdXNlWzBdLCBnLm1vdXNlWzFdKSwgZy5leHRlbnQsIHRyYW5zbGF0ZUV4dGVudCkpOwoKICAgIGZ1bmN0aW9uIHdoZWVsaWRsZWQoKSB7CiAgICAgIGcud2hlZWwgPSBudWxsOwogICAgICBnLmVuZCgpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gbW91c2Vkb3duZWQoKSB7CiAgICBpZiAodG91Y2hlbmRpbmcgfHwgIWZpbHRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSByZXR1cm47CiAgICB2YXIgZyA9IGdlc3R1cmUodGhpcywgYXJndW1lbnRzKSwKICAgICAgICB2ID0gc2VsZWN0KGV4cG9ydHMuZXZlbnQudmlldykub24oIm1vdXNlbW92ZS56b29tIiwgbW91c2Vtb3ZlZCwgdHJ1ZSkub24oIm1vdXNldXAuem9vbSIsIG1vdXNldXBwZWQsIHRydWUpLAogICAgICAgIHAgPSBtb3VzZSh0aGlzKSwKICAgICAgICB4MCA9IGV4cG9ydHMuZXZlbnQuY2xpZW50WCwKICAgICAgICB5MCA9IGV4cG9ydHMuZXZlbnQuY2xpZW50WTsKCiAgICBkcmFnRGlzYWJsZShleHBvcnRzLmV2ZW50LnZpZXcpOwogICAgbm9wcm9wYWdhdGlvbiQyKCk7CiAgICBnLm1vdXNlID0gW3AsIHRoaXMuX196b29tLmludmVydChwKV07CiAgICBpbnRlcnJ1cHQodGhpcyk7CiAgICBnLnN0YXJ0KCk7CgogICAgZnVuY3Rpb24gbW91c2Vtb3ZlZCgpIHsKICAgICAgbm9ldmVudCQyKCk7CiAgICAgIGlmICghZy5tb3ZlZCkgewogICAgICAgIHZhciBkeCA9IGV4cG9ydHMuZXZlbnQuY2xpZW50WCAtIHgwLCBkeSA9IGV4cG9ydHMuZXZlbnQuY2xpZW50WSAtIHkwOwogICAgICAgIGcubW92ZWQgPSBkeCAqIGR4ICsgZHkgKiBkeSA+IGNsaWNrRGlzdGFuY2UyOwogICAgICB9CiAgICAgIGcuem9vbSgibW91c2UiLCBjb25zdHJhaW4odHJhbnNsYXRlKGcudGhhdC5fX3pvb20sIGcubW91c2VbMF0gPSBtb3VzZShnLnRoYXQpLCBnLm1vdXNlWzFdKSwgZy5leHRlbnQsIHRyYW5zbGF0ZUV4dGVudCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIG1vdXNldXBwZWQoKSB7CiAgICAgIHYub24oIm1vdXNlbW92ZS56b29tIG1vdXNldXAuem9vbSIsIG51bGwpOwogICAgICB5ZXNkcmFnKGV4cG9ydHMuZXZlbnQudmlldywgZy5tb3ZlZCk7CiAgICAgIG5vZXZlbnQkMigpOwogICAgICBnLmVuZCgpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZGJsY2xpY2tlZCgpIHsKICAgIGlmICghZmlsdGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHJldHVybjsKICAgIHZhciB0MCA9IHRoaXMuX196b29tLAogICAgICAgIHAwID0gbW91c2UodGhpcyksCiAgICAgICAgcDEgPSB0MC5pbnZlcnQocDApLAogICAgICAgIGsxID0gdDAuayAqIChleHBvcnRzLmV2ZW50LnNoaWZ0S2V5ID8gMC41IDogMiksCiAgICAgICAgdDEgPSBjb25zdHJhaW4odHJhbnNsYXRlKHNjYWxlKHQwLCBrMSksIHAwLCBwMSksIGV4dGVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCB0cmFuc2xhdGVFeHRlbnQpOwoKICAgIG5vZXZlbnQkMigpOwogICAgaWYgKGR1cmF0aW9uID4gMCkgc2VsZWN0KHRoaXMpLnRyYW5zaXRpb24oKS5kdXJhdGlvbihkdXJhdGlvbikuY2FsbChzY2hlZHVsZSwgdDEsIHAwKTsKICAgIGVsc2Ugc2VsZWN0KHRoaXMpLmNhbGwoem9vbS50cmFuc2Zvcm0sIHQxKTsKICB9CgogIGZ1bmN0aW9uIHRvdWNoc3RhcnRlZCgpIHsKICAgIGlmICghZmlsdGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHJldHVybjsKICAgIHZhciBnID0gZ2VzdHVyZSh0aGlzLCBhcmd1bWVudHMpLAogICAgICAgIHRvdWNoZXMkJDEgPSBleHBvcnRzLmV2ZW50LmNoYW5nZWRUb3VjaGVzLAogICAgICAgIHN0YXJ0ZWQsCiAgICAgICAgbiA9IHRvdWNoZXMkJDEubGVuZ3RoLCBpLCB0LCBwOwoKICAgIG5vcHJvcGFnYXRpb24kMigpOwogICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICB0ID0gdG91Y2hlcyQkMVtpXSwgcCA9IHRvdWNoKHRoaXMsIHRvdWNoZXMkJDEsIHQuaWRlbnRpZmllcik7CiAgICAgIHAgPSBbcCwgdGhpcy5fX3pvb20uaW52ZXJ0KHApLCB0LmlkZW50aWZpZXJdOwogICAgICBpZiAoIWcudG91Y2gwKSBnLnRvdWNoMCA9IHAsIHN0YXJ0ZWQgPSB0cnVlOwogICAgICBlbHNlIGlmICghZy50b3VjaDEpIGcudG91Y2gxID0gcDsKICAgIH0KCiAgICAvLyBJZiB0aGlzIGlzIGEgZGJsdGFwLCByZXJvdXRlIHRvIHRoZSAob3B0aW9uYWwpIGRibGNsaWNrLnpvb20gaGFuZGxlci4KICAgIGlmICh0b3VjaHN0YXJ0aW5nKSB7CiAgICAgIHRvdWNoc3RhcnRpbmcgPSBjbGVhclRpbWVvdXQodG91Y2hzdGFydGluZyk7CiAgICAgIGlmICghZy50b3VjaDEpIHsKICAgICAgICBnLmVuZCgpOwogICAgICAgIHAgPSBzZWxlY3QodGhpcykub24oImRibGNsaWNrLnpvb20iKTsKICAgICAgICBpZiAocCkgcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQoKICAgIGlmIChzdGFydGVkKSB7CiAgICAgIHRvdWNoc3RhcnRpbmcgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyB0b3VjaHN0YXJ0aW5nID0gbnVsbDsgfSwgdG91Y2hEZWxheSk7CiAgICAgIGludGVycnVwdCh0aGlzKTsKICAgICAgZy5zdGFydCgpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdG91Y2htb3ZlZCgpIHsKICAgIHZhciBnID0gZ2VzdHVyZSh0aGlzLCBhcmd1bWVudHMpLAogICAgICAgIHRvdWNoZXMkJDEgPSBleHBvcnRzLmV2ZW50LmNoYW5nZWRUb3VjaGVzLAogICAgICAgIG4gPSB0b3VjaGVzJCQxLmxlbmd0aCwgaSwgdCwgcCwgbDsKCiAgICBub2V2ZW50JDIoKTsKICAgIGlmICh0b3VjaHN0YXJ0aW5nKSB0b3VjaHN0YXJ0aW5nID0gY2xlYXJUaW1lb3V0KHRvdWNoc3RhcnRpbmcpOwogICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICB0ID0gdG91Y2hlcyQkMVtpXSwgcCA9IHRvdWNoKHRoaXMsIHRvdWNoZXMkJDEsIHQuaWRlbnRpZmllcik7CiAgICAgIGlmIChnLnRvdWNoMCAmJiBnLnRvdWNoMFsyXSA9PT0gdC5pZGVudGlmaWVyKSBnLnRvdWNoMFswXSA9IHA7CiAgICAgIGVsc2UgaWYgKGcudG91Y2gxICYmIGcudG91Y2gxWzJdID09PSB0LmlkZW50aWZpZXIpIGcudG91Y2gxWzBdID0gcDsKICAgIH0KICAgIHQgPSBnLnRoYXQuX196b29tOwogICAgaWYgKGcudG91Y2gxKSB7CiAgICAgIHZhciBwMCA9IGcudG91Y2gwWzBdLCBsMCA9IGcudG91Y2gwWzFdLAogICAgICAgICAgcDEgPSBnLnRvdWNoMVswXSwgbDEgPSBnLnRvdWNoMVsxXSwKICAgICAgICAgIGRwID0gKGRwID0gcDFbMF0gLSBwMFswXSkgKiBkcCArIChkcCA9IHAxWzFdIC0gcDBbMV0pICogZHAsCiAgICAgICAgICBkbCA9IChkbCA9IGwxWzBdIC0gbDBbMF0pICogZGwgKyAoZGwgPSBsMVsxXSAtIGwwWzFdKSAqIGRsOwogICAgICB0ID0gc2NhbGUodCwgTWF0aC5zcXJ0KGRwIC8gZGwpKTsKICAgICAgcCA9IFsocDBbMF0gKyBwMVswXSkgLyAyLCAocDBbMV0gKyBwMVsxXSkgLyAyXTsKICAgICAgbCA9IFsobDBbMF0gKyBsMVswXSkgLyAyLCAobDBbMV0gKyBsMVsxXSkgLyAyXTsKICAgIH0KICAgIGVsc2UgaWYgKGcudG91Y2gwKSBwID0gZy50b3VjaDBbMF0sIGwgPSBnLnRvdWNoMFsxXTsKICAgIGVsc2UgcmV0dXJuOwogICAgZy56b29tKCJ0b3VjaCIsIGNvbnN0cmFpbih0cmFuc2xhdGUodCwgcCwgbCksIGcuZXh0ZW50LCB0cmFuc2xhdGVFeHRlbnQpKTsKICB9CgogIGZ1bmN0aW9uIHRvdWNoZW5kZWQoKSB7CiAgICB2YXIgZyA9IGdlc3R1cmUodGhpcywgYXJndW1lbnRzKSwKICAgICAgICB0b3VjaGVzJCQxID0gZXhwb3J0cy5ldmVudC5jaGFuZ2VkVG91Y2hlcywKICAgICAgICBuID0gdG91Y2hlcyQkMS5sZW5ndGgsIGksIHQ7CgogICAgbm9wcm9wYWdhdGlvbiQyKCk7CiAgICBpZiAodG91Y2hlbmRpbmcpIGNsZWFyVGltZW91dCh0b3VjaGVuZGluZyk7CiAgICB0b3VjaGVuZGluZyA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHRvdWNoZW5kaW5nID0gbnVsbDsgfSwgdG91Y2hEZWxheSk7CiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgIHQgPSB0b3VjaGVzJCQxW2ldOwogICAgICBpZiAoZy50b3VjaDAgJiYgZy50b3VjaDBbMl0gPT09IHQuaWRlbnRpZmllcikgZGVsZXRlIGcudG91Y2gwOwogICAgICBlbHNlIGlmIChnLnRvdWNoMSAmJiBnLnRvdWNoMVsyXSA9PT0gdC5pZGVudGlmaWVyKSBkZWxldGUgZy50b3VjaDE7CiAgICB9CiAgICBpZiAoZy50b3VjaDEgJiYgIWcudG91Y2gwKSBnLnRvdWNoMCA9IGcudG91Y2gxLCBkZWxldGUgZy50b3VjaDE7CiAgICBpZiAoZy50b3VjaDApIGcudG91Y2gwWzFdID0gdGhpcy5fX3pvb20uaW52ZXJ0KGcudG91Y2gwWzBdKTsKICAgIGVsc2UgZy5lbmQoKTsKICB9CgogIHpvb20ud2hlZWxEZWx0YSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHdoZWVsRGVsdGEgPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQxMygrXyksIHpvb20pIDogd2hlZWxEZWx0YTsKICB9OwoKICB6b29tLmZpbHRlciA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGZpbHRlciA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IGNvbnN0YW50JDEzKCEhXyksIHpvb20pIDogZmlsdGVyOwogIH07CgogIHpvb20udG91Y2hhYmxlID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodG91Y2hhYmxlID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBfIDogY29uc3RhbnQkMTMoISFfKSwgem9vbSkgOiB0b3VjaGFibGU7CiAgfTsKCiAgem9vbS5leHRlbnQgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChleHRlbnQgPSB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiBjb25zdGFudCQxMyhbWytfWzBdWzBdLCArX1swXVsxXV0sIFsrX1sxXVswXSwgK19bMV1bMV1dXSksIHpvb20pIDogZXh0ZW50OwogIH07CgogIHpvb20uc2NhbGVFeHRlbnQgPSBmdW5jdGlvbihfKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChzY2FsZUV4dGVudFswXSA9ICtfWzBdLCBzY2FsZUV4dGVudFsxXSA9ICtfWzFdLCB6b29tKSA6IFtzY2FsZUV4dGVudFswXSwgc2NhbGVFeHRlbnRbMV1dOwogIH07CgogIHpvb20udHJhbnNsYXRlRXh0ZW50ID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodHJhbnNsYXRlRXh0ZW50WzBdWzBdID0gK19bMF1bMF0sIHRyYW5zbGF0ZUV4dGVudFsxXVswXSA9ICtfWzFdWzBdLCB0cmFuc2xhdGVFeHRlbnRbMF1bMV0gPSArX1swXVsxXSwgdHJhbnNsYXRlRXh0ZW50WzFdWzFdID0gK19bMV1bMV0sIHpvb20pIDogW1t0cmFuc2xhdGVFeHRlbnRbMF1bMF0sIHRyYW5zbGF0ZUV4dGVudFswXVsxXV0sIFt0cmFuc2xhdGVFeHRlbnRbMV1bMF0sIHRyYW5zbGF0ZUV4dGVudFsxXVsxXV1dOwogIH07CgogIHpvb20uY29uc3RyYWluID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoY29uc3RyYWluID0gXywgem9vbSkgOiBjb25zdHJhaW47CiAgfTsKCiAgem9vbS5kdXJhdGlvbiA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGR1cmF0aW9uID0gK18sIHpvb20pIDogZHVyYXRpb247CiAgfTsKCiAgem9vbS5pbnRlcnBvbGF0ZSA9IGZ1bmN0aW9uKF8pIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGludGVycG9sYXRlID0gXywgem9vbSkgOiBpbnRlcnBvbGF0ZTsKICB9OwoKICB6b29tLm9uID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgdmFsdWUgPSBsaXN0ZW5lcnMub24uYXBwbHkobGlzdGVuZXJzLCBhcmd1bWVudHMpOwogICAgcmV0dXJuIHZhbHVlID09PSBsaXN0ZW5lcnMgPyB6b29tIDogdmFsdWU7CiAgfTsKCiAgem9vbS5jbGlja0Rpc3RhbmNlID0gZnVuY3Rpb24oXykgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoY2xpY2tEaXN0YW5jZTIgPSAoXyA9ICtfKSAqIF8sIHpvb20pIDogTWF0aC5zcXJ0KGNsaWNrRGlzdGFuY2UyKTsKICB9OwoKICByZXR1cm4gem9vbTsKfQoKZXhwb3J0cy52ZXJzaW9uID0gdmVyc2lvbjsKZXhwb3J0cy5iaXNlY3QgPSBiaXNlY3RSaWdodDsKZXhwb3J0cy5iaXNlY3RSaWdodCA9IGJpc2VjdFJpZ2h0OwpleHBvcnRzLmJpc2VjdExlZnQgPSBiaXNlY3RMZWZ0OwpleHBvcnRzLmFzY2VuZGluZyA9IGFzY2VuZGluZzsKZXhwb3J0cy5iaXNlY3RvciA9IGJpc2VjdG9yOwpleHBvcnRzLmNyb3NzID0gY3Jvc3M7CmV4cG9ydHMuZGVzY2VuZGluZyA9IGRlc2NlbmRpbmc7CmV4cG9ydHMuZGV2aWF0aW9uID0gZGV2aWF0aW9uOwpleHBvcnRzLmV4dGVudCA9IGV4dGVudDsKZXhwb3J0cy5oaXN0b2dyYW0gPSBoaXN0b2dyYW07CmV4cG9ydHMudGhyZXNob2xkRnJlZWRtYW5EaWFjb25pcyA9IGZyZWVkbWFuRGlhY29uaXM7CmV4cG9ydHMudGhyZXNob2xkU2NvdHQgPSBzY290dDsKZXhwb3J0cy50aHJlc2hvbGRTdHVyZ2VzID0gdGhyZXNob2xkU3R1cmdlczsKZXhwb3J0cy5tYXggPSBtYXg7CmV4cG9ydHMubWVhbiA9IG1lYW47CmV4cG9ydHMubWVkaWFuID0gbWVkaWFuOwpleHBvcnRzLm1lcmdlID0gbWVyZ2U7CmV4cG9ydHMubWluID0gbWluOwpleHBvcnRzLnBhaXJzID0gcGFpcnM7CmV4cG9ydHMucGVybXV0ZSA9IHBlcm11dGU7CmV4cG9ydHMucXVhbnRpbGUgPSB0aHJlc2hvbGQ7CmV4cG9ydHMucmFuZ2UgPSBzZXF1ZW5jZTsKZXhwb3J0cy5zY2FuID0gc2NhbjsKZXhwb3J0cy5zaHVmZmxlID0gc2h1ZmZsZTsKZXhwb3J0cy5zdW0gPSBzdW07CmV4cG9ydHMudGlja3MgPSB0aWNrczsKZXhwb3J0cy50aWNrSW5jcmVtZW50ID0gdGlja0luY3JlbWVudDsKZXhwb3J0cy50aWNrU3RlcCA9IHRpY2tTdGVwOwpleHBvcnRzLnRyYW5zcG9zZSA9IHRyYW5zcG9zZTsKZXhwb3J0cy52YXJpYW5jZSA9IHZhcmlhbmNlOwpleHBvcnRzLnppcCA9IHppcDsKZXhwb3J0cy5heGlzVG9wID0gYXhpc1RvcDsKZXhwb3J0cy5heGlzUmlnaHQgPSBheGlzUmlnaHQ7CmV4cG9ydHMuYXhpc0JvdHRvbSA9IGF4aXNCb3R0b207CmV4cG9ydHMuYXhpc0xlZnQgPSBheGlzTGVmdDsKZXhwb3J0cy5icnVzaCA9IGJydXNoOwpleHBvcnRzLmJydXNoWCA9IGJydXNoWDsKZXhwb3J0cy5icnVzaFkgPSBicnVzaFk7CmV4cG9ydHMuYnJ1c2hTZWxlY3Rpb24gPSBicnVzaFNlbGVjdGlvbjsKZXhwb3J0cy5jaG9yZCA9IGNob3JkOwpleHBvcnRzLnJpYmJvbiA9IHJpYmJvbjsKZXhwb3J0cy5uZXN0ID0gbmVzdDsKZXhwb3J0cy5zZXQgPSBzZXQkMjsKZXhwb3J0cy5tYXAgPSBtYXAkMTsKZXhwb3J0cy5rZXlzID0ga2V5czsKZXhwb3J0cy52YWx1ZXMgPSB2YWx1ZXM7CmV4cG9ydHMuZW50cmllcyA9IGVudHJpZXM7CmV4cG9ydHMuY29sb3IgPSBjb2xvcjsKZXhwb3J0cy5yZ2IgPSByZ2I7CmV4cG9ydHMuaHNsID0gaHNsOwpleHBvcnRzLmxhYiA9IGxhYjsKZXhwb3J0cy5oY2wgPSBoY2w7CmV4cG9ydHMubGNoID0gbGNoOwpleHBvcnRzLmdyYXkgPSBncmF5OwpleHBvcnRzLmN1YmVoZWxpeCA9IGN1YmVoZWxpeDsKZXhwb3J0cy5jb250b3VycyA9IGNvbnRvdXJzOwpleHBvcnRzLmNvbnRvdXJEZW5zaXR5ID0gZGVuc2l0eTsKZXhwb3J0cy5kaXNwYXRjaCA9IGRpc3BhdGNoOwpleHBvcnRzLmRyYWcgPSBkcmFnOwpleHBvcnRzLmRyYWdEaXNhYmxlID0gZHJhZ0Rpc2FibGU7CmV4cG9ydHMuZHJhZ0VuYWJsZSA9IHllc2RyYWc7CmV4cG9ydHMuZHN2Rm9ybWF0ID0gZHN2Rm9ybWF0OwpleHBvcnRzLmNzdlBhcnNlID0gY3N2UGFyc2U7CmV4cG9ydHMuY3N2UGFyc2VSb3dzID0gY3N2UGFyc2VSb3dzOwpleHBvcnRzLmNzdkZvcm1hdCA9IGNzdkZvcm1hdDsKZXhwb3J0cy5jc3ZGb3JtYXRSb3dzID0gY3N2Rm9ybWF0Um93czsKZXhwb3J0cy50c3ZQYXJzZSA9IHRzdlBhcnNlOwpleHBvcnRzLnRzdlBhcnNlUm93cyA9IHRzdlBhcnNlUm93czsKZXhwb3J0cy50c3ZGb3JtYXQgPSB0c3ZGb3JtYXQ7CmV4cG9ydHMudHN2Rm9ybWF0Um93cyA9IHRzdkZvcm1hdFJvd3M7CmV4cG9ydHMuZWFzZUxpbmVhciA9IGxpbmVhciQxOwpleHBvcnRzLmVhc2VRdWFkID0gcXVhZEluT3V0OwpleHBvcnRzLmVhc2VRdWFkSW4gPSBxdWFkSW47CmV4cG9ydHMuZWFzZVF1YWRPdXQgPSBxdWFkT3V0OwpleHBvcnRzLmVhc2VRdWFkSW5PdXQgPSBxdWFkSW5PdXQ7CmV4cG9ydHMuZWFzZUN1YmljID0gY3ViaWNJbk91dDsKZXhwb3J0cy5lYXNlQ3ViaWNJbiA9IGN1YmljSW47CmV4cG9ydHMuZWFzZUN1YmljT3V0ID0gY3ViaWNPdXQ7CmV4cG9ydHMuZWFzZUN1YmljSW5PdXQgPSBjdWJpY0luT3V0OwpleHBvcnRzLmVhc2VQb2x5ID0gcG9seUluT3V0OwpleHBvcnRzLmVhc2VQb2x5SW4gPSBwb2x5SW47CmV4cG9ydHMuZWFzZVBvbHlPdXQgPSBwb2x5T3V0OwpleHBvcnRzLmVhc2VQb2x5SW5PdXQgPSBwb2x5SW5PdXQ7CmV4cG9ydHMuZWFzZVNpbiA9IHNpbkluT3V0OwpleHBvcnRzLmVhc2VTaW5JbiA9IHNpbkluOwpleHBvcnRzLmVhc2VTaW5PdXQgPSBzaW5PdXQ7CmV4cG9ydHMuZWFzZVNpbkluT3V0ID0gc2luSW5PdXQ7CmV4cG9ydHMuZWFzZUV4cCA9IGV4cEluT3V0OwpleHBvcnRzLmVhc2VFeHBJbiA9IGV4cEluOwpleHBvcnRzLmVhc2VFeHBPdXQgPSBleHBPdXQ7CmV4cG9ydHMuZWFzZUV4cEluT3V0ID0gZXhwSW5PdXQ7CmV4cG9ydHMuZWFzZUNpcmNsZSA9IGNpcmNsZUluT3V0OwpleHBvcnRzLmVhc2VDaXJjbGVJbiA9IGNpcmNsZUluOwpleHBvcnRzLmVhc2VDaXJjbGVPdXQgPSBjaXJjbGVPdXQ7CmV4cG9ydHMuZWFzZUNpcmNsZUluT3V0ID0gY2lyY2xlSW5PdXQ7CmV4cG9ydHMuZWFzZUJvdW5jZSA9IGJvdW5jZU91dDsKZXhwb3J0cy5lYXNlQm91bmNlSW4gPSBib3VuY2VJbjsKZXhwb3J0cy5lYXNlQm91bmNlT3V0ID0gYm91bmNlT3V0OwpleHBvcnRzLmVhc2VCb3VuY2VJbk91dCA9IGJvdW5jZUluT3V0OwpleHBvcnRzLmVhc2VCYWNrID0gYmFja0luT3V0OwpleHBvcnRzLmVhc2VCYWNrSW4gPSBiYWNrSW47CmV4cG9ydHMuZWFzZUJhY2tPdXQgPSBiYWNrT3V0OwpleHBvcnRzLmVhc2VCYWNrSW5PdXQgPSBiYWNrSW5PdXQ7CmV4cG9ydHMuZWFzZUVsYXN0aWMgPSBlbGFzdGljT3V0OwpleHBvcnRzLmVhc2VFbGFzdGljSW4gPSBlbGFzdGljSW47CmV4cG9ydHMuZWFzZUVsYXN0aWNPdXQgPSBlbGFzdGljT3V0OwpleHBvcnRzLmVhc2VFbGFzdGljSW5PdXQgPSBlbGFzdGljSW5PdXQ7CmV4cG9ydHMuYmxvYiA9IGJsb2I7CmV4cG9ydHMuYnVmZmVyID0gYnVmZmVyOwpleHBvcnRzLmRzdiA9IGRzdjsKZXhwb3J0cy5jc3YgPSBjc3YkMTsKZXhwb3J0cy50c3YgPSB0c3YkMTsKZXhwb3J0cy5pbWFnZSA9IGltYWdlOwpleHBvcnRzLmpzb24gPSBqc29uOwpleHBvcnRzLnRleHQgPSB0ZXh0OwpleHBvcnRzLnhtbCA9IHhtbDsKZXhwb3J0cy5odG1sID0gaHRtbDsKZXhwb3J0cy5zdmcgPSBzdmc7CmV4cG9ydHMuZm9yY2VDZW50ZXIgPSBjZW50ZXIkMTsKZXhwb3J0cy5mb3JjZUNvbGxpZGUgPSBjb2xsaWRlOwpleHBvcnRzLmZvcmNlTGluayA9IGxpbms7CmV4cG9ydHMuZm9yY2VNYW55Qm9keSA9IG1hbnlCb2R5OwpleHBvcnRzLmZvcmNlUmFkaWFsID0gcmFkaWFsOwpleHBvcnRzLmZvcmNlU2ltdWxhdGlvbiA9IHNpbXVsYXRpb247CmV4cG9ydHMuZm9yY2VYID0geCQyOwpleHBvcnRzLmZvcmNlWSA9IHkkMjsKZXhwb3J0cy5mb3JtYXREZWZhdWx0TG9jYWxlID0gZGVmYXVsdExvY2FsZTsKZXhwb3J0cy5mb3JtYXRMb2NhbGUgPSBmb3JtYXRMb2NhbGU7CmV4cG9ydHMuZm9ybWF0U3BlY2lmaWVyID0gZm9ybWF0U3BlY2lmaWVyOwpleHBvcnRzLnByZWNpc2lvbkZpeGVkID0gcHJlY2lzaW9uRml4ZWQ7CmV4cG9ydHMucHJlY2lzaW9uUHJlZml4ID0gcHJlY2lzaW9uUHJlZml4OwpleHBvcnRzLnByZWNpc2lvblJvdW5kID0gcHJlY2lzaW9uUm91bmQ7CmV4cG9ydHMuZ2VvQXJlYSA9IGFyZWEkMTsKZXhwb3J0cy5nZW9Cb3VuZHMgPSBib3VuZHM7CmV4cG9ydHMuZ2VvQ2VudHJvaWQgPSBjZW50cm9pZDsKZXhwb3J0cy5nZW9DaXJjbGUgPSBjaXJjbGU7CmV4cG9ydHMuZ2VvQ2xpcEFudGltZXJpZGlhbiA9IGNsaXBBbnRpbWVyaWRpYW47CmV4cG9ydHMuZ2VvQ2xpcENpcmNsZSA9IGNsaXBDaXJjbGU7CmV4cG9ydHMuZ2VvQ2xpcEV4dGVudCA9IGV4dGVudCQxOwpleHBvcnRzLmdlb0NsaXBSZWN0YW5nbGUgPSBjbGlwUmVjdGFuZ2xlOwpleHBvcnRzLmdlb0NvbnRhaW5zID0gY29udGFpbnMkMTsKZXhwb3J0cy5nZW9EaXN0YW5jZSA9IGRpc3RhbmNlOwpleHBvcnRzLmdlb0dyYXRpY3VsZSA9IGdyYXRpY3VsZTsKZXhwb3J0cy5nZW9HcmF0aWN1bGUxMCA9IGdyYXRpY3VsZTEwOwpleHBvcnRzLmdlb0ludGVycG9sYXRlID0gaW50ZXJwb2xhdGUkMTsKZXhwb3J0cy5nZW9MZW5ndGggPSBsZW5ndGgkMTsKZXhwb3J0cy5nZW9QYXRoID0gaW5kZXgkMTsKZXhwb3J0cy5nZW9BbGJlcnMgPSBhbGJlcnM7CmV4cG9ydHMuZ2VvQWxiZXJzVXNhID0gYWxiZXJzVXNhOwpleHBvcnRzLmdlb0F6aW11dGhhbEVxdWFsQXJlYSA9IGF6aW11dGhhbEVxdWFsQXJlYTsKZXhwb3J0cy5nZW9BemltdXRoYWxFcXVhbEFyZWFSYXcgPSBhemltdXRoYWxFcXVhbEFyZWFSYXc7CmV4cG9ydHMuZ2VvQXppbXV0aGFsRXF1aWRpc3RhbnQgPSBhemltdXRoYWxFcXVpZGlzdGFudDsKZXhwb3J0cy5nZW9BemltdXRoYWxFcXVpZGlzdGFudFJhdyA9IGF6aW11dGhhbEVxdWlkaXN0YW50UmF3OwpleHBvcnRzLmdlb0NvbmljQ29uZm9ybWFsID0gY29uaWNDb25mb3JtYWw7CmV4cG9ydHMuZ2VvQ29uaWNDb25mb3JtYWxSYXcgPSBjb25pY0NvbmZvcm1hbFJhdzsKZXhwb3J0cy5nZW9Db25pY0VxdWFsQXJlYSA9IGNvbmljRXF1YWxBcmVhOwpleHBvcnRzLmdlb0NvbmljRXF1YWxBcmVhUmF3ID0gY29uaWNFcXVhbEFyZWFSYXc7CmV4cG9ydHMuZ2VvQ29uaWNFcXVpZGlzdGFudCA9IGNvbmljRXF1aWRpc3RhbnQ7CmV4cG9ydHMuZ2VvQ29uaWNFcXVpZGlzdGFudFJhdyA9IGNvbmljRXF1aWRpc3RhbnRSYXc7CmV4cG9ydHMuZ2VvRXF1aXJlY3Rhbmd1bGFyID0gZXF1aXJlY3Rhbmd1bGFyOwpleHBvcnRzLmdlb0VxdWlyZWN0YW5ndWxhclJhdyA9IGVxdWlyZWN0YW5ndWxhclJhdzsKZXhwb3J0cy5nZW9Hbm9tb25pYyA9IGdub21vbmljOwpleHBvcnRzLmdlb0dub21vbmljUmF3ID0gZ25vbW9uaWNSYXc7CmV4cG9ydHMuZ2VvSWRlbnRpdHkgPSBpZGVudGl0eSQ1OwpleHBvcnRzLmdlb1Byb2plY3Rpb24gPSBwcm9qZWN0aW9uOwpleHBvcnRzLmdlb1Byb2plY3Rpb25NdXRhdG9yID0gcHJvamVjdGlvbk11dGF0b3I7CmV4cG9ydHMuZ2VvTWVyY2F0b3IgPSBtZXJjYXRvcjsKZXhwb3J0cy5nZW9NZXJjYXRvclJhdyA9IG1lcmNhdG9yUmF3OwpleHBvcnRzLmdlb05hdHVyYWxFYXJ0aDEgPSBuYXR1cmFsRWFydGgxOwpleHBvcnRzLmdlb05hdHVyYWxFYXJ0aDFSYXcgPSBuYXR1cmFsRWFydGgxUmF3OwpleHBvcnRzLmdlb09ydGhvZ3JhcGhpYyA9IG9ydGhvZ3JhcGhpYzsKZXhwb3J0cy5nZW9PcnRob2dyYXBoaWNSYXcgPSBvcnRob2dyYXBoaWNSYXc7CmV4cG9ydHMuZ2VvU3RlcmVvZ3JhcGhpYyA9IHN0ZXJlb2dyYXBoaWM7CmV4cG9ydHMuZ2VvU3RlcmVvZ3JhcGhpY1JhdyA9IHN0ZXJlb2dyYXBoaWNSYXc7CmV4cG9ydHMuZ2VvVHJhbnN2ZXJzZU1lcmNhdG9yID0gdHJhbnN2ZXJzZU1lcmNhdG9yOwpleHBvcnRzLmdlb1RyYW5zdmVyc2VNZXJjYXRvclJhdyA9IHRyYW5zdmVyc2VNZXJjYXRvclJhdzsKZXhwb3J0cy5nZW9Sb3RhdGlvbiA9IHJvdGF0aW9uOwpleHBvcnRzLmdlb1N0cmVhbSA9IGdlb1N0cmVhbTsKZXhwb3J0cy5nZW9UcmFuc2Zvcm0gPSB0cmFuc2Zvcm07CmV4cG9ydHMuY2x1c3RlciA9IGNsdXN0ZXI7CmV4cG9ydHMuaGllcmFyY2h5ID0gaGllcmFyY2h5OwpleHBvcnRzLnBhY2sgPSBpbmRleCQyOwpleHBvcnRzLnBhY2tTaWJsaW5ncyA9IHNpYmxpbmdzOwpleHBvcnRzLnBhY2tFbmNsb3NlID0gZW5jbG9zZTsKZXhwb3J0cy5wYXJ0aXRpb24gPSBwYXJ0aXRpb247CmV4cG9ydHMuc3RyYXRpZnkgPSBzdHJhdGlmeTsKZXhwb3J0cy50cmVlID0gdHJlZTsKZXhwb3J0cy50cmVlbWFwID0gaW5kZXgkMzsKZXhwb3J0cy50cmVlbWFwQmluYXJ5ID0gYmluYXJ5OwpleHBvcnRzLnRyZWVtYXBEaWNlID0gdHJlZW1hcERpY2U7CmV4cG9ydHMudHJlZW1hcFNsaWNlID0gdHJlZW1hcFNsaWNlOwpleHBvcnRzLnRyZWVtYXBTbGljZURpY2UgPSBzbGljZURpY2U7CmV4cG9ydHMudHJlZW1hcFNxdWFyaWZ5ID0gc3F1YXJpZnk7CmV4cG9ydHMudHJlZW1hcFJlc3F1YXJpZnkgPSByZXNxdWFyaWZ5OwpleHBvcnRzLmludGVycG9sYXRlID0gaW50ZXJwb2xhdGVWYWx1ZTsKZXhwb3J0cy5pbnRlcnBvbGF0ZUFycmF5ID0gYXJyYXkkMTsKZXhwb3J0cy5pbnRlcnBvbGF0ZUJhc2lzID0gYmFzaXMkMTsKZXhwb3J0cy5pbnRlcnBvbGF0ZUJhc2lzQ2xvc2VkID0gYmFzaXNDbG9zZWQ7CmV4cG9ydHMuaW50ZXJwb2xhdGVEYXRlID0gZGF0ZTsKZXhwb3J0cy5pbnRlcnBvbGF0ZU51bWJlciA9IHJlaW50ZXJwb2xhdGU7CmV4cG9ydHMuaW50ZXJwb2xhdGVPYmplY3QgPSBvYmplY3Q7CmV4cG9ydHMuaW50ZXJwb2xhdGVSb3VuZCA9IGludGVycG9sYXRlUm91bmQ7CmV4cG9ydHMuaW50ZXJwb2xhdGVTdHJpbmcgPSBpbnRlcnBvbGF0ZVN0cmluZzsKZXhwb3J0cy5pbnRlcnBvbGF0ZVRyYW5zZm9ybUNzcyA9IGludGVycG9sYXRlVHJhbnNmb3JtQ3NzOwpleHBvcnRzLmludGVycG9sYXRlVHJhbnNmb3JtU3ZnID0gaW50ZXJwb2xhdGVUcmFuc2Zvcm1Tdmc7CmV4cG9ydHMuaW50ZXJwb2xhdGVab29tID0gaW50ZXJwb2xhdGVab29tOwpleHBvcnRzLmludGVycG9sYXRlUmdiID0gaW50ZXJwb2xhdGVSZ2I7CmV4cG9ydHMuaW50ZXJwb2xhdGVSZ2JCYXNpcyA9IHJnYkJhc2lzOwpleHBvcnRzLmludGVycG9sYXRlUmdiQmFzaXNDbG9zZWQgPSByZ2JCYXNpc0Nsb3NlZDsKZXhwb3J0cy5pbnRlcnBvbGF0ZUhzbCA9IGhzbCQyOwpleHBvcnRzLmludGVycG9sYXRlSHNsTG9uZyA9IGhzbExvbmc7CmV4cG9ydHMuaW50ZXJwb2xhdGVMYWIgPSBsYWIkMTsKZXhwb3J0cy5pbnRlcnBvbGF0ZUhjbCA9IGhjbCQyOwpleHBvcnRzLmludGVycG9sYXRlSGNsTG9uZyA9IGhjbExvbmc7CmV4cG9ydHMuaW50ZXJwb2xhdGVDdWJlaGVsaXggPSBjdWJlaGVsaXgkMjsKZXhwb3J0cy5pbnRlcnBvbGF0ZUN1YmVoZWxpeExvbmcgPSBjdWJlaGVsaXhMb25nOwpleHBvcnRzLnF1YW50aXplID0gcXVhbnRpemU7CmV4cG9ydHMucGF0aCA9IHBhdGg7CmV4cG9ydHMucG9seWdvbkFyZWEgPSBhcmVhJDI7CmV4cG9ydHMucG9seWdvbkNlbnRyb2lkID0gY2VudHJvaWQkMTsKZXhwb3J0cy5wb2x5Z29uSHVsbCA9IGh1bGw7CmV4cG9ydHMucG9seWdvbkNvbnRhaW5zID0gY29udGFpbnMkMjsKZXhwb3J0cy5wb2x5Z29uTGVuZ3RoID0gbGVuZ3RoJDI7CmV4cG9ydHMucXVhZHRyZWUgPSBxdWFkdHJlZTsKZXhwb3J0cy5yYW5kb21Vbmlmb3JtID0gdW5pZm9ybTsKZXhwb3J0cy5yYW5kb21Ob3JtYWwgPSBub3JtYWw7CmV4cG9ydHMucmFuZG9tTG9nTm9ybWFsID0gbG9nTm9ybWFsOwpleHBvcnRzLnJhbmRvbUJhdGVzID0gYmF0ZXM7CmV4cG9ydHMucmFuZG9tSXJ3aW5IYWxsID0gaXJ3aW5IYWxsOwpleHBvcnRzLnJhbmRvbUV4cG9uZW50aWFsID0gZXhwb25lbnRpYWwkMTsKZXhwb3J0cy5zY2FsZUJhbmQgPSBiYW5kOwpleHBvcnRzLnNjYWxlUG9pbnQgPSBwb2ludCQxOwpleHBvcnRzLnNjYWxlSWRlbnRpdHkgPSBpZGVudGl0eSQ2OwpleHBvcnRzLnNjYWxlTGluZWFyID0gbGluZWFyJDI7CmV4cG9ydHMuc2NhbGVMb2cgPSBsb2ckMTsKZXhwb3J0cy5zY2FsZU9yZGluYWwgPSBvcmRpbmFsOwpleHBvcnRzLnNjYWxlSW1wbGljaXQgPSBpbXBsaWNpdDsKZXhwb3J0cy5zY2FsZVBvdyA9IHBvdyQxOwpleHBvcnRzLnNjYWxlU3FydCA9IHNxcnQkMTsKZXhwb3J0cy5zY2FsZVF1YW50aWxlID0gcXVhbnRpbGUkJDE7CmV4cG9ydHMuc2NhbGVRdWFudGl6ZSA9IHF1YW50aXplJDE7CmV4cG9ydHMuc2NhbGVUaHJlc2hvbGQgPSB0aHJlc2hvbGQkMTsKZXhwb3J0cy5zY2FsZVRpbWUgPSB0aW1lOwpleHBvcnRzLnNjYWxlVXRjID0gdXRjVGltZTsKZXhwb3J0cy5zY2FsZVNlcXVlbnRpYWwgPSBzZXF1ZW50aWFsOwpleHBvcnRzLnNjaGVtZUNhdGVnb3J5MTAgPSBjYXRlZ29yeTEwOwpleHBvcnRzLnNjaGVtZUFjY2VudCA9IEFjY2VudDsKZXhwb3J0cy5zY2hlbWVEYXJrMiA9IERhcmsyOwpleHBvcnRzLnNjaGVtZVBhaXJlZCA9IFBhaXJlZDsKZXhwb3J0cy5zY2hlbWVQYXN0ZWwxID0gUGFzdGVsMTsKZXhwb3J0cy5zY2hlbWVQYXN0ZWwyID0gUGFzdGVsMjsKZXhwb3J0cy5zY2hlbWVTZXQxID0gU2V0MTsKZXhwb3J0cy5zY2hlbWVTZXQyID0gU2V0MjsKZXhwb3J0cy5zY2hlbWVTZXQzID0gU2V0MzsKZXhwb3J0cy5pbnRlcnBvbGF0ZUJyQkcgPSBCckJHOwpleHBvcnRzLnNjaGVtZUJyQkcgPSBzY2hlbWU7CmV4cG9ydHMuaW50ZXJwb2xhdGVQUkduID0gUFJHbjsKZXhwb3J0cy5zY2hlbWVQUkduID0gc2NoZW1lJDE7CmV4cG9ydHMuaW50ZXJwb2xhdGVQaVlHID0gUGlZRzsKZXhwb3J0cy5zY2hlbWVQaVlHID0gc2NoZW1lJDI7CmV4cG9ydHMuaW50ZXJwb2xhdGVQdU9yID0gUHVPcjsKZXhwb3J0cy5zY2hlbWVQdU9yID0gc2NoZW1lJDM7CmV4cG9ydHMuaW50ZXJwb2xhdGVSZEJ1ID0gUmRCdTsKZXhwb3J0cy5zY2hlbWVSZEJ1ID0gc2NoZW1lJDQ7CmV4cG9ydHMuaW50ZXJwb2xhdGVSZEd5ID0gUmRHeTsKZXhwb3J0cy5zY2hlbWVSZEd5ID0gc2NoZW1lJDU7CmV4cG9ydHMuaW50ZXJwb2xhdGVSZFlsQnUgPSBSZFlsQnU7CmV4cG9ydHMuc2NoZW1lUmRZbEJ1ID0gc2NoZW1lJDY7CmV4cG9ydHMuaW50ZXJwb2xhdGVSZFlsR24gPSBSZFlsR247CmV4cG9ydHMuc2NoZW1lUmRZbEduID0gc2NoZW1lJDc7CmV4cG9ydHMuaW50ZXJwb2xhdGVTcGVjdHJhbCA9IFNwZWN0cmFsOwpleHBvcnRzLnNjaGVtZVNwZWN0cmFsID0gc2NoZW1lJDg7CmV4cG9ydHMuaW50ZXJwb2xhdGVCdUduID0gQnVHbjsKZXhwb3J0cy5zY2hlbWVCdUduID0gc2NoZW1lJDk7CmV4cG9ydHMuaW50ZXJwb2xhdGVCdVB1ID0gQnVQdTsKZXhwb3J0cy5zY2hlbWVCdVB1ID0gc2NoZW1lJDEwOwpleHBvcnRzLmludGVycG9sYXRlR25CdSA9IEduQnU7CmV4cG9ydHMuc2NoZW1lR25CdSA9IHNjaGVtZSQxMTsKZXhwb3J0cy5pbnRlcnBvbGF0ZU9yUmQgPSBPclJkOwpleHBvcnRzLnNjaGVtZU9yUmQgPSBzY2hlbWUkMTI7CmV4cG9ydHMuaW50ZXJwb2xhdGVQdUJ1R24gPSBQdUJ1R247CmV4cG9ydHMuc2NoZW1lUHVCdUduID0gc2NoZW1lJDEzOwpleHBvcnRzLmludGVycG9sYXRlUHVCdSA9IFB1QnU7CmV4cG9ydHMuc2NoZW1lUHVCdSA9IHNjaGVtZSQxNDsKZXhwb3J0cy5pbnRlcnBvbGF0ZVB1UmQgPSBQdVJkOwpleHBvcnRzLnNjaGVtZVB1UmQgPSBzY2hlbWUkMTU7CmV4cG9ydHMuaW50ZXJwb2xhdGVSZFB1ID0gUmRQdTsKZXhwb3J0cy5zY2hlbWVSZFB1ID0gc2NoZW1lJDE2OwpleHBvcnRzLmludGVycG9sYXRlWWxHbkJ1ID0gWWxHbkJ1OwpleHBvcnRzLnNjaGVtZVlsR25CdSA9IHNjaGVtZSQxNzsKZXhwb3J0cy5pbnRlcnBvbGF0ZVlsR24gPSBZbEduOwpleHBvcnRzLnNjaGVtZVlsR24gPSBzY2hlbWUkMTg7CmV4cG9ydHMuaW50ZXJwb2xhdGVZbE9yQnIgPSBZbE9yQnI7CmV4cG9ydHMuc2NoZW1lWWxPckJyID0gc2NoZW1lJDE5OwpleHBvcnRzLmludGVycG9sYXRlWWxPclJkID0gWWxPclJkOwpleHBvcnRzLnNjaGVtZVlsT3JSZCA9IHNjaGVtZSQyMDsKZXhwb3J0cy5pbnRlcnBvbGF0ZUJsdWVzID0gQmx1ZXM7CmV4cG9ydHMuc2NoZW1lQmx1ZXMgPSBzY2hlbWUkMjE7CmV4cG9ydHMuaW50ZXJwb2xhdGVHcmVlbnMgPSBHcmVlbnM7CmV4cG9ydHMuc2NoZW1lR3JlZW5zID0gc2NoZW1lJDIyOwpleHBvcnRzLmludGVycG9sYXRlR3JleXMgPSBHcmV5czsKZXhwb3J0cy5zY2hlbWVHcmV5cyA9IHNjaGVtZSQyMzsKZXhwb3J0cy5pbnRlcnBvbGF0ZVB1cnBsZXMgPSBQdXJwbGVzOwpleHBvcnRzLnNjaGVtZVB1cnBsZXMgPSBzY2hlbWUkMjQ7CmV4cG9ydHMuaW50ZXJwb2xhdGVSZWRzID0gUmVkczsKZXhwb3J0cy5zY2hlbWVSZWRzID0gc2NoZW1lJDI1OwpleHBvcnRzLmludGVycG9sYXRlT3JhbmdlcyA9IE9yYW5nZXM7CmV4cG9ydHMuc2NoZW1lT3JhbmdlcyA9IHNjaGVtZSQyNjsKZXhwb3J0cy5pbnRlcnBvbGF0ZUN1YmVoZWxpeERlZmF1bHQgPSBjdWJlaGVsaXgkMzsKZXhwb3J0cy5pbnRlcnBvbGF0ZVJhaW5ib3cgPSByYWluYm93JDE7CmV4cG9ydHMuaW50ZXJwb2xhdGVXYXJtID0gd2FybTsKZXhwb3J0cy5pbnRlcnBvbGF0ZUNvb2wgPSBjb29sOwpleHBvcnRzLmludGVycG9sYXRlVmlyaWRpcyA9IHZpcmlkaXM7CmV4cG9ydHMuaW50ZXJwb2xhdGVNYWdtYSA9IG1hZ21hOwpleHBvcnRzLmludGVycG9sYXRlSW5mZXJubyA9IGluZmVybm87CmV4cG9ydHMuaW50ZXJwb2xhdGVQbGFzbWEgPSBwbGFzbWE7CmV4cG9ydHMuY3JlYXRlID0gY3JlYXRlOwpleHBvcnRzLmNyZWF0b3IgPSBjcmVhdG9yOwpleHBvcnRzLmxvY2FsID0gbG9jYWw7CmV4cG9ydHMubWF0Y2hlciA9IG1hdGNoZXIkMTsKZXhwb3J0cy5tb3VzZSA9IG1vdXNlOwpleHBvcnRzLm5hbWVzcGFjZSA9IG5hbWVzcGFjZTsKZXhwb3J0cy5uYW1lc3BhY2VzID0gbmFtZXNwYWNlczsKZXhwb3J0cy5jbGllbnRQb2ludCA9IHBvaW50OwpleHBvcnRzLnNlbGVjdCA9IHNlbGVjdDsKZXhwb3J0cy5zZWxlY3RBbGwgPSBzZWxlY3RBbGw7CmV4cG9ydHMuc2VsZWN0aW9uID0gc2VsZWN0aW9uOwpleHBvcnRzLnNlbGVjdG9yID0gc2VsZWN0b3I7CmV4cG9ydHMuc2VsZWN0b3JBbGwgPSBzZWxlY3RvckFsbDsKZXhwb3J0cy5zdHlsZSA9IHN0eWxlVmFsdWU7CmV4cG9ydHMudG91Y2ggPSB0b3VjaDsKZXhwb3J0cy50b3VjaGVzID0gdG91Y2hlczsKZXhwb3J0cy53aW5kb3cgPSBkZWZhdWx0VmlldzsKZXhwb3J0cy5jdXN0b21FdmVudCA9IGN1c3RvbUV2ZW50OwpleHBvcnRzLmFyYyA9IGFyYzsKZXhwb3J0cy5hcmVhID0gYXJlYSQzOwpleHBvcnRzLmxpbmUgPSBsaW5lOwpleHBvcnRzLnBpZSA9IHBpZTsKZXhwb3J0cy5hcmVhUmFkaWFsID0gYXJlYVJhZGlhbDsKZXhwb3J0cy5yYWRpYWxBcmVhID0gYXJlYVJhZGlhbDsKZXhwb3J0cy5saW5lUmFkaWFsID0gbGluZVJhZGlhbCQxOwpleHBvcnRzLnJhZGlhbExpbmUgPSBsaW5lUmFkaWFsJDE7CmV4cG9ydHMucG9pbnRSYWRpYWwgPSBwb2ludFJhZGlhbDsKZXhwb3J0cy5saW5rSG9yaXpvbnRhbCA9IGxpbmtIb3Jpem9udGFsOwpleHBvcnRzLmxpbmtWZXJ0aWNhbCA9IGxpbmtWZXJ0aWNhbDsKZXhwb3J0cy5saW5rUmFkaWFsID0gbGlua1JhZGlhbDsKZXhwb3J0cy5zeW1ib2wgPSBzeW1ib2w7CmV4cG9ydHMuc3ltYm9scyA9IHN5bWJvbHM7CmV4cG9ydHMuc3ltYm9sQ2lyY2xlID0gY2lyY2xlJDI7CmV4cG9ydHMuc3ltYm9sQ3Jvc3MgPSBjcm9zcyQyOwpleHBvcnRzLnN5bWJvbERpYW1vbmQgPSBkaWFtb25kOwpleHBvcnRzLnN5bWJvbFNxdWFyZSA9IHNxdWFyZTsKZXhwb3J0cy5zeW1ib2xTdGFyID0gc3RhcjsKZXhwb3J0cy5zeW1ib2xUcmlhbmdsZSA9IHRyaWFuZ2xlOwpleHBvcnRzLnN5bWJvbFd5ZSA9IHd5ZTsKZXhwb3J0cy5jdXJ2ZUJhc2lzQ2xvc2VkID0gYmFzaXNDbG9zZWQkMTsKZXhwb3J0cy5jdXJ2ZUJhc2lzT3BlbiA9IGJhc2lzT3BlbjsKZXhwb3J0cy5jdXJ2ZUJhc2lzID0gYmFzaXMkMjsKZXhwb3J0cy5jdXJ2ZUJ1bmRsZSA9IGJ1bmRsZTsKZXhwb3J0cy5jdXJ2ZUNhcmRpbmFsQ2xvc2VkID0gY2FyZGluYWxDbG9zZWQ7CmV4cG9ydHMuY3VydmVDYXJkaW5hbE9wZW4gPSBjYXJkaW5hbE9wZW47CmV4cG9ydHMuY3VydmVDYXJkaW5hbCA9IGNhcmRpbmFsOwpleHBvcnRzLmN1cnZlQ2F0bXVsbFJvbUNsb3NlZCA9IGNhdG11bGxSb21DbG9zZWQ7CmV4cG9ydHMuY3VydmVDYXRtdWxsUm9tT3BlbiA9IGNhdG11bGxSb21PcGVuOwpleHBvcnRzLmN1cnZlQ2F0bXVsbFJvbSA9IGNhdG11bGxSb207CmV4cG9ydHMuY3VydmVMaW5lYXJDbG9zZWQgPSBsaW5lYXJDbG9zZWQ7CmV4cG9ydHMuY3VydmVMaW5lYXIgPSBjdXJ2ZUxpbmVhcjsKZXhwb3J0cy5jdXJ2ZU1vbm90b25lWCA9IG1vbm90b25lWDsKZXhwb3J0cy5jdXJ2ZU1vbm90b25lWSA9IG1vbm90b25lWTsKZXhwb3J0cy5jdXJ2ZU5hdHVyYWwgPSBuYXR1cmFsOwpleHBvcnRzLmN1cnZlU3RlcCA9IHN0ZXA7CmV4cG9ydHMuY3VydmVTdGVwQWZ0ZXIgPSBzdGVwQWZ0ZXI7CmV4cG9ydHMuY3VydmVTdGVwQmVmb3JlID0gc3RlcEJlZm9yZTsKZXhwb3J0cy5zdGFjayA9IHN0YWNrOwpleHBvcnRzLnN0YWNrT2Zmc2V0RXhwYW5kID0gZXhwYW5kOwpleHBvcnRzLnN0YWNrT2Zmc2V0RGl2ZXJnaW5nID0gZGl2ZXJnaW5nOwpleHBvcnRzLnN0YWNrT2Zmc2V0Tm9uZSA9IG5vbmUkMTsKZXhwb3J0cy5zdGFja09mZnNldFNpbGhvdWV0dGUgPSBzaWxob3VldHRlOwpleHBvcnRzLnN0YWNrT2Zmc2V0V2lnZ2xlID0gd2lnZ2xlOwpleHBvcnRzLnN0YWNrT3JkZXJBc2NlbmRpbmcgPSBhc2NlbmRpbmckMzsKZXhwb3J0cy5zdGFja09yZGVyRGVzY2VuZGluZyA9IGRlc2NlbmRpbmckMjsKZXhwb3J0cy5zdGFja09yZGVySW5zaWRlT3V0ID0gaW5zaWRlT3V0OwpleHBvcnRzLnN0YWNrT3JkZXJOb25lID0gbm9uZSQyOwpleHBvcnRzLnN0YWNrT3JkZXJSZXZlcnNlID0gcmV2ZXJzZTsKZXhwb3J0cy50aW1lSW50ZXJ2YWwgPSBuZXdJbnRlcnZhbDsKZXhwb3J0cy50aW1lTWlsbGlzZWNvbmQgPSBtaWxsaXNlY29uZDsKZXhwb3J0cy50aW1lTWlsbGlzZWNvbmRzID0gbWlsbGlzZWNvbmRzOwpleHBvcnRzLnV0Y01pbGxpc2Vjb25kID0gbWlsbGlzZWNvbmQ7CmV4cG9ydHMudXRjTWlsbGlzZWNvbmRzID0gbWlsbGlzZWNvbmRzOwpleHBvcnRzLnRpbWVTZWNvbmQgPSBzZWNvbmQ7CmV4cG9ydHMudGltZVNlY29uZHMgPSBzZWNvbmRzOwpleHBvcnRzLnV0Y1NlY29uZCA9IHNlY29uZDsKZXhwb3J0cy51dGNTZWNvbmRzID0gc2Vjb25kczsKZXhwb3J0cy50aW1lTWludXRlID0gbWludXRlOwpleHBvcnRzLnRpbWVNaW51dGVzID0gbWludXRlczsKZXhwb3J0cy50aW1lSG91ciA9IGhvdXI7CmV4cG9ydHMudGltZUhvdXJzID0gaG91cnM7CmV4cG9ydHMudGltZURheSA9IGRheTsKZXhwb3J0cy50aW1lRGF5cyA9IGRheXM7CmV4cG9ydHMudGltZVdlZWsgPSBzdW5kYXk7CmV4cG9ydHMudGltZVdlZWtzID0gc3VuZGF5czsKZXhwb3J0cy50aW1lU3VuZGF5ID0gc3VuZGF5OwpleHBvcnRzLnRpbWVTdW5kYXlzID0gc3VuZGF5czsKZXhwb3J0cy50aW1lTW9uZGF5ID0gbW9uZGF5OwpleHBvcnRzLnRpbWVNb25kYXlzID0gbW9uZGF5czsKZXhwb3J0cy50aW1lVHVlc2RheSA9IHR1ZXNkYXk7CmV4cG9ydHMudGltZVR1ZXNkYXlzID0gdHVlc2RheXM7CmV4cG9ydHMudGltZVdlZG5lc2RheSA9IHdlZG5lc2RheTsKZXhwb3J0cy50aW1lV2VkbmVzZGF5cyA9IHdlZG5lc2RheXM7CmV4cG9ydHMudGltZVRodXJzZGF5ID0gdGh1cnNkYXk7CmV4cG9ydHMudGltZVRodXJzZGF5cyA9IHRodXJzZGF5czsKZXhwb3J0cy50aW1lRnJpZGF5ID0gZnJpZGF5OwpleHBvcnRzLnRpbWVGcmlkYXlzID0gZnJpZGF5czsKZXhwb3J0cy50aW1lU2F0dXJkYXkgPSBzYXR1cmRheTsKZXhwb3J0cy50aW1lU2F0dXJkYXlzID0gc2F0dXJkYXlzOwpleHBvcnRzLnRpbWVNb250aCA9IG1vbnRoOwpleHBvcnRzLnRpbWVNb250aHMgPSBtb250aHM7CmV4cG9ydHMudGltZVllYXIgPSB5ZWFyOwpleHBvcnRzLnRpbWVZZWFycyA9IHllYXJzOwpleHBvcnRzLnV0Y01pbnV0ZSA9IHV0Y01pbnV0ZTsKZXhwb3J0cy51dGNNaW51dGVzID0gdXRjTWludXRlczsKZXhwb3J0cy51dGNIb3VyID0gdXRjSG91cjsKZXhwb3J0cy51dGNIb3VycyA9IHV0Y0hvdXJzOwpleHBvcnRzLnV0Y0RheSA9IHV0Y0RheTsKZXhwb3J0cy51dGNEYXlzID0gdXRjRGF5czsKZXhwb3J0cy51dGNXZWVrID0gdXRjU3VuZGF5OwpleHBvcnRzLnV0Y1dlZWtzID0gdXRjU3VuZGF5czsKZXhwb3J0cy51dGNTdW5kYXkgPSB1dGNTdW5kYXk7CmV4cG9ydHMudXRjU3VuZGF5cyA9IHV0Y1N1bmRheXM7CmV4cG9ydHMudXRjTW9uZGF5ID0gdXRjTW9uZGF5OwpleHBvcnRzLnV0Y01vbmRheXMgPSB1dGNNb25kYXlzOwpleHBvcnRzLnV0Y1R1ZXNkYXkgPSB1dGNUdWVzZGF5OwpleHBvcnRzLnV0Y1R1ZXNkYXlzID0gdXRjVHVlc2RheXM7CmV4cG9ydHMudXRjV2VkbmVzZGF5ID0gdXRjV2VkbmVzZGF5OwpleHBvcnRzLnV0Y1dlZG5lc2RheXMgPSB1dGNXZWRuZXNkYXlzOwpleHBvcnRzLnV0Y1RodXJzZGF5ID0gdXRjVGh1cnNkYXk7CmV4cG9ydHMudXRjVGh1cnNkYXlzID0gdXRjVGh1cnNkYXlzOwpleHBvcnRzLnV0Y0ZyaWRheSA9IHV0Y0ZyaWRheTsKZXhwb3J0cy51dGNGcmlkYXlzID0gdXRjRnJpZGF5czsKZXhwb3J0cy51dGNTYXR1cmRheSA9IHV0Y1NhdHVyZGF5OwpleHBvcnRzLnV0Y1NhdHVyZGF5cyA9IHV0Y1NhdHVyZGF5czsKZXhwb3J0cy51dGNNb250aCA9IHV0Y01vbnRoOwpleHBvcnRzLnV0Y01vbnRocyA9IHV0Y01vbnRoczsKZXhwb3J0cy51dGNZZWFyID0gdXRjWWVhcjsKZXhwb3J0cy51dGNZZWFycyA9IHV0Y1llYXJzOwpleHBvcnRzLnRpbWVGb3JtYXREZWZhdWx0TG9jYWxlID0gZGVmYXVsdExvY2FsZSQxOwpleHBvcnRzLnRpbWVGb3JtYXRMb2NhbGUgPSBmb3JtYXRMb2NhbGUkMTsKZXhwb3J0cy5pc29Gb3JtYXQgPSBmb3JtYXRJc287CmV4cG9ydHMuaXNvUGFyc2UgPSBwYXJzZUlzbzsKZXhwb3J0cy5ub3cgPSBub3c7CmV4cG9ydHMudGltZXIgPSB0aW1lcjsKZXhwb3J0cy50aW1lckZsdXNoID0gdGltZXJGbHVzaDsKZXhwb3J0cy50aW1lb3V0ID0gdGltZW91dCQxOwpleHBvcnRzLmludGVydmFsID0gaW50ZXJ2YWwkMTsKZXhwb3J0cy50cmFuc2l0aW9uID0gdHJhbnNpdGlvbjsKZXhwb3J0cy5hY3RpdmUgPSBhY3RpdmU7CmV4cG9ydHMuaW50ZXJydXB0ID0gaW50ZXJydXB0OwpleHBvcnRzLnZvcm9ub2kgPSB2b3Jvbm9pOwpleHBvcnRzLnpvb20gPSB6b29tOwpleHBvcnRzLnpvb21UcmFuc2Zvcm0gPSB0cmFuc2Zvcm0kMTsKZXhwb3J0cy56b29tSWRlbnRpdHkgPSBpZGVudGl0eSQ4OwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTsKCn0pKSk7Cg=="></script>
<script src="data:application/x-javascript;base64,LyogIENvcHlyaWdodCAyMDE5IExha3NoYXkgQW5hbmQuDQogICAgQWxsIHJpZ2h0cyByZXNlcnZlZC4NCg0KICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5DQogICAgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkNCiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcg0KICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uDQoNCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwNCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZg0KICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUNCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLg0KDQogICAgVG8gdmlldyBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSAgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4NCg0KICAgIFRoZSBjaHJvbW9NYXAuanMgSmF2YXNjcmlwdCBsaWJyYXJ5IGRlcGVuZHMgb24gYW4gb3BlbiBzb3VyY2Ugc29mdHdhcmUgY29tcG9uZW50Lg0KICAgIGQzLmpzICwgIGh0dHBzOi8vZ2l0aHViLmNvbS9kMy9kMw0KDQogIGQzIGxpY2Vuc2UNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCkNvcHlyaWdodCAyMDEwLTIwMTcgTWlrZSBCb3N0b2NrDQpBbGwgcmlnaHRzIHJlc2VydmVkLg0KDQpSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQgbW9kaWZpY2F0aW9uLA0KYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0Og0KDQoqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpcw0KICBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4NCg0KKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsDQogIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24NCiAgYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uDQoNCiogTmVpdGhlciB0aGUgbmFtZSBvZiB0aGUgYXV0aG9yIG5vciB0aGUgbmFtZXMgb2YgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvDQogIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yDQogIHdyaXR0ZW4gcGVybWlzc2lvbi4NCg0KVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAiQVMgSVMiIEFORA0KQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQNCldBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUNCkRJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgT1dORVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1INCkFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUw0KKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOw0KTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9ODQpBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVA0KKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMNClNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLg0KDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogKi8NCg0KDQovKiBHbG9iYWwgdmFyaWFibGVzICovDQoNCnZhciBjb2xvcnM9W10sY2hEYXRhUmVkdWNlZCxjaHJfc3BhY2luZyx5X3ZhbCxjaF93aWR0aCxsb2NpX3dpZHRoLHRvcF9tYXJnaW4sbGVmdF9tYXJnaW4seF9zY2FsZV9wb3MsY2hMaW5HcmFkVj1bXSx0aW1lczsNCg0KLy9MT0dJQyBGT1IgVEhFIENIUk9NT01BUA0KDQpmdW5jdGlvbiBjaHJvbW9NYXAoY2hEYXRhLG5Mb2NpLHBsb2lkeV9uLHRpdGxlLGNudCxjaF9nYXAsdG9wX21hcmdpbixsZWZ0X21hcmdpbixjaHJfd2lkdGgsY2hyX2xlbmd0aCxjaHJfY29sLGhlYXRtYXAsdl9hbGlnbixjaF9kb21haW4sbGdfeCxsZ195LGhlYXRfc2NhbGUsbGFiZWxzLGRpdl9pZCx3aWR0aCxoZWlnaHQscm5nLGhlYXRfY29sLGFuX2NvbCxjaF90ZXh0LGxlZ2VuZCxhZ2dyZWdhdGVfZnVuYyl7DQoNCg0KDQoNCiAgICAvL3N3YXBwaW5nIG1hcmdpbnMNCiAgaWYodl9hbGlnbil7DQogICAgdmFyIHQ9dG9wX21hcmdpbjsNCiAgICB0b3BfbWFyZ2luPWxlZnRfbWFyZ2luOw0KICAgIGxlZnRfbWFyZ2luPXQ7DQoNCiAgfQ0KDQoNCg0KDQogICAgaWYoIWxhYmVscyl7DQogICAgICB5X3ZhbCA9IHRvcF9tYXJnaW47DQogICAgfSBlbHNlIHsNCg0KICAgICAgeV92YWwgPSB0b3BfbWFyZ2luKzEwOw0KICAgIH0NCg0KDQoNCg0KICAgIGNoX3dpZHRoID0gY2hyX3dpZHRoOyAvKmhlaWdodCBvZiBjaHJvbW9zb21lIGJhciAqLw0KICAgIGFyY19yYWRpdXM9Y2hyX3dpZHRoLzI7DQoNCiAgICBsb2NpX3dpZHRoPWNocl9sZW5ndGg7IC8qd2lkaHQgb2YgZWFjaCBsb2NpIGRldGVybWluZWQgZm9yIGNoIGxlbmd0aCAqLw0KDQoNCg0KDQoNCiAgICBpZighbGFiZWxzKXsNCiAgICAgIGNocl9zcGFjaW5nPSBwbG9pZHlfbipjaHJfd2lkdGggKyBwbG9pZHlfbiArIGNoX2dhcDsNCn0gZWxzZSB7DQogIGNocl9zcGFjaW5nPSBwbG9pZHlfbipjaHJfd2lkdGggKyBwbG9pZHlfbiArIGNoX2dhcCoyOw0KfQ0KDQoNCiAgICB0dGw9dGl0bGU7DQogICAgdmFyIGFyYyA9IGQzLmFyYygpDQogLmlubmVyUmFkaXVzKDApDQogLm91dGVyUmFkaXVzKGFyY19yYWRpdXMpDQogLnN0YXJ0QW5nbGUoMCkNCiAuZW5kQW5nbGUoTWF0aC5QSSk7DQoNCiB2YXIgYXJjTGVmdCA9IGQzLmFyYygpDQogLmlubmVyUmFkaXVzKDApDQogLm91dGVyUmFkaXVzKGFyY19yYWRpdXMpDQogLnN0YXJ0QW5nbGUoTWF0aC5QSSkNCiAuZW5kQW5nbGUoMipNYXRoLlBJKTsNCg0KIHZhciBhcmNUb3AgPSBkMy5hcmMoKQ0KIC5pbm5lclJhZGl1cygwKQ0KIC5vdXRlclJhZGl1cyhhcmNfcmFkaXVzKQ0KIC5zdGFydEFuZ2xlKC1NYXRoLlBJLzIpDQogLmVuZEFuZ2xlKE1hdGguUEkvMik7DQoNCiB2YXIgYXJjQm90ID0gZDMuYXJjKCkNCiAuaW5uZXJSYWRpdXMoMCkNCiAub3V0ZXJSYWRpdXMoYXJjX3JhZGl1cykNCiAuc3RhcnRBbmdsZShNYXRoLlBJLzIpDQogLmVuZEFuZ2xlKCgzKk1hdGguUEkpLzIpOw0KDQoNCg0KDQp2YXIgY2htYXBfZGl2ID0gZDMuc2VsZWN0KCIjIitkaXZfaWQpOw0KDQp2YXIgc3ZnID0gY2htYXBfZGl2LmFwcGVuZCgic3ZnIikNCiAgICAgICAgICAgICAgICAgICAuYXR0cigid2lkdGgiLHdpZHRoKQ0KICAgICAgICAgICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLGhlaWdodCk7DQoNCg0KDQoNCg0KICAgIGlmKCF2X2FsaWduKXsNCiAgICAvKiBBZGRpbmcgdGl0bGUgKi8NCiAgICBzdmcuYXBwZW5kKCJ0ZXh0IikNCiAgICAuYXR0cigieCIsd2lkdGgvMikNCiAgICAuYXR0cigieSIsKHRvcF9tYXJnaW4vMikpDQogICAgLmF0dHIoImZvbnQtZmFtaWx5IiwgInNhbnMtc2VyaWYiKQ0KICAgIC5hdHRyKCJmb250LXNpemUiLCAiMTJweCIpDQogICAgLmF0dHIoImZpbGwiLCAiYmxhY2siKQ0KICAgIC5zdHlsZSgidGV4dC1hbmNob3IiLCAibWlkZGxlIikNCiAgICAudGV4dCh0dGwpOw0KfSBlbHNlIHsNCiAgc3ZnLmFwcGVuZCgidGV4dCIpDQogIC5hdHRyKCJ4Iix3aWR0aC8yKQ0KICAuYXR0cigieSIsKGxlZnRfbWFyZ2luLzMpKQ0KICAuYXR0cigiZm9udC1mYW1pbHkiLCAic2Fucy1zZXJpZiIpDQogIC5hdHRyKCJmb250LXNpemUiLCAiMTJweCIpDQogIC5hdHRyKCJmaWxsIiwgImJsYWNrIikNCiAgLnN0eWxlKCJ0ZXh0LWFuY2hvciIsICJtaWRkbGUiKQ0KICAudGV4dCh0dGwpOw0KDQp9DQoNCg0KICAgaWYoIXZfYWxpZ24pew0KICAgIC8qYWRkaW5nIGF4ZXMgICovDQogICAgeF9zY2FsZV9wb3M9KCB0b3BfbWFyZ2luKyhjaHJfc3BhY2luZykqbkxvY2lbMF0ubGVuZ3RoKzEwKTsNCg0KDQogICAgbm5tYXg9IDEwMDsNCg0KICAgIGlmKGNudCl7DQogICAgeF9zY2FsZV93aWR0aD0gKG5ubWF4KSpsb2NpX3dpZHRoICsgMyphcmNfcmFkaXVzOw0KICAgIH0gZWxzZSB7DQogICAgICB4X3NjYWxlX3dpZHRoPSAobm5tYXgpKmxvY2lfd2lkdGggKyBhcmNfcmFkaXVzOw0KICAgIH0NCiAgICAvLyBDcmVhdGUgc2NhbGUNCiAgICB2YXIgc2NhbGUgPSBkMy5zY2FsZUxpbmVhcigpDQogICAgICAgICAgICAgICAgICAuZG9tYWluKGNoX2RvbWFpbikubmljZSgpDQogICAgICAgICAgICAgICAgICAucmFuZ2UoWzAsIHhfc2NhbGVfd2lkdGhdKTsNCg0KICAgIC8vIEFkZCBzY2FsZXMgdG8gYXhpcw0KICAgIHZhciB4X2F4aXMgPSBkMy5heGlzQm90dG9tKCkNCiAgICAgICAgICAgICAgICAgLnNjYWxlKHNjYWxlKQ0KICAgICAgICAgICAgICAgICAudGlja3MoNSkNCiAgICAgICAgICAgICAgICAgLnRpY2tGb3JtYXQoZnVuY3Rpb24oZCl7DQogICAgICAgICAgICAgICAgICAgaWYoZD49MTAwMDAwMDAwMCl7IHJldHVybiAoZC8xMDAwMDAwMDAwKSsiR2IiDQogICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKGQ+PTEwMDAwMDApew0KDQogICAgICAgICAgICAgICAgICAgcmV0dXJuIChkLzEwMDAwMDApKyJNYiI7DQogICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZD49MTAwMCkgew0KICAgICAgICAgICAgICAgICAgIHJldHVybiAoZC8xMDAwKSsia2IiOw0KICAgICAgICAgICAgICAgICB9IGVsc2UgeyByZXR1cm4gZCsiYnAiO319KTsNCg0KICAgIC8vQXBwZW5kIGdyb3VwIGFuZCBpbnNlcnQgYXhpcw0KICAgIHN2Zy5hcHBlbmQoImciKQ0KICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKCIrKGxlZnRfbWFyZ2luIC0gYXJjX3JhZGl1cykrIiwiICsgeF9zY2FsZV9wb3MgKyAiKSIpDQogICAgLmNhbGwoeF9heGlzKTsNCg0KDQogICAgLyogYXhpcyB0aXRsZSAqLw0KICAgIHN2Zy5hcHBlbmQoInRleHQiKQ0KICAgIC5hdHRyKCJ4Iix4X3NjYWxlX3dpZHRoLzIpDQogICAgLmF0dHIoInkiLHhfc2NhbGVfcG9zICsgMzUpDQogICAgLmF0dHIoImZvbnQtZmFtaWx5IiwgInNhbnMtc2VyaWYiKQ0KICAgIC5hdHRyKCJmb250LXNpemUiLCAiMTJweCIpDQogICAgLmF0dHIoImZpbGwiLCAiYmxhY2siKQ0KICAgIC5zdHlsZSgidGV4dC1hbmNob3IiLCAibWlkZGxlIikNCiAgICAudGV4dCgiTGVuZ3RoIChicCkiKTsNCg0KfSBlbHNlIHsNCg0KLyphZGRpbmcgYXhlcyAgKi8NCnhfc2NhbGVfcG9zPSggdG9wX21hcmdpbisoY2hyX3NwYWNpbmcpKm5Mb2NpWzBdLmxlbmd0aCsxMCk7DQoNCg0KDQpubm1heD0gMTAwOw0KDQppZihjbnQpew0KeF9zY2FsZV93aWR0aD0gKG5ubWF4KSpsb2NpX3dpZHRoICsgMyphcmNfcmFkaXVzOw0KfSBlbHNlIHsNCiAgeF9zY2FsZV93aWR0aD0gKG5ubWF4KSpsb2NpX3dpZHRoICsgYXJjX3JhZGl1czsNCn0NCi8vIENyZWF0ZSBzY2FsZQ0KdmFyIHNjYWxlID0gZDMuc2NhbGVMaW5lYXIoKQ0KICAgICAgICAgICAgICAuZG9tYWluKGNoX2RvbWFpbikubmljZSgpDQogICAgICAgICAgICAgIC5yYW5nZShbMCwgeF9zY2FsZV93aWR0aF0pOw0KDQovLyBBZGQgc2NhbGVzIHRvIGF4aXMNCnZhciB4X2F4aXMgPSBkMy5heGlzUmlnaHQoKQ0KICAgICAgICAgICAgIC5zY2FsZShzY2FsZSkNCiAgICAgICAgICAgICAudGlja3MoNSkNCiAgICAgICAgICAgICAudGlja0Zvcm1hdChmdW5jdGlvbihkKXsNCiAgICAgICAgICAgICAgIGlmKGQ+PTEwMDAwMDAwMDApeyByZXR1cm4gKGQvMTAwMDAwMDAwMCkrIkdiIg0KICAgICAgICAgICAgICAgfSBlbHNlIGlmKGQ+PTEwMDAwMDApew0KDQogICAgICAgICAgICAgICByZXR1cm4gKGQvMTAwMDAwMCkrIk1iIjsNCiAgICAgICAgICAgICB9IGVsc2UgaWYgKGQ+PTEwMDApIHsNCiAgICAgICAgICAgICAgIHJldHVybiAoZC8xMDAwKSsia2IiOw0KICAgICAgICAgICAgIH0gZWxzZSB7IHJldHVybiBkKyJicCI7fX0pOw0KDQovL0FwcGVuZCBncm91cCBhbmQgaW5zZXJ0IGF4aXMNCnN2Zy5hcHBlbmQoImciKQ0KLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoIit4X3NjYWxlX3BvcysiLCIgKyAobGVmdF9tYXJnaW4gLSBhcmNfcmFkaXVzKSArICIpIikNCi5jYWxsKHhfYXhpcykuc2VsZWN0QWxsKCJ0ZXh0IikuYXR0cigidHJhbnNmb3JtIiwgInJvdGF0ZSg5MCkiKS5hdHRyKCJ5IiwgLTEyKS5zdHlsZSgidGV4dC1hbmNob3IiLCAibWlkZGxlIik7DQoNCg0KLyogYXhpcyB0aXRsZSAqLw0Kc3ZnLmFwcGVuZCgidGV4dCIpDQouYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiKyh4X3NjYWxlX3BvcyArIDM1KSsiLCIgKyAoeF9zY2FsZV93aWR0aC8yKSArICIpIHJvdGF0ZSg5MCkiKQ0KLmF0dHIoImZvbnQtZmFtaWx5IiwgInNhbnMtc2VyaWYiKQ0KLmF0dHIoImZvbnQtc2l6ZSIsICIxMnB4IikNCi5hdHRyKCJmaWxsIiwgImJsYWNrIikNCi5zdHlsZSgidGV4dC1hbmNob3IiLCAibWlkZGxlIikNCi50ZXh0KCIgTGVuZ3RoIChicCkiKTsNCg0KDQoNCg0KfQ0KDQoNCg0KDQoNCg0KDQovKiAgUmVuZGVyaW5nIGNocm9tb01hcCAgKi8NCiAgIHU9MTsNCiAgICB3aGlsZSh1PD1wYXJzZUludChwbG9pZHlfbikpew0KDQogICAgICBpZighdl9hbGlnbil7DQogICAgICAgIHJlbmRlckNocm9tb01hcChjaERhdGFbdS0xXSxjaHJfc3BhY2luZyxwbG9pZHk9dSxjaF93aWR0aCxhcmMsYXJjTGVmdCxzdmcsbkxvY2lbdS0xXSxjbnQsY2hyX2NvbFt1LTFdLGhlYXRtYXAsbGVmdF9tYXJnaW4sbGdfeCxsZ195LGhlYXRfc2NhbGUsbGFiZWxzLHdpZHRoLGhlaWdodCxybmdbdS0xXSxoZWF0X2NvbFt1LTFdLGFuX2NvbFt1LTFdLGNoX3RleHRbdS0xXSxsZWdlbmRbdS0xXSx1LTEsYWdncmVnYXRlX2Z1bmNbdS0xXSk7DQoNCiAgICAgIH0gZWxzZSB7DQoNCiAgICByZW5kZXJDaHJvbW9NYXBWKGNoRGF0YVt1LTFdLGNocl9zcGFjaW5nLHBsb2lkeT11LGNoX3dpZHRoLGFyY1RvcCxhcmNCb3Qsc3ZnLG5Mb2NpW3UtMV0sY250LGNocl9jb2xbdS0xXSxoZWF0bWFwLGxlZnRfbWFyZ2luLGxnX3gsbGdfeSxoZWF0X3NjYWxlLGxhYmVscyx3aWR0aCxoZWlnaHQscm5nW3UtMV0saGVhdF9jb2xbdS0xXSxhbl9jb2xbdS0xXSxjaF90ZXh0W3UtMV0sbGVnZW5kW3UtMV0sdS0xLGFnZ3JlZ2F0ZV9mdW5jW3UtMV0pOw0KICAgIH0NCiAgICB1Kys7DQogICAgfQ0KDQogLyogZW5kIG9mIHJlbmRlcmluZyBjaHJvbW9tYXAgICovDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCn0NCg0KZnVuY3Rpb24gcmVuZGVyQ2hyb21vTWFwKGNoRGF0YSxjaHJfc3BhY2luZyxwbG9pZHksY2hfd2lkdGgsYXJjLGFyY0xlZnQsc3ZnLG5Mb2NpLGNudCxjaHJfY29sb3IsaGVhdG1hcCxsZWZ0X21hcmdpbixsZ194LGxnX3ksaGVhdF9zY2FsZSxsYWJlbHMsd2lkdGgsaGVpZ2h0LHJuZyxoZWF0X2NvbCxhbl9jb2wsY2hfdGV4dCxsZWdlbmQsdGltZXMsYWdncmVnYXRlX2Z1bmMpew0KDQoNCg0KICBpZihjbnQpew0KDQogICAgdmFyIGFsbERhdGFwID1bXTsNCiAgICB2YXIgYWxsRGF0YXE9W107DQoNCiAgICBmb3IoaT0wO2kgPCBuTG9jaS5sZW5ndGg7aSsrKXsNCg0KICAgICAgICAgYWxsRGF0YXBbaV09ZDMucmFuZ2UobkxvY2lbaV0ucCk7DQogICAgICAgICBhbGxEYXRhcVtpXT1kMy5yYW5nZShuTG9jaVtpXS5xKTsNCg0KICAgIH0NCg0KICAgIGZvcihpPTA7aTwgbkxvY2kubGVuZ3RoO2krKyl7DQoNCiAgICAgICAgLyogIGZpcnN0IGNhcCAqLw0KICAgICAgICBwb3N4PWxlZnRfbWFyZ2luOw0KICAgICAgICBwb3N5PXlfdmFsICsgaSpjaHJfc3BhY2luZysgKyBhcmNfcmFkaXVzICsgKHBsb2lkeSAtIDEpKihjaF93aWR0aCArMSApDQogICAgICAgIHN2Zy5hcHBlbmQoImciKQ0KICAgICAgICAgICAgLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoIitwb3N4KyIsIitwb3N5KyIpIikNCiAgICAgICAgICAgICAuYXBwZW5kKCJwYXRoIikNCiAgICAgICAgICAgICAuc3R5bGUoImZpbGwiLCBjaHJfY29sb3IpDQogICAgICAgICAgICAgLmF0dHIoImQiLCBhcmNMZWZ0KTsNCg0KICAgICAgICAvKiAgcCBhcm0gKi8NCiAgICAgICAgc3ZnLnNlbGVjdEFsbCgiLnJlY3RzIikNCiAgICAgICAgICAuZGF0YShhbGxEYXRhcFtpXSkNCiAgICAgICAgICAuZW50ZXIoKQ0KICAgICAgICAgIC5hcHBlbmQoInJlY3QiKQ0KICAgICAgICAgIC5hdHRyKCJ5IiwgeV92YWwgKyBpKmNocl9zcGFjaW5nICsgKHBsb2lkeSAtIDEpKihjaF93aWR0aCArMSApKQ0KICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLCBjaF93aWR0aCkNCiAgICAgICAgICAuYXR0cigieCIsIGZ1bmN0aW9uKGQsaSl7cmV0dXJuIGxlZnRfbWFyZ2luICsgaSpsb2NpX3dpZHRoO30pDQogICAgICAgICAgLmF0dHIoIndpZHRoIiwgbG9jaV93aWR0aCkNCiAgICAgICAgICAuYXR0cigiZmlsbCIsIGNocl9jb2xvcikNCiAgICAgICAgICAuYXR0cigiY2xhc3MiLCJjaExvYyIpDQogICAgICAgICAgLmF0dHIoImlkIixmdW5jdGlvbihkLGopeyByZXR1cm4gbkxvY2lbaV0ubmFtZSsiLSIrKGorMSkrIi0iK3Bsb2lkeTt9KTsNCg0KICAgICAgICAgIC8vbGFiZWxsaW5ncw0KICAgICAgc3ZnLnNlbGVjdEFsbCgiLnRleHRzIikNCiAgICAgIC5kYXRhKGFsbERhdGFwW2ldKQ0KICAgICAgLmVudGVyKCkNCiAgICAgIC5hcHBlbmQoInRleHQiKQ0KICAgICAgLmF0dHIoImNsYXNzIiwibGFiZWxzIikNCiAgICAgIC5hdHRyKCJ5IiwgKHlfdmFsICsgaSpjaHJfc3BhY2luZyArIChwbG9pZHkgLSAxKSooY2hfd2lkdGggKzEgKSktMikNCiAgICAgIC5hdHRyKCJ4IiwgZnVuY3Rpb24oZCxpKXtyZXR1cm4gbGVmdF9tYXJnaW4gKyBpKmxvY2lfd2lkdGg7fSkNCiAgICAgIC5hdHRyKCJpZCIsZnVuY3Rpb24oZCxqKXsgcmV0dXJuICJMIituTG9jaVtpXS5uYW1lKyItIisoaisxKSsiLSIrcGxvaWR5O30pLnRleHQoIiIpDQogICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAic2Fucy1zZXJpZiIpDQogICAgICAuYXR0cigiZm9udC1zaXplIiwgIjlweCIpDQogICAgICAuc3R5bGUoInRleHQtYW5jaG9yIiwgIm1pZGRsZSIpDQogICAgICAgIC5hdHRyKCJmaWxsIiwgImJsYWNrIik7DQoNCg0KICAgICAgICAgIC8qICBjZW50cm9tZXJlICovDQogICAgICAgICAgcG9zeD1sZWZ0X21hcmdpbisobkxvY2lbaV0ucCkqbG9jaV93aWR0aA0KICAgICAgICAgIHBvc3k9eV92YWwgKyBpKmNocl9zcGFjaW5nKyArIGFyY19yYWRpdXMgKyAocGxvaWR5IC0gMSkqKGNoX3dpZHRoICsxICkNCiAgICAgICAgICBzdmcuYXBwZW5kKCJnIikNCiAgICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKCIrcG9zeCsiLCIrcG9zeSsiKSIpDQogICAgICAgIC5hcHBlbmQoInBhdGgiKQ0KICAgICAgICAuc3R5bGUoImZpbGwiLCBjaHJfY29sb3IpDQogICAgICAgIC5hdHRyKCJkIiwgYXJjKTsNCg0KICAgICAgICBwb3N4PWxlZnRfbWFyZ2luKyhuTG9jaVtpXS5wKSpsb2NpX3dpZHRoICsgMiphcmNfcmFkaXVzDQogICAgICAgICAgcG9zeT15X3ZhbCArIGkqY2hyX3NwYWNpbmcrICsgYXJjX3JhZGl1cyArIChwbG9pZHkgLSAxKSooY2hfd2lkdGggKzEgKQ0KICAgICAgICAgc3ZnLmFwcGVuZCgiZyIpDQogICAgICAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiK3Bvc3grIiwiK3Bvc3krIikiKQ0KICAgICAgICAuYXBwZW5kKCJwYXRoIikNCiAgICAgICAgLnN0eWxlKCJmaWxsIiwgY2hyX2NvbG9yKQ0KICAgICAgICAuYXR0cigiZCIsIGFyY0xlZnQpOw0KDQogICAgICAgIC8qIHNob3J0IGFybSAgKi8NCg0KICAgICAgICBzdmcuc2VsZWN0QWxsKCIucmVjdHMiKQ0KICAgICAgICAgIC5kYXRhKGFsbERhdGFxW2ldKQ0KICAgICAgICAgIC5lbnRlcigpDQogICAgICAgICAgLmFwcGVuZCgicmVjdCIpDQogICAgICAgICAgLmF0dHIoInkiLCB5X3ZhbCArIGkqY2hyX3NwYWNpbmcrIChwbG9pZHkgLSAxKSooY2hfd2lkdGggKzEgKSkNCiAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgY2hfd2lkdGgpDQogICAgICAgICAgLmF0dHIoIngiLCBmdW5jdGlvbihkLGope3JldHVybiBsZWZ0X21hcmdpbiArIGoqbG9jaV93aWR0aCArIChuTG9jaVtpXS5wKSpsb2NpX3dpZHRoICsyKmFyY19yYWRpdXM7fSkNCiAgICAgICAgICAuYXR0cigid2lkdGgiLCBsb2NpX3dpZHRoKQ0KICAgICAgICAgIC5hdHRyKCJmaWxsIiwgY2hyX2NvbG9yKQ0KICAgICAgICAgIC5hdHRyKCJjbGFzcyIsImNoTG9jIikNCiAgICAgICAgICAuYXR0cigiaWQiLGZ1bmN0aW9uKGQsail7IHJldHVybiBuTG9jaVtpXS5uYW1lKyItIisoaisxK25Mb2NpW2ldLnApKyItIitwbG9pZHk7fSk7DQoNCiAgICAgICAgLy9sYWJlbGxpbmdzDQogICAgICBzdmcuc2VsZWN0QWxsKCIudGV4dHMiKQ0KICAgICAgLmRhdGEoYWxsRGF0YXFbaV0pDQogICAgICAuZW50ZXIoKQ0KICAgICAgLmFwcGVuZCgidGV4dCIpDQogICAgICAuYXR0cigiY2xhc3MiLCJsYWJlbHMiKQ0KICAgICAgLmF0dHIoInkiLCAoeV92YWwgKyBpKmNocl9zcGFjaW5nICsgKHBsb2lkeSAtIDEpKihjaF93aWR0aCArMSApKS0yKQ0KICAgICAgLmF0dHIoIngiLCBmdW5jdGlvbihkLGope3JldHVybiBsZWZ0X21hcmdpbiArIGoqbG9jaV93aWR0aCArIChuTG9jaVtpXS5wKSpsb2NpX3dpZHRoICsyKmFyY19yYWRpdXM7fSkNCiAgICAgIC5hdHRyKCJpZCIsZnVuY3Rpb24oZCxqKXsgcmV0dXJuICJMIituTG9jaVtpXS5uYW1lKyItIisoaisxK25Mb2NpW2ldLnApKyItIitwbG9pZHk7fSkudGV4dCgiIikNCiAgICAgIC5hdHRyKCJmb250LWZhbWlseSIsICJzYW5zLXNlcmlmIikNCiAgICAgIC5hdHRyKCJmb250LXNpemUiLCAiOXB4IikNCiAgICAgIC5zdHlsZSgidGV4dC1hbmNob3IiLCAibWlkZGxlIikNCiAgICAgICAgLmF0dHIoImZpbGwiLCAiYmxhY2siKTsNCg0KDQoNCg0KDQogICAgICAgICAvKiAgIGZpbmFsIGNhcCAqLw0KDQoNCiAgICAgICAgICBwb3N4PWxlZnRfbWFyZ2luKyhuTG9jaVtpXS5wKSpsb2NpX3dpZHRoICsgMiphcmNfcmFkaXVzICsgKG5Mb2NpW2ldLnEpKmxvY2lfd2lkdGgNCiAgICAgICAgICBwb3N5PXlfdmFsICsgaSpjaHJfc3BhY2luZysgKyBhcmNfcmFkaXVzICsgKHBsb2lkeSAtIDEpKihjaF93aWR0aCArMSApDQogICAgICAgICBzdmcuYXBwZW5kKCJnIikNCiAgICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKCIrcG9zeCsiLCIrcG9zeSsiKSIpDQogICAgICAgIC5hcHBlbmQoInBhdGgiKQ0KICAgICAgICAuc3R5bGUoImZpbGwiLCBjaHJfY29sb3IpDQogICAgICAgIC5hdHRyKCJkIiwgYXJjKTsNCg0KaWYoY2hfdGV4dCl7DQogICAgICAgIHN2Zy5hcHBlbmQoInRleHQiKQ0KICAgICAgICAuYXR0cigieCIsbGVmdF9tYXJnaW4qMC41KQ0KICAgICAgICAuYXR0cigieSIsMiArIHlfdmFsICsgaSpjaHJfc3BhY2luZyArIChwbG9pZHkgLSAxKSooY2hfd2lkdGggKzMgKSkNCiAgICAgICAgLmF0dHIoImZvbnQtZmFtaWx5IiwgInNhbnMtc2VyaWYiKQ0KICAgICAgICAuYXR0cigiZm9udC1zaXplIiwgIjlweCIpDQogICAgICAgIC5hdHRyKCJmaWxsIiwgImJsYWNrIikNCiAgICAgICAgLnN0eWxlKCJ0ZXh0LWFuY2hvciIsICJtaWRkbGUiKQ0KICAgICAgICAudGV4dChuTG9jaVtpXS5uYW1lKTsNCn0NCg0KDQogICAgICAgIH0gLy9lbmQgb2YgZm9yDQoNCn0gZWxzZSB7DQoNCiAgdmFyIGFsbERhdGEgPVtdOw0KDQoNCiAgICBmb3IoaT0wO2kgPCBuTG9jaS5sZW5ndGg7aSsrKXsNCg0KICAgICAgICAgYWxsRGF0YVtpXT1kMy5yYW5nZShuTG9jaVtpXS5uKTsNCg0KDQogICAgfQ0KDQogIGZvcihpPTA7aTwgbkxvY2kubGVuZ3RoO2krKyl7DQoNCiAgICAvKiAgZmlyc3QgY2FwICovDQogICAgcG9zeD1sZWZ0X21hcmdpbjsNCiAgICBwb3N5PXlfdmFsICsgaSpjaHJfc3BhY2luZysgKyBhcmNfcmFkaXVzICsgKHBsb2lkeSAtIDEpKihjaF93aWR0aCArMSApDQogICAgc3ZnLmFwcGVuZCgiZyIpDQogICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKCIrcG9zeCsiLCIrcG9zeSsiKSIpDQogICAgICAgICAuYXBwZW5kKCJwYXRoIikNCiAgICAgICAgIC5zdHlsZSgiZmlsbCIsIGNocl9jb2xvcikNCiAgICAgICAgIC5hdHRyKCJkIiwgYXJjTGVmdCk7DQoNCiAgICAvKiAgcCBhcm0gKi8NCiAgICBzdmcuc2VsZWN0QWxsKCIucmVjdHMiKQ0KICAgICAgLmRhdGEoYWxsRGF0YVtpXSkNCiAgICAgIC5lbnRlcigpDQogICAgICAuYXBwZW5kKCJyZWN0IikNCiAgICAgIC5hdHRyKCJ5IiwgeV92YWwgKyBpKmNocl9zcGFjaW5nICsgKHBsb2lkeSAtIDEpKihjaF93aWR0aCArMSApKQ0KICAgICAgLmF0dHIoImhlaWdodCIsIGNoX3dpZHRoKQ0KICAgICAgLmF0dHIoIngiLCBmdW5jdGlvbihkLGkpe3JldHVybiAobGVmdF9tYXJnaW4gKyBpKmxvY2lfd2lkdGgpO30pDQogICAgICAuYXR0cigid2lkdGgiLCBsb2NpX3dpZHRoKQ0KICAgICAgLmF0dHIoImZpbGwiLCBjaHJfY29sb3IpDQogICAgICAuYXR0cigiY2xhc3MiLCJjaExvYyIpDQogICAgICAuYXR0cigiaWQiLGZ1bmN0aW9uKGQsail7IHJldHVybiBuTG9jaVtpXS5uYW1lKyItIisoaisxKSsiLSIrcGxvaWR5O30pOw0KDQoNCg0KICAgICAgLy9sYWJlbGxpbmdzDQogICAgICBzdmcuc2VsZWN0QWxsKCIudGV4dHMiKQ0KICAgICAgLmRhdGEoYWxsRGF0YVtpXSkNCiAgICAgIC5lbnRlcigpDQogICAgICAuYXBwZW5kKCJ0ZXh0IikNCiAgICAgIC5hdHRyKCJjbGFzcyIsImxhYmVscyIpDQogICAgICAuYXR0cigieSIsICh5X3ZhbCArIGkqY2hyX3NwYWNpbmcgKyAocGxvaWR5IC0gMSkqKGNoX3dpZHRoICsxICkpLTIpDQogICAgICAuYXR0cigieCIsIGZ1bmN0aW9uKGQsaSl7cmV0dXJuIGxlZnRfbWFyZ2luICsgaSpsb2NpX3dpZHRoO30pDQogICAgICAuYXR0cigiaWQiLGZ1bmN0aW9uKGQsail7cmV0dXJuICJMIituTG9jaVtpXS5uYW1lKyItIisoaisxKSsiLSIrcGxvaWR5O30pLnRleHQoIiIpDQogICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAic2Fucy1zZXJpZiIpDQogICAgICAuYXR0cigiZm9udC1zaXplIiwgIjlweCIpDQogICAgICAuc3R5bGUoInRleHQtYW5jaG9yIiwgIm1pZGRsZSIpDQogICAgICAgIC5hdHRyKCJmaWxsIiwgImJsYWNrIik7DQoNCg0KDQoNCg0KDQoNCg0KDQogICAgIC8qICAgZmluYWwgY2FwICovDQoNCg0KICAgICAgcG9zeD1sZWZ0X21hcmdpbisobkxvY2lbaV0ubikqbG9jaV93aWR0aA0KICAgICAgcG9zeT15X3ZhbCArIGkqY2hyX3NwYWNpbmcrICsgYXJjX3JhZGl1cyArIChwbG9pZHkgLSAxKSooY2hfd2lkdGggKzEgKQ0KICAgICBzdmcuYXBwZW5kKCJnIikNCiAgICAgLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoIitwb3N4KyIsIitwb3N5KyIpIikNCiAgICAuYXBwZW5kKCJwYXRoIikNCiAgICAuc3R5bGUoImZpbGwiLCBjaHJfY29sb3IpDQogICAgLmF0dHIoImQiLCBhcmMpOw0KDQppZihjaF90ZXh0KXsNCiAgICBzdmcuYXBwZW5kKCJ0ZXh0IikNCiAgICAgICAgLmF0dHIoIngiLGxlZnRfbWFyZ2luKjAuNSkNCiAgICAgICAgLmF0dHIoInkiLDIreV92YWwgKyBpKmNocl9zcGFjaW5nICthcmNfcmFkaXVzKyAocGxvaWR5IC0gMSkqKGNoX3dpZHRoICszICkpDQogICAgICAgIC5hdHRyKCJmb250LWZhbWlseSIsICJzYW5zLXNlcmlmIikNCiAgICAgICAgLmF0dHIoImZvbnQtc2l6ZSIsICI5cHgiKQ0KICAgICAgICAuYXR0cigiZmlsbCIsICJibGFjayIpDQogICAgICAgIC5zdHlsZSgidGV4dC1hbmNob3IiLCAibWlkZGxlIikNCiAgICAgICAgLnRleHQobkxvY2lbaV0ubmFtZSk7DQoNCn0NCg0KDQogICAgfSAvL2VuZCBvZiBmb3INCg0KDQp9DQoNCg0KDQppZighaGVhdG1hcCl7DQogICAgICAgIC8vZGF0YSByZWR1Y3Rpb24gZm9yIGFubnRhdGlvbg0KdmFyIGNoRGF0YVJlZHVjZWQgPSBkMy5uZXN0KCkNCi5rZXkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sb2NpOyB9KQ0KLnJvbGx1cChmdW5jdGlvbih2KSB7IHZhciBsYWJlbCA9Jyc7IHZhciB0b3QgPSAnPGZvbnQgY29sb3I9ImdyZXkiPiBDb3VudDogPC9mb250PiAnK3YubGVuZ3RoKyIgIDwvcD48L2Rpdj48aHI+PGRpdiAgc3R5bGU9J2Zsb2F0OnRvcDtoZWlnaHQ6ODAlO292ZXJmbG93LXdyYXA6IGJyZWFrLXdvcmQ7JyA+IDxmb250IHNpemU9JzEnPiI7Zm9yKHZhciBpPTA7IGk8IHYubGVuZ3RoO2krKyl7IGxhYmVsID0gbGFiZWwgKyI8YSBocmVmPSIrdltpXS5obGluaysiIHN0eWxlPSd0ZXh0LWRlY29yYXRpb246bm9uZTtjdXJzb3I6cG9pbnRlcjtjb2xvcjpncmV5O3BvaW50ZXItZXZlbnRzOiBhbGwnPiIrIHZbaV0ubmFtZSsiPC9hPiIgKyIgLCI7ICAgIH07IHJldHVybiB0b3QrbGFiZWwuc2xpY2UoMCwtMSk7fSkNCi5lbnRyaWVzKGNoRGF0YSk7DQoNCnZhciBjaERhdGFSZWR1Y2VkQ291bnQgPSBkMy5uZXN0KCkNCi5rZXkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sb2NpOyB9KQ0KLnJvbGx1cChmdW5jdGlvbih2KSB7ICByZXR1cm4gdi5sZW5ndGg7fSkNCi5lbnRyaWVzKGNoRGF0YSk7DQoNCnZhciBjaERhdGFSYW5nZSA9IGQzLm5lc3QoKQ0KLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQoucm9sbHVwKGZ1bmN0aW9uKHYpIHsgIHZhciBhLGI7Zm9yKHZhciBpPTA7IGk8IHYubGVuZ3RoO2krKyl7IGEgPSB2W2ldLmxvY2lfc3RhcnQ7IGI9dltpXS5sb2NpX2VuZDsgICAgfTtyZXR1cm4gIiIrYSsiLSIrYisiYnAgIjt9KQ0KLmVudHJpZXMoY2hEYXRhKTsNCg0KIC8qIGFkZGluZyB0aGUgY2hyb21vc29tZSB0b290bHRpcHMgICAgKi8NCmZvcih2YXIgaSA9IDA7aSA8IGNoRGF0YVJlZHVjZWQubGVuZ3RoO2krKykgew0KDQoNCiAgY2hEYXRhUmVkdWNlZFtpXS5yYW5nZSA9IGNoRGF0YVJhbmdlW2ldLnZhbHVlOw0KICBjaERhdGFSZWR1Y2VkW2ldLmxlbiA9IGNoRGF0YVJlZHVjZWRDb3VudFtpXS52YWx1ZTsNCn0NCg0KDQovL2RhdGEgcmVhZHkgZm9yIHJlbmRlcmluZw0KICAgICB2YXIgdGlwID1bXTsNCiAgICAgICAgdGlwW3Bsb2lkeS0xXSA9IGQzLnNlbGVjdCgiYm9keSIpLmFwcGVuZCgiZGl2IikNCiAuYXR0cigiY2xhc3MiLCAiY2h0b29sdGlwIikNCiAuc3R5bGUoIm9wYWNpdHkiLCAwKQ0KIC5hdHRyKCJzdHlsZSIsICJwb3NpdGlvbjogYWJzb2x1dGU7dGV4dC1hbGlnbjogY2VudGVyOwlib3gtc2l6aW5nOiBib3JkZXItYm94OyBwYWRkaW5nOiAzcHg7CWZvbnQ6IDEycHggc2Fucy1zZXJpZjsJCWJvcmRlcjogMHB4O2JvcmRlci1yYWRpdXM6IDhweDtwb2ludGVyLWV2ZW50czogbm9uZTsiKSA7DQoNCiB2YXIgdGlwMiA9IFtdOw0KICB0aXAyW3Bsb2lkeS0xXSA9IGQzLnNlbGVjdCgiYm9keSIpLmFwcGVuZCgiZGl2IikNCiAgICAgLmF0dHIoImNsYXNzIiwgImNodG9vbHRpcDIiKQ0KICAgICAuc3R5bGUoIm9wYWNpdHkiLCAwKQ0KICAgICAuYXR0cigic3R5bGUiLCAicG9zaXRpb246IGFic29sdXRlO3RleHQtYWxpZ246IGNlbnRlcjt3aWR0aDogMTgwcHg7aGVpZ2h0OiAxNDBweDsJIHBhZGRpbmc6IDJweDsJZm9udDogMTJweCBzYW5zLXNlcmlmOwlib3gtc2l6aW5nOiBib3JkZXItYm94Owlib3JkZXI6IDBweDtib3JkZXItcmFkaXVzOiA4cHg7cG9pbnRlci1ldmVudHM6IG5vbmU7IikgOw0KIHZhciBjbGlja0ZsYWc9ZmFsc2U7DQogZDMuc2VsZWN0QWxsKCIuY2hMb2MiKS5kYXRhKGNoRGF0YVJlZHVjZWQsIGZ1bmN0aW9uKGQpIHtyZXR1cm4gKGQgJiYgZC5rZXkpfHxkMy5zZWxlY3QodGhpcykuYXR0cigiaWQiKTt9KS5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oZCkge3RpcFtwbG9pZHktMV0udHJhbnNpdGlvbigpLmR1cmF0aW9uKDIwMCkJLnN0eWxlKCJvcGFjaXR5IiwgLjkpLnN0eWxlKCJiYWNrZ3JvdW5kLWNvbG9yIiwiI0Y1RjVGNSIpOwl0aXBbcGxvaWR5LTFdLnN0eWxlKCJoZWlnaHQiLDEwMCtkLmxlbioxLjUpLnN0eWxlKCJ3aWR0aCIsMTkwK2QubGVuKTsNCiB0aXBbcGxvaWR5LTFdLmh0bWwoIjxkaXYgIHN0eWxlPSdmbG9hdDp0b3A7aGVpZ2h0OjEwJTtjb2xvcjpibGFjaztmb250LXNpemU6MTJweDsnPjxwPiIrZC5yYW5nZSsiPC9wPjwvZGl2Pjxocj48ZGl2ICBzdHlsZT0nZmxvYXQ6dG9wO2hlaWdodDoxMCU7Jz48cCA+PGI+IitkLnZhbHVlKyI8L2ZvbnQ+PC9kaXY+Iikuc3R5bGUoImxlZnQiLCAoZDMuZXZlbnQucGFnZVgpICsgInB4IikJLnN0eWxlKCJ0b3AiLCAoZDMuZXZlbnQucGFnZVkgLSAxOCkgKyAicHgiKTt9KS5vbigibW91c2VvdXQiLCBmdW5jdGlvbihkKSB7CXRpcFtwbG9pZHktMV0udHJhbnNpdGlvbigpIC5kZWxheSgxMDAwKS5kdXJhdGlvbig1MDApCS5zdHlsZSgib3BhY2l0eSIsIDApO30pLmF0dHIoImZpbGwiLCBhbl9jb2wpDQogLm9uKCJjbGljayIsIGZ1bmN0aW9uKGQpIHsNCg0KDQogICBpZihjbGlja0ZsYWcpew0KICAgICAgICB0aXAyW3Bsb2lkeS0xXS5zdHlsZSgib3BhY2l0eSIsIDApOw0KICAgICB9ZWxzZXsNCiAgICAgICB0aXAyW3Bsb2lkeS0xXS50cmFuc2l0aW9uKCkuZHVyYXRpb24oMjAwKQkuc3R5bGUoIm9wYWNpdHkiLCAxKS5zdHlsZSgiYmFja2dyb3VuZC1jb2xvciIsIiNGNUY1RjUiKTsJdGlwMltwbG9pZHktMV0uc3R5bGUoImhlaWdodCIsMTAwK2QubGVuKjEuNSkuc3R5bGUoIndpZHRoIiwxOTArZC5sZW4pOw0KICAgICAgIHRpcDJbcGxvaWR5LTFdLmh0bWwoIjxkaXYgIHN0eWxlPSdmbG9hdDp0b3A7aGVpZ2h0OjEwJTtjb2xvcjpibGFjaztmb250LXNpemU6MTJweDsnPjxwPiIrZC5yYW5nZSsiPC9wPjwvZGl2Pjxocj48ZGl2ICBzdHlsZT0nZmxvYXQ6dG9wO2hlaWdodDoxMCU7Jz48cCA+PGI+IitkLnZhbHVlKyI8L2ZvbnQ+PC9kaXY+Iikuc3R5bGUoImxlZnQiLCAoZDMuZXZlbnQucGFnZVgpICsgInB4IikJLnN0eWxlKCJ0b3AiLCAoZDMuZXZlbnQucGFnZVkgLSAxOCkgKyAicHgiKTsNCiAgICAgICAgfSByZXR1cm4gY2xpY2tGbGFnID0gIWNsaWNrRmxhZzsgfSk7DQoNCiBpZihwbG9pZHk9PTEgJiYgbGFiZWxzKXsNCg0KICB2YXIgY2hEYXRhTGFiZWxzID0gZDMubmVzdCgpDQoua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCi5yb2xsdXAoZnVuY3Rpb24odikgeyAgdmFyIGE9W107Zm9yKHZhciBpPTA7IGk8IHYubGVuZ3RoO2krKyl7IGEucHVzaCh2W2ldLm5hbWUpOyAgIH07cmV0dXJuIGFbMF07fSkNCi5lbnRyaWVzKGNoRGF0YSk7DQp2YXIgY2hEYXRhTGFiZWwgPSBkMy5uZXN0KCkNCi5rZXkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sb2NpOyB9KQ0KLnJvbGx1cChmdW5jdGlvbih2KSB7ICB2YXIgYT1bXTtmb3IodmFyIGk9MDsgaTwgdi5sZW5ndGg7aSsrKXsgYS5wdXNoKHZbaV0ubGFiZWwpOyAgIH07cmV0dXJuIGFbMF07fSkNCi5lbnRyaWVzKGNoRGF0YSk7DQogZm9yKHZhciBpID0gMDtpIDwgY2hEYXRhUmVkdWNlZC5sZW5ndGg7aSsrKSB7DQoNCg0KDQogIGNoRGF0YVJlZHVjZWRbaV0ubGFiZWxzID1jaERhdGFMYWJlbHNbaV0udmFsdWU7DQogIGNoRGF0YVJlZHVjZWRbaV0ubGFiZWxfaWQgPWNoRGF0YUxhYmVsW2ldLnZhbHVlOw0KDQp9DQoNCg0KIGQzLnNlbGVjdEFsbCgiLmxhYmVscyIpLmRhdGEoY2hEYXRhUmVkdWNlZCwgZnVuY3Rpb24oZCkge3JldHVybiAoZCAmJiBkLmxhYmVsX2lkKXx8ZDMuc2VsZWN0KHRoaXMpLmF0dHIoImlkIik7fSkudGV4dChmdW5jdGlvbihkKXsgcmV0dXJuIGQubGFiZWxzO30pOw0KfQ0KDQoNCg0KDQogfSBlbHNlIHsNCg0KICAgLy9oZWF0bWFwIGNvZGUNCiAgIGlmKGhlYXRfc2NhbGU9PSJsaW5lYXIiKXsNCg0KDQoNCg0KICAgIGNvbG9yc1t0aW1lc10gPSBkMy5zY2FsZUxpbmVhcigpDQogICAgICAgIC5kb21haW4ocm5nKS5uaWNlKCkNCiAgICAgICAgLnJhbmdlKGhlYXRfY29sKTsNCg0KDQoNCiAgICAvLyBDcmVhdGUgc2NhbGUNCg0KLyogICAgdmFyIHNjYWxlMiA9IGQzLnNjYWxlTGluZWFyKCkNCiAgICAuZG9tYWluKHJuZykubmljZSgpDQogICAgLnJhbmdlKFsyLCAxMDBdKTsNCg0KICAgIC8vIEFkZCBzY2FsZXMgdG8gYXhpcw0KICAgIGxlZ2VuZDIgPSBkMy5heGlzUmlnaHQoKQ0KICAgIC5zY2FsZShzY2FsZTIpDQogICAgLnRpY2tzKDMpOw0KaWYobGVnZW5kKXsNCiAgICAvL0FwcGVuZCBncm91cCBhbmQgaW5zZXJ0IGF4aXMNCiAgICBzdmcuYXBwZW5kKCJnIikNCiAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiKygod2lkdGgtMzUtKHRpbWVzKjUwKSktbGdfeCkrIiwiICsgKChoZWlnaHQtMTAwKS1sZ195ICkrICIpIikNCiAgICAuY2FsbChsZWdlbmQyKTsNCg0KfSAgKi8NCiAgICBjaExpbkdyYWRWW3RpbWVzXSA9IHN2Zy5hcHBlbmQoImRlZnMiKS5hcHBlbmQoImxpbmVhckdyYWRpZW50IikNCiAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigiaWQiLCBmdW5jdGlvbihkKXsgcmV0dXJuICJsaW5lYXItZ3JhZGllbnQtY2hyb21ILSIrdGltZXM7fSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigieDEiLCAiMCUiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ5MSIsICIwJSIpDQogICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoIngyIiwgIjAlIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigieTIiLCAiMTAwJSIpDQogICAgICAgICAgICAgICAgICAgICAgICAgLnNlbGVjdEFsbCgic3RvcCIpDQogICAgICAgIC5kYXRhKCBjb2xvcnNbdGltZXNdLnJhbmdlKCkgKQ0KICAgICAgICAuZW50ZXIoKS5hcHBlbmQoInN0b3AiKQ0KICAgICAgICAuYXR0cigib2Zmc2V0IiwgZnVuY3Rpb24oZCxpKSB7IHJldHVybiBpLyhjb2xvcnNbdGltZXNdLnJhbmdlKCkubGVuZ3RoLTEpOyB9KQ0KICAgICAgICAuYXR0cigic3RvcC1jb2xvciIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQ7IH0pOw0KDQoNCmlmKGxlZ2VuZCl7DQogICAgICBzdmcuYXBwZW5kKCdyZWN0JykNCiAgICAgIC5hdHRyKCJoZWlnaHQiLDEwMCkuYXR0cigid2lkdGgiLDEwKS5hdHRyKCJ5IiwoKGhlaWdodC05OSktbGdfeSkpLmF0dHIoIngiLCgod2lkdGgtNDUtKHRpbWVzKjUwKSktbGdfeCkpLmF0dHIoImNsYXNzIixmdW5jdGlvbihkKXtyZXR1cm4gImxnIit0aW1lczt9KQ0KICAgICAgLnN0eWxlKCJmaWxsIiwgInVybCgjbGluZWFyLWdyYWRpZW50LWNocm9tSC0iK3RpbWVzKyIpIik7DQoNCiAgICAgIHZhciBybmcyOw0KICAgICAgaWYocm5nLmxlbmd0aD09Myl7DQogICAgICAgIHJuZzI9cm5nOw0KICAgICAgfWVsc2UgaWYgKHJuZy5sZW5ndGg9PTIpIHsNCiAgICAgICAgcm5nMj1bcm5nWzBdLGQzLm1lYW4ocm5nKSxybmdbMV1dDQogICAgICB9DQoNCiAgICAgc3ZnLnNlbGVjdEFsbCgiLnRleHRzIikNCiAgICAgLmRhdGEoZDMucmFuZ2UoMykpDQogICAgIC5lbnRlcigpDQogICAgIC5hcHBlbmQoInRleHQiKQ0KICAgICAuYXR0cigiY2xhc3MiLCJsYWJlbHMiKQ0KICAgICAudGV4dChmdW5jdGlvbihpKXsgcmV0dXJuIHJuZzJbaV0udG9GaXhlZCgxKTt9KQ0KICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAic2Fucy1zZXJpZiIpDQogICAgIC5hdHRyKCJmb250LXNpemUiLCAiOXB4IikNCiAgICAgICAuYXR0cigiZmlsbCIsICJibGFjayIpLmF0dHIoInRyYW5zZm9ybSIsZnVuY3Rpb24oZCxqKXsNCiAgICAgICAgIHJldHVybiAidHJhbnNsYXRlKCIgKygod2lkdGgtMzItKHRpbWVzKjUwKSktbGdfeCkrIiwiICsgKChoZWlnaHQtOTQrKGoqNDgpKS1sZ195ICApKyAiKSJ9KTsNCn0NCg0KICAgIH0gZWxzZXsgaWYoaGVhdF9zY2FsZT09Im9yZGluYWwiKXsNCg0KDQoNCg0KICAgICAgY29sb3JzW3RpbWVzXSA9IGQzLnNjYWxlT3JkaW5hbCgpDQogICAgICAgICAgICAgIC5kb21haW4ocm5nKQ0KICAgICAgICAgICAgICAucmFuZ2UoaGVhdF9jb2wpOw0KDQoNCiAgICAgICAgdz1ybmcubGVuZ3RoKjIwOw0KICAgICAgICAvLyBDcmVhdGUgc2NhbGUNCg0KICAgICAgICB2YXIgc2NhbGUyID0gZDMuc2NhbGVCYW5kKCkNCiAgICAgICAgLmRvbWFpbihybmcpDQogICAgICAgIC5yYW5nZShbMix3XSk7DQoNCiAgICAgICAgLy8gQWRkIHNjYWxlcyB0byBheGlzDQogICAgICAgIHZhciBsZWdlbmQyID0gZDMuYXhpc1JpZ2h0KCkNCiAgICAgICAgLnNjYWxlKHNjYWxlMikudGlja1NpemVPdXRlcigwKTsNCg0KaWYobGVnZW5kKXsNCiAgICAgICAgLy9BcHBlbmQgZ3JvdXAgYW5kIGluc2VydCBheGlzDQogICAgICAgIHN2Zy5hcHBlbmQoImciKQ0KICAgICAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiKygod2lkdGgtMzUpLWxnX3gpKyIsIiArICgoaGVpZ2h0LTEwMCktbGdfeSApKyAiKSIpDQogICAgICAgIC5jYWxsKGxlZ2VuZDIpOw0KDQoNCg0KDQoNCiAgICAgICAgcmVjX2g9dy9ybmcubGVuZ3RoOw0KDQogICAgICAgICAgICBzdmcuc2VsZWN0QWxsKCIucmVjdHMiKQ0KICAgICAgICAgICAgLmRhdGEoaGVhdF9jb2wpDQogICAgICAgICAgICAuZW50ZXIoKQ0KICAgICAgICAgICAgLmFwcGVuZCgicmVjdCIpDQogICAgICAgICAgICAuYXR0cigieSIsIGZ1bmN0aW9uKGQsaSl7cmV0dXJuICgoKGhlaWdodC05OSktbGdfeSkraSpyZWNfaCk7fSkNCiAgICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLCByZWNfaCkNCiAgICAgICAgICAgIC5hdHRyKCJ4IiwgZnVuY3Rpb24oZCxpKXtyZXR1cm4gKCh3aWR0aC00NSktbGdfeCk7fSkNCiAgICAgICAgICAgIC5hdHRyKCJ3aWR0aCIsIDEwKQ0KICAgICAgICAgICAgLmF0dHIoImZpbGwiLCBmdW5jdGlvbihkKXtyZXR1cm4gZDt9KTsNCn0NCg0KDQoNCg0KICAgIH0NCiAgICB9DQoNCg0KDQoNCgkvKiBjcmVhdGluZyBmaW5hbCBkYXRhICAgICovDQoNCg0KDQppZihoZWF0X3NjYWxlPT0ibGluZWFyIil7DQogdmFyIHRhZzsNCiBpZihhZ2dyZWdhdGVfZnVuYz09ImF2ZyIpew0KICBjaERhdGFSZWR1Y2VkID0gZDMubmVzdCgpDQogIC5rZXkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sb2NpOyB9KQ0KICAucm9sbHVwKGZ1bmN0aW9uKHYpIHsgcmV0dXJuIGQzLm1lYW4odiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5kYXRhOyB9KTt9KQ0KICAuZW50cmllcyhjaERhdGEpOw0KDQogIHRhZz0iYXZnIjsNCn0gZWxzZSBpZihhZ2dyZWdhdGVfZnVuYz09InN1bSIpew0KDQogIGNoRGF0YVJlZHVjZWQgPSBkMy5uZXN0KCkNCiAgLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQogIC5yb2xsdXAoZnVuY3Rpb24odikgeyByZXR1cm4gZDMuc3VtKHYsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuZGF0YTsgfSk7fSkNCiAgLmVudHJpZXMoY2hEYXRhKTsNCiB0YWc9InN1bSI7DQoNCn0NCgl2YXIgY2hEYXRhUmVkdWNlZE1pbiA9IGQzLm5lc3QoKQ0KICAua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCiAgLnJvbGx1cChmdW5jdGlvbih2KSB7IHJldHVybiBkMy5taW4odiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5kYXRhOyB9KTt9KQ0KICAuZW50cmllcyhjaERhdGEpOw0KICB2YXIgY2hEYXRhUmVkdWNlZE1heCA9IGQzLm5lc3QoKQ0KICAua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCiAgLnJvbGx1cChmdW5jdGlvbih2KSB7IHJldHVybiBkMy5tYXgodiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5kYXRhOyB9KTt9KQ0KICAuZW50cmllcyhjaERhdGEpOw0KICB2YXIgY2hEYXRhUmVkdWNlZEJhckRhdGEgPSBkMy5uZXN0KCkNCiAgLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQogIC5yb2xsdXAoZnVuY3Rpb24odikgeyB2PXYuc29ydChmdW5jdGlvbihhLGIpe3JldHVybiBNYXRoLmFicyhhWydjaF9zdGFydCddKSAtIE1hdGguYWJzKGJbJ2NoX3N0YXJ0J10pfSk7YmFyPVtdOyBmb3IodmFyIGc9MDtnPHYubGVuZ3RoO2crKyl7YmFyLnB1c2godltnXS5kYXRhKTt9O3JldHVybiBiYXI7fSkNCiAgLmVudHJpZXMoY2hEYXRhKTsNCiAgdmFyIGNoRGF0YVJlZHVjZWRCYXJMYWJlbCA9IGQzLm5lc3QoKQ0KICAua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCiAgLnJvbGx1cChmdW5jdGlvbih2KSB7IHY9di5zb3J0KGZ1bmN0aW9uKGEsYil7cmV0dXJuIE1hdGguYWJzKGFbJ2NoX3N0YXJ0J10pIC0gTWF0aC5hYnMoYlsnY2hfc3RhcnQnXSl9KTtiYXI9W107IGZvcih2YXIgZz0wO2c8di5sZW5ndGg7ZysrKXtiYXIucHVzaCh2W2ddLm5hbWUpO307cmV0dXJuIGJhcjt9KQ0KICAuZW50cmllcyhjaERhdGEpOw0KDQogIHZhciBjaERhdGFSZWR1Y2VkQmFyTGluayA9IGQzLm5lc3QoKQ0KICAua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCiAgLnJvbGx1cChmdW5jdGlvbih2KSB7IHY9di5zb3J0KGZ1bmN0aW9uKGEsYil7cmV0dXJuIE1hdGguYWJzKGFbJ2NoX3N0YXJ0J10pIC0gTWF0aC5hYnMoYlsnY2hfc3RhcnQnXSl9KTtiYXI9W107IGZvcih2YXIgZz0wO2c8di5sZW5ndGg7ZysrKXtiYXIucHVzaCh2W2ddLmhsaW5rKTt9O3JldHVybiBiYXI7fSkNCiAgLmVudHJpZXMoY2hEYXRhKTsNCiAgdmFyIGNoRGF0YVJlZHVjZWRDb3VudCA9IGQzLm5lc3QoKQ0KICAua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCiAgLnJvbGx1cChmdW5jdGlvbih2KSB7IHJldHVybiB2Lmxlbmd0aDt9KQ0KICAuZW50cmllcyhjaERhdGEpOw0KCXZhciBjaERhdGFSYW5nZSA9IGQzLm5lc3QoKQ0KLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQoucm9sbHVwKGZ1bmN0aW9uKHYpIHsgIHZhciBhLGI7Zm9yKHZhciBpPTA7IGk8IHYubGVuZ3RoO2krKyl7IGEgPSB2W2ldLmxvY2lfc3RhcnQ7IGI9dltpXS5sb2NpX2VuZDsgICAgfTtyZXR1cm4gIiIrYSsiLSIrYisiYnAgIjt9KQ0KLmVudHJpZXMoY2hEYXRhKTsNCiAgZm9yKHZhciBpID0gMDtpIDwgY2hEYXRhUmVkdWNlZC5sZW5ndGg7aSsrKSB7DQoNCg0KCWNoRGF0YVJlZHVjZWRbaV0ucmFuZ2UgPSBjaERhdGFSYW5nZVtpXS52YWx1ZTsNCgljaERhdGFSZWR1Y2VkW2ldLm1pbiA9IGNoRGF0YVJlZHVjZWRNaW5baV0udmFsdWU7DQoJY2hEYXRhUmVkdWNlZFtpXS5tYXggPSBjaERhdGFSZWR1Y2VkTWF4W2ldLnZhbHVlOw0KCWNoRGF0YVJlZHVjZWRbaV0uYmFyID0gY2hEYXRhUmVkdWNlZEJhckRhdGFbaV0udmFsdWU7DQoJY2hEYXRhUmVkdWNlZFtpXS5sYWJlbCA9IGNoRGF0YVJlZHVjZWRCYXJMYWJlbFtpXS52YWx1ZTsNCgljaERhdGFSZWR1Y2VkW2ldLmNvdW50ID0gY2hEYXRhUmVkdWNlZENvdW50W2ldLnZhbHVlOw0KICBjaERhdGFSZWR1Y2VkW2ldLmhsaW5rID0gY2hEYXRhUmVkdWNlZEJhckxpbmtbaV0udmFsdWU7DQp9DQoNCnZhciB0aXAgPSBbXTsNCiB0aXBbcGxvaWR5LTFdID0gZDMuc2VsZWN0KCJib2R5IikuYXBwZW5kKCJkaXYiKQ0KICAgIC5hdHRyKCJjbGFzcyIsICJjaHRvb2x0aXAiKQ0KICAgIC5zdHlsZSgib3BhY2l0eSIsIDApDQogICAgLmF0dHIoInN0eWxlIiwgInBvc2l0aW9uOiBhYnNvbHV0ZTt0ZXh0LWFsaWduOiBjZW50ZXI7d2lkdGg6IDE4MHB4O2hlaWdodDogMTQwcHg7CSBwYWRkaW5nOiAycHg7CWZvbnQ6IDEycHggc2Fucy1zZXJpZjsJYm94LXNpemluZzogYm9yZGVyLWJveDsJYm9yZGVyOiAwcHg7Ym9yZGVyLXJhZGl1czogOHB4O3BvaW50ZXItZXZlbnRzOiBub25lOyIpIDsNCg0KICAgIHZhciB0aXAyID0gW107DQogICAgIHRpcDJbcGxvaWR5LTFdID0gZDMuc2VsZWN0KCJib2R5IikuYXBwZW5kKCJkaXYiKQ0KICAgICAgICAuYXR0cigiY2xhc3MiLCAiY2h0b29sdGlwMiIpDQogICAgICAgIC5zdHlsZSgib3BhY2l0eSIsIDApDQogICAgICAgIC5hdHRyKCJzdHlsZSIsICJwb3NpdGlvbjogYWJzb2x1dGU7dGV4dC1hbGlnbjogY2VudGVyO3dpZHRoOiAxODBweDtoZWlnaHQ6IDE0MHB4OwkgcGFkZGluZzogMnB4Owlmb250OiAxMnB4IHNhbnMtc2VyaWY7CWJveC1zaXppbmc6IGJvcmRlci1ib3g7CWJvcmRlcjogMHB4O2JvcmRlci1yYWRpdXM6IDhweDtwb2ludGVyLWV2ZW50czogbm9uZTsiKSA7DQogICAgdmFyIGNsaWNrRmxhZz1mYWxzZTsNCg0KICAgIGQzLnNlbGVjdEFsbCgiLmNoTG9jIikuZGF0YShjaERhdGFSZWR1Y2VkLCBmdW5jdGlvbihkKSB7cmV0dXJuIChkICYmIGQua2V5KXx8ZDMuc2VsZWN0KHRoaXMpLmF0dHIoImlkIik7fSkub24oIm1vdXNlb3ZlciIsIGZ1bmN0aW9uKGQpIHt0aXBbcGxvaWR5LTFdLnRyYW5zaXRpb24oKS5kdXJhdGlvbigyMDApCS5zdHlsZSgib3BhY2l0eSIsIC45KS5zdHlsZSgiYmFja2dyb3VuZC1jb2xvciIsIiNGNUY1RjUiKS5zdHlsZSgid2lkdGgiLDE4MCtkLmNvdW50KihkMy5tYXgoZC5sYWJlbCkubGVuZ3RoKjMpKydweCcpOw0KICAgICAgdGlwW3Bsb2lkeS0xXS5odG1sKCI8ZGl2ICBzdHlsZT0nZmxvYXQ6dG9wO3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDozNSU7JyA+PGRpdiBzdHlsZT0nYm9yZGVyLXJhZGl1czogNXB4O2Zsb2F0OmxlZnQ7cG9zaXRpb246cmVsYXRpdmU7aGVpZ2h0OjU1cHg7d2lkdGg6MzAlO2JhY2tncm91bmQtY29sb3I6Iitjb2xvcnNbdGltZXNdKGQudmFsdWUpKw0KICAgICAgIjsnID48L2Rpdj48ZGl2ICBzdHlsZT0nZmxvYXQ6bGVmdDtwb3NpdGlvbjpyZWxhdGl2ZTt3aWR0aDo3MCU7JyA+PHAgPjxmb250IHNpemU9JzEnIGNvbG9yPSdncmV5JyA+ICIrdGFnKyI6IDwvZm9udD4gPGZvbnQgc2l6ZT0nMScgID48Yj4gIisoZC52YWx1ZSkudG9GaXhlZCgyKSsNCiAgICAgICIgPGJyPjxmb250IHNpemU9JzEnIGNvbG9yPSdncmV5JyA+IE1pbi46IDwvZm9udD4iKyhkLm1pbikudG9GaXhlZCgyKSsiIDxicj48Zm9udCBzaXplPScxJyBjb2xvcj0nZ3JleScgPiBNYXguOiA8L2ZvbnQ+ICIrKGQubWF4KS50b0ZpeGVkKDIpKw0KICAgICAgIjwvZm9udD48YnI+PGZvbnQgc2l6ZT0nMScgY29sb3I9J2dyZXknID4gQ291bnQ6IDwvZm9udD48Zm9udCBzaXplPScxJz4iK2QuY291bnQrIjwvcD48L2ZvbnQ+PC9kaXY+PC9kaXY+PGRpdiBpZCA9J21pY3JvQmFyIitwbG9pZHkrIicgc3R5bGU9J2Zsb2F0OnRvcDtwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6MzUlJz48L2Rpdj48YnI+PGRpdiAgc3R5bGU9J2Zsb2F0OnRvcDtoZWlnaHQ6MjAlO3Bvc2l0aW9uOnJlbGF0aXZlO2NvbG9yOidibGFjayIrDQogICAgICAiOyc+PGZvbnQgc2l6ZT0nMicgPiIrZC5yYW5nZSsiPC9mb250PjwvcD48L2Rpdj4iKQ0KICAgICAgLnN0eWxlKCJsZWZ0IiwgKGQzLmV2ZW50LnBhZ2VYKSArICJweCIpDQogICAgICAuc3R5bGUoInRvcCIsIChkMy5ldmVudC5wYWdlWSAtIDE4KSArICJweCIpOyB2YXIgc3ZnV2lkdGggPSAxNzUrZC5jb3VudCooZDMubWF4KGQubGFiZWwpLmxlbmd0aCkqMzt2YXIgc3ZnSGVpZ2h0ID0gNTA7dmFyIGJhclBhZGRpbmcgPSA1O3ZhciBiYXJXaWR0aCA9IChzdmdXaWR0aCAvIGQuYmFyLmxlbmd0aCk7dmFyIG15c3ZnID0gZDMuc2VsZWN0KCcjbWljcm9CYXInK3Bsb2lkeSkuYXBwZW5kKCJzdmciKS5hdHRyKCJ3aWR0aCIsc3ZnV2lkdGgpLmF0dHIoImhlaWd0aCIsc3ZnSGVpZ2h0KTt2YXIgYmFyQ2hhcnQgPSBteXN2Zy5zZWxlY3RBbGwoJ3JlY3QnKS5kYXRhKGQuYmFyKS5lbnRlcigpLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2hlaWdodCcsc3ZnSGVpZ2h0LTQwKS5hdHRyKCd3aWR0aCcsIGJhcldpZHRoKS5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAoZCwgaSkgeyB2YXIgdHJhbnNsYXRlID0gW2JhcldpZHRoICogaSwgMF07ICByZXR1cm4gJ3RyYW5zbGF0ZSgnKyB0cmFuc2xhdGUgKycpJzt9KS5zdHlsZSgiZmlsbCIsZnVuY3Rpb24oZCl7cmV0dXJuIGNvbG9yc1t0aW1lc10oZCk7fSk7DQogICAgICB0X2RhdGE9W107DQogICAgICBmb3Ioaj0wO2o8ZC5sYWJlbC5sZW5ndGg7aisrKXsNCiAgICAgICAgdF9kYXRhLnB1c2goe2xiOmQubGFiZWxbal0saGw6ZC5obGlua1tqXX0pOyB9DQogICAgICB2YXIgdHRleHQ9bXlzdmcuc2VsZWN0QWxsKCIubm9kZSIpLmRhdGEodF9kYXRhKS5lbnRlcigpLmFwcGVuZCgic3ZnOmEiKS5hdHRyKCJ4bGluazpocmVmIiwgZnVuY3Rpb24oZCxpKXsgcmV0dXJuIGQuaGw7fSkNCiAgICAgIC5hcHBlbmQoInN2Zzp0ZXh0IikuYXR0cigieSIsc3ZnSGVpZ2h0KjAuNCkuYXR0cigidHJhbnNmb3JtIiwicm90YXRlKDkwKSIpDQogICAgICAuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24gKGQsIGkpIHsgdmFyIHRyYW5zbGF0ZSA9IFtiYXJXaWR0aCAqIGksIDBdOyAgcmV0dXJuICd0cmFuc2xhdGUoJysgdHJhbnNsYXRlICsnKSc7fSkNCiAgICAgIC5zdHlsZSgicG9pbnRlci1ldmVudHMiLCAiYWxsIikuc3R5bGUoImN1cnNvciIsInBvaW50ZXIiKS5hdHRyKCJmb250LXNpemUiLCAiOXB4IikNCiAgICAgIC50ZXh0KGZ1bmN0aW9uKGQsaSl7cmV0dXJuIGQubGI7fSk7IH0pDQogICAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oZCkgewl0aXBbcGxvaWR5LTFdLnRyYW5zaXRpb24oKSAuZGVsYXkoMTAwMCkuZHVyYXRpb24oNTAwKQkuc3R5bGUoIm9wYWNpdHkiLCAwKTt9KS5zdHlsZSgidmlzaWJpbGl0eSIsInZpc2libGUiKS5zdHlsZSgiZmlsbCIsZnVuY3Rpb24oZCl7IHJldHVybiBjb2xvcnNbdGltZXNdKGQudmFsdWUpO30pDQogICAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oZCkgew0KDQoNCiAgICAgICAgaWYoY2xpY2tGbGFnKXsNCiAgICAgICAgICAgICB0aXAyW3Bsb2lkeS0xXS5zdHlsZSgib3BhY2l0eSIsIDApOw0KICAgICAgICAgIH1lbHNlew0KICAgICAgICB0aXAyW3Bsb2lkeS0xXS5zdHlsZSgiei1pbmRleCIsOTk5OTk5OTkpCS5zdHlsZSgib3BhY2l0eSIsIDEpLnN0eWxlKCJiYWNrZ3JvdW5kLWNvbG9yIiwiI0Y1RjVGNSIpLnN0eWxlKCJ3aWR0aCIsMTgwK2QuY291bnQqKGQzLm1heChkLmxhYmVsKS5sZW5ndGgqMykrJ3B4Jyk7DQogICAgICAgIHRpcDJbcGxvaWR5LTFdLmh0bWwoIjxkaXYgIHN0eWxlPSdmbG9hdDp0b3A7cG9zaXRpb246cmVsYXRpdmU7aGVpZ2h0OjM1JTsnID48ZGl2IHN0eWxlPSdib3JkZXItcmFkaXVzOiA1cHg7ZmxvYXQ6bGVmdDtwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6NTVweDt3aWR0aDozMCU7YmFja2dyb3VuZC1jb2xvcjoiK2NvbG9yc1t0aW1lc10oZC52YWx1ZSkrDQogICAgICAgICI7JyA+PC9kaXY+PGRpdiAgc3R5bGU9J2Zsb2F0OmxlZnQ7cG9zaXRpb246cmVsYXRpdmU7d2lkdGg6NzAlOycgPjxwID48Zm9udCBzaXplPScxJyBjb2xvcj0nZ3JleScgPiAiK3RhZysiOiA8L2ZvbnQ+IDxmb250IHNpemU9JzEnICA+PGI+ICIrKGQudmFsdWUpLnRvRml4ZWQoMikrDQogICAgICAgICIgPGJyPjxmb250IHNpemU9JzEnIGNvbG9yPSdncmV5JyA+IE1pbi46IDwvZm9udD4iKyhkLm1pbikudG9GaXhlZCgyKSsiIDxicj48Zm9udCBzaXplPScxJyBjb2xvcj0nZ3JleScgPiBNYXguOiA8L2ZvbnQ+ICIrKGQubWF4KS50b0ZpeGVkKDIpKw0KICAgICAgICAiPC9mb250Pjxicj48Zm9udCBzaXplPScxJyBjb2xvcj0nZ3JleScgPiBDb3VudDogPC9mb250Pjxmb250IHNpemU9JzEnPiIrZC5jb3VudCsiPC9wPjwvZm9udD48L2Rpdj48L2Rpdj48ZGl2IGlkID0nbWljcm9CYXIyIitwbG9pZHkrIicgc3R5bGU9J2Zsb2F0OnRvcDtwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6MzUlJz48L2Rpdj48YnI+PGRpdiAgc3R5bGU9J2Zsb2F0OnRvcDtoZWlnaHQ6MjAlO3Bvc2l0aW9uOnJlbGF0aXZlO2NvbG9yOidibGFjayIrDQogICAgICAgICI7Jz48Zm9udCBzaXplPScyJyA+IitkLnJhbmdlKyI8L2ZvbnQ+PC9wPjwvZGl2PiIpDQogICAgICAgIC5zdHlsZSgibGVmdCIsIChkMy5ldmVudC5wYWdlWCkgKyAicHgiKQ0KICAgICAgICAuc3R5bGUoInRvcCIsIChkMy5ldmVudC5wYWdlWSAtIDE4KSArICJweCIpOyB2YXIgc3ZnV2lkdGggPSAxNzUrZC5jb3VudCooZDMubWF4KGQubGFiZWwpLmxlbmd0aCkqMzt2YXIgc3ZnSGVpZ2h0ID0gNTA7dmFyIGJhclBhZGRpbmcgPSA1O3ZhciBiYXJXaWR0aCA9IChzdmdXaWR0aCAvIGQuYmFyLmxlbmd0aCk7dmFyIG15c3ZnMiA9IGQzLnNlbGVjdCgnI21pY3JvQmFyMicrcGxvaWR5KS5hcHBlbmQoInN2ZyIpLmF0dHIoIndpZHRoIixzdmdXaWR0aCkuYXR0cigiaGVpZ3RoIixzdmdIZWlnaHQpO3ZhciBiYXJDaGFydCA9IG15c3ZnMi5zZWxlY3RBbGwoJ3JlY3QnKS5kYXRhKGQuYmFyKS5lbnRlcigpLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2hlaWdodCcsc3ZnSGVpZ2h0LTQwKS5hdHRyKCd3aWR0aCcsIGJhcldpZHRoKS5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAoZCwgaSkgeyB2YXIgdHJhbnNsYXRlID0gW2JhcldpZHRoICogaSwgMF07ICByZXR1cm4gJ3RyYW5zbGF0ZSgnKyB0cmFuc2xhdGUgKycpJzt9KS5zdHlsZSgiZmlsbCIsZnVuY3Rpb24oZCl7cmV0dXJuIGNvbG9yc1t0aW1lc10oZCk7fSk7DQogICAgICAgIHRfZGF0YT1bXTsNCiAgICAgICAgZm9yKGo9MDtqPGQubGFiZWwubGVuZ3RoO2orKyl7DQogICAgICAgICAgdF9kYXRhLnB1c2goe2xiOmQubGFiZWxbal0saGw6ZC5obGlua1tqXX0pOyB9DQogICAgICAgIHZhciB0dGV4dD1teXN2ZzIuc2VsZWN0QWxsKCIubm9kZSIpLmRhdGEodF9kYXRhKS5lbnRlcigpLmFwcGVuZCgic3ZnOmEiKS5hdHRyKCJ4bGluazpocmVmIiwgZnVuY3Rpb24oZCxpKXsgcmV0dXJuIGQuaGw7fSkuYXBwZW5kKCJzdmc6dGV4dCIpLmF0dHIoInkiLHN2Z0hlaWdodCowLjQpLmF0dHIoInRyYW5zZm9ybSIsInJvdGF0ZSg5MCkiKS5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAoZCwgaSkgeyB2YXIgdHJhbnNsYXRlID0gW2JhcldpZHRoICogaSwgMF07ICByZXR1cm4gJ3RyYW5zbGF0ZSgnKyB0cmFuc2xhdGUgKycpJzt9KS5zdHlsZSgicG9pbnRlci1ldmVudHMiLCAiYWxsIikuc3R5bGUoImN1cnNvciIsInBvaW50ZXIiKS5hdHRyKCJmb250LXNpemUiLCAiOXB4IikudGV4dChmdW5jdGlvbihkLGkpe3JldHVybiBkLmxiO30pOw0KICAgICAgfSByZXR1cm4gY2xpY2tGbGFnID0gIWNsaWNrRmxhZzsgfSk7DQoNCiAgICAgIGlmKHBsb2lkeT09MSAmJiBsYWJlbHMpew0KDQogICAgICAgIHZhciBjaERhdGFMYWJlbHMgPSBkMy5uZXN0KCkNCiAgICAua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCiAgICAucm9sbHVwKGZ1bmN0aW9uKHYpIHsgIHZhciBhPVtdO2Zvcih2YXIgaT0wOyBpPCB2Lmxlbmd0aDtpKyspeyBhLnB1c2godltpXS5uYW1lKTsgICB9O3JldHVybiBhWzBdO30pDQogICAgLmVudHJpZXMoY2hEYXRhKTsNCg0KICAgIHZhciBjaERhdGFMYWJlbCA9IGQzLm5lc3QoKQ0KLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQoucm9sbHVwKGZ1bmN0aW9uKHYpIHsgIHZhciBhPVtdO2Zvcih2YXIgaT0wOyBpPCB2Lmxlbmd0aDtpKyspeyBhLnB1c2godltpXS5sYWJlbCk7ICAgfTtyZXR1cm4gYVswXTt9KQ0KLmVudHJpZXMoY2hEYXRhKTsNCiAgICAgICBmb3IodmFyIGkgPSAwO2kgPCBjaERhdGFSZWR1Y2VkLmxlbmd0aDtpKyspIHsNCg0KDQogICAgICAgIGNoRGF0YVJlZHVjZWRbaV0ubGFiZWxfaWQ9Y2hEYXRhTGFiZWxbaV0udmFsdWU7DQogICAgICAgIGNoRGF0YVJlZHVjZWRbaV0ubGFiZWxzID1jaERhdGFMYWJlbHNbaV0udmFsdWU7DQoNCiAgICAgIH0NCg0KDQogICAgICAgZDMuc2VsZWN0QWxsKCIubGFiZWxzIikuZGF0YShjaERhdGFSZWR1Y2VkLCBmdW5jdGlvbihkKSB7cmV0dXJuIChkICYmIGQubGFiZWxfaWQpfHxkMy5zZWxlY3QodGhpcykuYXR0cigiaWQiKTt9KS50ZXh0KGZ1bmN0aW9uKGQpeyByZXR1cm4gZC5sYWJlbHM7fSk7DQogICAgIH0NCg0KDQoNCg0KDQoNCn0gZWxzZSB7DQogIGlmKGhlYXRfc2NhbGU9PSJvcmRpbmFsIil7DQogIHZhciBjaERhdGFSZWR1Y2VkID0gZDMubmVzdCgpDQogIC5rZXkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sb2NpOyB9KQ0KICAucm9sbHVwKGZ1bmN0aW9uKHYpIHsgIHZhciBhPVtdO2Zvcih2YXIgaT0wOyBpPCB2Lmxlbmd0aDtpKyspeyBhLnB1c2godltpXS5kYXRhKTsgICB9O3JldHVybiBhWzBdO30pDQogIC5lbnRyaWVzKGNoRGF0YSk7DQoNCg0KICB2YXIgY2hEYXRhUmVkdWNlZEJhckRhdGEgPSBkMy5uZXN0KCkNCiAgLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQogIC5yb2xsdXAoZnVuY3Rpb24odikgeyB2PXYuc29ydChmdW5jdGlvbihhLGIpe3JldHVybiBNYXRoLmFicyhhWydjaF9zdGFydCddKSAtIE1hdGguYWJzKGJbJ2NoX3N0YXJ0J10pfSk7YmFyPVtdOyBmb3IodmFyIGc9MDtnPHYubGVuZ3RoO2crKyl7YmFyLnB1c2godltnXS5kYXRhKTt9O3JldHVybiBiYXI7fSkNCiAgLmVudHJpZXMoY2hEYXRhKTsNCiAgdmFyIGNoRGF0YVJlZHVjZWRCYXJMYWJlbCA9IGQzLm5lc3QoKQ0KICAua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCiAgLnJvbGx1cChmdW5jdGlvbih2KSB7IHY9di5zb3J0KGZ1bmN0aW9uKGEsYil7cmV0dXJuIE1hdGguYWJzKGFbJ2NoX3N0YXJ0J10pIC0gTWF0aC5hYnMoYlsnY2hfc3RhcnQnXSl9KTtiYXI9W107IGZvcih2YXIgZz0wO2c8di5sZW5ndGg7ZysrKXtiYXIucHVzaCh2W2ddLm5hbWUpO307cmV0dXJuIGJhcjt9KQ0KICAuZW50cmllcyhjaERhdGEpOw0KDQogIHZhciBjaERhdGFSZWR1Y2VkQmFyTGluayA9IGQzLm5lc3QoKQ0KICAua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCiAgLnJvbGx1cChmdW5jdGlvbih2KSB7IHY9di5zb3J0KGZ1bmN0aW9uKGEsYil7cmV0dXJuIE1hdGguYWJzKGFbJ2NoX3N0YXJ0J10pIC0gTWF0aC5hYnMoYlsnY2hfc3RhcnQnXSl9KTtiYXI9W107IGZvcih2YXIgZz0wO2c8di5sZW5ndGg7ZysrKXtiYXIucHVzaCh2W2ddLmhsaW5rKTt9O3JldHVybiBiYXI7fSkNCiAgLmVudHJpZXMoY2hEYXRhKTsNCiAgdmFyIGNoRGF0YVJlZHVjZWRDb3VudCA9IGQzLm5lc3QoKQ0KICAua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCiAgLnJvbGx1cChmdW5jdGlvbih2KSB7IHJldHVybiB2Lmxlbmd0aDt9KQ0KICAuZW50cmllcyhjaERhdGEpOw0KCXZhciBjaERhdGFSYW5nZSA9IGQzLm5lc3QoKQ0KLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQoucm9sbHVwKGZ1bmN0aW9uKHYpIHsgIHZhciBhLGI7Zm9yKHZhciBpPTA7IGk8IHYubGVuZ3RoO2krKyl7IGEgPSB2W2ldLmxvY2lfc3RhcnQ7IGI9dltpXS5sb2NpX2VuZDsgICAgfTtyZXR1cm4gIiIrYSsiLSIrYisiYnAgIjt9KQ0KLmVudHJpZXMoY2hEYXRhKTsNCg0KICBmb3IodmFyIGkgPSAwO2kgPCBjaERhdGFSZWR1Y2VkLmxlbmd0aDtpKyspIHsNCg0KDQogICAgY2hEYXRhUmVkdWNlZFtpXS5yYW5nZSA9IGNoRGF0YVJhbmdlW2ldLnZhbHVlOw0KDQogICAgY2hEYXRhUmVkdWNlZFtpXS5iYXIgPSBjaERhdGFSZWR1Y2VkQmFyRGF0YVtpXS52YWx1ZTsNCiAgICBjaERhdGFSZWR1Y2VkW2ldLmxhYmVsID0gY2hEYXRhUmVkdWNlZEJhckxhYmVsW2ldLnZhbHVlOw0KICAgIGNoRGF0YVJlZHVjZWRbaV0uY291bnQgPSBjaERhdGFSZWR1Y2VkQ291bnRbaV0udmFsdWU7DQogICAgY2hEYXRhUmVkdWNlZFtpXS5obGluayA9IGNoRGF0YVJlZHVjZWRCYXJMaW5rW2ldLnZhbHVlOw0KICB9DQoNCiAgdmFyIHRpcCA9IFtdOw0KICB0aXBbcGxvaWR5LTFdID0gZDMuc2VsZWN0KCJib2R5IikuYXBwZW5kKCJkaXYiKQ0KICAgICAuYXR0cigiY2xhc3MiLCAiY2h0b29sdGlwIikNCiAgICAgLnN0eWxlKCJvcGFjaXR5IiwgMCkNCiAgICAgLmF0dHIoInN0eWxlIiwgInBvc2l0aW9uOiBhYnNvbHV0ZTt0ZXh0LWFsaWduOiBjZW50ZXI7d2lkdGg6IDE4MHB4O2hlaWdodDogMTQwcHg7CSBwYWRkaW5nOiAycHg7CWZvbnQ6IDEycHggc2Fucy1zZXJpZjsJYm94LXNpemluZzogYm9yZGVyLWJveDsJYm9yZGVyOiAwcHg7Ym9yZGVyLXJhZGl1czogOHB4O3BvaW50ZXItZXZlbnRzOiBub25lOyIpIDsNCg0KICAgICB2YXIgdGlwMiA9IFtdOw0KICAgICAgdGlwMltwbG9pZHktMV0gPSBkMy5zZWxlY3QoImJvZHkiKS5hcHBlbmQoImRpdiIpDQogICAgICAgICAuYXR0cigiY2xhc3MiLCAiY2h0b29sdGlwMiIpDQogICAgICAgICAuc3R5bGUoIm9wYWNpdHkiLCAwKQ0KICAgICAgICAgLmF0dHIoInN0eWxlIiwgInBvc2l0aW9uOiBhYnNvbHV0ZTt0ZXh0LWFsaWduOiBjZW50ZXI7d2lkdGg6IDE4MHB4O2hlaWdodDogMTQwcHg7CSBwYWRkaW5nOiAycHg7CWZvbnQ6IDEycHggc2Fucy1zZXJpZjsJYm94LXNpemluZzogYm9yZGVyLWJveDsJYm9yZGVyOiAwcHg7Ym9yZGVyLXJhZGl1czogOHB4O3BvaW50ZXItZXZlbnRzOiBub25lOyIpIDsNCiAgICAgdmFyIGNsaWNrRmxhZz1mYWxzZTsNCg0KICAgICBkMy5zZWxlY3RBbGwoIi5jaExvYyIpLmRhdGEoY2hEYXRhUmVkdWNlZCwgZnVuY3Rpb24oZCkge3JldHVybiAoZCAmJiBkLmtleSl8fGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJpZCIpO30pLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbihkKSB7dGlwW3Bsb2lkeS0xXS50cmFuc2l0aW9uKCkuZHVyYXRpb24oMjAwKQkuc3R5bGUoIm9wYWNpdHkiLCAuOSkuc3R5bGUoImJhY2tncm91bmQtY29sb3IiLCIjRjVGNUY1Iikuc3R5bGUoIndpZHRoIiwxODArZC5jb3VudCooZDMubWF4KGQubGFiZWwpLmxlbmd0aCozKSsncHgnKTsNCiAgICAgdGlwW3Bsb2lkeS0xXS5odG1sKCI8ZGl2ICBzdHlsZT0nZmxvYXQ6dG9wO3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDozNSU7JyA+PGRpdiBzdHlsZT0nYm9yZGVyLXJhZGl1czogNXB4O2Zsb2F0OmxlZnQ7cG9zaXRpb246cmVsYXRpdmU7aGVpZ2h0OjU1cHg7d2lkdGg6MzAlO2JhY2tncm91bmQtY29sb3I6Iitjb2xvcnNbdGltZXNdKGQudmFsdWUpKw0KICAgICAiOycgPjwvZGl2PjxkaXYgIHN0eWxlPSdmbG9hdDpsZWZ0O3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjcwJTsnID48cCA+PGZvbnQgc2l6ZT0nMScgY29sb3I9J2dyZXknID4gIDwvZm9udD4gPGZvbnQgc2l6ZT0nMScgID48Yj4gIisiIisNCiAgICAgIiA8YnI+PGZvbnQgc2l6ZT0nMScgY29sb3I9J2dyZXknID4gQ291bnQ6PC9mb250PiIrZC5jb3VudCsiIDxicj48Zm9udCBzaXplPScxJyBjb2xvcj0nZ3JleScgPiAgPC9mb250PiAiKyIiKw0KICAgICAiPC9mb250Pjxicj48Zm9udCBzaXplPScxJyBjb2xvcj0nZ3JleScgPiAgPC9mb250Pjxmb250IHNpemU9JzEnPiIrIiIrIjwvcD48L2ZvbnQ+PC9kaXY+PC9kaXY+PGRpdiBpZCA9J21pY3JvQmFyIitwbG9pZHkrIicgc3R5bGU9J2Zsb2F0OnRvcDtwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6MzUlJz48L2Rpdj48YnI+PGRpdiAgc3R5bGU9J2Zsb2F0OnRvcDtoZWlnaHQ6MjAlO3Bvc2l0aW9uOnJlbGF0aXZlO2NvbG9yOidibGFjayIrDQogICAgICI7Jz48Zm9udCBzaXplPScyJyA+IitkLnJhbmdlKyI8L2ZvbnQ+PC9wPjwvZGl2PiIpDQogICAgIC5zdHlsZSgibGVmdCIsIChkMy5ldmVudC5wYWdlWCkgKyAicHgiKQ0KICAgICAuc3R5bGUoInRvcCIsIChkMy5ldmVudC5wYWdlWSAtIDE4KSArICJweCIpOyB2YXIgc3ZnV2lkdGggPSAxNzUrZC5jb3VudCooZDMubWF4KGQubGFiZWwpLmxlbmd0aCkqMzt2YXIgc3ZnSGVpZ2h0ID0gNTA7dmFyIGJhclBhZGRpbmcgPSA1O3ZhciBiYXJXaWR0aCA9IChzdmdXaWR0aCAvIGQuYmFyLmxlbmd0aCk7dmFyIG15c3ZnID0gZDMuc2VsZWN0KCcjbWljcm9CYXInK3Bsb2lkeSkuYXBwZW5kKCJzdmciKS5hdHRyKCJ3aWR0aCIsc3ZnV2lkdGgpLmF0dHIoImhlaWd0aCIsc3ZnSGVpZ2h0KTt2YXIgYmFyQ2hhcnQgPSBteXN2Zy5zZWxlY3RBbGwoJ3JlY3QnKS5kYXRhKGQuYmFyKS5lbnRlcigpLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2hlaWdodCcsc3ZnSGVpZ2h0LTQwKS5hdHRyKCd3aWR0aCcsIGJhcldpZHRoKS5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAoZCwgaSkgeyB2YXIgdHJhbnNsYXRlID0gW2JhcldpZHRoICogaSwgMF07ICByZXR1cm4gJ3RyYW5zbGF0ZSgnKyB0cmFuc2xhdGUgKycpJzt9KS5zdHlsZSgiZmlsbCIsZnVuY3Rpb24oZCl7cmV0dXJuIGNvbG9yc1t0aW1lc10oZCk7fSk7DQogICAgICB0X2RhdGE9W107DQogICAgICBmb3Ioaj0wO2o8ZC5sYWJlbC5sZW5ndGg7aisrKXsNCiAgICAgICAgdF9kYXRhLnB1c2goe2xiOmQubGFiZWxbal0saGw6ZC5obGlua1tqXX0pOw0KICAgICAgfQ0KDQogICAgIHZhciB0dGV4dD1teXN2Zy5zZWxlY3RBbGwoIi5ub2RlIikuZGF0YSh0X2RhdGEpLmVudGVyKCkuYXBwZW5kKCJzdmc6YSIpLmF0dHIoInhsaW5rOmhyZWYiLCBmdW5jdGlvbihkLGkpeyByZXR1cm4gZC5obDt9KQ0KICAgICAuYXBwZW5kKCJzdmc6dGV4dCIpLmF0dHIoInkiLHN2Z0hlaWdodCowLjQpDQogICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCJyb3RhdGUoOTApIikNCiAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uIChkLCBpKSB7IHZhciB0cmFuc2xhdGUgPSBbYmFyV2lkdGggKiBpLCAwXTsgIHJldHVybiAndHJhbnNsYXRlKCcrIHRyYW5zbGF0ZSArJyknO30pDQogICAgIC5hdHRyKCJmb250LXNpemUiLCAiOXB4Iikuc3R5bGUoInBvaW50ZXItZXZlbnRzIiwgImFsbCIpDQogICAgIC5hdHRyKCJjbGFzcyIsInR0dCIpLnN0eWxlKCJjdXJzb3IiLCJwb2ludGVyIikNCiAgICAgLnRleHQoZnVuY3Rpb24oZCxpKXtyZXR1cm4gZC5sYjt9KTsgIH0pDQogICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbihkKSB7CXRpcFtwbG9pZHktMV0udHJhbnNpdGlvbigpIC5kZWxheSgxMDAwKS5kdXJhdGlvbig1MDApCS5zdHlsZSgib3BhY2l0eSIsIDApO30pLnN0eWxlKCJ2aXNpYmlsaXR5IiwidmlzaWJsZSIpLnN0eWxlKCJmaWxsIixmdW5jdGlvbihkKXsgcmV0dXJuIGNvbG9yc1t0aW1lc10oZC52YWx1ZSk7fSkNCiAgICAgLm9uKCJjbGljayIsIGZ1bmN0aW9uKGQpIHsNCg0KDQogICAgICAgaWYoY2xpY2tGbGFnKXsNCiAgICAgICAgICAgIHRpcDJbcGxvaWR5LTFdLnN0eWxlKCJvcGFjaXR5IiwgMCk7DQogICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgdGlwMltwbG9pZHktMV0udHJhbnNpdGlvbigpLmR1cmF0aW9uKDIwMCkJLnN0eWxlKCJvcGFjaXR5IiwgLjkpLnN0eWxlKCJiYWNrZ3JvdW5kLWNvbG9yIiwiI0Y1RjVGNSIpLnN0eWxlKCJ3aWR0aCIsMTgwK2QuY291bnQqKGQzLm1heChkLmxhYmVsKS5sZW5ndGgqMykrJ3B4Jyk7DQogICAgICAgICAgIHRpcDJbcGxvaWR5LTFdLmh0bWwoIjxkaXYgIHN0eWxlPSdmbG9hdDp0b3A7cG9zaXRpb246cmVsYXRpdmU7aGVpZ2h0OjM1JTsnID48ZGl2IHN0eWxlPSdib3JkZXItcmFkaXVzOiA1cHg7ZmxvYXQ6bGVmdDtwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6NTVweDt3aWR0aDozMCU7YmFja2dyb3VuZC1jb2xvcjoiK2NvbG9yc1t0aW1lc10oZC52YWx1ZSkrDQogICAgICAgICAgICI7JyA+PC9kaXY+PGRpdiAgc3R5bGU9J2Zsb2F0OmxlZnQ7cG9zaXRpb246cmVsYXRpdmU7d2lkdGg6NzAlOycgPjxwID48Zm9udCBzaXplPScxJyBjb2xvcj0nZ3JleScgPiAgPC9mb250PiA8Zm9udCBzaXplPScxJyAgPjxiPiAiKyIiKw0KICAgICAgICAgICAiIDxicj48Zm9udCBzaXplPScxJyBjb2xvcj0nZ3JleScgPiBDb3VudDo8L2ZvbnQ+IitkLmNvdW50KyIgPGJyPjxmb250IHNpemU9JzEnIGNvbG9yPSdncmV5JyA+ICA8L2ZvbnQ+ICIrIiIrDQogICAgICAgICAgICI8L2ZvbnQ+PGJyPjxmb250IHNpemU9JzEnIGNvbG9yPSdncmV5JyA+ICA8L2ZvbnQ+PGZvbnQgc2l6ZT0nMSc+IisiIisiPC9wPjwvZm9udD48L2Rpdj48L2Rpdj48ZGl2IGlkID0nbWljcm9CYXIyIitwbG9pZHkrIicgc3R5bGU9J2Zsb2F0OnRvcDtwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6MzUlJz48L2Rpdj48YnI+PGRpdiAgc3R5bGU9J2Zsb2F0OnRvcDtoZWlnaHQ6MjAlO3Bvc2l0aW9uOnJlbGF0aXZlO2NvbG9yOidibGFjayIrDQogICAgICAgICAgICI7Jz48Zm9udCBzaXplPScyJyA+IitkLnJhbmdlKyI8L2ZvbnQ+PC9wPjwvZGl2PiIpDQogICAgICAgICAgIC5zdHlsZSgibGVmdCIsIChkMy5ldmVudC5wYWdlWCkgKyAicHgiKQ0KICAgICAgICAgICAuc3R5bGUoInRvcCIsIChkMy5ldmVudC5wYWdlWSAtIDE4KSArICJweCIpOyB2YXIgc3ZnV2lkdGggPSAxNzUrZC5jb3VudCooZDMubWF4KGQubGFiZWwpLmxlbmd0aCkqMzt2YXIgc3ZnSGVpZ2h0ID0gNTA7dmFyIGJhclBhZGRpbmcgPSA1O3ZhciBiYXJXaWR0aCA9IChzdmdXaWR0aCAvIGQuYmFyLmxlbmd0aCk7dmFyIG15c3ZnMiA9IGQzLnNlbGVjdCgnI21pY3JvQmFyMicrcGxvaWR5KS5hcHBlbmQoInN2ZyIpLmF0dHIoIndpZHRoIixzdmdXaWR0aCkuYXR0cigiaGVpZ3RoIixzdmdIZWlnaHQpO3ZhciBiYXJDaGFydCA9IG15c3ZnMi5zZWxlY3RBbGwoJ3JlY3QnKS5kYXRhKGQuYmFyKS5lbnRlcigpLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2hlaWdodCcsc3ZnSGVpZ2h0LTQwKS5hdHRyKCd3aWR0aCcsIGJhcldpZHRoKS5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAoZCwgaSkgeyB2YXIgdHJhbnNsYXRlID0gW2JhcldpZHRoICogaSwgMF07ICByZXR1cm4gJ3RyYW5zbGF0ZSgnKyB0cmFuc2xhdGUgKycpJzt9KS5zdHlsZSgiZmlsbCIsZnVuY3Rpb24oZCl7cmV0dXJuIGNvbG9yc1t0aW1lc10oZCk7fSk7DQogICAgICAgICAgICB0X2RhdGE9W107DQogICAgICAgICAgICBmb3Ioaj0wO2o8ZC5sYWJlbC5sZW5ndGg7aisrKXsNCiAgICAgICAgICAgICAgdF9kYXRhLnB1c2goe2xiOmQubGFiZWxbal0saGw6ZC5obGlua1tqXX0pOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgIHZhciB0dGV4dD1teXN2ZzIuc2VsZWN0QWxsKCIubm9kZSIpLmRhdGEodF9kYXRhKS5lbnRlcigpLmFwcGVuZCgic3ZnOmEiKS5hdHRyKCJ4bGluazpocmVmIiwgZnVuY3Rpb24oZCxpKXsgcmV0dXJuIGQuaGw7fSkNCiAgICAgICAgICAgLmFwcGVuZCgic3ZnOnRleHQiKS5hdHRyKCJ5IixzdmdIZWlnaHQqMC40KQ0KICAgICAgICAgICAuYXR0cigidHJhbnNmb3JtIiwicm90YXRlKDkwKSIpDQogICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAoZCwgaSkgeyB2YXIgdHJhbnNsYXRlID0gW2JhcldpZHRoICogaSwgMF07ICByZXR1cm4gJ3RyYW5zbGF0ZSgnKyB0cmFuc2xhdGUgKycpJzt9KQ0KICAgICAgICAgICAuYXR0cigiZm9udC1zaXplIiwgIjlweCIpLnN0eWxlKCJwb2ludGVyLWV2ZW50cyIsICJhbGwiKQ0KICAgICAgICAgICAuYXR0cigiY2xhc3MiLCJ0dHQiKS5zdHlsZSgiY3Vyc29yIiwicG9pbnRlciIpDQogICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uKGQsaSl7cmV0dXJuIGQubGI7fSk7IH0gcmV0dXJuIGNsaWNrRmxhZyA9ICFjbGlja0ZsYWc7IH0pOw0KDQogICAgIGlmKHBsb2lkeT09MSAmJiBsYWJlbHMpew0KDQogICAgICB2YXIgY2hEYXRhTGFiZWxzID0gZDMubmVzdCgpDQogIC5rZXkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sb2NpOyB9KQ0KICAucm9sbHVwKGZ1bmN0aW9uKHYpIHsgIHZhciBhPVtdO2Zvcih2YXIgaT0wOyBpPCB2Lmxlbmd0aDtpKyspeyBhLnB1c2godltpXS5uYW1lKTsgICB9O3JldHVybiBhWzBdO30pDQogIC5lbnRyaWVzKGNoRGF0YSk7DQogIHZhciBjaERhdGFMYWJlbCA9IGQzLm5lc3QoKQ0KLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQoucm9sbHVwKGZ1bmN0aW9uKHYpIHsgIHZhciBhPVtdO2Zvcih2YXIgaT0wOyBpPCB2Lmxlbmd0aDtpKyspeyBhLnB1c2godltpXS5sYWJlbCk7ICAgfTtyZXR1cm4gYVswXTt9KQ0KLmVudHJpZXMoY2hEYXRhKTsNCiAgICAgZm9yKHZhciBpID0gMDtpIDwgY2hEYXRhUmVkdWNlZC5sZW5ndGg7aSsrKSB7DQoNCg0KICAgICAgY2hEYXRhUmVkdWNlZFtpXS5sYWJlbF9pZCA9IGNoRGF0YUxhYmVsW2ldLnZhbHVlOw0KICAgICAgY2hEYXRhUmVkdWNlZFtpXS5sYWJlbHMgPWNoRGF0YUxhYmVsc1tpXS52YWx1ZTsNCg0KICAgIH0NCg0KDQogICAgIGQzLnNlbGVjdEFsbCgiLmxhYmVscyIpLmRhdGEoY2hEYXRhUmVkdWNlZCwgZnVuY3Rpb24oZCkge3JldHVybiAoZCAmJiBkLmxhYmVsX2lkKXx8ZDMuc2VsZWN0KHRoaXMpLmF0dHIoImlkIik7fSkudGV4dChmdW5jdGlvbihkKXsgcmV0dXJuIGQubGFiZWxzO30pOw0KICAgfQ0KfQ0KDQp9DQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCiAgLy9oZWF0bWFwIGNvZGUgZW5kDQogfQ0KDQoNCn0NCg0KDQoNCi8vbG9naWMgZm9yIHZlcnRpY2FsDQpmdW5jdGlvbiByZW5kZXJDaHJvbW9NYXBWKGNoRGF0YSxjaHJfc3BhY2luZyxwbG9pZHksY2hfd2lkdGgsYXJjVG9wLGFyY0JvdCxzdmcsbkxvY2ksY250LGNocl9jb2xvcixoZWF0bWFwLGxlZnRfbWFyZ2luLGxnX3gsbGdfeSxoZWF0X3NjYWxlLGxhYmVscyx3aWR0aCxoZWlnaHQscm5nLGhlYXRfY29sLGFuX2NvbCxjaF90ZXh0LGxlZ2VuZCx0aW1lcyxhZ2dyZWdhdGVfZnVuYyl7DQogIGlmKGNudCl7DQoNCiAgICB2YXIgYWxsRGF0YXAgPVtdOw0KICAgIHZhciBhbGxEYXRhcT1bXTsNCg0KICAgIGZvcihpPTA7aSA8IG5Mb2NpLmxlbmd0aDtpKyspew0KDQogICAgICAgICBhbGxEYXRhcFtpXT1kMy5yYW5nZShuTG9jaVtpXS5wKTsNCiAgICAgICAgIGFsbERhdGFxW2ldPWQzLnJhbmdlKG5Mb2NpW2ldLnEpOw0KDQogICAgfQ0KDQogICAgZm9yKGk9MDtpPCBuTG9jaS5sZW5ndGg7aSsrKXsNCg0KICAgICAgICAvKiAgZmlyc3QgY2FwICovDQogICAgICAgIHBvc3g9bGVmdF9tYXJnaW47DQogICAgICAgIHBvc3k9eV92YWwgKyBpKmNocl9zcGFjaW5nKyArIGFyY19yYWRpdXMgKyAocGxvaWR5IC0gMSkqKGNoX3dpZHRoICsxICkNCiAgICAgICAgc3ZnLmFwcGVuZCgiZyIpDQogICAgICAgICAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiK3Bvc3krIiwiK3Bvc3grIikiKQ0KICAgICAgICAgICAgIC5hcHBlbmQoInBhdGgiKQ0KICAgICAgICAgICAgIC5zdHlsZSgiZmlsbCIsIGNocl9jb2xvcikNCiAgICAgICAgICAgICAuYXR0cigiZCIsIGFyY1RvcCk7DQoNCiAgICAgICAgLyogIHAgYXJtICovDQogICAgICAgIHN2Zy5zZWxlY3RBbGwoIi5yZWN0cyIpDQogICAgICAgICAgLmRhdGEoYWxsRGF0YXBbaV0pDQogICAgICAgICAgLmVudGVyKCkNCiAgICAgICAgICAuYXBwZW5kKCJyZWN0IikNCiAgICAgICAgICAuYXR0cigieCIsIHlfdmFsICsgaSpjaHJfc3BhY2luZyArIChwbG9pZHkgLSAxKSooY2hfd2lkdGggKzEgKSkNCiAgICAgICAgICAuYXR0cigiaGVpZ2h0Iixsb2NpX3dpZHRoICkNCiAgICAgICAgICAuYXR0cigieSIsIGZ1bmN0aW9uKGQsaSl7cmV0dXJuIGxlZnRfbWFyZ2luICsgaSpsb2NpX3dpZHRoO30pDQogICAgICAgICAgLmF0dHIoIndpZHRoIixjaF93aWR0aCApDQogICAgICAgICAgLmF0dHIoImZpbGwiLCBjaHJfY29sb3IpDQogICAgICAgICAgLmF0dHIoImNsYXNzIiwiY2hMb2MiKQ0KICAgICAgICAgIC5hdHRyKCJpZCIsZnVuY3Rpb24oZCxqKXtyZXR1cm4gbkxvY2lbaV0ubmFtZSsiLSIrKGorMSkrIi0iK3Bsb2lkeTt9KTsNCg0KDQoNCiAgICAgICAgc3ZnLnNlbGVjdEFsbCgiLnRleHRzIikNCiAgICAgIC5kYXRhKGFsbERhdGFwW2ldKQ0KICAgICAgLmVudGVyKCkNCiAgICAgIC5hcHBlbmQoInRleHQiKQ0KICAgICAgLmF0dHIoImNsYXNzIiwibGFiZWxzIikNCiAgICAgIC5hdHRyKCJpZCIsZnVuY3Rpb24oZCxqKSB7cmV0dXJuICJMIituTG9jaVtpXS5uYW1lKyItIisoaisxKSsiLSIrcGxvaWR5O30pLnRleHQoIiIpDQogICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAic2Fucy1zZXJpZiIpDQogICAgICAuYXR0cigiZm9udC1zaXplIiwgIjlweCIpDQogICAgICAuc3R5bGUoInRleHQtYW5jaG9yIiwgIm1pZGRsZSIpDQogICAgICAgIC5hdHRyKCJmaWxsIiwgImJsYWNrIikuYXR0cigidHJhbnNmb3JtIixmdW5jdGlvbihkLGopew0KICAgICAgICAgIHJldHVybiAidHJhbnNsYXRlKCIgKyAoKHlfdmFsICsgaSpjaHJfc3BhY2luZyArIChwbG9pZHkgLSAxKSooY2hfd2lkdGggKzEgKSktMikgKyAiLCAiKyhsZWZ0X21hcmdpbiArIGoqbG9jaV93aWR0aCkrIikgIiArICJyb3RhdGUoLTkwKSJ9KTsNCg0KDQoNCg0KICAgICAgICAgIC8qICBjZW50cm9tZXJlICovDQogICAgICAgICAgcG9zeD1sZWZ0X21hcmdpbisobkxvY2lbaV0ucCkqbG9jaV93aWR0aA0KICAgICAgICAgIHBvc3k9eV92YWwgKyBpKmNocl9zcGFjaW5nKyArIGFyY19yYWRpdXMgKyAocGxvaWR5IC0gMSkqKGNoX3dpZHRoICsxICkNCiAgICAgICAgICBzdmcuYXBwZW5kKCJnIikNCiAgICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKCIrcG9zeSsiLCIrcG9zeCsiKSIpDQogICAgICAgIC5hcHBlbmQoInBhdGgiKQ0KICAgICAgICAuc3R5bGUoImZpbGwiLCBjaHJfY29sb3IpDQogICAgICAgIC5hdHRyKCJkIiwgYXJjQm90KTsNCg0KICAgICAgICBwb3N4PWxlZnRfbWFyZ2luKyhuTG9jaVtpXS5wKSpsb2NpX3dpZHRoICsgMiphcmNfcmFkaXVzDQogICAgICAgICAgcG9zeT15X3ZhbCArIGkqY2hyX3NwYWNpbmcrICsgYXJjX3JhZGl1cyArIChwbG9pZHkgLSAxKSooY2hfd2lkdGggKzEgKQ0KICAgICAgICAgc3ZnLmFwcGVuZCgiZyIpDQogICAgICAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiK3Bvc3krIiwiK3Bvc3grIikiKQ0KICAgICAgICAuYXBwZW5kKCJwYXRoIikNCiAgICAgICAgLnN0eWxlKCJmaWxsIiwgY2hyX2NvbG9yKQ0KICAgICAgICAuYXR0cigiZCIsIGFyY1RvcCk7DQoNCiAgICAgICAgLyogc2hvcnQgYXJtICAqLw0KDQogICAgICAgIHN2Zy5zZWxlY3RBbGwoIi5yZWN0cyIpDQogICAgICAgICAgLmRhdGEoYWxsRGF0YXFbaV0pDQogICAgICAgICAgLmVudGVyKCkNCiAgICAgICAgICAuYXBwZW5kKCJyZWN0IikNCiAgICAgICAgICAuYXR0cigieCIsIHlfdmFsICsgaSpjaHJfc3BhY2luZysgKHBsb2lkeSAtIDEpKihjaF93aWR0aCArMSApKQ0KICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLGxvY2lfd2lkdGggKQ0KICAgICAgICAgIC5hdHRyKCJ5IiwgZnVuY3Rpb24oZCxqKXtyZXR1cm4gbGVmdF9tYXJnaW4gKyBqKmxvY2lfd2lkdGggKyAobkxvY2lbaV0ucCkqbG9jaV93aWR0aCArMiphcmNfcmFkaXVzO30pDQogICAgICAgICAgLmF0dHIoIndpZHRoIiwgY2hfd2lkdGgpDQogICAgICAgICAgLmF0dHIoImZpbGwiLCBjaHJfY29sb3IpDQogICAgICAgICAgLmF0dHIoImNsYXNzIiwiY2hMb2MiKQ0KICAgICAgICAgIC5hdHRyKCJpZCIsZnVuY3Rpb24oZCxqKXsgcmV0dXJuIG5Mb2NpW2ldLm5hbWUrIi0iKyhqKzErbkxvY2lbaV0ucCkrIi0iK3Bsb2lkeTt9KTsNCg0KICAgICAgICAvL2xhYmVsbGluZ3MNCg0KICAgICAgICBzdmcuc2VsZWN0QWxsKCIudGV4dHMiKQ0KICAgICAgLmRhdGEoYWxsRGF0YXFbaV0pDQogICAgICAuZW50ZXIoKQ0KICAgICAgLmFwcGVuZCgidGV4dCIpDQogICAgICAuYXR0cigiY2xhc3MiLCJsYWJlbHMiKQ0KICAgICAgLmF0dHIoImlkIixmdW5jdGlvbihkLGope3JldHVybiAiTCIrbkxvY2lbaV0ubmFtZSsiLSIrKGorMStuTG9jaVtpXS5wKSsiLSIrcGxvaWR5O30pLnRleHQoIiIpDQogICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAic2Fucy1zZXJpZiIpDQogICAgICAuYXR0cigiZm9udC1zaXplIiwgIjlweCIpDQogICAgICAuc3R5bGUoInRleHQtYW5jaG9yIiwgIm1pZGRsZSIpDQogICAgICAgIC5hdHRyKCJmaWxsIiwgImJsYWNrIikuYXR0cigidHJhbnNmb3JtIixmdW5jdGlvbihkLGopew0KICAgICAgICAgIHJldHVybiAidHJhbnNsYXRlKCIgKyAoKHlfdmFsICsgaSpjaHJfc3BhY2luZyArIChwbG9pZHkgLSAxKSooY2hfd2lkdGggKzEgKSktMikgKyAiLCAiKyhsZWZ0X21hcmdpbiArIGoqbG9jaV93aWR0aCsgKG5Mb2NpW2ldLnApKmxvY2lfd2lkdGggKzIqYXJjX3JhZGl1cykrIikgIiArICJyb3RhdGUoLTkwKSJ9KTsNCg0KDQoNCg0KDQoNCg0KICAgICAgICAgLyogICBmaW5hbCBjYXAgKi8NCg0KDQogICAgICAgICAgcG9zeD1sZWZ0X21hcmdpbisobkxvY2lbaV0ucCkqbG9jaV93aWR0aCArIDIqYXJjX3JhZGl1cyArIChuTG9jaVtpXS5xKSpsb2NpX3dpZHRoDQogICAgICAgICAgcG9zeT15X3ZhbCArIGkqY2hyX3NwYWNpbmcrICsgYXJjX3JhZGl1cyArIChwbG9pZHkgLSAxKSooY2hfd2lkdGggKzEgKQ0KICAgICAgICAgc3ZnLmFwcGVuZCgiZyIpDQogICAgICAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiK3Bvc3krIiwiK3Bvc3grIikiKQ0KICAgICAgICAuYXBwZW5kKCJwYXRoIikNCiAgICAgICAgLnN0eWxlKCJmaWxsIiwgY2hyX2NvbG9yKQ0KICAgICAgICAuYXR0cigiZCIsIGFyY0JvdCk7DQoNCmlmKGNoX3RleHQpew0KICAgICAgICBzdmcuYXBwZW5kKCJ0ZXh0IikNCiAgICAgICAgLmF0dHIoInkiLGxlZnRfbWFyZ2luKjAuNzUpDQogICAgICAgIC5hdHRyKCJ4Iix5X3ZhbCArIGkqY2hyX3NwYWNpbmcgKyAocGxvaWR5IC0gMSkqKGNoX3dpZHRoICsyICkpDQogICAgICAgIC5hdHRyKCJmb250LWZhbWlseSIsICJzYW5zLXNlcmlmIikNCiAgICAgICAgLmF0dHIoImZvbnQtc2l6ZSIsICI5cHgiKQ0KICAgICAgICAuYXR0cigiZmlsbCIsICJibGFjayIpDQogICAgICAgIC5zdHlsZSgidGV4dC1hbmNob3IiLCAibWlkZGxlIikNCiAgICAgICAgLnRleHQobkxvY2lbaV0ubmFtZSk7DQp9DQoNCg0KICAgICAgICB9IC8vZW5kIG9mIGZvcg0KDQp9IGVsc2Ugew0KDQogIHZhciBhbGxEYXRhID1bXTsNCg0KDQogICAgZm9yKGk9MDtpIDwgbkxvY2kubGVuZ3RoO2krKyl7DQoNCiAgICAgICAgIGFsbERhdGFbaV09ZDMucmFuZ2UobkxvY2lbaV0ubik7DQoNCg0KICAgIH0NCg0KICBmb3IoaT0wO2k8IG5Mb2NpLmxlbmd0aDtpKyspew0KDQogICAgLyogIGZpcnN0IGNhcCAqLw0KICAgIHBvc3g9bGVmdF9tYXJnaW47DQogICAgcG9zeT15X3ZhbCArIGkqY2hyX3NwYWNpbmcrICsgYXJjX3JhZGl1cyArIChwbG9pZHkgLSAxKSooY2hfd2lkdGggKzEgKQ0KICAgIHN2Zy5hcHBlbmQoImciKQ0KICAgICAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiK3Bvc3krIiwiK3Bvc3grIikiKQ0KICAgICAgICAgLmFwcGVuZCgicGF0aCIpDQogICAgICAgICAuc3R5bGUoImZpbGwiLCBjaHJfY29sb3IpDQogICAgICAgICAuYXR0cigiZCIsIGFyY1RvcCk7DQoNCiAgICAvKiAgcCBhcm0gKi8NCiAgICBzdmcuc2VsZWN0QWxsKCIucmVjdHMiKQ0KICAgICAgLmRhdGEoYWxsRGF0YVtpXSkNCiAgICAgIC5lbnRlcigpDQogICAgICAuYXBwZW5kKCJyZWN0IikNCiAgICAgIC5hdHRyKCJ4IiwgeV92YWwgKyBpKmNocl9zcGFjaW5nICsgKHBsb2lkeSAtIDEpKihjaF93aWR0aCArMSApKQ0KICAgICAgLmF0dHIoImhlaWdodCIsbG9jaV93aWR0aCApDQogICAgICAuYXR0cigieSIsIGZ1bmN0aW9uKGQsaSl7cmV0dXJuIGxlZnRfbWFyZ2luICsgaSpsb2NpX3dpZHRoO30pDQogICAgICAuYXR0cigid2lkdGgiLCBjaF93aWR0aCkNCiAgICAgIC5hdHRyKCJmaWxsIiwgY2hyX2NvbG9yKQ0KICAgICAgLmF0dHIoImNsYXNzIiwiY2hMb2MiKQ0KICAgICAgLmF0dHIoImlkIixmdW5jdGlvbihkLGope3JldHVybiBuTG9jaVtpXS5uYW1lKyItIisoaisxKSsiLSIrcGxvaWR5O30pOw0KDQoNCg0KICAgICAgLy9sYWJlbGxpbmdzDQogICAgICBzdmcuc2VsZWN0QWxsKCIudGV4dHMiKQ0KICAgICAgLmRhdGEoYWxsRGF0YVtpXSkNCiAgICAgIC5lbnRlcigpDQogICAgICAuYXBwZW5kKCJ0ZXh0IikNCiAgICAgIC5hdHRyKCJjbGFzcyIsImxhYmVscyIpDQogICAgICAuYXR0cigiaWQiLGZ1bmN0aW9uKGQsail7cmV0dXJuICJMIituTG9jaVtpXS5uYW1lKyItIisoaisxKSsiLSIrcGxvaWR5O30pLnRleHQoIiIpDQogICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAic2Fucy1zZXJpZiIpDQogICAgICAuYXR0cigiZm9udC1zaXplIiwgIjlweCIpDQogICAgICAuc3R5bGUoInRleHQtYW5jaG9yIiwgIm1pZGRsZSIpDQogICAgICAgIC5hdHRyKCJmaWxsIiwgImJsYWNrIikuYXR0cigidHJhbnNmb3JtIixmdW5jdGlvbihkLGopew0KICAgICAgICAgIHJldHVybiAidHJhbnNsYXRlKCIgKyAoKHlfdmFsICsgaSpjaHJfc3BhY2luZyArIChwbG9pZHkgLSAxKSooY2hfd2lkdGggKzEgKSktMikgKyAiLCAiKyhsZWZ0X21hcmdpbiArIGoqbG9jaV93aWR0aCkrIikgIiArICJyb3RhdGUoLTkwKSJ9KTsNCg0KDQoNCg0KDQoNCg0KDQoNCiAgICAgLyogICBmaW5hbCBjYXAgKi8NCg0KDQogICAgICBwb3N4PWxlZnRfbWFyZ2luKyhuTG9jaVtpXS5uKSpsb2NpX3dpZHRoDQogICAgICBwb3N5PXlfdmFsICsgaSpjaHJfc3BhY2luZysgKyBhcmNfcmFkaXVzICsgKHBsb2lkeSAtIDEpKihjaF93aWR0aCArMSApDQogICAgIHN2Zy5hcHBlbmQoImciKQ0KICAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiK3Bvc3krIiwiK3Bvc3grIikiKQ0KICAgIC5hcHBlbmQoInBhdGgiKQ0KICAgIC5zdHlsZSgiZmlsbCIsIGNocl9jb2xvcikNCiAgICAuYXR0cigiZCIsIGFyY0JvdCk7DQoNCmlmKGNoX3RleHQpew0KICAgIHN2Zy5hcHBlbmQoInRleHQiKQ0KICAgICAgICAuYXR0cigieSIsbGVmdF9tYXJnaW4qMC43NSkNCiAgICAgICAgLmF0dHIoIngiLHlfdmFsICsgaSpjaHJfc3BhY2luZyArYXJjX3JhZGl1cysgKHBsb2lkeSAtIDEpKihjaF93aWR0aCArMiApKQ0KICAgICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAic2Fucy1zZXJpZiIpDQogICAgICAgIC5hdHRyKCJmb250LXNpemUiLCAiOXB4IikNCiAgICAgICAgLmF0dHIoImZpbGwiLCAiYmxhY2siKQ0KICAgICAgICAuc3R5bGUoInRleHQtYW5jaG9yIiwgIm1pZGRsZSIpDQogICAgICAgIC50ZXh0KG5Mb2NpW2ldLm5hbWUpOw0KDQp9DQoNCg0KICAgIH0gLy9lbmQgb2YgZm9yDQoNCg0KfQ0KDQoNCg0KaWYoIWhlYXRtYXApew0KICAgICAgICAvL2RhdGEgcmVkdWN0aW9uIGZvciBhbm50YXRpb24NCnZhciBjaERhdGFSZWR1Y2VkID0gZDMubmVzdCgpDQoua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCi5yb2xsdXAoZnVuY3Rpb24odikgeyB2YXIgbGFiZWwgPScnOyB2YXIgdG90ID0gJzxmb250IGNvbG9yPSJncmV5Ij4gQ291bnQ6IDwvZm9udD4gJyt2Lmxlbmd0aCsiICA8L3A+PC9kaXY+PGhyPjxkaXYgIHN0eWxlPSdmbG9hdDp0b3A7aGVpZ2h0OjgwJTtvdmVyZmxvdy13cmFwOiBicmVhay13b3JkOycgPiA8Zm9udCBzaXplPScxJz4iO2Zvcih2YXIgaT0wOyBpPCB2Lmxlbmd0aDtpKyspeyBsYWJlbCA9IGxhYmVsICsiPGEgaHJlZj0iK3ZbaV0uaGxpbmsrIiBzdHlsZT0ndGV4dC1kZWNvcmF0aW9uOm5vbmU7Y3Vyc29yOnBvaW50ZXI7Y29sb3I6Z3JleTtwb2ludGVyLWV2ZW50czogYWxsOyc+IisgdltpXS5uYW1lKyI8L2E+IiArIiAsIjsgICAgfTsgcmV0dXJuIHRvdCtsYWJlbC5zbGljZSgwLC0xKTt9KQ0KLmVudHJpZXMoY2hEYXRhKTsNCg0KdmFyIGNoRGF0YVJlZHVjZWRDb3VudCA9IGQzLm5lc3QoKQ0KLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQoucm9sbHVwKGZ1bmN0aW9uKHYpIHsgIHJldHVybiB2Lmxlbmd0aDt9KQ0KLmVudHJpZXMoY2hEYXRhKTsNCg0KDQoNCnZhciBjaERhdGFSYW5nZSA9IGQzLm5lc3QoKQ0KLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQoucm9sbHVwKGZ1bmN0aW9uKHYpIHsgIHZhciBhLGI7Zm9yKHZhciBpPTA7IGk8IHYubGVuZ3RoO2krKyl7IGEgPSB2W2ldLmxvY2lfc3RhcnQ7IGI9dltpXS5sb2NpX2VuZDsgICAgfTtyZXR1cm4gIiIrYSsiLSIrYisiYnAgIjt9KQ0KLmVudHJpZXMoY2hEYXRhKTsNCg0KIC8qIGFkZGluZyB0aGUgY2hyb21vc29tZSB0b290bHRpcHMgICAgKi8NCmZvcih2YXIgaSA9IDA7aSA8IGNoRGF0YVJlZHVjZWQubGVuZ3RoO2krKykgew0KDQoNCiAgY2hEYXRhUmVkdWNlZFtpXS5yYW5nZSA9IGNoRGF0YVJhbmdlW2ldLnZhbHVlOw0KICBjaERhdGFSZWR1Y2VkW2ldLmxlbiA9IGNoRGF0YVJlZHVjZWRDb3VudFtpXS52YWx1ZTsNCn0NCg0KDQovL2RhdGEgcmVhZHkgZm9yIHJlbmRlcmluZw0KICAgICB2YXIgdGlwID1bXTsNCiAgICAgICAgdGlwW3Bsb2lkeS0xXSA9IGQzLnNlbGVjdCgiYm9keSIpLmFwcGVuZCgiZGl2IikNCiAuYXR0cigiY2xhc3MiLCAiY2h0b29sdGlwIikNCiAuc3R5bGUoIm9wYWNpdHkiLCAwKQ0KIC5hdHRyKCJzdHlsZSIsICJwb3NpdGlvbjogYWJzb2x1dGU7dGV4dC1hbGlnbjogY2VudGVyOwlib3gtc2l6aW5nOiBib3JkZXItYm94OyBwYWRkaW5nOiAzcHg7CWZvbnQ6IDEycHggc2Fucy1zZXJpZjsJCWJvcmRlcjogMHB4O2JvcmRlci1yYWRpdXM6IDhweDtwb2ludGVyLWV2ZW50czogbm9uZTsiKSA7DQoNCiB2YXIgdGlwMiA9IFtdOw0KICB0aXAyW3Bsb2lkeS0xXSA9IGQzLnNlbGVjdCgiYm9keSIpLmFwcGVuZCgiZGl2IikNCiAgICAgLmF0dHIoImNsYXNzIiwgImNodG9vbHRpcDIiKQ0KICAgICAuc3R5bGUoIm9wYWNpdHkiLCAwKQ0KICAgICAuYXR0cigic3R5bGUiLCAicG9zaXRpb246IGFic29sdXRlO3RleHQtYWxpZ246IGNlbnRlcjt3aWR0aDogMTgwcHg7aGVpZ2h0OiAxNDBweDsJIHBhZGRpbmc6IDJweDsJZm9udDogMTJweCBzYW5zLXNlcmlmOwlib3gtc2l6aW5nOiBib3JkZXItYm94Owlib3JkZXI6IDBweDtib3JkZXItcmFkaXVzOiA4cHg7cG9pbnRlci1ldmVudHM6IG5vbmU7IikgOw0KIHZhciBjbGlja0ZsYWc9ZmFsc2U7DQogZDMuc2VsZWN0QWxsKCIuY2hMb2MiKS5kYXRhKGNoRGF0YVJlZHVjZWQsIGZ1bmN0aW9uKGQpIHtyZXR1cm4gKGQgJiYgZC5rZXkpfHxkMy5zZWxlY3QodGhpcykuYXR0cigiaWQiKTt9KS5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oZCkge3RpcFtwbG9pZHktMV0udHJhbnNpdGlvbigpLmR1cmF0aW9uKDIwMCkJLnN0eWxlKCJvcGFjaXR5IiwgLjkpLnN0eWxlKCJiYWNrZ3JvdW5kLWNvbG9yIiwiI0Y1RjVGNSIpOwl0aXBbcGxvaWR5LTFdLnN0eWxlKCJoZWlnaHQiLDEwMCtkLmxlbioxLjUpLnN0eWxlKCJ3aWR0aCIsMTkwK2QubGVuKTsNCiB0aXBbcGxvaWR5LTFdLmh0bWwoIjxkaXYgIHN0eWxlPSdmbG9hdDp0b3A7aGVpZ2h0OjEwJTtjb2xvcjpibGFjaztmb250LXNpemU6MTJweDsnPjxwPiIrZC5yYW5nZSsiPC9wPjwvZGl2Pjxocj48ZGl2ICBzdHlsZT0nZmxvYXQ6dG9wO2hlaWdodDoxMCU7Jz48cCA+PGI+IitkLnZhbHVlKyI8L2ZvbnQ+PC9kaXY+Iikuc3R5bGUoImxlZnQiLCAoZDMuZXZlbnQucGFnZVgpICsgInB4IikJLnN0eWxlKCJ0b3AiLCAoZDMuZXZlbnQucGFnZVkgLSAxOCkgKyAicHgiKTt9KS5vbigibW91c2VvdXQiLCBmdW5jdGlvbihkKSB7CXRpcFtwbG9pZHktMV0udHJhbnNpdGlvbigpIC5kZWxheSgxMDAwKS5kdXJhdGlvbig1MDApCS5zdHlsZSgib3BhY2l0eSIsIDApO30pLmF0dHIoImZpbGwiLCBhbl9jb2wpDQogLm9uKCJjbGljayIsIGZ1bmN0aW9uKGQpIHsNCg0KDQogICBpZihjbGlja0ZsYWcpew0KICAgICAgICB0aXAyW3Bsb2lkeS0xXS5zdHlsZSgib3BhY2l0eSIsIDApOw0KICAgICB9ZWxzZXsNCiAgICAgICB0aXAyW3Bsb2lkeS0xXS50cmFuc2l0aW9uKCkuZHVyYXRpb24oMjAwKQkuc3R5bGUoIm9wYWNpdHkiLCAxKS5zdHlsZSgiYmFja2dyb3VuZC1jb2xvciIsIiNGNUY1RjUiKTsJdGlwMltwbG9pZHktMV0uc3R5bGUoImhlaWdodCIsMTAwK2QubGVuKjEuNSkuc3R5bGUoIndpZHRoIiwxOTArZC5sZW4pOw0KICAgICAgIHRpcDJbcGxvaWR5LTFdLmh0bWwoIjxkaXYgIHN0eWxlPSdmbG9hdDp0b3A7aGVpZ2h0OjEwJTtjb2xvcjpibGFjaztmb250LXNpemU6MTJweDsnPjxwPiIrZC5yYW5nZSsiPC9wPjwvZGl2Pjxocj48ZGl2ICBzdHlsZT0nZmxvYXQ6dG9wO2hlaWdodDoxMCU7Jz48cCA+PGI+IitkLnZhbHVlKyI8L2ZvbnQ+PC9kaXY+Iikuc3R5bGUoImxlZnQiLCAoZDMuZXZlbnQucGFnZVgpICsgInB4IikJLnN0eWxlKCJ0b3AiLCAoZDMuZXZlbnQucGFnZVkgLSAxOCkgKyAicHgiKTsNCiAgICAgICAgfSByZXR1cm4gY2xpY2tGbGFnID0gIWNsaWNrRmxhZzsgfSk7DQoNCiBpZihwbG9pZHk9PTEgJiYgbGFiZWxzKXsNCg0KICB2YXIgY2hEYXRhTGFiZWxzID0gZDMubmVzdCgpDQoua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCi5yb2xsdXAoZnVuY3Rpb24odikgeyAgdmFyIGE9W107Zm9yKHZhciBpPTA7IGk8IHYubGVuZ3RoO2krKyl7IGEucHVzaCh2W2ldLm5hbWUpOyAgIH07cmV0dXJuIGFbMF07fSkNCi5lbnRyaWVzKGNoRGF0YSk7DQp2YXIgY2hEYXRhTGFiZWwgPSBkMy5uZXN0KCkNCi5rZXkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sb2NpOyB9KQ0KLnJvbGx1cChmdW5jdGlvbih2KSB7ICB2YXIgYT1bXTtmb3IodmFyIGk9MDsgaTwgdi5sZW5ndGg7aSsrKXsgYS5wdXNoKHZbaV0ubGFiZWwpOyAgIH07cmV0dXJuIGFbMF07fSkNCi5lbnRyaWVzKGNoRGF0YSk7DQogZm9yKHZhciBpID0gMDtpIDwgY2hEYXRhUmVkdWNlZC5sZW5ndGg7aSsrKSB7DQoNCg0KDQogIGNoRGF0YVJlZHVjZWRbaV0ubGFiZWxzID1jaERhdGFMYWJlbHNbaV0udmFsdWU7DQogIGNoRGF0YVJlZHVjZWRbaV0ubGFiZWxfaWQgPWNoRGF0YUxhYmVsW2ldLnZhbHVlOw0KDQp9DQoNCg0KIGQzLnNlbGVjdEFsbCgiLmxhYmVscyIpLmRhdGEoY2hEYXRhUmVkdWNlZCwgZnVuY3Rpb24oZCkge3JldHVybiAoZCAmJiBkLmxhYmVsX2lkKXx8ZDMuc2VsZWN0KHRoaXMpLmF0dHIoImlkIik7fSkudGV4dChmdW5jdGlvbihkKXsgcmV0dXJuIGQubGFiZWxzO30pOw0KfQ0KDQoNCg0KDQogfSBlbHNlIHsNCg0KICAgLy9oZWF0bWFwIGNvZGUNCiAgIGlmKGhlYXRfc2NhbGU9PSJsaW5lYXIiKXsNCg0KDQoNCg0KICAgIGNvbG9yc1t0aW1lc10gPSBkMy5zY2FsZUxpbmVhcigpDQogICAgICAgIC5kb21haW4ocm5nKQ0KICAgICAgICAucmFuZ2UoaGVhdF9jb2wpOw0KDQoNCg0KICAgIC8vIENyZWF0ZSBzY2FsZQ0KLyoNCiAgdmFyICBzY2FsZTIgPSBkMy5zY2FsZUxpbmVhcigpDQogICAgLmRvbWFpbihybmcpLm5pY2UoKQ0KICAgIC5yYW5nZShbMiwgMTAwXSk7DQoNCiAgICAvLyBBZGQgc2NhbGVzIHRvIGF4aXMNCiAgdmFyICBsZWdlbmQyID0gZDMuYXhpc1JpZ2h0KCkNCiAgICAuc2NhbGUoc2NhbGUyKQ0KICAgIC50aWNrcygzKTsNCmlmKGxlZ2VuZCl7DQogICAgLy9BcHBlbmQgZ3JvdXAgYW5kIGluc2VydCBheGlzDQogICAgc3ZnLmFwcGVuZCgiZyIpLmF0dHIoImlkIixmdW5jdGlvbihkKXtyZXR1cm4gImxnbmQiK3RpbWVzO30pDQogICAgLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoIisoKHdpZHRoLTM1LSh0aW1lcyo1MCkpLWxnX3gpKyIsIiArICgoaGVpZ2h0LTEwMCktbGdfeSApKyAiKSIpDQogICAgLmNhbGwobGVnZW5kMik7DQp9ICAqLw0KDQogICAgY2hMaW5HcmFkVlt0aW1lc10gPSBzdmcuYXBwZW5kKCJkZWZzIikuYXBwZW5kKCJsaW5lYXJHcmFkaWVudCIpDQogICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoImlkIiwgZnVuY3Rpb24oZCl7IHJldHVybiAibGluZWFyLWdyYWRpZW50LWNocm9tSC0iK3RpbWVzO30pDQogICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoIngxIiwgIjAlIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigieTEiLCAiMCUiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ4MiIsICIwJSIpDQogICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoInkyIiwgIjEwMCUiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgIC5zZWxlY3RBbGwoInN0b3AiKQ0KICAgICAgICAuZGF0YSggY29sb3JzW3RpbWVzXS5yYW5nZSgpICkNCiAgICAgICAgLmVudGVyKCkuYXBwZW5kKCJzdG9wIikNCiAgICAgICAgLmF0dHIoIm9mZnNldCIsIGZ1bmN0aW9uKGQsaSkgeyByZXR1cm4gaS8oY29sb3JzW3RpbWVzXS5yYW5nZSgpLmxlbmd0aC0xKTsgfSkNCiAgICAgICAgLmF0dHIoInN0b3AtY29sb3IiLCBmdW5jdGlvbihkKSB7IHJldHVybiBkOyB9KTsNCg0KaWYobGVnZW5kKXsNCiAgICAgIHN2Zy5hcHBlbmQoJ3JlY3QnKQ0KICAgICAgLmF0dHIoImhlaWdodCIsMTAwKS5hdHRyKCJ3aWR0aCIsMTApLmF0dHIoInkiLCgoaGVpZ2h0LTk5KS1sZ195KSkuYXR0cigieCIsKCh3aWR0aC00NS0odGltZXMqNTApKS1sZ194KSkNCiAgICAgIC5zdHlsZSgiZmlsbCIsICJ1cmwoI2xpbmVhci1ncmFkaWVudC1jaHJvbUgtIit0aW1lcysiKSIpOw0KDQogICAgICAgdmFyIHJuZzI7DQogICAgICAgaWYocm5nLmxlbmd0aD09Myl7DQogICAgICAgICBybmcyPXJuZzsNCiAgICAgICB9ZWxzZSBpZiAocm5nLmxlbmd0aD09Mikgew0KICAgICAgICAgcm5nMj1bcm5nWzBdLGQzLm1lYW4ocm5nKSxybmdbMV1dDQogICAgICAgfQ0KDQogICAgICBzdmcuc2VsZWN0QWxsKCIudGV4dHMiKQ0KICAgICAgLmRhdGEoZDMucmFuZ2UoMykpDQogICAgICAuZW50ZXIoKQ0KICAgICAgLmFwcGVuZCgidGV4dCIpDQogICAgICAuYXR0cigiY2xhc3MiLCJsYWJlbHMiKQ0KICAgICAgLnRleHQoZnVuY3Rpb24oaSl7IHJldHVybiBybmcyW2ldLnRvRml4ZWQoMSk7fSkNCiAgICAgIC5hdHRyKCJmb250LWZhbWlseSIsICJzYW5zLXNlcmlmIikNCiAgICAgIC5hdHRyKCJmb250LXNpemUiLCAiOXB4IikNCiAgICAgICAgLmF0dHIoImZpbGwiLCAiYmxhY2siKS5hdHRyKCJ0cmFuc2Zvcm0iLGZ1bmN0aW9uKGQsail7DQogICAgICAgICAgcmV0dXJuICJ0cmFuc2xhdGUoIiArKCh3aWR0aC0zMi0odGltZXMqNTApKS1sZ194KSsiLCIgKyAoKGhlaWdodC05NCsoaio0OCkpLWxnX3kgICkrICIpIn0pOw0KfQ0KDQogICAgfSBlbHNleyBpZihoZWF0X3NjYWxlPT0ib3JkaW5hbCIpew0KDQoNCg0KICAgICAgY29sb3JzW3RpbWVzXSA9IGQzLnNjYWxlT3JkaW5hbCgpDQogICAgICAgICAgICAgIC5kb21haW4ocm5nKQ0KICAgICAgICAgICAgICAucmFuZ2UoaGVhdF9jb2wpOw0KDQoNCiAgICAgICAgdz1ybmcubGVuZ3RoKjIwOw0KICAgICAgICAvLyBDcmVhdGUgc2NhbGUNCg0KICAgICAgICB2YXIgc2NhbGUyID0gZDMuc2NhbGVCYW5kKCkNCiAgICAgICAgLmRvbWFpbihybmcpDQogICAgICAgIC5yYW5nZShbMix3XSk7DQoNCiAgICAgICAgLy8gQWRkIHNjYWxlcyB0byBheGlzDQogICAgICAgIHZhciBsZWdlbmQyID0gZDMuYXhpc1JpZ2h0KCkNCiAgICAgICAgLnNjYWxlKHNjYWxlMikudGlja1NpemVPdXRlcigwKTsNCg0KDQppZihsZWdlbmQpew0KICAgICAgICAvL0FwcGVuZCBncm91cCBhbmQgaW5zZXJ0IGF4aXMNCiAgICAgICAgc3ZnLmFwcGVuZCgiZyIpDQogICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKCIrKCh3aWR0aC0zNSktbGdfeCkrIiwiICsgKChoZWlnaHQtMTAwKS1sZ195ICkrICIpIikNCiAgICAgICAgLmNhbGwobGVnZW5kMik7DQoNCg0KDQogICAgICAgIHJlY19oPXcvcm5nLmxlbmd0aDsNCg0KICAgICAgICAgICAgc3ZnLnNlbGVjdEFsbCgiLnJlY3RzIikNCiAgICAgICAgICAgIC5kYXRhKGhlYXRfY29sKQ0KICAgICAgICAgICAgLmVudGVyKCkNCiAgICAgICAgICAgIC5hcHBlbmQoInJlY3QiKQ0KICAgICAgICAgICAgLmF0dHIoInkiLCBmdW5jdGlvbihkLGkpe3JldHVybiAoKChoZWlnaHQtOTkpLWxnX3kpK2kqcmVjX2gpO30pDQogICAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgcmVjX2gpDQogICAgICAgICAgICAuYXR0cigieCIsIGZ1bmN0aW9uKGQsaSl7cmV0dXJuICgod2lkdGgtNDUpLWxnX3gpO30pDQogICAgICAgICAgICAuYXR0cigid2lkdGgiLCAxMCkNCiAgICAgICAgICAgIC5hdHRyKCJmaWxsIiwgZnVuY3Rpb24oZCl7cmV0dXJuIGQ7fSk7DQoNCn0NCg0KDQoNCiAgICB9DQogICAgfQ0KDQoNCg0KDQoJLyogY3JlYXRpbmcgZmluYWwgZGF0YSAgICAqLw0KDQoNCg0KaWYoaGVhdF9zY2FsZT09ImxpbmVhciIpew0KIHZhciB0YWc7DQogIGlmKGFnZ3JlZ2F0ZV9mdW5jPT0iYXZnIil7DQogICBjaERhdGFSZWR1Y2VkID0gZDMubmVzdCgpDQogICAua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCiAgIC5yb2xsdXAoZnVuY3Rpb24odikgeyByZXR1cm4gZDMubWVhbih2LCBmdW5jdGlvbihkKSB7IHJldHVybiBkLmRhdGE7IH0pO30pDQogICAuZW50cmllcyhjaERhdGEpOw0KICAgdGFnPSJhdmciOw0KIH0gZWxzZSBpZihhZ2dyZWdhdGVfZnVuYz09InN1bSIpew0KDQogICBjaERhdGFSZWR1Y2VkID0gZDMubmVzdCgpDQogICAua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCiAgIC5yb2xsdXAoZnVuY3Rpb24odikgeyByZXR1cm4gZDMuc3VtKHYsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuZGF0YTsgfSk7fSkNCiAgIC5lbnRyaWVzKGNoRGF0YSk7DQogdGFnPSJzdW0iOw0KDQogfQ0KDQoJdmFyIGNoRGF0YVJlZHVjZWRNaW4gPSBkMy5uZXN0KCkNCiAgLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQogIC5yb2xsdXAoZnVuY3Rpb24odikgeyByZXR1cm4gZDMubWluKHYsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuZGF0YTsgfSk7fSkNCiAgLmVudHJpZXMoY2hEYXRhKTsNCiAgdmFyIGNoRGF0YVJlZHVjZWRNYXggPSBkMy5uZXN0KCkNCiAgLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQogIC5yb2xsdXAoZnVuY3Rpb24odikgeyByZXR1cm4gZDMubWF4KHYsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuZGF0YTsgfSk7fSkNCiAgLmVudHJpZXMoY2hEYXRhKTsNCiAgdmFyIGNoRGF0YVJlZHVjZWRCYXJEYXRhID0gZDMubmVzdCgpDQogIC5rZXkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sb2NpOyB9KQ0KICAucm9sbHVwKGZ1bmN0aW9uKHYpIHsgdj12LnNvcnQoZnVuY3Rpb24oYSxiKXtyZXR1cm4gTWF0aC5hYnMoYVsnY2hfc3RhcnQnXSkgLSBNYXRoLmFicyhiWydjaF9zdGFydCddKX0pO2Jhcj1bXTsgZm9yKHZhciBnPTA7Zzx2Lmxlbmd0aDtnKyspe2Jhci5wdXNoKHZbZ10uZGF0YSk7fTtyZXR1cm4gYmFyO30pDQogIC5lbnRyaWVzKGNoRGF0YSk7DQogIHZhciBjaERhdGFSZWR1Y2VkQmFyTGFiZWwgPSBkMy5uZXN0KCkNCiAgLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQogIC5yb2xsdXAoZnVuY3Rpb24odikgeyB2PXYuc29ydChmdW5jdGlvbihhLGIpe3JldHVybiBNYXRoLmFicyhhWydjaF9zdGFydCddKSAtIE1hdGguYWJzKGJbJ2NoX3N0YXJ0J10pfSk7YmFyPVtdOyBmb3IodmFyIGc9MDtnPHYubGVuZ3RoO2crKyl7YmFyLnB1c2godltnXS5uYW1lKTt9O3JldHVybiBiYXI7fSkNCiAgLmVudHJpZXMoY2hEYXRhKTsNCiAgdmFyIGNoRGF0YVJlZHVjZWRDb3VudCA9IGQzLm5lc3QoKQ0KICAua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCiAgLnJvbGx1cChmdW5jdGlvbih2KSB7IHJldHVybiB2Lmxlbmd0aDt9KQ0KICAuZW50cmllcyhjaERhdGEpOw0KDQogIHZhciBjaERhdGFSZWR1Y2VkQmFyTGluayA9IGQzLm5lc3QoKQ0KICAua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCiAgLnJvbGx1cChmdW5jdGlvbih2KSB7IHY9di5zb3J0KGZ1bmN0aW9uKGEsYil7cmV0dXJuIE1hdGguYWJzKGFbJ2NoX3N0YXJ0J10pIC0gTWF0aC5hYnMoYlsnY2hfc3RhcnQnXSl9KTtiYXI9W107IGZvcih2YXIgZz0wO2c8di5sZW5ndGg7ZysrKXtiYXIucHVzaCh2W2ddLmhsaW5rKTt9O3JldHVybiBiYXI7fSkNCiAgLmVudHJpZXMoY2hEYXRhKTsNCgl2YXIgY2hEYXRhUmFuZ2UgPSBkMy5uZXN0KCkNCi5rZXkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sb2NpOyB9KQ0KLnJvbGx1cChmdW5jdGlvbih2KSB7ICB2YXIgYSxiO2Zvcih2YXIgaT0wOyBpPCB2Lmxlbmd0aDtpKyspeyBhID0gdltpXS5sb2NpX3N0YXJ0OyBiPXZbaV0ubG9jaV9lbmQ7ICAgIH07cmV0dXJuICIiK2ErIi0iK2IrImJwICI7fSkNCi5lbnRyaWVzKGNoRGF0YSk7DQogIGZvcih2YXIgaSA9IDA7aSA8IGNoRGF0YVJlZHVjZWQubGVuZ3RoO2krKykgew0KDQoNCgljaERhdGFSZWR1Y2VkW2ldLnJhbmdlID0gY2hEYXRhUmFuZ2VbaV0udmFsdWU7DQoJY2hEYXRhUmVkdWNlZFtpXS5taW4gPSBjaERhdGFSZWR1Y2VkTWluW2ldLnZhbHVlOw0KCWNoRGF0YVJlZHVjZWRbaV0ubWF4ID0gY2hEYXRhUmVkdWNlZE1heFtpXS52YWx1ZTsNCgljaERhdGFSZWR1Y2VkW2ldLmJhciA9IGNoRGF0YVJlZHVjZWRCYXJEYXRhW2ldLnZhbHVlOw0KCWNoRGF0YVJlZHVjZWRbaV0ubGFiZWwgPSBjaERhdGFSZWR1Y2VkQmFyTGFiZWxbaV0udmFsdWU7DQoJY2hEYXRhUmVkdWNlZFtpXS5jb3VudCA9IGNoRGF0YVJlZHVjZWRDb3VudFtpXS52YWx1ZTsNCiAgY2hEYXRhUmVkdWNlZFtpXS5obGluayA9IGNoRGF0YVJlZHVjZWRCYXJMaW5rW2ldLnZhbHVlOw0KfQ0KDQp2YXIgdGlwID0gW107DQogdGlwW3Bsb2lkeS0xXSA9IGQzLnNlbGVjdCgiYm9keSIpLmFwcGVuZCgiZGl2IikNCiAgICAuYXR0cigiY2xhc3MiLCAiY2h0b29sdGlwIikNCiAgICAuc3R5bGUoIm9wYWNpdHkiLCAwKQ0KICAgIC5hdHRyKCJzdHlsZSIsICJwb3NpdGlvbjogYWJzb2x1dGU7dGV4dC1hbGlnbjogY2VudGVyO3dpZHRoOiAxODBweDtoZWlnaHQ6IDE0MHB4OwkgcGFkZGluZzogMnB4Owlmb250OiAxMnB4IHNhbnMtc2VyaWY7CWJveC1zaXppbmc6IGJvcmRlci1ib3g7CWJvcmRlcjogMHB4O2JvcmRlci1yYWRpdXM6IDhweDtwb2ludGVyLWV2ZW50czogbm9uZTsiKSA7DQoNCiAgICB2YXIgdGlwMiA9IFtdOw0KICAgICB0aXAyW3Bsb2lkeS0xXSA9IGQzLnNlbGVjdCgiYm9keSIpLmFwcGVuZCgiZGl2IikNCiAgICAgICAgLmF0dHIoImNsYXNzIiwgImNodG9vbHRpcDIiKQ0KICAgICAgICAuc3R5bGUoIm9wYWNpdHkiLCAwKQ0KICAgICAgICAuYXR0cigic3R5bGUiLCAicG9zaXRpb246IGFic29sdXRlO3RleHQtYWxpZ246IGNlbnRlcjt3aWR0aDogMTgwcHg7aGVpZ2h0OiAxNDBweDsJIHBhZGRpbmc6IDJweDsJZm9udDogMTJweCBzYW5zLXNlcmlmOwlib3gtc2l6aW5nOiBib3JkZXItYm94Owlib3JkZXI6IDBweDtib3JkZXItcmFkaXVzOiA4cHg7cG9pbnRlci1ldmVudHM6IG5vbmU7IikgOw0KDQoNCnZhciBjbGlja0ZsYWcgPSBmYWxzZTsNCg0KDQogICAgZDMuc2VsZWN0QWxsKCIuY2hMb2MiKS5kYXRhKGNoRGF0YVJlZHVjZWQsIGZ1bmN0aW9uKGQpIHtyZXR1cm4gKGQgJiYgZC5rZXkpfHxkMy5zZWxlY3QodGhpcykuYXR0cigiaWQiKTt9KS5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oZCkge3RpcFtwbG9pZHktMV0udHJhbnNpdGlvbigpLmR1cmF0aW9uKDIwMCkJLnN0eWxlKCJvcGFjaXR5IiwgLjkpLnN0eWxlKCJiYWNrZ3JvdW5kLWNvbG9yIiwiI0Y1RjVGNSIpLnN0eWxlKCJ3aWR0aCIsMTgwK2QuY291bnQqKGQzLm1heChkLmxhYmVsKS5sZW5ndGgqMykrJ3B4Jyk7DQogICAgICB0aXBbcGxvaWR5LTFdLmh0bWwoIjxkaXYgIHN0eWxlPSdmbG9hdDp0b3A7cG9zaXRpb246cmVsYXRpdmU7aGVpZ2h0OjM1JTsnID48ZGl2IHN0eWxlPSdib3JkZXItcmFkaXVzOiA1cHg7ZmxvYXQ6bGVmdDtwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6NTVweDt3aWR0aDozMCU7YmFja2dyb3VuZC1jb2xvcjoiK2NvbG9yc1t0aW1lc10oZC52YWx1ZSkrDQogICAgICAiOycgPjwvZGl2PjxkaXYgIHN0eWxlPSdmbG9hdDpsZWZ0O3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjcwJTsnID48cCA+PGZvbnQgc2l6ZT0nMScgY29sb3I9J2dyZXknID4gIit0YWcrIjogPC9mb250PiA8Zm9udCBzaXplPScxJyAgPjxiPiAiKyhkLnZhbHVlKS50b0ZpeGVkKDIpKw0KICAgICAgIiA8YnI+PGZvbnQgc2l6ZT0nMScgY29sb3I9J2dyZXknID4gTWluLjogPC9mb250PiIrKGQubWluKS50b0ZpeGVkKDIpKyIgPGJyPjxmb250IHNpemU9JzEnIGNvbG9yPSdncmV5JyA+IE1heC46IDwvZm9udD4gIisoZC5tYXgpLnRvRml4ZWQoMikrDQogICAgICAiPC9mb250Pjxicj48Zm9udCBzaXplPScxJyBjb2xvcj0nZ3JleScgPiBDb3VudDogPC9mb250Pjxmb250IHNpemU9JzEnPiIrZC5jb3VudCsiPC9wPjwvZm9udD48L2Rpdj48L2Rpdj48ZGl2IGlkID0nbWljcm9CYXIiK3Bsb2lkeSsiJyBzdHlsZT0nZmxvYXQ6dG9wO3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDozNSUnPjwvZGl2Pjxicj48ZGl2ICBzdHlsZT0nZmxvYXQ6dG9wO2hlaWdodDoyMCU7cG9zaXRpb246cmVsYXRpdmU7Y29sb3I6J2JsYWNrIisNCiAgICAgICI7Jz48Zm9udCBzaXplPScyJyA+IitkLnJhbmdlKyI8L2ZvbnQ+PC9wPjwvZGl2PiIpDQogICAgICAuc3R5bGUoImxlZnQiLCAoZDMuZXZlbnQucGFnZVgpICsgInB4IikNCiAgICAgIC5zdHlsZSgidG9wIiwgKGQzLmV2ZW50LnBhZ2VZIC0gMTgpICsgInB4Iik7IHZhciBzdmdXaWR0aCA9IDE3NStkLmNvdW50KihkMy5tYXgoZC5sYWJlbCkubGVuZ3RoKSozO3ZhciBzdmdIZWlnaHQgPSA1MDt2YXIgYmFyUGFkZGluZyA9IDU7dmFyIGJhcldpZHRoID0gKHN2Z1dpZHRoIC8gZC5iYXIubGVuZ3RoKTt2YXIgbXlzdmcgPSBkMy5zZWxlY3QoJyNtaWNyb0JhcicrcGxvaWR5KS5hcHBlbmQoInN2ZyIpLmF0dHIoIndpZHRoIixzdmdXaWR0aCkuYXR0cigiaGVpZ3RoIixzdmdIZWlnaHQpO3ZhciBiYXJDaGFydCA9IG15c3ZnLnNlbGVjdEFsbCgncmVjdCcpLmRhdGEoZC5iYXIpLmVudGVyKCkuYXBwZW5kKCdyZWN0JykuYXR0cignaGVpZ2h0JyxzdmdIZWlnaHQtNDApLmF0dHIoJ3dpZHRoJywgYmFyV2lkdGgpLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uIChkLCBpKSB7IHZhciB0cmFuc2xhdGUgPSBbYmFyV2lkdGggKiBpLCAwXTsgIHJldHVybiAndHJhbnNsYXRlKCcrIHRyYW5zbGF0ZSArJyknO30pLnN0eWxlKCJmaWxsIixmdW5jdGlvbihkKXtyZXR1cm4gY29sb3JzW3RpbWVzXShkKTt9KTsNCiAgICAgIHRfZGF0YT1bXTsNCiAgICAgIGZvcihqPTA7ajxkLmxhYmVsLmxlbmd0aDtqKyspew0KICAgICAgICB0X2RhdGEucHVzaCh7bGI6ZC5sYWJlbFtqXSxobDpkLmhsaW5rW2pdfSk7IH0NCiAgICAgIHZhciB0dGV4dD1teXN2Zy5zZWxlY3RBbGwoIi5ub2RlIikuZGF0YSh0X2RhdGEpLmVudGVyKCkuYXBwZW5kKCJzdmc6YSIpLmF0dHIoInhsaW5rOmhyZWYiLCBmdW5jdGlvbihkLGkpeyByZXR1cm4gZC5obDt9KS5hcHBlbmQoInN2Zzp0ZXh0IikuYXR0cigieSIsc3ZnSGVpZ2h0KjAuNCkuYXR0cigidHJhbnNmb3JtIiwicm90YXRlKDkwKSIpLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uIChkLCBpKSB7IHZhciB0cmFuc2xhdGUgPSBbYmFyV2lkdGggKiBpLCAwXTsgIHJldHVybiAndHJhbnNsYXRlKCcrIHRyYW5zbGF0ZSArJyknO30pLnN0eWxlKCJwb2ludGVyLWV2ZW50cyIsICJhbGwiKS5zdHlsZSgiY3Vyc29yIiwicG9pbnRlciIpLmF0dHIoImZvbnQtc2l6ZSIsICI5cHgiKS50ZXh0KGZ1bmN0aW9uKGQsaSl7cmV0dXJuIGQubGI7fSk7IH0pDQogICAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oZCkgewl0aXBbcGxvaWR5LTFdLnRyYW5zaXRpb24oKSAuZGVsYXkoMTAwMCkuZHVyYXRpb24oNTAwKQkuc3R5bGUoIm9wYWNpdHkiLCAwKTt9KS5zdHlsZSgidmlzaWJpbGl0eSIsInZpc2libGUiKS5zdHlsZSgiZmlsbCIsZnVuY3Rpb24oZCl7IHJldHVybiBjb2xvcnNbdGltZXNdKGQudmFsdWUpO30pDQogICAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oZCkgew0KDQoNCiAgICAgICAgaWYoY2xpY2tGbGFnKXsNCiAgICAgICAgICAgICB0aXAyW3Bsb2lkeS0xXS5zdHlsZSgib3BhY2l0eSIsIDApOw0KICAgICAgICAgIH1lbHNlew0KICAgICAgICB0aXAyW3Bsb2lkeS0xXS5zdHlsZSgiei1pbmRleCIsOTk5OTk5OTkpCS5zdHlsZSgib3BhY2l0eSIsIDEpLnN0eWxlKCJiYWNrZ3JvdW5kLWNvbG9yIiwiI0Y1RjVGNSIpLnN0eWxlKCJ3aWR0aCIsMTgwK2QuY291bnQqKGQzLm1heChkLmxhYmVsKS5sZW5ndGgqMykrJ3B4Jyk7DQogICAgICAgIHRpcDJbcGxvaWR5LTFdLmh0bWwoIjxkaXYgIHN0eWxlPSdmbG9hdDp0b3A7cG9zaXRpb246cmVsYXRpdmU7aGVpZ2h0OjM1JTsnID48ZGl2IHN0eWxlPSdib3JkZXItcmFkaXVzOiA1cHg7ZmxvYXQ6bGVmdDtwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6NTVweDt3aWR0aDozMCU7YmFja2dyb3VuZC1jb2xvcjoiK2NvbG9yc1t0aW1lc10oZC52YWx1ZSkrDQogICAgICAgICI7JyA+PC9kaXY+PGRpdiAgc3R5bGU9J2Zsb2F0OmxlZnQ7cG9zaXRpb246cmVsYXRpdmU7d2lkdGg6NzAlOycgPjxwID48Zm9udCBzaXplPScxJyBjb2xvcj0nZ3JleScgPiAiK3RhZysiOiA8L2ZvbnQ+IDxmb250IHNpemU9JzEnICA+PGI+ICIrKGQudmFsdWUpLnRvRml4ZWQoMikrDQogICAgICAgICIgPGJyPjxmb250IHNpemU9JzEnIGNvbG9yPSdncmV5JyA+IE1pbi46IDwvZm9udD4iKyhkLm1pbikudG9GaXhlZCgyKSsiIDxicj48Zm9udCBzaXplPScxJyBjb2xvcj0nZ3JleScgPiBNYXguOiA8L2ZvbnQ+ICIrKGQubWF4KS50b0ZpeGVkKDIpKw0KICAgICAgICAiPC9mb250Pjxicj48Zm9udCBzaXplPScxJyBjb2xvcj0nZ3JleScgPiBDb3VudDogPC9mb250Pjxmb250IHNpemU9JzEnPiIrZC5jb3VudCsiPC9wPjwvZm9udD48L2Rpdj48L2Rpdj48ZGl2IGlkID0nbWljcm9CYXIyIitwbG9pZHkrIicgc3R5bGU9J2Zsb2F0OnRvcDtwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6MzUlJz48L2Rpdj48YnI+PGRpdiAgc3R5bGU9J2Zsb2F0OnRvcDtoZWlnaHQ6MjAlO3Bvc2l0aW9uOnJlbGF0aXZlO2NvbG9yOidibGFjayIrDQogICAgICAgICI7Jz48Zm9udCBzaXplPScyJyA+IitkLnJhbmdlKyI8L2ZvbnQ+PC9wPjwvZGl2PiIpDQogICAgICAgIC5zdHlsZSgibGVmdCIsIChkMy5ldmVudC5wYWdlWCkgKyAicHgiKQ0KICAgICAgICAuc3R5bGUoInRvcCIsIChkMy5ldmVudC5wYWdlWSAtIDE4KSArICJweCIpOyB2YXIgc3ZnV2lkdGggPSAxNzUrZC5jb3VudCooZDMubWF4KGQubGFiZWwpLmxlbmd0aCkqMzt2YXIgc3ZnSGVpZ2h0ID0gNTA7dmFyIGJhclBhZGRpbmcgPSA1O3ZhciBiYXJXaWR0aCA9IChzdmdXaWR0aCAvIGQuYmFyLmxlbmd0aCk7dmFyIG15c3ZnMiA9IGQzLnNlbGVjdCgnI21pY3JvQmFyMicrcGxvaWR5KS5hcHBlbmQoInN2ZyIpLmF0dHIoIndpZHRoIixzdmdXaWR0aCkuYXR0cigiaGVpZ3RoIixzdmdIZWlnaHQpO3ZhciBiYXJDaGFydCA9IG15c3ZnMi5zZWxlY3RBbGwoJ3JlY3QnKS5kYXRhKGQuYmFyKS5lbnRlcigpLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2hlaWdodCcsc3ZnSGVpZ2h0LTQwKS5hdHRyKCd3aWR0aCcsIGJhcldpZHRoKS5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAoZCwgaSkgeyB2YXIgdHJhbnNsYXRlID0gW2JhcldpZHRoICogaSwgMF07ICByZXR1cm4gJ3RyYW5zbGF0ZSgnKyB0cmFuc2xhdGUgKycpJzt9KS5zdHlsZSgiZmlsbCIsZnVuY3Rpb24oZCl7cmV0dXJuIGNvbG9yc1t0aW1lc10oZCk7fSk7DQogICAgICAgIHRfZGF0YT1bXTsNCiAgICAgICAgZm9yKGo9MDtqPGQubGFiZWwubGVuZ3RoO2orKyl7DQogICAgICAgICAgdF9kYXRhLnB1c2goe2xiOmQubGFiZWxbal0saGw6ZC5obGlua1tqXX0pOyB9DQogICAgICAgIHZhciB0dGV4dD1teXN2ZzIuc2VsZWN0QWxsKCIubm9kZSIpLmRhdGEodF9kYXRhKS5lbnRlcigpLmFwcGVuZCgic3ZnOmEiKS5hdHRyKCJ4bGluazpocmVmIiwgZnVuY3Rpb24oZCxpKXsgcmV0dXJuIGQuaGw7fSkuYXBwZW5kKCJzdmc6dGV4dCIpLmF0dHIoInkiLHN2Z0hlaWdodCowLjQpLmF0dHIoInRyYW5zZm9ybSIsInJvdGF0ZSg5MCkiKS5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAoZCwgaSkgeyB2YXIgdHJhbnNsYXRlID0gW2JhcldpZHRoICogaSwgMF07ICByZXR1cm4gJ3RyYW5zbGF0ZSgnKyB0cmFuc2xhdGUgKycpJzt9KS5zdHlsZSgicG9pbnRlci1ldmVudHMiLCAiYWxsIikuc3R5bGUoImN1cnNvciIsInBvaW50ZXIiKS5hdHRyKCJmb250LXNpemUiLCAiOXB4IikudGV4dChmdW5jdGlvbihkLGkpe3JldHVybiBkLmxiO30pOw0KICAgICAgfSByZXR1cm4gY2xpY2tGbGFnID0gIWNsaWNrRmxhZzsgfSk7DQoNCiAgICAgICAgaWYocGxvaWR5PT0xICYmIGxhYmVscyl7DQoNCiAgICAgICAgdmFyIGNoRGF0YUxhYmVscyA9IGQzLm5lc3QoKQ0KICAgIC5rZXkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sb2NpOyB9KQ0KICAgIC5yb2xsdXAoZnVuY3Rpb24odikgeyAgdmFyIGE9W107Zm9yKHZhciBpPTA7IGk8IHYubGVuZ3RoO2krKyl7IGEucHVzaCh2W2ldLm5hbWUpOyAgIH07cmV0dXJuIGFbMF07fSkNCiAgICAuZW50cmllcyhjaERhdGEpOw0KDQogICAgdmFyIGNoRGF0YUxhYmVsID0gZDMubmVzdCgpDQoua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCi5yb2xsdXAoZnVuY3Rpb24odikgeyAgdmFyIGE9W107Zm9yKHZhciBpPTA7IGk8IHYubGVuZ3RoO2krKyl7IGEucHVzaCh2W2ldLmxhYmVsKTsgICB9O3JldHVybiBhWzBdO30pDQouZW50cmllcyhjaERhdGEpOw0KICAgICAgIGZvcih2YXIgaSA9IDA7aSA8IGNoRGF0YVJlZHVjZWQubGVuZ3RoO2krKykgew0KDQoNCiAgICAgICAgY2hEYXRhUmVkdWNlZFtpXS5sYWJlbF9pZD1jaERhdGFMYWJlbFtpXS52YWx1ZTsNCiAgICAgICAgY2hEYXRhUmVkdWNlZFtpXS5sYWJlbHMgPWNoRGF0YUxhYmVsc1tpXS52YWx1ZTsNCg0KICAgICAgfQ0KDQoNCiAgICAgICBkMy5zZWxlY3RBbGwoIi5sYWJlbHMiKS5kYXRhKGNoRGF0YVJlZHVjZWQsIGZ1bmN0aW9uKGQpIHtyZXR1cm4gKGQgJiYgZC5sYWJlbF9pZCl8fGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJpZCIpO30pLnRleHQoZnVuY3Rpb24oZCl7IHJldHVybiBkLmxhYmVsczt9KTsNCiAgICAgfQ0KDQoNCg0KDQoNCg0KfSBlbHNlIHsNCiAgaWYoaGVhdF9zY2FsZT09Im9yZGluYWwiKXsNCiAgdmFyIGNoRGF0YVJlZHVjZWQgPSBkMy5uZXN0KCkNCiAgLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQogIC5yb2xsdXAoZnVuY3Rpb24odikgeyAgdmFyIGE9W107Zm9yKHZhciBpPTA7IGk8IHYubGVuZ3RoO2krKyl7IGEucHVzaCh2W2ldLmRhdGEpOyAgIH07cmV0dXJuIGFbMF07fSkNCiAgLmVudHJpZXMoY2hEYXRhKTsNCg0KDQogIHZhciBjaERhdGFSZWR1Y2VkQmFyRGF0YSA9IGQzLm5lc3QoKQ0KICAua2V5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQubG9jaTsgfSkNCiAgLnJvbGx1cChmdW5jdGlvbih2KSB7IHY9di5zb3J0KGZ1bmN0aW9uKGEsYil7cmV0dXJuIE1hdGguYWJzKGFbJ2NoX3N0YXJ0J10pIC0gTWF0aC5hYnMoYlsnY2hfc3RhcnQnXSl9KTtiYXI9W107IGZvcih2YXIgZz0wO2c8di5sZW5ndGg7ZysrKXtiYXIucHVzaCh2W2ddLmRhdGEpO307cmV0dXJuIGJhcjt9KQ0KICAuZW50cmllcyhjaERhdGEpOw0KICB2YXIgY2hEYXRhUmVkdWNlZEJhckxhYmVsID0gZDMubmVzdCgpDQogIC5rZXkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sb2NpOyB9KQ0KICAucm9sbHVwKGZ1bmN0aW9uKHYpIHsgdj12LnNvcnQoZnVuY3Rpb24oYSxiKXtyZXR1cm4gTWF0aC5hYnMoYVsnY2hfc3RhcnQnXSkgLSBNYXRoLmFicyhiWydjaF9zdGFydCddKX0pO2Jhcj1bXTsgZm9yKHZhciBnPTA7Zzx2Lmxlbmd0aDtnKyspe2Jhci5wdXNoKHZbZ10ubmFtZSk7fTtyZXR1cm4gYmFyO30pDQogIC5lbnRyaWVzKGNoRGF0YSk7DQogIHZhciBjaERhdGFSZWR1Y2VkQ291bnQgPSBkMy5uZXN0KCkNCiAgLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQogIC5yb2xsdXAoZnVuY3Rpb24odikgeyByZXR1cm4gdi5sZW5ndGg7fSkNCiAgLmVudHJpZXMoY2hEYXRhKTsNCiAgdmFyIGNoRGF0YVJlZHVjZWRCYXJMaW5rID0gZDMubmVzdCgpDQogIC5rZXkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sb2NpOyB9KQ0KICAucm9sbHVwKGZ1bmN0aW9uKHYpIHsgdj12LnNvcnQoZnVuY3Rpb24oYSxiKXtyZXR1cm4gTWF0aC5hYnMoYVsnY2hfc3RhcnQnXSkgLSBNYXRoLmFicyhiWydjaF9zdGFydCddKX0pO2Jhcj1bXTsgZm9yKHZhciBnPTA7Zzx2Lmxlbmd0aDtnKyspe2Jhci5wdXNoKHZbZ10uaGxpbmspO307cmV0dXJuIGJhcjt9KQ0KICAuZW50cmllcyhjaERhdGEpOw0KCXZhciBjaERhdGFSYW5nZSA9IGQzLm5lc3QoKQ0KLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQoucm9sbHVwKGZ1bmN0aW9uKHYpIHsgIHZhciBhLGI7Zm9yKHZhciBpPTA7IGk8IHYubGVuZ3RoO2krKyl7IGEgPSB2W2ldLmxvY2lfc3RhcnQ7IGI9dltpXS5sb2NpX2VuZDsgICAgfTtyZXR1cm4gIiIrYSsiLSIrYisiYnAgIjt9KQ0KLmVudHJpZXMoY2hEYXRhKTsNCg0KICBmb3IodmFyIGkgPSAwO2kgPCBjaERhdGFSZWR1Y2VkLmxlbmd0aDtpKyspIHsNCg0KDQogICAgY2hEYXRhUmVkdWNlZFtpXS5yYW5nZSA9IGNoRGF0YVJhbmdlW2ldLnZhbHVlOw0KDQogICAgY2hEYXRhUmVkdWNlZFtpXS5iYXIgPSBjaERhdGFSZWR1Y2VkQmFyRGF0YVtpXS52YWx1ZTsNCiAgICBjaERhdGFSZWR1Y2VkW2ldLmxhYmVsID0gY2hEYXRhUmVkdWNlZEJhckxhYmVsW2ldLnZhbHVlOw0KICAgIGNoRGF0YVJlZHVjZWRbaV0uY291bnQgPSBjaERhdGFSZWR1Y2VkQ291bnRbaV0udmFsdWU7DQogICAgY2hEYXRhUmVkdWNlZFtpXS5obGluayA9IGNoRGF0YVJlZHVjZWRCYXJMaW5rW2ldLnZhbHVlOw0KICB9DQoNCiAgdmFyIHRpcCA9IFtdOw0KICB0aXBbcGxvaWR5LTFdID0gZDMuc2VsZWN0KCJib2R5IikuYXBwZW5kKCJkaXYiKQ0KICAgICAuYXR0cigiY2xhc3MiLCAiY2h0b29sdGlwIikNCiAgICAgLnN0eWxlKCJvcGFjaXR5IiwgMCkNCiAgICAgLmF0dHIoInN0eWxlIiwgInBvc2l0aW9uOiBhYnNvbHV0ZTt0ZXh0LWFsaWduOiBjZW50ZXI7d2lkdGg6IDE4MHB4O2hlaWdodDogMTQwcHg7CSBwYWRkaW5nOiAycHg7CWZvbnQ6IDEycHggc2Fucy1zZXJpZjsJYm94LXNpemluZzogYm9yZGVyLWJveDsJYm9yZGVyOiAwcHg7Ym9yZGVyLXJhZGl1czogOHB4O3BvaW50ZXItZXZlbnRzOiBub25lOyIpIDsNCg0KICAgICB2YXIgdGlwMiA9IFtdOw0KICAgICAgdGlwMltwbG9pZHktMV0gPSBkMy5zZWxlY3QoImJvZHkiKS5hcHBlbmQoImRpdiIpDQogICAgICAgICAuYXR0cigiY2xhc3MiLCAiY2h0b29sdGlwMiIpDQogICAgICAgICAuc3R5bGUoIm9wYWNpdHkiLCAwKQ0KICAgICAgICAgLmF0dHIoInN0eWxlIiwgInBvc2l0aW9uOiBhYnNvbHV0ZTt0ZXh0LWFsaWduOiBjZW50ZXI7d2lkdGg6IDE4MHB4O2hlaWdodDogMTQwcHg7CSBwYWRkaW5nOiAycHg7CWZvbnQ6IDEycHggc2Fucy1zZXJpZjsJYm94LXNpemluZzogYm9yZGVyLWJveDsJYm9yZGVyOiAwcHg7Ym9yZGVyLXJhZGl1czogOHB4O3BvaW50ZXItZXZlbnRzOiBub25lOyIpIDsNCiAgICAgdmFyIGNsaWNrRmxhZz1mYWxzZTsNCiAgICAgZDMuc2VsZWN0QWxsKCIuY2hMb2MiKS5kYXRhKGNoRGF0YVJlZHVjZWQsIGZ1bmN0aW9uKGQpIHtyZXR1cm4gKGQgJiYgZC5rZXkpfHxkMy5zZWxlY3QodGhpcykuYXR0cigiaWQiKTt9KS5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oZCkge3RpcFtwbG9pZHktMV0udHJhbnNpdGlvbigpLmR1cmF0aW9uKDIwMCkJLnN0eWxlKCJvcGFjaXR5IiwgLjkpLnN0eWxlKCJiYWNrZ3JvdW5kLWNvbG9yIiwiI0Y1RjVGNSIpLnN0eWxlKCJ3aWR0aCIsMTgwK2QuY291bnQqKGQzLm1heChkLmxhYmVsKS5sZW5ndGgqMykrJ3B4Jyk7DQogICAgIHRpcFtwbG9pZHktMV0uaHRtbCgiPGRpdiAgc3R5bGU9J2Zsb2F0OnRvcDtwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6MzUlOycgPjxkaXYgc3R5bGU9J2JvcmRlci1yYWRpdXM6IDVweDtmbG9hdDpsZWZ0O3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDo1NXB4O3dpZHRoOjMwJTtiYWNrZ3JvdW5kLWNvbG9yOiIrY29sb3JzW3RpbWVzXShkLnZhbHVlKSsNCiAgICAgIjsnID48L2Rpdj48ZGl2ICBzdHlsZT0nZmxvYXQ6bGVmdDtwb3NpdGlvbjpyZWxhdGl2ZTt3aWR0aDo3MCU7JyA+PHAgPjxmb250IHNpemU9JzEnIGNvbG9yPSdncmV5JyA+ICA8L2ZvbnQ+IDxmb250IHNpemU9JzEnICA+PGI+ICIrIiIrDQogICAgICIgPGJyPjxmb250IHNpemU9JzEnIGNvbG9yPSdncmV5JyA+IENvdW50OjwvZm9udD4iK2QuY291bnQrIiA8YnI+PGZvbnQgc2l6ZT0nMScgY29sb3I9J2dyZXknID4gIDwvZm9udD4gIisiIisNCiAgICAgIjwvZm9udD48YnI+PGZvbnQgc2l6ZT0nMScgY29sb3I9J2dyZXknID4gIDwvZm9udD48Zm9udCBzaXplPScxJz4iKyIiKyI8L3A+PC9mb250PjwvZGl2PjwvZGl2PjxkaXYgaWQgPSdtaWNyb0JhciIrcGxvaWR5KyInIHN0eWxlPSdmbG9hdDp0b3A7cG9zaXRpb246cmVsYXRpdmU7aGVpZ2h0OjM1JSc+PC9kaXY+PGJyPjxkaXYgIHN0eWxlPSdmbG9hdDp0b3A7aGVpZ2h0OjIwJTtwb3NpdGlvbjpyZWxhdGl2ZTtjb2xvcjonYmxhY2siKw0KICAgICAiOyc+PGZvbnQgc2l6ZT0nMicgPiIrZC5yYW5nZSsiPC9mb250PjwvcD48L2Rpdj4iKQ0KICAgICAuc3R5bGUoImxlZnQiLCAoZDMuZXZlbnQucGFnZVgpICsgInB4IikNCiAgICAgLnN0eWxlKCJ0b3AiLCAoZDMuZXZlbnQucGFnZVkgLSAxOCkgKyAicHgiKTsgdmFyIHN2Z1dpZHRoID0gMTc1K2QuY291bnQqKGQzLm1heChkLmxhYmVsKS5sZW5ndGgpKjM7dmFyIHN2Z0hlaWdodCA9IDUwO3ZhciBiYXJQYWRkaW5nID0gNTt2YXIgYmFyV2lkdGggPSAoc3ZnV2lkdGggLyBkLmJhci5sZW5ndGgpO3ZhciBteXN2ZyA9IGQzLnNlbGVjdCgnI21pY3JvQmFyJytwbG9pZHkpLmFwcGVuZCgic3ZnIikuYXR0cigid2lkdGgiLHN2Z1dpZHRoKS5hdHRyKCJoZWlndGgiLHN2Z0hlaWdodCk7dmFyIGJhckNoYXJ0ID0gbXlzdmcuc2VsZWN0QWxsKCdyZWN0JykuZGF0YShkLmJhcikuZW50ZXIoKS5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdoZWlnaHQnLHN2Z0hlaWdodC00MCkuYXR0cignd2lkdGgnLCBiYXJXaWR0aCkuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24gKGQsIGkpIHsgdmFyIHRyYW5zbGF0ZSA9IFtiYXJXaWR0aCAqIGksIDBdOyAgcmV0dXJuICd0cmFuc2xhdGUoJysgdHJhbnNsYXRlICsnKSc7fSkuc3R5bGUoImZpbGwiLGZ1bmN0aW9uKGQpe3JldHVybiBjb2xvcnNbdGltZXNdKGQpO30pOw0KICAgICAgdF9kYXRhPVtdOw0KICAgICAgZm9yKGo9MDtqPGQubGFiZWwubGVuZ3RoO2orKyl7DQogICAgICAgIHRfZGF0YS5wdXNoKHtsYjpkLmxhYmVsW2pdLGhsOmQuaGxpbmtbal19KTsNCiAgICAgIH0NCiAgICAgICB2YXIgdHRleHQ9bXlzdmcuc2VsZWN0QWxsKCIubm9kZSIpLmRhdGEodF9kYXRhKS5lbnRlcigpLmFwcGVuZCgic3ZnOmEiKS5hdHRyKCJ4bGluazpocmVmIiwgZnVuY3Rpb24oZCxpKXsgcmV0dXJuIGQuaGw7fSkNCiAgICAgLmFwcGVuZCgic3ZnOnRleHQiKS5hdHRyKCJ5IixzdmdIZWlnaHQqMC40KQ0KICAgICAuYXR0cigidHJhbnNmb3JtIiwicm90YXRlKDkwKSIpDQogICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAoZCwgaSkgeyB2YXIgdHJhbnNsYXRlID0gW2JhcldpZHRoICogaSwgMF07ICByZXR1cm4gJ3RyYW5zbGF0ZSgnKyB0cmFuc2xhdGUgKycpJzt9KQ0KICAgICAuYXR0cigiZm9udC1zaXplIiwgIjlweCIpLnN0eWxlKCJwb2ludGVyLWV2ZW50cyIsICJhbGwiKQ0KICAgICAuYXR0cigiY2xhc3MiLCJ0dHQiKS5zdHlsZSgiY3Vyc29yIiwicG9pbnRlciIpDQogICAgIC50ZXh0KGZ1bmN0aW9uKGQsaSl7cmV0dXJuIGQubGI7fSk7ICB9KQ0KICAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oZCkgewl0aXBbcGxvaWR5LTFdLnRyYW5zaXRpb24oKSAuZGVsYXkoMTAwMCkuZHVyYXRpb24oNTAwKQkuc3R5bGUoIm9wYWNpdHkiLCAwKTt9KS5zdHlsZSgidmlzaWJpbGl0eSIsInZpc2libGUiKS5zdHlsZSgiZmlsbCIsZnVuY3Rpb24oZCl7IHJldHVybiBjb2xvcnNbdGltZXNdKGQudmFsdWUpO30pDQogICAgIC5vbigiY2xpY2siLCBmdW5jdGlvbihkKSB7DQoNCg0KICAgICAgIGlmKGNsaWNrRmxhZyl7DQogICAgICAgICAgICB0aXAyW3Bsb2lkeS0xXS5zdHlsZSgib3BhY2l0eSIsIDApOw0KICAgICAgICAgfWVsc2V7DQogICAgICAgICAgIHRpcDJbcGxvaWR5LTFdLnRyYW5zaXRpb24oKS5kdXJhdGlvbigyMDApCS5zdHlsZSgib3BhY2l0eSIsIC45KS5zdHlsZSgiYmFja2dyb3VuZC1jb2xvciIsIiNGNUY1RjUiKS5zdHlsZSgid2lkdGgiLDE4MCtkLmNvdW50KihkMy5tYXgoZC5sYWJlbCkubGVuZ3RoKjMpKydweCcpOw0KICAgICAgICAgICB0aXAyW3Bsb2lkeS0xXS5odG1sKCI8ZGl2ICBzdHlsZT0nZmxvYXQ6dG9wO3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDozNSU7JyA+PGRpdiBzdHlsZT0nYm9yZGVyLXJhZGl1czogNXB4O2Zsb2F0OmxlZnQ7cG9zaXRpb246cmVsYXRpdmU7aGVpZ2h0OjU1cHg7d2lkdGg6MzAlO2JhY2tncm91bmQtY29sb3I6Iitjb2xvcnNbdGltZXNdKGQudmFsdWUpKw0KICAgICAgICAgICAiOycgPjwvZGl2PjxkaXYgIHN0eWxlPSdmbG9hdDpsZWZ0O3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjcwJTsnID48cCA+PGZvbnQgc2l6ZT0nMScgY29sb3I9J2dyZXknID4gIDwvZm9udD4gPGZvbnQgc2l6ZT0nMScgID48Yj4gIisiIisNCiAgICAgICAgICAgIiA8YnI+PGZvbnQgc2l6ZT0nMScgY29sb3I9J2dyZXknID4gQ291bnQ6PC9mb250PiIrZC5jb3VudCsiIDxicj48Zm9udCBzaXplPScxJyBjb2xvcj0nZ3JleScgPiAgPC9mb250PiAiKyIiKw0KICAgICAgICAgICAiPC9mb250Pjxicj48Zm9udCBzaXplPScxJyBjb2xvcj0nZ3JleScgPiAgPC9mb250Pjxmb250IHNpemU9JzEnPiIrIiIrIjwvcD48L2ZvbnQ+PC9kaXY+PC9kaXY+PGRpdiBpZCA9J21pY3JvQmFyMiIrcGxvaWR5KyInIHN0eWxlPSdmbG9hdDp0b3A7cG9zaXRpb246cmVsYXRpdmU7aGVpZ2h0OjM1JSc+PC9kaXY+PGJyPjxkaXYgIHN0eWxlPSdmbG9hdDp0b3A7aGVpZ2h0OjIwJTtwb3NpdGlvbjpyZWxhdGl2ZTtjb2xvcjonYmxhY2siKw0KICAgICAgICAgICAiOyc+PGZvbnQgc2l6ZT0nMicgPiIrZC5yYW5nZSsiPC9mb250PjwvcD48L2Rpdj4iKQ0KICAgICAgICAgICAuc3R5bGUoImxlZnQiLCAoZDMuZXZlbnQucGFnZVgpICsgInB4IikNCiAgICAgICAgICAgLnN0eWxlKCJ0b3AiLCAoZDMuZXZlbnQucGFnZVkgLSAxOCkgKyAicHgiKTsgdmFyIHN2Z1dpZHRoID0gMTc1K2QuY291bnQqKGQzLm1heChkLmxhYmVsKS5sZW5ndGgpKjM7dmFyIHN2Z0hlaWdodCA9IDUwO3ZhciBiYXJQYWRkaW5nID0gNTt2YXIgYmFyV2lkdGggPSAoc3ZnV2lkdGggLyBkLmJhci5sZW5ndGgpO3ZhciBteXN2ZzIgPSBkMy5zZWxlY3QoJyNtaWNyb0JhcjInK3Bsb2lkeSkuYXBwZW5kKCJzdmciKS5hdHRyKCJ3aWR0aCIsc3ZnV2lkdGgpLmF0dHIoImhlaWd0aCIsc3ZnSGVpZ2h0KTt2YXIgYmFyQ2hhcnQgPSBteXN2ZzIuc2VsZWN0QWxsKCdyZWN0JykuZGF0YShkLmJhcikuZW50ZXIoKS5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdoZWlnaHQnLHN2Z0hlaWdodC00MCkuYXR0cignd2lkdGgnLCBiYXJXaWR0aCkuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24gKGQsIGkpIHsgdmFyIHRyYW5zbGF0ZSA9IFtiYXJXaWR0aCAqIGksIDBdOyAgcmV0dXJuICd0cmFuc2xhdGUoJysgdHJhbnNsYXRlICsnKSc7fSkuc3R5bGUoImZpbGwiLGZ1bmN0aW9uKGQpe3JldHVybiBjb2xvcnNbdGltZXNdKGQpO30pOw0KICAgICAgICAgICAgdF9kYXRhPVtdOw0KICAgICAgICAgICAgZm9yKGo9MDtqPGQubGFiZWwubGVuZ3RoO2orKyl7DQogICAgICAgICAgICAgIHRfZGF0YS5wdXNoKHtsYjpkLmxhYmVsW2pdLGhsOmQuaGxpbmtbal19KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICB2YXIgdHRleHQ9bXlzdmcyLnNlbGVjdEFsbCgiLm5vZGUiKS5kYXRhKHRfZGF0YSkuZW50ZXIoKS5hcHBlbmQoInN2ZzphIikuYXR0cigieGxpbms6aHJlZiIsIGZ1bmN0aW9uKGQsaSl7IHJldHVybiBkLmhsO30pDQogICAgICAgICAgIC5hcHBlbmQoInN2Zzp0ZXh0IikuYXR0cigieSIsc3ZnSGVpZ2h0KjAuNCkNCiAgICAgICAgICAgLmF0dHIoInRyYW5zZm9ybSIsInJvdGF0ZSg5MCkiKQ0KICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24gKGQsIGkpIHsgdmFyIHRyYW5zbGF0ZSA9IFtiYXJXaWR0aCAqIGksIDBdOyAgcmV0dXJuICd0cmFuc2xhdGUoJysgdHJhbnNsYXRlICsnKSc7fSkNCiAgICAgICAgICAgLmF0dHIoImZvbnQtc2l6ZSIsICI5cHgiKS5zdHlsZSgicG9pbnRlci1ldmVudHMiLCAiYWxsIikNCiAgICAgICAgICAgLmF0dHIoImNsYXNzIiwidHR0Iikuc3R5bGUoImN1cnNvciIsInBvaW50ZXIiKQ0KICAgICAgICAgICAudGV4dChmdW5jdGlvbihkLGkpe3JldHVybiBkLmxiO30pOyB9IHJldHVybiBjbGlja0ZsYWcgPSAhY2xpY2tGbGFnOyB9KTsNCg0KIGlmKHBsb2lkeT09MSAmJiBsYWJlbHMpew0KDQogICAgICB2YXIgY2hEYXRhTGFiZWxzID0gZDMubmVzdCgpDQogIC5rZXkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sb2NpOyB9KQ0KICAucm9sbHVwKGZ1bmN0aW9uKHYpIHsgIHZhciBhPVtdO2Zvcih2YXIgaT0wOyBpPCB2Lmxlbmd0aDtpKyspeyBhLnB1c2godltpXS5uYW1lKTsgICB9O3JldHVybiBhWzBdO30pDQogIC5lbnRyaWVzKGNoRGF0YSk7DQogIHZhciBjaERhdGFMYWJlbCA9IGQzLm5lc3QoKQ0KLmtleShmdW5jdGlvbihkKSB7IHJldHVybiBkLmxvY2k7IH0pDQoucm9sbHVwKGZ1bmN0aW9uKHYpIHsgIHZhciBhPVtdO2Zvcih2YXIgaT0wOyBpPCB2Lmxlbmd0aDtpKyspeyBhLnB1c2godltpXS5sYWJlbCk7ICAgfTtyZXR1cm4gYVswXTt9KQ0KLmVudHJpZXMoY2hEYXRhKTsNCiAgICAgZm9yKHZhciBpID0gMDtpIDwgY2hEYXRhUmVkdWNlZC5sZW5ndGg7aSsrKSB7DQoNCg0KICAgICAgY2hEYXRhUmVkdWNlZFtpXS5sYWJlbF9pZCA9IGNoRGF0YUxhYmVsW2ldLnZhbHVlOw0KICAgICAgY2hEYXRhUmVkdWNlZFtpXS5sYWJlbHMgPWNoRGF0YUxhYmVsc1tpXS52YWx1ZTsNCg0KICAgIH0NCg0KDQogICAgIGQzLnNlbGVjdEFsbCgiLmxhYmVscyIpLmRhdGEoY2hEYXRhUmVkdWNlZCwgZnVuY3Rpb24oZCkge3JldHVybiAoZCAmJiBkLmxhYmVsX2lkKXx8ZDMuc2VsZWN0KHRoaXMpLmF0dHIoImlkIik7fSkudGV4dChmdW5jdGlvbihkKXsgcmV0dXJuIGQubGFiZWxzO30pOw0KICAgfQ0KfQ0KDQp9DQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCiAgLy9oZWF0bWFwIGNvZGUgZW5kDQogfQ0KDQoNCn0NCg0KDQovL2VuZCBvZiB2ZXJ0aWNhbA0K"></script>
<script src="data:application/x-javascript;base64,SFRNTFdpZGdldHMud2lkZ2V0KHsNCg0KICBuYW1lOiAnY2hyb21vTWFwJywNCg0KICB0eXBlOiAnb3V0cHV0JywNCg0KICBmYWN0b3J5OiBmdW5jdGlvbihlbCx3aWR0aCxoZWlnaHQpIHsNCg0KDQoNCiAgICByZXR1cm4gew0KDQogICAgICByZW5kZXJWYWx1ZTogZnVuY3Rpb24oeCkgew0KDQogICAgICAgIC8vIGFkZGluZyB0aGUgZGl2aXNpb24gd2l0aCBpZCAgcmVxdWlyZWQgdG8gcmVuZGVyIHBsb3QNCiAgICAgICAgZDMuc2VsZWN0KGVsKS5hcHBlbmQoImRpdiIpDQogICAgICAgICAgLmF0dHIoImlkIiwgeC5kaXZfaWQpOw0KDQogICAgICAgIC8vIFRPRE86IGNvZGUgdG8gcmVuZGVyIHRoZSB3aWRnZXQsIGUuZy4NCiAgICAgICAgLy8gIHZhciBkYXRhID0gSFRNTFdpZGdldHMuZGF0YWZyYW1lVG9EMyh4LmNoRGF0YSk7DQogICAgICAgIHZhciBhPVtdOw0KICAgICAgICB2YXIgYj1bXTsNCiAgICAgICAgZm9yKGk9MDtpPHguY2hEYXRhLmxlbmd0aDtpKyspew0KDQogICAgICAgICAgYVtpXT1IVE1MV2lkZ2V0cy5kYXRhZnJhbWVUb0QzKHguY2hEYXRhW2ldKTsNCiAgICAgICAgfQ0KICAgICAgICBmb3IoaT0wO2k8eC5uTG9jaS5sZW5ndGg7aSsrKXsNCg0KICAgICAgICAgIGJbaV09SFRNTFdpZGdldHMuZGF0YWZyYW1lVG9EMyh4Lm5Mb2NpW2ldKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGNocm9tb01hcChhLA0KICAgICAgICAgIGIsDQogICAgICAgICAgeC5wbG9pZHlfbiwNCiAgICAgICAgICB4LnRpdGxlLA0KICAgICAgICAgIHguY250LA0KICAgICAgICAgIHguY2hfZ2FwLA0KICAgICAgICAgIHgudG9wX21hcmdpbiwNCiAgICAgICAgICB4LmxlZnRfbWFyZ2luLA0KICAgICAgICAgIHguY2hyX3dpZHRoLA0KICAgICAgICAgIHguY2hyX2xlbmd0aCwNCiAgICAgICAgICB4LmNocl9jb2wsDQogICAgICAgICAgeC5oZWF0bWFwLA0KICAgICAgICAgIHgudl9hbGlnbiwNCiAgICAgICAgICB4LmNoX2RvbWFpbiwNCiAgICAgICAgICB4LmxnX3gsDQogICAgICAgICAgeC5sZ195LA0KICAgICAgICAgIHguaGVhdF9zY2FsZSwNCiAgICAgICAgICB4LmxhYmVscywNCiAgICAgICAgICB4LmRpdl9pZCwNCiAgICAgICAgICB4LncsDQogICAgICAgICAgeC5oLHgucm5nLHguaGVhdF9jb2wseC5hbl9jb2wseC5jaF90ZXh0LHgubGVnZW5kLHguYWdncmVnYXRlX2Z1bmMNCg0KKTsNCg0KDQoNCiAgICAgIH0sDQoNCiAgICAgIHJlc2l6ZTogZnVuY3Rpb24od2lkdGgsaGVpZ2gpIHsNCg0KICAgICAgICAvLyBhbHJlYWR5IGhhbmRsZWQgYnkgbWFpbiBmdW5jdGlvbiB0aGF0IHJlbmRlciBwbG90DQoNCiAgICAgIH0NCg0KICAgIH07DQogIH0NCn0pOw0K"></script>
</head>
<body style="background-color: white;">
<div id="htmlwidget_container">
<div id="htmlwidget-c1a27c1ebf3ff410447f" class="chromoMap html-widget" style="width:960px;height:500px;">

</div>
</div>
<script type="application/json" data-for="htmlwidget-c1a27c1ebf3ff410447f">{"x":{"chData":[{"name":["putative_transposase_[n=1]_2","putative_Sir2-like_protein_[n=16]_37","DNA_methylase_[n=7]_41","capsid_and_scaffold_protein_[n=1]_44","capsid_and_scaffold_protein_[n=1]_44","integrase_[n=57]_47","putative_DNA_N6-adenine_methyltransferase_[n=6]_49","putative_DNA_N6-adenine_methyltransferase_[n=6]_49","putative_DNA_helicase_[n=124]_51","putative_DNA_helicase_[n=124]_51","glutaredoxin_[n=198]_54","putative_dTDP-4-dehydrorhamnose_3,5-epimerase_[n=2]_56","putative_dTDP-4-dehydrorhamnose_3,5-epimerase_[n=2]_56","putative_phage-related_hydrogenase_[n=3]_58","putative_phage-related_hydrogenase_[n=3]_58","aerobic_NDP_reductase_small_subunit_[n=2]_61","aerobic_NDP_reductase_small_subunit_[n=2]_61","thymidylate_synthase_[n=118]_66","thymidine_kinase_[n=87]_68","No_annotation_provided_[n=3]_73","DNA_ligase_[n=230]_78","terminase_small_subunit_[n=6]_79","RNA_ligase_[n=41]_83","transposase-like_protein_[n=5]_88","nicotinamide_phosphoribosyltransferase_[n=40]_91","nicotinamide_phosphoribosyltransferase_[n=40]_91","DNA_methylase_[n=1]_98","DNA_methylase_[n=1]_98","portal_protein_[n=269]_99","portal_protein_[n=269]_99","major_capsid_protein_[n=27]_103","putative_tape_measure_protein_[n=3]_113","putative_tape_measure_protein_[n=3]_113","160_kDa_protein_[n=3]_121","160_kDa_protein_[n=3]_121","160_kDa_protein_[n=3]_132","160_kDa_protein_[n=3]_132","putative_methyltransferase_[n=6]_133","p53_[n=1]_136","putative_DNA_primase_[n=11]_139","putative_glycosyltransferase_[n=5]_142","peptidase_domain-containing_protein_[n=2]_145","peptidase_domain-containing_protein_[n=2]_145","putative_phosphoribosyltransferase-like_domain_protein_[n=1]_153","putative_phosphoribosyltransferase-like_domain_protein_[n=1]_153","putative_dehalogenase_hydrolase-like_protein_[n=1]_154","AAA_ATPase_[n=5]_155","AAA_ATPase_[n=5]_155","anaerobic_NTP_reductase_small_subunit_[n=31]_156","anaerobic_NTP_reductase_large_subunit_[n=23]_158","internal_virion_protein_C_[n=36]_162","internal_virion_protein_C_[n=36]_162","putative_glucose-1-phosphate_thymidylyltransferase_[n=2]_175","topoisomerase_II_large_subunit_[n=5]_177","terminase_large_subunit_[n=695]_182","putative_ATPase_[n=2]_192","major_capsid_protein_[n=27]_194","major_capsid_protein_[n=27]_194","glycosyl_transferase_group_I_[n=2]_196","gp23_[n=4]_197","tapemeasure_[n=2]_199","tapemeasure_[n=2]_199","tail_protein_[n=5]_200","tail_protein_[n=5]_200","minor_structural_protein_[n=15]_201","No_annotation_provided_[n=3]_203","No_annotation_provided_[n=3]_203","O-methyltransferase_[n=3]_207","HNH_endonuclease_[n=1]_217","scaffolding_protein_[n=11]_231","major_capsid_protein_[n=27]_233","major_capsid_protein_[n=27]_233","glycosyl_transferase_group_I_[n=2]_235","glycosyl_transferase_group_I_[n=2]_235","gp23_[n=4]_236","tapemeasure_[n=2]_237","tapemeasure_[n=2]_237","tail_protein_[n=5]_238","tail_protein_[n=5]_238","minor_structural_protein_[n=15]_239","No_annotation_provided_[n=3]_242","O-methyltransferase_[n=3]_246","BcepNY3gp56_[n=1]_256","gp85_[n=1]_262","peptidase_domain-containing_protein_[n=2]_265","structural_protein_[n=4]_266","PfWMP3_27_[n=1]_268","PfWMP3_27_[n=1]_268","portal_protein_[n=269]_272","portal_protein_[n=269]_272","major_capsid_protein_[n=37]_277","major_capsid_protein_[n=37]_277","gp56_[n=2]_278","cell_adhesion_domain-containing_protein_[n=3]_279","unknown_[n=3]_280","unknown_[n=3]_280","unknown_[n=3]_280","minor_tail_protein_[n=118]_283","minor_tail_protein_[n=118]_283","tail_protein_[n=2]_284","holin_[n=8]_286","holin_[n=8]_286","DNA_helicase_[n=102]_306","DNA_helicase_[n=102]_306","DNA_helicase_[n=102]_306","HNH_endonuclease_domain_protein_[n=1]_315","carboxylesterase_[n=19]_317","carboxylesterase_[n=19]_317","thymidylate_synthase_[n=3]_319","exonuclease_[n=48]_326","terminase_large_subunit_[n=2]_330","head_fiber_protein_[n=4]_335","tail_sheath_protein_[n=101]_341","tail_sheath_protein_[n=101]_341","hinge_connector_of_long_tail_fiber_distal_connector_[n=16]_349","hinge_connector_of_long_tail_fiber_distal_connector_[n=16]_349","gp28_[n=2]_351","major_capsid_&_capsid_maturation_protease_[n=4]_353","baseplate_J_[n=7]_355","baseplate_J_[n=7]_355","head-tail_connector_[n=1]_356","exonuclease_[n=32]_357","exonuclease_[n=32]_357","RecT_[n=14]_358","RNA_polymerase_sigma_factor_[n=33]_360","No_annotation_provided_[n=4]_365","gp139_[n=1]_372","acetyltransferase_[n=4]_375","DNA_polymerase_subunit_III_[n=1]_376","DNA_polymerase_subunit_III_[n=1]_376","terminase_large_subunit_[n=4]_379","No_annotation_provided_[n=1]_382","No_annotation_provided_[n=1]_382","major_tail_protein_[n=29]_391","holin_[n=3]_393","tail_protein_[n=1]_395","tail_protein_[n=1]_395","carboxypeptidase_A_[n=4]_397","carboxypeptidase_A_[n=4]_397","pore-forming_tail_tip_protein_[n=5]_402","pore-forming_tail_tip_protein_[n=5]_402","tail_protein_[n=6]_407","putative_transcriptional_regulator_[n=2]_413","putative_transcriptional_regulator_[n=2]_413","No_annotation_provided_[n=6]_417","No_annotation_provided_[n=7]_418","No_annotation_provided_[n=7]_418","5-phosphoribosylformylglycinamide_amidotransferase_[n=30]_420","deoxyuridine_5-triphosphate_nucleotidohydrolase_[n=40]_437","deoxyuridine_5-triphosphate_nucleotidohydrolase_[n=40]_437","transcriptional_activator_RinB_[n=17]_439","DNA_primase_[n=259]_443","PE/PPE-like_protein_[n=5]_446","putative_tail_fiber_[n=2]_458","tail_tubular_protein_B_[n=69]_462","tail_tubular_protein_B_[n=69]_462","tail_tubular_protein_A_[n=77]_463","major_capsid_protein_[n=107]_464","head-tail_connector_protein_[n=33]_466","DNA_ligase_[n=230]_471","No_annotation_provided_[n=3]_475","No_annotation_provided_[n=3]_475","DNA_polymerase_[n=254]_478","DNA_polymerase_[n=254]_478","DNA_polymerase_[n=254]_478","putative_DNA_helicase_[n=124]_479","putative_tail_fiber_[n=2]_480","tail_tubular_protein_B_[n=69]_484","tail_tubular_protein_B_[n=69]_484","tail_tubular_protein_A_[n=77]_485","major_capsid_protein_[n=107]_487","major_capsid_protein_[n=107]_487","head-tail_connector_protein_[n=33]_489","head-tail_connector_protein_[n=33]_489","DNA_ligase_[n=230]_495","DNA_polymerase_[n=3]_502","DNA_polymerase_[n=3]_502","DNA_primase_[n=259]_505","DNA_primase_[n=259]_505","putative_major_tail_protein_[n=14]_523","Ren_protein_[n=4]_524","Ren_protein_[n=4]_524","metallophosphoesterase_[n=6]_526","DNA_methylase_[n=102]_534","DNA_methylase_[n=102]_534","helicase_[n=252]_537","helicase_[n=252]_537","Ner-like_protein_[n=7]_545","RecA-like_recombinase_[n=1]_546","RecA-like_recombinase_[n=1]_546","terminase_small_subunit_[n=20]_563","terminase_small_subunit_[n=20]_563","gpF-like_protein_[n=2]_566","gpF-like_protein_[n=2]_566","putative_tail_protein_[n=10]_567","scaffolding_protein_[n=107]_569","scaffolding_protein_[n=107]_569","major_capsid_protein_[n=19]_570","head_fiber_protein_[n=4]_571","putative_tail_protein_[n=10]_572","putative_tail_protein_[n=10]_572","serine/threonine_protein_phosphatase_[n=22]_578","No_annotation_provided_[n=2]_582","No_annotation_provided_[n=2]_582","thymidylate_synthase_[n=118]_583","ribonucleoside_triphosphate_reductase,_alpha_chain_[n=7]_591","ribonucleoside_triphosphate_reductase,_alpha_chain_[n=7]_591","putative_terminase_large_subunit_[n=5]_592","putative_terminase_large_subunit_[n=5]_592","portal_vertex_protein_[n=79]_593","ribonucleoside_triphosphate_reductase,_alpha_chain_[n=7]_595","ribonucleoside_triphosphate_reductase,_alpha_chain_[n=7]_595","aerobic_NDP_reductase_small_subunit_[n=2]_596","major_capsid_protein_[n=99]_600","peptidase_[n=55]_601","neck_protein_[n=153]_602","neck_protein_[n=153]_602","gp25_[n=2]_604","tail_sheath_stabilizer_and_completion_protein_[n=74]_606","baseplate_hub_subunit_[n=112]_609","baseplate_hub_subunit_[n=112]_609","baseplate_hub_subunit_and_tail_lysozyme_[n=50]_612","baseplate_hub_subunit_and_tail_lysozyme_[n=50]_612","putative_tail_protein_[n=6]_618","putative_tail_protein_[n=6]_618","No_annotation_provided_[n=2]_623","late_promoter_transcription_accessory_protein_[n=68]_624","late_promoter_transcription_accessory_protein_[n=68]_624","topoisomerase_II_large_subunit_[n=5]_628","ATP-dependent_helicase_[n=9]_631","ATP-dependent_helicase_[n=9]_631","putative_DNA_helicase_[n=124]_632","DNA_primase_[n=259]_634","recombinase_[n=3]_636","bacterial_surface_protein_[n=2]_637","putative_DNA_polymerase_I_[n=6]_639","putative_tail_sheath_protein_[n=7]_640","DNA_polymerase_[n=254]_646","gp65_[n=3]_654","gp65_[n=3]_654","recombination_endonuclease_subunit_[n=63]_660","recombination_endonuclease_subunit_[n=63]_660","recombination_endonuclease_subunit_[n=74]_661","NAD-dependent_DNA_ligase_subunit_B_[n=7]_664","putative_UDP-glucose_dehydrogenase_[n=1]_666","alpha-glucosyl-transferase_[n=16]_670","glutaredoxin_[n=198]_672","helicase_[n=252]_674","helicase_[n=252]_674","internal_virion_protein_[n=2]_676","internal_virion_protein_[n=2]_676","putative_DNA_helicase_[n=7]_693","ORF031_[n=2]_702","ORF031_[n=2]_702","deaminase_[n=1]_706","DNA_methylase_[n=2]_717","DNA_methylase_[n=2]_717","tail_protein_[n=1]_719","No_annotation_provided_[n=2]_723","No_annotation_provided_[n=2]_723","structural_protein_[n=1]_735","DNA_primase_[n=259]_739","DNA_primase_[n=259]_739","excisionase_[n=4]_742","tail_completion_and_sheath_stabilizer_protein_[n=67]_744"],"data":["Other","Other","Other","Capsid","Capsid","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Capsid","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Capsid","Capsid","Other","Other","Other","Other","Tail","Tail","Other","Other","Other","Other","Other","Other","Capsid","Capsid","Other","Other","Other","Other","Other","Tail","Tail","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Capsid","Capsid","Other","Other","Other","Other","Other","Tail","Tail","Tail","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Tail","Tail","Tail","Tail","Other","Capsid","Baseplate","Baseplate","Tail","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Tail","Other","Tail","Tail","Other","Other","Tail","Tail","Tail","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Tail","Tail","Tail","Tail","Capsid","Tail","Other","Other","Other","Other","Other","Other","Other","Tail","Tail","Tail","Tail","Capsid","Capsid","Tail","Tail","Other","Other","Other","Other","Other","Tail","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Tail","Other","Other","Capsid","Other","Tail","Tail","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Capsid","Other","Other","Other","Other","Tail","Baseplate","Baseplate","Baseplate","Baseplate","Tail","Tail","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Tail","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Tail","Other","Other","Other","Other","Other","Other","Tail"],"loci":["pos_phage_0-1-1","pos_phage_0-11-1","pos_phage_0-12-1","pos_phage_0-12-1","pos_phage_0-13-1","pos_phage_0-14-1","pos_phage_0-14-1","pos_phage_0-15-1","pos_phage_0-15-1","pos_phage_0-16-1","pos_phage_0-16-1","pos_phage_0-16-1","pos_phage_0-17-1","pos_phage_0-17-1","pos_phage_0-18-1","pos_phage_0-18-1","pos_phage_0-19-1","pos_phage_0-20-1","pos_phage_0-21-1","pos_phage_0-22-1","pos_phage_0-24-1","pos_phage_0-24-1","pos_phage_0-25-1","pos_phage_0-26-1","pos_phage_0-27-1","pos_phage_0-28-1","pos_phage_0-30-1","pos_phage_0-31-1","pos_phage_0-31-1","pos_phage_0-32-1","pos_phage_0-33-1","pos_phage_0-36-1","pos_phage_0-37-1","pos_phage_0-40-1","pos_phage_0-41-1","pos_phage_0-46-1","pos_phage_0-47-1","pos_phage_0-47-1","pos_phage_0-48-1","pos_phage_0-50-1","pos_phage_0-52-1","pos_phage_0-52-1","pos_phage_0-53-1","pos_phage_0-56-1","pos_phage_0-57-1","pos_phage_0-57-1","pos_phage_0-57-1","pos_phage_0-58-1","pos_phage_0-58-1","pos_phage_0-59-1","pos_phage_0-60-1","pos_phage_0-61-1","pos_phage_0-64-1","pos_phage_0-64-1","pos_phage_0-65-1","pos_phage_1-6-1","pos_phage_1-6-1","pos_phage_1-7-1","pos_phage_1-8-1","pos_phage_1-8-1","pos_phage_1-9-1","pos_phage_1-10-1","pos_phage_1-10-1","pos_phage_1-11-1","pos_phage_1-14-1","pos_phage_1-15-1","pos_phage_1-16-1","pos_phage_1-17-1","pos_phage_1-22-1","pos_phage_2-6-1","pos_phage_2-6-1","pos_phage_2-7-1","pos_phage_2-7-1","pos_phage_2-8-1","pos_phage_2-8-1","pos_phage_2-9-1","pos_phage_2-10-1","pos_phage_2-10-1","pos_phage_2-11-1","pos_phage_2-14-1","pos_phage_2-15-1","pos_phage_2-16-1","pos_phage_2-22-1","pos_phage_2-24-1","pos_phage_2-26-1","pos_phage_3-1-1","pos_phage_3-1-1","pos_phage_3-2-1","pos_phage_3-3-1","pos_phage_3-4-1","pos_phage_3-5-1","pos_phage_3-6-1","pos_phage_3-6-1","pos_phage_3-6-1","pos_phage_3-7-1","pos_phage_3-8-1","pos_phage_3-9-1","pos_phage_3-11-1","pos_phage_3-12-1","pos_phage_3-12-1","pos_phage_3-12-1","pos_phage_3-13-1","pos_phage_3-18-1","pos_phage_3-19-1","pos_phage_3-20-1","pos_phage_3-23-1","pos_phage_3-23-1","pos_phage_3-24-1","pos_phage_3-24-1","pos_phage_3-26-1","pos_phage_4-1-1","pos_phage_4-4-1","pos_phage_4-5-1","pos_phage_4-6-1","pos_phage_4-10-1","pos_phage_4-11-1","pos_phage_4-11-1","pos_phage_4-12-1","pos_phage_4-12-1","pos_phage_4-13-1","pos_phage_4-13-1","pos_phage_4-13-1","pos_phage_4-14-1","pos_phage_4-14-1","pos_phage_4-15-1","pos_phage_4-17-1","pos_phage_4-20-1","pos_phage_4-21-1","pos_phage_4-21-1","pos_phage_4-22-1","pos_phage_5-1-1","pos_phage_5-2-1","pos_phage_5-3-1","pos_phage_5-4-1","pos_phage_5-5-1","pos_phage_5-6-1","pos_phage_5-7-1","pos_phage_5-8-1","pos_phage_5-9-1","pos_phage_5-10-1","pos_phage_5-11-1","pos_phage_5-12-1","pos_phage_5-14-1","pos_phage_5-15-1","pos_phage_5-15-1","pos_phage_5-15-1","pos_phage_5-16-1","pos_phage_5-16-1","pos_phage_5-19-1","pos_phage_5-20-1","pos_phage_5-20-1","pos_phage_6-1-1","pos_phage_6-2-1","pos_phage_6-7-1","pos_phage_6-11-1","pos_phage_6-12-1","pos_phage_6-12-1","pos_phage_6-13-1","pos_phage_6-14-1","pos_phage_6-16-1","pos_phage_6-17-1","pos_phage_6-18-1","pos_phage_6-18-1","pos_phage_6-19-1","pos_phage_6-20-1","pos_phage_6-20-1","pos_phage_7-1-1","pos_phage_7-5-1","pos_phage_7-6-1","pos_phage_7-6-1","pos_phage_7-6-1","pos_phage_7-7-1","pos_phage_7-7-1","pos_phage_7-8-1","pos_phage_7-10-1","pos_phage_7-12-1","pos_phage_7-13-1","pos_phage_7-14-1","pos_phage_7-15-1","pos_phage_8-1-1","pos_phage_8-1-1","pos_phage_8-2-1","pos_phage_8-2-1","pos_phage_8-6-1","pos_phage_8-7-1","pos_phage_8-7-1","pos_phage_8-8-1","pos_phage_8-11-1","pos_phage_8-11-1","pos_phage_8-12-1","pos_phage_8-14-1","pos_phage_8-15-1","pos_phage_8-16-1","pos_phage_8-17-1","pos_phage_8-17-1","pos_phage_8-17-1","pos_phage_8-18-1","pos_phage_8-18-1","pos_phage_8-18-1","pos_phage_8-18-1","pos_phage_8-19-1","pos_phage_9-1-1","pos_phage_9-2-1","pos_phage_9-3-1","pos_phage_9-3-1","pos_phage_9-7-1","pos_phage_9-8-1","pos_phage_9-8-1","pos_phage_9-9-1","pos_phage_9-9-1","pos_phage_9-10-1","pos_phage_9-11-1","pos_phage_9-11-1","pos_phage_9-13-1","pos_phage_9-13-1","pos_phage_9-13-1","pos_phage_9-14-1","pos_phage_9-14-1","pos_phage_9-15-1","pos_phage_9-16-1","pos_phage_9-17-1","pos_phage_9-19-1","pos_phage_9-20-1","pos_phage_9-24-1","pos_phage_9-25-1","pos_phage_9-33-1","pos_phage_9-33-1","pos_phage_9-34-1","pos_phage_9-36-1","pos_phage_9-39-1","pos_phage_9-40-1","pos_phage_9-40-1","pos_phage_9-41-1","pos_phage_9-42-1","pos_phage_9-43-1","pos_phage_9-44-1","pos_phage_9-44-1","pos_phage_9-49-1","pos_phage_9-52-1","pos_phage_9-53-1","pos_phage_9-55-1","pos_phage_9-56-1","pos_phage_9-56-1","pos_phage_9-58-1","pos_phage_9-59-1","pos_phage_9-62-1","pos_phage_9-63-1","pos_phage_9-64-1","pos_phage_9-65-1","pos_phage_9-65-1","pos_phage_9-66-1","pos_phage_9-72-1","pos_phage_9-75-1","pos_phage_9-76-1","pos_phage_9-78-1","pos_phage_9-84-1","pos_phage_9-85-1","pos_phage_9-85-1","pos_phage_9-85-1","pos_phage_9-86-1","pos_phage_9-93-1","pos_phage_9-94-1","pos_phage_9-95-1","pos_phage_9-97-1","pos_phage_9-98-1"],"loci_start":[1,22221,24443,24443,26665,28887,28887,31109,31109,33331,33331,33331,35553,35553,37775,37775,39997,42219,44441,46663,51107,51107,53329,55551,57773,59995,64439,66661,66661,68883,71105,77771,79993,86659,88881,99991,102213,102213,104435,108879,113323,113323,115545,122211,124433,124433,124433,126655,126655,128877,131099,133321,139987,139987,142209,10901,10901,13081,15261,15261,17441,19621,19621,21801,28341,30521,32701,34881,45781,11261,11261,13513,13513,15765,15765,18017,20269,20269,22521,29277,31529,33781,47293,51797,56301,1,1,2203,4405,6607,8809,11011,11011,11011,13213,15415,17617,22021,24223,24223,24223,26425,37435,39637,41839,48445,48445,50647,50647,55051,1,6691,8921,11151,20071,22301,22301,24531,24531,26761,26761,26761,28991,28991,31221,35681,42371,44601,44601,46831,1,2166,4331,6496,8661,10826,12991,15156,17321,19486,21651,23816,28146,30311,30311,30311,32476,32476,38971,41136,41136,1,2194,13159,21931,24124,24124,26317,28510,32896,35089,37282,37282,39475,41668,41668,1,8853,11066,11066,11066,13279,13279,15492,19918,24344,26557,28770,30983,1,1,2204,2204,11016,13219,13219,15422,22031,22031,24234,28640,30843,33046,35249,35249,35249,37452,37452,37452,37452,39655,1,2220,4439,4439,13315,15534,15534,17753,17753,19972,22191,22191,26629,26629,26629,28848,28848,31067,33286,35505,39943,42162,51038,53257,71009,71009,73228,77666,84323,86542,86542,88761,90980,93199,95418,95418,106513,113170,115389,119827,122046,122046,126484,128703,135360,137579,139798,142017,142017,144236,157550,164207,166426,170864,184178,186397,186397,186397,188616,204149,206368,208587,213025,215244],"loci_end":[2222,24442,26664,26664,28886,31108,31108,33330,33330,35552,35552,35552,37774,37774,39996,39996,42218,44440,46662,48884,53328,53328,55550,57772,59994,62216,66660,68882,68882,71104,73326,79992,82214,88880,91102,102212,104434,104434,106656,111100,115544,115544,117766,124432,126654,126654,126654,128876,128876,131098,133320,135542,142208,142208,144430,13080,13080,15260,17440,17440,19620,21800,21800,23980,30520,32700,34880,37060,47960,13512,13512,15764,15764,18016,18016,20268,22520,22520,24772,31528,33780,36032,49544,54048,58560,2202,2202,4404,6606,8808,11010,13212,13212,13212,15414,17616,19818,24222,26424,26424,26424,28626,39636,41838,44040,50646,50646,52848,52848,57252,2230,8920,11150,13380,22300,24530,24530,26760,26760,28990,28990,28990,31220,31220,33450,37910,44600,46830,46830,49060,2165,4330,6495,8660,10825,12990,15155,17320,19485,21650,23815,25980,30310,32475,32475,32475,34640,34640,41135,43293,43293,2193,4386,15351,24123,26316,26316,28509,30702,35088,37281,39474,39474,41667,43851,43851,2213,11065,13278,13278,13278,15491,15491,17704,22130,26556,28769,30982,33195,2203,2203,4406,4406,13218,15421,15421,17624,24233,24233,26436,30842,33045,35248,37451,37451,37451,39654,39654,39654,39654,41865,2219,4438,6657,6657,15533,17752,17752,19971,19971,22190,24409,24409,28847,28847,28847,31066,31066,33285,35504,37723,42161,44380,53256,55475,73227,73227,75446,79884,86541,88760,88760,90979,93198,95417,97636,97636,108731,115388,117607,122045,124264,124264,128702,130921,137578,139797,142016,144235,144235,146454,159768,166425,168644,173082,186396,188615,188615,188615,190834,206367,208586,210805,215243,217462],"hlink":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"],"label":["Lpos_phage_0-1-1","Lpos_phage_0-11-1","Lpos_phage_0-12-1","Lpos_phage_0-12-1","Lpos_phage_0-12-1","Lpos_phage_0-14-1","Lpos_phage_0-14-1","Lpos_phage_0-14-1","Lpos_phage_0-15-1","Lpos_phage_0-15-1","Lpos_phage_0-16-1","Lpos_phage_0-16-1","Lpos_phage_0-16-1","Lpos_phage_0-17-1","Lpos_phage_0-17-1","Lpos_phage_0-18-1","Lpos_phage_0-18-1","Lpos_phage_0-20-1","Lpos_phage_0-21-1","Lpos_phage_0-22-1","Lpos_phage_0-24-1","Lpos_phage_0-24-1","Lpos_phage_0-25-1","Lpos_phage_0-26-1","Lpos_phage_0-27-1","Lpos_phage_0-27-1","Lpos_phage_0-30-1","Lpos_phage_0-30-1","Lpos_phage_0-31-1","Lpos_phage_0-31-1","Lpos_phage_0-33-1","Lpos_phage_0-36-1","Lpos_phage_0-36-1","Lpos_phage_0-40-1","Lpos_phage_0-40-1","Lpos_phage_0-46-1","Lpos_phage_0-46-1","Lpos_phage_0-47-1","Lpos_phage_0-48-1","Lpos_phage_0-50-1","Lpos_phage_0-52-1","Lpos_phage_0-52-1","Lpos_phage_0-52-1","Lpos_phage_0-56-1","Lpos_phage_0-56-1","Lpos_phage_0-57-1","Lpos_phage_0-57-1","Lpos_phage_0-57-1","Lpos_phage_0-58-1","Lpos_phage_0-59-1","Lpos_phage_0-60-1","Lpos_phage_0-60-1","Lpos_phage_0-64-1","Lpos_phage_0-64-1","Lpos_phage_0-65-1","Lpos_phage_1-6-1","Lpos_phage_1-6-1","Lpos_phage_1-6-1","Lpos_phage_1-8-1","Lpos_phage_1-8-1","Lpos_phage_1-9-1","Lpos_phage_1-9-1","Lpos_phage_1-10-1","Lpos_phage_1-10-1","Lpos_phage_1-14-1","Lpos_phage_1-15-1","Lpos_phage_1-15-1","Lpos_phage_1-17-1","Lpos_phage_1-22-1","Lpos_phage_2-6-1","Lpos_phage_2-6-1","Lpos_phage_2-6-1","Lpos_phage_2-7-1","Lpos_phage_2-7-1","Lpos_phage_2-8-1","Lpos_phage_2-9-1","Lpos_phage_2-9-1","Lpos_phage_2-10-1","Lpos_phage_2-10-1","Lpos_phage_2-14-1","Lpos_phage_2-15-1","Lpos_phage_2-16-1","Lpos_phage_2-22-1","Lpos_phage_2-24-1","Lpos_phage_2-26-1","Lpos_phage_3-1-1","Lpos_phage_3-1-1","Lpos_phage_3-1-1","Lpos_phage_3-3-1","Lpos_phage_3-3-1","Lpos_phage_3-5-1","Lpos_phage_3-5-1","Lpos_phage_3-6-1","Lpos_phage_3-6-1","Lpos_phage_3-8-1","Lpos_phage_3-8-1","Lpos_phage_3-8-1","Lpos_phage_3-11-1","Lpos_phage_3-11-1","Lpos_phage_3-12-1","Lpos_phage_3-12-1","Lpos_phage_3-12-1","Lpos_phage_3-19-1","Lpos_phage_3-19-1","Lpos_phage_3-19-1","Lpos_phage_3-23-1","Lpos_phage_3-23-1","Lpos_phage_3-23-1","Lpos_phage_3-24-1","Lpos_phage_3-26-1","Lpos_phage_4-1-1","Lpos_phage_4-4-1","Lpos_phage_4-5-1","Lpos_phage_4-5-1","Lpos_phage_4-10-1","Lpos_phage_4-10-1","Lpos_phage_4-11-1","Lpos_phage_4-12-1","Lpos_phage_4-12-1","Lpos_phage_4-12-1","Lpos_phage_4-13-1","Lpos_phage_4-13-1","Lpos_phage_4-13-1","Lpos_phage_4-14-1","Lpos_phage_4-15-1","Lpos_phage_4-17-1","Lpos_phage_4-20-1","Lpos_phage_4-21-1","Lpos_phage_4-21-1","Lpos_phage_4-21-1","Lpos_phage_5-1-1","Lpos_phage_5-2-1","Lpos_phage_5-2-1","Lpos_phage_5-4-1","Lpos_phage_5-5-1","Lpos_phage_5-6-1","Lpos_phage_5-6-1","Lpos_phage_5-8-1","Lpos_phage_5-8-1","Lpos_phage_5-10-1","Lpos_phage_5-10-1","Lpos_phage_5-12-1","Lpos_phage_5-14-1","Lpos_phage_5-14-1","Lpos_phage_5-15-1","Lpos_phage_5-15-1","Lpos_phage_5-15-1","Lpos_phage_5-16-1","Lpos_phage_5-19-1","Lpos_phage_5-19-1","Lpos_phage_5-20-1","Lpos_phage_6-1-1","Lpos_phage_6-2-1","Lpos_phage_6-7-1","Lpos_phage_6-11-1","Lpos_phage_6-11-1","Lpos_phage_6-12-1","Lpos_phage_6-13-1","Lpos_phage_6-14-1","Lpos_phage_6-16-1","Lpos_phage_6-17-1","Lpos_phage_6-17-1","Lpos_phage_6-19-1","Lpos_phage_6-19-1","Lpos_phage_6-19-1","Lpos_phage_6-20-1","Lpos_phage_7-1-1","Lpos_phage_7-5-1","Lpos_phage_7-5-1","Lpos_phage_7-6-1","Lpos_phage_7-6-1","Lpos_phage_7-6-1","Lpos_phage_7-7-1","Lpos_phage_7-7-1","Lpos_phage_7-10-1","Lpos_phage_7-12-1","Lpos_phage_7-12-1","Lpos_phage_7-14-1","Lpos_phage_7-14-1","Lpos_phage_8-1-1","Lpos_phage_8-1-1","Lpos_phage_8-1-1","Lpos_phage_8-2-1","Lpos_phage_8-6-1","Lpos_phage_8-6-1","Lpos_phage_8-7-1","Lpos_phage_8-7-1","Lpos_phage_8-11-1","Lpos_phage_8-11-1","Lpos_phage_8-11-1","Lpos_phage_8-14-1","Lpos_phage_8-14-1","Lpos_phage_8-16-1","Lpos_phage_8-16-1","Lpos_phage_8-17-1","Lpos_phage_8-17-1","Lpos_phage_8-17-1","Lpos_phage_8-18-1","Lpos_phage_8-18-1","Lpos_phage_8-18-1","Lpos_phage_8-18-1","Lpos_phage_9-1-1","Lpos_phage_9-2-1","Lpos_phage_9-2-1","Lpos_phage_9-3-1","Lpos_phage_9-7-1","Lpos_phage_9-7-1","Lpos_phage_9-8-1","Lpos_phage_9-8-1","Lpos_phage_9-9-1","Lpos_phage_9-10-1","Lpos_phage_9-10-1","Lpos_phage_9-11-1","Lpos_phage_9-13-1","Lpos_phage_9-13-1","Lpos_phage_9-13-1","Lpos_phage_9-13-1","Lpos_phage_9-14-1","Lpos_phage_9-15-1","Lpos_phage_9-16-1","Lpos_phage_9-16-1","Lpos_phage_9-19-1","Lpos_phage_9-19-1","Lpos_phage_9-24-1","Lpos_phage_9-24-1","Lpos_phage_9-33-1","Lpos_phage_9-33-1","Lpos_phage_9-33-1","Lpos_phage_9-36-1","Lpos_phage_9-39-1","Lpos_phage_9-39-1","Lpos_phage_9-40-1","Lpos_phage_9-41-1","Lpos_phage_9-42-1","Lpos_phage_9-43-1","Lpos_phage_9-44-1","Lpos_phage_9-44-1","Lpos_phage_9-49-1","Lpos_phage_9-52-1","Lpos_phage_9-52-1","Lpos_phage_9-55-1","Lpos_phage_9-55-1","Lpos_phage_9-56-1","Lpos_phage_9-58-1","Lpos_phage_9-59-1","Lpos_phage_9-62-1","Lpos_phage_9-63-1","Lpos_phage_9-64-1","Lpos_phage_9-64-1","Lpos_phage_9-65-1","Lpos_phage_9-65-1","Lpos_phage_9-72-1","Lpos_phage_9-75-1","Lpos_phage_9-75-1","Lpos_phage_9-78-1","Lpos_phage_9-84-1","Lpos_phage_9-84-1","Lpos_phage_9-85-1","Lpos_phage_9-85-1","Lpos_phage_9-85-1","Lpos_phage_9-93-1","Lpos_phage_9-94-1","Lpos_phage_9-94-1","Lpos_phage_9-97-1","Lpos_phage_9-98-1"]}],"nLoci":[{"name":["pos_phage_0","pos_phage_1","pos_phage_2","pos_phage_3","pos_phage_4","pos_phage_5","pos_phage_6","pos_phage_7","pos_phage_8","pos_phage_9"],"start":[1,1,1,1,1,1,1,1,1,1],"end":[146647,58871,58560,59443,51290,43293,43851,44262,41865,221908],"ch_average":[0.660848914184771,0.265295822123682,0.263894334112939,0.267873478529294,0.231132861964697,0.19509524260163,0.197609809514797,0.19946193675729,0.188660114372237,1.00000450639232],"n":[66,27,26,27,23,20,20,20,19,100],"seq_len":[146647,58871,58560,59443,51290,43293,43851,44262,41865,221908]}],"ploidy_n":1,"title":null,"cnt":false,"ch_gap":6,"top_margin":25,"left_margin":340,"chr_width":6,"chr_length":12,"chr_col":["black",""],"heatmap":true,"v_align":false,"ch_domain":["1","221908"],"lg_x":300,"lg_y":0,"heat_scale":"ordinal","labels":false,"div_id":"chromap","w":1500,"h":800,"rng":[["Other","Capsid","Tail","Baseplate"]],"heat_col":[["red","lightblue","orange","green"]],"an_col":["yellow",""],"ch_text":[true,true],"legend":[true,true],"aggregate_func":["avg",""]},"evals":[],"jsHooks":[]}</script>
<script type="application/htmlwidget-sizing" data-for="htmlwidget-c1a27c1ebf3ff410447f">{"viewer":{"width":450,"height":350,"padding":10,"fill":true},"browser":{"width":960,"height":500,"padding":10,"fill":true}}</script>
</body>
</html>
